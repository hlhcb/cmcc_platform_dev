!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).tianjingmapgl=t()}(this,(function(){"use strict";function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var tianjingmapGl={exports:{}};!function(e,t){e.exports=function(){var e,t,r;function n(n,i){if(e)if(t){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/tianjingmap-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),r=i(o),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=i;else e=i}return n(0,(function(e){!function(){const e={NODE_ENV:"production",SOME_OBJECT:{one:1,two:[1,2],three:"3"},UNUSED:null};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();var t="undefined"!=typeof self?self:{},r="3.0.0";let n;const i={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==n){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{n=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){n=e}}return n},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!i.API_URL)return null;try{const e=new URL(i.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},a={supported:!1,testSupport:function(e){!l&&s&&(u?c(e):o=e)}};let o,s,l=!1,u=!1;function c(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),e.isContextLost())return;a.supported=!0}catch(e){}e.deleteTexture(t),l=!0}t.document&&(s=t.document.createElement("img"),s.onload=function(){o&&c(o),o=null,u=!0},s.onerror=function(){l=!0,o=null},s.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const d="01";function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=p;function p(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}p.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=i/a}var o=0,s=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?o=r:s=r,r=.5*(s-o)+o;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var m=h(f),g=_;function _(e,t){this.x=e,this.y=t}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(e){return e instanceof _?e:Array.isArray(e)?new _(e[0],e[1]):e};var y=h(g);function v(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!v(e[r],t[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!v(e[r],t[r]))return!1;return!0}return e===t}const b=Math.PI/180,x=180/Math.PI;function T(e){return e*b}function w(e){return e*x}const E=[[0,0],[1,0],[1,1],[0,1]];function A(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function S(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const a of e)t=Math.min(t,a.x),r=Math.min(r,a.y),n=Math.max(n,a.x),i=Math.max(i,a.y);return{min:new y(t,r),max:new y(n,i)}}function P(e,t,r=0,n=!0){const i=new y(r,r),a=e.sub(i),o=t.add(i),s=[a,new y(o.x,a.y),o,new y(a.x,o.y)];return n&&s.push(a.clone()),s}function M(e,t,r,n){const i=new m(e,t,r,n);return function(e){return i.solve(e)}}const R=M(.25,.1,.25,1);function C(e,t,r){return Math.min(r,Math.max(t,e))}function O(e,t,r){return(r=C((r-e)/(t-e),0,1))*r*(3-2*r)}function L(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function I(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const i=new Array(e.length);let a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),i[o]=t,0==--n&&r(a,i)}))}))}function D(e){const t=[];for(const r in e)t.push(e[r]);return t}function k(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function B(e,t){const r={};for(let n=0;n<t.length;n++){const i=t[n];i in e&&(r[i]=e[i])}return r}let F=1;function N(){return F++}function q(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function U(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function j(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function G(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function z(e,t){return-1!==e.indexOf(t,e.length-t.length)}function V(e,t,r){const n={};for(const i in e)n[i]=t.call(r||this,e[i],i,e);return n}function $(e,t,r){const n={};for(const i in e)t.call(r||this,e[i],i,e)&&(n[i]=e[i]);return n}function H(e){return Array.isArray(e)?e.map(H):"object"==typeof e&&e?V(e,H):e}const W={};function X(e){W[e]||("undefined"!=typeof console&&console.warn(e),W[e]=!0)}function Y(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Z(e){let t=0;for(let r,n,i=0,a=e.length,o=a-1;i<a;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}function K([e,t,r]){const n=T(t+90),i=T(r);return{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i),azimuthal:t,polar:r}}function J(e,t,r){const n=Math.sqrt(e*e+t*t+r*r),i=n>0?Math.acos(r/n)*x:0;let a=0!==e||0!==t?Math.atan2(-t,-e)*x+90:0;return a<0&&(a+=360),[n,a,i]}function Q(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ee(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,n,i)=>{const a=n||i;return t[r]=!a||a.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let te=null;function re(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement}function ne(e){try{const r=t[e];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function ie(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function ae(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]}function oe(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function se(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const le="mapbox-tiles";let ue,ce,de=500,he=50;function fe(){try{return t.caches}catch(e){}}function pe(){fe()&&!ue&&(ue=t.caches.open(le))}function me(e){const t=e.indexOf("?");if(t<0)return e;const r=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),n=r.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return n.length?`${e.slice(0,t)}?${n.join("&")}`:e.slice(0,t)}let ge=1/0;function _e(e){ge++,ge>he&&(e.getActor().send("enforceCacheSizeLimit",de),ge=0)}const ye={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(ye);class ve extends Error{constructor(e,t,r){401===t&&Le(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const be=Q()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,xe=function(e,r){if(!(/^file:/.test(n=e.url)||/^file:/.test(be())&&!/^\w+:/.test(n))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,r){const n=new t.AbortController,i=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:be(),referrerPolicy:e.referrerPolicy,signal:n.signal});let a=!1,o=!1;const s=(l=i.url).indexOf("sku=")>0&&Le(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const u=(n,a,l)=>{if(o)return;if(n&&"SecurityError"!==n.message&&X(n.toString()),a&&l)return c(a);const u=Date.now();t.fetch(i).then((t=>{if(t.ok){const e=s?t.clone():null;return c(t,e,u)}return r(new ve(t.statusText,t.status,e.url))})).catch((t=>{"AbortError"!==t.name&&r(new Error(`${t.message} ${e.url}`))}))},c=(n,s,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{o||(s&&l&&function(e,r,n){if(pe(),!ue)return;const i={status:r.status,statusText:r.statusText,headers:new t.Headers};r.headers.forEach(((e,t)=>i.headers.set(t,e)));const a=ee(r.headers.get("Cache-Control")||"");if(a["no-store"])return;a["max-age"]&&i.headers.set("Expires",new Date(n+1e3*a["max-age"]).toUTCString());const o=i.headers.get("Expires");o&&(new Date(o).getTime()-n<42e4||function(e,t){if(void 0===ce)try{new Response(new ReadableStream),ce=!0}catch(e){ce=!1}ce?t(e.body):e.blob().then(t)}(r,(r=>{const n=new t.Response(r,i);pe(),ue&&ue.then((t=>t.put(me(e.url),n))).catch((e=>X(e.message)))})))}(i,s,l),a=!0,r(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{o||r(new Error(e.message))}))};return s?function(e,t){if(pe(),!ue)return t(null);const r=me(e.url);ue.then((e=>{e.match(r).then((n=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=ee(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(n);e.delete(r),i&&e.put(r,n.clone()),t(null,n,i)})).catch(t)})).catch(t)}(i,u):u(null,null),{cancel:()=>{o=!0,a||n.abort()}}}(e,r);if(Q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,r,void 0,!0)}var n;return function(e,r){const n=new t.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{r(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let t=n.response;if("json"===e.type)try{t=JSON.parse(n.response)}catch(e){return r(e)}r(null,t,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else r(new ve(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,r)},Te=function(e,t){return xe(k(e,{type:"json"}),t)},we=function(e,t){return xe(k(e,{type:"arrayBuffer"}),t)};function Ee(e){const r=t.document.createElement("a");return r.href=e,r.protocol===t.document.location.protocol&&r.host===t.document.location.host}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Se,Pe;Se=[],Pe=0;const Me=function(e,r){if(a.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Pe>=i.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Se.push(t),t}Pe++;let n=!1;const o=()=>{if(!n)for(n=!0,Pe--;Se.length&&Pe<i.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Se.shift(),{requestParameters:t,callback:r,cancelled:n}=e;n||(e.cancel=Me(t,r).cancel)}},s=we(e,((e,n,i,a)=>{o(),e?r(e):n&&(t.createImageBitmap?function(e,r){const n=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(n).then((e=>{r(null,e)})).catch((e=>{r(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,t)=>r(e,t,i,a))):function(e,r){const n=new t.Image,i=t.URL;n.onload=()=>{r(null,n),i.revokeObjectURL(n.src),n.onload=null,t.requestAnimationFrame((()=>{n.src=Ae}))},n.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new t.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?i.createObjectURL(a):Ae}(n,((e,t)=>r(e,t,i,a))))}));return{cancel:()=>{s.cancel(),o()}}},Re="NO_ACCESS_TOKEN";class Ce{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",d,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Oe(e))return e;const n=Fe(e);return n.params.push(`sdk=js-${r}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Oe(e))return e;const r=Fe(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Oe(e))return e;const r=Fe(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t,r,n){if(!Oe(e))return e;const i=Fe(e);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),r&&i.params.push(`language=${r}`),n&&i.params.push(`worldview=${n}`),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,n){const i=Fe(e);return Oe(e)?(i.path=`/styles/v1${i.path}/sprite${t}${r}`,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=`${t}${r}`,Ne(i))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Oe(e))return e;const n=Fe(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&"raster"!==n.authority&&512===r?"@2x":""}${a.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${i.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${i.TILE_URL_VERSION}${n.path}`);const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||i.ACCESS_TOKEN;return i.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,o)}canonicalizeTileURL(e,t){const r=Fe(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${i.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${i.TILE_URL_VERSION}/`,"")}`;let a=r.params;return t&&(a=a.filter((e=>!e.match(/^access_token=/)))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(e,t){const r=!!t&&Oe(t),n=[];for(const t of e.tiles||[])Le(t)?n.push(this.canonicalizeTileURL(t,r)):n.push(t);return n}_makeAPIURL(e,t){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Fe(i.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!i.REQUIRE_ACCESS_TOKEN)return Ne(e);if(t=t||i.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),Ne(e)}}function Oe(e){return 0===e.indexOf("mapbox:")}function Le(e){return i.API_URL_REGEX.test(e)}function Ie(e){return i.API_CDN_URL_REGEX.test(e)}function De(e){return i.API_STYLE_REGEX.test(e)&&!ke(e)}function ke(e){return i.API_SPRITE_REGEX.test(e)}const Be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fe(e){const t=e.match(Be);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ne(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const qe="mapbox.eventData";function Ue(e){if(!e)return null;const r=e.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(r[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class je{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Ue(i.ACCESS_TOKEN);let n="";return n=r&&r.u?t.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):i.ACCESS_TOKEN||"",e?`${qe}.${e}:${n}`:`${qe}:${n}`}fetchEventData(){const e=ne("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(r);e&&(this.eventData=JSON.parse(e));const i=t.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){X("Unable to read from LocalStorage")}}saveEventData(){const e=ne("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(r,JSON.stringify(this.eventData))}catch(e){X("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){if(!i.EVENTS_URL)return;const a=Fe(i.EVENTS_URL);a.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString()},s=t?k(o,t):o,l={url:Ne(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return xe(k(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ge=new class extends je{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){i.EVENTS_URL&&i.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>Oe(e)||Le(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ue(i.ACCESS_TOKEN),n=t?t.u:i.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;j(this.anonId)||(this.anonId=q(),a=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),r=(o-this.eventData.lastSuccess)/864e5;a=a||r>=1||r<-1||e.getDate()!==t.getDate()}else a=!0;a?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:r,skuId:d,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=n)}),e):this.processRequests()}},ze=Ge.postTurnstileEvent.bind(Ge),Ve=new class extends je{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,i.EVENTS_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),j(this.anonId)||(this.anonId=q()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:r,skuId:d,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}};Ve.postMapLoadEvent.bind(Ve);const $e=new class extends je{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){i.EVENTS_URL&&(e||i.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:n,performanceData:i}=this.queue.shift(),a=function(e){const n=t.performance.getEntriesByType("resource"),i=t.performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const n of e[r]){const e=`${r}ResolveRangeMin`,i=`${r}ResolveRangeMax`,a=`${r}RequestCount`,o=`${r}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,n.startTime),t[i]=Math.max(t[i]||-1/0,n.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&s(o),s(a)}return t}(function(e,t){const r={};if(e)for(const n of e){const e=t(n);void 0===r[e]&&(r[e]=[]),r[e].push(n)}return r}(n,Ke)),o=t.devicePixelRatio,s=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},u=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const e in a)u(l.counters,e,a[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(u(l.counters,"interactionRangeMin",e.interactionRange[0]),u(l.counters,"interactionRangeMax",e.interactionRange[1])),i)for(const e of Object.keys(Ye)){const t=Ye[e],r=i.find((e=>e.name===t));r&&u(l.counters,t,r.startTime)}return u(l.counters,"visibilityHidden",e.visibilityHidden),u(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(De(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(n)),u(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),u(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),u(l.attributes,"projection",e.projection),u(l.attributes,"zoom",e.zoom),u(l.metadata,"devicePixelRatio",o),u(l.metadata,"connectionEffectiveType",s?s.effectiveType:void 0),u(l.metadata,"navigatorUserAgent",t.navigator.userAgent),u(l.metadata,"screenWidth",t.screen.width),u(l.metadata,"screenHeight",t.screen.height),u(l.metadata,"windowWidth",t.innerWidth),u(l.metadata,"windowHeight",t.innerHeight),u(l.metadata,"mapWidth",e.width/o),u(l.metadata,"mapHeight",e.height/o),u(l.metadata,"webglRenderer",e.renderer),u(l.metadata,"webglVendor",e.vendor),u(l.metadata,"sdkVersion",r),u(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(i);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(n,a,(()=>{}),e)}},He=$e.postPerformanceEvent.bind($e),We=new class extends je{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){if(!i.API_URL||!i.SESSION_PATH)return;const a=Fe(i.API_URL+i.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${n||i.ACCESS_TOKEN||""}`);const o={url:Ne(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return xe(k(e,{method:"GET"}),t)}(o,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,i.SESSION_PATH&&i.API_URL&&(r||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}};We.getSessionAPI.bind(We);const Xe=new Set,Ye={create:"create",load:"load",fullLoad:"fullLoad"},Ze={mark(e){t.performance.mark(e)},measure(e,r,n){t.performance.measure(e,r,n)}};function Ke(e){const t=e.name.split("?")[0];return Ie(t)&&t.includes("mapbox-gl.js")?"javascript":Ie(t)&&t.includes("mapbox-gl.css")?"css":function(e){return i.API_FONTS_REGEX.test(e)}(t)?"fontRange":ke(t)?"sprite":De(t)?"style":function(e){return i.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const Je=t.performance;function Qe(e){const t=e?e.url.toString():void 0;return Je.getEntriesByName(t)}var et=tt;function tt(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var r=t.getImageData(0,0,1,1);return r&&r.width===e.width}()?(void 0===rt[t=e&&e.failIfMajorPerformanceCaveat]&&(rt[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(tt.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),rt[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var rt={};let nt,it,at,ot;tt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const st={now:()=>void 0!==at?at:t.performance.now(),setNow(e){at=e},restoreNow(){at=void 0},frame(e){const r=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(r)}},getImageData(e,r=0){const{width:n,height:i}=e;ot||(ot=t.document.createElement("canvas"));const a=ot.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>ot.width||i>ot.height)&&(ot.width=n,ot.height=i),a.clearRect(-r,-r,n+2*r,i+2*r),a.drawImage(e,0,0,n,i),a.getImageData(-r,-r,n+2*r,i+2*r)},resolveURL:e=>(nt||(nt=t.document.createElement("a")),nt.href=e,nt.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==it&&(it=t.matchMedia("(prefers-reduced-motion: reduce)")),it.matches)}};function lt(e,r,n){const i=t.document.createElement(e);return void 0!==r&&(i.className=r),n&&n.appendChild(i),i}function ut(e,r,n){const i=t.document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(r))i.setAttributeNS(null,e,r[e]);return n&&n.appendChild(i),i}const ct=t.document&&t.document.documentElement.style,dt=ct&&void 0!==ct.userSelect?"userSelect":"WebkitUserSelect";let ht;function ft(){ct&&dt&&(ht=ct[dt],ct[dt]="none")}function pt(){ct&&dt&&(ct[dt]=ht)}function mt(e){e.preventDefault(),e.stopPropagation(),t.removeEventListener("click",mt,!0)}function gt(){t.addEventListener("click",mt,!0),t.setTimeout((()=>{t.removeEventListener("click",mt,!0)}),0)}function _t(e,t){const r=e.getBoundingClientRect();return bt(e,r,t)}function yt(e,t){const r=e.getBoundingClientRect(),n=[];for(let i=0;i<t.length;i++)n.push(bt(e,r,t[i]));return n}function vt(e){return void 0!==t.InstallTrigger&&2===e.button&&e.ctrlKey&&t.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function bt(e,t,r){const n=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new y((r.clientX-t.left)*n,(r.clientY-t.top)*n)}function xt(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Tt(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}class wt{constructor(e,t={}){k(this,t),this.type=e}}class Et extends wt{constructor(e,t={}){super("error",k({error:e},t))}}class At{on(e,t){return this._listeners=this._listeners||{},xt(e,t,this._listeners),this}off(e,t){return Tt(e,t,this._listeners),Tt(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new wt(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const t=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const t of n)Tt(r,t,this._oneTimeListeners),t.call(this,e);const i=this._eventedParent;i&&(k(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof Et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var St=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Pt{constructor(e,t,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}class Mt extends Pt{}function Rt(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function Ct(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ot(e){if(Array.isArray(e))return e.map(Ot);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Ot(e[r]);return t}return Ct(e)}class Lt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var It=Lt;class Dt{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new Dt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var kt=Dt;const Bt={kind:"null"},Ft={kind:"number"},Nt={kind:"string"},qt={kind:"boolean"},Ut={kind:"color"},jt={kind:"object"},Gt={kind:"value"},zt={kind:"collator"},Vt={kind:"formatted"},$t={kind:"resolvedImage"};function Ht(e,t){return{kind:"array",itemType:e,N:t}}function Wt(e){if("array"===e.kind){const t=Wt(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Xt=[Bt,Ft,Nt,qt,Ut,Vt,jt,Ht(Gt),$t];function Yt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Yt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Xt)if(!Yt(e,t))return null}return`Expected ${Wt(e)} but found ${Wt(t)} instead.`}function Zt(e,t){return t.some((t=>t.kind===e.kind))}function Kt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Jt,Qt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function er(e){return(e=Math.round(e))<0?0:e>255?255:e}function tr(e){return er("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function rr(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function nr(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{Jt={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in Qt)return Qt[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var a=r.substr(0,n),o=r.substr(n+1,i-(n+1)).split(","),s=1;switch(a){case"rgba":if(4!==o.length)return null;s=rr(o.pop());case"rgb":return 3!==o.length?null:[tr(o[0]),tr(o[1]),tr(o[2]),s];case"hsla":if(4!==o.length)return null;s=rr(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,u=rr(o[1]),c=rr(o[2]),d=c<=.5?c*(u+1):c+u-c*u,h=2*c-d;return[er(255*nr(h,d,l+1/3)),er(255*nr(h,d,l)),er(255*nr(h,d,l-1/3)),s];default:return null}}return null}}catch(e){}class ir{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof ir)return e;if("string"!=typeof e)return;const t=Jt(e);return t?new ir(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}toArray01Scaled(e){const{r:t,g:r,b:n,a:i}=this;return 0===i?[0,0,0]:[t/i*e,r/i*e,n/i*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}toArray01Linear(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(e/n,2.2),Math.pow(t/n,2.2),Math.pow(r/n,2.2),n]}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1),ir.blue=new ir(0,0,1,1);var ar=ir;class or{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sr{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class lr{constructor(e){this.sections=e}static fromString(e){return new lr([new sr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof lr?e:lr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class ur{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new ur({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function cr(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function dr(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ar)return!0;if(e instanceof or)return!0;if(e instanceof lr)return!0;if(e instanceof ur)return!0;if(Array.isArray(e)){for(const t of e)if(!dr(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!dr(e[t]))return!1;return!0}return!1}function hr(e){if(null===e)return Bt;if("string"==typeof e)return Nt;if("boolean"==typeof e)return qt;if("number"==typeof e)return Ft;if(e instanceof ar)return Ut;if(e instanceof or)return zt;if(e instanceof lr)return Vt;if(e instanceof ur)return $t;if(Array.isArray(e)){const t=e.length;let r;for(const t of e){const e=hr(t);if(r){if(r===e)continue;r=Gt;break}r=e}return Ht(r||Gt,t)}return jt}function fr(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof ar||e instanceof lr||e instanceof ur?e.toString():JSON.stringify(e)}class pr{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!dr(e[1]))return t.error("invalid value");const r=e[1];let n=hr(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new pr(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ar?["rgba"].concat(this.value.toArray()):this.value instanceof lr?this.value.serialize():this.value}}var mr=pr,gr=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const _r={string:Nt,number:Ft,boolean:qt,object:jt};class yr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,a;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in _r)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=_r[r],n++}else i=Gt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],n++}r=Ht(i,a)}else r=_r[i];const a=[];for(;n<e.length;n++){const r=t.parse(e[n],n,Gt);if(!r)return null;a.push(r)}return new yr(r,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Yt(this.type,hr(r)))return r;if(t===this.args.length-1)throw new gr(`Expected value to be of type ${Wt(this.type)}, but found ${Wt(hr(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var vr=yr;class br{constructor(e){this.type=Vt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=e.length-1;++r){const a=e[r];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;let e=null;if(a["font-scale"]&&(e=t.parse(a["font-scale"],1,Ft),!e))return null;let r=null;if(a["text-font"]&&(r=t.parse(a["text-font"],1,Ht(Nt)),!r))return null;let o=null;if(a["text-color"]&&(o=t.parse(a["text-color"],1,Ut),!o))return null;const s=n[n.length-1];s.scale=e,s.font=r,s.textColor=o}else{const a=t.parse(e[r],1,Gt);if(!a)return null;const o=a.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:a,scale:null,font:null,textColor:null})}}return new br(n)}evaluate(e){return new lr(this.sections.map((t=>{const r=t.content.evaluate(e);return hr(r)===$t?new sr("",r,null,null,null):new sr(fr(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class xr{constructor(e,t){this.type=$t,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const r=t.parse(e[1],1,Nt);if(!r)return t.error("No image name provided.");if(2===e.length)return new xr(r);const n=t.parse(e[2],1,Nt);return n?new xr(r,n):t.error("Secondary image variant is not a string.")}evaluate(e){const t=ur.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Tr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const wr={"to-boolean":qt,"to-color":Ut,"to-number":Ft,"to-string":Nt};class Er{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0],n=[];let i=Bt;if("to-array"===r){if(!Array.isArray(e[1]))return null;const r=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);i=Ht(t.expectedType.itemType,r)}else{if(!(r>0&&dr(e[1][0])))return null;i=Ht(hr(e[1][0]),r)}for(let a=0;a<r;a++){const r=e[1][a];let o;if("array"===Tr(r))o=t.parse(r,void 0,i.itemType);else{const e=Tr(r);if(e!==i.itemType.kind)return t.error(`Expected ${i.itemType.kind} but found ${e}.`);o=t.registry.literal.parse(["literal",void 0===r?null:r],t)}if(!o)return null;n.push(o)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");i=wr[r];for(let r=1;r<e.length;r++){const i=t.parse(e[r],r,Gt);if(!i)return null;n.push(i)}}return new Er(i,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof ar)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:cr(t[0],t[1],t[2],t[3]),!r))return new ar(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new gr(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new gr(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?lr.fromString(fr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ur.fromString(fr(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):fr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new br([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new xr(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ar=Er;const Sr=["Unknown","Point","LineString","Polygon"];var Pr=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Sr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=ar.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Mr{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],n=Mr.definitions[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=a.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[n,a]of o){s=new jn(t.registry,t.path,null,t.scope,void 0,t.options);const o=[];let l=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(n)?n[t-1]:n.type,a=s.parse(r,1+o.length,i);if(!a){l=!0;break}o.push(a)}if(!l)if(Array.isArray(n)&&n.length!==o.length)s.error(`Expected ${n.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(n)?n[e]:n.type,r=o[e];s.concat(e+1).checkSubtype(t,r.type)}if(0===s.errors.length)return new Mr(r,i,a,o)}}if(1===o.length)t.errors.push(...s.errors);else{const r=(o.length?o:a).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Wt).join(", ")})`:`(${Wt(t.type)}...)`;var t})).join(" | "),n=[];for(let r=1;r<e.length;r++){const i=t.parse(e[r],1+n.length);if(!i)return null;n.push(Wt(i.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){Mr.definitions=t;for(const r in t)e[r]=Mr}}var Rr=Mr;class Cr{constructor(e,t,r){this.type=zt,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,qt);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,qt);if(!i)return null;let a=null;return r.locale&&(a=t.parse(r.locale,1,Nt),!a)?null:new Cr(n,i,a)}evaluate(e){return new or(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Or={exports:{}};Or.exports=function(){function e(r,n,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,l=n-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-l*c/s+d)),Math.min(a,Math.floor(n+(s-l)*c/s+d)),o)}var h=r[n],f=i,p=a;for(t(r,i,n),o(r[a],h)>0&&t(r,i,a);f<p;){for(t(r,f,p),f++,p--;o(r[f],h)<0;)f++;for(;o(r[p],h)>0;)p--}0===o(r[i],h)?t(r,i,p):t(r,++p,a),p<=n&&(i=p+1),n<=p&&(a=p-1)}}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}return function(t,n,i,a,o){e(t,n,i||0,a||t.length-1,o||r)}}();var Lr=h(Or.exports);function Ir(e){let t=0;for(let r,n,i=0,a=e.length,o=a-1;i<a;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}function Dr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function kr(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Br(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],a=e[0]-r[0],o=e[1]-r[1];return n*o-a*i==0&&n*a<=0&&i*o<=0}function Fr(e,t,r=!1){let n=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,u=s-1;t<s;u=t++){const s=l[u],c=l[t];if(Br(e,s,c))return r;(a=s)[1]>(i=e)[1]!=(o=c)[1]>i[1]&&i[0]<(o[0]-a[0])*(i[1]-a[1])/(o[1]-a[1])+a[0]&&(n=!n)}}var i,a,o;return n}function Nr(e,t,r,n){const i=n[0]-r[0],a=n[1]-r[1],o=(e[0]-r[0])*a-i*(e[1]-r[1]),s=(t[0]-r[0])*a-i*(t[1]-r[1]);return o>0&&s<0||o<0&&s>0}function qr(e,t,r,n){return 0!=(i=[n[0]-r[0],n[1]-r[1]])[0]*(a=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*a[0]&&!(!Nr(e,t,r,n)||!Nr(r,n,e,t));var i,a}const Ur=8192;function jr(e,t){const r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*Ur),Math.round(n*i*Ur)]}function Gr(e,t){for(let r=0;r<t.length;r++)if(Fr(e,t[r]))return!0;return!1}function zr(e,t,r){for(const n of r)for(let r=0,i=n.length,a=i-1;r<i;a=r++)if(qr(e,t,n[a],n[r]))return!0;return!1}function Vr(e,t){for(let r=0;r<e.length;++r)if(!Fr(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(zr(e[r],e[r+1],t))return!1;return!0}function $r(e,t){for(let r=0;r<t.length;r++)if(Vr(e,t[r]))return!0;return!1}function Hr(e,t,r){const n=[];for(let i=0;i<e.length;i++){const a=[];for(let n=0;n<e[i].length;n++){const o=jr(e[i][n],r);Dr(t,o),a.push(o)}n.push(a)}return n}function Wr(e,t,r){const n=[];for(let i=0;i<e.length;i++){const a=Hr(e[i],t,r);n.push(a)}return n}function Xr(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}Dr(t,e)}function Yr(e,t,r,n){const i=Math.pow(2,n.z)*Ur,a=[n.x*Ur,n.y*Ur],o=[];if(!e)return o;for(const n of e)for(const e of n){const n=[e.x+a[0],e.y+a[1]];Xr(n,t,r,i),o.push(n)}return o}function Zr(e,t,r,n){const i=Math.pow(2,n.z)*Ur,a=[n.x*Ur,n.y*Ur],o=[];if(!e)return o;for(const r of e){const e=[];for(const n of r){const r=[n.x+a[0],n.y+a[1]];Dr(t,r),e.push(r)}o.push(e)}if(t[2]-t[0]<=i/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of o)for(const n of e)Xr(n,t,r,i)}var s;return o}class Kr{constructor(e,t){this.type=qt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(dr(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Kr(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Kr(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Kr(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const a=Hr(t.coordinates,n,i),o=Yr(e.geometry(),r,n,i);if(!kr(r,n))return!1;for(const e of o)if(!Fr(e,a))return!1}if("MultiPolygon"===t.type){const a=Wr(t.coordinates,n,i),o=Yr(e.geometry(),r,n,i);if(!kr(r,n))return!1;for(const e of o)if(!Gr(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const a=Hr(t.coordinates,n,i),o=Zr(e.geometry(),r,n,i);if(!kr(r,n))return!1;for(const e of o)if(!Vr(e,a))return!1}if("MultiPolygon"===t.type){const a=Wr(t.coordinates,n,i),o=Zr(e.geometry(),r,n,i);if(!kr(r,n))return!1;for(const e of o)if(!$r(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Jr=Kr,Qr={exports:{}};Qr.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,r=t*(2-t),n=Math.PI/180,i=function(t,i){if(void 0===t)throw new Error("No latitude given.");if(i&&!e[i])throw new Error("Unknown unit "+i+". Use one of: "+Object.keys(e).join(", "));var a=6378.137*n*(i?e[i]:1),o=Math.cos(t*n),s=1/(1-r*(1-o*o)),l=Math.sqrt(s);this.kx=a*l*o,this.ky=a*l*s*(1-r)},a={units:{configurable:!0}};function o(e,t){return e[0]===t[0]&&e[1]===t[1]}function s(e,t,r){var n=l(t[0]-e[0]);return[e[0]+n*r,e[1]+(t[1]-e[1])*r]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return i.fromTile=function(e,t,r){var a=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),o=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/n;return new i(o,r)},a.units.get=function(){return e},i.prototype.distance=function(e,t){var r=l(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+n*n)},i.prototype.bearing=function(e,t){var r=l(t[0]-e[0])*this.kx;return Math.atan2(r,(t[1]-e[1])*this.ky)/n},i.prototype.destination=function(e,t,r){var i=r*n;return this.offset(e,Math.sin(i)*t,Math.cos(i)*t)},i.prototype.offset=function(e,t,r){return[e[0]+t/this.kx,e[1]+r/this.ky]},i.prototype.lineDistance=function(e){for(var t=0,r=0;r<e.length-1;r++)t+=this.distance(e[r],e[r+1]);return t},i.prototype.area=function(e){for(var t=0,r=0;r<e.length;r++)for(var n=e[r],i=0,a=n.length,o=a-1;i<a;o=i++)t+=l(n[i][0]-n[o][0])*(n[i][1]+n[o][1])*(r?-1:1);return Math.abs(t)/2*this.kx*this.ky},i.prototype.along=function(e,t){var r=0;if(t<=0)return e[0];for(var n=0;n<e.length-1;n++){var i=e[n],a=e[n+1],o=this.distance(i,a);if((r+=o)>t)return s(i,a,(t-(r-o))/o)}return e[e.length-1]},i.prototype.pointToSegmentDistance=function(e,t,r){var n=t[0],i=t[1],a=l(r[0]-n)*this.kx,o=(r[1]-i)*this.ky,s=0;return 0===a&&0===o||((s=(l(e[0]-n)*this.kx*a+(e[1]-i)*this.ky*o)/(a*a+o*o))>1?(n=r[0],i=r[1]):s>0&&(n+=a/this.kx*s,i+=o/this.ky*s)),a=l(e[0]-n)*this.kx,o=(e[1]-i)*this.ky,Math.sqrt(a*a+o*o)},i.prototype.pointOnLine=function(e,t){for(var r,n,i,a,o=1/0,s=0;s<e.length-1;s++){var u=e[s][0],c=e[s][1],d=l(e[s+1][0]-u)*this.kx,h=(e[s+1][1]-c)*this.ky,f=0;0===d&&0===h||((f=(l(t[0]-u)*this.kx*d+(t[1]-c)*this.ky*h)/(d*d+h*h))>1?(u=e[s+1][0],c=e[s+1][1]):f>0&&(u+=d/this.kx*f,c+=h/this.ky*f));var p=(d=l(t[0]-u)*this.kx)*d+(h=(t[1]-c)*this.ky)*h;p<o&&(o=p,r=u,n=c,i=s,a=f)}return{point:[r,n],index:i,t:Math.max(0,Math.min(1,a))}},i.prototype.lineSlice=function(e,t,r){var n=this.pointOnLine(r,e),i=this.pointOnLine(r,t);if(n.index>i.index||n.index===i.index&&n.t>i.t){var a=n;n=i,i=a}var s=[n.point],l=n.index+1,u=i.index;!o(r[l],s[0])&&l<=u&&s.push(r[l]);for(var c=l+1;c<=u;c++)s.push(r[c]);return o(r[u],i.point)||s.push(i.point),s},i.prototype.lineSliceAlong=function(e,t,r){for(var n=0,i=[],a=0;a<r.length-1;a++){var o=r[a],l=r[a+1],u=this.distance(o,l);if((n+=u)>e&&0===i.length&&i.push(s(o,l,(e-(n-u))/u)),n>=t)return i.push(s(o,l,(t-(n-u))/u)),i;n>e&&i.push(l)}return i},i.prototype.bufferPoint=function(e,t){var r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[0]+n,e[1]+r]},i.prototype.bufferBBox=function(e,t){var r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[2]+n,e[3]+r]},i.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(i,a),i}();var en=h(Qr.exports),tn={exports:{}};tn.exports=function(){var e=function(e,r){if(void 0===e&&(e=[]),void 0===r&&(r=t),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var i=e-1>>1,a=t[i];if(r(n,a)>=0)break;t[e]=a,e=i}t[e]=n},e.prototype._down=function(e){for(var t=this.data,r=this.compare,n=this.length>>1,i=t[e];e<n;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&r(t[s],o)<0&&(a=s,o=t[s]),r(o,i)>=0)break;t[e]=o,e=a}t[e]=i},e}();var rn=h(tn.exports),nn=8192;function an(e,t){return t.dist-e.dist}const on=100,sn=50;function ln(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function un(e){return e[1]-e[0]+1}function cn(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function dn(e,t){if(e[0]>e[1])return[null,null];const r=un(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===r)return[e,null];const t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function hn(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!cn(t,e.length))return r;for(let n=t[0];n<=t[1];++n)Dr(r,e[n]);return r}function fn(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let n=0;n<e[r].length;++n)Dr(t,e[r][n]);return t}function pn(e,t,r){if(ln(e)||ln(t))return NaN;let n=0,i=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),r.distance([0,0],[n,i])}function mn(e,t){const r=Math.pow(2,t.z);return[(i=(e.x/nn+t.x)/r,360*i-180),(n=(e.y/nn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,i}function gn(e,t){const r=[];for(let n=0;n<e.length;++n)r.push(mn(e[n],t));return r}function _n(e,t,r){const n=r.pointOnLine(t,e).point;return r.distance(e,n)}function yn(e,t,r,n,i){const a=r.slice(n[0],n[1]+1);let o=1/0;for(let r=t[0];r<=t[1];++r)if(0===(o=Math.min(o,_n(e[r],a,i))))return 0;return o}function vn(e,t,r,n,i){const a=Math.min(i.pointToSegmentDistance(e,r,n),i.pointToSegmentDistance(t,r,n)),o=Math.min(i.pointToSegmentDistance(r,e,t),i.pointToSegmentDistance(n,e,t));return Math.min(a,o)}function bn(e,t,r,n,i){if(!cn(t,e.length)||!cn(n,r.length))return NaN;let a=1/0;for(let o=t[0];o<t[1];++o)for(let t=n[0];t<n[1];++t){if(qr(e[o],e[o+1],r[t],r[t+1]))return 0;a=Math.min(a,vn(e[o],e[o+1],r[t],r[t+1],i))}return a}function xn(e,t,r,n,i){if(!cn(t,e.length)||!cn(n,r.length))return NaN;let a=1/0;for(let o=t[0];o<=t[1];++o)for(let t=n[0];t<=n[1];++t)if(0===(a=Math.min(a,i.distance(e[o],r[t]))))return a;return a}function Tn(e,t,r){if(Fr(e,t,!0))return 0;let n=1/0;for(const i of t){const t=i.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[t-1]&&0===(n=Math.min(n,r.pointToSegmentDistance(e,i[t-1],i[0]))))return n;if(0===(n=Math.min(n,_n(e,i,r))))return n}return n}function wn(e,t,r,n){if(!cn(t,e.length))return NaN;for(let n=t[0];n<=t[1];++n)if(Fr(e[n],r,!0))return 0;let i=1/0;for(let a=t[0];a<t[1];++a)for(const t of r)for(let r=0,o=t.length,s=o-1;r<o;s=r++){if(qr(e[a],e[a+1],t[s],t[r]))return 0;i=Math.min(i,vn(e[a],e[a+1],t[s],t[r],n))}return i}function En(e,t){for(const r of e)for(let e=0;e<=r.length-1;++e)if(Fr(r[e],t,!0))return!0;return!1}function An(e,t,r,n=1/0){const i=fn(e),a=fn(t);if(n!==1/0&&pn(i,a,r)>=n)return n;if(kr(i,a)){if(En(e,t))return 0}else if(En(t,e))return 0;let o=n;for(const n of e)for(let e=0,i=n.length,a=i-1;e<i;a=e++)for(const i of t)for(let t=0,s=i.length,l=s-1;t<s;l=t++){if(qr(n[a],n[e],i[l],i[t]))return 0;o=Math.min(o,vn(n[a],n[e],i[l],i[t],r))}return o}function Sn(e,t,r,n,i,a,o){if(null===a||null===o)return;const s=pn(hn(n,a),hn(i,o),r);s<t&&e.push({dist:s,range1:a,range2:o})}function Pn(e,t,r,n,i=1/0){let a=Math.min(n.distance(e[0],r[0][0]),i);if(0===a)return a;const o=new rn([{dist:0,range1:[0,e.length-1],range2:[0,0]}],an),s=t?sn:on,l=fn(r);for(;o.length;){const i=o.pop();if(i.dist>=a)continue;const u=i.range1;if(un(u)<=s){if(!cn(u,e.length))return NaN;if(t){const t=wn(e,u,r,n);if(0===(a=Math.min(a,t)))return a}else for(let t=u[0];t<=u[1];++t){const i=Tn(e[t],r,n);if(0===(a=Math.min(a,i)))return a}}else{const r=dn(u,t);if(null!==r[0]){const t=pn(hn(e,r[0]),l,n);t<a&&o.push({dist:t,range1:r[0],range2:[0,0]})}if(null!==r[1]){const t=pn(hn(e,r[1]),l,n);t<a&&o.push({dist:t,range1:r[1],range2:[0,0]})}}}return a}function Mn(e,t,r,n,i,a=1/0){let o=Math.min(a,i.distance(e[0],r[0]));if(0===o)return o;const s=new rn([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],an),l=t?sn:on,u=n?sn:on;for(;s.length;){const a=s.pop();if(a.dist>=o)continue;const c=a.range1,d=a.range2;if(un(c)<=l&&un(d)<=u){if(!cn(c,e.length)||!cn(d,r.length))return NaN;if(t&&n?o=Math.min(o,bn(e,c,r,d,i)):t||n?t&&!n?o=Math.min(o,yn(r,d,e,c,i)):!t&&n&&(o=Math.min(o,yn(e,c,r,d,i))):o=Math.min(o,xn(e,c,r,d,i)),0===o)return o}else{const a=dn(c,t),l=dn(d,n);Sn(s,o,i,e,r,a[0],l[0]),Sn(s,o,i,e,r,a[0],l[1]),Sn(s,o,i,e,r,a[1],l[0]),Sn(s,o,i,e,r,a[1],l[1])}}return o}function Rn(e,t,r,n,i=1/0){let a=i;const o=hn(e,[0,e.length-1]);for(const i of r)if(!(a!==1/0&&pn(o,hn(i,[0,i.length-1]),n)>=a)&&(a=Math.min(a,Mn(e,t,i,!0,n,a)),0===a))return a;return a}function Cn(e,t,r,n,i=1/0){let a=i;const o=hn(e,[0,e.length-1]);for(const i of r){if(a!==1/0&&pn(o,fn(i),n)>=a)continue;const r=Pn(e,t,i,n,a);if(isNaN(r))return r;if(0===(a=Math.min(a,r)))return a}return a}function On(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Ln{constructor(e,t){this.type=Ft,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(dr(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(On(t.features[e].geometry.type))return new Ln(t,t.features[e].geometry)}else if("Feature"===t.type){if(On(t.geometry.type))return new Ln(t,t.geometry)}else if(On(t.type))return new Ln(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),r=e.canonicalID();if(null!=t&&null!=r){if("Point"===e.geometryType())return function(e,t,r){const n=[];for(const r of e)for(const e of r)n.push(mn(e,t));const i=new en(n[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?Mn(n,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i):"MultiLineString"===r.type?Rn(n,!1,r.coordinates,i):"Polygon"===r.type||"MultiPolygon"===r.type?Cn(n,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,i):null}(t,r,this.geometries);if("LineString"===e.geometryType())return function(e,t,r){const n=[];for(const r of e){const e=[];for(const n of r)e.push(mn(n,t));n.push(e)}const i=new en(n[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Rn("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const a=Rn(r.coordinates[t],!0,n,i,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let t=0;t<n.length;t++){const a=Cn(n[t],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,i,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return null}(t,r,this.geometries);if("Polygon"===e.geometryType())return function(e,t,r){const n=[];for(const r of function(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,a;for(let t=0;t<r;t++){const r=Ir(e[t]);0!==r&&(e[t].area=Math.abs(r),void 0===a&&(a=r<0),a===r<0?(i&&n.push(i),i=[e[t]]):i.push(e[t]))}return i&&n.push(i),n}(e)){const e=[];for(let n=0;n<r.length;++n)e.push(gn(r[n],t));n.push(e)}const i=new en(n[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Cn("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const a=Cn(r.coordinates[t],!0,n,i,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,t,r){let n=1/0;for(const i of e)for(const e of t){const t=An(i,e,r,n);if(isNaN(t))return t;if(0===(n=Math.min(n,t)))return n}return n}("Polygon"===r.type?[r.coordinates]:r.coordinates,n,i):null}(t,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var In=Ln;function Dn(e){if(e instanceof Rr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Jr)return!1;if(e instanceof In)return!1;let t=!0;return e.eachChild((e=>{t&&!Dn(e)&&(t=!1)})),t}function kn(e){if(e instanceof Rr&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!kn(e)&&(t=!1)})),t}function Bn(e){if(e instanceof Rr&&"config"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Bn(e)&&(t=!1)})),t}function Fn(e,t){if(e instanceof Rr&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Fn(e,t)&&(r=!1)})),r}class Nn{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Nn(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qn=Nn;class Un{constructor(e,t=[],r,n=new kt,i=[],a){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r,this.options=a}parse(e,t,r,n,i={}){return t||r?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new vr(t,[e]):"coerce"===r?new Ar(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let i=n.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,n=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else i=r(i,e,t.typeAnnotation||"coerce");else i=r(i,e,t.typeAnnotation||"assert")}if(!(i instanceof mr)&&"resolvedImage"!==i.type.kind&&Gn(i)){const t=new Pr(this.options);try{i=new mr(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return Ar.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new Un(this.registry,n,t||null,i,this.errors,this.options)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new It(r,e))}checkSubtype(e,t){const r=Yt(e,t);return r&&this.error(r),r}}var jn=Un;function Gn(e){if(e instanceof qn)return Gn(e.boundExpression);if(e instanceof Rr&&"error"===e.name)return!1;if(e instanceof Rr&&"config"===e.name)return!1;if(e instanceof Cr)return!1;if(e instanceof Jr)return!1;if(e instanceof In)return!1;const t=e instanceof Ar||e instanceof vr;let r=!0;return e.eachChild((e=>{r=t?r&&Gn(e):r&&e instanceof mr})),!!r&&Dn(e)&&Fn(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function zn(e,t){const r=e.length-1;let n,i,a=0,o=r,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),n=e[s],i=e[s+1],n<=t){if(s===r||t<i)return s;a=s+1}else{if(!(n>t))throw new gr("Input is not a number.");o=s-1}return 0}class Vn{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,Ft);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let r=1;r<e.length;r+=2){const a=1===r?-1/0:e[r],o=e[r+1],s=r,l=r+1;if("number"!=typeof a)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(n.length&&n[n.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(o,l,i);if(!u)return null;i=i||u.type,n.push([a,u])}return new Vn(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[zn(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var $n=Vn;function Hn(e,t,r){return e*(1-r)+t*r}function Wn(e,t,r){return e.map(((e,n)=>Hn(e,t[n],r)))}var Xn=Object.freeze({__proto__:null,array:Wn,color:function(e,t,r){return new ar(Hn(e.r,t.r,r),Hn(e.g,t.g,r),Hn(e.b,t.b,r),Hn(e.a,t.a,r))},number:Hn});const Yn=.95047,Zn=1.08883,Kn=4/29,Jn=6/29,Qn=3*Jn*Jn,ei=Jn*Jn*Jn,ti=Math.PI/180,ri=180/Math.PI;function ni(e){return e>ei?Math.pow(e,1/3):e/Qn+Kn}function ii(e){return e>Jn?e*e*e:Qn*(e-Kn)}function ai(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function oi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function si(e){const t=oi(e.r),r=oi(e.g),n=oi(e.b),i=ni((.4124564*t+.3575761*r+.1804375*n)/Yn),a=ni((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*a-16,a:500*(i-a),b:200*(a-ni((.0193339*t+.119192*r+.9503041*n)/Zn)),alpha:e.a}}function li(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*ii(t),r=Yn*ii(r),n=Zn*ii(n),new ar(ai(3.2404542*r-1.5371385*t-.4985314*n),ai(-.969266*r+1.8760108*t+.041556*n),ai(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function ui(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const ci={forward:si,reverse:li,interpolate:function(e,t,r){return{l:Hn(e.l,t.l,r),a:Hn(e.a,t.a,r),b:Hn(e.b,t.b,r),alpha:Hn(e.alpha,t.alpha,r)}}},di={forward:function(e){const{l:t,a:r,b:n}=si(e),i=Math.atan2(n,r)*ri;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ti,r=e.c;return li({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:ui(e.h,t.h,r),c:Hn(e.c,t.c,r),l:Hn(e.l,t.l,r),alpha:Hn(e.alpha,t.alpha,r)}}};var hi=Object.freeze({__proto__:null,hcl:di,lab:ci});class fi{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=pi(t,e.base,r,n);else if("linear"===e.name)i=pi(t,1,r,n);else if("cubic-bezier"===e.name){const a=e.controlPoints;i=new m(a[0],a[1],a[2],a[3]).solve(pi(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...a]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,Ft),!i)return null;const o=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=Ut:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<a.length;e+=2){const r=a[e],n=a[e+1],i=e+3,l=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const u=t.parse(n,l,s);if(!u)return null;s=s||u.type,o.push([r,u])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new fi(s,r,n,i,o):t.error(`Type ${Wt(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const a=zn(t,n),o=fi.interpolationFactor(this.interpolation,n,t[a],t[a+1]),s=r[a].evaluate(e),l=r[a+1].evaluate(e);return"interpolate"===this.operator?Xn[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?di.reverse(di.interpolate(di.forward(s),di.forward(l),o)):ci.reverse(ci.interpolate(ci.forward(s),ci.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function pi(e,t,r,n){const i=n-r,a=e-r;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}var mi=fi;class gi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const a=n&&i.some((e=>Yt(n,e.type)));return new gi(a?Gt:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof ur&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var _i=gi;class yi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const a=t.parse(e[n+1],n+1);if(!a)return null;r.push([i,a])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new yi(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var vi=yi;class bi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Ft),n=t.parse(e[2],2,Ht(t.expectedType||Gt));return r&&n?new bi(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new gr(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new gr(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new gr(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var xi=bi;class Ti{constructor(e,t){this.type=qt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Gt),n=t.parse(e[2],2,Gt);return r&&n?Zt(r.type,[qt,Nt,Ft,Bt,Gt])?new Ti(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Kt(t,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(hr(t))} instead.`);if(!Kt(r,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Wt(hr(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wi=Ti;class Ei{constructor(e,t,r){this.type=Ft,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Gt),n=t.parse(e[2],2,Gt);if(!r||!n)return null;if(!Zt(r.type,[qt,Nt,Ft,Bt,Gt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ft);return i?new Ei(r,n,i):null}return new Ei(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Kt(t,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(hr(t))} instead.`);if(!Kt(r,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Wt(hr(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ai=Ei;class Si{constructor(e,t,r,n,i,a){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},a=[];for(let o=2;o<e.length-1;o+=2){let s=e[o];const l=e[o+1];Array.isArray(s)||(s=[s]);const u=t.concat(o);if(0===s.length)return u.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,hr(e)))return null}else r=hr(e);if(void 0!==i[String(e)])return u.error("Branch labels must be unique.");i[String(e)]=a.length}const c=t.parse(l,o,n);if(!c)return null;n=n||c.type,a.push(c)}const o=t.parse(e[1],1,Gt);if(!o)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==o.type.kind&&t.concat(1).checkSubtype(r,o.type)?null:new Si(r,n,o,i,a,s):null}evaluate(e){const t=this.input.evaluate(e);return(hr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of r)e.push(1===n.length?i(n[0]):n.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var Pi=Si;class Mi{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let i=1;i<e.length-1;i+=2){const a=t.parse(e[i],i,qt);if(!a)return null;const o=t.parse(e[i+1],i+1,r);if(!o)return null;n.push([a,o]),r=r||o.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new Mi(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ri=Mi;class Ci{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Gt),n=t.parse(e[2],2,Ft);if(!r||!n)return null;if(!Zt(r.type,[Ht(Gt),Nt,Gt]))return t.error(`Expected first argument to be of type array or string, but found ${Wt(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ft);return i?new Ci(r.type,r,n,i):null}return new Ci(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Kt(t,["string","array"]))throw new gr(`Expected first argument to be of type array or string, but found ${Wt(hr(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Oi=Ci;function Li(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Ii(e,t,r,n){return 0===n.compare(t,r)}function Di(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=qt,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let a=t.parse(e[1],1,Gt);if(!a)return null;if(!Li(r,a.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${Wt(a.type)}'.`);let o=t.parse(e[2],2,Gt);if(!o)return null;if(!Li(r,o.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${Wt(o.type)}'.`);if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${Wt(a.type)}' and '${Wt(o.type)}'.`);n&&("value"===a.type.kind&&"value"!==o.type.kind?a=new vr(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new vr(a.type,[o])));let s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,zt),!s)return null}return new i(a,o,s)}evaluate(i){const a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=hr(a),r=hr(o);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new gr(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=hr(a),r=hr(o);if("string"!==e.kind||"string"!==r.kind)return t(i,a,o)}return this.collator?r(i,a,o,this.collator.evaluate(i)):t(i,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const ki=Di("==",(function(e,t,r){return t===r}),Ii),Bi=Di("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!Ii(0,t,r,n)})),Fi=Di("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),Ni=Di(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),qi=Di("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),Ui=Di(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class ji{constructor(e,t,r,n,i,a){this.type=Nt,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=a}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Ft);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,Nt),!i))return null;let a=null;if(n.currency&&(a=t.parse(n.currency,1,Nt),!a))return null;let o=null;if(n.unit&&(o=t.parse(n.unit,1,Nt),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parse(n["min-fraction-digits"],1,Ft),!s))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parse(n["max-fraction-digits"],1,Ft),!l)?null:new ji(r,i,a,o,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Gi{constructor(e){this.type=Ft,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${Wt(r.type)} instead.`):new Gi(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new gr(`Expected value to be of type string or array, but found ${Wt(hr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function zi(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Vi={"==":ki,"!=":Bi,">":Ni,"<":Fi,">=":Ui,"<=":qi,array:vr,at:xi,boolean:vr,case:Ri,coalesce:_i,collator:Cr,format:br,image:xr,in:wi,"index-of":Ai,interpolate:mi,"interpolate-hcl":mi,"interpolate-lab":mi,length:Gi,let:vi,literal:mr,match:Pi,number:vr,"number-format":ji,object:vr,slice:Oi,step:$n,string:vr,"to-boolean":Ar,"to-color":Ar,"to-number":Ar,"to-string":Ar,var:qn,within:Jr,distance:In};function $i(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const a=i?i.evaluate(e):1,o=cr(t,r,n,a);if(o)throw new gr(o);return new ar(t/255*a,r/255*a,n/255*a,a)}function Hi(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const a=i?i.evaluate(e):1,o=function(e,t,r,n){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'h' must be between 0 and 360.`}(t,r,n,a);if(o)throw new gr(o);const s=`hsla(${t}, ${r}%, ${n}%, ${a})`,l=ar.parse(s);if(!l)throw new gr(`Failed to parse HSLA color: ${s}`);return l}function Wi(e,t){return e in t}function Xi(e,t){const r=t[e];return void 0===r?null:r}function Yi(e,t,r){r.length&&(t+=`${r}`);const n=e.getConfig(t);return n?n.evaluate(e):null}function Zi(e){return{type:e}}Rr.register(Vi,{error:[{kind:"error"},[Nt],(e,[t])=>{throw new gr(t.evaluate(e))}],typeof:[Nt,[Gt],(e,[t])=>Wt(hr(t.evaluate(e)))],"to-rgba":[Ht(Ft,4),[Ut],(e,[t])=>t.evaluate(e).toArray()],rgb:[Ut,[Ft,Ft,Ft],$i],rgba:[Ut,[Ft,Ft,Ft,Ft],$i],hsl:[Ut,[Ft,Ft,Ft],Hi],hsla:[Ut,[Ft,Ft,Ft,Ft],Hi],has:{type:qt,overloads:[[[Nt],(e,[t])=>Wi(t.evaluate(e),e.properties())],[[Nt,jt],(e,[t,r])=>Wi(t.evaluate(e),r.evaluate(e))]]},get:{type:Gt,overloads:[[[Nt],(e,[t])=>Xi(t.evaluate(e),e.properties())],[[Nt,jt],(e,[t,r])=>Xi(t.evaluate(e),r.evaluate(e))]]},config:{type:Gt,overloads:[[[Nt],(e,[t])=>Yi(e,t.evaluate(e),"")],[[Nt,Nt],(e,[t,r])=>Yi(e,t.evaluate(e),r.evaluate(e))]]},"feature-state":[Gt,[Nt],(e,[t])=>Xi(t.evaluate(e),e.featureState||{})],properties:[jt,[],e=>e.properties()],"geometry-type":[Nt,[],e=>e.geometryType()],id:[Gt,[],e=>e.id()],zoom:[Ft,[],e=>e.globals.zoom],pitch:[Ft,[],e=>e.globals.pitch||0],"distance-from-center":[Ft,[],e=>e.distanceFromCenter()],"measure-light":[Ft,[Nt],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Ft,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ft,[],e=>e.globals.lineProgress||0],"raster-value":[Ft,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Ft,[],e=>e.globals.skyRadialProgress||0],accumulated:[Gt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ft,Zi(Ft),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[Ft,Zi(Ft),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:Ft,overloads:[[[Ft,Ft],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[Ft],(e,[t])=>-t.evaluate(e)]]},"/":[Ft,[Ft,Ft],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[Ft,[Ft,Ft],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[Ft,[],()=>Math.LN2],pi:[Ft,[],()=>Math.PI],e:[Ft,[],()=>Math.E],"^":[Ft,[Ft,Ft],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[Ft,[Ft],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ft,[Ft],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ft,[Ft],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ft,[Ft],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ft,[Ft],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ft,[Ft],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ft,[Ft],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ft,[Ft],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ft,[Ft],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ft,[Ft],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ft,Zi(Ft),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ft,Zi(Ft),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ft,[Ft],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ft,[Ft],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ft,[Ft],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ft,[Ft],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[qt,[Nt,Gt],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[qt,[Gt],(e,[t])=>e.id()===t.value],"filter-type-==":[qt,[Nt],(e,[t])=>e.geometryType()===t.value],"filter-<":[qt,[Nt,Gt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[qt,[Gt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[qt,[Nt,Gt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[qt,[Gt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[qt,[Nt,Gt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[qt,[Gt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[qt,[Nt,Gt],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[qt,[Gt],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[qt,[Gt],(e,[t])=>t.value in e.properties()],"filter-has-id":[qt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[qt,[Ht(Nt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[qt,[Ht(Gt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[qt,[Nt,Ht(Gt)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[qt,[Nt,Ht(Gt)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Zi(qt),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Zi(qt),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[qt,[qt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[qt,[Nt],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[Nt,[Nt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Nt,[Nt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Nt,Zi(Gt),(e,t)=>t.map((t=>fr(t.evaluate(e)))).join("")],"resolved-locale":[Nt,[zt],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Ft,[Ft,Ft,Gt],(e,t)=>{const[r,n,i]=t.map((t=>t.evaluate(e)));if(r>n)return r;if(r===n)return r;let a;if("string"==typeof i)a=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}(i);else{if("number"!=typeof i)throw new gr(`Invalid seed input: ${i}`);a=i}return r+zi(a)()*(n-r)}]});var Ki=Vi;function Ji(e){return{result:"success",value:e}}function Qi(e){return{result:"error",value:e}}function ea(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function ta(e){return"data-driven"===e["property-type"]}function ra(e){return ea(e.expression,"measure-light")}function na(e){return ea(e.expression,"zoom")}function ia(e){return!!e.expression&&e.expression.interpolated}function aa(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function oa(e){return e}function sa(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),a=e.type||(ia(t)?"exponential":"interval");if(r&&((e=Rt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],ar.parse(e[1])]))),e.default=ar.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!hi[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let o,s,l;if("exponential"===a)o=da;else if("interval"===a)o=ca;else if("categorical"===a){o=ua,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);o=ha}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],a=i[0].zoom;void 0===r[a]&&(r[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},n.push(a)),r[a].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,sa(r[e],t)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:mi.interpolationFactor.bind(void 0,a),zoomStops:i.map((e=>e[0])),evaluate:({zoom:r},n)=>da({stops:i,base:e.base},t,r).evaluate(r,n)}}if(i){const r="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:mi.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>o(e,t,r,s,l)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?la(e.default,t.default):o(e,t,i,s,l)}}}function la(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function ua(e,t,r,n,i){return la(typeof r===i?n[r]:void 0,e.default,t.default)}function ca(e,t,r){if("number"!==Tr(r))return la(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=zn(e.stops.map((e=>e[0])),r);return e.stops[i][1]}function da(e,t,r){const n=void 0!==e.base?e.base:1;if("number"!==Tr(r))return la(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const a=zn(e.stops.map((e=>e[0])),r),o=function(e,t,r,n){const i=n-r,a=e-r;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1];let u=Xn[t.type]||oa;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=hi[e.colorSpace];u=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),o))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==r)return u(t,r,o)}}:u(s,l,o)}function ha(e,t,r){return"color"===t.type?r=ar.parse(r):"formatted"===t.type?r=lr.fromString(r.toString()):"resolvedImage"===t.type?r=ur.fromString(r.toString()):Tr(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),la(r,e.default,t.default)}class fa{constructor(e,t,r){this.expression=e,this._warningHistory={},this._evaluator=new Pr(r),this._defaultValue=t?function(e){return"color"===e.type&&(aa(e.default)||Array.isArray(e.default))?new ar(0,0,0,0):"color"===e.type?ar.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,a,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,a,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new gr(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function pa(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ki}function ma(e,t,r){const n=new jn(Ki,[],t?function(e){const t={color:Ut,string:Nt,number:Ft,enum:Nt,boolean:qt,formatted:Vt,resolvedImage:$t};return"array"===e.type?Ht(t[e.value]||Gt,e.length):t[e.type]}(t):void 0,void 0,void 0,r),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Ji(new fa(i,t,r)):Qi(n.errors)}class ga{constructor(e,t,r){this.kind=e,this._styleExpression=t,this.isLightConstant=r,this.isStateDependent="constant"!==e&&!kn(t.expression),this.isConfigDependent=!Bn(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,a)}evaluate(e,t,r,n,i,a){return this._styleExpression.evaluate(e,t,r,n,i,a)}}class _a{constructor(e,t,r,n,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!kn(t.expression),this.isLightConstant=i,this.isConfigDependent=!Bn(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,a)}evaluate(e,t,r,n,i,a){return this._styleExpression.evaluate(e,t,r,n,i,a)}interpolationFactor(e,t,r){return this.interpolationType?mi.interpolationFactor(this.interpolationType,e,t,r):0}}function ya(e,t,r){if("error"===(e=ma(e,t,r)).result)return e;const n=e.value.expression,i=Dn(n);if(!i&&!ta(t))return Qi([new It("","data expressions not supported")]);const a=Fn(n,["zoom","pitch","distance-from-center"]);if(!a&&!na(t))return Qi([new It("","zoom expressions not supported")]);const o=Fn(n,["measure-light"]);if(!o&&!ra(t))return Qi([new It("","measure-light expression not supported")]);const s=t.expression&&t.expression.relaxZoomRestriction,l=ba(n);return l||a||s?l instanceof It?Qi([l]):l instanceof mi&&!ia(t)?Qi([new It("",'"interpolate" expressions cannot be used with this property')]):Ji(l?new _a(i?"camera":"composite",e.value,l.labels,l instanceof mi?l.interpolation:void 0,o):new ga(i?"constant":"source",e.value,o)):Qi([new It("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class va{constructor(e,t){this._parameters=e,this._specification=t,Rt(this,sa(this._parameters,this._specification))}static deserialize(e){return new va(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ba(e){let t=null;if(e instanceof vi)t=ba(e.result);else if(e instanceof _i){for(const r of e.args)if(t=ba(r),t)break}else(e instanceof $n||e instanceof mi)&&e.input instanceof Rr&&"zoom"===e.input.name&&(t=e);return t instanceof It||e.eachChild((e=>{const r=ba(e);r instanceof It?t=r:t&&r&&t!==r&&(t=new It("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function xa(e){const t=e.key,r=e.value,n=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,o=e.styleSpec;let s=[];const l=Tr(r);if("object"!==l)return[new Pt(t,r,`object expected, ${l} found`)];for(const e in r){const l=e.split(".")[0];let u;i[l]?u=i[l]:n[l]?u=no:i["*"]?u=i["*"]:n["*"]&&(u=no),u?s=s.concat(u({key:(t?`${t}.`:t)+e,value:r[e],valueSpec:n[l]||n["*"],style:a,styleSpec:o,object:r,objectKey:e},r)):s.push(new Mt(t,r[e],`unknown property "${e}"`))}for(const e in n)i[e]||n[e].required&&void 0===n[e].default&&void 0===r[e]&&s.push(new Pt(t,r,`missing required property "${e}"`));return s}function Ta(e){const t=e.value,r=e.valueSpec,n=e.style,i=e.styleSpec,a=e.key,o=e.arrayElementValidator||no;if("array"!==Tr(t))return[new Pt(a,t,`array expected, ${Tr(t)} found`)];if(r.length&&t.length!==r.length)return[new Pt(a,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Pt(a,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let s={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};i.$version<7&&(s.function=r.function),"object"===Tr(r.value)&&(s=r.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(o({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:n,styleSpec:i,key:`${a}[${e}]`},!0));return l}function wa(e){const t=e.key,r=e.value,n=e.valueSpec;let i=Tr(r);if("number"===i&&r!=r&&(i="NaN"),"number"!==i)return[new Pt(t,r,`number expected, ${i} found`)];if("minimum"in n){let i=n.minimum;if("array"===Tr(n.minimum)&&(i=n.minimum[e.arrayIndex]),r<i)return[new Pt(t,r,`${r} is less than the minimum value ${i}`)]}if("maximum"in n){let i=n.maximum;if("array"===Tr(n.maximum)&&(i=n.maximum[e.arrayIndex]),r>i)return[new Pt(t,r,`${r} is greater than the maximum value ${i}`)]}return[]}function Ea(e){const t=e.valueSpec,r=Ct(e.value.type);let n,i,a,o={};const s="categorical"!==r&&void 0===e.value.property,l=!s,u="array"===Tr(e.value.stops)&&"array"===Tr(e.value.stops[0])&&"object"===Tr(e.value.stops[0][0]),c=xa({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new Pt(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Ta({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),"array"===Tr(n)&&0===n.length&&t.push(new Pt(e.key,n,"array must have at least one stop")),t},default:function(e){return no({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&s&&c.push(new Pt(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||c.push(new Pt(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!ia(e.valueSpec)&&c.push(new Pt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!ta(e.valueSpec)?c.push(new Pt(e.key,e.value,"property functions not supported")):s&&!na(e.valueSpec)&&c.push(new Pt(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==e.value.property||c.push(new Pt(e.key,e.value,'"property" property is required')),c;function d(e){let r=[];const n=e.value,s=e.key;if("array"!==Tr(n))return[new Pt(s,n,`array expected, ${Tr(n)} found`)];if(2!==n.length)return[new Pt(s,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==Tr(n[0]))return[new Pt(s,n,`object expected, ${Tr(n[0])} found`)];if(void 0===n[0].zoom)return[new Pt(s,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Pt(s,n,"object stop key must have value")];const t=Ct(n[0].zoom);if("number"!=typeof t)return[new Pt(s,n[0].zoom,"stop zoom values must be numbers")];if(a&&a>t)return[new Pt(s,n[0].zoom,"stop zoom values must appear in ascending order")];t!==a&&(a=t,i=void 0,o={}),r=r.concat(xa({key:`${s}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:wa,value:h}}))}else r=r.concat(h({key:`${s}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return pa(Ot(n[1]))?r.concat([new Pt(`${s}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(no({key:`${s}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function h(e,a){const s=Tr(e.value),l=Ct(e.value),u=null!==e.value?e.value:a;if(n){if(s!==n)return[new Pt(e.key,u,`${s} stop domain type must match previous stop domain type ${n}`)]}else n=s;if("number"!==s&&"string"!==s&&"boolean"!==s&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Pt(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==r){let n=`number expected, ${s} found`;return ta(t)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(e.key,u,n)]}return"categorical"!==r||"number"!==s||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===s&&"number"==typeof l&&"number"==typeof i&&void 0!==i&&l<i?[new Pt(e.key,u,"stop domain values must appear in ascending order")]:(i=l,"categorical"===r&&l in o?[new Pt(e.key,u,"stop domain values must be unique")]:(o[l]=!0,[])):[new Pt(e.key,u,`integer expected, found ${String(l)}`)]}}function Aa(e){const t=("property"===e.expressionContext?ya:ma)(Ot(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Pt(`${e.key}${t.key}`,e.value,t.message)));const r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Pt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!kn(r))return[new Pt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Sa(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Fn(r,["zoom","feature-state"]))return[new Pt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Dn(r))return[new Pt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sa(e,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return e instanceof Rr&&r.has(e.name)?[new Pt(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...Sa(e,t))})),n)}function Pa(e){const t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Ct(r))&&i.push(new Pt(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(Ct(r))&&i.push(new Pt(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function Ma(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ma(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Ra(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ma(e)||(e=Ba(e));const r=e;let n=!0;try{n=function(e){if(!La(e))return e;let t=Ot(e);return Oa(t),t=Ca(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via /tianjingmap-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=St[`filter_${t}`],a=ma(n,i);let o=null;if("error"===a.result)throw new Error(a.value.map((e=>`${e.key}: ${e.message}`)).join(", "));o=(e,t,r)=>a.value.evaluate(e,t,{},r);let s=null,l=null;if(n!==r){const e=ma(r,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,r,n,i,a)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,a),l=!Dn(e.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:ka(n),needFeature:!!l}}function Ca(e){if(!Array.isArray(e))return e;const t=function(e){if(Ia.has(e[0]))for(let t=1;t<e.length;t++)if(La(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Ca(e)))}function Oa(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||La(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||La(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||La(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let t=1;t<e.length;t++)Oa(e[t])}function La(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(La(e[t]))return!0;return!1}const Ia=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Da(e,t){return e<t?-1:e>t?1:0}function ka(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(ka(e[t]))return!0;return!1}function Ba(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Fa(e[1],e[2],"=="):"!="===t?Ua(Fa(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Fa(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Ba))):"all"===t?["all"].concat(e.slice(1).map(Ba)):"none"===t?["all"].concat(e.slice(1).map(Ba).map(Ua)):"in"===t?Na(e[1],e.slice(2)):"!in"===t?Ua(Na(e[1],e.slice(2))):"has"===t?qa(e[1]):"!has"!==t||Ua(qa(e[1]));var r}function Fa(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function Na(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Da)]]:["filter-in-small",e,["literal",t]]}}function qa(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ua(e){return["!",e]}function ja(e){return Ma(Ot(e.value))?Aa(Rt({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Ga(e)}function Ga(e){const t=e.value,r=e.key;if("array"!==Tr(t))return[new Pt(r,t,`array expected, ${Tr(t)} found`)];const n=e.styleSpec;let i,a=[];if(t.length<1)return[new Pt(r,t,"filter array must have at least 1 element")];switch(a=a.concat(Pa({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ct(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ct(t[1])&&a.push(new Pt(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&a.push(new Pt(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Tr(t[1]),"string"!==i&&a.push(new Pt(`${r}[1]`,t[1],`string expected, ${i} found`)));for(let o=2;o<t.length;o++)i=Tr(t[o]),"$type"===Ct(t[1])?a=a.concat(Pa({key:`${r}[${o}]`,value:t[o],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Pt(`${r}[${o}]`,t[o],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)a=a.concat(Ga({key:`${r}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Tr(t[1]),2!==t.length?a.push(new Pt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&a.push(new Pt(`${r}[1]`,t[1],`string expected, ${i} found`))}return a}function za(e,t){const r=e.key,n=e.style,i=e.layer,a=e.styleSpec,o=e.value,s=e.objectKey,l=a[`${t}_${e.layerType}`];if(!l)return[];const u=s.match(/^(.*)-transition$/);if("paint"===t&&u&&l[u[1]]&&l[u[1]].transition)return no({key:r,value:o,valueSpec:a.transition,style:n,styleSpec:a});const c=e.valueSpec||l[s];if(!c)return[new Mt(r,o,`unknown property "${s}"`)];let d;if("string"===Tr(o)&&ta(c)&&!c.tokens&&(d=/^{([^}]+)}$/.exec(o))){const e=`\`{ "type": "identity", "property": ${d?JSON.stringify(d[1]):'"_"'} }\``;return[new Pt(r,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const h=[];if("symbol"===e.layerType)"text-field"!==s||!n||n.glyphs||n.imports||h.push(new Pt(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&aa(Ot(o))&&"identity"===Ct(o.type)&&h.push(new Pt(r,o,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&i&&i.layout&&i.layout.hasOwnProperty("model-id")&&ta(c)&&(ra(c)||na(c))){const e=ya(Ot(o),c),t=e.value.expression||e.value._styleExpression.expression;t&&!Fn(t,["measure-light"])&&h.push(new Pt(r,o,`${s} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return h.concat(no({key:e.key,value:o,valueSpec:c,style:n,styleSpec:a,expressionContext:"property",propertyType:t,propertyKey:s}))}function Va(e){return za(e,"paint")}function $a(e){return za(e,"layout")}function Ha(e){let t=[];const r=e.value,n=e.key,i=e.style,a=e.styleSpec;r.type||r.ref||t.push(new Pt(n,r,'either "type" or "ref" is required'));let o=Ct(r.type);const s=Ct(r.ref);if(r.id){const a=Ct(r.id);for(let o=0;o<e.arrayIndex;o++){const e=i.layers[o];Ct(e.id)===a&&t.push(new Pt(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in r&&t.push(new Pt(n,r[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{Ct(t.id)===s&&(e=t)})),e?e.ref?t.push(new Pt(n,r.ref,"ref cannot reference another ref layer")):o=Ct(e.type):"string"==typeof s&&t.push(new Pt(n,r.ref,`ref layer "${s}" not found`))}else if("background"!==o&&"sky"!==o&&"slot"!==o)if(r.source){const e=i.sources&&i.sources[r.source],a=e&&Ct(e.type);e?"vector"===a&&"raster"===o?t.push(new Pt(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===a&&"raster"!==o?t.push(new Pt(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==a||r["source-layer"]?"raster-dem"===a&&"hillshade"!==o?t.push(new Pt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===a&&e.lineMetrics||t.push(new Pt(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Pt(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Pt(n,r.source,`source "${r.source}" not found`))}else t.push(new Pt(n,r,'missing required property "source"'));return t=t.concat(xa({key:n,value:r,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>no({key:`${n}.type`,value:r.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:e=>ja(Rt({layerType:o},e)),layout:e=>xa({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>$a(Rt({layerType:o},e))}}),paint:e=>xa({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Va(Rt({layerType:o,layer:r},e))}})}})),t}function Wa(e){const t=e.value,r=e.key,n=Tr(t);return"string"!==n?[new Pt(r,t,`string expected, ${n} found`)]:[]}const Xa={promoteId:function({key:e,value:t}){if("string"===Tr(t))return Wa({key:e,value:t});{const r=[];for(const n in t)r.push(...Wa({key:`${e}.${n}`,value:t[n]}));return r}}};function Ya(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style;if(!t.type)return[new Pt(r,t,'"type" is required')];const a=Ct(t.type);let o;switch(a){case"vector":case"raster":case"raster-dem":return o=xa({key:r,value:t,valueSpec:n[`source_${a.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Xa}),o;case"geojson":if(o=xa({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:Xa}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],a="string"==typeof n?[n,["accumulated"],["get",e]]:n;o.push(...Aa({key:`${r}.${e}.map`,value:i,expressionContext:"cluster-map"})),o.push(...Aa({key:`${r}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return o;case"video":return xa({key:r,value:t,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return xa({key:r,value:t,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Pt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pa({key:`${r}.type`,value:t.type,valueSpec:{values:Za(n)},style:i,styleSpec:n})}}function Za(e){return e.source.reduce(((t,r)=>{const n=e[r];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values))),t}),[])}function Ka(e){const t=e.value;let r=[];if(!t)return r;const n=Tr(t);return"string"!==n?(r=r.concat([new Pt(e.key,t,`string expected, "${n}" found`)]),r):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(t)||(r=r.concat([new Pt(e.key,t,`invalid url "${t}"`)])),r)}function Ja(e){const t=e.value,r=e.styleSpec,n=r.light,i=e.style;let a=[];const o=Tr(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Pt("light",t,`object expected, ${o} found`)]),a;for(const e in t){const o=e.match(/^(.*)-transition$/);a=a.concat(o&&n[o[1]]&&n[o[1]].transition?no({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):n[e]?no({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}):[new Pt(e,t[e],`unknown property "${e}"`)])}return a}function Qa(e){const t=e.value;let r=[];if(!t)return r;const n=Tr(t);if("object"!==n)return r=r.concat([new Pt("light-3d",t,`object expected, ${n} found`)]),r;const i=e.styleSpec,a=i["light-3d"],o=e.key,s=e.style,l=e.style.lights;for(const e of["type","id"])if(!(e in t))return r=r.concat([new Pt("light-3d",t,`missing property ${e} on light`)]),r;if(t.type&&l)for(let n=0;n<e.arrayIndex;n++){const e=Ct(t.type),i=l[n];Ct(i.type)===e&&r.push(new Pt(o,t.id,`duplicate light type "${t.type}", previously defined at line ${i.id.__line__}`))}const u=`properties_light_${t.type}`;if(!(u in i))return r=r.concat([new Pt("light-3d",t,`Invalid light type ${t.type}`)]),r;const c=i[u];for(const n in t)if("properties"===n){const a=t[n],o=Tr(a);if("object"!==o)return r=r.concat([new Pt("properties",a,`object expected, ${o} found`)]),r;for(const t in a)r=r.concat(c[t]?no({key:t,value:a[t],valueSpec:c[t],style:s,styleSpec:i}):[new Mt(e.key,a[t],`unknown property "${t}"`)])}else{const e=n.match(/^(.*)-transition$/);r=r.concat(e&&a[e[1]]&&a[e[1]].transition?no({key:n,value:t[n],valueSpec:i.transition,style:s,styleSpec:i}):a[n]?no({key:n,value:t[n],valueSpec:a[n],style:s,styleSpec:i}):[new Mt(n,t[n],`unknown property "${n}"`)])}return r}function eo(e){const t=e.value,r=e.key,n=e.style,i=e.styleSpec,a=i.terrain;let o=[];const s=Tr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Pt("terrain",t,`object expected, ${s} found`)]),o;for(const e in t){const r=e.match(/^(.*)-transition$/);o=o.concat(r&&a[r[1]]&&a[r[1]].transition?no({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):a[e]?no({key:e,value:t[e],valueSpec:a[e],style:n,styleSpec:i}):[new Mt(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],i=e&&Ct(e.type);e?"raster-dem"!==i&&o.push(new Pt(r,t.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):o.push(new Pt(r,t.source,`source "${t.source}" not found`))}else o.push(new Pt(r,t,'terrain is missing required property "source"'));return o}function to(e){const t=e.value,r=e.style,n=e.styleSpec,i=n.fog;let a=[];const o=Tr(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Pt("fog",t,`object expected, ${o} found`)]),a;for(const e in t){const o=e.match(/^(.*)-transition$/);a=a.concat(o&&i[o[1]]&&i[o[1]].transition?no({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):i[e]?no({key:e,value:t[e],valueSpec:i[e],style:r,styleSpec:n}):[new Mt(e,t[e],`unknown property "${e}"`)])}return a}const ro={"*":()=>[],array:Ta,boolean:function(e){const t=e.value,r=e.key,n=Tr(t);return"boolean"!==n?[new Pt(r,t,`boolean expected, ${n} found`)]:[]},number:wa,color:function(e){const t=e.key,r=e.value,n=Tr(r);return"string"!==n?[new Pt(t,r,`color expected, ${n} found`)]:null===Jt(r)?[new Pt(t,r,`color expected, "${r}" found`)]:[]},enum:Pa,filter:ja,function:Ea,layer:Ha,object:xa,source:Ya,model:Ka,light:Ja,"light-3d":Qa,terrain:eo,fog:to,string:Wa,formatted:function(e){return 0===Wa(e).length?[]:Aa(e)},resolvedImage:function(e){return 0===Wa(e).length?[]:Aa(e)},projection:function(e){const t=e.value,r=e.styleSpec,n=r.projection,i=e.style;let a=[];const o=Tr(t);if("object"===o)for(const e in t)a=a.concat(no({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}));else"string"!==o&&(a=a.concat([new Pt("projection",t,`object or string expected, ${o} found`)]));return a},import:function(e){const{value:t,styleSpec:r}=e,{data:n,...i}=t;Object.defineProperty(i,"__line__",{value:t.__line__,enumerable:!1});let a=xa(Rt({},e,{value:i,valueSpec:r.import}));return""===Ct(i.id)&&a.push(new Pt(`${e.key}.id`,i,"import id can't be an empty string")),n&&(a=a.concat(ao(n,r,{key:`${e.key}.data`}))),a}};function no(e,t=!1){const r=e.value,n=e.valueSpec,i=e.styleSpec;if(n.expression&&aa(Ct(r)))return Ea(e);if(n.expression&&pa(Ot(r)))return Aa(e);if(n.type&&ro[n.type]){const r=ro[n.type](e);return!0===t&&r.length>0&&"array"===Tr(e.value)?Aa(e):r}return xa(Rt({},e,{valueSpec:n.type?i[n.type]:n}))}function io(e){const t=e.value,r=e.key,n=Wa(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Pt(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Pt(r,t,'"glyphs" url must include a "{range}" token'))),n}function ao(e,t=St,r={}){return no({key:r.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:io,"*":()=>[]}})}function oo(e,t=St){return yo(ao(e,t))}const so=e=>yo(Ya(e)),lo=e=>yo(Ja(e)),uo=e=>yo(Qa(e)),co=e=>yo(eo(e)),ho=e=>yo(to(e)),fo=e=>yo(Ha(e)),po=e=>yo(ja(e)),mo=e=>yo(Va(e)),go=e=>yo($a(e)),_o=e=>yo(Ka(e));function yo(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function vo(e,t){let r=!1;if(t&&t.length)for(const n of t)n instanceof Mt?X(n.message):(e.fire(new Et(new Error(n.message))),r=!0);return r}var bo=To,xo=3;function To(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(r=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[xo+a],s=i[xo+a+1];n.push(o===s?null:i.subarray(o,s))}var l=i[xo+n.length+1];this.keys=i.subarray(i[xo+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var c=r/t*e;this.min=-c,this.max=e+c}To.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},To.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},To.prototype._insertCell=function(e,t,r,n,i,a){this.cells[i].push(a)},To.prototype.query=function(e,t,r,n,i){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,r,n,this._queryCell,s,{},i),s},To.prototype._queryCell=function(e,t,r,n,i,a,o,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,d=0;d<l.length;d++){var h=l[d];if(void 0===o[h]){var f=4*h;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):e<=c[f+2]&&t<=c[f+3]&&r>=c[f+0]&&n>=c[f+1])?(o[h]=!0,a.push(u[h])):o[h]=!1}}},To.prototype._forEachCell=function(e,t,r,n,i,a,o,s){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(r),d=this._convertToCellCoord(n),h=l;h<=c;h++)for(var f=u;f<=d;f++){var p=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&i.call(this,e,t,r,n,p,a,o,s))return}},To.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},To.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},To.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=xo+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];i[xo+o]=a,i.set(s,a),a+=s.length}return i[xo+e.length]=a,i.set(this.keys,a),i[xo+e.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var wo=h(bo);const Eo={};function Ao(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Eo[t]={klass:e,omit:r.omit||[]}}Ao(Object,"Object"),wo.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},wo.deserialize=function(e){return new wo(e.buffer)},Object.defineProperty(wo,"name",{value:"Grid"}),Ao(wo,"Grid"),Ao(ar,"Color"),Ao(Error,"Error"),Ao(ve,"AJAXError"),Ao(ur,"ResolvedImage"),Ao(va,"StylePropertyFunction"),Ao(fa,"StyleExpression",{omit:["_evaluator"]}),Ao(_a,"ZoomDependentExpression"),Ao(ga,"ZoomConstantExpression"),Ao(Rr,"CompoundExpression",{omit:["_evaluate"]});for(const e in Ki)Eo[Ki[e]._classRegistryKey]||Ao(Ki[e],`Expression${e}`);function So(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Po(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Mo(e,r){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(So(e)||Po(e))return r&&r.add(e),e;if(ArrayBuffer.isView(e)){const t=e;return r&&r.add(t.buffer),t}if(e instanceof t.ImageData)return r&&r.add(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const n of e)t.push(Mo(n,r));return t}if(e instanceof Map){const t={$name:"Map"};for(const[r,n]of e.entries())t[r]=Mo(n);return t}if("object"==typeof e){const t=e.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const i=t.serialize?t.serialize(e,r):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(Eo[n].omit.indexOf(t)>=0||(i[t]=Mo(e[t],r)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function Ro(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||So(e)||Po(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Ro);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const r of Object.keys(e))"$name"!==r&&t.set(r,Ro(e[r]));return t}const{klass:r}=Eo[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=Ro(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}const Co={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Oo(e){for(const t of e)if(Do(t.charCodeAt(0)))return!0;return!1}function Lo(e){for(const t of e)if(!Io(t.charCodeAt(0)))return!1;return!0}function Io(e){return!(Co.Arabic(e)||Co["Arabic Supplement"](e)||Co["Arabic Extended-A"](e)||Co["Arabic Presentation Forms-A"](e)||Co["Arabic Presentation Forms-B"](e))}function Do(e){return!(746!==e&&747!==e&&(e<4352||!(Co["Bopomofo Extended"](e)||Co.Bopomofo(e)||Co["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Co["CJK Compatibility Ideographs"](e)||Co["CJK Compatibility"](e)||Co["CJK Radicals Supplement"](e)||Co["CJK Strokes"](e)||!(!Co["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Co["CJK Unified Ideographs Extension A"](e)||Co["CJK Unified Ideographs"](e)||Co["Enclosed CJK Letters and Months"](e)||Co["Hangul Compatibility Jamo"](e)||Co["Hangul Jamo Extended-A"](e)||Co["Hangul Jamo Extended-B"](e)||Co["Hangul Jamo"](e)||Co["Hangul Syllables"](e)||Co.Hiragana(e)||Co["Ideographic Description Characters"](e)||Co.Kanbun(e)||Co["Kangxi Radicals"](e)||Co["Katakana Phonetic Extensions"](e)||Co.Katakana(e)&&12540!==e||!(!Co["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Co["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Co["Unified Canadian Aboriginal Syllabics"](e)||Co["Unified Canadian Aboriginal Syllabics Extended"](e)||Co["Vertical Forms"](e)||Co["Yijing Hexagram Symbols"](e)||Co["Yi Syllables"](e)||Co["Yi Radicals"](e))))}function ko(e){return!(Do(e)||function(e){return!!(Co["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Co["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Co["Letterlike Symbols"](e)||Co["Number Forms"](e)||Co["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Co["Control Pictures"](e)&&9251!==e||Co["Optical Character Recognition"](e)||Co["Enclosed Alphanumerics"](e)||Co["Geometric Shapes"](e)||Co["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Co["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Co["CJK Symbols and Punctuation"](e)||Co.Katakana(e)||Co["Private Use Area"](e)||Co["CJK Compatibility Forms"](e)||Co["Small Form Variants"](e)||Co["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Bo(e){return e>=1424&&e<=2303||Co["Arabic Presentation Forms-A"](e)||Co["Arabic Presentation Forms-B"](e)}function Fo(e,t){return!(!t&&Bo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Co.Khmer(e))}function No(e){for(const t of e)if(Bo(t.charCodeAt(0)))return!0;return!1}const qo="deferred",Uo="loading",jo="loaded";let Go=null,zo="unavailable",Vo=null;const $o=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(zo="error"),Go&&Go(e)};function Ho(){Wo.fire(new wt("pluginStateChange",{pluginStatus:zo,pluginURL:Vo}))}const Wo=new At,Xo=function(){return zo},Yo=function(){if(zo!==qo||!Vo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zo=Uo,Ho(),Vo&&we({url:Vo},(e=>{e?$o(e):(zo=jo,Ho())}))},Zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>zo===jo||null!=Zo.applyArabicShaping,isLoading:()=>zo===Uo,setState(e){zo=e.pluginStatus,Vo=e.pluginURL},isParsed:()=>null!=Zo.applyArabicShaping&&null!=Zo.processBidirectionalText&&null!=Zo.processStyledBidirectionalText,getPluginURL:()=>Vo};class Ko{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!Fo(r.charCodeAt(0),t))return!1;return!0}(e,Zo.isLoaded())}}class Jo{constructor(e,t,r){this.property=e,this.value=t,this.expression=function(e,t,r){if(aa(e))return new va(e,t);if(pa(e)||Array.isArray(e)&&e.length>0){const n=ya(e,t,r);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=ar.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Qo{constructor(e,t){this.property=e,this.value=new Jo(e,void 0,t)}transitioned(e,t){return new ts(this.property,this.value,t,k({},e.transition,this.transition),e.now)}untransitioned(){return new ts(this.property,this.value,null,{},0)}}class es{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return H(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qo(this._values[e].property,this._options)),this._values[e].value=new Jo(this._values[e].property,null===t?void 0:H(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const r=this._properties.properties;if(e)for(const t in e){const n=e[t];if(z(t,"-transition")){const e=t.slice(0,-11);r[e]&&this.setTransition(e,n)}else r[t]&&this.setValue(t,n)}}getTransition(e){return H(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Qo(this._values[e].property)),this._values[e].transition=H(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const r=new rs(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new rs(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ts{constructor(e,t,r,n,i){const a=n.delay||0,o=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+a,this.end=this.begin+o,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return a.possiblyEvaluate(e,t,r);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,r),i,A(o))}}return i}}class rs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new as(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ns{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return H(this._values[e].value)}setValue(e,t){this._values[e]=new Jo(this._values[e].property,null===t?void 0:H(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const n=new as(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class is{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class as{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class os{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=Xn[this.specification.type];return n?n(e,t,r):e}}class ss{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return new is(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new is(this,{kind:"constant",value:void 0},e.parameters);const n=Xn[this.specification.type];return n?new is(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,a){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,a)}}class ls{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class us{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Ko(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new Jo(n,void 0),a=this.defaultTransitionablePropertyValues[r]=new Qo(n);this.defaultTransitioningPropertyValues[r]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}function cs(e,t){return t?`${e}${t}`:e}function ds(e){const t=e.indexOf("");return t>=0?e.slice(0,t):e}Ao(ss,"DataDrivenProperty"),Ao(os,"DataConstantProperty"),Ao(ls,"ColorRampProperty");const hs="-transition";class fs extends At{constructor(e,t,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=r,e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new ns(t.layout,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new es(t.paint,r);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new as(t.paint)}}setScope(e){this.scope=e,this.fqid=cs(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){if(null!=t&&this._validate(go,`layers.${this.id}.layout.${e}`,e,t,r))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,t),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return z(e,hs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(mo,`layers.${this.id}.paint.${e}`,e,t,r))return!1;const n=this._transitionablePaint,i=n._properties.properties;if(z(e,hs)){const r=e.slice(0,-11);return i[r]&&n.setTransition(r,t||void 0),!1}if(!i[e])return!1;const a=n._values[e],o=a.value.isDataDriven(),s=a.value;n.setValue(e,t),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const l=n._values[e].value,u=l.isDataDriven(),c=z(e,"pattern")||"line-dasharray"===e;return u||o||c||this._handleOverridablePaintPropertyUpdate(e,s,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return $({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&vo(this,e.call(oo,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:St,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof is&&ta(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class ps{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id)}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const ms={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gs{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _s{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ys(e,t=1){let r=0,n=0;return{members:e.map((e=>{const i=ms[e.type].BYTES_PER_ELEMENT,a=r=vs(r,Math.max(t,i)),o=e.components||1;return n=Math.max(n,i),r+=i*o,{name:e.name,type:e.type,components:o,offset:a}})),size:vs(r,Math.max(n,t)),alignment:t}}function vs(e,t){return Math.ceil(e/t)*t}class bs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}bs.prototype.bytesPerElement=4,Ao(bs,"StructArrayLayout2i4");class xs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}xs.prototype.bytesPerElement=6,Ao(xs,"StructArrayLayout3i6");class Ts extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,e}}Ts.prototype.bytesPerElement=8,Ao(Ts,"StructArrayLayout4i8");class ws extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}emplace(e,t,r,n,i,a){const o=5*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,this.int16[o+4]=a,e}}ws.prototype.bytesPerElement=10,Ao(ws,"StructArrayLayout5i10");class Es extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}emplace(e,t,r,n,i,a,o,s){const l=6*e,u=12*e,c=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=a,this.uint8[u+7]=o,this.float32[c+2]=s,e}}Es.prototype.bytesPerElement=12,Ao(Es,"StructArrayLayout2i4ub1f12");class As extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,e}}As.prototype.bytesPerElement=16,Ao(As,"StructArrayLayout4f16");class Ss extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}emplace(e,t,r,n,i,a){const o=6*e,s=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,this.float32[s+2]=a,e}}Ss.prototype.bytesPerElement=12,Ao(Ss,"StructArrayLayout4ui1f12");class Ps extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=i,e}}Ps.prototype.bytesPerElement=8,Ao(Ps,"StructArrayLayout4ui8");class Ms extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,a)}emplace(e,t,r,n,i,a,o){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e}}Ms.prototype.bytesPerElement=12,Ao(Ms,"StructArrayLayout6i12");class Rs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o,s,l,u,c,d){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,n,i,a,o,s,l,u,c,d)}emplace(e,t,r,n,i,a,o,s,l,u,c,d,h){const f=12*e;return this.int16[f+0]=t,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=i,this.uint16[f+4]=a,this.uint16[f+5]=o,this.uint16[f+6]=s,this.uint16[f+7]=l,this.int16[f+8]=u,this.int16[f+9]=c,this.int16[f+10]=d,this.int16[f+11]=h,e}}Rs.prototype.bytesPerElement=24,Ao(Rs,"StructArrayLayout4i4ui4i24");class Cs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,a)}emplace(e,t,r,n,i,a,o){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.float32[l+2]=i,this.float32[l+3]=a,this.float32[l+4]=o,e}}Cs.prototype.bytesPerElement=20,Ao(Cs,"StructArrayLayout3i3f20");class Os extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Os.prototype.bytesPerElement=4,Ao(Os,"StructArrayLayout1ul4");class Ls extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}Ls.prototype.bytesPerElement=4,Ao(Ls,"StructArrayLayout2ui4");class Is extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o,s,l,u,c,d,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,r,n,i,a,o,s,l,u,c,d,h)}emplace(e,t,r,n,i,a,o,s,l,u,c,d,h,f){const p=20*e,m=10*e;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=i,this.int16[p+4]=a,this.float32[m+3]=o,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=u,this.int16[p+14]=c,this.uint32[m+8]=d,this.uint16[p+18]=h,this.uint16[p+19]=f,e}}Is.prototype.bytesPerElement=40,Ao(Is,"StructArrayLayout5i4f1i1ul2ui40");class Ds extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}emplace(e,t,r,n,i,a,o,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=a,this.int16[l+6]=o,this.int16[l+7]=s,e}}Ds.prototype.bytesPerElement=16,Ao(Ds,"StructArrayLayout3i2i2i16");class ks extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}emplace(e,t,r,n,i,a){const o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[s+6]=i,this.int16[s+7]=a,e}}ks.prototype.bytesPerElement=16,Ao(ks,"StructArrayLayout2f1f2i16");class Bs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=r,this.float32[o+1]=n,this.float32[o+2]=i,e}}Bs.prototype.bytesPerElement=12,Ao(Bs,"StructArrayLayout2ub2f12");class Fs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}Fs.prototype.bytesPerElement=12,Ao(Fs,"StructArrayLayout3f12");class Ns extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}Ns.prototype.bytesPerElement=6,Ao(Ns,"StructArrayLayout3ui6");class qs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b)}emplace(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x){const T=30*e,w=15*e,E=60*e;return this.int16[T+0]=t,this.int16[T+1]=r,this.int16[T+2]=n,this.float32[w+2]=i,this.float32[w+3]=a,this.uint16[T+8]=o,this.uint16[T+9]=s,this.uint32[w+5]=l,this.uint32[w+6]=u,this.uint32[w+7]=c,this.uint16[T+16]=d,this.uint16[T+17]=h,this.uint16[T+18]=f,this.float32[w+10]=p,this.float32[w+11]=m,this.uint8[E+48]=g,this.uint8[E+49]=_,this.uint8[E+50]=y,this.uint32[w+13]=v,this.int16[T+28]=b,this.uint8[E+58]=x,e}}qs.prototype.bytesPerElement=60,Ao(qs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Us extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S,P,M,R,C,O){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S,P,M,R,C,O)}emplace(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S,P,M,R,C,O,L){const I=20*e,D=40*e,k=80*e;return this.float32[I+0]=t,this.float32[I+1]=r,this.int16[D+4]=n,this.int16[D+5]=i,this.int16[D+6]=a,this.int16[D+7]=o,this.int16[D+8]=s,this.int16[D+9]=l,this.int16[D+10]=u,this.int16[D+11]=c,this.int16[D+12]=d,this.uint16[D+13]=h,this.uint16[D+14]=f,this.uint16[D+15]=p,this.uint16[D+16]=m,this.uint16[D+17]=g,this.uint16[D+18]=_,this.uint16[D+19]=y,this.uint16[D+20]=v,this.uint16[D+21]=b,this.uint16[D+22]=x,this.uint16[D+23]=T,this.uint16[D+24]=w,this.uint16[D+25]=E,this.uint16[D+26]=A,this.uint16[D+27]=S,this.uint32[I+14]=P,this.float32[I+15]=M,this.float32[I+16]=R,this.float32[I+17]=C,this.float32[I+18]=O,this.uint8[k+76]=L,e}}Us.prototype.bytesPerElement=80,Ao(Us,"StructArrayLayout2f9i15ui1ul4f1ub80");class js extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}js.prototype.bytesPerElement=4,Ao(js,"StructArrayLayout1f4");class Gs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}emplace(e,t,r,n,i,a){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,this.float32[o+4]=a,e}}Gs.prototype.bytesPerElement=20,Ao(Gs,"StructArrayLayout5f20");class zs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}emplace(e,t,r,n,i,a,o,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=a,this.float32[l+5]=o,this.float32[l+6]=s,e}}zs.prototype.bytesPerElement=28,Ao(zs,"StructArrayLayout7f28");class Vs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=r,this.uint16[a+3]=n,this.uint16[a+4]=i,e}}Vs.prototype.bytesPerElement=12,Ao(Vs,"StructArrayLayout1ul3ui12");class $s extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}$s.prototype.bytesPerElement=2,Ao($s,"StructArrayLayout1ui2");class Hs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}Hs.prototype.bytesPerElement=8,Ao(Hs,"StructArrayLayout2f8");class Ws extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m)}emplace(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=r,this.float32[_+2]=n,this.float32[_+3]=i,this.float32[_+4]=a,this.float32[_+5]=o,this.float32[_+6]=s,this.float32[_+7]=l,this.float32[_+8]=u,this.float32[_+9]=c,this.float32[_+10]=d,this.float32[_+11]=h,this.float32[_+12]=f,this.float32[_+13]=p,this.float32[_+14]=m,this.float32[_+15]=g,e}}Ws.prototype.bytesPerElement=64,Ao(Ws,"StructArrayLayout16f64");class Xs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}emplace(e,t,r,n,i,a,o,s){const l=10*e,u=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,this.uint16[l+2]=n,this.uint16[l+3]=i,this.float32[u+2]=a,this.float32[u+3]=o,this.float32[u+4]=s,e}}Xs.prototype.bytesPerElement=20,Ao(Xs,"StructArrayLayout4ui3f20");class Ys extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Ys.prototype.bytesPerElement=1,Ao(Ys,"StructArrayLayout1ub1");class Zs extends gs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zs.prototype.size=40;class Ks extends Is{get(e){return new Zs(this,e)}}Ao(Ks,"CollisionBoxArray");class Js extends gs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Js.prototype.size=60;class Qs extends qs{get(e){return new Js(this,e)}}Ao(Qs,"PlacedSymbolArray");class el extends gs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}el.prototype.size=80;class tl extends Us{get(e){return new el(this,e)}}Ao(tl,"SymbolInstanceArray");class rl extends js{getoffsetX(e){return this.float32[1*e+0]}}Ao(rl,"GlyphOffsetArray");class nl extends bs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ao(nl,"SymbolLineVertexArray");class il extends gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}il.prototype.size=12;class al extends Vs{get(e){return new il(this,e)}}Ao(al,"FeatureIndexArray");class ol extends Ls{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ao(ol,"FillExtrusionCentroidArray");const sl=ys([{name:"a_pos",components:2,type:"Int16"}],4),ll=ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ul{constructor(e=[]){this.segments=e}_prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>ul.MAX_VERTEX_ARRAY_LENGTH&&X(`Max vertices per segment is ${ul.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>ul.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}prepareSegment(e,t,r,n){return this._prepareSegment(e,t.length,r.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new ul([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function cl(e,t){return 256*(e=C(Math.floor(e),0,255))+C(Math.floor(t),0,255)}ul.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ao(ul,"SegmentVector");const dl=ys([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hl=ys([{name:"a_dash",components:4,type:"Uint16"}]);var fl={exports:{}},pl={exports:{}};!function(e){e.exports=function(e,t){var r,n,i,a,o,s,l,u;for(n=e.length-(r=3&e.length),i=t,o=3432918353,s=461845907,u=0;u<n;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(a=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}(pl);var ml=pl.exports,gl={exports:{}};!function(e){e.exports=function(e,t){for(var r,n=e.length,i=t^n,a=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}(gl);var _l=ml,yl=gl.exports;fl.exports=_l,fl.exports.murmur3=_l,fl.exports.murmur2=yl;var vl=h(fl.exports);class bl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(xl(e)),this.positions.push(t,r,n)}eachPosition(e,t){const r=xl(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=r?i=e:n=e+1}for(;this.ids[n]===r;)t(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,t){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Tl(r,n,0,r.length-1),t&&(t.add(r.buffer),t.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){const t=new bl;let r;t.ids=e.ids,t.positions=e.positions;for(const e of t.ids)e!==r&&t.uniqueIds.push(e),r=e;return t.indexed=!0,t}}function xl(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:vl(String(e))}function Tl(e,t,r,n){for(;r<n;){const i=e[r+n>>1];let a=r-1,o=n+1;for(;;){do{a++}while(e[a]<i);do{o--}while(e[o]>i);if(a>=o)break;wl(e,a,o),wl(t,3*a,3*o),wl(t,3*a+1,3*o+1),wl(t,3*a+2,3*o+2)}o-r<n-o?(Tl(e,t,r,o),r=o+1):(Tl(e,t,o+1,n),n=o)}}function wl(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}Ao(bl,"FeaturePositionMap");class El{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Al extends El{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class Sl extends El{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Pl extends El{constructor(e){super(e),this.current=[0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Ml extends El{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Rl extends El{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Cl extends El{constructor(e){super(e),this.current=ar.transparent}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Ol=new Float32Array(16);class Ll extends El{constructor(e){super(e),this.current=Ol}set(e,t,r){if(this.fetchUniformLocation(e,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Il=new Float32Array(9);class Dl extends El{constructor(e){super(e),this.current=Il}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}const kl=new Float32Array(4);class Bl extends El{constructor(e){super(e),this.current=kl}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function Fl(e){return[cl(255*e.r,255*e.g),cl(255*e.b,255*e.a)]}class Nl{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r,n,i){t.set(e,i,n.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Cl(e):new Sl(e)}}class ql{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,r,n,i){const a="u_pattern"===i||"u_dash"===i?this.pattern:"u_pixel_ratio"===i?this.pixelRatio:null;a&&t.set(e,i,a)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Rl(e):new Sl(e)}}class Ul{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,a,o){const s=this.paintVertexArray.length,l=this.expression.evaluate(new Ko(0,{brightness:a}),t,{},i,n,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,l)}updatePaintArray(e,t,r,n,i,a,o){const s=this.expression.evaluate({zoom:0,brightness:o},r,n,void 0,i);this._setPaintValue(e,t,s)}_setPaintValue(e,t,r){if("color"===this.type){const n=Fl(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jl{constructor(e,t,r,n,i,a){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,r,n,i,a,o){const s=this.expression.evaluate(new Ko(this.zoom,{brightness:a}),t,{},i,n,o),l=this.expression.evaluate(new Ko(this.zoom+1,{brightness:a}),t,{},i,n,o),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,s,l)}updatePaintArray(e,t,r,n,i,a,o){const s=this.expression.evaluate({zoom:this.zoom,brightness:o},r,n,void 0,i),l=this.expression.evaluate({zoom:this.zoom+1,brightness:o},r,n,void 0,i);this._setPaintValue(e,t,s,l)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=Fl(r),a=Fl(n);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1],a[0],a[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,n,i){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=C(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,i,o)}getBinding(e,t){return new Sl(e)}}class Gl{constructor(e,t,r,n,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===r?hl:dl).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,a,o){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(e,t,r,n){if(!n||!r)return;const i=n[r];if(!i)return;const{tl:a,br:o,pixelRatio:s}=i;for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,a[0],a[1],o[0],o[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zl{constructor(e,t,r=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const i in e.paint._values){const a=e.paint.get(i);if(!r(i))continue;if(!(a instanceof is&&ta(a.property.specification)))continue;const o=Hl(i,e.type),s=a.value,l=a.property.specification.type,u=!!a.property.useIntegerZoom,c="line-dasharray"===i||i.endsWith("pattern"),d="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||d)if("source"===s.kind||d||c){const t=Yl(i,l,"source");this.binders[i]=c?new Gl(s,o,l,t,e.id):new Ul(s,o,l,t),n.push(`/a_${i}`)}else{const e=Yl(i,l,"composite");this.binders[i]=new jl(s,o,l,u,t,e),n.push(`/z_${i}`)}else this.binders[i]=c?new ql(s.value,o):new Nl(s.value,o,l),n.push(`/u_${i}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ul||t instanceof jl?t.maxValue:0}populatePaintArrays(e,t,r,n,i,a,o){for(const s in this.binders){const l=this.binders[s];(l instanceof Ul||l instanceof jl||l instanceof Gl)&&l.populatePaintArray(e,t,r,n,i,a,o)}}setConstantPatternPositions(e){for(const t in this.binders){const r=this.binders[t];r instanceof ql&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,t,r,n,i,a,o,s){let l=!1;const u=Object.keys(e),c=0!==u.length,d=c?u:t.uniqueIds;for(const u in this.binders){const h=this.binders[u];if((h instanceof Ul||h instanceof jl||h instanceof Gl)&&(!0===h.expression.isStateDependent||!1===h.expression.isLightConstant)){const f=i.paint.get(u);h.expression=f.value;for(const r of d){const i=e[r.toString()];t.eachPosition(r,((e,t,r)=>{const l=n.feature(e);h.updatePaintArray(t,r,l,i,a,o,s)}))}if(!c)for(const t of r.uniqueIds){const i=e[t.toString()];r.eachPosition(t,((e,t,r)=>{const l=n.feature(e);h.updatePaintArray(t,r,l,i,a,o,s)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Nl||r instanceof ql)&&e.push(...r.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Ul||r instanceof jl||r instanceof Gl)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Nl||r instanceof ql||r instanceof jl)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Nl||n instanceof ql||n instanceof jl)for(const i of n.uniformNames)t.push({name:i,property:r,binding:n.getBinding(e,i)})}return t}setUniforms(e,t,r,n,i){for(const{name:t,property:a,binding:o}of r)this.binders[a].setUniform(e,o,i,n.get(a),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Ul||t instanceof jl||t instanceof Gl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Ul||r instanceof jl||r instanceof Gl)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ul||t instanceof jl||t instanceof Gl)&&t.destroy()}}}class Vl{constructor(e,t,r=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new zl(n,t,r);this.needsUpload=!1,this._featureMap=new bl,this._featureMapWithoutIds=new bl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,r,n,i,a,o,s){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,a,o,s);void 0!==t.id?this._featureMap.add(t.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i,a){for(const o of r)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,o,n,i,a||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const $l={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Hl(e,t){return $l[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Wl={"line-pattern":{source:Ss,composite:Ss},"fill-pattern":{source:Ss,composite:Ss},"fill-extrusion-pattern":{source:Ss,composite:Ss},"line-dasharray":{source:Ps,composite:Ps}},Xl={color:{source:Hs,composite:As},number:{source:js,composite:Hs}};function Yl(e,t,r){const n=Wl[e];return n&&n[r]||Xl[t][r]}Ao(Nl,"ConstantBinder"),Ao(ql,"PatternConstantBinder"),Ao(Ul,"SourceExpressionBinder"),Ao(Gl,"PatternCompositeBinder"),Ao(jl,"CompositeExpressionBinder"),Ao(zl,"ProgramConfiguration",{omit:["_buffers"]}),Ao(Vl,"ProgramConfigurationSet");class Zl{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Bh?new Bh(e.lng,e.lat):Bh.convert(e),this}setSouthWest(e){return this._sw=e instanceof Bh?new Bh(e.lng,e.lat):Bh.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof Bh)n=e,i=e;else{if(!(e instanceof Zl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Zl.convert(e)):this.extend(Bh.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Bh.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new Bh(n.lng,n.lat),this._ne=new Bh(i.lng,i.lat)),this}getCenter(){return new Bh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bh(this.getWest(),this.getNorth())}getSouthEast(){return new Bh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=Bh.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return!e||e instanceof Zl?e:new Zl(e)}}var Kl={},Jl={};Object.defineProperty(Jl,"__esModule",{value:!0}),Jl.setMatrixArrayType=function(e){Jl.ARRAY_TYPE=eu=e},Jl.toRadian=function(e){return e*ru},Jl.equals=function(e,t){return Math.abs(e-t)<=Ql*Math.max(1,Math.abs(e),Math.abs(t))},Jl.RANDOM=Jl.ARRAY_TYPE=Jl.EPSILON=void 0;var Ql=1e-6;Jl.EPSILON=Ql;var eu="undefined"!=typeof Float32Array?Float32Array:Array;Jl.ARRAY_TYPE=eu;var tu=Math.random;Jl.RANDOM=tu;var ru=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var nu={};function iu(e){return iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},iu(e)}Object.defineProperty(nu,"__esModule",{value:!0}),nu.create=function(){var e=new au.ARRAY_TYPE(4);return au.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},nu.clone=function(e){var t=new au.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},nu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},nu.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},nu.fromValues=function(e,t,r,n){var i=new au.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},nu.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},nu.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},nu.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;return o?(e[0]=a*(o=1/o),e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null},nu.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},nu.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},nu.multiply=su,nu.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=n*-s+a*l,e[3]=i*-s+o*l,e},nu.scale=function(e,t,r){var n=t[1],i=t[2],a=t[3],o=r[0],s=r[1];return e[0]=t[0]*o,e[1]=n*o,e[2]=i*s,e[3]=a*s,e},nu.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},nu.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},nu.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},nu.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},nu.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},nu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},nu.subtract=lu,nu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},nu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],l=t[2],u=t[3];return Math.abs(r-o)<=au.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=au.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=au.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-u)<=au.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},nu.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},nu.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},nu.sub=nu.mul=void 0;var au=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==iu(e)&&"function"!=typeof e)return{default:e};var r=ou(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function ou(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ou=function(e){return e?r:t})(e)}function su(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*s+a*l,e[1]=i*s+o*l,e[2]=n*u+a*c,e[3]=i*u+o*c,e}function lu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}nu.mul=su,nu.sub=lu;var uu={};function cu(e){return cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cu(e)}Object.defineProperty(uu,"__esModule",{value:!0}),uu.create=function(){var e=new du.ARRAY_TYPE(6);return du.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},uu.clone=function(e){var t=new du.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},uu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},uu.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},uu.fromValues=function(e,t,r,n,i,a){var o=new du.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=i,o[5]=a,o},uu.set=function(e,t,r,n,i,a,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e},uu.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=r*a-n*i;return l?(e[0]=a*(l=1/l),e[1]=-n*l,e[2]=-i*l,e[3]=r*l,e[4]=(i*s-a*o)*l,e[5]=(n*o-r*s)*l,e):null},uu.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},uu.multiply=fu,uu.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*u,e[1]=i*c+o*u,e[2]=n*-u+a*c,e[3]=i*-u+o*c,e[4]=s,e[5]=l,e},uu.scale=function(e,t,r){var n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=r[0],u=r[1];return e[0]=t[0]*l,e[1]=n*l,e[2]=i*u,e[3]=a*u,e[4]=o,e[5]=s,e},uu.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=n*u+a*c+s,e[5]=i*u+o*c+l,e},uu.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},uu.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},uu.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},uu.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},uu.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},uu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},uu.subtract=pu,uu.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},uu.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},uu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},uu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=t[0],u=t[1],c=t[2],d=t[3],h=t[4],f=t[5];return Math.abs(r-l)<=du.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-u)<=du.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-c)<=du.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-d)<=du.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-h)<=du.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-f)<=du.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},uu.sub=uu.mul=void 0;var du=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==cu(e)&&"function"!=typeof e)return{default:e};var r=hu(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function hu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(hu=function(e){return e?r:t})(e)}function fu(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1],d=r[2],h=r[3],f=r[4],p=r[5];return e[0]=n*u+a*c,e[1]=i*u+o*c,e[2]=n*d+a*h,e[3]=i*d+o*h,e[4]=n*f+a*p+s,e[5]=i*f+o*p+l,e}function pu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}uu.mul=fu,uu.sub=pu;var mu={};function gu(e){return gu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gu(e)}Object.defineProperty(mu,"__esModule",{value:!0}),mu.create=function(){var e=new _u.ARRAY_TYPE(9);return _u.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},mu.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mu.clone=function(e){var t=new _u.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mu.fromValues=function(e,t,r,n,i,a,o,s,l){var u=new _u.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=i,u[5]=a,u[6]=o,u[7]=s,u[8]=l,u},mu.set=function(e,t,r,n,i,a,o,s,l,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e},mu.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mu.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},mu.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=c*o-s*u,h=-c*a+s*l,f=u*a-o*l,p=r*d+n*h+i*f;return p?(e[0]=d*(p=1/p),e[1]=(-c*n+i*u)*p,e[2]=(s*n-i*o)*p,e[3]=h*p,e[4]=(c*r-i*l)*p,e[5]=(-s*r+i*a)*p,e[6]=f*p,e[7]=(-u*r+n*l)*p,e[8]=(o*r-n*a)*p,e):null},mu.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=i*u-n*c,e[2]=n*s-i*o,e[3]=s*l-a*c,e[4]=r*c-i*l,e[5]=i*a-r*s,e[6]=a*u-o*l,e[7]=n*l-r*u,e[8]=r*o-n*a,e},mu.determinant=function(e){var t=e[3],r=e[4],n=e[5],i=e[6],a=e[7],o=e[8];return e[0]*(o*r-n*a)+e[1]*(-o*t+n*i)+e[2]*(a*t-r*i)},mu.multiply=vu,mu.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=r[0],f=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=h*n+f*o+u,e[7]=h*i+f*s+c,e[8]=h*a+f*l+d,e},mu.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=Math.sin(r),f=Math.cos(r);return e[0]=f*n+h*o,e[1]=f*i+h*s,e[2]=f*a+h*l,e[3]=f*o-h*n,e[4]=f*s-h*i,e[5]=f*l-h*a,e[6]=u,e[7]=c,e[8]=d,e},mu.scale=function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mu.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},mu.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mu.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mu.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},mu.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,l=i+i,u=r*o,c=n*o,d=n*s,h=i*o,f=i*s,p=i*l,m=a*o,g=a*s,_=a*l;return e[0]=1-d-p,e[3]=c-_,e[6]=h+g,e[1]=c+_,e[4]=1-u-p,e[7]=f-m,e[2]=h-g,e[5]=f+m,e[8]=1-u-d,e},mu.normalFromMat4=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*s-n*o,v=r*l-i*o,b=r*u-a*o,x=n*l-i*s,T=n*u-a*s,w=i*u-a*l,E=c*m-d*p,A=c*g-h*p,S=c*_-f*p,P=d*g-h*m,M=d*_-f*m,R=h*_-f*g,C=y*R-v*M+b*P+x*S-T*A+w*E;return C?(e[0]=(s*R-l*M+u*P)*(C=1/C),e[1]=(l*S-o*R-u*A)*C,e[2]=(o*M-s*S+u*E)*C,e[3]=(i*M-n*R-a*P)*C,e[4]=(r*R-i*S+a*A)*C,e[5]=(n*S-r*M-a*E)*C,e[6]=(m*w-g*T+_*x)*C,e[7]=(g*b-p*w-_*v)*C,e[8]=(p*T-m*b+_*y)*C,e):null},mu.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},mu.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},mu.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},mu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},mu.subtract=bu,mu.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},mu.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},mu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},mu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],d=t[0],h=t[1],f=t[2],p=t[3],m=t[4],g=t[5],_=t[6],y=t[7],v=t[8];return Math.abs(r-d)<=_u.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-h)<=_u.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-f)<=_u.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-p)<=_u.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=_u.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-g)<=_u.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=_u.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-y)<=_u.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-v)<=_u.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))},mu.sub=mu.mul=void 0;var _u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==gu(e)&&"function"!=typeof e)return{default:e};var r=yu(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function yu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(yu=function(e){return e?r:t})(e)}function vu(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=r[0],f=r[1],p=r[2],m=r[3],g=r[4],_=r[5],y=r[6],v=r[7],b=r[8];return e[0]=h*n+f*o+p*u,e[1]=h*i+f*s+p*c,e[2]=h*a+f*l+p*d,e[3]=m*n+g*o+_*u,e[4]=m*i+g*s+_*c,e[5]=m*a+g*l+_*d,e[6]=y*n+v*o+b*u,e[7]=y*i+v*s+b*c,e[8]=y*a+v*l+b*d,e}function bu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}mu.mul=vu,mu.sub=bu;var xu={};function Tu(e){return Tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tu(e)}Object.defineProperty(xu,"__esModule",{value:!0}),xu.create=function(){var e=new wu.ARRAY_TYPE(16);return wu.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},xu.clone=function(e){var t=new wu.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},xu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},xu.fromValues=function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){var g=new wu.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=a,g[6]=o,g[7]=s,g[8]=l,g[9]=u,g[10]=c,g[11]=d,g[12]=h,g[13]=f,g[14]=p,g[15]=m,g},xu.set=function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=f,e[13]=p,e[14]=m,e[15]=g,e},xu.identity=Au,xu.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},xu.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*s-n*o,v=r*l-i*o,b=r*u-a*o,x=n*l-i*s,T=n*u-a*s,w=i*u-a*l,E=c*m-d*p,A=c*g-h*p,S=c*_-f*p,P=d*g-h*m,M=d*_-f*m,R=h*_-f*g,C=y*R-v*M+b*P+x*S-T*A+w*E;return C?(e[0]=(s*R-l*M+u*P)*(C=1/C),e[1]=(i*M-n*R-a*P)*C,e[2]=(m*w-g*T+_*x)*C,e[3]=(h*T-d*w-f*x)*C,e[4]=(l*S-o*R-u*A)*C,e[5]=(r*R-i*S+a*A)*C,e[6]=(g*b-p*w-_*v)*C,e[7]=(c*w-h*b+f*v)*C,e[8]=(o*M-s*S+u*E)*C,e[9]=(n*S-r*M-a*E)*C,e[10]=(p*T-m*b+_*y)*C,e[11]=(d*b-c*T-f*y)*C,e[12]=(s*A-o*P-l*E)*C,e[13]=(r*P-n*A+i*E)*C,e[14]=(m*v-p*x-g*y)*C,e[15]=(c*x-d*v+h*y)*C,e):null},xu.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(h*_-f*g)-d*(l*_-u*g)+m*(l*f-u*h),e[1]=-(n*(h*_-f*g)-d*(i*_-a*g)+m*(i*f-a*h)),e[2]=n*(l*_-u*g)-s*(i*_-a*g)+m*(i*u-a*l),e[3]=-(n*(l*f-u*h)-s*(i*f-a*h)+d*(i*u-a*l)),e[4]=-(o*(h*_-f*g)-c*(l*_-u*g)+p*(l*f-u*h)),e[5]=r*(h*_-f*g)-c*(i*_-a*g)+p*(i*f-a*h),e[6]=-(r*(l*_-u*g)-o*(i*_-a*g)+p*(i*u-a*l)),e[7]=r*(l*f-u*h)-o*(i*f-a*h)+c*(i*u-a*l),e[8]=o*(d*_-f*m)-c*(s*_-u*m)+p*(s*f-u*d),e[9]=-(r*(d*_-f*m)-c*(n*_-a*m)+p*(n*f-a*d)),e[10]=r*(s*_-u*m)-o*(n*_-a*m)+p*(n*u-a*s),e[11]=-(r*(s*f-u*d)-o*(n*f-a*d)+c*(n*u-a*s)),e[12]=-(o*(d*g-h*m)-c*(s*g-l*m)+p*(s*h-l*d)),e[13]=r*(d*g-h*m)-c*(n*g-i*m)+p*(n*h-i*d),e[14]=-(r*(s*g-l*m)-o*(n*g-i*m)+p*(n*l-i*s)),e[15]=r*(s*h-l*d)-o*(n*h-i*d)+c*(n*l-i*s),e},xu.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*o-r*a)*(d*g-h*m)-(t*s-n*a)*(c*g-h*p)+(t*l-i*a)*(c*m-d*p)+(r*s-n*o)*(u*g-h*f)-(r*l-i*o)*(u*m-d*f)+(n*l-i*s)*(u*p-c*f)},xu.multiply=Su,xu.translate=function(e,t,r){var n,i,a,o,s,l,u,c,d,h,f,p,m=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],e[0]=n=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=f,e[11]=p,e[12]=n*m+s*g+d*_+t[12],e[13]=i*m+l*g+h*_+t[13],e[14]=a*m+u*g+f*_+t[14],e[15]=o*m+c*g+p*_+t[15]),e},xu.scale=function(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},xu.rotate=function(e,t,r,n){var i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S,P,M=n[0],R=n[1],C=n[2],O=Math.hypot(M,R,C);return O<wu.EPSILON?null:(M*=O=1/O,R*=O,C*=O,i=Math.sin(r),a=Math.cos(r),l=t[1],u=t[2],c=t[3],h=t[5],f=t[6],p=t[7],g=t[9],_=t[10],y=t[11],T=M*R*(o=1-a)-C*i,w=R*R*o+a,E=C*R*o+M*i,A=M*C*o+R*i,S=R*C*o-M*i,P=C*C*o+a,e[0]=(s=t[0])*(v=M*M*o+a)+(d=t[4])*(b=R*M*o+C*i)+(m=t[8])*(x=C*M*o-R*i),e[1]=l*v+h*b+g*x,e[2]=u*v+f*b+_*x,e[3]=c*v+p*b+y*x,e[4]=s*T+d*w+m*E,e[5]=l*T+h*w+g*E,e[6]=u*T+f*w+_*E,e[7]=c*T+p*w+y*E,e[8]=s*A+d*S+m*P,e[9]=l*A+h*S+g*P,e[10]=u*A+f*S+_*P,e[11]=c*A+p*S+y*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},xu.rotateX=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+u*n,e[5]=o*i+c*n,e[6]=s*i+d*n,e[7]=l*i+h*n,e[8]=u*i-a*n,e[9]=c*i-o*n,e[10]=d*i-s*n,e[11]=h*i-l*n,e},xu.rotateY=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-u*n,e[1]=o*i-c*n,e[2]=s*i-d*n,e[3]=l*i-h*n,e[8]=a*n+u*i,e[9]=o*n+c*i,e[10]=s*n+d*i,e[11]=l*n+h*i,e},xu.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+u*n,e[1]=o*i+c*n,e[2]=s*i+d*n,e[3]=l*i+h*n,e[4]=u*i-a*n,e[5]=c*i-o*n,e[6]=d*i-s*n,e[7]=h*i-l*n,e},xu.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},xu.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},xu.fromRotation=function(e,t,r){var n,i,a,o=r[0],s=r[1],l=r[2],u=Math.hypot(o,s,l);return u<wu.EPSILON?null:(o*=u=1/u,s*=u,l*=u,n=Math.sin(t),i=Math.cos(t),e[0]=o*o*(a=1-i)+i,e[1]=s*o*a+l*n,e[2]=l*o*a-s*n,e[3]=0,e[4]=o*s*a-l*n,e[5]=s*s*a+i,e[6]=l*s*a+o*n,e[7]=0,e[8]=o*l*a+s*n,e[9]=s*l*a-o*n,e[10]=l*l*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},xu.fromXRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},xu.fromYRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},xu.fromZRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},xu.fromRotationTranslation=Pu,xu.fromQuat2=function(e,t){var r=new wu.ARRAY_TYPE(3),n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=n*n+i*i+a*a+o*o;return d>0?(r[0]=2*(s*o+c*n+l*a-u*i)/d,r[1]=2*(l*o+c*i+u*n-s*a)/d,r[2]=2*(u*o+c*a+s*i-l*n)/d):(r[0]=2*(s*o+c*n+l*a-u*i),r[1]=2*(l*o+c*i+u*n-s*a),r[2]=2*(u*o+c*a+s*i-l*n)),Pu(e,t,r),e},xu.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},xu.getScaling=Mu,xu.getRotation=function(e,t){var r=new wu.ARRAY_TYPE(3);Mu(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],o=t[0]*n,s=t[1]*i,l=t[2]*a,u=t[4]*n,c=t[5]*i,d=t[6]*a,h=t[8]*n,f=t[9]*i,p=t[10]*a,m=o+c+p,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(d-f)/g,e[1]=(h-l)/g,e[2]=(s-u)/g):o>c&&o>p?(g=2*Math.sqrt(1+o-c-p),e[3]=(d-f)/g,e[0]=.25*g,e[1]=(s+u)/g,e[2]=(h+l)/g):c>p?(g=2*Math.sqrt(1+c-o-p),e[3]=(h-l)/g,e[0]=(s+u)/g,e[1]=.25*g,e[2]=(d+f)/g):(g=2*Math.sqrt(1+p-o-c),e[3]=(s-u)/g,e[0]=(h+l)/g,e[1]=(d+f)/g,e[2]=.25*g),e},xu.fromRotationTranslationScale=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],l=i+i,u=a+a,c=o+o,d=i*l,h=i*u,f=i*c,p=a*u,m=a*c,g=o*c,_=s*l,y=s*u,v=s*c,b=n[0],x=n[1],T=n[2];return e[0]=(1-(p+g))*b,e[1]=(h+v)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(h-v)*x,e[5]=(1-(d+g))*x,e[6]=(m+_)*x,e[7]=0,e[8]=(f+y)*T,e[9]=(m-_)*T,e[10]=(1-(d+p))*T,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},xu.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){var a=t[0],o=t[1],s=t[2],l=t[3],u=a+a,c=o+o,d=s+s,h=a*u,f=a*c,p=a*d,m=o*c,g=o*d,_=s*d,y=l*u,v=l*c,b=l*d,x=n[0],T=n[1],w=n[2],E=i[0],A=i[1],S=i[2],P=(1-(m+_))*x,M=(f+b)*x,R=(p-v)*x,C=(f-b)*T,O=(1-(h+_))*T,L=(g+y)*T,I=(p+v)*w,D=(g-y)*w,k=(1-(h+m))*w;return e[0]=P,e[1]=M,e[2]=R,e[3]=0,e[4]=C,e[5]=O,e[6]=L,e[7]=0,e[8]=I,e[9]=D,e[10]=k,e[11]=0,e[12]=r[0]+E-(P*E+C*A+I*S),e[13]=r[1]+A-(M*E+O*A+D*S),e[14]=r[2]+S-(R*E+L*A+k*S),e[15]=1,e},xu.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,l=i+i,u=r*o,c=n*o,d=n*s,h=i*o,f=i*s,p=i*l,m=a*o,g=a*s,_=a*l;return e[0]=1-d-p,e[1]=c+_,e[2]=h-g,e[3]=0,e[4]=c-_,e[5]=1-u-p,e[6]=f+m,e[7]=0,e[8]=h+g,e[9]=f-m,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},xu.frustum=function(e,t,r,n,i,a,o){var s=1/(r-t),l=1/(i-n),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e},xu.perspectiveNO=Ru,xu.perspectiveZO=function(e,t,r,n,i){var a,o=1/Math.tan(t/2);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=i*(a=1/(n-i)),e[14]=i*n*a):(e[10]=-1,e[14]=-n),e},xu.perspectiveFromFieldOfView=function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(i+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(i-a)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},xu.orthoNO=Cu,xu.orthoZO=function(e,t,r,n,i,a,o){var s=1/(t-r),l=1/(n-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=a*u,e[15]=1,e},xu.lookAt=function(e,t,r,n){var i,a,o,s,l,u,c,d,h,f,p=t[0],m=t[1],g=t[2],_=n[0],y=n[1],v=n[2],b=r[0],x=r[1],T=r[2];return Math.abs(p-b)<wu.EPSILON&&Math.abs(m-x)<wu.EPSILON&&Math.abs(g-T)<wu.EPSILON?Au(e):(c=p-b,d=m-x,h=g-T,i=y*(h*=f=1/Math.hypot(c,d,h))-v*(d*=f),a=v*(c*=f)-_*h,o=_*d-y*c,(f=Math.hypot(i,a,o))?(i*=f=1/f,a*=f,o*=f):(i=0,a=0,o=0),s=d*o-h*a,l=h*i-c*o,u=c*a-d*i,(f=Math.hypot(s,l,u))?(s*=f=1/f,l*=f,u*=f):(s=0,l=0,u=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=a,e[5]=l,e[6]=d,e[7]=0,e[8]=o,e[9]=u,e[10]=h,e[11]=0,e[12]=-(i*p+a*m+o*g),e[13]=-(s*p+l*m+u*g),e[14]=-(c*p+d*m+h*g),e[15]=1,e)},xu.targetTo=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=n[0],l=n[1],u=n[2],c=i-r[0],d=a-r[1],h=o-r[2],f=c*c+d*d+h*h;f>0&&(c*=f=1/Math.sqrt(f),d*=f,h*=f);var p=l*h-u*d,m=u*c-s*h,g=s*d-l*c;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=d*g-h*m,e[5]=h*p-c*g,e[6]=c*m-d*p,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},xu.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},xu.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},xu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},xu.subtract=Ou,xu.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},xu.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},xu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},xu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=t[0],v=t[1],b=t[2],x=t[3],T=t[4],w=t[5],E=t[6],A=t[7],S=t[8],P=t[9],M=t[10],R=t[11],C=t[12],O=t[13],L=t[14],I=t[15];return Math.abs(r-y)<=wu.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=wu.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-b)<=wu.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=wu.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-T)<=wu.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-w)<=wu.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-E)<=wu.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-A)<=wu.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-S)<=wu.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-P)<=wu.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(h-M)<=wu.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-R)<=wu.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(p-C)<=wu.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(m-O)<=wu.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-L)<=wu.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(_-I)<=wu.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))},xu.sub=xu.mul=xu.ortho=xu.perspective=void 0;var wu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Tu(e)&&"function"!=typeof e)return{default:e};var r=Eu(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function Eu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Eu=function(e){return e?r:t})(e)}function Au(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Su(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=r[0],b=r[1],x=r[2],T=r[3];return e[0]=v*n+b*s+x*d+T*m,e[1]=v*i+b*l+x*h+T*g,e[2]=v*a+b*u+x*f+T*_,e[3]=v*o+b*c+x*p+T*y,e[4]=(v=r[4])*n+(b=r[5])*s+(x=r[6])*d+(T=r[7])*m,e[5]=v*i+b*l+x*h+T*g,e[6]=v*a+b*u+x*f+T*_,e[7]=v*o+b*c+x*p+T*y,e[8]=(v=r[8])*n+(b=r[9])*s+(x=r[10])*d+(T=r[11])*m,e[9]=v*i+b*l+x*h+T*g,e[10]=v*a+b*u+x*f+T*_,e[11]=v*o+b*c+x*p+T*y,e[12]=(v=r[12])*n+(b=r[13])*s+(x=r[14])*d+(T=r[15])*m,e[13]=v*i+b*l+x*h+T*g,e[14]=v*a+b*u+x*f+T*_,e[15]=v*o+b*c+x*p+T*y,e}function Pu(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,l=i+i,u=a+a,c=n*s,d=n*l,h=n*u,f=i*l,p=i*u,m=a*u,g=o*s,_=o*l,y=o*u;return e[0]=1-(f+m),e[1]=d+y,e[2]=h-_,e[3]=0,e[4]=d-y,e[5]=1-(c+m),e[6]=p+g,e[7]=0,e[8]=h+_,e[9]=p-g,e[10]=1-(c+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Mu(e,t){var r=t[4],n=t[5],i=t[6],a=t[8],o=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,n,i),e[2]=Math.hypot(a,o,s),e}function Ru(e,t,r,n,i){var a,o=1/Math.tan(t/2);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(a=1/(n-i)),e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}function Cu(e,t,r,n,i,a,o){var s=1/(t-r),l=1/(n-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(o+a)*u,e[15]=1,e}function Ou(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}xu.perspective=Ru,xu.ortho=Cu,xu.mul=Su,xu.sub=Ou;var Lu={},Iu={};function Du(e){return Du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Du(e)}Object.defineProperty(Iu,"__esModule",{value:!0}),Iu.create=Fu,Iu.clone=function(e){var t=new ku.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Iu.length=Nu,Iu.fromValues=function(e,t,r){var n=new ku.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n},Iu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Iu.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},Iu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},Iu.subtract=qu,Iu.multiply=Uu,Iu.divide=ju,Iu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Iu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Iu.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},Iu.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},Iu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Iu.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},Iu.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},Iu.distance=Gu,Iu.squaredDistance=zu,Iu.squaredLength=Vu,Iu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Iu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Iu.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},Iu.dot=$u,Iu.cross=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=i*l-a*s,e[1]=a*o-n*l,e[2]=n*s-i*o,e},Iu.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e},Iu.hermite=function(e,t,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*l+n[0]*u+i[0]*c,e[1]=t[1]*s+r[1]*l+n[1]*u+i[1]*c,e[2]=t[2]*s+r[2]*l+n[2]*u+i[2]*c,e},Iu.bezier=function(e,t,r,n,i,a){var o=1-a,s=o*o,l=a*a,u=s*o,c=3*a*s,d=3*l*o,h=l*a;return e[0]=t[0]*u+r[0]*c+n[0]*d+i[0]*h,e[1]=t[1]*u+r[1]*c+n[1]*d+i[1]*h,e[2]=t[2]*u+r[2]*c+n[2]*d+i[2]*h,e},Iu.random=function(e,t){t=t||1;var r=2*ku.RANDOM()*Math.PI,n=2*ku.RANDOM()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},Iu.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e},Iu.transformMat3=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},Iu.transformQuat=function(e,t,r){var n=r[0],i=r[1],a=r[2],o=t[0],s=t[1],l=t[2],u=i*l-a*s,c=a*o-n*l,d=n*s-i*o,h=i*d-a*c,f=a*u-n*d,p=n*c-i*u,m=2*r[3];return c*=m,d*=m,f*=2,p*=2,e[0]=o+(u*=m)+(h*=2),e[1]=s+c+f,e[2]=l+d+p,e},Iu.rotateX=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},Iu.rotateY=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},Iu.rotateZ=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},Iu.angle=function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],l=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(a*a+o*o+s*s),u=l&&$u(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))},Iu.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Iu.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Iu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Iu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=ku.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=ku.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=ku.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))},Iu.forEach=Iu.sqrLen=Iu.len=Iu.sqrDist=Iu.dist=Iu.div=Iu.mul=Iu.sub=void 0;var ku=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Du(e)&&"function"!=typeof e)return{default:e};var r=Bu(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function Bu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Bu=function(e){return e?r:t})(e)}function Fu(){var e=new ku.ARRAY_TYPE(3);return ku.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Nu(e){return Math.hypot(e[0],e[1],e[2])}function qu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Uu(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function ju(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Gu(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function zu(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function Vu(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function $u(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Iu.sub=qu,Iu.mul=Uu,Iu.div=ju,Iu.dist=Gu,Iu.sqrDist=zu,Iu.len=Nu,Iu.sqrLen=Vu;var Hu,Wu=(Hu=Fu(),function(e,t,r,n,i,a){var o,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)Hu[0]=e[o],Hu[1]=e[o+1],Hu[2]=e[o+2],i(Hu,Hu,a),e[o]=Hu[0],e[o+1]=Hu[1],e[o+2]=Hu[2];return e});Iu.forEach=Wu;var Xu={};function Yu(e){return Yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yu(e)}Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.create=Ju,Xu.clone=function(e){var t=new Zu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Xu.fromValues=function(e,t,r,n){var i=new Zu.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},Xu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Xu.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},Xu.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},Xu.subtract=Qu,Xu.multiply=ec,Xu.divide=tc,Xu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Xu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Xu.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},Xu.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},Xu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Xu.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},Xu.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},Xu.distance=rc,Xu.squaredDistance=nc,Xu.length=ic,Xu.squaredLength=ac,Xu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Xu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Xu.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e},Xu.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Xu.cross=function(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],c=t[0],d=t[1],h=t[2],f=t[3];return e[0]=d*u-h*l+f*s,e[1]=-c*u+h*o-f*a,e[2]=c*l-d*o+f*i,e[3]=-c*s+d*a-h*i,e},Xu.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e},Xu.random=function(e,t){var r,n,i,a,o,s;t=t||1;do{o=(r=2*Zu.RANDOM()-1)*r+(n=2*Zu.RANDOM()-1)*n}while(o>=1);do{s=(i=2*Zu.RANDOM()-1)*i+(a=2*Zu.RANDOM()-1)*a}while(s>=1);var l=Math.sqrt((1-o)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*i*l,e[3]=t*a*l,e},Xu.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e},Xu.transformQuat=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*n+s*a-l*i,d=u*i+l*n-o*a,h=u*a+o*i-s*n,f=-o*n-s*i-l*a;return e[0]=c*u+f*-o+d*-l-h*-s,e[1]=d*u+f*-s+h*-o-c*-l,e[2]=h*u+f*-l+c*-s-d*-o,e[3]=t[3],e},Xu.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Xu.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Xu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Xu.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],l=t[2],u=t[3];return Math.abs(r-o)<=Zu.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=Zu.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=Zu.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-u)<=Zu.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},Xu.forEach=Xu.sqrLen=Xu.len=Xu.sqrDist=Xu.dist=Xu.div=Xu.mul=Xu.sub=void 0;var Zu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Yu(e)&&"function"!=typeof e)return{default:e};var r=Ku(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function Ku(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ku=function(e){return e?r:t})(e)}function Ju(){var e=new Zu.ARRAY_TYPE(4);return Zu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Qu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function ec(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function tc(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function rc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function nc(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function ic(e){return Math.hypot(e[0],e[1],e[2],e[3])}function ac(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}Xu.sub=Qu,Xu.mul=ec,Xu.div=tc,Xu.dist=rc,Xu.sqrDist=nc,Xu.len=ic,Xu.sqrLen=ac;var oc=function(){var e=Ju();return function(t,r,n,i,a,o){var s,l;for(r||(r=4),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function sc(e){return sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sc(e)}Xu.forEach=oc,Object.defineProperty(Lu,"__esModule",{value:!0}),Lu.create=pc,Lu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Lu.setAxisAngle=mc,Lu.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>lc.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},Lu.getAngle=function(e,t){var r=Tc(e,t);return Math.acos(2*r*r-1)},Lu.multiply=gc,Lu.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=a*l-i*s,e[3]=o*l-n*s,e},Lu.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-a*s,e[1]=i*l+o*s,e[2]=a*l+n*s,e[3]=o*l-i*s,e},Lu.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},Lu.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},Lu.exp=_c,Lu.ln=yc,Lu.pow=function(e,t,r){return yc(e,t),xc(e,e,r),_c(e,e),e},Lu.slerp=vc,Lu.random=function(e){var t=lc.RANDOM(),r=lc.RANDOM(),n=lc.RANDOM(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},Lu.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},Lu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Lu.fromMat3=bc,Lu.fromEuler=function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),l=Math.cos(r),u=Math.sin(n),c=Math.cos(n);return e[0]=a*l*c-o*s*u,e[1]=o*s*c+a*l*u,e[2]=o*l*u-a*s*c,e[3]=o*l*c+a*s*u,e},Lu.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Lu.setAxes=Lu.sqlerp=Lu.rotationTo=Lu.equals=Lu.exactEquals=Lu.normalize=Lu.sqrLen=Lu.squaredLength=Lu.len=Lu.length=Lu.lerp=Lu.dot=Lu.scale=Lu.mul=Lu.add=Lu.set=Lu.copy=Lu.fromValues=Lu.clone=void 0;var lc=fc(Jl),uc=fc(mu),cc=fc(Iu),dc=fc(Xu);function hc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(hc=function(e){return e?r:t})(e)}function fc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==sc(e)&&"function"!=typeof e)return{default:e};var r=hc(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function pc(){var e=new lc.ARRAY_TYPE(4);return lc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function mc(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function gc(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+o*s+i*u-a*l,e[1]=i*c+o*l+a*s-n*u,e[2]=a*c+o*u+n*l-i*s,e[3]=o*c-n*s-i*l-a*u,e}function _c(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=Math.sqrt(r*r+n*n+i*i),s=Math.exp(a),l=o>0?s*Math.sin(o)/o:0;return e[0]=r*l,e[1]=n*l,e[2]=i*l,e[3]=s*Math.cos(o),e}function yc(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=Math.sqrt(r*r+n*n+i*i),s=o>0?Math.atan2(o,a)/o:0;return e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=.5*Math.log(r*r+n*n+i*i+a*a),e}function vc(e,t,r,n){var i,a,o,s,l,u=t[0],c=t[1],d=t[2],h=t[3],f=r[0],p=r[1],m=r[2],g=r[3];return(a=u*f+c*p+d*m+h*g)<0&&(a=-a,f=-f,p=-p,m=-m,g=-g),1-a>lc.EPSILON?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,l=Math.sin(n*i)/o):(s=1-n,l=n),e[0]=s*u+l*f,e[1]=s*c+l*p,e[2]=s*d+l*m,e[3]=s*h+l*g,e}function bc(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,e[3]=(t[3*a+o]-t[3*o+a])*(r=.5/r),e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}Lu.clone=dc.clone,Lu.fromValues=dc.fromValues,Lu.copy=dc.copy,Lu.set=dc.set,Lu.add=dc.add,Lu.mul=gc;var xc=dc.scale;Lu.scale=xc;var Tc=dc.dot;Lu.dot=Tc,Lu.lerp=dc.lerp;var wc=dc.length;Lu.length=wc,Lu.len=wc;var Ec=dc.squaredLength;Lu.squaredLength=Ec,Lu.sqrLen=Ec;var Ac=dc.normalize;Lu.normalize=Ac,Lu.exactEquals=dc.exactEquals,Lu.equals=dc.equals;var Sc,Pc,Mc,Rc=(Sc=cc.create(),Pc=cc.fromValues(1,0,0),Mc=cc.fromValues(0,1,0),function(e,t,r){var n=cc.dot(t,r);return n<-.999999?(cc.cross(Sc,Pc,t),cc.len(Sc)<1e-6&&cc.cross(Sc,Mc,t),cc.normalize(Sc,Sc),mc(e,Sc,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(cc.cross(Sc,t,r),e[0]=Sc[0],e[1]=Sc[1],e[2]=Sc[2],e[3]=1+n,Ac(e,e))});Lu.rotationTo=Rc;var Cc,Oc,Lc=(Cc=pc(),Oc=pc(),function(e,t,r,n,i,a){return vc(Cc,t,i,a),vc(Oc,r,n,a),vc(e,Cc,Oc,2*a*(1-a)),e});Lu.sqlerp=Lc;var Ic,Dc=(Ic=uc.create(),function(e,t,r,n){return Ic[0]=r[0],Ic[3]=r[1],Ic[6]=r[2],Ic[1]=n[0],Ic[4]=n[1],Ic[7]=n[2],Ic[2]=-t[0],Ic[5]=-t[1],Ic[8]=-t[2],Ac(e,bc(e,Ic))});Lu.setAxes=Dc;var kc={};function Bc(e){return Bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bc(e)}Object.defineProperty(kc,"__esModule",{value:!0}),kc.create=function(){var e=new Fc.ARRAY_TYPE(8);return Fc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},kc.clone=function(e){var t=new Fc.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},kc.fromValues=function(e,t,r,n,i,a,o,s){var l=new Fc.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=n,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l},kc.fromRotationTranslationValues=function(e,t,r,n,i,a,o){var s=new Fc.ARRAY_TYPE(8);s[0]=e,s[1]=t,s[2]=r,s[3]=n;var l=.5*i,u=.5*a,c=.5*o;return s[4]=l*n+u*r-c*t,s[5]=u*n+c*e-l*r,s[6]=c*n+l*t-u*e,s[7]=-l*e-u*t-c*r,s},kc.fromRotationTranslation=Gc,kc.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},kc.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},kc.fromMat4=function(e,t){var r=Nc.create();qc.getRotation(r,t);var n=new Fc.ARRAY_TYPE(3);return qc.getTranslation(n,t),Gc(e,r,n),e},kc.copy=zc,kc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},kc.set=function(e,t,r,n,i,a,o,s,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e},kc.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},kc.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},kc.getTranslation=function(e,t){var r=t[4],n=t[5],i=t[6],a=t[7],o=-t[0],s=-t[1],l=-t[2],u=t[3];return e[0]=2*(r*u+a*o+n*l-i*s),e[1]=2*(n*u+a*s+i*o-r*l),e[2]=2*(i*u+a*l+r*s-n*o),e},kc.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=.5*r[0],l=.5*r[1],u=.5*r[2],c=t[4],d=t[5],h=t[6],f=t[7];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=o*s+i*u-a*l+c,e[5]=o*l+a*s-n*u+d,e[6]=o*u+n*l-i*s+h,e[7]=-n*s-i*l-a*u+f,e},kc.rotateX=function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=s*o+c*n+l*a-u*i,h=l*o+c*i+u*n-s*a,f=u*o+c*a+s*i-l*n,p=c*o-s*n-l*i-u*a;return Nc.rotateX(e,t,r),e[4]=d*(o=e[3])+p*(n=e[0])+h*(a=e[2])-f*(i=e[1]),e[5]=h*o+p*i+f*n-d*a,e[6]=f*o+p*a+d*i-h*n,e[7]=p*o-d*n-h*i-f*a,e},kc.rotateY=function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=s*o+c*n+l*a-u*i,h=l*o+c*i+u*n-s*a,f=u*o+c*a+s*i-l*n,p=c*o-s*n-l*i-u*a;return Nc.rotateY(e,t,r),e[4]=d*(o=e[3])+p*(n=e[0])+h*(a=e[2])-f*(i=e[1]),e[5]=h*o+p*i+f*n-d*a,e[6]=f*o+p*a+d*i-h*n,e[7]=p*o-d*n-h*i-f*a,e},kc.rotateZ=function(e,t,r){var n=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=s*o+c*n+l*a-u*i,h=l*o+c*i+u*n-s*a,f=u*o+c*a+s*i-l*n,p=c*o-s*n-l*i-u*a;return Nc.rotateZ(e,t,r),e[4]=d*(o=e[3])+p*(n=e[0])+h*(a=e[2])-f*(i=e[1]),e[5]=h*o+p*i+f*n-d*a,e[6]=f*o+p*a+d*i-h*n,e[7]=p*o-d*n-h*i-f*a,e},kc.rotateByQuatAppend=function(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],l=t[1],u=t[2],c=t[3];return e[0]=s*o+c*n+l*a-u*i,e[1]=l*o+c*i+u*n-s*a,e[2]=u*o+c*a+s*i-l*n,e[3]=c*o-s*n-l*i-u*a,e[4]=(s=t[4])*o+(c=t[7])*n+(l=t[5])*a-(u=t[6])*i,e[5]=l*o+c*i+u*n-s*a,e[6]=u*o+c*a+s*i-l*n,e[7]=c*o-s*n-l*i-u*a,e},kc.rotateByQuatPrepend=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+o*s+i*u-a*l,e[1]=i*c+o*l+a*s-n*u,e[2]=a*c+o*u+n*l-i*s,e[3]=o*c-n*s-i*l-a*u,e[4]=n*(c=r[7])+o*(s=r[4])+i*(u=r[6])-a*(l=r[5]),e[5]=i*c+o*l+a*s-n*u,e[6]=a*c+o*u+n*l-i*s,e[7]=o*c-n*s-i*l-a*u,e},kc.rotateAroundAxis=function(e,t,r,n){if(Math.abs(n)<Fc.EPSILON)return zc(e,t);var i=Math.hypot(r[0],r[1],r[2]);n*=.5;var a=Math.sin(n),o=a*r[0]/i,s=a*r[1]/i,l=a*r[2]/i,u=Math.cos(n),c=t[0],d=t[1],h=t[2],f=t[3];e[0]=c*u+f*o+d*l-h*s,e[1]=d*u+f*s+h*o-c*l,e[2]=h*u+f*l+c*s-d*o,e[3]=f*u-c*o-d*s-h*l;var p=t[4],m=t[5],g=t[6],_=t[7];return e[4]=p*u+_*o+m*l-g*s,e[5]=m*u+_*s+g*o-p*l,e[6]=g*u+_*l+p*s-m*o,e[7]=_*u-p*o-m*s-g*l,e},kc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},kc.multiply=Vc,kc.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},kc.lerp=function(e,t,r,n){var i=1-n;return $c(t,r)<0&&(n=-n),e[0]=t[0]*i+r[0]*n,e[1]=t[1]*i+r[1]*n,e[2]=t[2]*i+r[2]*n,e[3]=t[3]*i+r[3]*n,e[4]=t[4]*i+r[4]*n,e[5]=t[5]*i+r[5]*n,e[6]=t[6]*i+r[6]*n,e[7]=t[7]*i+r[7]*n,e},kc.invert=function(e,t){var r=Wc(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},kc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},kc.normalize=function(e,t){var r=Wc(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,i=t[1]/r,a=t[2]/r,o=t[3]/r,s=t[4],l=t[5],u=t[6],c=t[7],d=n*s+i*l+a*u+o*c;e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=(s-n*d)/r,e[5]=(l-i*d)/r,e[6]=(u-a*d)/r,e[7]=(c-o*d)/r}return e},kc.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},kc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},kc.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=t[0],d=t[1],h=t[2],f=t[3],p=t[4],m=t[5],g=t[6],_=t[7];return Math.abs(r-c)<=Fc.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-d)<=Fc.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-h)<=Fc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=Fc.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-p)<=Fc.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=Fc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=Fc.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-_)<=Fc.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},kc.sqrLen=kc.squaredLength=kc.len=kc.length=kc.dot=kc.mul=kc.setReal=kc.getReal=void 0;var Fc=jc(Jl),Nc=jc(Lu),qc=jc(xu);function Uc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Uc=function(e){return e?r:t})(e)}function jc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Bc(e)&&"function"!=typeof e)return{default:e};var r=Uc(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function Gc(e,t,r){var n=.5*r[0],i=.5*r[1],a=.5*r[2],o=t[0],s=t[1],l=t[2],u=t[3];return e[0]=o,e[1]=s,e[2]=l,e[3]=u,e[4]=n*u+i*l-a*s,e[5]=i*u+a*o-n*l,e[6]=a*u+n*s-i*o,e[7]=-n*o-i*s-a*l,e}function zc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Vc(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[4],l=r[5],u=r[6],c=r[7],d=t[4],h=t[5],f=t[6],p=t[7],m=r[0],g=r[1],_=r[2],y=r[3];return e[0]=n*y+o*m+i*_-a*g,e[1]=i*y+o*g+a*m-n*_,e[2]=a*y+o*_+n*g-i*m,e[3]=o*y-n*m-i*g-a*_,e[4]=n*c+o*s+i*u-a*l+d*y+p*m+h*_-f*g,e[5]=i*c+o*l+a*s-n*u+h*y+p*g+f*m-d*_,e[6]=a*c+o*u+n*l-i*s+f*y+p*_+d*g-h*m,e[7]=o*c-n*s-i*l-a*u+p*y-d*m-h*g-f*_,e}kc.getReal=Nc.copy,kc.setReal=Nc.copy,kc.mul=Vc;var $c=Nc.dot;kc.dot=$c;var Hc=Nc.length;kc.length=Hc,kc.len=Hc;var Wc=Nc.squaredLength;kc.squaredLength=Wc,kc.sqrLen=Wc;var Xc={};function Yc(e){return Yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yc(e)}Object.defineProperty(Xc,"__esModule",{value:!0}),Xc.create=Jc,Xc.clone=function(e){var t=new Zc.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Xc.fromValues=function(e,t){var r=new Zc.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},Xc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Xc.set=function(e,t,r){return e[0]=t,e[1]=r,e},Xc.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},Xc.subtract=Qc,Xc.multiply=ed,Xc.divide=td,Xc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Xc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Xc.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},Xc.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},Xc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Xc.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},Xc.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},Xc.distance=rd,Xc.squaredDistance=nd,Xc.length=id,Xc.squaredLength=ad,Xc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Xc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Xc.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},Xc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Xc.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},Xc.lerp=function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},Xc.random=function(e,t){t=t||1;var r=2*Zc.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},Xc.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},Xc.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},Xc.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},Xc.transformMat4=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},Xc.rotate=function(e,t,r,n){var i=t[0]-r[0],a=t[1]-r[1],o=Math.sin(n),s=Math.cos(n);return e[0]=i*s-a*o+r[0],e[1]=i*o+a*s+r[1],e},Xc.angle=function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],o=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+a*a);return Math.acos(Math.min(Math.max(o&&(r*i+n*a)/o,-1),1))},Xc.zero=function(e){return e[0]=0,e[1]=0,e},Xc.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Xc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Xc.equals=function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=Zc.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=Zc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))},Xc.forEach=Xc.sqrLen=Xc.sqrDist=Xc.dist=Xc.div=Xc.mul=Xc.sub=Xc.len=void 0;var Zc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Yc(e)&&"function"!=typeof e)return{default:e};var r=Kc(void 0);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(Jl);function Kc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Kc=function(e){return e?r:t})(e)}function Jc(){var e=new Zc.ARRAY_TYPE(2);return Zc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function Qc(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function ed(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function td(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function rd(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function nd(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function id(e){return Math.hypot(e[0],e[1])}function ad(e){var t=e[0],r=e[1];return t*t+r*r}Xc.len=id,Xc.sub=Qc,Xc.mul=ed,Xc.div=td,Xc.dist=rd,Xc.sqrDist=nd,Xc.sqrLen=ad;var od=function(){var e=Jc();return function(t,r,n,i,a,o){var s,l;for(r||(r=2),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();function sd(e){return sd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sd(e)}Xc.forEach=od,Object.defineProperty(Kl,"__esModule",{value:!0});var ld=Kl.vec4=Td=Kl.vec3=Kl.vec2=Kl.quat2=yd=Kl.quat=gd=Kl.mat4=pd=Kl.mat3=Kl.mat2d=dd=Kl.mat2=Kl.glMatrix=void 0,ud=Ad(Jl);Kl.glMatrix=ud;var cd=Ad(nu),dd=Kl.mat2=cd,hd=Ad(uu);Kl.mat2d=hd;var fd=Ad(mu),pd=Kl.mat3=fd,md=Ad(xu),gd=Kl.mat4=md,_d=Ad(Lu),yd=Kl.quat=_d,vd=Ad(kc);Kl.quat2=vd;var bd=Ad(Xc);Kl.vec2=bd;var xd=Ad(Iu),Td=Kl.vec3=xd,wd=Ad(Xu);function Ed(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ed=function(e){return e?r:t})(e)}function Ad(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==sd(e)&&"function"!=typeof e)return{default:e};var r=Ed(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}ld=Kl.vec4=wd;const Sd=ys([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Pd}=Sd,Md=ys([{name:"a_pos_3",components:3,type:"Int16"}]);var Rd=ys([{name:"a_pos",type:"Int16",components:2}]),Cd={};!function(e,t){!function(e){function t(e,t,n){var i=r(256*e,256*(t=Math.pow(2,n)-t-1),n),a=r(256*(e+1),256*(t+1),n);return i[0]+","+i[1]+","+a[0]+","+a[1]}function r(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}e.getURL=function(e,r,n,i,a,o){return o=o||{},e+"?"+["bbox="+t(n,i,a),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+r].join("&")},e.getTileBBox=t,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,Cd);var Od=Cd;class Ld{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=kd(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=Od.getTileBBox(this.x,this.y,this.z),n=function(e,t,r){let n,i="";for(let a=e;a>0;a--)n=1<<a-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Id{constructor(e,t){this.wrap=e,this.canonical=t,this.key=kd(e,t.z,t.z,t.x,t.y)}}class Dd{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Ld(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:kd(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Dd(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dd(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return kd(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return kd(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Dd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Dd(t,this.wrap,t,r,n),new Dd(t,this.wrap,t,r+1,n),new Dd(t,this.wrap,t,r,n+1),new Dd(t,this.wrap,t,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dd(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Id(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function kd(e,t,r,n,i){const a=1<<Math.min(r,22);let o=a*(i%a)+n%a;return e&&r<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*o+r)+(t-r)}const Bd=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new Dd(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new Dd(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new Dd(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Dd(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Ao(Ld,"CanonicalTileID"),Ao(Dd,"OverscaledTileID",{omit:["projMatrix"]});class Fd{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=Td.dot(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,t,r){if(Td.equals(this.pos,e)||0===t)return r[0]=r[1]=r[2]=0,!1;const[n,i,a]=this.dir,o=this.pos[0]-e[0],s=this.pos[1]-e[1],l=this.pos[2]-e[2],u=n*n+i*i+a*a,c=2*(o*n+s*i+l*a),d=c*c-4*u*(o*o+s*s+l*l-t*t);if(d<0){const e=Math.max(-c/2,0),u=o+n*e,d=s+i*e,h=l+a*e,f=Math.hypot(u,d,h);return r[0]=u*t/f,r[1]=d*t/f,r[2]=h*t/f,!1}{const e=(-c-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(o,s,l);return r[0]=o*t/e,r[1]=s*t/e,r[2]=l*t/e,!1}return r[0]=o+n*e,r[1]=s+i*e,r[2]=l+a*e,!0}}}class Nd{constructor(e,t,r,n,i){this.TL=e,this.TR=t,this.BR=r,this.BL=n,this.horizon=i}static fromInvProjectionMatrix(e,t,r){const n=[-1,1,1],i=[1,1,1],a=[1,-1,1],o=[-1,-1,1],s=Td.transformMat4(n,n,e),l=Td.transformMat4(i,i,e),u=Td.transformMat4(a,a,e),c=Td.transformMat4(o,o,e);return new Nd(s,l,u,c,t/r)}}function qd(e,t,r){let n=1/0,i=-1/0;const a=[];for(const o of e){Td.sub(a,o,t);const e=Td.dot(a,r);n=Math.min(n,e),i=Math.max(i,e)}return[n,i]}function Ud(e,t){let r=!0;for(let n=0;n<e.planes.length;n++){const i=e.planes[n];let a=0;for(let e=0;e<t.length;e++)a+=Td.dot(i,t[e])+i[3]>=0;if(0===a)return 0;a!==t.length&&(r=!1)}return r?2:1}function jd(e,t){for(const r of e.projections){const n=qd(t,e.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function Gd(e,t){let r=0;const n=[0,0,0,0];for(let i=0;i<e.length;i++)n[0]=e[i][0],n[1]=e[i][1],n[2]=e[i][2],n[3]=1,ld.dot(n,t)>=0&&r++;return r}class zd{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Vd.fromPoints(this.points),this.projections=[],this.frustumEdges=[Td.sub([],this.points[2],this.points[3]),Td.sub([],this.points[0],this.points[3]),Td.sub([],this.points[4],this.points[0]),Td.sub([],this.points[5],this.points[1]),Td.sub([],this.points[6],this.points[2]),Td.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],r=[e[2],0,-e[0]];this.projections.push({axis:t,projection:qd(this.points,this.points[0],t)}),this.projections.push({axis:r,projection:qd(this.points,this.points[0],r)})}}static fromInvProjectionMatrix(e,t,r,n){const i=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const a=ld.transformMat4([],r,e),o=1/a[3]/t*i;return ld.mul(a,a,[o,o,n?1/a[3]:o,o])})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Td.sub([],a[e[0]],a[e[1]]),r=Td.sub([],a[e[2]],a[e[1]]),n=Td.normalize([],Td.cross([],t,r)),i=-Td.dot(n,a[e[1]]);return n.concat(i)})),s=[];for(let e=0;e<a.length;e++)s.push([a[e][0],a[e][1],a[e][2]]);return new zd(s,o)}intersectsPrecise(e,t,r){for(let r=0;r<t.length;r++)if(!Gd(e,t[r]))return 0;for(let t=0;t<this.planes.length;t++)if(!Gd(e,this.planes[t]))return 0;for(const t of r)for(const r of this.frustumEdges){const n=Td.cross([],t,r),i=Td.length(n);if(0===i)continue;Td.scale(n,n,1/i);const a=qd(this.points,this.points[0],n),o=qd(e,this.points[0],n);if(a[0]>o[1]||o[0]>a[1])return 0}return 1}}class Vd{static fromPoints(e){const t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)Td.min(t,t,n),Td.max(r,r,n);return new Vd(t,r)}static fromTileIdAndHeight(e,t,r){const n=1<<e.canonical.z,i=e.canonical.x,a=e.canonical.y;return new Vd([i/n,a/n,t],[(i+1)/n,(a+1)/n,r])}static applyTransform(e,t){const r=e.getCorners();for(let e=0;e<r.length;++e)Td.transformMat4(r[e],r[e],t);return Vd.fromPoints(r)}static projectAabbCorners(e,t){const r=e.getCorners();for(let e=0;e<r.length;++e)Td.transformMat4(r[e],r[e],t);return r}constructor(e,t){this.min=e,this.max=t,this.center=Td.scale([],Td.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=Td.clone(this.min),n=Td.clone(this.max);for(let e=0;e<t.length;e++)r[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Vd(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ud(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ud(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?jd(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?jd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ao(Vd,"Aabb");const $d=5,Hd=6,Wd=nn/Math.PI/2,Xd=16383,Yd=64,Zd=[Yd,32,16],Kd=-Wd,Jd=Wd,Qd=[new Vd([Kd,Kd,Kd],[Jd,Jd,Jd]),new Vd([Kd,Kd,Kd],[0,0,Jd]),new Vd([0,Kd,Kd],[Jd,0,Jd]),new Vd([Kd,0,Kd],[0,Jd,Jd]),new Vd([0,0,Kd],[Jd,Jd,Jd])];function eh(e){return e*Wd/Ih}function th(e,t,r,n=!0){const i=Td.scale([],e._camera.position,e.worldSize),a=[t,r,1,1];ld.transformMat4(a,a,e.pixelMatrixInverse),ld.scale(a,a,1/a[3]);const o=Td.sub([],a,i),s=Td.normalize([],o),l=e.globeMatrix,u=[l[12],l[13],l[14]],c=Td.sub([],u,i),d=Td.length(c),h=Td.normalize([],c),f=e.worldSize/(2*Math.PI),p=Td.dot(h,s),m=Math.asin(f/d);if(m<Math.acos(p)){if(!n)return null;const e=[],t=[];Td.scale(e,s,d/p),Td.normalize(t,Td.sub(t,e,c)),Td.normalize(s,Td.add(s,c,Td.scale(s,t,Math.tan(m)*d)))}const g=[];new Fd(i,s).closestPointOnSphere(u,f,g);const _=Td.normalize([],ie(l,0)),y=Td.normalize([],ie(l,1)),v=Td.normalize([],ie(l,2)),b=Td.dot(_,g),x=Td.dot(y,g),T=Td.dot(v,g),E=w(Math.asin(-x/f));let A=w(Math.atan2(b,T));A=e.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,A);const S=Uh(A),P=C(jh(E),0,1);return new Kh(S,P)}class rh{constructor(e,t,r){this.a=Td.sub([],e,r),this.b=Td.sub([],t,r),this.center=r;const n=Td.normalize([],this.a),i=Td.normalize([],this.b);this.angle=Math.acos(Td.dot(n,i))}}function nh(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,n){const i=Math.sin(r);return e*(Math.sin((1-n)*r)/i)+t*(Math.sin(n*r)/i)}(e.a[t],e.b[t],e.angle,C(r,0,1))+e.center[t]}function ih(e){if(e.z<=1)return Qd[e.z+2*e.y+e.x];const t=ch(uh(e));return Vd.fromPoints(t)}function ah(e,t,r){return Td.scale(e,e,1-r),Td.scaleAndAdd(e,e,t,r)}function oh(e,t){const r=xh(t.zoom);if(0===r)return ih(e);const n=uh(e),i=ch(n),a=Uh(n.getWest())*t.worldSize,o=Uh(n.getEast())*t.worldSize,s=jh(n.getNorth())*t.worldSize,l=jh(n.getSouth())*t.worldSize,u=[a,s,0],c=[o,s,0],d=[a,l,0],h=[o,l,0],f=gd.invert([],t.globeMatrix);return Td.transformMat4(u,u,f),Td.transformMat4(c,c,f),Td.transformMat4(d,d,f),Td.transformMat4(h,h,f),i[0]=ah(i[0],d,r),i[1]=ah(i[1],h,r),i[2]=ah(i[2],c,r),i[3]=ah(i[3],u,r),Vd.fromPoints(i)}function sh(e,t,r){for(const n of e)Td.transformMat4(n,n,t),Td.scale(n,n,r)}function lh(e,t,r,n){const i=t/e.worldSize,a=e.globeMatrix;if(r.z<=1){const e=ih(r).getCorners();return sh(e,a,i),Vd.fromPoints(e)}const o=uh(r,n),s=ch(o);sh(s,a,i);const l=Number.MAX_VALUE,u=[-l,-l,-l],c=[l,l,l];if(o.contains(e.center)){for(const e of s)Td.min(c,c,e),Td.max(u,u,e);u[2]=0;const t=e.point,r=[t.x*i,t.y*i,0];return Td.min(c,c,r),Td.max(u,u,r),new Vd(c,u)}const d=[a[12]*i,a[13]*i,a[14]*i],h=o.getCenter(),f=C(e.center.lat,-Hh,Hh),p=C(h.lat,-Hh,Hh),m=Uh(e.center.lng),g=jh(f);let _=m-Uh(h.lng);const y=g-jh(p);_>.5?_-=1:_<-.5&&(_+=1);let v=0;if(Math.abs(_)>Math.abs(y))v=_>=0?1:3;else{v=y>=0?0:2;const e=[a[4]*i,a[5]*i,a[6]*i],t=-Math.sin(T(y>=0?o.getSouth():o.getNorth()))*Wd;Td.scaleAndAdd(d,d,e,t)}const b=s[v],x=s[(v+1)%4],w=new rh(b,x,d),E=[nh(w,0)||b[0],nh(w,1)||b[1],nh(w,2)||b[2]],A=xh(e.zoom);if(A>0){const n=function({x:e,y:t,z:r},n,i,a,o){const s=1/(1<<r);let l=e*s,u=l+s,c=t*s,d=c+s,h=0;const f=(l+u)/2-a;return f>.5?h=-1:f<-.5&&(h=1),l=((l+h)*n-(a*=n))*i+a,u=((u+h)*n-a)*i+a,c=(c*n-(o*=n))*i+o,d=(d*n-o)*i+o,[[l,d,0],[u,d,0],[u,c,0],[l,c,0]]}(r,t,e._pixelsPerMercatorPixel,m,g);for(let e=0;e<s.length;e++)ah(s[e],n[e],A);const i=Td.add([],n[v],n[(v+1)%4]);Td.scale(i,i,.5),ah(E,i,A)}for(const e of s)Td.min(c,c,e),Td.max(u,u,e);return c[2]=Math.min(b[2],x[2]),Td.min(c,c,E),Td.max(u,u,E),new Vd(c,u)}function uh({x:e,y:t,z:r},n=!1){const i=1/(1<<r),a=new Bh(zh(e*i),t===(1<<r)-1&&n?-90:Vh((t+1)*i)),o=new Bh(zh((e+1)*i),0===t&&n?90:Vh(t*i));return new Zl(a,o)}function ch(e){const t=T(e.getNorth()),r=T(e.getSouth()),n=Math.cos(t),i=Math.cos(r),a=Math.sin(t),o=Math.sin(r),s=e.getWest(),l=e.getEast();return[dh(i,o,s),dh(i,o,l),dh(n,a,l),dh(n,a,s)]}function dh(e,t,r,n=Wd){return r=T(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function hh(e,t,r){return dh(Math.cos(T(e)),Math.sin(T(e)),t,r)}function fh(e,t,r,n){const i=1<<r.z,a=(e/nn+r.x)/i;return hh(Vh((t/nn+r.y)/i),zh(a),n)}function ph({min:e,max:t}){return Xd/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const mh=new Float64Array(16);function gh(e){const t=ph(e),r=gd.fromScaling(mh,[t,t,t]);return gd.translate(r,r,Td.negate([],e.min))}function _h(e){const t=gd.fromTranslation(mh,e.min),r=1/ph(e);return gd.scale(t,t,[r,r,r])}function yh(e){const t=nn/(2*Math.PI);return e/(2*Math.PI)/t}function vh(e,t){return nn/(512*Math.pow(2,e))*ph(ih(t))}function bh(e,t,r,n,i){const a=yh(r),o=[e,t,-r/(2*Math.PI)],s=gd.identity(new Float64Array(16));return gd.translate(s,s,o),gd.scale(s,s,[a,a,a]),gd.rotateX(s,s,T(-i)),gd.rotateY(s,s,T(-n)),s}function xh(e){return O($d,Hd,e)}function Th(e,t,r){const n=gd.identity(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return gd.rotateY(n,r.globeMatrix,i),Float32Array.from(n)}function wh(e,t,r){const n=xh(r.zoom),i=e.style.map._antialias,a=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!i&&!a}function Eh(e,t,r,n){const i=t.getNorth(),a=t.getSouth(),o=t.getWest(),s=t.getEast(),l=1<<e.z,u=s-o,c=i-a,d=u/Yd,h=-c/Zd[r],f=[0,d,0,h,0,0,i,o,0];if(e.z>0){const e=180/n;pd.multiply(f,f,[e/u+1,0,0,0,e/c+1,0,-.5*e/d,.5*e/h,1])}return f[2]=l,f[5]=e.x,f[8]=e.y,f}function Ah(e){const t=Hh-5;e=C(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(T(e))),3);return Math.round(r*(Zd.length-1))}function Sh(e){const t=[0,0,0],r=gd.identity(new Float64Array(16));return gd.multiply(r,e.pixelMatrix,e.globeMatrix),Td.transformMat4(t,t,r),new y(t[0],t[1])}function Ph(e,t){const r=hh(t.lat,t.lng),n=function(e){const t=hh(e._center.lat,e._center.lng),r=Td.fromValues(0,1,0);let n=Td.cross([],r,t);const i=gd.fromRotation([],-e.angle,t);n=Td.transformMat4(n,n,i),gd.fromRotation(i,-e._pitch,n);const a=Td.normalize([],t);return Td.scale(a,a,eh(e.cameraToCenterDistance/e.pixelsPerMeter)),Td.transformMat4(a,a,i),Td.add([],t,a)}(e),i=Td.subtract([],n,r);return Td.angle(i,r)}function Mh(e,t){return Ph(e,t)>Math.PI/2*1.01}const Rh=T(85),Ch=Math.cos(Rh),Oh=Math.sin(Rh);class Lh{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new bs,n=new Ns,i=[],a=e+1+2,o=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,r)=>{let n=e===a-1?e-2:0===e?e:e-1;return n+=r?24575:0,[n,t]};for(let e=0;e<a;++e)r.emplaceBack(...l(e,0,!0));for(let e=0;e<o;++e)for(let t=0;t<a;++t)r.emplaceBack(...l(t,e,(0===t||t===a-1)&&!0));for(let e=0;e<t.length;++e){const n=t[e];for(let e=0;e<a;++e)r.emplaceBack(...l(e,n,!0))}for(let e=0;e<t.length;++e){const o=n.length,l=t[e]+1+2,u=new Ns;for(let r=0;r<l-1;r++){const i=r===l-2,o=i?a*(s-t.length+e-r):a;for(let e=0;e<a-1;e++){const t=r*a+e;0===r||i||0===e||e===a-2?(u.emplaceBack(t+1,t,t+o),u.emplaceBack(t+o,t+o+1,t+1)):(n.emplaceBack(t+1,t,t+o),n.emplaceBack(t+o,t+o+1,t+1))}}const c=ul.simpleSegment(0,o,r.length,n.length-o);for(let e=0;e<u.uint16.length;e+=3)n.emplaceBack(u.uint16[e],u.uint16[e+1],u.uint16[e+2]);const d=ul.simpleSegment(0,o,r.length,n.length-o);i.push({withoutSkirts:c,withSkirts:d})}return{vertices:r,indices:n,segments:i}}_createGrid(e){const t=this._fillGridMeshWithLods(Yd,Zd);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Rd.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ns;for(let e=0;e<=Yd;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new Gs,n=new Gs,i=new Gs,a=new Gs;this._poleSegments=[];for(let e=0,t=0;e<$d;e++){const o=360/(1<<e);r.emplaceBack(0,-Wd,0,.5,0),n.emplaceBack(0,-Wd,0,.5,1),i.emplaceBack(0,-Wd,0,.5,.5),a.emplaceBack(0,-Wd,0,.5,.5);for(let e=0;e<=Yd;e++){let t=e/Yd,s=0;const l=Hn(0,o,t),[u,c,d]=dh(Ch,Oh,l,Wd);r.emplaceBack(u,c,d,t,s),n.emplaceBack(u,c,d,t,1-s);const h=T(l);t=.5+.5*Math.sin(h),s=.5+.5*Math.cos(h),i.emplaceBack(u,c,d,t,s),a.emplaceBack(u,c,d,t,1-s)}this._poleSegments.push(ul.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Pd,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Pd,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(i,Pd,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,Pd,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Ih=6371008.8,Dh=2*Math.PI*Ih;class kh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kh(L(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Ih*Math.acos(Math.min(i,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Zl(new kh(this.lng-r,this.lat-t),new kh(this.lng+r,this.lat+t))}toEcef(e){const t=eh(e);return hh(this.lat,this.lng,Wd+t)}static convert(e){if(e instanceof kh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new kh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new kh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Bh=kh;const Fh=0,Nh=25.5;function qh(e){return Dh*Math.cos(e*Math.PI/180)}function Uh(e){return(180+e)/360}function jh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Gh(e,t){return e/qh(t)}function zh(e){return 360*e-180}function Vh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function $h(e,t){return e*qh(Vh(t))}const Hh=85.051129;function Wh(e){return Math.cos(T(C(e,-Hh,Hh)))}function Xh(e,t){const r=C(t,Fh,Nh),n=Math.pow(2,r);return Wh(e)*Dh/(512*n)}function Yh(e){return 1/Math.cos(e*Math.PI/180)}function Zh(e,t=0){const r=Math.exp(Math.PI*(1-(e.y+t/nn)/(1<<e.z)*2));return 80150034*r/(r*r+1)/nn/(1<<e.z)}class Kh{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){const r=Bh.convert(e);return new Kh(Uh(r.lng),jh(r.lat),Gh(t,r.lat))}toLngLat(){return new Bh(zh(this.x),Vh(this.y))}toAltitude(){return $h(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Dh*Yh(Vh(this.y))}}function Jh(e,t,r,n,i,a,o,s,l){const u=(t+n)/2,c=(r+i)/2,d=new y(u,c);s(d),function(e,t,r,n,i,a){const o=r-i,s=n-a;return Math.abs((n-t)*o-(r-e)*s)/Math.hypot(o,s)}(d.x,d.y,a.x,a.y,o.x,o.y)>=l?(Jh(e,t,r,u,c,a,d,s,l),Jh(e,u,c,n,i,d,o,s,l)):e.push(o)}function Qh(e,t,r){let n=e[0],i=n.x,a=n.y;t(n);const o=[n];for(let s=1;s<e.length;s++){const l=e[s],{x:u,y:c}=l;t(l),Jh(o,i,a,u,c,n,l,t,r),i=u,a=c,n=l}return o}function ef(e,t,r,n){if(n(t,r)){const i=t.add(r)._mult(.5);ef(e,t,i,n),ef(e,i,r,n)}else e.push(r)}function tf(e,t){let r=e[0];const n=[r];for(let i=1;i<e.length;i++){const a=e[i];ef(n,r,a,t),r=a}return n}const rf=Math.pow(2,14)-1,nf=-rf-1;function af(e,t){const r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=C(r,nf,rf),e.y=C(n,nf,rf),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&X("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function of(e,t,r){const n=e.loadGeometry(),i=e.extent,a=nn/i;if(t&&r&&r.projection.isReprojectedInTileSpace){const a=1<<t.z,{scale:o,x:s,y:l,projection:u}=r,c=e=>{const r=zh((t.x+e.x/i)/a),n=Vh((t.y+e.y/i)/a),c=u.project(r,n);e.x=(c.x*o-s)*i,e.y=(c.y*o-l)*i};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=Qh(n[t],c,1);else{const e=[];for(const r of n[t])r.x<0||r.x>=i||r.y<0||r.y>=i||(c(r),e.push(r));n[t]=e}}for(const e of n)for(const t of e)af(t,a);return n}function sf(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?of(e):[]}}function lf(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}function uf(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class cf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new bs,this.indexArray=new Ns,this.segments=new ul,this.programConfigurations=new Vl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){const i=this.layers[0],a=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=sf(t,e);if(!this.layers[0]._featureFilter.filter(new Ko(this.zoom),u,r))continue;const c=o?o.evaluate(u,{},r):void 0,d={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:s,geometry:e?u.geometry:of(t,r,n),patterns:{},sortKey:c};a.push(d)}o&&a.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Ms,s=n.projection);for(const n of a){const{geometry:i,index:a,sourceLayerIndex:o}=n,l=e[a].feature;this.addFeature(n,i,a,t.availableImages,r,s,t.brightness),t.featureIndex.insert(l,i,a,o,this.index)}}update(e,t,r,n,i){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,r,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ll.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,n,i,a,o){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(r<0||r>=nn||n<0||n>=nn)continue;if(a){const e=a.projectTilePoint(r,n,i),t=a.upVector(i,r,n),o=this.globeExtVertexArray;uf(o,e,t),uf(o,e,t),uf(o,e,t),uf(o,e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=o.vertexLength;lf(this.layoutVertexArray,r,n,-1,-1),lf(this.layoutVertexArray,r,n,1,-1),lf(this.layoutVertexArray,r,n,1,1),lf(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i,o)}}function df(e,t){for(let r=0;r<e.length;r++)if(bf(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(bf(e,t[r]))return!0;return!!mf(e,t)}function hf(e,t,r){return!!bf(e,t)||!!_f(t,e,r)}function ff(e,t){if(1===e.length)return vf(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(bf(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(vf(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(mf(e,t[r]))return!0;return!1}function pf(e,t,r){if(e.length>1){if(mf(e,t))return!0;for(let n=0;n<t.length;n++)if(_f(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(_f(e[n],t,r))return!0;return!1}function mf(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)if(gf(n,i,t[e],t[e+1]))return!0}return!1}function gf(e,t,r,n){return Y(e,r,n)!==Y(t,r,n)&&Y(e,t,r)!==Y(e,t,n)}function _f(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let r=1;r<t.length;r++)if(yf(e,t[r-1],t[r])<n)return!0;return!1}function yf(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function vf(e,t){let r,n,i,a=!1;for(let o=0;o<e.length;o++){r=e[o];for(let e=0,o=r.length-1;e<r.length;o=e++)n=r[e],i=r[o],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(a=!a)}return a}function bf(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const a=e[n],o=e[i];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(r=!r)}return r}function xf(e,t,r,n,i){for(const a of e)if(t<=a.x&&r<=a.y&&n>=a.x&&i>=a.y)return!0;const a=[new y(t,r),new y(t,i),new y(n,i),new y(n,r)];if(e.length>2)for(const t of a)if(bf(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Tf(e[t],e[t+1],a))return!0;return!1}function Tf(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const a=Y(e,t,r[0]);return a!==Y(e,t,r[1])||a!==Y(e,t,r[2])||a!==Y(e,t,r[3])}function wf(e,t,r,n,i,a){let o=t.y-e.y,s=e.x-t.x;if(a=a||0){const e=o*o+s*s;if(0===e)return!0;const t=Math.sqrt(e);o/=t,s/=t}return!((r.x-e.x)*o+(r.y-e.y)*s-a<0||(n.x-e.x)*o+(n.y-e.y)*s-a<0||(i.x-e.x)*o+(i.y-e.y)*s-a<0)}function Ef(e,t,r,n,i,a,o){return!(wf(e,t,n,i,a,o)||wf(t,r,n,i,a,o)||wf(r,e,n,i,a,o)||wf(n,i,e,t,r,o)||wf(i,a,e,t,r,o)||wf(a,n,e,t,r,o))}function Af(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Sf(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Pf(e,t,r,n,i){if(!t[0]&&!t[1])return e;const a=y.convert(t)._mult(i);"viewport"===r&&a._rotate(-n);const o=[];for(let t=0;t<e.length;t++)o.push(e[t].sub(a));return o}function Mf(e,t,r,n){const i=y.convert(e)._mult(n);return"viewport"===t&&i._rotate(-r),i}Ao(cf,"CircleBucket",{omit:["layers"]});const Rf=new us({"circle-sort-key":new ss(St.layout_circle["circle-sort-key"]),visibility:new os(St.layout_circle.visibility)});var Cf={paint:new us({"circle-radius":new ss(St.paint_circle["circle-radius"]),"circle-color":new ss(St.paint_circle["circle-color"]),"circle-blur":new ss(St.paint_circle["circle-blur"]),"circle-opacity":new ss(St.paint_circle["circle-opacity"]),"circle-translate":new os(St.paint_circle["circle-translate"]),"circle-translate-anchor":new os(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new os(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new os(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ss(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ss(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ss(St.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new os(St.paint_circle["circle-emissive-strength"])}),layout:Rf};const Of=gd.create(),Lf=(e,t,r,n,i,a)=>{const o=e.transform,s="globe"===o.projection.name;let l;if("map"===a.paint.get("circle-pitch-alignment"))if(s){const e=vh(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=o.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:st.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Of,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(s){u.u_inv_rot_matrix=n,u.u_merc_center=i,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=xh(o.zoom);const e=i[0]*nn,r=i[1]*nn;u.u_up_dir=o.projection.upVector(new Ld(0,0,0),e,r)}return u},If=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Df(e,t,r,n,i,a,o,s,l){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(l*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,c=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const d of t)for(const t of d){const d=t.add(s),h=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(d.x,d.y,!0):0,f=r.projection.projectTilePoint(d.x,d.y,u);if(h>0){const e=r.projection.upVector(u,d.x,d.y);f.x+=e[0]*c*h,f.y+=e[1]*c*h,f.z+=e[2]*c*h}const p=a?d:kf(f.x,f.y,f.z,n),m=a?e.tilespaceRays.map((e=>Nf(e,h))):e.queryGeometry.screenGeometry,g=ld.transformMat4([],[f.x,f.y,f.z,1],n);if(!o&&a?l*=g[3]/r.cameraToCenterDistance:o&&!a&&(l*=r.cameraToCenterDistance/g[3]),a){const e=Vh((t.y/nn+u.y)/(1<<u.z));l/=r.projection.pixelsPerMeter(e,1)/Gh(1,e)}if(hf(m,p,l))return!0}return!1}function kf(e,t,r,n){const i=ld.transformMat4([],[e,t,r,1],n);return new y(i[0]/i[3],i[1]/i[3])}const Bf=Td.fromValues(0,0,0),Ff=Td.fromValues(0,0,1);function Nf(e,t){const r=Td.create();return Bf[2]=t,e.intersectsPlane(Bf,Ff,r),new y(r[0],r[1])}class qf extends cf{}function Uf(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*r*n);return e.width=t,e.height=r,e.data=i,e}function jf(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(Gf(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function Gf(e,t,r,n,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=e.data,s=t.data;for(let l=0;l<i.height;l++){const u=((r.y+l)*e.width+r.x)*a,c=((n.y+l)*t.width+n.x)*a;for(let e=0;e<i.width*a;e++)s[c+e]=o[u+e]}return t}Ao(qf,"HeatmapBucket",{omit:["layers"]});class zf{constructor(e,t){Uf(this,e,1,t)}resize(e){jf(this,new zf(e),1)}clone(){return new zf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Gf(e,t,r,n,i,1)}}class Vf{constructor(e,t){Uf(this,e,4,t)}resize(e){jf(this,new Vf(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Vf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Gf(e,t,r,n,i,4)}}class $f{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}Ao(zf,"AlphaImage"),Ao(Vf,"RGBAImage");const Hf=new us({visibility:new os(St.layout_heatmap.visibility)});var Wf={paint:new us({"heatmap-radius":new ss(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ss(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new os(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ls(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new os(St.paint_heatmap["heatmap-opacity"])}),layout:Hf};function Xf(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new Vf({width:r,height:n}),a=(r,n,a)=>{t[e.evaluationKey]=a;const o=e.expression.evaluate(t);o&&(i.data[r+n+0]=Math.floor(255*o.r/o.a),i.data[r+n+1]=Math.floor(255*o.g/o.a),i.data[r+n+2]=Math.floor(255*o.b/o.a),i.data[r+n+3]=Math.floor(255*o.a))};if(e.clips)for(let t=0,i=0;t<n;++t,i+=4*r)for(let n=0,o=0;n<r;n++,o+=4){const s=n/(r-1),{start:l,end:u}=e.clips[t];a(i,o,l*(1-s)+u*s)}else for(let e=0,t=0;e<r;e++,t+=4)a(0,t,e/(r-1));return i}const Yf=new us({visibility:new os(St.layout_hillshade.visibility)});var Zf={paint:new us({"hillshade-illumination-direction":new os(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new os(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new os(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new os(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new os(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new os(St.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new os(St.paint_hillshade["hillshade-emissive-strength"])}),layout:Yf};const Kf=ys([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jf}=Kf;var Qf={exports:{}};function ep(e,t,r){r=r||2;var n,i,a,o,s,l,u,c=t&&t.length,d=c?t[0]*r:e.length,h=tp(e,0,d,r,!0),f=[];if(!h||h.next===h.prev)return f;if(c&&(h=function(e,t,r,n){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=tp(e,t[i]*n,i<a-1?t[i+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),s.push(hp(o));for(s.sort(lp),i=0;i<s.length;i++)r=up(s[i],r);return r}(e,t,h,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var p=r;p<d;p+=r)(s=e[p])<n&&(n=s),(l=e[p+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-n,o-i))?32767/u:0}return np(h,f,r,n,i,u,0),f}function tp(e,t,r,n,i){var a,o;if(i===Ap(e,t,r,n)>0)for(a=t;a<r;a+=n)o=Tp(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=Tp(a,e[a],e[a+1],o);return o&&gp(o,o.next)&&(wp(o),o=o.next),o}function rp(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!gp(n,n.next)&&0!==mp(n.prev,n,n.next))n=n.next;else{if(wp(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function np(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{0===i.z&&(i.z=dp(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?ap(e,n,i,a):ip(e))t.push(s.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),wp(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?np(e=op(rp(e),t,r),t,r,n,i,a,2):2===o&&sp(e,t,r,n,i,a):np(rp(e),t,r,n,i,a,1);break}}}function ip(e){var t=e.prev,r=e,n=e.next;if(mp(t,r,n)>=0)return!1;for(var i=t.x,a=r.x,o=n.x,s=t.y,l=r.y,u=n.y,c=i<a?i<o?i:o:a<o?a:o,d=s<l?s<u?s:u:l<u?l:u,h=i>a?i>o?i:o:a>o?a:o,f=s>l?s>u?s:u:l>u?l:u,p=n.next;p!==t;){if(p.x>=c&&p.x<=h&&p.y>=d&&p.y<=f&&fp(i,s,a,l,o,u,p.x,p.y)&&mp(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ap(e,t,r,n){var i=e.prev,a=e,o=e.next;if(mp(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,d=a.y,h=o.y,f=s<l?s<u?s:u:l<u?l:u,p=c<d?c<h?c:h:d<h?d:h,m=s>l?s>u?s:u:l>u?l:u,g=c>d?c>h?c:h:d>h?d:h,_=dp(f,p,t,r,n),y=dp(m,g,t,r,n),v=e.prevZ,b=e.nextZ;v&&v.z>=_&&b&&b.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==o&&fp(s,c,l,d,u,h,v.x,v.y)&&mp(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&fp(s,c,l,d,u,h,b.x,b.y)&&mp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==o&&fp(s,c,l,d,u,h,v.x,v.y)&&mp(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&fp(s,c,l,d,u,h,b.x,b.y)&&mp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function op(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!gp(i,a)&&_p(i,n,n.next,a)&&bp(i,a)&&bp(a,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(a.i/r|0),wp(n),wp(n.next),n=e=a),n=n.next}while(n!==e);return rp(n)}function sp(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&pp(o,s)){var l=xp(o,s);return o=rp(o,o.next),l=rp(l,l.next),np(o,t,r,n,i,a,0),void np(l,t,r,n,i,a,0)}s=s.next}o=o.next}while(o!==e)}function lp(e,t){return e.x-t.x}function up(e,t){var r=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o&&(o=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==t);if(!r)return null;var l,u=r,c=r.x,d=r.y,h=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&fp(a<d?i:o,a,c,d,a<d?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),bp(n,e)&&(l<h||l===h&&(n.x>r.x||n.x===r.x&&cp(r,n)))&&(r=n,h=l)),n=n.next}while(n!==u);return r}(e,t);if(!r)return t;var n=xp(r,e);return rp(n,n.next),rp(r,r.next)}function cp(e,t){return mp(e.prev,e,t.prev)<0&&mp(t.next,e,e.next)<0}function dp(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hp(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function fp(e,t,r,n,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(n-s)>=(r-o)*(t-s)&&(r-o)*(a-s)>=(i-o)*(n-s)}function pp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&_p(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(bp(e,t)&&bp(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(mp(e.prev,e,t.prev)||mp(e,t.prev,t))||gp(e,t)&&mp(e.prev,e,e.next)>0&&mp(t.prev,t,t.next)>0)}function mp(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function gp(e,t){return e.x===t.x&&e.y===t.y}function _p(e,t,r,n){var i=vp(mp(e,t,r)),a=vp(mp(e,t,n)),o=vp(mp(r,n,e)),s=vp(mp(r,n,t));return i!==a&&o!==s||!(0!==i||!yp(e,r,t))||!(0!==a||!yp(e,n,t))||!(0!==o||!yp(r,e,n))||!(0!==s||!yp(r,t,n))}function yp(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function vp(e){return e>0?1:e<0?-1:0}function bp(e,t){return mp(e.prev,e,e.next)<0?mp(e,t,e.next)>=0&&mp(e,e.prev,t)>=0:mp(e,t,e.prev)<0||mp(e,e.next,t)<0}function xp(e,t){var r=new Ep(e.i,e.x,e.y),n=new Ep(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Tp(e,t,r,n){var i=new Ep(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function wp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ep(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ap(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}Qf.exports=ep,Qf.exports.default=ep,ep.deviation=function(e,t,r,n){var i=t&&t.length,a=Math.abs(Ap(e,0,i?t[0]*r:e.length,r));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Ap(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r));var l=0;for(o=0;o<n.length;o+=3){var u=n[o]*r,c=n[o+1]*r,d=n[o+2]*r;l+=Math.abs((e[u]-e[d])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[d+1]-e[u+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},ep.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&r.holes.push(n+=e[i-1].length)}return r};var Sp=h(Qf.exports);function Pp(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,a;for(let t=0;t<r;t++){const r=Z(e[t]);0!==r&&(e[t].area=Math.abs(r),void 0===a&&(a=r<0),a===r<0?(i&&n.push(i),i=[e[t]]):i.push(e[t]))}if(i&&n.push(i),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(Lr(n[e],t,1,n[e].length-1,Mp),n[e]=n[e].slice(0,t));return n}function Mp(e,t){return t.area-e.area}function Rp(e,t,r){const n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const a=t.constantOr(null);a&&(i=!0,n[a]=!0)}return i}function Cp(e,t,r,n,i){const a=i.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},r,{},i.availableImages);e=e&&e.name?e.name:e,a[e]=!0,r.patterns[o.id]=e}}return r}class Op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bs,this.indexArray=new Ns,this.indexArray2=new Ls,this.programConfigurations=new Vl(e.layers,e.zoom),this.segments=new ul,this.segments2=new ul,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,n){this.hasPattern=Rp("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=sf(o,e);if(!this.layers[0]._featureFilter.filter(new Ko(this.zoom),c,r))continue;const d=i?i.evaluate(c,{},r,t.availableImages):void 0,h={id:s,properties:o.properties,type:o.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:of(o,r,n),patterns:{},sortKey:d};a.push(h)}i&&a.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of a){const{geometry:i,index:a,sourceLayerIndex:o}=n;if(this.hasPattern){const e=Cp("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,a,r,{},t.availableImages,t.brightness);t.featureIndex.insert(e[a].feature,i,a,o,this.index)}}update(e,t,r,n,i){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,r,n,i)}addFeatures(e,t,r,n,i,a){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,n,i,a=[],o){for(const e of Pp(t,500)){let t=0;for(const r of e)t+=r.length;const r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=r.vertexLength,i=[],a=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&a.push(i.length/2);const r=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=r.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),i.push(t[e].x),i.push(t[e].y);r.vertexLength+=t.length,r.primitiveLength+=t.length}const o=Sp(i,a);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(n+o[e],n+o[e+1],n+o[e+2]);r.vertexLength+=t,r.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,a,n,o)}}Ao(Op,"FillBucket",{omit:["layers","patternFeatures"]});const Lp=new us({"fill-sort-key":new ss(St.layout_fill["fill-sort-key"]),visibility:new os(St.layout_fill.visibility)});var Ip={paint:new us({"fill-antialias":new os(St.paint_fill["fill-antialias"]),"fill-opacity":new ss(St.paint_fill["fill-opacity"]),"fill-color":new ss(St.paint_fill["fill-color"]),"fill-outline-color":new ss(St.paint_fill["fill-outline-color"]),"fill-translate":new os(St.paint_fill["fill-translate"]),"fill-translate-anchor":new os(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new ss(St.paint_fill["fill-pattern"]),"fill-emissive-strength":new os(St.paint_fill["fill-emissive-strength"])}),layout:Lp};const Dp=ys([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),kp=ys([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Bp=ys([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fp=ys([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Np=ys([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qp}=Dp;var Up={},jp=g,Gp=zp;function zp(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Vp,this,t)}function Vp(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function $p(e){for(var t,r,n=0,i=0,a=e.length,o=a-1;i<a;o=i++)n+=((r=e[o]).x-(t=e[i]).x)*(t.y+r.y);return n}zp.types=["Unknown","Point","LineString","Polygon"],zp.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,i=0,a=0,o=0,s=[];e.pos<r;){if(i<=0){var l=e.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)a+=e.readSVarint(),o+=e.readSVarint(),1===n&&(t&&s.push(t),t=[]),t.push(new jp(a,o));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&s.push(t),s},zp.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(n<=0){var c=e.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,l,s,u]},zp.prototype.toGeoJSON=function(e,t,r){var n,i,a=this.extent*Math.pow(2,r),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),u=zp.types[this.type];function c(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(n=0;n<l.length;n++)d[n]=l[n][0];c(l=d);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],a=0;a<t;a++){var o=$p(e[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var h={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h};var Hp=Gp,Wp=Xp;function Xp(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Yp,this,t),this.length=this._features.length}function Yp(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}Xp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Hp(this._pbf,t,this.extent,this._keys,this._values)};var Zp=Wp;function Kp(e,t,r){if(3===e){var n=new Zp(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}var Jp=Up.VectorTile=function(e,t){this.layers=e.readFields(Kp,{},t)},Qp=Up.VectorTileFeature=Gp;function em(e,t,r,n){const i=[],a=0===n?(e,t,r,n,i,a)=>{e.push(new y(a,r+(a-t)/(n-t)*(i-r)))}:(e,t,r,n,i,a)=>{e.push(new y(t+(a-r)/(i-r)*(n-t),a))};for(const o of e){const e=[];for(const i of o){if(i.length<=2)continue;const o=[];for(let e=0;e<i.length-1;e++){const s=i[e].x,l=i[e].y,u=i[e+1].x,c=i[e+1].y,d=0===n?s:l,h=0===n?u:c;d<t?h>t&&a(o,s,l,u,c,t):d>r?h<r&&a(o,s,l,u,c,r):o.push(i[e]),h<t&&d>=t&&a(o,s,l,u,c,t),h>r&&d<=r&&a(o,s,l,u,c,r)}let s=i[i.length-1];const l=0===n?s.x:s.y;l>=t&&l<=r&&o.push(s),o.length&&(s=o[o.length-1],o[0].x===s.x&&o[0].y===s.y||o.push(o[0]),e.push(o))}e.length&&i.push(e)}return i}Up.VectorTileLayer=Wp;class tm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var rm={read:function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,d=r?i-1:0,h=r?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+d],d+=h,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},write:function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=p,o/=256,u-=8);e[r+f-p]|=128*m}},nm=am,im=rm;function am(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}am.Varint=0,am.Fixed64=1,am.Bytes=2,am.Fixed32=5;var om=4294967296,sm=1/om,lm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function um(e){return e.type===am.Bytes?e.readVarint()+e.pos:e.pos+1}function cm(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dm(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function hm(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function fm(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function pm(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function mm(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function gm(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function _m(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function ym(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function vm(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function bm(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function xm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Tm(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function wm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}am.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,e(i,t,this),this.pos===a&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=xm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=wm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=xm(this.buf,this.pos)+xm(this.buf,this.pos+4)*om;return this.pos+=8,e},readSFixed64:function(){var e=xm(this.buf,this.pos)+wm(this.buf,this.pos+4)*om;return this.pos+=8,e},readFloat:function(){var e=im.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=im.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,a=r.buf;if(n=(112&(i=a[r.pos++]))>>4,i<128)return cm(e,n,t);if(n|=(127&(i=a[r.pos++]))<<3,i<128)return cm(e,n,t);if(n|=(127&(i=a[r.pos++]))<<10,i<128)return cm(e,n,t);if(n|=(127&(i=a[r.pos++]))<<17,i<128)return cm(e,n,t);if(n|=(127&(i=a[r.pos++]))<<24,i<128)return cm(e,n,t);if(n|=(1&(i=a[r.pos++]))<<31,i<128)return cm(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&lm?function(e,t,r){return lm.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var n="",i=t;i<r;){var a,o,s,l=e[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(a=e[i+1]))&&(u=(31&l)<<6|63&a)<=127&&(u=null):3===c?(o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&((u=(15&l)<<12|(63&a)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&((u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==am.Bytes)return e.push(this.readVarint(t));var r=um(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==am.Bytes)return e.push(this.readSVarint());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==am.Bytes)return e.push(this.readBoolean());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==am.Bytes)return e.push(this.readFloat());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==am.Bytes)return e.push(this.readDouble());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==am.Bytes)return e.push(this.readFixed32());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==am.Bytes)return e.push(this.readSFixed32());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==am.Bytes)return e.push(this.readFixed64());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==am.Bytes)return e.push(this.readSFixed64());var t=um(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===am.Varint)for(;this.buf[this.pos++]>127;);else if(t===am.Bytes)this.pos=this.readVarint()+this.pos;else if(t===am.Fixed32)this.pos+=4;else{if(t!==am.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Tm(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Tm(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Tm(this.buf,-1&e,this.pos),Tm(this.buf,Math.floor(e*sm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Tm(this.buf,-1&e,this.pos),Tm(this.buf,Math.floor(e*sm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,a=0;a<t.length;a++){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dm(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),im.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),im.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&dm(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,am.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,hm,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,fm,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,gm,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,pm,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,mm,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,_m,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,ym,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,vm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,bm,t)},writeBytesField:function(e,t){this.writeTag(e,am.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,am.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,am.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,am.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,am.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,am.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,am.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,am.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,am.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,am.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Em=h(nm);const Am=["tile","layer","source","sourceLayer","state"];class Sm{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Am)void 0!==this[t]&&(e[t]=this[t]);return e}}class Pm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},k(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const r=String(t),n=k({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const r=this.deletedStates[e][t];if(null===r)return{};for(const e in r)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),k(this.state[e][r],this.stateChanges[e][r]),t[r]=this.state[e][r];r[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const r in this.state[e])t[r]={},this.state[e][r]={};else for(const r in this.deletedStates[e]){if(null===this.deletedStates[e][r])this.state[e][r]={};else if(this.state[e][r])for(const t of Object.keys(this.deletedStates[e][r]))delete this.state[e][r][t];t[r]=this.state[e][r]}r[e]=r[e]||{},k(r[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].setFeatureState(r,t)}}class Mm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Rm(e,t,r,n){let i=0,a=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(r[o]<e[o]||r[o]>t[o])return null}else{const s=1/n[o];let l=(e[o]-r[o])*s,u=(t[o]-r[o])*s;if(l>u){const e=l;l=u,u=e}if(l>i&&(i=l),u<a&&(a=u),i>a)return null}return i}function Cm(e,t,r,n,i,a,o,s,l,u,c){const d=n-e,h=i-t,f=a-r,p=o-e,m=s-t,g=l-r,_=c[1]*g-c[2]*m,y=c[2]*p-c[0]*g,v=c[0]*m-c[1]*p,b=d*_+h*y+f*v;if(Math.abs(b)<1e-15)return null;const x=1/b,T=u[0]-e,w=u[1]-t,E=u[2]-r,A=(T*_+w*y+E*v)*x;if(A<0||A>1)return null;const S=w*f-E*h,P=E*d-T*f,M=T*h-w*d,R=(c[0]*S+c[1]*P+c[2]*M)*x;return R<0||A+R>1?null:(p*S+m*P+g*M)*x}function Om(e,t,r){return(e-t)/(r-t)}function Lm(e,t,r,n,i,a,o,s,l){const u=1<<r,c=a-n,d=o-i,h=(e+1)/u*c+n,f=(t+0)/u*d+i,p=(t+1)/u*d+i;s[0]=(e+0)/u*c+n,s[1]=f,l[0]=h,l[1]=p}class Im{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let n=Math.ceil(Math.pow(2,t));const i=1/n,a=(e,t,r,n,i)=>{const a=n?1:0,o=(e+1)*r-a,s=t*r,l=(t+1)*r-a;i[0]=e*r,i[1]=s,i[2]=o,i[3]=l};let o=new Mm(n);const s=[];for(let t=0;t<n*n;t++){a(t%n,Math.floor(t/n),i,!1,s);const r=km(s[0],s[1],e),l=km(s[2],s[1],e),u=km(s[2],s[3],e),c=km(s[0],s[3],e);o.minimums.push(Math.min(r,l,u,c)),o.maximums.push(Math.max(r,l,u,c)),o.leaves.push(1)}for(r.push(o),n/=2;n>=1;n/=2){const e=r[r.length-1];o=new Mm(n);for(let t=0;t<n*n;t++){a(t%n,Math.floor(t/n),2,!0,s);const r=e.getElevation(s[0],s[1]),i=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),u=e.getElevation(s[0],s[3]),c=e.isLeaf(s[0],s[1]),d=e.isLeaf(s[2],s[1]),h=e.isLeaf(s[2],s[3]),f=e.isLeaf(s[0],s[3]),p=Math.min(r.min,i.min,l.min,u.min),m=Math.max(r.max,i.max,l.max,u.max),g=c&&d&&h&&f;o.maximums.push(m),o.minimums.push(p),o.leaves.push(m-p<=5&&g?1:0)}r.push(o)}return r}(this.dem),r=t.length-1,n=t[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,n,i,a,o=1){return Rm([e,t,-100],[r,n,this.maximums[0]*o],i,a)}raycast(e,t,r,n,i,a,o=1){if(!this.nodeCount)return null;const s=this.raycastRoot(e,t,r,n,i,a,o);if(null==s)return null;const l=[],u=[],c=[],d=[],h=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;h.length>0;){const{idx:s,t:f,nodex:p,nodey:m,depth:g}=h.pop();if(this.leaves[s]){Lm(p,m,g,e,t,r,n,c,d);const s=1<<g,l=(p+0)/s,u=(p+1)/s,h=(m+0)/s,_=(m+1)/s,y=km(l,h,this.dem)*o,v=km(u,h,this.dem)*o,b=km(u,_,this.dem)*o,x=km(l,_,this.dem)*o,T=Cm(c[0],c[1],y,d[0],c[1],v,d[0],d[1],b,i,a),w=Cm(d[0],d[1],b,c[0],d[1],x,c[0],c[1],y,i,a),E=Math.min(null!==T?T:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const e=Td.scaleAndAdd([],i,a,f);if(Dm(y,v,x,b,Om(e[0],c[0],d[0]),Om(e[1],c[1],d[1]))>=e[2])return f}continue}let _=0;for(let h=0;h<this._siblingOffset.length;h++){Lm((p<<1)+this._siblingOffset[h][0],(m<<1)+this._siblingOffset[h][1],g+1,e,t,r,n,c,d),c[2]=-100,d[2]=this.maximums[this.childOffsets[s]+h]*o;const f=Rm(c,d,i,a);if(null!=f){const e=f;l[h]=e;let t=!1;for(let r=0;r<_&&!t;r++)e>=l[u[r]]&&(u.splice(r,0,h),t=!0);t||(u[_]=h),_++}}for(let e=0;e<_;e++){const t=u[e];h.push({idx:this.childOffsets[s]+t,t:l[t],nodex:(p<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,n,i){if(1===e[n].isLeaf(t,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const a=n-1,o=e[a];let s=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],i=2*r+this._siblingOffset[e][1],a=o.getElevation(n,i),u=o.isLeaf(n,i),c=this._addNode(a.min,a.max,u);u&&(s|=1<<e),l||(l=c)}for(let n=0;n<this._siblingOffset.length;n++)s&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*r+this._siblingOffset[n][1],a,l+n)}}function Dm(e,t,r,n,i,a){return Hn(Hn(e,r,a),Hn(t,n,a),i)}function km(e,t,r){const n=r.dim,i=C(e*n-.5,0,n-1),a=C(t*n-.5,0,n-1),o=Math.floor(i),s=Math.floor(a),l=Math.min(o+1,n-1),u=Math.min(s+1,n-1);return Dm(r.get(o,s),r.get(l,s),r.get(o,u),r.get(l,u),i-o,a-s)}const Bm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function Fm(e,t,r){return(256*e*256+256*t+r)/10-1e4}function Nm(e,t,r){return 256*e+t+r/256-32768}class qm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,n,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return X(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const a=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=r||"mapbox",this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<a;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(a,e)]=o[this._idx(a-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,a)]=o[this._idx(e,a-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(a,-1)]=o[this._idx(a-1,0)],o[this._idx(-1,a)]=o[this._idx(0,a-1)],o[this._idx(a,a)]=o[this._idx(a-1,a-1)]}if(n){const e=new Float32Array(t.data.buffer),r="terrarium"===this.encoding?Nm:Fm;for(let t=0;t<o.length;++t){const n=4*t;e[t]=r(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}this.encoding="float"}this._timestamp=st.now()}_buildQuadTree(){this._tree=new Im(this)}get(e,t,r=!1){r&&(e=C(e,-1,this.dim),t=C(t,-1,this.dim));const n=this._idx(e,t);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[n];const i=4*n;return("terrarium"===this.encoding?Nm:Fm)(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}set(e,t,r){const n=this._idx(e,t);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const e=this.floatView[n];return this.floatView[n]=r,r-e}const i=4*n,a=("terrarium"===this.encoding?Nm:Fm)(this.pixels[i],this.pixels[i+1],this.pixels[i+2]),o=qm.pack(r,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[i]=o[0],this.pixels[i+1]=o[1],this.pixels[i+2]=o[2],r-a}static getUnpackVector(e){return Bm[e]}get unpackVector(){return Bm[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const r=[0,0,0,0],n=qm.getUnpackVector(t);let i=Math.floor((e+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return"float"===this.encoding?new $f({width:this.stride,height:this.stride},this.pixels):new Vf({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,i=t*this.dim+this.dim,a=r*this.dim,o=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:a=o-1;break;case 1:o=a+1}const s=-t*this.dim,l=-r*this.dim;for(let t=a;t<o;t++)for(let r=n;r<i;r++){const n=4*this._idx(r,t),i=4*this._idx(r+s,t+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ao(qm,"DEMData"),Ao(Im,"DemMinMaxQuadTree",{omit:["dem"]});class Um{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,n=1<<r,i=Math.floor(e.x),a=Math.floor((e.x-i)*n),o=Math.floor(e.y*n),s=this.findDEMTileFor(new Dd(r,i,r,a,o));return!(!s||!s.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const i=n.getSource().maxzoom,a=1<<i,o=Math.floor(e.x),s=e.x-o,l=new Dd(i,o,i,Math.floor(s*a),Math.floor(e.y*a)),u=this.findDEMTileFor(l);if(!u||!u.dem)return t;const c=u.dem,d=1<<u.tileID.canonical.z,h=(s*d-u.tileID.canonical.x)*c.dim,f=(e.y*d-u.tileID.canonical.y)*c.dim,p=Math.floor(h),m=Math.floor(f);return(r?this.exaggeration():1)*Hn(Hn(c.get(p,m),c.get(p,m+1),f-m),Hn(c.get(p+1,m),c.get(p+1,m+1),f-m),h-p)}getAtTileOffset(e,t,r){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Kh(e.wrap+(e.canonical.x+t/nn)/n,(e.canonical.y+r/nn)/n))}getAtTileOffsetFunc(e,t,r,n){return i=>{const a=this.getAtTileOffset(e,i.x,i.y),o=n.upVector(e.canonical,i.x,i.y),s=n.upVectorScale(e.canonical,t,r).metersToTile;return Td.scale(o,o,a*s),o}}getForTilePoints(e,t,r,n){if(this.isUsingMockSource())return!1;const i=jm.create(this,e,n);return!!i&&(t.forEach((e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],r)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,n=t.tileID,i=1<<e.canonical.z-n.canonical.z;let a=e.canonical.x/i-n.canonical.x,o=e.canonical.y/i-n.canonical.y,s=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!r.leaves[s];t++){a*=2,o*=2;const e=2*Math.floor(o)+Math.floor(a);s=r.childOffsets[s]+e,a%=1,o%=1}return{min:this.exaggeration()*r.minimums[s],max:this.exaggeration()*r.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class jm{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const n=r||e.findDEMTileFor(t);if(!n||!n.dem)return;const i=n.dem,a=n.tileID,o=1<<t.canonical.z-a.canonical.z;return new jm(n,i.dim/nn/o,[(t.canonical.x/o-a.canonical.x)*i.dim,(t.canonical.y/o-a.canonical.y)*i.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),i=Math.floor(r);return new y(n,i)}getElevationAt(e,t,r,n){const i=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(i),s=Math.floor(a),l=this._dem;return n=!!n,r?Hn(Hn(l.get(o,s,n),l.get(o,s+1,n),a-s),Hn(l.get(o+1,s,n),l.get(o+1,s+1,n),a-s),i-o):l.get(o,s,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Gh(1,e)*this._dem.stride}}class Gm{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wo(nn,16,0),this.featureIndexArray=new al,this.promoteId=t}insert(e,t,r,n,i,a=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,a);const s=this.grid;for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<nn&&n[1]<nn&&n[2]>=0&&n[3]>=0&&s.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jp(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new tm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,n){this.loadVTLayers();const i=e.params||{},a=Ra(i.filter),o=e.tileResult,s=e.transform,l=o.bufferedTilespaceBounds,u=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,r,n)=>xf(o.bufferedTilespaceGeometry,e,t,r,n)));u.sort(Vm);let c=null;s.elevation&&u.length>0&&(c=jm.create(s.elevation,this.tileID));const d={};let h;for(let s=0;s<u.length;s++){const l=u[s];if(l===h)continue;h=l;const f=this.featureIndexArray.get(l);let p=null;this.loadMatchingFeature(d,f,a,i.layers,i.availableImages,t,r,n,((t,r,n,i=0)=>(p||(p=of(t,this.tileID.canonical,e.tileTransform)),r.queryIntersectsFeature(o,t,n,p,this.z,e.transform,e.pixelPosMatrix,c,i))))}return d}loadMatchingFeature(e,t,r,n,i,a,o,s,l){const{featureIndex:u,bucketIndex:c,sourceLayerIndex:d,layoutVertexArrayOffset:h}=t,f=this.bucketLayerIDs[c];if(n&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,f))return;const p=this.sourceLayerCoder.decode(d),m=this.vtLayers[p].feature(u);if(r.needGeometry){const e=sf(m,!0);if(!r.filter(new Ko(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Ko(this.tileID.overscaledZ),m))return;const g=this.getId(m,p);for(let t=0;t<f.length;t++){const r=f[t];if(n&&n.indexOf(r)<0)continue;const c=a[r];if(!c)continue;let d={};void 0!==g&&s&&(d=s.getState(c.sourceLayer||"_geojsonTileLayer",g));const p=k({},o[r]);p.paint=zm(p.paint,c.paint,m,d,i),p.layout=zm(p.layout,c.layout,m,d,i);const _=!l||l(m,c,d,h);if(!_)continue;const y=new Sm(m,this.z,this.x,this.y,g);y.layer=p;let v=e[r];void 0===v&&(v=e[r]=[]),v.push({featureIndex:u,feature:y,intersectionZ:_})}}lookupSymbolFeatures(e,t,r,n,i,a,o,s){const l={};this.loadVTLayers();const u=Ra(i);for(const i of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:i,layoutVertexArrayOffset:0},u,a,o,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const a=this.vtLayers[n].feature(t);return i[t]=a,a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(r=e.properties[n]),"boolean"==typeof r&&(r=Number(r))}return r}}function zm(e,t,r,n,i){return V(e,((e,a)=>{const o=t instanceof as?t.get(a):null;return o&&o.evaluate?o.evaluate(r,n,i):o}))}function Vm(e,t){return t-e}Ao(Gm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const $m=ys([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hm=ys([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Wm=ys([{name:"a_projected_pos",components:4,type:"Float32"}],4);ys([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xm=ys([{name:"a_z_offset",components:1,type:"Float32"}],4),Ym=ys([{name:"a_texb",components:2,type:"Uint16"}]),Zm=ys([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Km=ys([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jm=ys([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qm=ys([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ys([{name:"triangle",components:3,type:"Uint16"}]),ys([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ys([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ys([{type:"Float32",name:"offsetX"}]),ys([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var eg=24;const tg=128;function rg(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Ko(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=r;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let a=i;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[i],s=t[a];return"composite"===r.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:n}:{kind:"camera",minZoom:o,maxZoom:s,minSize:r.evaluate(new Ko(o)),maxSize:r.evaluate(new Ko(s)),interpolationType:n}}}function ng(e,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===e.kind?n/tg:"composite"===e.kind?Hn(n/tg,i/tg,r):t}function ig(e,t){let r=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:a,maxZoom:o}=e,s=i?C(mi.interpolationFactor(i,t,a,o),0,1):0;"camera"===e.kind?n=Hn(e.minSize,e.maxSize,s):r=s}return{uSizeT:r,uSize:n}}var ag=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:tg,evaluateSizeForFeature:ng,evaluateSizeForZoom:ig,getSizeData:rg});function og(e,t,r){return e.sections.forEach((e=>{e.text=function(e,t,r){const n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),Zo.applyArabicShaping&&(e=Zo.applyArabicShaping(e)),e}(e.text,t,r)})),e}const sg={"!":"ï¸•","#":"ï¼ƒ",$:"ï¼„","%":"ï¼…","&":"ï¼†","(":"ï¸µ",")":"ï¸¶","*":"ï¼Š","+":"ï¼‹",",":"ï¸","-":"ï¸²",".":"ãƒ»","/":"ï¼",":":"ï¸“",";":"ï¸”","<":"ï¸¿","=":"ï¼",">":"ï¹€","?":"ï¸–","@":"ï¼ ","[":"ï¹‡","\\":"ï¼¼","]":"ï¹ˆ","^":"ï¼¾",_:"ï¸³","`":"ï½€","{":"ï¸·","|":"â€•","}":"ï¸¸","~":"ï½ž","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â€“":"ï¸²","â€”":"ï¸±","â€˜":"ï¹ƒ","â€™":"ï¹„","â€œ":"ï¹","â€":"ï¹‚","â€¦":"ï¸™","â€§":"ãƒ»","â‚©":"ï¿¦","ã€":"ï¸‘","ã€‚":"ï¸’","ã€ˆ":"ï¸¿","ã€‰":"ï¹€","ã€Š":"ï¸½","ã€‹":"ï¸¾","ã€Œ":"ï¹","ã€":"ï¹‚","ã€Ž":"ï¹ƒ","ã€":"ï¹„","ã€":"ï¸»","ã€‘":"ï¸¼","ã€”":"ï¸¹","ã€•":"ï¸º","ã€–":"ï¸—","ã€—":"ï¸˜","ï¼":"ï¸•","ï¼ˆ":"ï¸µ","ï¼‰":"ï¸¶","ï¼Œ":"ï¸","ï¼":"ï¸²","ï¼Ž":"ãƒ»","ï¼š":"ï¸“","ï¼›":"ï¸”","ï¼œ":"ï¸¿","ï¼ž":"ï¹€","ï¼Ÿ":"ï¸–","ï¼»":"ï¹‡","ï¼½":"ï¹ˆ","ï¼¿":"ï¸³","ï½›":"ï¸·","ï½œ":"â€•","ï½":"ï¸¸","ï½Ÿ":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸’","ï½¢":"ï¹","ï½£":"ï¹‚","â†":"â†‘","â†’":"â†“"};function lg(e){return"ï¸¶"===e||"ï¹ˆ"===e||"ï¸¸"===e||"ï¹„"===e||"ï¹‚"===e||"ï¸¾"===e||"ï¸¼"===e||"ï¸º"===e||"ï¸˜"===e||"ï¹€"===e||"ï¸"===e||"ï¸“"===e||"ï¸”"===e||"ï½€"===e||"ï¿£"===e||"ï¸‘"===e||"ï¸’"===e}function ug(e){return"ï¸µ"===e||"ï¹‡"===e||"ï¸·"===e||"ï¹ƒ"===e||"ï¹"===e||"ï¸½"===e||"ï¸»"===e||"ï¸¹"===e||"ï¸—"===e||"ï¸¿"===e}const cg=3;function dg(e,t,r){t.glyphs=[],1===e&&r.readMessage(hg,t)}function hg(e,t,r){if(3===e){const{id:e,bitmap:n,width:i,height:a,left:o,top:s,advance:l}=r.readMessage(fg,{});t.glyphs.push({id:e,bitmap:new zf({width:i+2*cg,height:a+2*cg},n),metrics:{width:i,height:a,left:o,top:s,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function fg(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const pg=cg;function mg(e){let t=0,r=0;for(const n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,a=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const r=n[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,a=Math.max(a,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===r.w&&t.h===r.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):t.w===r.w?(r.y+=t.h,r.h-=t.h):(n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:i,h:a,fill:t/(i*a)||0}}const gg=1;class _g{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=a,this.version=r}get tl(){return[this.paddedRect.x+gg,this.paddedRect.y+gg]}get br(){return[this.paddedRect.x+this.paddedRect.w-gg,this.paddedRect.y+this.paddedRect.h-gg]}get displaySize(){return[(this.paddedRect.w-2*gg)/this.pixelRatio,(this.paddedRect.h-2*gg)/this.pixelRatio]}}class yg{constructor(e,t){const r={},n={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,r,i),this.addImages(t,n,i);const{w:a,h:o}=mg(i),s=new Vf({width:a||1,height:o||1});for(const t in e){const n=e[t],i=r[t].paddedRect;Vf.copy(n.data,s,{x:0,y:0},{x:i.x+gg,y:i.y+gg},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,a=i.x+gg,o=i.y+gg,l=r.data.width,u=r.data.height;Vf.copy(r.data,s,{x:0,y:0},{x:a,y:o},r.data),Vf.copy(r.data,s,{x:0,y:u-1},{x:a,y:o-1},{width:l,height:1}),Vf.copy(r.data,s,{x:0,y:0},{x:a,y:o+u},{width:l,height:1}),Vf.copy(r.data,s,{x:l-1,y:0},{x:a-1,y:o},{width:1,height:u}),Vf.copy(r.data,s,{x:0,y:0},{x:a+l,y:o},{width:1,height:u})}this.image=s,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const n in e){const i=e[n],a={x:0,y:0,w:i.data.width+2*gg,h:i.data.height+2*gg};r.push(a),t[n]=new _g(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,r))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[n],e.getImage(n,r),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n,r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,i]=e.tl;r.update(t.data,void 0,{x:n,y:i})}}Ao(_g,"ImagePosition"),Ao(yg,"ImageAtlas");const vg={horizontal:1,vertical:2,horizontalOnly:3},bg=-17;class xg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new xg;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new xg;return t.imageName=e,t}}class Tg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new Tg;for(let n=0;n<e.sections.length;n++){const i=e.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,a=e.charCodeAt(n-1)||null;r+=!t&&(i&&ko(i)&&!sg[e[n+1]]||a&&ko(a)&&!sg[e[n-1]])||!sg[e[n]]?e[n]:sg[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Eg[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Eg[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Tg;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(xg.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void X("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(xg.forImage(t)),this.sectionIndex.push(this.sections.length-1)):X("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wg(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p){const m=Tg.fromFeature(e,i);d===vg.vertical&&m.verticalizePunctuation(h);let g=[];const _=function(e,t,r,n,i,a){if(!e)return[];const o=[],s=function(e,t,r,n,i,a){let o=0;for(let r=0;r<e.length();r++){const s=e.getSection(r);o+=Sg(e.getCodePoint(r),s,n,i,t,a)}return o/Math.max(1,Math.ceil(o/r))}(e,t,r,n,i,a),l=e.text.indexOf("â€‹")>=0;let u=0;for(let r=0;r<e.length();r++){const d=e.getSection(r),h=e.getCodePoint(r);if(Eg[h]||(u+=Sg(h,d,n,i,t,a)),r<e.length()-1){const t=!((c=h)<11904||!(Co["Bopomofo Extended"](c)||Co.Bopomofo(c)||Co["CJK Compatibility Forms"](c)||Co["CJK Compatibility Ideographs"](c)||Co["CJK Compatibility"](c)||Co["CJK Radicals Supplement"](c)||Co["CJK Strokes"](c)||Co["CJK Symbols and Punctuation"](c)||Co["CJK Unified Ideographs Extension A"](c)||Co["CJK Unified Ideographs"](c)||Co["Enclosed CJK Letters and Months"](c)||Co["Halfwidth and Fullwidth Forms"](c)||Co.Hiragana(c)||Co["Ideographic Description Characters"](c)||Co["Kangxi Radicals"](c)||Co["Katakana Phonetic Extensions"](c)||Co.Katakana(c)||Co["Vertical Forms"](c)||Co["Yi Radicals"](c)||Co["Yi Syllables"](c)));(Ag[h]||t||d.imageName)&&o.push(Rg(r+1,u,s,o,Mg(h,e.getCodePoint(r+1),t&&l),!1))}}var c;return Cg(Rg(e.length(),u,s,o,0,!0))}(m,u,a,t,n,f),{processBidirectionalText:y,processStyledBidirectionalText:v}=Zo;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Tg;e.text=t,e.sections=m.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,_);for(const t of e){const e=new Tg;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const r=[],n=e.text;let i=0;for(const n of t)r.push(e.substring(i,n)),i=n;return i<n.length&&r.push(e.substring(i,n.length)),r}(m,_);const b=[],x={positionedLines:b,text:m.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,n,i,a,o,s,l,u,c,d){let h=0,f=0,p=0;const m="right"===s?1:"left"===s?0:.5;let g=!1;for(const e of i){const r=e.getSections();for(const e of r){if(e.imageName)continue;const r=t[e.fontStack];if(r&&(g=void 0!==r.ascender&&void 0!==r.descender,!g))break}if(!g)break}let _=0;for(const o of i){o.trim();const i=o.getMaxScale(),s=(i-1)*eg,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=v;const b=v.positionedGlyphs;let x=0;if(!o.length()){f+=a,++_;continue}let T=0,w=0;for(let a=0;a<o.length();a++){const s=o.getSection(a),p=o.getSectionIndex(a),m=o.getCodePoint(a);let _=s.scale,v=null,E=null,A=null,S=eg,P=0;const M=!(l===vg.horizontal||!c&&!Do(m)||c&&(Eg[m]||(y=m,Co.Arabic(y)||Co["Arabic Supplement"](y)||Co["Arabic Extended-A"](y)||Co["Arabic Presentation Forms-A"](y)||Co["Arabic Presentation Forms-B"](y))));if(s.imageName){const t=n[s.imageName];if(!t)continue;A=s.imageName,e.iconsInText=e.iconsInText||!0,E=t.paddedRect;const r=t.displaySize;_=_*eg/d,v={width:r[0],height:r[1],left:gg,top:-pg,advance:M?r[1]:r[0],localGlyph:!1},P=g?-v.height*_:bg+i*eg-r[1]*_,S=v.advance;const a=(M?r[0]:r[1])*_-eg*i;a>0&&a>x&&(x=a)}else{const e=r[s.fontStack];if(!e)continue;e[m]&&(E=e[m]);const n=t[s.fontStack];if(!n)continue;const a=n.glyphs[m];if(!a)continue;if(v=a.metrics,S=8203!==m?eg:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*_;T<r&&(T=r,w=(e-t)/2*_),P=-e*_}else P=bg+(i-_)*eg}M?(e.verticalizable=!0,b.push({glyph:m,imageName:A,x:h,y:f+P,vertical:M,scale:_,localGlyph:v.localGlyph,fontStack:s.fontStack,sectionIndex:p,metrics:v,rect:E}),h+=S*_+u):(b.push({glyph:m,imageName:A,x:h,y:f+P,vertical:M,scale:_,localGlyph:v.localGlyph,fontStack:s.fontStack,sectionIndex:p,metrics:v,rect:E}),h+=v.advance*_+u)}0!==b.length&&(p=Math.max(h-u,p),g?Lg(b,m,x,w,a*i/2):Lg(b,m,x,0,a/2)),h=0;const E=a*i+x;v.lineOffset=Math.max(x,s),f+=E,++_}var y;const v=f,{horizontalAlign:b,verticalAlign:x}=Og(o);(function(e,t,r,n,i,a){const o=(t-r)*i,s=-a*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=o,e.y+=s})(e.positionedLines,m,b,x,p,v),e.top+=-x*v,e.bottom=e.top+v,e.left+=-b*p,e.right=e.left+p,e.hasBaseline=g}(x,t,r,n,g,o,s,l,d,u,h,p),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&x}const Eg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ag={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sg(e,t,r,n,i,a){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*eg/a+i:0}{const n=r[t.fontStack],a=n&&n.glyphs[e];return a?a.metrics.advance*t.scale+i:0}}function Pg(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function Mg(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Rg(e,t,r,n,i,a){let o=null,s=Pg(t,r,i,a);for(const e of n){const n=Pg(t-e.x,r,i,a)+e.badness;n<=s&&(o=e,s=n)}return{index:e,x:t,priorBreak:o,badness:s}}function Cg(e){return e?Cg(e.priorBreak).concat(e.index):[]}function Og(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Lg(e,t,r,n,i){if(!(t||r||n||i))return;const a=e.length-1,o=e[a],s=(o.x+o.metrics.advance*o.scale)*t;for(let t=0;t<=a;t++)e[t].x-=s,e[t].y+=r+n+i}function Ig(e,t,r,n){const{horizontalAlign:i,verticalAlign:a}=Og(n),o=r[0]-e.displaySize[0]*i,s=r[1]-e.displaySize[1]*a;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Dg(e,t,r,n,i,a){const o=e.imagePrimary;let s;if(o.content){const e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*a,u=t.right*a;let c,d,h,f;"width"===r||"both"===r?(f=i[0]+l-n[3],d=i[0]+u+n[1]):(f=i[0]+(l+u-o.displaySize[0])/2,d=f+o.displaySize[0]);const p=t.top*a,m=t.bottom*a;return"height"===r||"both"===r?(c=i[1]+p-n[0],h=i[1]+m+n[2]):(c=i[1]+(p+m-o.displaySize[1])/2,h=c+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:c,right:d,bottom:h,left:f,collisionPadding:s}}class kg extends y{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new kg(this.x,this.y,this.z,this.angle,this.segment)}}function Bg(e,t,r,n,i){if(void 0===t.segment)return!0;let a=t,o=t.segment+1,s=0;for(;s>-r/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;const l=[];let u=0;for(;s<r/2;){const t=e[o],r=e[o+1];if(!r)return!1;let a=e[o-1].angleTo(t)-t.angleTo(r);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),u+=a;s-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;o++,s+=t.dist(r)}return!0}function Fg(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Ng(e,t,r){return e?.6*t*r:0}function qg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Ug(e,t,r,n,i,a){const o=Ng(r,i,a),s=qg(r,n)*a;let l=0;const u=Fg(e)/2;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1],a=n.dist(i);if(l+a>u){const c=(u-l)/a,d=Hn(n.x,i.x,c),h=Hn(n.y,i.y,c),f=new kg(d,h,0,i.angleTo(n),r);return!o||Bg(e,f,s,o,t)?f:void 0}l+=a}}function jg(e,t,r,n,i,a,o,s,l){const u=Ng(n,a,o),c=qg(n,i),d=c*o,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-d<t/4&&(t=d+t/4),Gg(e,h?t/2*s%t:(c/2+2*a)*o*s%t,t,u,r,d,h,!1,l)}function Gg(e,t,r,n,i,a,o,s,l){const u=a/2,c=Fg(e);let d=0,h=t-r,f=[];for(let t=0;t<e.length-1;t++){const o=e[t],s=e[t+1],p=o.dist(s),m=s.angleTo(o);for(;h+r<d+p;){h+=r;const g=(h-d)/p,_=Hn(o.x,s.x,g),y=Hn(o.y,s.y,g);if(_>=0&&_<l&&y>=0&&y<l&&h-u>=0&&h+u<=c){const r=new kg(_,y,0,m,t);n&&!Bg(e,r,a,n,i)||f.push(r)}}d+=p}return s||f.length||o||(f=Gg(e,d/2,r,n,i,a,o,!0,l)),f}function zg(e,t,r,n,i){const a=[];for(let o=0;o<e.length;o++){const s=e[o];let l;for(let e=0;e<s.length-1;e++){let o=s[e],u=s[e+1];o.x<t&&u.x<t||(o.x<t?o=new y(t,o.y+(t-o.x)/(u.x-o.x)*(u.y-o.y))._round():u.x<t&&(u=new y(t,o.y+(t-o.x)/(u.x-o.x)*(u.y-o.y))._round()),o.y<r&&u.y<r||(o.y<r?o=new y(o.x+(r-o.y)/(u.y-o.y)*(u.x-o.x),r)._round():u.y<r&&(u=new y(o.x+(r-o.y)/(u.y-o.y)*(u.x-o.x),r)._round()),o.x>=n&&u.x>=n||(o.x>=n?o=new y(n,o.y+(n-o.x)/(u.x-o.x)*(u.y-o.y))._round():u.x>=n&&(u=new y(n,o.y+(n-o.x)/(u.x-o.x)*(u.y-o.y))._round()),o.y>=i&&u.y>=i||(o.y>=i?o=new y(o.x+(i-o.y)/(u.y-o.y)*(u.x-o.x),i)._round():u.y>=i&&(u=new y(o.x+(i-o.y)/(u.y-o.y)*(u.x-o.x),i)._round()),l&&o.equals(l[l.length-1])||(l=[o],a.push(l)),l.push(u)))))}}return a}Ao(kg,"Anchor");const Vg=1e20;function $g(e,t,r,n,i,a,o,s,l){for(let u=t;u<t+n;u++)Hg(e,r*a+u,a,i,o,s,l);for(let u=r;u<r+i;u++)Hg(e,u*a+t,1,n,o,s,l)}function Hg(e,t,r,n,i,a,o){a[0]=0,o[0]=-Vg,o[1]=Vg,i[0]=e[t];for(let s=1,l=0,u=0;s<n;s++){i[s]=e[t+s*r];const n=s*s;do{const e=a[l];u=(i[s]-i[e]+n-e*e)/(s-e)/2}while(u<=o[l]&&--l>-1);l++,a[l]=s,o[l]=u,o[l+1]=Vg}for(let s=0,l=0;s<n;s++){for(;o[l+1]<s;)l++;const n=a[l],u=s-n;e[t+s*r]=i[n]+u*u}}const Wg=2;class Xg{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,r){const n=[],a=this.urls[t]||i.GLYPHS_URL;for(const t in e)for(const r of e[t])n.push({stack:t,id:r});I(n,(({stack:e,id:t},r)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let i=n.glyphs[t];if(void 0!==i)return void r(null,{stack:e,id:t,glyph:i});if(i=this._tinySDF(n,e,t),i)return n.glyphs[t]=i,void r(null,{stack:e,id:t,glyph:i});const o=Math.floor(t/256);if(256*o>65535)return void r(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void r(null,{stack:e,id:t,glyph:i});let s=n.requests[o];s||(s=n.requests[o]=[],Xg.loadGlyphRange(e,o,a,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[o]=!0}for(const r of s)r(e,t);delete n.requests[o]}))),s.push(((n,i)=>{n?r(n):i&&r(null,{stack:e,id:t,glyph:i.glyphs[t]||null})}))}),((e,t)=>{if(e)r(e);else if(t){const e={};for(const{stack:r,id:n,glyph:i}of t)void 0===e[r]&&(e[r]={}),void 0===e[r].glyphs&&(e[r].glyphs={}),e[r].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[r].ascender=this.entries[r].ascender,e[r].descender=this.entries[r].descender;r(null,e)}}))}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Co["CJK Unified Ideographs"](e)||Co["Hangul Syllables"](e)||Co.Hiragana(e)||Co.Katakana(e)||Co["CJK Symbols and Punctuation"](e)||Co["CJK Unified Ideographs Extension A"](e)||Co["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=e.tinySDF;if(!i){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),i=e.tinySDF=new Xg.TinySDF({fontFamily:n,fontWeight:r,fontSize:24*Wg,buffer:3*Wg,radius:8*Wg}),i.fontWeight=r}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const a=String.fromCodePoint(r),{data:o,width:s,height:l,glyphWidth:u,glyphHeight:c,glyphLeft:d,glyphTop:h,glyphAdvance:f}=i.draw(a);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new zf({width:s,height:l},o),metrics:{width:u/Wg,height:c/Wg,left:d/Wg,top:h/Wg-27,advance:f/Wg,localGlyph:!0}}}}Xg.loadGlyphRange=function(e,t,r,n,i){const a=256*t,o=a+255,s=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${a}-${o}`),ye.Glyphs);we(s,((e,t)=>{if(e)i(e);else if(t){const e={},r=function(e){return new Em(e).readFields(dg,{})}(t);for(const t of r.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}}))},Xg.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:a="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=r;const s=this.size=e+4*t,l=this._createCanvas(s),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${o} ${a} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:a}=this.ctx.measureText(e),o=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-i))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),u=s+2*this.buffer,c=l+2*this.buffer,d=Math.max(u*c,0),h=new Uint8ClampedArray(d),f={data:h,width:u,height:c,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:_}=this;p.clearRect(m,m,s,l),p.fillText(e,m,m+o);const y=p.getImageData(m,m,s,l);_.fill(Vg,0,d),g.fill(0,0,d);for(let e=0;e<l;e++)for(let t=0;t<s;t++){const r=y.data[4*(e*s+t)+3]/255;if(0===r)continue;const n=(e+m)*u+t+m;if(1===r)_[n]=0,g[n]=Vg;else{const e=.5-r;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}$g(_,0,0,u,c,u,this.f,this.v,this.z),$g(g,m,m,s,l,u,this.f,this.v,this.z);for(let e=0;e<d;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);h[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}};const Yg=gg;function Zg(e,t,r,n){const i=[],a=e.imagePrimary,o=a.pixelRatio,s=a.paddedRect.w-2*Yg,l=a.paddedRect.h-2*Yg,u=e.right-e.left,c=e.bottom-e.top,d=a.stretchX||[[0,s]],h=a.stretchY||[[0,l]],f=(e,t)=>e+t[1]-t[0],p=d.reduce(f,0),m=h.reduce(f,0),g=s-p,_=l-m;let v=0,b=p,x=0,T=m,w=0,E=g,A=0,S=_;if(a.content&&n){const e=a.content;v=Kg(d,0,e[0]),x=Kg(h,0,e[1]),b=Kg(d,e[0],e[2]),T=Kg(h,e[1],e[3]),w=e[0]-v,A=e[1]-x,E=e[2]-e[0]-b,S=e[3]-e[1]-T}const P=(n,i,s,l)=>{const d=Qg(n.stretch-v,b,u,e.left),h=e_(n.fixed-w,E,n.stretch,p),f=Qg(i.stretch-x,T,c,e.top),g=e_(i.fixed-A,S,i.stretch,m),_=Qg(s.stretch-v,b,u,e.left),P=e_(s.fixed-w,E,s.stretch,p),M=Qg(l.stretch-x,T,c,e.top),R=e_(l.fixed-A,S,l.stretch,m),C=new y(d,f),O=new y(_,f),L=new y(_,M),I=new y(d,M),D=new y(h/o,g/o),k=new y(P/o,R/o),B=t*Math.PI/180;if(B){const e=Math.sin(B),t=Math.cos(B),r=[t,-e,e,t];C._matMult(r),O._matMult(r),I._matMult(r),L._matMult(r)}const F=n.stretch+n.fixed,N=s.stretch+s.fixed,q=i.stretch+i.fixed,U=l.stretch+l.fixed,j=e.imageSecondary;return{tl:C,tr:O,bl:I,br:L,texPrimary:{x:a.paddedRect.x+Yg+F,y:a.paddedRect.y+Yg+q,w:N-F,h:U-q},texSecondary:j?{x:j.paddedRect.x+Yg+F,y:j.paddedRect.y+Yg+q,w:N-F,h:U-q}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:k,minFontScaleX:E/o/u,minFontScaleY:S/o/c,isSDF:r}};if(n&&(a.stretchX||a.stretchY)){const e=Jg(d,g,p),t=Jg(h,_,m);for(let r=0;r<e.length-1;r++){const n=e[r],a=e[r+1];for(let e=0;e<t.length-1;e++)i.push(P(n,t[e],a,t[e+1]))}}else i.push(P({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return i}function Kg(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Jg(e,t,r){const n=[{fixed:-Yg,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+Yg,stretch:r}),n}function Qg(e,t,r,n){return e/t*r+n}function e_(e,t,r,n){return e-t*r/n}function t_(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}function r_(e,t=1,r=!1){let n=1/0,i=1/0,a=-1/0,o=-1/0;const s=e[0];for(let e=0;e<s.length;e++){const t=s[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<i)&&(i=t.y),(!e||t.x>a)&&(a=t.x),(!e||t.y>o)&&(o=t.y)}const l=Math.min(a-n,o-i);let u=l/2;const c=new rn([],n_);if(0===l)return new y(n,i);for(let t=n;t<a;t+=l)for(let r=i;r<o;r+=l)c.push(new i_(t+u,r+u,u,e));let d=function(e){let t=0,r=0,n=0;const i=e[0];for(let e=0,a=i.length,o=a-1;e<a;o=e++){const a=i[e],s=i[o],l=a.x*s.y-s.x*a.y;r+=(a.x+s.x)*l,n+=(a.y+s.y)*l,t+=3*l}return new i_(r/t,n/t,0,e)}(e),h=c.length;for(;c.length;){const n=c.pop();(n.d>d.d||!d.d)&&(d=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,h)),n.max-d.d<=t||(u=n.h/2,c.push(new i_(n.p.x-u,n.p.y-u,u,e)),c.push(new i_(n.p.x+u,n.p.y-u,u,e)),c.push(new i_(n.p.x-u,n.p.y+u,u,e)),c.push(new i_(n.p.x+u,n.p.y+u,u,e)),h+=4)}return r&&(console.log(`num probes: ${h}`),console.log(`best distance: ${d.d}`)),d.p}function n_(e,t){return t.max-e.max}class i_{constructor(e,t,r,n){this.p=new y(e,t),this.h=r,this.d=function(e,t){let r=!1,n=1/0;for(let i=0;i<t.length;i++){const a=t[i];for(let t=0,i=a.length,o=i-1;t<i;o=t++){const i=a[t],s=a[o];i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(r=!r),n=Math.min(n,yf(e,i,s))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const a_=7,o_=Number.POSITIVE_INFINITY,s_=Math.sqrt(2);function l_(e,[t,r]){let n=0,i=0;if(r===o_){t<0&&(t=0);const r=t/s_;switch(e){case"top-right":case"top-left":i=r-a_;break;case"bottom-right":case"bottom-left":i=-r+a_;break;case"bottom":i=-t+a_;break;case"top":i=t-a_}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":i=r-a_;break;case"bottom-right":case"bottom-left":case"bottom":i=-r+a_}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,i]}function u_(e,t,r,n,i,a,o,s,l,u,c){e.createArrays(),e.tilePixelRatio=nn/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const d=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,f={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;f.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Ko(t),s),h["text-size"].possiblyEvaluate(new Ko(r),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;f.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Ko(t),s),h["icon-size"].possiblyEvaluate(new Ko(r),s)]}f.layoutTextSize=h["text-size"].possiblyEvaluate(new Ko(l+1),s),f.layoutIconSize=h["icon-size"].possiblyEvaluate(new Ko(l+1),s),f.textMaxSize=h["text-size"].possiblyEvaluate(new Ko(18),s);const p="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),m=d.get("text-size");let g=!1;for(const t of e.features)if(t.icon&&t.icon.nameSecondary){g=!0;break}for(const a of e.features){const l=d.get("text-font").evaluate(a,{},s).join(","),h=m.evaluate(a,{},s),_=f.layoutTextSize.evaluate(a,{},s),y=(f.layoutIconSize.evaluate(a,{},s),{horizontal:{},vertical:void 0}),v=a.text;let b,x=[0,0];if(v){const n=v.toString(),o=d.get("text-letter-spacing").evaluate(a,{},s)*eg,u=d.get("text-line-height").evaluate(a,{},s)*eg,c=Lo(n)?o:0,f=d.get("text-anchor").evaluate(a,{},s),m=d.get("text-variable-anchor");if(!m){const e=d.get("text-radial-offset").evaluate(a,{},s);x=e?l_(f,[e*eg,o_]):d.get("text-offset").evaluate(a,{},s).map((e=>e*eg))}let g=p?"center":d.get("text-justify").evaluate(a,{},s);const b="point"===d.get("symbol-placement"),T=b?d.get("text-max-width").evaluate(a,{},s)*eg:1/0,w=a=>{e.allowVerticalPlacement&&Oo(n)&&(y.vertical=wg(v,t,r,i,l,T,u,f,a,c,x,vg.vertical,!0,_,h))};if(!p&&m){const e="auto"===g?m.map((e=>c_(e))):[g];let n=!1;for(let a=0;a<e.length;a++){const o=e[a];if(!y.horizontal[o])if(n)y.horizontal[o]=y.horizontal[0];else{const e=wg(v,t,r,i,l,T,u,"center",o,c,x,vg.horizontal,!1,_,h);e&&(y.horizontal[o]=e,n=1===e.positionedLines.length)}}w("left")}else{if("auto"===g&&(g=c_(f)),b||d.get("text-writing-mode").indexOf("horizontal")>=0||!Oo(n)){const e=wg(v,t,r,i,l,T,u,f,g,c,x,vg.horizontal,!1,_,h);e&&(y.horizontal[g]=e)}w(b?"left":g)}}let T=!1;if(a.icon&&a.icon.namePrimary){const t=n[a.icon.namePrimary];t&&(b=Ig(i[a.icon.namePrimary],a.icon.nameSecondary?i[a.icon.nameSecondary]:void 0,d.get("icon-offset").evaluate(a,{},s),d.get("icon-anchor").evaluate(a,{},s)),T=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&X("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==d.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const w=m_(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!w&&w.iconsInText),(w||b)&&d_(e,a,y,b,n,f,_,0,x,T,o,s,u,c,g)}a&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function c_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d_(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p){let m=a.textMaxSize.evaluate(t,{},d);void 0===m&&(m=o);const g=e.layers[0].layout,_=g.get("icon-offset").evaluate(t,{},d),y=m_(r.horizontal)||r.vertical,v="globe"===h.name,b=eg,x=o/b,w=e.tilePixelRatio*m/b,E=(L=e.overscaling,e.zoom>18&&L>2&&(L>>=1),Math.max(nn/(512*L),1)*g.get("symbol-spacing")),A=g.get("text-padding")*e.tilePixelRatio,S=g.get("icon-padding")*e.tilePixelRatio,P=T(g.get("text-max-angle")),M="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),R="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),C=g.get("symbol-placement"),O=E/2;var L;const I=g.get("icon-text-fit").evaluate(t,{},d),D=g.get("icon-text-fit-padding").evaluate(t,{},d),k="none"!==I;let B;!1===e.hasAnyIconTextFit&&k&&(e.hasAnyIconTextFit=!0),n&&k&&(e.allowVerticalPlacement&&r.vertical&&(B=Dg(n,r.vertical,I,D,_,x)),y&&(n=Dg(n,y,I,D,_,x)));const F=(o,s,m)=>{if(s.x<0||s.x>=nn||s.y<0||s.y>=nn)return;let g=null;if(v){const{x:e,y:t,z:r}=h.projectTilePoint(s.x,s.y,m);g={anchor:new kg(e,t,r,0,void 0),up:h.upVector(m,s.x,s.y)}}!function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S){const P=e.addToLineVertexArray(t,n);let M,R,C,O,L,I,D,k=0,B=0,F=0,N=0,q=-1,U=-1;const j={};let G=vl("");const z=r?r.anchor:t,V="none"!==l.layout.get("icon-text-fit").evaluate(b,{},E);let $=0,H=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[$,H]=l.layout.get("text-offset").evaluate(b,{},E).map((e=>e*eg)):($=l.layout.get("text-radial-offset").evaluate(b,{},E)*eg,H=o_),e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(p)I=__(e),s&&(D=__(s));else{const r=l.layout.get("text-rotate").evaluate(b,{},E)+90;C=g_(u,z,t,c,d,h,e,f,r,m),s&&(O=g_(u,z,t,c,d,h,s,_,r))}}if(a){const n=l.layout.get("icon-rotate").evaluate(b,{},E),i=Zg(a,n,T,V),o=s?Zg(s,n,T,V):void 0;R=g_(u,z,t,c,d,h,a,_,n),k=4*i.length;const f=e.iconSizeData;let p=null;"source"===f.kind?(p=[tg*l.layout.get("icon-size").evaluate(b,{},E)],p[0]>f_&&X(`${e.layerIds[0]}: Value for "icon-size" is >= ${h_}. Reduce your "icon-size".`)):"composite"===f.kind&&(p=[tg*x.compositeIconSizes[0].evaluate(b,{},E),tg*x.compositeIconSizes[1].evaluate(b,{},E)],(p[0]>f_||p[1]>f_)&&X(`${e.layerIds[0]}: Value for "icon-size" is >= ${h_}. Reduce your "icon-size".`)),e.addSymbols(e.icon,i,p,v,y,b,!1,r,t,P.lineStartIndex,P.lineLength,-1,w,E,A,S),q=e.icon.placedSymbolArray.length-1,o&&(B=4*o.length,e.addSymbols(e.icon,o,p,v,y,b,vg.vertical,r,t,P.lineStartIndex,P.lineLength,-1,w,E,A,S),U=e.icon.placedSymbolArray.length-1)}for(const n in i.horizontal){const a=i.horizontal[n];M||(G=vl(a.text),p?L=__(a):M=g_(u,z,t,c,d,h,a,f,l.layout.get("text-rotate").evaluate(b,{},E),m));const s=1===a.positionedLines.length;if(F+=p_(e,r,t,a,o,l,p,b,m,P,i.vertical?vg.horizontal:vg.horizontalOnly,s?Object.keys(i.horizontal):[n],j,q,x,w,E,A),s)break}i.vertical&&(N+=p_(e,r,t,i.vertical,o,l,p,b,m,P,vg.vertical,["vertical"],j,U,x,w,E,A));let W=-1;const Y=(e,t)=>e?Math.max(e,t):t;W=Y(L,W),W=Y(I,W),W=Y(D,W);const Z=W>-1?1:0;e.glyphOffsetArray.length>=oy.MAX_GLYPHS&&X("Too many glyphs being rendered in a tile. See /tianjingmap-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,z.x,z.y,z.z,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,q,U,G,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==R?R:e.collisionBoxArray.length,void 0!==R?R+1:e.collisionBoxArray.length,O||e.collisionBoxArray.length,O?O+1:e.collisionBoxArray.length,c,F,N,k,B,Z,0,$,H,W,0,V?1:0)}(e,s,g,o,r,n,i,B,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,A,M,l,0,S,R,_,t,a,u,c,d,f,p)};if("line"===C)for(const i of zg(t.geometry,0,0,nn,nn)){const t=jg(i,E,P,r.vertical||y,n,b,w,e.overscaling,nn);for(const r of t)y&&y_(e,y.text,O,r)||F(i,r,d)}else if("line-center"===C){for(const e of t.geometry)if(e.length>1){const t=Ug(e,P,r.vertical||y,n,b,w);t&&F(e,t,d)}}else if("Polygon"===t.type)for(const e of Pp(t.geometry,0)){const t=r_(e,16);F(e[0],new kg(t.x,t.y,0,0,void 0),d)}else if("LineString"===t.type)for(const e of t.geometry)F(e,new kg(e[0].x,e[0].y,0,0,void 0),d);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)F([t],new kg(t.x,t.y,0,0,void 0),d)}const h_=255,f_=h_*tg;function p_(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_){const v=function(e,t,r,n,i,a,o,s){const l=[];if(0===t.positionedLines.length)return l;const u=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let d=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)d-=e.lineOffset;const h=t.positionedLines.length,f=d/h;let p=t.top-r[1];for(let e=0;e<h;++e){const n=t.positionedLines[e];p=t_(t,f,p,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let a=pg+1,d=!0,h=1,f=0;if(e.imageName){const t=o[e.imageName];if(!t)continue;if(t.sdf){X("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,h=t.pixelRatio,a=gg/h}const m=(i||s)&&e.vertical,g=e.metrics.advance*e.scale/2,_=e.metrics,v=e.rect;if(null===v)continue;s&&t.verticalizable&&(f=e.imageName?g-e.metrics.width*e.scale/2:0);const b=i?[e.x+g,e.y]:[0,0];let x=[0,0],T=[0,0],w=!1;i||(m?(T=[e.x+g+c[0],e.y+c[1]-f],w=!0):x=[e.x+g+r[0],e.y+r[1]-f]);const E=v.w*e.scale/(h*(e.localGlyph?Wg:1)),A=v.h*e.scale/(h*(e.localGlyph?Wg:1));let S,P,M,R;if(m){const t=e.y-p,r=new y(-g,g-t),n=-Math.PI/2,i=new y(...T);S=new y(-g+x[0],x[1]),S._rotateAround(n,r)._add(i),S.x+=-t+g,S.y-=(_.left-a)*e.scale;const o=e.imageName?_.advance*e.scale:eg*e.scale,s=String.fromCodePoint(e.glyph);lg(s)?S.x+=(1-a)*e.scale:ug(s)?S.x+=o-_.height*e.scale+(-a-1)*e.scale:S.x+=e.imageName||_.width+2*a===v.w&&_.height+2*a===v.h?(o-A)/2:(o-(_.height+2*a)*e.scale)/2,P=new y(S.x,S.y-E),M=new y(S.x+A,S.y),R=new y(S.x+A,S.y-E)}else{const t=(_.left-a)*e.scale-g+x[0],r=(-_.top-a)*e.scale+x[1],n=t+E,i=r+A;S=new y(t,r),P=new y(n,r),M=new y(t,i),R=new y(n,i)}if(u){let e;e=i?new y(0,0):w?new y(c[0],c[1]):new y(r[0],r[1]),S._rotateAround(u,e),P._rotateAround(u,e),M._rotateAround(u,e),R._rotateAround(u,e)}const C=new y(0,0),O=new y(0,0);l.push({tl:S,tr:P,bl:M,br:R,texPrimary:n,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:b,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:C,pixelOffsetBR:O,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,a,o,s,i,e.allowVerticalPlacement),b=e.textSizeData;let x=null;"source"===b.kind?(x=[tg*a.layout.get("text-size").evaluate(s,{},g)],x[0]>f_&&X(`${e.layerIds[0]}: Value for "text-size" is >= ${h_}. Reduce your "text-size".`)):"composite"===b.kind&&(x=[tg*p.compositeTextSizes[0].evaluate(s,{},g),tg*p.compositeTextSizes[1].evaluate(s,{},g)],(x[0]>f_||x[1]>f_)&&X(`${e.layerIds[0]}: Value for "text-size" is >= ${h_}. Reduce your "text-size".`)),e.addSymbols(e.text,v,x,l,o,s,c,t,r,u.lineStartIndex,u.lineLength,f,m,g,_,!1);for(const t of d)h[t]=e.text.placedSymbolArray.length-1;return 4*v.length}function m_(e){for(const t in e)return e[t];return null}function g_(e,t,r,n,i,a,o,s,l,u){let c=o.top,d=o.bottom,h=o.left,f=o.right;const p=o.collisionPadding;if(p&&(h-=p[0],c-=p[1],f+=p[2],d+=p[3]),l){const e=new y(h,c),t=new y(f,c),r=new y(h,d),n=new y(f,d),i=T(l);let a=new y(0,0);u&&(a=new y(u[0],u[1])),e._rotateAround(i,a),t._rotateAround(i,a),r._rotateAround(i,a),n._rotateAround(i,a),h=Math.min(e.x,t.x,r.x,n.x),f=Math.max(e.x,t.x,r.x,n.x),c=Math.min(e.y,t.y,r.y,n.y),d=Math.max(e.y,t.y,r.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,h,c,f,d,s,n,i,a),e.length-1}function __(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function y_(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}function v_(e,t){const r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),a=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),o=Math.sin(e._pitch)*a+i;return Math.min(1.01*o,i*(1/e._horizonShift))}function b_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,a=e.y*r,o=(e.y+1)*r,s=zh(n),l=zh(i),u=Vh(a),c=Vh(o),d=t.project(s,u),h=t.project(l,u),f=t.project(l,c),p=t.project(s,c);let m=Math.min(d.x,h.x,f.x,p.x),g=Math.min(d.y,h.y,f.y,p.y),_=Math.max(d.x,h.x,f.x,p.x),y=Math.max(d.y,h.y,f.y,p.y);const v=r/16;function b(e,r,n,i,a,o){const s=(n+a)/2,l=(i+o)/2,u=t.project(zh(s),Vh(l)),c=Math.max(0,m-u.x,g-u.y,u.x-_,u.y-y);m=Math.min(m,u.x),_=Math.max(_,u.x),g=Math.min(g,u.y),y=Math.max(y,u.y),c>v&&(b(e,u,n,i,s,l),b(u,r,s,l,a,o))}b(d,h,n,a,i,a),b(h,f,i,a,i,o),b(f,p,i,o,n,o),b(p,d,n,o,n,a),m-=v,g-=v,_+=v,y+=v;const x=1/Math.max(_-m,y-g);return{scale:x,x:m*x,y:g*x,x2:_*x,y2:y*x,projection:t}}function x_(e,t,r,n,i,a,o,s,l){if("globe"===l.name)return lh(e,t,new Ld(r,n,i),!1);const u=b_({z:r,x:n,y:i},l);return new Vd([(a+u.x/u.scale)*t,t*(u.y/u.scale),o],[(a+u.x2/u.scale)*t,t*(u.y2/u.scale),s])}function T_(e,{x:t,y:r},n=0){return new y(((t-n)*e.scale-e.x)*nn,(r*e.scale-e.y)*nn)}function w_(e,t,r=0){return Td.fromValues(((t.x-r)*e.scale-e.x)*nn,(t.y*e.scale-e.y)*nn,$h(t.z,t.y))}const E_=gd.identity(new Float32Array(16));class A_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Bh(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return Gh(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return v_(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){const i=e.horizonLineFromTop(!1),a=new y(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,n))}pointCoordinate3D(e,t,r){const n=new y(t,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return E_}createTileMatrix(e,t,r){let n,i,a;const o=r.canonical,s=gd.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=b_(o,this);n=1,i=l.x+r.wrap*l.scale,a=l.y,gd.scale(s,s,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(o.z),i=(o.x+Math.pow(2,o.z)*r.wrap)*n,a=o.y*n;return gd.translate(s,s,[i,a,0]),gd.scale(s,s,[n/nn,n/nn,1]),s}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class S_ extends A_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(T(t));this.n=(n+Math.sin(T(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,a=T(e-this.center[0]),o=T(t),s=Math.sqrt(n-2*r*Math.sin(o))/r;return{x:s*Math.sin(a*r),y:s*Math.cos(a*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,a=i+t;let o=Math.atan2(e,Math.abs(a))*Math.sign(a);a*r<0&&(o-=Math.PI*Math.sign(e)*Math.sign(a));const s=T(this.center[0])*r;o=L(o,-Math.PI-s,Math.PI-s);const l=C(w(o/r)+this.center[0],-180,180),u=Math.asin(C((n-(e*e+a*a)*r*r)/(2*r),-1,1)),c=C(w(u),-Hh,Hh);return new Bh(l,c)}}const P_=1.340264,M_=-.081106,R_=893e-6,C_=.003796,O_=Math.sqrt(3)/2;class L_ extends A_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(O_*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(O_*(P_+3*M_*n+i*(7*R_+9*C_*n)))/Math.PI+.5),y:1-.5*(r*(P_+M_*n+i*(R_+C_*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let e,a,o,s=0;s<12&&(a=r*(P_+M_*n+i*(R_+C_*n))-t,o=P_+3*M_*n+i*(7*R_+9*C_*n),e=a/o,r=C(r-e,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(e)<1e-12));++s);const a=O_*e*(P_+3*M_*n+i*(7*R_+9*C_*n))/Math.cos(r),o=Math.asin(Math.sin(r)/O_),s=C(180*a/Math.PI,-180,180),l=C(180*o/Math.PI,-Hh,Hh);return new Bh(s,l)}}class I_ extends A_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=C(360*(.5-t),-Hh,Hh);return new Bh(r,n)}}const D_=Math.PI/2;function k_(e){return Math.tan((D_+e)/2)}class B_ extends A_{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let n=T(t),i=T(r);this.southernCenter=n+i<0,this.southernCenter&&(n=-n,i=-i);const a=Math.cos(n),o=k_(n);this.n=n===i?Math.sin(n):Math.log(a/Math.cos(i))/Math.log(k_(i)/o),this.f=a*Math.pow(k_(n),this.n)/this.n}project(e,t){t=T(t),this.southernCenter&&(t=-t),e=T(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-D_+r&&(t=-D_+r):t>D_-r&&(t=D_-r);const a=i/Math.pow(k_(t),n);let o=a*Math.sin(n*e),s=i-a*Math.cos(n*e);return o=.5*(o/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:o,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,a=Math.sign(i),o=Math.sign(r)*Math.sqrt(e*e+i*i);let s=Math.atan2(e,Math.abs(i))*a;i*r<0&&(s-=Math.PI*Math.sign(e)*a);const l=C(w(s/r)+this.center[0],-180,180),u=C(w(2*Math.atan(Math.pow(n/o,1/r))-D_),-Hh,Hh);return new Bh(l,this.southernCenter?-u:u)}}class F_ extends A_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Uh(e),y:jh(t),z:0}}unproject(e,t){const r=zh(e),n=Vh(t);return new Bh(r,n)}}const N_=T(Hh);class q_ extends A_{project(e,t){const r=(t=T(t))*t,n=r*r;return{x:.5*((e=T(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,a=r*r;do{a=r*r;const e=a*a;i=(r*(1.007226+a*(.015085+e*(.028874*a-.044475-.005916*e)))-t)/(1.007226+a*(.045255+e*(.259866*a-.311325-.005916*11*e))),r=C(r-i,-N_,N_)}while(Math.abs(i)>1e-6&&--n>0);a=r*r;const o=C(w(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),s=w(r);return new Bh(o,s)}}const U_=T(Hh);class j_ extends A_{project(e,t){t=T(t),e=T(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),a=Math.sin(i)/i,o=.5*(e*n+2*r*Math.sin(e/2)/a)||0,s=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const a=1e-6;let o=0,s=0;do{const i=Math.cos(n),a=Math.sin(n),l=2*a*i,u=a*a,c=i*i,d=Math.cos(r/2),h=Math.sin(r/2),f=2*d*h,p=h*h,m=1-c*d*d,g=m?1/m:0,_=m?Math.acos(i*d)*Math.sqrt(1/m):0,y=.5*(2*_*i*h+2*r/Math.PI)-e,v=.5*(_*a+n)-t,b=.5*g*(c*p+_*i*d*u)+1/Math.PI,x=g*(f*l/4-_*a*h),T=.125*g*(l*h-_*a*c*f),w=.5*g*(u*d+_*p*i)+.5,E=x*T-w*b;o=(v*x-y*w)/E,s=(y*T-v*b)/E,r=C(r-o,-Math.PI,Math.PI),n=C(n-s,-U_,U_)}while((Math.abs(o)>a||Math.abs(s)>a)&&--i>0);return new Bh(w(r),w(n))}}class G_ extends A_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(T(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:T(e)*n*r+.5,y:-Math.sin(T(t))/n*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,a=C(w((e-.5)/r)/n,-180,180),o=Math.asin(C(i*n,-1,1)),s=C(w(o),-Hh,Hh);return new Bh(a,s)}}class z_ extends F_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,r){const n=fh(e,t,r),i=gh(ih(r));return Td.transformMat4(n,n,i),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,t){const r=hh(t.lat,t.lng),n=Td.normalize([],r),i=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,a=Gh(1,0)*nn*i;Td.scaleAndAdd(r,r,n,a);const o=gd.identity(new Float64Array(16));return gd.multiply(o,e.pixelMatrix,e.globeMatrix),Td.transformMat4(r,r,o),new y(r[0],r[1])}pixelsPerMeter(e,t){return Gh(1,0)*t}pixelSpaceConversion(e,t,r){const n=Gh(1,e)*t,i=Hn(Gh(1,45)*t,n,r);return this.pixelsPerMeter(e,t)/i}createTileMatrix(e,t,r){const n=_h(ih(r.canonical));return gd.multiply(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:r}=e,n=gh(ih(t));return gd.rotateY(n,n,T(r.lng)),gd.rotateX(n,n,T(r.lat)),gd.scale(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,r,n){return th(e,t,r,!0)||new Kh(0,0)}pointCoordinate3D(e,t,r){const n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!th(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,a=e._camera.forward(),o=Td.add([],Td.scale([],a,-r),[0,0,n]),s=e.worldSize/(2*Math.PI),l=[0,0,-s],u=e.width/e.height,c=Math.tan(e.fovAboveCenter),d=Td.scale([],i.up(),c),h=Td.scale([],i.right(),c*u),f=Td.normalize([],Td.add([],Td.add([],a,d),h)),p=[];let m;if(new Fd(o,f).closestPointOnSphere(l,s,p)){const t=Td.add([],p,l),r=Td.sub([],t,o);m=Math.cos(e.fovAboveCenter)*Td.length(r)}else{const e=Td.sub([],o,l),t=Td.sub([],l,o);Td.normalize(t,t);const r=Td.length(e)-s;m=Math.sqrt(r*(r+2*s));const n=Math.acos(m/(s+r))-Math.acos(Td.dot(a,t));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=xh(e.zoom);if(r>0){const n=v_(e,Gh(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Hn(t,n+i*(1-Math.cos(a)),Math.pow(r,10))}return t}upVector(e,t,r){return fh(t,r,e,1)}upVectorScale(e){return{metersToTile:eh(ph(ih(e)))}}}function V_(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new F_(e);case"equirectangular":return new I_(e);case"naturalEarth":return new q_(e);case"equalEarth":return new L_(e);case"winkelTripel":return new j_(e);case"albers":return r?new G_(e):new S_(e);case"lambertConformalConic":return r?new G_(e):new B_(e);case"globe":return new z_(e)}throw new Error(`Invalid projection name: ${e.name}`)}const $_=new us({"symbol-placement":new os(St.layout_symbol["symbol-placement"]),"symbol-spacing":new os(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new os(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ss(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new os(St.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new os(St.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new os(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new os(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new os(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new os(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new ss(St.layout_symbol["icon-size"]),"icon-text-fit":new ss(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ss(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new ss(St.layout_symbol["icon-image"]),"icon-rotate":new ss(St.layout_symbol["icon-rotate"]),"icon-padding":new os(St.layout_symbol["icon-padding"]),"icon-keep-upright":new os(St.layout_symbol["icon-keep-upright"]),"icon-offset":new ss(St.layout_symbol["icon-offset"]),"icon-anchor":new ss(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new os(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new os(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new os(St.layout_symbol["text-rotation-alignment"]),"text-field":new ss(St.layout_symbol["text-field"]),"text-font":new ss(St.layout_symbol["text-font"]),"text-size":new ss(St.layout_symbol["text-size"]),"text-max-width":new ss(St.layout_symbol["text-max-width"]),"text-line-height":new ss(St.layout_symbol["text-line-height"]),"text-letter-spacing":new ss(St.layout_symbol["text-letter-spacing"]),"text-justify":new ss(St.layout_symbol["text-justify"]),"text-radial-offset":new ss(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new os(St.layout_symbol["text-variable-anchor"]),"text-anchor":new ss(St.layout_symbol["text-anchor"]),"text-max-angle":new os(St.layout_symbol["text-max-angle"]),"text-writing-mode":new os(St.layout_symbol["text-writing-mode"]),"text-rotate":new ss(St.layout_symbol["text-rotate"]),"text-padding":new os(St.layout_symbol["text-padding"]),"text-keep-upright":new os(St.layout_symbol["text-keep-upright"]),"text-transform":new ss(St.layout_symbol["text-transform"]),"text-offset":new ss(St.layout_symbol["text-offset"]),"text-allow-overlap":new os(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new os(St.layout_symbol["text-ignore-placement"]),"text-optional":new os(St.layout_symbol["text-optional"]),visibility:new os(St.layout_symbol.visibility)});var H_={paint:new us({"icon-opacity":new ss(St.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ss(St.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ss(St.paint_symbol["text-emissive-strength"]),"icon-color":new ss(St.paint_symbol["icon-color"]),"icon-halo-color":new ss(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new ss(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ss(St.paint_symbol["icon-halo-blur"]),"icon-translate":new os(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new os(St.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ss(St.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ss(St.paint_symbol["text-opacity"]),"text-color":new ss(St.paint_symbol["text-color"],{runtimeType:Ut,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new ss(St.paint_symbol["text-halo-color"]),"text-halo-width":new ss(St.paint_symbol["text-halo-width"]),"text-halo-blur":new ss(St.paint_symbol["text-halo-blur"]),"text-translate":new os(St.paint_symbol["text-translate"]),"text-translate-anchor":new os(St.paint_symbol["text-translate-anchor"])}),layout:$_};class W_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Bt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ao(W_,"FormatSectionOverride",{omit:["defaultValue"]});class X_ extends fs{constructor(e,t){super(e,H_,t)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||pa(a.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,i)}createBucket(e){return new oy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of H_.paint.overridableProperties){if(!X_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new W_(t),n=new fa(r,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new ga("source",n):new _a("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new is(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&X_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=H_.paint.properties[t];let i=!1;const a=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof lr)a(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{i||(t instanceof mr&&hr(t.value)===Vt?a(t.value.sections):t instanceof br?a(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),r=[];return e&&r.push("symbolIcon"),t&&r.push("symbolSDF"),r}getDefaultProgramParams(e,t){return{config:new zl(this,t),overrideFog:!1}}}const Y_=Qp.types,Z_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function K_(e,t,r,n,i,a,o,s,l,u,c,d,h){const f=s?Math.min(f_,Math.round(s[0])):0,p=s?Math.min(f_,Math.round(s[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),a,o,(f<<1)+(l?1:0),p,16*u,16*c,256*d,256*h)}function J_(e,t,r){e.emplaceBack(t,r)}function Q_(e,t,r,n,i,a,o){e.emplaceBack(t,r,n,i,a,o)}function ey(e,t,r,n,i){const a=5*t+2;e.float32[a+0]=r,e.float32[a+1]=n,e.float32[a+2]=i}function ty(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function ry(e){for(const t of e.sections)if(No(t.text))return!0;return!1}class ny{constructor(e){this.layoutVertexArray=new Rs,this.indexArray=new Ns,this.programConfigurations=e,this.segments=new ul,this.dynamicLayoutVertexArray=new As,this.opacityVertexArray=new Os,this.placedSymbolArray=new Qs,this.iconTransitioningVertexArray=new Ls,this.globeExtVertexArray=new Cs,this.zOffsetVertexArray=new js}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,r,n,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$m.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Z_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Ym.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Xm.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ao(ny,"SymbolBuffers");class iy{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ul,this.collisionVertexArray=new Bs,this.collisionVertexArrayExt=new Fs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Km.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ao(iy,"CollisionBuffers");class ay{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gd.identity([]),this.placementViewportMatrix=gd.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rg(this.zoom,t["text-size"]),this.iconSizeData=rg(this.zoom,t["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>vg[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new ny(new Vl(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new ny(new Vl(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new rl,this.lineVertexArray=new nl,this.symbolInstances=new tl}calculateGlyphDependencies(e,t,r,n,i){for(let r=0;r<e.length;r++){const a=e.codePointAt(r);if(void 0===a)break;if(t[a]=!0,n&&i&&a<=65535){const n=sg[e.charAt(r)];n&&(t[n.charCodeAt(0)]=!0)}}}populate(e,t,r,n){const i=this.layers[0],a=i.layout,o="globe"===this.projection.name,s=a.get("text-font"),l=a.get("text-field"),u=a.get("icon-image"),c=("constant"!==l.value.kind||l.value.value instanceof lr&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),d="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,h=a.get("symbol-sort-key");if(this.features=[],!c&&!d)return;const f=t.iconDependencies,p=t.glyphDependencies,m=t.availableImages,g=new Ko(this.zoom);for(const{feature:t,id:l,index:u,sourceLayerIndex:_}of e){const e=i._featureFilter.needGeometry,y=sf(t,e);if(!i._featureFilter.filter(g,y,r))continue;if(e||(y.geometry=of(t,r,n)),o&&1!==t.type&&r.z<=5){const e=y.geometry,t=.98078528056,n=(e,n)=>{const i=fh(e.x,e.y,r,1),a=fh(n.x,n.y,r,1);return Td.dot(i,a)<t};for(let t=0;t<e.length;t++)e[t]=tf(e[t],n)}let v,b;if(c){const e=i.getValueAndResolveTokens("text-field",y,r,m),t=lr.factory(e);ry(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Xo()||this.hasRTLText&&Zo.isParsed())&&(v=og(t,i,y))}if(d){const e=i.getValueAndResolveTokens("icon-image",y,r,m);b=e instanceof ur?e:ur.fromString(e)}if(!v&&!b)continue;const x=this.sortFeaturesByKey?h.evaluate(y,{},r):void 0;if(this.features.push({id:l,text:v,icon:b,index:u,sourceLayerIndex:_,geometry:y.geometry,properties:t.properties,type:Y_[t.type],sortKey:x}),b&&(f[b.namePrimary]=!0,b.nameSecondary&&(f[b.nameSecondary]=!0)),v){const e=s.evaluate(y,{},r).join(","),t="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vg.vertical)>=0;for(const r of v.sections)if(r.image)f[r.image.namePrimary]=!0;else{const n=Oo(v.toString()),i=r.fontStack||e,a=p[i]=p[i]||{};this.calculateGlyphDependencies(r.text,a,t,this.allowVerticalPlacement,n)}}}"line"===a.get("symbol-placement")&&(this.features=function(e){const t={},r={},n=[];let i=0;function a(t){n.push(e[t]),i++}function o(e,t,i){const a=r[e];return delete r[e],r[t]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(i[0]),a}function s(e,r,i){const a=t[r];return delete t[r],t[e]=a,n[a].geometry[0].shift(),n[a].geometry[0]=i[0].concat(n[a].geometry[0]),a}function l(e,t,r){const n=r?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let u=0;u<e.length;u++){const c=e[u],d=c.geometry,h=c.text?c.text.toString():null;if(!h){a(u);continue}const f=l(h,d),p=l(h,d,!0);if(f in r&&p in t&&r[f]!==t[p]){const e=s(f,p,d),i=o(f,p,n[e].geometry);delete t[f],delete r[p],r[l(h,n[i].geometry,!0)]=i,n[e].geometry=null}else f in r?o(f,p,d):p in t?s(f,p,d):(a(u),t[f]=i-1,r[p]=i-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,n,i){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,o,r,n,i),this.icon.programConfigurations.updatePaintArrays(e,t,o,r,n,i)}updateZOffset(){const e=(e,t,n)=>{r+=t,r>e.length&&e.resize(r);for(let i=-t;i<0;i++)e.emplace(i+r,n)},t=(e,t,r)=>{n+=t,n>e.length&&e.resize(n);for(let i=-t;i<0;i++)e.emplace(i+n,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:a,numIconVertices:o}=n,s=n.zOffset,l=o>0;if((i>0||a>0)&&(e(this.text.zOffsetVertexArray,i,s),e(this.text.zOffsetVertexArray,a,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:r}=n;e>=0&&t(this.icon.zOffsetVertexArray,o,s),r>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=V_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:r}of t)this.lineVertexArray.emplaceBack(e,r);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?a.sortKey:void 0),b=this.glyphOffsetArray.length,x=v.vertexLength,T=this.allowVerticalPlacement&&o===vg.vertical?Math.PI/2:0,w=a.text&&a.text.sections;for(let n=0;n<t.length;n++){const{tl:i,tr:o,bl:u,br:c,texPrimary:d,texSecondary:b,pixelOffsetTL:x,pixelOffsetBR:E,minFontScaleX:A,minFontScaleY:S,glyphOffset:P,isSDF:M,sectionIndex:R}=t[n],C=v.vertexLength,O=P[1];if(K_(_,l.x,l.y,i.x,O+i.y,d.x,d.y,r,M,x.x,x.y,A,S),K_(_,l.x,l.y,o.x,O+o.y,d.x+d.w,d.y,r,M,E.x,x.y,A,S),K_(_,l.x,l.y,u.x,O+u.y,d.x,d.y+d.h,r,M,x.x,E.y,A,S),K_(_,l.x,l.y,c.x,O+c.y,d.x+d.w,d.y+d.h,r,M,E.x,E.y,A,S),s){const{x:t,y:r,z:n}=s.anchor,[i,a,o]=s.up;Q_(y,t,r,n,i,a,o),Q_(y,t,r,n,i,a,o),Q_(y,t,r,n,i,a,o),Q_(y,t,r,n,i,a,o),ty(e.dynamicLayoutVertexArray,t,r,n,T)}else ty(e.dynamicLayoutVertexArray,l.x,l.y,l.z,T);if(m){const t=b||d;J_(e.iconTransitioningVertexArray,t.x,t.y),J_(e.iconTransitioningVertexArray,t.x+t.w,t.y),J_(e.iconTransitioningVertexArray,t.x,t.y+t.h),J_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(C,C+1,C+2),g.emplaceBack(C+1,C+2,C+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),n!==t.length-1&&R===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,a,a.index,{},h,f,p,w&&w[R])}const E=s?s.anchor:l;e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,l.x,l.y,b,this.glyphOffsetArray.length-b,x,u,c,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,!1,0,d,0)}_commitLayoutVertex(e,t,r,n,i,a,o){e.emplaceBack(t,r,n,i,a,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,r,n,i,a,o){const s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=s.vertexLength,u=o.tileAnchorX,c=o.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,u,c,new y(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,u,c,new y(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,u,c,new y(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,u,c,new y(e.x1,e.y2)),s.vertexLength+=4;const d=r.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,a){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,t,r,n,i,a){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iy(Ds,Jm.members,Ls),this.iconCollisionBox=new iy(Ds,Jm.members,Ls);const r=ig(this.iconSizeData,e),n=ig(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(n,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,r,n){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),a=ng(this.textSizeData,e,i)/eg;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=ng(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(e,t,r,n,i,a){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding)}}_updateIconDebugCollisionBoxes(e,t,r,n,i,a){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=ig(this.iconSizeData,e),n=ig(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(n,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,a,o,s,l){const u={};if(t<r){const{x1:r,y1:n,x2:i,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(t);u.textBox={x1:r,y1:n,x2:i,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h},u.textFeatureIndex=f}if(n<i){const{x1:t,y1:r,x2:i,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(n);u.verticalTextBox={x1:t,y1:r,x2:i,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h},u.verticalTextFeatureIndex=f}if(a<o){const{x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(a);u.iconBox={x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h},u.iconFeatureIndex=f}if(s<l){const{x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(s);u.verticalIconBox={x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:h},u.verticalIconFeatureIndex=f}return u}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let t=r.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);const o=this.symbolInstances.get(e);n.push(0|Math.round(t*o.tileAnchorX+r*o.tileAnchorY)),i.push(o.featureIndex)}return a.sort(((e,t)=>n[e]-n[t]||i[t]-i[e])),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:s}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ao(ay,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ay.MAX_GLYPHS=65535,ay.addDynamicAttributes=ty;var oy=ay;const sy=ys([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ly}=sy,uy=ys([{name:"a_packed",components:4,type:"Float32"}]),{members:cy}=uy,dy=Qp.types,hy=Math.cos(Math.PI/180*37.5);class fy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Es,this.layoutVertexArray2=new As,this.indexArray=new Ns,this.programConfigurations=new Vl(e.layers,e.zoom),this.segments=new ul,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,n){this.hasPattern=Rp("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:t,id:o,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u=sf(t,e);if(!this.layers[0]._featureFilter.filter(new Ko(this.zoom),u,r))continue;const c=i?i.evaluate(u,{},r):void 0,d={id:o,properties:t.properties,type:t.type,sourceLayerIndex:l,index:s,geometry:e?u.geometry:of(t,r,n),patterns:{},sortKey:c};a.push(d)}i&&a.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:o,featureIndex:s}=t,l=this.addConstantDashes(o);for(const n of a){const{geometry:i,index:a,sourceLayerIndex:u}=n;if(l&&this.addFeatureDashes(n,o),this.hasPattern){const e=Cp("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,a,r,o.positions,t.availableImages,t.brightness);s.insert(e[a].feature,i,a,u,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,a=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===a.kind)continue;let o,s;if("constant"===i.kind){if(o=i.value,!o)continue}else o=i.evaluate({zoom:r},e);s="constant"===a.kind?a.value:a.evaluate({zoom:r},e),t.addDash(o,s),e.patterns[n.id]=t.getKey(o,s)}}update(e,t,r,n,i){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,r,n,i)}addFeatures(e,t,r,n,i,a){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,cy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ly),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,n,i,a,o){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),u=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),d=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,l,u,c,d);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,a,n,o)}addLine(e,t,r,n,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===dy[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(o?3:2))return;"bevel"===r&&(i=1.05);const u=this.overscaling<=16?15*nn/(512*this.overscaling):0,c=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let d,h,f,p,m;this.e1=this.e2=-1,o&&(d=e[s-2],m=e[l].sub(d)._unit()._perp());for(let t=l;t<s;t++){if(f=t===s-1?o?e[l+1]:void 0:e[t+1],f&&e[t].equals(f))continue;m&&(p=m),d&&(h=d),d=e[t],m=f?f.sub(d)._unit()._perp():p,p=p||m;let g=p.add(m);0===g.x&&0===g.y||g._unit();const _=p.x*m.x+p.y*m.y,y=g.x*m.x+g.y*m.y,v=0!==y?1/y:1/0,b=2*Math.sqrt(2-2*y),x=y<hy&&h&&f,T=p.x*m.y-p.y*m.x>0;if(x&&t>l){const e=d.dist(h);if(e>2*u){const t=d.sub(d.sub(h)._mult(u/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,p,0,0,c),h=t}}const w=h&&f;let E=w?r:o?"butt":n;if(w&&"round"===E&&(v<a?E="miter":v<=2&&(E="fakeround")),"miter"===E&&v>i&&(E="bevel"),"bevel"===E&&(v>2&&(E="flipbevel"),v<i&&(E="miter")),h&&this.updateDistance(h,d),"miter"===E)g._mult(v),this.addCurrentVertex(d,g,0,0,c);else if("flipbevel"===E){if(v>100)g=m.mult(-1);else{const e=v*p.add(m).mag()/p.sub(m).mag();g._perp()._mult(e*(T?-1:1))}this.addCurrentVertex(d,g,0,0,c),this.addCurrentVertex(d,g.mult(-1),0,0,c)}else if("bevel"===E||"fakeround"===E){const e=-Math.sqrt(v*v-1),t=T?e:0,r=T?0:e;if(h&&this.addCurrentVertex(d,p,t,r,c),"fakeround"===E){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const n=m.sub(p)._mult(r)._add(p)._unit()._mult(T?-1:1);this.addHalfVertex(d,n.x,n.y,!1,T,0,c)}}f&&this.addCurrentVertex(d,m,-t,-r,c)}else if("butt"===E)this.addCurrentVertex(d,g,0,0,c);else if("square"===E){const e=h?1:-1;h||this.addCurrentVertex(d,g,e,e,c),this.addCurrentVertex(d,g,0,0,c),h&&this.addCurrentVertex(d,g,e,e,c)}else"round"===E&&(h&&(this.addCurrentVertex(d,p,0,0,c),this.addCurrentVertex(d,p,1,1,c,!0)),f&&(this.addCurrentVertex(d,m,-1,-1,c,!0),this.addCurrentVertex(d,m,0,0,c)));if(x&&t<s-1){const e=d.dist(f);if(e>2*u){const t=d.add(f.sub(d)._mult(u/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,m,0,0,c),d=t}}}}addCurrentVertex(e,t,r,n,i,a=!1){const o=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,a,!1,r,i),this.addHalfVertex(e,o,s,a,!0,-n,i)}addHalfVertex({x:e,y:t},r,n,i,a,o,s){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(a?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),a?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Ao(fy,"LineBucket",{omit:["layers","patternFeatures"]});class py{constructor(e,t,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,r,n){const{width:i,height:a}=e,{context:o}=this,{gl:s}=o,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:c,ImageData:d,ImageBitmap:h}=t;if(s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!r||!1!==r.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===a){const{x:t,y:r}=n||{x:0,y:0};if(e instanceof l||e instanceof u||e instanceof c||e instanceof d||h&&e instanceof h)s.texSubImage2D(s.TEXTURE_2D,0,t,r,s.RGBA,s.UNSIGNED_BYTE,e);else{let n=this.format,o=s.UNSIGNED_BYTE;this.format===s.R32F&&(n=s.RED,o=s.FLOAT),s.texSubImage2D(s.TEXTURE_2D,0,t,r,i,a,n,o,e.data)}}else if(this.size=[i,a],e instanceof l||e instanceof u||e instanceof c||e instanceof d||h&&e instanceof h){let t=this.format;this.format===s.R8&&(t=s.RED),s.texImage2D(s.TEXTURE_2D,0,this.format,t,s.UNSIGNED_BYTE,e)}else{let t=this.format,r=this.format,n=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(t=s.DEPTH_COMPONENT16,n=s.UNSIGNED_SHORT),this.format===s.R32F&&(n=s.FLOAT,r=s.RED),s.texImage2D(s.TEXTURE_2D,0,t,i,a,0,r,n,e.data)}this.useMipmap=Boolean(r&&r.useMipmap),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,r,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class my{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}}const gy=32,_y=33,yy=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,n=0,i=0,a=0,o=0,s=0;for(1&t?i=a=o=gy:r=n=s=gy;(t>>=1)>1;){const e=r+i>>1,l=n+a>>1;1&t?(i=r,a=n,r=o,n=s):(r=i,n=a,i=o,a=s),o=e,s=l}const l=4*e;yy[l+0]=r,yy[l+1]=n,yy[l+2]=i,yy[l+3]=a}const vy=new Uint16Array(2178),by=new Uint8Array(1089),xy=new Uint16Array(1089);function Ty(e){return 0===e?-.03125:32===e?.03125:0}var wy=ys([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ey={type:2,extent:nn,loadGeometry:()=>[[new y(0,0),new y(nn+1,0),new y(nn+1,nn+1),new y(0,nn+1),new y(0,0)]]};class Ay{constructor(e,t,r,n,i){this.tileID=e,this.uid=N(),this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<st.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=b_(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)r[t.fqid]=n}}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof oy){if(this.hasSymbolBuckets=!0,!r)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof oy&&t.hasRTLText){this.hasRTLText=!0,Zo.isLoading()||Zo.isLoaded()||"deferred"!==Xo()||Yo();break}}this.queryPadding=0;for(const e in this.buckets){const r=this.buckets[e],n=t.style.getOwnLayer(e);if(!n)continue;const i=n.queryRadius(r);this.queryPadding=Math.max(this.queryPadding,i)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Ks}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const t in this.buckets){const r=this.buckets[t];r.uploadPending()&&r.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new py(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new py(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new py(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,t,r){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=t.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,r,n,i,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:a,params:i,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(e,t){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),i=t?t.sourceLayer:"",a=n._geojsonTileLayer||n[i];if(!a)return;const o=Ra(t&&t.filter),{z:s,x:l,y:u}=this.tileID.canonical,c={z:s,x:l,y:u};for(let t=0;t<a.length;t++){const n=a.feature(t);if(o.needGeometry){const e=sf(n,!0);if(!o.filter(new Ko(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new Ko(this.tileID.overscaledZ),n))continue;const d=r.getId(n,i),h=new Sm(n,s,l,u,d);h.tile=c,e.push(h)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=ee(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let r=!1;if(this.expirationTime>e)r=!1;else if(t)if(this.expirationTime<t)r=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages(),i=t.style.getBrightness();for(const a in this.buckets){if(!t.style.hasLayer(a))continue;const o=this.buckets[a],s=o.layers[0].sourceLayer||"_geojsonTileLayer",l=r[s];let u={};if(e&&(u=e[s],!l||!u||0===Object.keys(u).length))continue;if(o.update(u,l,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},i),o instanceof fy||o instanceof Op){const e=t.style.getOwnSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getOwnLayer(a);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<st.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=st.now()+e}setTexture(e,t){const r=t.context,n=r.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new py(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const r={};for(const e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const r=of(Ey,this.tileID.canonical,this.tileTransform)[0],n=new bs,i=new $s;for(let e=0;e<r.length;e++){const{x:t,y:a}=r[e];n.emplaceBack(t,a),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Rd.members),this._tileDebugSegments=ul.simpleSegment(0,0,n.length,i.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const r=of(Ey,this.tileID.canonical,this.tileTransform)[0];let n,i;if(this.isRaster){const e=function(e,t){const r=b_(e,t),n=Math.pow(2,e.z);for(let i=0;i<_y;i++)for(let a=0;a<_y;a++){const o=zh((e.x+(a+Ty(a))/gy)/n),s=Vh((e.y+(i+Ty(i))/gy)/n),l=t.project(o,s),u=i*_y+a;vy[2*u+0]=Math.round((l.x*r.scale-r.x)*nn),vy[2*u+1]=Math.round((l.y*r.scale-r.y)*nn)}by.fill(0),xy.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=yy[t+0],n=yy[t+1],i=yy[t+2],a=yy[t+3],o=r+i>>1,s=n+a>>1,l=o+s-n,u=s+r-o,c=n*_y+r,d=a*_y+i,h=s*_y+o,f=Math.hypot((vy[2*c+0]+vy[2*d+0])/2-vy[2*h+0],(vy[2*c+1]+vy[2*d+1])/2-vy[2*h+1])>=16;by[h]=by[h]||(f?1:0),e<1022&&(by[h]=by[h]||by[(n+u>>1)*_y+(r+l>>1)]||by[(a+u>>1)*_y+(i+l>>1)])}const i=new Ts,a=new Ns;let o=0;function s(e,t){const r=t*_y+e;return 0===xy[r]&&(i.emplaceBack(vy[2*r+0],vy[2*r+1],e*nn/gy,t*nn/gy),xy[r]=++o),xy[r]-1}function l(e,t,r,n,i,o){const u=e+r>>1,c=t+n>>1;if(Math.abs(e-i)+Math.abs(t-o)>1&&by[c*_y+u])l(i,o,e,t,u,c),l(r,n,i,o,u,c);else{const l=s(e,t),u=s(r,n),c=s(i,o);a.emplaceBack(l,u,c)}}return l(0,0,gy,gy,gy,0),l(gy,gy,0,0,0,gy),{vertices:i,indices:a}}(this.tileID.canonical,t);n=e.vertices,i=e.indices}else{n=new Ts,i=new Ns;for(const{x:e,y:t}of r)n.emplaceBack(e,t,0,0);const e=Sp(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)i.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,wy.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(i),this._tileBoundsSegments=ul.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugBuffers(e,t){const r=t.projection;if(!r||"globe"!==r.name||t.freezeTileCoverage)return;const n=this.tileID.canonical,i=gh(oh(n,t)),a=xh(t.zoom);let o;a>0&&(o=gd.invert(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,t,i,o,a),this._makeGlobeTileDebugTextBuffer(e,n,t,i,o,a)}_globePoint(e,t,r,n,i,a,o){let s=fh(e,t,r);if(a){const i=1<<r.z,l=Uh(n.center.lng),u=jh(n.center.lat),c=(r.x+.5)/i-l;let d=0;c>.5?d=-1:c<-.5&&(d=1);let h=(e/nn+r.x)/i+d,f=(t/nn+r.y)/i;h=(h-l)*n._pixelsPerMercatorPixel+l,f=(f-u)*n._pixelsPerMercatorPixel+u;const p=[h*n.worldSize,f*n.worldSize,0];Td.transformMat4(p,p,a),s=ah(s,p,o)}return Td.transformMat4(s,s,i)}_makeGlobeTileDebugBorderBuffer(e,t,r,n,i,a){const o=new bs,s=new $s,l=new xs,u=(e,u,c,d,h)=>{const f=(c-e)/(h-1),p=(d-u)/(h-1),m=o.length;for(let c=0;c<h;c++){const d=e+c*f,h=u+c*p;o.emplaceBack(d,h);const g=this._globePoint(d,h,t,r,n,i,a);l.emplaceBack(g[0],g[1],g[2]),s.emplaceBack(m+c)}},c=nn;u(0,0,c,0,16),u(c,0,c,c,16),u(c,c,0,c,16),u(0,c,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(o,Rd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Md.members),this._tileDebugSegments=ul.simpleSegment(0,0,o.length,s.length)}_makeGlobeTileDebugTextBuffer(e,t,r,n,i,a){const o=nn/4,s=new bs,l=new Ns,u=new xs,c=25;l.reserve(32),s.reserve(c),u.reserve(c);const d=(e,t)=>c*e+t;for(let e=0;e<c;e++){const l=e*o;for(let e=0;e<c;e++){const c=e*o;s.emplaceBack(c,l);const d=this._globePoint(c,l,t,r,n,i,a);u.emplaceBack(d[0],d[1],d[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=d(e,t),n=d(e,t+1),i=d(e+1,t),a=d(e+1,t+1);l.emplaceBack(r,n,i),l.emplaceBack(i,n,a)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(s,Rd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,Md.members),this._tileDebugTextSegments=ul.simpleSegment(0,0,c,32)}}class Sy{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout((()=>{this.remove(e,i)}),r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class Py{constructor(e,t,r,n){this.id=Py.uniqueIdxCounter,Py.uniqueIdxCounter++,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Py.uniqueIdxCounter,Py.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Py.uniqueIdxCounter=0;const My={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ry{constructor(e,t,r,n,i,a){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.instanceCount=a,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){const n=t.attributes[this.attributes[r].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=this.attributes[n],a=t.attributes[i.name];void 0!==a&&e.vertexAttribPointer(a,i.components,e[My[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(i,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cy{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oy extends Cy{getDefault(){return ar.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ly extends Cy{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Iy extends Cy{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Dy extends Cy{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ky extends Cy{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class By extends Cy{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Fy extends Cy{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ny extends Cy{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class qy extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Uy extends Cy{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class jy extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Gy extends Cy{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class zy extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Vy extends Cy{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class $y extends Cy{getDefault(){return ar.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Hy extends Cy{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Wy extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Xy extends Cy{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Yy extends Cy{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Zy=class extends Cy{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class Ky extends Cy{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Jy extends Cy{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Qy extends Cy{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ev extends Cy{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class tv extends Cy{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class rv extends Cy{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class nv extends Cy{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class iv extends Cy{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class av extends Cy{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ov extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class sv extends Cy{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class lv extends Cy{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class uv extends lv{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class cv extends lv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class dv extends lv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class hv extends cv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fv{constructor(e,t,r,n,i){this.context=e,this.width=t,this.height=r;const a=this.framebuffer=e.gl.createFramebuffer();n&&(this.colorAttachment=new uv(e,a)),i&&(this.depthAttachmentType=i,this.depthAttachment="renderbuffer"===i?new cv(e,a):new dv(e,a))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class pv{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}pv.ReadOnly=!1,pv.ReadWrite=!0,pv.disabled=new pv(519,pv.ReadOnly,[0,1]);const mv=7680;class gv{constructor(e,t,r,n,i,a){this.test=e,this.ref=t,this.mask=r,this.fail=n,this.depthFail=i,this.pass=a}}gv.disabled=new gv({func:519,mask:0},0,0,mv,mv,mv);const _v=771;class yv{constructor(e,t,r,n){this.blendFunction=e,this.blendColor=t,this.mask=r,this.blendEquation=n}}yv.Replace=[1,0,1,0],yv.disabled=new yv(yv.Replace,ar.transparent,[!1,!1,!1,!1]),yv.unblended=new yv(yv.Replace,ar.transparent,[!0,!0,!0,!0]),yv.alphaBlended=new yv([1,_v,1,_v],ar.transparent,[!0,!0,!0,!0]),yv.multiply=new yv([774,0,774,0],ar.transparent,[!0,!0,!0,!0]);const vv=1029,bv=2305;class xv{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}xv.disabled=new xv(!1,vv,bv),xv.backCCW=new xv(!0,vv,bv),xv.backCW=new xv(!0,vv,2304),xv.frontCW=new xv(!0,1028,2304),xv.frontCCW=new xv(!0,1028,bv);class Tv{constructor(e){this.gl=e,this.clearColor=new Oy(this),this.clearDepth=new Ly(this),this.clearStencil=new Iy(this),this.colorMask=new Dy(this),this.depthMask=new ky(this),this.stencilMask=new By(this),this.stencilFunc=new Fy(this),this.stencilOp=new Ny(this),this.stencilTest=new qy(this),this.depthRange=new Uy(this),this.depthTest=new jy(this),this.depthFunc=new Gy(this),this.blend=new zy(this),this.blendFunc=new Vy(this),this.blendColor=new $y(this),this.blendEquation=new Hy(this),this.cullFace=new Wy(this),this.cullFaceSide=new Xy(this),this.frontFace=new Yy(this),this.program=new Zy(this),this.activeTexture=new Ky(this),this.viewport=new Jy(this),this.bindFramebuffer=new Qy(this),this.bindRenderbuffer=new ev(this),this.bindTexture=new tv(this),this.bindVertexBuffer=new rv(this),this.bindElementBuffer=new nv(this),this.bindVertexArrayOES=new iv(this),this.pixelStoreUnpack=new av(this),this.pixelStoreUnpackPremultiplyAlpha=new ov(this),this.pixelStoreUnpackFlipY=new sv(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,r){return new Py(this,e,t,r)}createVertexBuffer(e,t,r,n,i){return new Ry(this,e,t,r,n,i)}createRenderbuffer(e,t,r){const n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,r,n){return new fv(this,e,t,r,n)}clear({color:e,depth:t,stencil:r,colorMask:n}){const i=this.gl;let a=0;e&&(a|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==t&&(a|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==r&&(a|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),i.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){v(e.blendFunction,yv.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class wv extends At{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Sy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return D(this._tiles).map((e=>e.tileID)).sort(Ev).map((e=>e.key))}getRenderableIds(e,t){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e,t)&&r.push(this._tiles[n]);return e?r.sort(((e,t)=>{const r=e.tileID,n=t.tileID,i=new y(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),a=new y(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||a.y-i.y||a.x-i.x})).map((e=>e.tileID.key)):r.map((e=>e.tileID)).sort(Ev).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new Et(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=st.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new wt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,n){for(const i in this._tiles){let a=this._tiles[i];if(n[i]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>r)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){n[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let i;if(this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Dd(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[],i.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Av(this._source.type)){const a=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),o=Math.min(a,this._source.maxzoom),s=e.extendTileCoverForShadows(i,n,o);for(const e of s)this._shadowCasterTiles[e.key]=!0,i.push(e)}const a=this._updateRetainedTiles(i);if(Av(this._source.type)&&0!==i.length){const e={},t={},r=Object.keys(a);for(const n of r){const r=a[n],i=this._tiles[n];if(!i||i.fadeEndTime&&i.fadeEndTime<=st.now())continue;const o=this.findLoadedParent(r,Math.max(r.overscaledZ-wv.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),e[o.tileID.key]=o.tileID),t[n]=r}const n=i[i.length-1].overscaledZ;for(const e in this._tiles){const r=this._tiles[e];if(a[e]||!r.hasData())continue;let i=r.tileID;for(;i.overscaledZ>n;){i=i.scaledTo(i.overscaledZ-1);const n=this._tiles[i.key];if(n&&n.hasData()&&t[i.key]){a[e]=r.tileID;break}}}for(const t in e)a[t]||(this._coveredTiles[t]=!0,a[t]=e[t])}for(const e in a)this._tiles[e].clearFadeHold();const o=function(e,t){const r=[];for(const n in e)n in t||r.push(n);return r}(this._tiles,a);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),i=e[0].overscaledZ,a=Math.max(i-wv.maxOverzooming,this._source.minzoom),o=Math.max(i+wv.maxUnderzooming,this._source.minzoom),s={};for(const r of e){const e=this._addTile(r);t[r.key]=r,e.hasData()||n<this._source.maxzoom&&(s[r.key]=r)}this._retainLoadedChildren(s,n,o,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let o=n.overscaledZ-1;o>=a;--o){const a=n.scaledTo(o);if(r[a.key])break;if(r[a.key]=!0,e=this.getTile(a),!e&&i&&(e=this._addTile(a)),e&&(t[a.key]=a,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;n=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const r=this.map?this.map.painter:null;t=new Ay(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new wt("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,r){const n=[],i=this.transform;if(!i)return n;const a="globe"===i.projection.name,o=Uh(i.center.lng);for(const s in this._tiles){const l=this._tiles[s];if(r&&l.clearQueryDebugViz(),l.holdingForFade())continue;let u;if(a){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(C(o,...Sv(e,-1))-o),Math.abs(C(o,...Sv(e,1))-o)];u=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(C(o,...Sv(e,-1))-o),Math.abs(C(o,...Sv(e,0))-o),Math.abs(C(o,...Sv(e,1))-o)];u=[t.indexOf(Math.min(...t))-1]}}else u=[0];for(const r of u){const a=e.containsTile(l,i,t,r);a&&n.push(a)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const r=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID));for(const e of r)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return r}sortCoordinatesByDistance(e){const t=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),i={};for(const e of t){const t=1/(1<<e.canonical.z);i[e.key]=((e.canonical.x+.5)*t+e.wrap-r[0])*n[0]+((e.canonical.y+.5)*t-r[1])*n[1]-r[2]*n[2]}return t.sort(((e,t)=>i[e.key]-i[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Av(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=st.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const n=this._tiles[e];n&&n.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const r=()=>{this._sourceLoaded&&(this._source.off("data",r),this._preloadTiles(e,t))};return void this._source.on("data",r)}const r=new Map,n=Array.isArray(e)?e:[e],i=this.map.painter.terrain,a=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}I(Array.from(r.values()),((e,t)=>{const r=new Ay(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),t)}}function Ev(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Av(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Sv(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}wv.maxOverzooming=10,wv.maxUnderzooming=3;const Pv=ys([{name:"a_pos_3f",components:3,type:"Float32"}]),Mv=ys([{name:"a_color_3f",components:3,type:"Float32"}]),Rv=ys([{name:"a_color_4f",components:4,type:"Float32"}]),Cv=ys([{name:"a_uv_2f",components:2,type:"Float32"}]),Ov=ys([{name:"a_normal_3f",components:3,type:"Float32"}]),Lv=ys([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Iv=ys([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Dv{constructor(e=0,t=0,r=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=n}interpolate(e,t,r){return null!=t.top&&null!=e.top&&(this.top=Hn(e.top,t.top,r)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Hn(e.bottom,t.bottom,r)),null!=t.left&&null!=e.left&&(this.left=Hn(e.left,t.left,r)),null!=t.right&&null!=e.right&&(this.right=Hn(e.right,t.right,r)),this}getCenter(e,t){const r=C((this.left+e-this.right)/2,0,e),n=C((this.top+t-this.bottom)/2,0,t);return new y(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Dv(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kv(e,t){const r=ie(e,3);gd.fromQuat(e,t),ae(e,3,r)}function Bv(e,t){const r=yd.identity([]);return yd.rotateZ(r,r,-t),yd.rotateX(r,r,-e),r}function Fv(e,t){const r=[e[0],e[1],0],n=[t[0],t[1],0];if(Td.length(r)>=1e-15){const e=Td.normalize([],r);Td.scale(n,e,Td.dot(n,e)),t[0]=n[0],t[1]=n[1]}const i=Td.cross([],t,e);if(Td.len(i)<1e-15)return null;const a=Math.atan2(-i[1],i[0]);return Bv(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),a)}class Nv{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){if(e){const t=e instanceof Kh?e:new Kh(e[0],e[1],e[2]);this._renderWorldCopies&&(t.x=L(t.x,0,1)),this._position=t}else this._position=null}lookAtPoint(e,t){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(Kh.fromLngLat(e)):0,i=Kh.fromLngLat(e,n),a=[i.x-r.x,i.y-r.y,i.z-r.z];t||(t=[0,0,1]),t[2]=Math.abs(t[2]),this.orientation=Fv(a,t)}setPitchBearing(e,t){this.orientation=Bv(T(e),T(-t))}}class qv{constructor(e,t){this._transform=gd.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){const e=this.position;return new Kh(e[0],e[1],e[2])}get position(){const e=ie(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var t;e&&ae(this._transform,3,[(t=e)[0],t[1],t[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||yd.identity([]),e&&kv(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Bv(e,t),kv(this._transform,this._orientation)}forward(){const e=ie(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=ie(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=ie(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){const r=new Float64Array(16);return gd.invert(r,this.getWorldToCamera(e,t)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,t,r){const n=this.position;Td.scale(n,n,-e);const i=new Float64Array(16);return gd.fromScaling(i,[r,r,r]),gd.translate(i,i,n),i[10]*=t,i}getWorldToCamera(e,t){const r=new Float64Array(16),n=new Float64Array(4),i=this.position;return yd.conjugate(n,this._orientation),Td.scale(i,i,-e),gd.fromQuat(r,n),gd.translate(r,r,i),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=t,r[9]*=t,r[10]*=t,r[11]*=t,r}getCameraToClipPerspective(e,t,r,n){const i=new Float64Array(16);return gd.perspective(i,e,t,r,n),i}getCameraToClipOrthographic(e,t,r,n,i,a){const o=new Float64Array(16);return gd.ortho(o,e,t,r,n,i,a),o}getDistanceToElevation(e,t=!1){const r=0===e?0:Gh(e,t?Vh(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new qv([...this.position],[...this.orientation])}}function Uv(e,t){const r=Gv(e.projection,e.zoom,e.width,e.height),n=function(e,t,r,n,i){const a=new Bh(r.lng-180*zv,r.lat),o=new Bh(r.lng+180*zv,r.lat),s=e.project(a.lng,a.lat),l=e.project(o.lng,o.lat),u=-Math.atan2(l.y-s.y,l.x-s.x),c=Kh.fromLngLat(r);c.y=C(c.y,-1+zv,1-zv);const d=c.toLngLat(),h=e.project(d.lng,d.lat),f=Kh.fromLngLat(d);f.x+=zv;const p=f.toLngLat(),m=e.project(p.lng,p.lat),g=$v(m.x-h.x,m.y-h.y,u),_=Kh.fromLngLat(d);_.y+=zv;const y=_.toLngLat(),v=e.project(y.lng,y.lat),b=$v(v.x-h.x,v.y-h.y,u),x=Math.abs(g.x)/Math.abs(b.y),T=gd.identity([]);gd.rotateZ(T,T,-u*(1-(i?0:n)));const w=gd.identity([]);return gd.scale(w,w,[1,1-(1-x)*n,1]),w[4]=-b.x/b.y*n,gd.rotateZ(w,w,u),gd.multiply(w,T,w),w}(e.projection,0,e.center,r,t),i=jv(e);return gd.scale(n,n,[i,i,1]),n}function jv(e){const t=e.projection,r=Gv(e.projection,e.zoom,e.width,e.height),n=Vv(t,e.center),i=Vv(t,Bh.convert(t.center));return Math.pow(2,n*r+(1-r)*i)}function Gv(e,t,r,n,i=1/0){const a=e.range;if(!a)return 0;const o=Math.min(i,Math.max(r,n)),s=Math.log(o/1024)/Math.LN2;return O(a[0]+s,a[1]+s,t)}const zv=1/4e4;function Vv(e,t){const r=C(t.lat,-Hh,Hh),n=new Bh(t.lng-180*zv,r),i=new Bh(t.lng+180*zv,r),a=e.project(n.lng,r),o=e.project(i.lng,r),s=Kh.fromLngLat(n),l=Kh.fromLngLat(i),u=o.x-a.x,c=o.y-a.y,d=l.x-s.x,h=l.y-s.y,f=Math.sqrt((d*d+h*h)/(u*u+c*c));return Math.log(f)/Math.LN2}function $v(e,t,r){const n=Math.cos(r),i=Math.sin(r);return{x:e*n-t*i,y:e*i+t*n}}function Hv(e,t,r){return t*(nn/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}const Wv={unknown:0,flipRequired:1,flipNotRequired:2},Xv=Math.tan(85*Math.PI/180);function Yv(e,t,r,n,i,a,o){const s=gd.create();if(r)if("globe"===a.name){const e=function(e,t){const{x:r,y:n}=e.point,i=bh(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return gd.multiply(i,i,_h(ih(t)))}(i,t);gd.multiply(s,s,e)}else{const e=dd.invert([],o);s[0]=e[0],s[1]=e[1],s[4]=e[2],s[5]=e[3],n||gd.rotateZ(s,s,i.angle)}else gd.multiply(s,i.labelPlaneMatrix,e);return s}function Zv(e,t,r,n,i,a,o){const s=Yv(e,t,r,n,i,a,o);return"globe"===a.name&&r||(s[2]=s[6]=s[10]=s[14]=0),s}function Kv(e,t,r,n,i,a,o){if(r){if("globe"===a.name){const s=Yv(e,t,r,n,i,a,o);return gd.invert(s,s),gd.multiply(s,e,s),s}{const t=gd.clone(e),r=gd.identity([]);return r[0]=o[0],r[1]=o[1],r[4]=o[2],r[5]=o[3],gd.multiply(t,t,r),n||gd.rotateZ(t,t,-i.angle),t}}return i.glCoordMatrix}function Jv(e,t,r,n){const i=[e,t,r,1];r?ld.transformMat4(i,i,n):ub(i,i,n);const a=i[3];return i[0]/=a,i[1]/=a,i[2]/=a,i}function Qv(e,t){return Math.min(.5+e/t*.5,1.5)}function eb(e,t){const r=e[0]/e[3],n=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&n>=-t[1]&&n<=t[1]}function tb(e,t,r,n,i,a,o,s,l,u){const c=r.transform,d=n?e.textSizeData:e.iconSizeData,h=ig(d,r.transform.zoom),f="globe"===c.projection.name,p=[256/r.width*2+1,256/r.height*2+1],m=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let g=null;f&&(g=n?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const _=e.lineVertexArray,v=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,b=r.transform.width/r.transform.height;let x,T=!1;for(let n=0;n<v.length;n++){const f=v.get(n),{numGlyphs:w,writingMode:E}=f;if(E!==vg.vertical||T||x===vg.horizontal||(T=!0),x=E,(f.hidden||E===vg.vertical)&&!T){lb(w,m);continue}T=!1;const A=new y(f.tileAnchorX,f.tileAnchorY);let{x:S,y:P,z:M}=c.projection.projectTilePoint(A.x,A.y,u.canonical);if(l){const[e,t,r]=l(A);S+=e,P+=t,M+=r}const R=[S,P,M,1];if(ld.transformMat4(R,R,t),!eb(R,p)){lb(w,m);continue}const C=R[3],O=Qv(r.transform.getCameraToCenterDistance(c.projection),C),L=ng(d,h,f),I=o?L/O:L*O,D=Jv(S,P,M,i);if(D[3]<=0){lb(w,m);continue}let k={};const B=o?null:l,F=ib(f,I,!1,s,t,i,a,e.glyphOffsetArray,_,m,g,D,A,k,b,B,c.projection,u,o);T=F.useVertical,B&&F.needsFlipping&&(k={}),(F.notEnoughRoom||T||F.needsFlipping&&ib(f,I,!0,s,t,i,a,e.glyphOffsetArray,_,m,g,D,A,k,b,B,c.projection,u,o).notEnoughRoom)&&lb(w,m)}n?(e.text.dynamicLayoutVertexBuffer.updateData(m),g&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(g)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),g&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(g))}function rb(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,v=_+s.numGlyphs,b=g+s.lineLength,x=t.getoffsetX(_),T=t.getoffsetX(v-1),w=sb(e*x,r,n,i,a,o,y,g,b,l,u,c,d,h,!0,f,p,m);if(!w)return null;const E=sb(e*T,r,n,i,a,o,y,g,b,l,u,c,d,h,!0,f,p,m);return E?{first:w,last:E}:null}function nb(e,t,r,n){return e===vg.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:e===vg.vertical?n>0?{needsFlipping:!0}:null:t!==Wv.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Xv}(r,n)?t===Wv.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function ib(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,v){const b=t/24,x=e.lineOffsetX*b,T=e.lineOffsetY*b,{lineStartIndex:w,glyphStartIndex:E,numGlyphs:A,segment:S,writingMode:P,flipState:M}=e,R=w+e.lineLength,C=e=>{if(c){const[t,r,n]=e.up,i=u.length;ey(c,i+0,t,r,n),ey(c,i+1,t,r,n),ey(c,i+2,t,r,n),ey(c,i+3,t,r,n)}const[t,r,n]=e.point;ty(u,t,r,n,e.angle)};if(A>1){const t=rb(b,s,x,T,r,d,h,e,l,a,f,m,!1,g,_,v);if(!t)return{notEnoughRoom:!0};if(n&&!r){let[r,n,i]=t.first.point,[a,s,l]=t.last.point;[r,n]=Jv(r,n,i,o),[a,s]=Jv(a,s,l,o);const u=nb(P,M,(a-r)*p,s-n);if(e.flipState=u&&u.needsFlipping?Wv.flipRequired:Wv.flipNotRequired,u)return u}C(t.first);for(let e=E+1;e<E+A-1;e++){const t=sb(b*s.getoffsetX(e),x,T,r,d,h,S,w,R,l,a,f,m,!1,!1,g,_,v);if(!t)return u.length-=4*(e-E),{notEnoughRoom:!0};C(t)}C(t.last)}else{if(n&&!r){const t=Jv(h.x,h.y,0,i),r=w+S+1,n=new y(l.getx(r),l.gety(r)),a=Jv(n.x,n.y,0,i),o=a[3]>0?a:ob(h,n,t,1,i,void 0,g,_.canonical),s=nb(P,M,(o[0]-t[0])*p,o[1]-t[1]);if(e.flipState=s&&s.needsFlipping?Wv.flipRequired:Wv.flipNotRequired,s)return s}const t=sb(b*s.getoffsetX(E),x,T,r,d,h,S,w,R,l,a,f,m,!1,!1,g,_,v);if(!t)return{notEnoughRoom:!0};C(t)}return{}}function ab(e,t,r,n,i){const{x:a,y:o,z:s}=n.projectTilePoint(e.x,e.y,t);if(!i)return Jv(a,o,s,r);const[l,u,c]=i(e);return Jv(a+l,o+u,s+c,r)}function ob(e,t,r,n,i,a,o,s){const l=ab(e.sub(t)._unit()._add(e),s,i,o,a);return Td.sub(l,r,l),Td.normalize(l,l),Td.scaleAndAdd(l,r,l,n)}function sb(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_){const v=n?e-t:e+t;let b=v>0?1:-1,x=0;n&&(b*=-1,x=Math.PI),b<0&&(x+=Math.PI);let T=s+o+(b>0?0:1)|0,w=i,E=i,A=0,S=0;const P=Math.abs(v),M=[],R=[];let C=a,O=C;const L=()=>ob(O,C,E,P-A+1,c,h,m,g.canonical);for(;A+S<=P;){if(T+=b,T<s||T>=l)return null;if(E=w,O=C,M.push(E),f&&R.push(O),C=new y(u.getx(T),u.gety(T)),w=d[T],!w){const e=ab(C,g.canonical,c,m,h);w=e[3]>0?d[T]=e:L()}A+=S,S=Td.distance(E,w)}p&&h&&(d[T]&&(w=L(),S=Td.distance(E,w)),d[T]=w);const I=(P-A)/S,D=C.sub(O)._mult(I)._add(O),k=Td.sub([],w,E),B=Td.scaleAndAdd([],E,k,I);let F=[0,0,1],N=k[0],q=k[1];if(_&&(F=m.upVector(g.canonical,D.x,D.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],t=Td.cross([],F,e);Td.normalize(e,e),Td.normalize(t,t),N=Td.dot(k,e),q=Td.dot(k,t)}if(r){const e=Td.cross([],F,k);Td.normalize(e,e),Td.scaleAndAdd(B,B,e,r*b)}const U=x+Math.atan2(q,N);return M.push(B),f&&R.push(D),{point:B,angle:U,path:M,tilePath:R,up:F}}function lb(e,t){const r=t.length,n=r+4*e;t.resize(n),t.float32.fill(-1/0,4*r,4*n)}function ub(e,t,r){const n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e[3]=r[3]*n+r[7]*i+r[15],e}const cb=(e,t,r)=>(1-r)*e+r*t,db=e=>e*e*e*e*e;class hb{constructor(e,t,r,n,i,a,o){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(a),this.setMaxBounds(o),this.width=0,this.height=0,this._center=new Bh(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dv,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new qv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new hb(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return B(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const t=this.projection?this.getProjection():void 0;this.projection=V_(this.projectionOptions);const r=!v(t,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=V_({name:"mercator"});const t=e!==this.projection.name;return t&&this._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Gh(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y(this.width,this.height)}get bearing(){return L(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const t=-e*Math.PI/180;this.angle!==t&&(this._unmodified=!1,this.angle=t,this._calcMatrices(),this.rotationMatrix=dd.create(),dd.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const t=C(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=T(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,t=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,i=0;for(let a=0;a<t.length;a++){const o=new y(t[a][0]*this.width,r+t[a][1]*(this.height-r)),s=e.pointCoordinate(o);if(!s)continue;const l=1/Math.hypot(s[0]-this._camera.position[0],s[1]-this._camera.position[1]);n+=s[3]*l,i+=l}return 0===i?NaN:n/i}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),i=this._mercatorZfromZoom(this._maxZoom),a=Math.max(n-r,i);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z];const n=Td.length(Td.sub([],this._camera.position,r));return C(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let t=!1;if(e.orientation&&!yd.exactEquals(e.orientation,this._camera.orientation)&&(t=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];Td.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),t=!0)}t&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,t=new Nv;return t.position=new Kh(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!yd.length(e))return!1;yd.normalize(e,e);const t=Td.transformQuat([],[0,0,-1],e),r=Td.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const n=Fv(t,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const t=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=C(e[2],n/r,n/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const t=[new Id(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new y(0,0)),n=this.pointCoordinate(new y(this.width,0)),i=this.pointCoordinate(new y(this.width,this.height)),a=this.pointCoordinate(new y(0,this.height)),o=Math.floor(Math.min(r.x,n.x,i.x,a.x)),s=Math.floor(Math.max(r.x,n.x,i.x,a.x)),l=1;for(let r=o-l;r<=s+l;r++)0!==r&&t.push(new Id(r,e))}return t}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,t,r){let n=[];if(0===t[0]&&0===t[1])return n;for(const r of e){const e=r.canonical,i=r.overscaledZ,a=r.wrap,o=1<<e.z,s=e.x+1<o,l=e.x>0,u=e.y+1<o,c=e.y>0,d=r.wrap-(l?0:1),h=r.wrap+(s?0:1),f=l?e.x-1:o-1,p=s?e.x+1:0;t[0]<0?(n.push(new Dd(i,h,e.z,p,e.y)),t[1]<0&&u&&(n.push(new Dd(i,a,e.z,e.x,e.y+1)),n.push(new Dd(i,h,e.z,p,e.y+1))),t[1]>0&&c&&(n.push(new Dd(i,a,e.z,e.x,e.y-1)),n.push(new Dd(i,h,e.z,p,e.y-1)))):t[0]>0?(n.push(new Dd(i,d,e.z,f,e.y)),t[1]<0&&u&&(n.push(new Dd(i,a,e.z,e.x,e.y+1)),n.push(new Dd(i,d,e.z,f,e.y+1))),t[1]>0&&c&&(n.push(new Dd(i,a,e.z,e.x,e.y-1)),n.push(new Dd(i,d,e.z,f,e.y-1)))):t[1]<0&&u?n.push(new Dd(i,a,e.z,e.x,e.y+1)):c&&n.push(new Dd(i,a,e.z,e.x,e.y-1))}if(n.length>1){n.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<n.length;)n[t].equals(n[e])?++t:n[++e]=n[t++];n.length=e+1}const i=[];for(const e of n)n.some((t=>e.isChildOf(t)))||i.push(e);return n=i.filter((t=>!e.some((e=>!!(t.overscaledZ<r&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),n}coveringTiles(e){let t=this.coveringZoomLevel(e);const r=t,n=this.elevation&&this.elevation.exaggeration(),i=n&&!e.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==e.minzoom&&t<e.minzoom)return[];void 0!==e.maxzoom&&t>e.maxzoom&&(t=e.maxzoom);const o=this.locationCoordinate(this.center),s=this.center.lat,l=1<<t,u=[l*o.x,l*o.y,0],c="globe"===this.projection.name,d=!c,h=zd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,d),f=c?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),p=l*Gh(1,this.center.lat),m=this._camera.position[2]/Gh(1,this.center.lat),g=[l*f.x,l*f.y,m*(d?1:p)],_=c||n,y=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),v=this.isLODDisabled(!0)?t:0,b=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=e.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,T=this.projection.isReprojectedInTileSpace?jv(this):1,w=e=>{const t=1/4e4,r=new Kh(e.x+t,e.y,e.z),n=new Kh(e.x,e.y+t,e.z),i=e.toLngLat(),a=r.toLngLat(),o=n.toLngLat(),s=this.locationCoordinate(i),l=this.locationCoordinate(a),u=this.locationCoordinate(o),c=Math.hypot(l.x-s.x,l.y-s.y),d=Math.hypot(u.x-s.x,u.y-s.y);return Math.sqrt(c*d)*T/t},A=e=>{const t=b,r=x;return{aabb:x_(this,l,0,0,0,e,r,t,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:t,wrap:e,fullyVisible:!1}},S=[];let P=[];const M=t,R=e.reparseOverscaled?r:t,C=e=>e*e,O=C((m-this._centerAltitude)*p),L=e=>{if(!this._elevation||!e.tileID||!a)return;const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=I(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},I=e=>{if(e.zoom<v)return!0;if(e.zoom===M)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(g),n=e.aabb.distanceY(g);let a=O,o=1;if(c){a=C(e.aabb.distanceZ(g));const t=Math.pow(2,e.zoom),r=Vh((e.y+1)/t),n=Vh(e.y/t),i=Math.min(Math.max(s,r),n),l=qh(i)/qh(s);if(o=i===s?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,l/this._mercatorScaleRatio),this.zoom<=$d&&e.zoom===M-1&&l>=.9)return!0}else if(i&&(a=C(e.aabb.distanceZ(g)*p)),this.projection.isReprojectedInTileSpace&&r<=5){const t=Math.pow(2,e.zoom),r=w(new Kh((e.x+.5)/t,(e.y+.5)/t));o=r>.85?1:r}const l=t*t+n*n+a,u=C((1<<M-e.zoom)*y*o*((e,t)=>{if(t*C(.707)<e)return 1;const r=Math.sqrt(t/e);return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(a,O),l));return l<u};if(this.renderWorldCopies)for(let e=1;e<=3;e++)S.push(A(-e)),S.push(A(e));for(S.push(A(0));S.length>0;){const r=S.pop(),n=r.x,o=r.y;let s=r.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!s){let e=_?r.aabb.intersects(h):r.aabb.intersectsFlat(h);if(0===e&&d()){const t=new Ld(r.zoom,n,o);e=lh(this,l,t,!0).intersects(h)}if(0===e)continue;s=2===e}if(r.zoom!==M&&I(r))for(let e=0;e<4;e++){const t=(n<<1)+e%2,u=(o<<1)+(e>>1),d={aabb:a?r.aabb.quadrant(e):x_(this,l,r.zoom+1,t,u,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:t,y:u,wrap:r.wrap,fullyVisible:s,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};i&&!c&&(d.tileID=new Dd(r.zoom+1===M?R:r.zoom+1,r.wrap,r.zoom+1,t,u),L(d)),S.push(d)}else{const i=r.zoom===M?R:r.zoom;if(e.minzoom&&e.minzoom>i)continue;if(!s){let e=_?r.aabb.intersectsPrecise(h):r.aabb.intersectsPreciseFlat(h);if(0===e&&d()){const t=new Ld(r.zoom,n,o);e=lh(this,l,t,!0).intersectsPrecise(h)}if(0===e)continue}const a=u[0]-(.5+n+(r.wrap<<r.zoom))*(1<<t-r.zoom),c=u[1]-.5-o,f=r.tileID?r.tileID:new Dd(i,r.wrap,r.zoom,n,o);P.push({tileID:f,distanceSq:a*a+c*c})}}if(this.fogCullDistSq){const t=this.fogCullDistSq,r=this.horizonLineFromTop();P=P.filter((n=>{const i=[0,0,0,1],a=[nn,nn,0,1],o=this.calculateFogTileMatrix(n.tileID.toUnwrapped());ld.transformMat4(i,i,o),ld.transformMat4(a,a,o);const s=function(e,t,r){let n=0;for(let r=0;r<2;++r){const i=0;e[r]>i&&(n+=(e[r]-i)*(e[r]-i)),t[r]<i&&(n+=(i-t[r])*(i-t[r]))}return n}(ld.min([],i,a),ld.max([],i,a));if(0===s)return!0;let l=!1;const u=this._elevation;if(u&&s>t&&0!==r){const t=this.calculateProjMatrix(n.tileID.toUnwrapped());let i;e.isTerrainDEM||(i=u.getMinMaxForTile(n.tileID)),i||(i={min:x,max:b});const a=function(e){const t=Math.round((e+45+360)%360/90)%4;return E[t]}(this.rotation),o=[a[0]*nn,a[1]*nn,i.max];Td.transformMat4(o,o,t),l=(1-o[1])*this.height*.5<r}return s<t||l}))}return P.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const t=C(e.lat,-Hh,Hh),r=this.projection.project(e.lng,t);return new y(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Gh(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let r,n;const i=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(t.x-i.x)/e,n=(t.y-i.y)/e}else{const e=this.pointCoordinate(t),a=this.pointCoordinate(i);r=e.x-a.x,n=e.y-a.y}const a=this.locationCoordinate(e);this.setLocation(new Kh(a.x-r,a.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){const r=t?Gh(t,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new Kh(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){const r=null!=t?t:this._centerAltitude,n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];ld.transformMat4(n,n,this.pixelMatrixInverse),ld.transformMat4(i,i,this.pixelMatrixInverse);const a=i[3];ld.scale(n,n,1/n[3]),ld.scale(i,i,1/a);const o=n[2],s=i[2];return{p0:n,p1:i,t:o===s?0:(r-o)/(s-o)}}screenPointToMercatorRay(e){const t=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return ld.transformMat4(t,t,this.pixelMatrixInverse),ld.transformMat4(r,r,this.pixelMatrixInverse),ld.scale(t,t,1/t[3]),ld.scale(r,r,1/r[3]),t[2]=Gh(t[2],this._center.lat)*this.worldSize,r[2]=Gh(r[2],this._center.lat)*this.worldSize,ld.scale(t,t,1/this.worldSize),ld.scale(r,r,1/this.worldSize),new Fd([t[0],t[1],t[2]],Td.normalize([],Td.sub([],r,t)))}rayIntersectionCoordinate(e){const{p0:t,p1:r,t:n}=e,i=Gh(t[2],this._center.lat),a=Gh(r[2],this._center.lat);return new Kh(Hn(t[0],r[0],n)/this.worldSize,Hn(t[1],r[1],n)/this.worldSize,Hn(i,a,n))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let t=this.projection.pointCoordinate3D(this,e.x,e.y);if(t)return new Kh(t[0],t[1],t[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const i=.02*n,a=e.clone();for(let e=0;e<10&&n-r>i;e++){a.y=Hn(r,n,.66);const e=this.projection.pointCoordinate3D(this,a.x,a.y);e?(n=a.y,t=e):r=a.y}return t?new Kh(t[0],t[1],t[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Hd)return!this.isPointAboveHorizon(e);const t=this.pointCoordinate(e);return t.y>=0&&t.y<=1}_coordinatePoint(e,t){const r=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return ld.transformMat4(n,n,this.pixelMatrix),n[3]>0?new y(n[0]/n[3],n[1]/n[3]):new y(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,i=this.pointLocation3D(new y(t,e)),a=this.pointLocation3D(new y(n,e)),o=this.pointLocation3D(new y(n,r)),s=this.pointLocation3D(new y(t,r));let l=Math.min(i.lng,a.lng,o.lng,s.lng),u=Math.max(i.lng,a.lng,o.lng,s.lng),c=Math.min(i.lat,a.lat,o.lat,s.lat),d=Math.max(i.lat,a.lat,o.lat,s.lat);const h=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,p=(e,t,r,n,i)=>{const a=(e+r)/2,o=(t+n)/2,s=new y(a,o),{lng:m,lat:g}=this.pointLocation3D(s),_=Math.max(0,l-m,c-g,m-u,g-d);l=Math.min(l,m),u=Math.max(u,m),c=Math.min(c,g),d=Math.max(d,g),(i<f||_>h)&&(p(e,t,a,o,i+1),p(a,o,r,n,i+1))};if(p(t,e,n,e,1),p(n,e,n,r,1),p(n,r,t,r,1),p(t,r,t,e,1),"globe"===this.projection.name){const[e,t]=function(e){const t=gd.identity(new Float64Array(16));gd.multiply(t,e.pixelMatrix,e.globeMatrix);const r=[0,Kd,0],n=[0,Jd,0];return Td.transformMat4(r,r,t),Td.transformMat4(n,n,t),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!Mh(e,new Bh(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Mh(e,new Bh(e.center.lat,-90))]}(this);e?(d=90,u=180,l=-180):t&&(c=-90,u=180,l=-180)}return new Zl(new Bh(l,c),new Bh(u,d))}_getBoundsRectangular(e,t){const{top:r,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,o=new y(n,r),s=new y(a,r),l=new y(a,i),u=new y(n,i);let c=this.pointCoordinate(o,e),d=this.pointCoordinate(s,e);const h=this.pointCoordinate(l,t),f=this.pointCoordinate(u,t),p=(e,t)=>(t.y-e.y)/(t.x-e.x);return c.y>1&&d.y>=0?c=new Kh((1-f.y)/p(f,c)+f.x,1):c.y<0&&d.y<=1&&(c=new Kh(-f.y/p(f,c)+f.x,0)),d.y>1&&c.y>=0?d=new Kh((1-h.y)/p(h,d)+h.x,1):d.y<0&&c.y<=1&&(d=new Kh(-h.y/p(h,d)+h.x,0)),(new Zl).extend(this.coordinateLocation(c)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(h))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const r=t.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Hh,this.maxLat=Hh,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Uh(this.minLng)*this.tileSize,this.worldMaxX=Uh(this.maxLng)*this.tileSize,this.worldMinY=jh(this.maxLat)*this.tileSize,this.worldMaxY=jh(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){const t=e.key,r=this._distanceTileDataCache;if(r[t])return r[t];const n=e.canonical,i=1/this.height,a=this.cameraWorldSize,o=a/this.zoomScale(n.z),s=(n.x+Math.pow(2,n.z)*e.wrap)*o,l=n.y*o,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const c=this.angle,d=Math.sin(-c),h=-Math.cos(-c);return r[t]={bearing:[d,h],center:[(u.x-s)*i,(u.y-l)*i],scale:o/nn*i},r[t]}calculateFogTileMatrix(e){const t=e.key,r=this._fogTileMatrixCache;if(r[t])return r[t];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return gd.multiply(n,this.worldToFogMatrix,n),r[t]=new Float32Array(n),r[t]}calculateProjMatrix(e,t=!1){const r=e.key,n=t?this._alignedProjMatrixCache:this._projMatrixCache;if(n[r])return n[r];const i=this.calculatePosMatrix(e,this.worldSize);return gd.multiply(i,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:t?this.alignedProjMatrix:this.projMatrix,i),n[r]=new Float32Array(i),n[r]}calculatePixelsToTileUnitsMatrix(e){const t=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[t])return r[t];const n=function(e,t){const{scale:r}=e.tileTransform,n=r*nn/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return dd.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[n,n])}(e,this);return r[t]=n,r[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,t=gd.fromScaling([],[e,e,e]);return gd.multiply(t,t,this.globeMatrix),t}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const t=Gh(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(t),n=this._camera.forward(),i=Gh(1,this._center.lat);r[2]/=i,n[2]/=i,Td.normalize(n,n);const a=e.raycast(r,n,e.exaggeration());if(a){const e=Td.scaleAndAdd([],r,n,a),t=new Kh(e[0],e[1],Gh(e[2],Vh(e[1]))),o=(t.z+Td.length([t.x-r[0],t.y-r[1],t.z-r[2]*i]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(o),this._centerAltitude=t.toAltitude(),this._center=this.coordinateLocation(t),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const t=this._elevation,r=Gh(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=t.getAtPointOrZero(new Kh(...n)),a=this.pixelsPerMeter/this.worldSize*i,o=this._minimumHeightOverTerrain(),s=n[2]-a;if(s<=o)if(s<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[n[0],n[1],e.z-n[2]],r=Td.length(t);t[2]-=(o-s)/this._pixelsPerMercatorPixel;const i=Td.length(t);if(0===i)return;Td.scale(t,t,r/i*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const t=this.center;return t.lat=C(t.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(t.lng=C(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:r,y:n}=this.point;let i=0,a=r,o=n;const s=this.width/2,l=this.height/2,u=this.worldMinY*this.scale,c=this.worldMaxY*this.scale;if(n-l<u&&(o=u+l),n+l>c&&(o=c-l),c-u<this.height&&(i=Math.max(i,this.height/(c-u)),o=(c+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;a=(r+n+this.worldSize)%this.worldSize-n,a-s<e&&(a=e+s),a+s>t&&(a=t-s),t-e<this.width&&(i=Math.max(i,this.width/(t-e)),a=(t+e)/2)}a===r&&o===n||(this.center=this.unproject(new y(a,o))),i&&(this.zoom+=this.scaleZoom(i)),this._constrainCamera(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,t="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Gh(1,this.center.lat)/Gh(1,45));const n=Gv(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const i="meters"===this.projection.zAxisUnit?r:1,a=this._camera.getWorldToCamera(this.worldSize,i);let o;const s=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(s[8]=2*-e.x/this.width,s[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=t*this.aspect,n=-r,i=-t;r-=e.x,n-=e.x,t+=e.y,i+=e.y,o=this._camera.getCameraToClipOrthographic(n,r,i,t,this._nearZ,this._farZ),((e,t,r,n)=>{for(let i=0;i<16;i++)e[i]=cb(t[i],r[i],n)})(o,o,s,db(this.pitch>=15?1:this.pitch/15))}else o=s;const l=gd.mul([],s,a);let u=gd.mul([],o,a);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),t=gd.identity([]);gd.translate(t,t,[e.x*this.worldSize,e.y*this.worldSize,0]),gd.multiply(t,t,Uv(this)),gd.translate(t,t,[-e.x*this.worldSize,-e.y*this.worldSize,0]),gd.multiply(u,u,t),gd.multiply(l,l,t),this.inverseAdjustmentMatrix=function(e){const t=Uv(e,!0);return dd.invert([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=gd.scale([],u,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=u,this.invProjMatrix=gd.invert(new Float64Array(16),this.projMatrix);const c=gd.invert([],o);this.frustumCorners=Nd.fromInvProjectionMatrix(c,this.horizonLineFromTop(),this.height),this.cameraFrustum=zd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!t);const d=new Float32Array(16);gd.identity(d),gd.scale(d,d,[1,-1,1]),gd.rotateX(d,d,this._pitch),gd.rotateZ(d,d,this.angle);const h=gd.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=gd.clone(h);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;h[8]=2*-e.x/this.width,h[9]=2*(e.y+f)/this.height,this.skyboxMatrix=gd.multiply(d,h,d);const p=this.point,m=p.x,g=p.y,_=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),b=Math.sin(this.angle),x=m-Math.round(m)+v*_+b*y,T=g-Math.round(g)+v*y+b*_,w=new Float64Array(u);if(gd.translate(w,w,[x>.5?x-1:x,T>.5?T-1:T,0]),this.alignedProjMatrix=w,u=gd.create(),gd.scale(u,u,[this.width/2,-this.height/2,1]),gd.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=gd.create(),gd.scale(u,u,[1,-1,1]),gd.translate(u,u,[-1,-1,0]),gd.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=gd.multiply(new Float64Array(16),this.labelPlaneMatrix,l),this._calcFogMatrices(),this._distanceTileDataCache={},u=gd.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(e){const{x:t,y:r}=e.point,{lng:n,lat:i}=e._center;return bh(t,r,e.worldSize,n,i)}(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Td.transformMat4(e,e,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,i=[e,e,t];Td.scale(i,i,n),Td.scale(r,r,-1),Td.multiply(r,r,i);const a=gd.create();gd.translate(a,a,r),gd.scale(a,a,i),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*i,n.y/this.worldSize-r[1]*i,e/this.worldSize*this._centerAltitude-r[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let i=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(i=Math.min((t-r)/n,1)),this._camera.position=Td.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,t=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),i=Gh(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(T(this._maxPitch)),o=Math.max((e[2]-i)/Math.cos(r),a),s=this._zoomFromMercatorZ(o);Td.scaleAndAdd(e,e,t,o),this._pitch=C(r,T(this.minPitch),T(this.maxPitch)),this.angle=L(n,-Math.PI,Math.PI),this._setZoom(C(s,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Kh(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,r=Hd,n=0,i=1/0;for(;r-t>1e-6&&r>t;){const a=t+.5*(r-t),o=this.tileSize*Math.pow(2,a),s=this.getCameraToCenterDistance(this.projection,a,o),l=this.scaleZoom(s/(e*this.tileSize)),u=Math.abs(a-l);u<i&&(i=u,n=a),a<l?t=a:r=a}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){const r=Math.min(e.x,t.x),n=Math.max(e.x,t.x),i=Math.min(e.y,t.y),a=Math.max(e.y,t.y);if(i<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const o=[new y(r,i),new y(n,a),new y(r,a),new y(n,i)],s=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const e of o){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const r=this.rayIntersectionCoordinate(t);if(r.x<s||r.y<0||r.x>l||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+w(this.fovAboveCenter)>88||this.anyCornerOffEdge(new y(0,0),new y(this.width,this.height))}zoomDeltaToMovement(e,t){const r=Td.length(Td.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(r)+t;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,t,r],n){const i=[e,t,r,1];ld.transformMat4(i,i,n);const a=i[3]=Math.max(i[3],1e-6);return i[0]/=a,i[1]/=a,i[2]/=a,i}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new y(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y(0,e))}}getCameraToCenterDistance(e,t=this.zoom,r=this.worldSize){const n=Gv(e,t,this.width,this.height,1024),i=e.pixelSpaceConversion(this.center.lat,r,n);let a=.5/Math.tan(.5*this._fov)*this.height*i;return this.isOrthographic&&(a=cb(1,a,db(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&gd.multiply(e,e,this.globeMatrix),e}getFrustum(e){return zd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function fb(e,t,r){gd.identity(e),gd.rotateZ(e,e,T(t[2])),gd.rotateX(e,e,T(t[0])),gd.rotateY(e,e,T(t[1])),gd.scale(e,e,r),gd.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function pb(e,t,r,n,i,a,o,s){const l=[r[0]-t[0],r[1]-t[1],0],u=[n[0]-t[0],n[1]-t[1],0];if(Td.length(l)<1e-12||Td.length(u)<1e-12)return yd.identity(e);const c=Td.cross([],l,u);Td.normalize(c,c),Td.subtract(u,n,t),l[2]=(a-i)*s,u[2]=(o-i)*s;const d=l;return Td.cross(d,l,u),Td.normalize(d,d),yd.rotationTo(e,c,d)}function mb(e,t,r=!1){const n=xh(t.zoom),i=function(e,t,r){const n=t.worldSize,i=[e[12],e[13],e[14]],a=Vh(i[1]/n),o=zh(i[0]/n),s=gd.identity([]),l=Gh(1,a)*n,u=Gh(1,0)*n*Xh(a,t.zoom),c=1/yh(n);let d=u*c;if(r){const e=Gv(t.projection,t.zoom,t.width,t.height,1024);d=c*t.projection.pixelSpaceConversion(t.center.lat,n,e)}const h=hh(a,o);Td.add(h,h,Td.scale([],Td.normalize([],h),l*d*i[2]));const f=function(e){const t=[e[0],e[1],e[2]];let r=[0,1,0];const n=Td.cross([],r,t);return Td.cross(r,t,n),0===Td.squaredLength(r)&&(r=[0,1,0],Td.cross(n,t,r)),Td.normalize(n,n),Td.normalize(r,r),Td.normalize(t,t),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(h);gd.scale(s,s,[d,d,d*l]),gd.translate(s,s,[-i[0],-i[1],-i[2]]);const p=gd.multiply([],t.globeMatrix,f);return gd.multiply(p,p,s),gd.multiply(p,p,e),p}(e,t,r);if(n>0){const r=function(e,t){const r=t.worldSize,n=Gh(1,0)*r*Xh(t.center.lat,t.zoom)/yh(r),i=Gh(1,t.center.lat)*r,a=gd.identity([]);return gd.rotateY(a,a,T(t.center.lng)),gd.rotateX(a,a,T(t.center.lat)),gd.translate(a,a,[0,0,Wd]),gd.scale(a,a,[n,n,n*i]),gd.translate(a,a,[t.point.x-.5*r,t.point.y-.5*r,0]),gd.multiply(a,a,e),gd.multiply(a,t.globeMatrix,a)}(e,t);return function(e,t,r){const n=(e,t,r)=>{const n=Td.length(e),i=Td.length(t),a=ah(e,t,r);return Td.scale(a,a,1/Td.length(a)*Hn(n,i,r))},i=n([e[0],e[1],e[2]],[t[0],t[1],t[2]],r),a=n([e[4],e[5],e[6]],[t[4],t[5],t[6]],r),o=n([e[8],e[9],e[10]],[t[8],t[9],t[10]],r),s=ah([e[12],e[13],e[14]],[t[12],t[13],t[14]],r);return[i[0],i[1],i[2],0,a[0],a[1],a[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],1]}(i,r,n)}return i}const gb=64,_b=[1,1,1];class yb{constructor(e,t,r,n){this.id=e,this.position=null!=t?new Bh(t[0],t[1]):new Bh(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Vd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(gd.multiply(e.matrix,t,e.matrix),e.meshes)for(const t of e.meshes){const r=Vd.applyTransform(t.aabb,e.matrix);this.aabb.encapsulate(r)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=gd.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}_positionModelOnTerrain(e,t){const r=e.elevation;if(!r)return 0;const n=Vd.projectAabbCorners(this.aabb,this.matrix),i=Gh(1,this.position.lat)*e.worldSize,a=function(e,t){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of n){const n=e[i.corners[0]],a=e[i.corners[1]],o=e[i.corners[2]],s=[a[0]-n[0],a[1]-n[1],t*(a[2]-n[2])],l=Td.cross(s,s,[o[0]-n[0],o[1]-n[1],t*(o[2]-n[2])]);Td.normalize(l,l),i.dotProductWithUp=Td.dot(l,r)}return n.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),n[0].corners}(n,i),o=n[a[0]],s=n[a[1]],l=n[a[2]],u=n[a[3]],c=r.getAtPointOrZero(new Kh(o[0]/e.worldSize,o[1]/e.worldSize),0),d=r.getAtPointOrZero(new Kh(s[0]/e.worldSize,s[1]/e.worldSize),0),h=r.getAtPointOrZero(new Kh(l[0]/e.worldSize,l[1]/e.worldSize),0),f=r.getAtPointOrZero(new Kh(u[0]/e.worldSize,u[1]/e.worldSize),0),p=(c+f)/2,m=(d+h)/2;return p>m?d<h?pb(t,s,u,o,d,f,c,i):pb(t,l,o,u,h,c,f,i):c<f?pb(t,o,s,l,c,d,h,i):pb(t,u,l,s,f,h,d,i),Math.max(p,m)}computeModelMatrix(e,t,r,n,i,a,o=!1){const s=e.transform,l=s.zoom,u=s.project(this.position),c=Xh(this.position.lat,l),d=1/c;gd.identity(this.matrix),gd.translate(this.matrix,this.matrix,[u.x+n[0]*d,u.y+n[1]*d,n[2]]);let h=1,f=1;const p=s.worldSize;if(o){if("mercator"===s.projection.name){let e=0;s.elevation&&(e=s.elevation.getAtPointOrZero(new Kh(u.x/p,u.y/p),0));const t=ld.transformMat4([],[u.x,u.y,e,1],s.projMatrix)[3]/s.cameraToCenterDistance;h=t,f=t*Xh(s.center.lat,l)}else if("globe"===s.projection.name){const e=mb(this.matrix,s),t=gd.multiply([],s.projMatrix,e),r=[0,0,0,1];ld.transformMat4(r,r,t);const n=r[3]/s.cameraToCenterDistance,i=xh(l),a=s.projection.pixelsPerMeter(this.position.lat,p)*Xh(this.position.lat,l),o=s.projection.pixelsPerMeter(s.center.lat,p)*Xh(s.center.lat,l);h=n/Hn(a,Wh(s.center.lat),i),f=n*c/a,h*=o,f*=o}}else h=d;gd.scale(this.matrix,this.matrix,[h,h,f]);const m=[...this.matrix],g=this.orientation,_=[];if(fb(_,[g[0]+t[0],g[1]+t[1],g[2]+t[2]],r),gd.multiply(this.matrix,m,_),i&&s.elevation){let e=0;const t=[];if(a&&s.elevation){e=this._positionModelOnTerrain(s,t);const r=gd.fromQuat([],t),n=gd.multiply([],r,_);gd.multiply(this.matrix,m,n)}else e=s.elevation.getAtPointOrZero(new Kh(u.x/p,u.y/p),0);0!==e&&(this.matrix[14]+=e)}}upload(e){if(!this.uploaded){for(const t of this.nodes)xb(t,e);for(const e of this.nodes)Tb(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)wb(e)}}function vb(e,t,r=!1){e.uploaded||(e.gfxTexture=new py(t,e.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function bb(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Pv.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Ov.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Cv.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Mv:Rv).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Iv.members,!0)),e.segments=ul.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const n=e.material;n.pbrMetallicRoughness.baseColorTexture&&vb(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&vb(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&vb(n.normalTexture,t),n.occlusionTexture&&vb(n.occlusionTexture,t,r),n.emissionTexture&&vb(n.emissionTexture,t)}function xb(e,t,r){if(e.meshes)for(const n of e.meshes)bb(n,t,r);if(e.children)for(const n of e.children)xb(n,t,r)}function Tb(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Tb(t)}function wb(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const t of e.children)wb(t)}class Eb{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ab{constructor(){this.instancedDataArray=new Ws,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Sb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,r,n){this.tileToMeter=Zh(r);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=sf(a,i);if(!this.layers[0]._featureFilter.filter(new Ko(this.zoom),e,r))continue;const u={id:o,sourceLayerIndex:l,index:s,geometry:i?e.geometry:of(a,r,n),properties:a.properties,type:a.type,patterns:{}},c=this.addFeature(u,u.geometry,e);c&&t.featureIndex.insert(a,u.geometry,s,l,this.index,this.instancesPerModel[c].instancedDataArray.length)}this.lookup=null}update(e,t,r,n){for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];for(const t in e)r.idToFeaturesIndex.hasOwnProperty(t)&&this.evaluate(r.features[r.idToFeaturesIndex[t]],e[t],r,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];for(const t of r.features){const n=this.layers[0],i=t.feature,a=this.canonical,o=n.paint.get("model-rotation").evaluate(i,{},a),s=n.paint.get("model-scale").evaluate(i,{},a),l=n.paint.get("model-translation").evaluate(i,{},a);Td.exactEquals(t.rotation,o)&&Td.exactEquals(t.scale,s)&&Td.exactEquals(t.translation,l)||(this.evaluate(t,t.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,Lv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,r){const n=this.layers[0],i=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!i)return X(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),i;this.instancesPerModel[i]||(this.instancesPerModel[i]=new Ab);const a=this.instancesPerModel[i],o=a.instancedDataArray,s=new Eb(r,o.length);for(const e of t)for(const t of e){if(t.x<0||t.x>=nn||t.y<0||t.y>=nn)continue;const e=(this.lookupDim-1)/nn,r=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}this.instanceCount++;const n=o.length;o.resize(n+1),a.instancesEvaluatedElevation.push(0),o.float32[16*n]=t.x,o.float32[16*n+1]=t.y}return s.instancedDataCount=a.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(s),this.evaluate(s,{},a,!1)),i}evaluate(e,t,r,n){const i=this.layers[0],a=e.feature,o=this.canonical,s=e.rotation=i.paint.get("model-rotation").evaluate(a,t,o),l=e.scale=i.paint.get("model-scale").evaluate(a,t,o),u=e.translation=i.paint.get("model-translation").evaluate(a,t,o),c=i.paint.get("model-color").evaluate(a,t,o);c.a=i.paint.get("model-color-mix-intensity").evaluate(a,t,o);const d=[];this.maxVerticalOffset<u[2]&&(this.maxVerticalOffset=u[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),fb(d,s,l);const h=Math.round(100*c.a)+c.b/1.05;for(let t=0;t<e.instancedDataCount;++t){const i=e.instancedDataOffset+t,a=16*i,s=r.instancedDataArray.float32;let l=0;n&&(l=s[a+6]-r.instancesEvaluatedElevation[i]);const f=0|s[a+1];s[a]=(0|s[a])+c.r/1.05,s[a+1]=f+c.g/1.05,s[a+2]=h,s[a+3]=1/(o.z>10?this.tileToMeter:Zh(o,f)),s[a+4]=u[0],s[a+5]=u[1],s[a+6]=u[2]+l,s[a+7]=d[0],s[a+8]=d[1],s[a+9]=d[2],s[a+10]=d[4],s[a+11]=d[5],s[a+12]=d[6],s[a+13]=d[8],s[a+14]=d[9],s[a+15]=d[10],r.instancesEvaluatedElevation[i]=u[2]}}}Ao(Sb,"ModelBucket",{omit:["layers"]}),Ao(Ab,"PerModelAttributes"),Ao(Eb,"ModelFeature");const Pb=new us({visibility:new os(St.layout_model.visibility),"model-id":new ss(St.layout_model["model-id"])});var Mb={paint:new us({"model-opacity":new os(St.paint_model["model-opacity"]),"model-rotation":new ss(St.paint_model["model-rotation"]),"model-scale":new ss(St.paint_model["model-scale"]),"model-translation":new ss(St.paint_model["model-translation"]),"model-color":new ss(St.paint_model["model-color"]),"model-color-mix-intensity":new ss(St.paint_model["model-color-mix-intensity"]),"model-type":new os(St.paint_model["model-type"]),"model-cast-shadows":new os(St.paint_model["model-cast-shadows"]),"model-receive-shadows":new os(St.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new os(St.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ss(St.paint_model["model-emissive-strength"]),"model-roughness":new ss(St.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ss(St.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new os(St.paint_model["model-cutoff-fade-range"])}),layout:Pb};const Rb=new Float32Array(262144),Cb=new Uint8Array(262144);function Ob(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,Ob(r));return t}const Lb=["","wall","door","roof","window","lamp","logo"];class Ib{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Ob(e)}}}}class Db{constructor(e,t,r,n){this.nodes=e,this.id=t,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const r of t){const t=r.node;this.uploaded?this.updatePbrBuffer(t):xb(t,e,!0)}for(const e of t)Tb(e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),t=!0);return t}needsReEvaluation(e,t,r){const n=e.transform.projectionOptions,i=e.style.getBrightness(),a=this.brightness!==i;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||kb(r.paint.get("model-color").value,a)||kb(r.paint.get("model-color-mix-intensity").value,a)||kb(r.paint.get("model-roughness").value,a)||kb(r.paint.get("model-emissive-strength").value,a)||kb(r.paint.get("model-height-based-emissive-strength-multiplier").value,a))&&(this.projection=n,this.brightness=i,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const e of r){const r=e.feature;e.evaluatedScale=t.paint.get("model-scale").evaluate(r,{},n)}}evaluate(e){const t=this.getNodesInfo();for(const r of t){if(!r.node.meshes)continue;const t=r.feature,n=r.node.meshes&&r.node.meshes[0].featureData,i=r.evaluatedColor[2],a=r.evaluatedRMEA[2],o=this.id.canonical;if(r.hasTranslucentParts=!1,n){for(let n=0;n<Lb.length;n++){const i=Lb[n];i.length&&(t.properties.part=i);const a=e.paint.get("model-color").evaluate(t,{},o),s=e.paint.get("model-color-mix-intensity").evaluate(t,{},o);r.evaluatedColor[n]=[a.r,a.g,a.b,s],r.evaluatedRMEA[n][0]=e.paint.get("model-roughness").evaluate(t,{},o),r.evaluatedRMEA[n][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o),r.evaluatedRMEA[n][3]=a.a,r.emissionHeightBasedParams[n]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},o),!r.hasTranslucentParts&&a.a<1&&(r.hasTranslucentParts=!0)}delete t.properties.part,Fb(r,i!==r.evaluatedColor[2]||a!==r.evaluatedRMEA[2])}r.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},o),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,r,n){const i=e.findDEMTileFor(r);if(i&&(i.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const t=jm.create(e,r,i);if(!t)return;4&this.modelTraits&&this.updateDEM(e,t,r,n);for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const n=r.footprint.vertices;let i=t.getElevationAt(n[0].x,n[0].y,!0,!0);for(let e=1;e<n.length;e++)i=Math.min(i,t.getElevationAt(n[e].x,n[e].y,!0,!0));r.elevation=i}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,r,n){let i=t._dem._modifiedForSources[n];if(void 0===i&&(t._dem._modifiedForSources[n]=[],i=t._dem._modifiedForSources[n]),i.includes(r.canonical))return;const a=t._dem.dim;i.push(r.canonical);let o=!1;for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.grid)continue;const n=r.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),s=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(a-s.y,i.x),Math.min(i.y,a-s.x));if(l<0)continue;const u=C(l,2,5);let c=Math.max(0,i.x-u),d=Math.max(0,i.y-u),h=Math.min(s.x+u,a-1),f=Math.min(s.y+u,a-1);for(let e=d;e<=f;++e)for(let t=c;t<=h;++t)Cb[e*a+t]=255;let p=0,m=0;for(let e=0;e<n.cellsY;++e)for(let r=0;r<n.cellsX;++r){if(!n.cells[e*n.cellsX+r])continue;const i=t.tileCoordToPixel(n.min.x+r/n.xScale,n.min.y+e/n.yScale),o=t.tileCoordToPixel(n.min.x+(r+1)/n.xScale,n.min.y+(e+1)/n.yScale);for(let e=i.y;e<=Math.min(o.y+1,a-1);++e)for(let r=i.x;r<=Math.min(o.x+1,a-1);++r)255===Cb[e*a+r]&&(Cb[e*a+r]=0,p+=t.getElevationAtPixel(r,e),m++)}const g=p/m;c=Math.max(1,i.x-u),d=Math.max(1,i.y-u),h=Math.min(s.x+u,a-2),f=Math.min(s.y+u,a-2),o=!0;for(let e=d;e<=f;++e)for(let r=c;r<=h;++r)0===Cb[e*a+r]&&(Rb[e*a+r]=t._dem.set(r,e,g));for(let e=1;e<u;++e){c=Math.max(1,i.x-e),d=Math.max(1,i.y-e),h=Math.min(s.x+e,a-2),f=Math.min(s.y+e,a-2);for(let r=d;r<=f;++r)for(let n=c;n<=h;++n){const i=r*a+n;if(255===Cb[i]){let o=0,s=0,l=-1,c=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const u=(r+t)*a+n+i;if(Cb[u]>=e)continue;const d=Rb[u],h=Math.abs(d);h>s&&(o=d,s=h,l=i,c=t)}if(s>.1){const a=1-(e+.5*Math.abs(l*c))/u;let s=t._dem.get(n,r)+o*a;const d=t._dem.get(n+l,r+c),h=t._dem.get(n-l,r-c,!0);(s-d)*(s-h)>0&&(s=(d+h)/2),Rb[i]=t._dem.set(n,r,s),Cb[i]=e}}}}}o&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=st.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new Ib(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)wb(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const t of e)Tb(t.node),wb(t.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped()),n=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){const t=n[e].node;n[e].hiddenByReplacement=!!t.footprint&&!r.find((e=>e.footprint===t.footprint))}}getHeightAtTileCoord(e,t){const r=this.getNodesInfo(),n=[];for(let i=0;i<this.nodesInfo.length;i++){const a=r[i],o=a.node.meshes[0];if(e<o.aabb.min[0]||t<o.aabb.min[1]||e>o.aabb.max[0]||t>o.aabb.max[1])continue;const s=(e-o.aabb.min[0])/(o.aabb.max[0]-o.aabb.min[0])*gb|0,l=Math.min(63,(t-o.aabb.min[1])/(o.aabb.max[1]-o.aabb.min[1])*gb|0)*gb+Math.min(63,s);if(!(o.heightmap[l]<0&&a.node.footprint)){if(a.hiddenByReplacement)return;return{height:o.heightmap[l],maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]}}if(a.node.footprint.grid.query(new y(e,t),new y(e,t),n),n.length>0)return{height:void 0,maxHeight:a.feature.properties.height,hidden:a.hiddenByReplacement,verticalScale:a.evaluatedScale[2]}}}}function kb(e,t){return!e.isLightConstant&&t}function Bb(e,t,r,n,i,a,o,s){let l=(61440&t|(61440&t)>>4)>>8,u=(3840&t|(3840&t)>>4)>>4,c=240&t|(240&t)>>4;r[3]>0&&(l=Hn(l,255*r[0],r[3]),u=Hn(u,255*r[1],r[3]),c=Hn(c,255*r[2],r[3]));const d=l<<8|u,h=c<<8|Math.floor(255*n[3]),f=function(e){const t=C(e,0,2);return Math.min(Math.round(.5*t*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],p=C(i[0],0,1),m=C(i[1],0,1),g=C(i[2],0,1),_=C(i[3],0,1);let y,v,b,x;if(p!==m&&o!==a&&m!==p){const e=o-a;v=1/(e*(m-p)),b=-(a+e*p)/(e*(m-p));const t=C(i[4],-1,1);x=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,b=1,x=1;if(e.emplaceBack(d,h,f,y,v,b,x),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(d,h,f,y,v,b,x)}}function Fb(e,t){const r=e.node;let n=0;for(const i of r.meshes){if(r.lights&&r.lightMeshIndex===n)continue;if(!i.featureData)continue;i.featureArray=new Xs,i.featureArray.reserve(i.featureData.length);let a=t;for(const t of i.featureData){let n;const o=65535&t,s=(15&o)<8?15&o:0,l=t>>16&65535,u=e.evaluatedRMEA[s],c=e.evaluatedColor[s],d=e.emissionHeightBasedParams[s];if(a&&2===s&&r.lights&&(n=new Xs,n.resize(10*r.lights.length)),Bb(i.featureArray,l,c,u,d,i.aabb.min[2],i.aabb.max[2],n),n&&a){a=!1;const e=r.meshes[r.lightMeshIndex];e.featureArray=n,e.featureArray._trim()}}i.featureArray._trim(),n++}}Ao(Db,"Tiled3dModelBucket",{omit:["layers"]}),Ao(Ib,"Tiled3dModelFeature");class Nb{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Gb(new y(0,0),new y(nn,nn),e),r=[];for(const n of this._activeRegions){if(n.hiddenByOverlap)continue;if(!jb(t,n))continue;const i=zb(n.min,n.max,e);r.push({min:i.min,max:i.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return r}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const r of e.cache.getVisibleCoordinates()){const n=e.cache.getTile(r).buckets[e.layer];if(n)for(const e of n.getNodesInfo()){const n=e.node;n.footprint&&t.push({footprint:n.footprint,id:r.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Gb(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||qb(e.min,t.min)||qb(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,r=0;for(;!e&&t!==this._activeRegions.length;){const n=this._activeRegions[t],i=this._prevRegions[r];e=n.priority!==i.priority||!Ub(n,i),++t,++r}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const r=t[e].priority;for(;e<t.length&&t[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let t=0,r=e(t);for(;t!==r;){let n=t;const i=t;for(;n!==r;){const e=this._activeRegions[n];e.hiddenByOverlap=!1;for(let t=0;t<i;t++){const r=this._activeRegions[t];if(!r.hiddenByOverlap&&jb(e,r)&&(e.hiddenByOverlap=$b(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++n}t=r,r=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}}function qb(e,t){return e.x-t.x||e.y-t.y}function Ub(e,t){return 0===qb(e.min,t.min)&&0===qb(e.max,t.max)}function jb(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Gb(e,t,r){const n=1/nn,i=1/(1<<r.canonical.z),a=(t.x*n+r.canonical.x)*i+r.wrap,o=(t.y*n+r.canonical.y)*i;return{min:new y((e.x*n+r.canonical.x)*i+r.wrap,(e.y*n+r.canonical.y)*i),max:new y(a,o)}}function zb(e,t,r){const n=1<<r.canonical.z,i=((t.x-r.wrap)*n-r.canonical.x)*nn,a=(t.y*n-r.canonical.y)*nn;return{min:new y(((e.x-r.wrap)*n-r.canonical.x)*nn,(e.y*n-r.canonical.y)*nn),max:new y(i,a)}}function Vb(e,t,r,n,i,a,o){const s=e.indices,l=e.vertices,u=[];for(let c=n;c<n+i;c+=3){const n=t[r[c+0]+a],i=t[r[c+1]+a],d=t[r[c+2]+a],h=Math.min(n.x,i.x,d.x),f=Math.max(n.x,i.x,d.x),p=Math.min(n.y,i.y,d.y),m=Math.max(n.y,i.y,d.y);u.length=0,e.grid.query(new y(h,p),new y(f,m),u);for(let e=0;e<u.length;e++){const t=u[e];if(Ef(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],n,i,d,o))return!0}}return!1}function $b(e,t,r,n){if(!e||!r)return!1;let i=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(r.vertices.length<e.vertices.length)return $b(r,n,e,t);const a=t.canonical,o=n.canonical,s=Math.pow(2,o.z-a.z);i=e.vertices.map((e=>new y(e.x*a.x*nn*s-o.x*nn,e.y*a.y*nn*s-o.y*nn)))}return Vb(r,i,e.indices,0,e.indices.length,0,0)}const Hb=Qp.types,Wb=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Xb=["fill-extrusion-flood-light-ground-radius"],Yb=Math.pow(2,13),Zb=Math.pow(2,15)-1,Kb=new y(0,1),Jb=2147483648;function Qb(e,t,r,n,i,a,o,s){e.emplaceBack((t<<1)+o,(r<<1)+a,(Math.floor(n*Yb)<<1)+i,Math.round(s))}function ex(e,t,r,n,i,a){e.emplaceBack(t.x,t.y,(r.x<<1)+n,(r.y<<1)+i,a)}function tx(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class rx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class nx{constructor(){this.centroidXY=new y(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new y(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new y(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new y(this.max.x-this.min.x,this.max.y-this.min.y)}}class ix{constructor(){this.acc=new y(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,r){this.accCount++,this.acc._add(t);let n=!!this.borders;t.x<e.min.x?(e.min.x=t.x,n=!0):t.x>e.max.x&&(e.max.x=t.x,n=!0),t.y<e.min.y?(e.min.y=t.y,n=!0):t.y>e.max.y&&(e.max.y=t.y,n=!0),((0===t.x||t.x===nn)&&t.x===r.x)!=((0===t.y||t.y===nn)&&t.y===r.y)&&this.processBorderOverlap(t,r),n&&this.checkBorderIntersection(t,r)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Hn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>nn!=e.x>nn&&this.addBorderIntersection(1,Hn(t.y,e.y,(nn-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Hn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>nn!=e.y>nn&&this.addBorderIntersection(3,Hn(t.x,e.x,(nn-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new y(0,0):new y(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function ax(e,t){const r=e.add(t)._unit(),n=C(e.x*r.x+e.y*r.y,-1,1);var i,a,o;return i=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(i)))/4*Zb*((a=e).x*(o=t).y-a.y*o.x<0?-1:1)}const ox=[e=>e.x<0,e=>e.x>nn,e=>e.y<0,e=>e.y>nn];function sx(e,t,r,n){const i=[4];if(0===n)return i;r._mult(n);const a=e.sub(r),o=t.sub(r),s=[e,t,a,o];for(let e=0;e<4;e++)for(const t of s)if(ox[e](t)){i.push(e);break}return i}class lx{constructor(e){this.vertexArray=new ws,this.indexArray=new Ns,this.programConfigurations=new Vl(e.layers,e.zoom,(e=>Xb.includes(e))),this._segments=new ul,this.hiddenByLandmarkVertexArray=new Ys,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ul}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,r,n=!1){const i=e.length;if(i>2){let a=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[a].length);let s;a!==this._segments.get().length-1&&(a++,this._segmentToGroundQuads[a]=[],this._segmentToRegionTriCounts[a]=[0,0,0,0,0]);{const t=e[0],r=e[1];s=ax(t.sub(e[i-1])._perp()._unit(),r.sub(t)._perp()._unit())}for(let l=0;l<i;l++){const u=l===i-1?0:l+1,c=e[l],d=e[u],h=e[u===i-1?0:u+1],f=d.sub(c)._perp()._unit(),p=ax(f,h.sub(d)._perp()._unit()),m=s,g=p;if(fx(c,d,t)||n&&px(c,t)&&px(d,t)){s=p;continue}const _=o.vertexLength;ex(this.vertexArray,c,d,1,1,m),ex(this.vertexArray,c,d,1,0,m),ex(this.vertexArray,c,d,0,1,g),ex(this.vertexArray,c,d,0,0,g),o.vertexLength+=4;const y=sx(c,d,f,r);for(const e of y)this._segmentToGroundQuads[a].push({id:_,region:e}),this._segmentToRegionTriCounts[a][e]+=2,o.primitiveLength+=2;s=p}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let e=0;e<t;e++)this._segmentToGroundQuads[e].sort(((e,t)=>e.region-t.region));for(let r=0;r<t;r++){const t=this._segmentToGroundQuads[r],n=e[r],i=this._segmentToRegionTriCounts[r];i.reduce(((e,t)=>e+t),0);let a=0;for(let e=0;e<=4;e++){const t=i[e];if(0!==t){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new ul);const i={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+a,vertexLength:n.vertexLength,primitiveLength:t};r.get().push(i)}a+=t}for(let e=0;e<t.length;e++){const r=t[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,r,n,i,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,r,n,i,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,kp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,r,n,i,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,r,n,i,a)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const r=e.flags&Jb?1:0;for(let n=e.groundVertexArrayOffset;n<t;++n)this.hiddenByLandmarkVertexArray.emplace(n,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Fp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class ux{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ns,this.footprintVertices=new bs,this.footprintSegments=[],this.layoutVertexArray=new Ts,this.centroidVertexArray=new ol,this.indexArray=new Ns,this.programConfigurations=new Vl(e.layers,e.zoom,(e=>Wb.includes(e))),this.segments=new ul,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new lx(e),this.maxHeight=0,this.partLookup={}}populate(e,t,r,n){this.features=[],this.hasPattern=Rp("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Zh(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:i,id:a,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=sf(i,e);if(!this.layers[0]._featureFilter.filter(new Ko(this.zoom),l,r))continue;const u={id:a,sourceLayerIndex:s,index:o,geometry:e?l.geometry:of(i,r,n),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cp("fill-extrusion",this.layers,u,this.zoom,t)):this.addFeature(u,u.geometry,o,r,{},t.availableImages,n,t.brightness),t.featureIndex.insert(i,u.geometry,o,s,this.index,c)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,t,r,n,i,a){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,r,n,i,a)}this.sortBorders()}update(e,t,r,n,i){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,o,r,n,i),this.groundEffect.update(e,t,o,r,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Np.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Bp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n,i,a,o,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,u=[new y(0,0),new y(nn,nn)],c=o.projection,d="globe"===c.name,h="Polygon"===Hb[e.type],f=new ix;f.centroidDataIndex=this.centroidData.length;const p=new nx,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},n)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},n);p.height=g,p.vertexArrayOffset=this.layoutVertexArray.length,p.groundVertexArrayOffset=this.groundEffect.vertexArray.length,d&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ms);const _=Pp(t,500);for(let e=_.length-1;e>=0;e--){const t=_[e];(0===t.length||(v=t[0]).every((e=>e.x<=0))||v.every((e=>e.x>=nn))||v.every((e=>e.y<=0))||v.every((e=>e.y>=nn)))&&_.splice(e,1)}var v;let b;if(d)b=yx(_,u,n);else{b=[];for(const e of _)b.push({polygon:e,bounds:u})}const x=h?this.edgeRadius:0,T=x>0&&this.zoom<17,w=(e,t)=>{if(0===e.length)return!1;const r=e[e.length-1];return t.x===r.x&&t.y===r.y};for(const{polygon:e,bounds:t}of b){let r=0,i=0;for(const t of e)h&&!t[0].equals(t[t.length-1])&&t.push(t[0]),i+=h?t.length-1:t.length;const a=this.segments.prepareSegment((h?5:4)*i,this.layoutVertexArray,this.indexArray);p.footprintSegIdx<0&&(p.footprintSegIdx=this.footprintSegments.length);const o=new rx;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],h){const i=[],s=[];r=a.vertexLength;for(let r=0;r<e.length;r++){const u=e[r];u.length&&0!==r&&s.push(i.length/2);const h=[];let f,p;f=u[1].sub(u[0])._perp()._unit(),o.ringIndices.push(u.length-1);for(let e=1;e<u.length;e++){const t=u[e],r=u[e===u.length-1?1:e+1],o=t.clone();if(x){p=r.sub(t)._perp()._unit();const e=f.add(p)._unit(),n=x*Math.min(4,1/(f.x*e.x+f.y*e.y));o.x+=n*e.x,o.y+=n*e.y,o.x=Math.round(o.x),o.y=Math.round(o.y),f=p}!m||0!==x&&!T||w(h,o)||h.push(o),Qb(this.layoutVertexArray,o.x,o.y,0,0,1,1,0),a.vertexLength++,this.footprintVertices.emplaceBack(t.x,t.y),i.push(t.x,t.y),d&&tx(this.layoutVertexExtArray,c.projectTilePoint(o.x,o.y,n),c.upVector(n,o.x,o.y))}m&&(0===x||T)&&(0!==h.length&&w(h,h[0])&&h.pop(),this.groundEffect.addData(h,t,l))}const u=Sp(i,s);for(let e=0;e<u.length;e+=3)this.footprintIndices.emplaceBack(o.vertexOffset+u[e+0],o.vertexOffset+u[e+1],o.vertexOffset+u[e+2]),this.indexArray.emplaceBack(r+u[e],r+u[e+2],r+u[e+1]),a.primitiveLength++;o.indexCount+=u.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let i=0;i<e.length;i++){const o=e[i];f.startRing(p,o[0]);let s=o.length>4&&mx(o[o.length-2],o[0],o[1]),u=x?dx(o[o.length-2],o[0],o[1],x):0;const g=[];let _,y,v;y=o[1].sub(o[0])._perp()._unit();let b=!0;for(let e=1,i=0;e<o.length;e++){let l=o[e-1],h=o[e];const T=o[e===o.length-1?1:e+1];if(f.appendEdge(p,h,l),fx(h,l,t)){x&&(y=T.sub(h)._perp()._unit(),b=!b);continue}const E=h.sub(l)._perp(),A=E.x/(Math.abs(E.x)+Math.abs(E.y)),S=E.y>0?1:0,P=l.dist(h);if(i+P>32768&&(i=0),x){v=T.sub(h)._perp()._unit();let e=hx(l,h,T,cx(y,v),x);isNaN(e)&&(e=0);const t=h.sub(l)._unit();l=l.add(t.mult(u))._round(),h=h.add(t.mult(-e))._round(),u=e,y=v,m&&this.zoom>=17&&(w(g,l)||g.push(l),w(g,h)||g.push(h))}const M=a.vertexLength,R=o.length>4&&mx(l,h,T);let C=gx(i,s,b);if(Qb(this.layoutVertexArray,l.x,l.y,A,S,0,0,C),Qb(this.layoutVertexArray,l.x,l.y,A,S,0,1,C),i+=P,C=gx(i,R,!b),s=R,Qb(this.layoutVertexArray,h.x,h.y,A,S,0,0,C),Qb(this.layoutVertexArray,h.x,h.y,A,S,0,1,C),a.vertexLength+=4,this.indexArray.emplaceBack(M+0,M+1,M+2),this.indexArray.emplaceBack(M+1,M+3,M+2),a.primitiveLength+=2,x){const n=r+(1===e?o.length-2:e-2),i=1===e?r:n+1;if(this.indexArray.emplaceBack(M+1,n,M+3),this.indexArray.emplaceBack(n,i,M+3),a.primitiveLength+=2,void 0===_&&(_=M),!fx(T,o[e],t)){const t=e===o.length-1?_:a.vertexLength;this.indexArray.emplaceBack(M+2,M+3,t),this.indexArray.emplaceBack(M+3,t+1,t),this.indexArray.emplaceBack(M+3,i,t+1),a.primitiveLength+=3}b=!b}if(d){const e=this.layoutVertexExtArray,t=c.projectTilePoint(l.x,l.y,n),r=c.projectTilePoint(h.x,h.y,n),i=c.upVector(n,l.x,l.y),a=c.upVector(n,h.x,h.y);tx(e,t,i),tx(e,t,i),tx(e,r,a),tx(e,r,a)}}h&&(r+=o.length-1),m&&x&&this.zoom>=17&&(0!==g.length&&w(g,g[0])&&g.pop(),this.groundEffect.addData(g,t,l,x>0))}this.footprintSegments.push(o),++p.footprintSegLen}if(p.vertexCount=this.layoutVertexArray.length-p.vertexArrayOffset,p.groundVertexCount=this.groundEffect.vertexArray.length-p.groundVertexArrayOffset,0!==p.vertexCount){if(p.centroidXY=f.borders?Kb:this.encodeCentroid(f,p),this.centroidData.push(p),f.borders){this.featuresOnBorder.push(f);const e=this.featuresOnBorder.length-1;for(let t=0;t<f.borders.length;t++)f.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,a,n,s),this.groundEffect.addPaintPropertiesData(e,r,i,a,n,s),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}encodeCentroid(e,t){const r=e.centroid(),n=t.span(),i=Math.min(7,Math.round(n.x*this.tileToMeter/10)),a=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new y(C(r.x,1,nn-1)<<3|i,C(r.y,1,nn-1)<<3|a)}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=Jb,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=e.flags&Jb?Kb:e.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==n.y||i!==n.x){for(let e=t;e<r;++e)this.centroidVertexArray.emplace(e,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==t[r].sourceId||!Ub(e[r],t[r]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const e of this.centroidData)e.flags&=2147483647;const n=[];for(const t of this.activeReplacements){const r=Math.pow(2,t.footprintTileId.canonical.z-e.canonical.z);for(const i of this.centroidData)if(!(i.flags&Jb||t.min.x>i.max.x||i.min.x>t.max.x||t.min.y>i.max.y||i.min.y>t.max.y))for(let a=0;a<i.footprintSegLen;a++){const o=this.footprintSegments[i.footprintSegIdx+a];if(n.length=0,vx(this.footprintVertices,o.vertexOffset,o.vertexCount,t.footprintTileId.canonical,e.canonical,n),Vb(t.footprint,n,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-r)){i.flags|=Jb;break}}}for(const e of this.centroidData)this.writeCentroidToBuffer(e);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,r){let n=!1;for(let i=0;i<r.footprintSegLen;i++){const a=this.footprintSegments[r.footprintSegIdx+i];let o=0;for(const r of a.ringIndices){for(let i=o,s=r+o-1;i<r+o;s=i++){const r=this.footprintVertices.int16[2*(i+a.vertexOffset)+0],o=this.footprintVertices.int16[2*(i+a.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+a.vertexOffset)+1];o>t!=l>t&&e<(this.footprintVertices.int16[2*(s+a.vertexOffset)+0]-r)*(t-o)/(l-o)+r&&(n=!n)}o=r}}return n}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(e+nn)*nn+(t+nn);if(this.partLookup.hasOwnProperty(i)){const e=this.partLookup[i];return e?{height:e.height,hidden:!!(e.flags&Jb)}:void 0}for(const a of this.centroidData)e>a.max.x||a.min.x>e||t>a.max.y||a.min.y>t||this.footprintContainsPoint(e,t,a)&&a&&a.height>r&&(r=a.height,this.partLookup[i]=a,n=!!(a.flags&Jb));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[i]=void 0}}function cx(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function dx(e,t,r,n){const i=t.sub(e)._perp()._unit(),a=r.sub(t)._perp()._unit();return hx(e,t,r,cx(i,a),n)}function hx(e,t,r,n,i){const a=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*a/n)}function fx(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function px(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function mx(e,t,r){if(e.x<0||e.x>=nn||t.x<0||t.x>=nn||r.x<0||r.x>=nn)return!1;const n=r.sub(t),i=n.perp(),a=e.sub(t);return(n.x*a.x+n.y*a.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(a.x*a.x+a.y*a.y))>-.866&&i.x*a.x+i.y*a.y<0}function gx(e,t,r){const n=t?2|e:-3&e;return r?1|n:-2&n}function _x(){const e=Math.PI/32,t=Math.tan(e),r=Ih;return r*Math.sqrt(1+2*t*t)-r}function yx(e,t,r){const n=1<<r.z,i=zh(r.x/n),a=zh((r.x+1)/n),o=Vh(r.y/n),s=Vh((r.y+1)/n);return function(e,t,r,n,i=0,a){const o=[];if(!e.length||!r||!n)return o;const s=(e,t)=>{for(const r of e)o.push({polygon:r,bounds:t})},l=Math.ceil(Math.log2(r)),u=Math.ceil(Math.log2(n)),c=l-u,d=[];for(let e=0;e<Math.abs(c);e++)d.push(c>0?0:1);for(let e=0;e<Math.min(l,u);e++)d.push(0),d.push(1);let h=e;if(h=em(h,t[0].y-i,t[1].y+i,1),h=em(h,t[0].x-i,t[1].x+i,0),!h.length)return o;const f=[];for(d.length?f.push({polygons:h,bounds:t,depth:0}):s(h,t);f.length;){const e=f.pop(),t=e.depth,r=d[t],n=e.bounds[0],o=e.bounds[1],l=0===r?n.x:n.y,u=0===r?o.x:o.y,c=a?a(r,l,u):.5*(l+u),h=em(e.polygons,l-i,c+i,r),p=em(e.polygons,c-i,u+i,r);if(h.length){const e=[n,new y(0===r?c:o.x,1===r?c:o.y)];d.length>t+1?f.push({polygons:h,bounds:e,depth:t+1}):s(h,e)}if(p.length){const e=[new y(0===r?c:n.x,1===r?c:n.y),o];d.length>t+1?f.push({polygons:p,bounds:e,depth:t+1}):s(p,e)}}return o}(e,t,Math.ceil((a-i)/11.25),Math.ceil((o-s)/11.25),1,((e,t,i)=>{if(0===e)return.5*(t+i);{const e=Vh((r.y+t/nn)/n);return(jh(.5*(Vh((r.y+i/nn)/n)+e))*n-r.y)*nn}}))}function vx(e,t,r,n,i,a){const o=Math.pow(2,n.z-i.z);for(let s=0;s<r;s++){let r=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];r=(r+i.x*nn)*o-n.x*nn,l=(l+i.y*nn)*o-n.y*nn,a.push(new y(r,l))}}Ao(ux,"FillExtrusionBucket",{omit:["layers","features"]}),Ao(nx,"PartData"),Ao(rx,"FootprintSegment"),Ao(ix,"BorderCentroidData"),Ao(lx,"GroundEffect");const bx=new us({visibility:new os(St["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new os(St["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var xx={paint:new us({"fill-extrusion-opacity":new os(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ss(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new os(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new os(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ss(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ss(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ss(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new os(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new os(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new os(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new os(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new os(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new os(St["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new os(St["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new os(St["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ss(St["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ss(St["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new os(St["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new os(St["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new os(St["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new os(St["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:bx};class Tx extends y{constructor(e,t,r){super(e,t),this.z=r}}function wx(e,t){return e.x*t.x+e.y*t.y}function Ex(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const a=t[r],o=e[0],s=i.sub(n),l=a.sub(n),u=o.sub(n),c=wx(s,s),d=wx(s,l),h=wx(l,l),f=wx(u,s),p=wx(u,l),m=c*h-d*d,g=(h*f-d*p)/m,_=(c*p-d*f)/m,y=n.z*(1-g-_)+i.z*g+a.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function Ax(e,t,r,n,i,a,o,s){const l=o*i.getElevationAt(e,t,!0,!0),u=0!==a[0],c=u?0===a[1]?o*(a[0]/7-450):o*function(e,t,r){const n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),a=10*(t[0]-8*n),o=10*(t[1]-8*i),s=e.getElevationAt(n,i,!0,!0),l=e.getMeterToDEM(r),u=Math.floor(.5*(a*l-1)),c=Math.floor(.5*(o*l-1)),d=e.tileCoordToPixel(n,i),h=2*u+1,f=2*c+1,p=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,d.x-u,d.y-c,h,f),m=Math.abs(p[0]-p[1]),g=Math.abs(p[2]-p[3]),_=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),y=Math.min(.25,.5*l*(m+g)/h),v=Math.min(.25,.5*l*_/f);return s+Math.max(y*a,v*o)}(i,a,s):l;return{base:l+(0===r)?-1:r,top:u?Math.max(c+n,l+r+2):l+n}}const Sx=new us({"line-cap":new ss(St.layout_line["line-cap"]),"line-join":new ss(St.layout_line["line-join"]),"line-miter-limit":new os(St.layout_line["line-miter-limit"]),"line-round-limit":new os(St.layout_line["line-round-limit"]),"line-sort-key":new ss(St.layout_line["line-sort-key"]),visibility:new os(St.layout_line.visibility)});var Px={paint:new us({"line-opacity":new ss(St.paint_line["line-opacity"]),"line-color":new ss(St.paint_line["line-color"]),"line-translate":new os(St.paint_line["line-translate"]),"line-translate-anchor":new os(St.paint_line["line-translate-anchor"]),"line-width":new ss(St.paint_line["line-width"]),"line-gap-width":new ss(St.paint_line["line-gap-width"]),"line-offset":new ss(St.paint_line["line-offset"]),"line-blur":new ss(St.paint_line["line-blur"]),"line-dasharray":new ss(St.paint_line["line-dasharray"]),"line-pattern":new ss(St.paint_line["line-pattern"]),"line-gradient":new ls(St.paint_line["line-gradient"]),"line-trim-offset":new os(St.paint_line["line-trim-offset"]),"line-emissive-strength":new os(St.paint_line["line-emissive-strength"]),"line-border-width":new ss(St.paint_line["line-border-width"]),"line-border-color":new ss(St.paint_line["line-border-color"])}),layout:Sx};const Mx=(e,t,r,n,i,a,o)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Ox(e,t,r,n),u_pixels_to_tile_units:l,u_device_pixel_ratio:a,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:Ix(r)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cx(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_emissive_strength:r.paint.get("line-emissive-strength")}},Rx=(e,t,r,n,i)=>{const a=e.transform;return{u_matrix:Ox(e,t,r,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_image:0,u_tile_units_to_pixels:Cx(t,a),u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Cx(e,t){return 1/Hv(e,1,t.tileZoom)}function Ox(e,t,r,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Lx=e=>{const t=[];Ix(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");return 0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Ix(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Dx=new class extends ss{possiblyEvaluate(e,t){return t=new Ko(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=k({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}(Px.paint.properties["line-width"].specification);function kx(e,t){return t>0?t+2*e:e}Dx.useIntegerZoom=!0;const Bx=new us({visibility:new os(St.layout_background.visibility)});var Fx={paint:new us({"background-color":new os(St.paint_background["background-color"]),"background-pattern":new os(St.paint_background["background-pattern"]),"background-opacity":new os(St.paint_background["background-opacity"]),"background-emissive-strength":new os(St.paint_background["background-emissive-strength"])}),layout:Bx};const Nx=new us({visibility:new os(St.layout_raster.visibility)});var qx={paint:new us({"raster-opacity":new os(St.paint_raster["raster-opacity"]),"raster-color":new ls(St.paint_raster["raster-color"]),"raster-color-mix":new os(St.paint_raster["raster-color-mix"]),"raster-color-range":new os(St.paint_raster["raster-color-range"]),"raster-hue-rotate":new os(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new os(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new os(St.paint_raster["raster-brightness-max"]),"raster-saturation":new os(St.paint_raster["raster-saturation"]),"raster-contrast":new os(St.paint_raster["raster-contrast"]),"raster-resampling":new os(St.paint_raster["raster-resampling"]),"raster-fade-duration":new os(St.paint_raster["raster-fade-duration"])}),layout:Nx};function Ux(e,t,r,n,i,a,o,s){const l=[e,r,i,t,n,a,1,1,1],u=[o,s,1],c=pd.adjoint([],l),[d,h,f]=Td.transformMat3(u,u,pd.transpose(c,c));return pd.multiply(l,[d,0,0,0,h,0,0,0,f],l)}class jx extends At{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new wt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Me(this.map._requestManager.transformRequest(this.url,ye.Image),((r,n)=>{if(this._imageRequest=null,this._loaded=!0,r)this.fire(new Et(r));else if(n){const{HTMLImageElement:r}=t;this.image=n instanceof r?st.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new my(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof my||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],r=e[0][1];for(const n of e)n[1]>r&&(r=n[1]),n[1]<t&&(t=n[1]);const n=(r+t)/2;if(n>Hh?this.onNorthPole=!0:n<-Hh&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Kh.fromLngLat);this.tileID=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const a of e)t=Math.min(t,a.x),r=Math.min(r,a.y),n=Math.max(n,a.x),i=Math.max(i,a.y);const a=Math.max(n-t,i-r),o=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),s=Math.pow(2,o);return new Ld(o,Math.floor((t+n)/2*s),Math.floor((r+i)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const t=b_(this.tileID,this.map.transform.projection),[r,n,i,a]=this.coordinates.map((e=>{const r=t.projection.project(e[0],e[1]);return T_(t,r)._round()}));this.perspectiveTransform=function(e,t,r,n,i,a,o,s,l,u){const c=Ux(0,0,e,0,0,t,e,t),d=Ux(r,n,i,a,o,s,l,u);return pd.multiply(d,pd.adjoint(c,c),d),[d[6]/d[8]*e/nn,d[7]/d[8]*t/nn]}(this.width,this.height,r.x,r.y,n.x,n.y,a.x,a.y,i.x,i.y);const o=this._boundsArray=new Ts;o.emplaceBack(r.x,r.y,0,0),o.emplaceBack(n.x,n.y,nn,0),o.emplaceBack(a.x,a.y,0,nn),o.emplaceBack(i.x,i.y,nn,nn),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(o,wy.members),this.boundsSegments=ul.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,r=t.gl;!this._dirty||this.texture instanceof my||(this.texture?this.texture.update(this.image):(this.texture=new py(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Gx extends fs{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const zx=new us({visibility:new os(St.layout_sky.visibility)});var Vx={paint:new us({"sky-type":new os(St.paint_sky["sky-type"]),"sky-atmosphere-sun":new os(St.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new os(St.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new os(St.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new os(St.paint_sky["sky-gradient-radius"]),"sky-gradient":new ls(St.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new os(St.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new os(St.paint_sky["sky-atmosphere-color"]),"sky-opacity":new os(St.paint_sky["sky-opacity"])}),layout:zx};function $x(e,t,r){const n=[0,0,1],i=yd.identity([]);return yd.rotateY(i,i,r?-T(e)+Math.PI:T(e)),yd.rotateX(i,i,-T(t)),Td.transformQuat(n,n,i),Td.normalize(n,n)}var Hx={paint:new us({})};const Wx={circle:class extends fs{constructor(e,t){super(e,Cf,t)}createBucket(e){return new cf(e)}queryRadius(e){const t=e;return Af("circle-radius",this,t)+Af("circle-stroke-width",this,t)+Sf(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,a,o,s){const l=Mf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Df(e,n,a,o,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const r=If(this);return{config:new zl(this,t),defines:r,overrideFog:!1}}},heatmap:class extends fs{createBucket(e){return new qf(e)}constructor(e,t){super(e,Wf,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Af("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,i,a,o,s){const l=this.paint.get("heatmap-radius").evaluate(t,r);return Df(e,n,a,o,s,!0,!0,new y(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new zl(this,t),overrideFog:!1}:{}}},hillshade:class extends fs{constructor(e,t){super(e,Zf,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends fs{constructor(e,t){super(e,Ip,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t){return{config:new zl(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Op(e)}queryRadius(){return Sf(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,a){return!e.queryGeometry.isAboveHorizon&&ff(Pf(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends fs{constructor(e,t){super(e,xx,t)}createBucket(e){return new ux(e)}queryRadius(){return Sf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,r,n,i,a,o,s,l){const u=Mf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,r),d=this.paint.get("fill-extrusion-base").evaluate(t,r),h=[0,0],f=s&&a.elevation,p=a.elevation?a.elevation.exaggeration():1,m=e.tile.getBucket(this);if(f&&m instanceof ux){const e=m.centroidVertexArray,t=l+1;t<e.length&&(h[0]=e.geta_centroid_pos0(t),h[1]=e.geta_centroid_pos1(t))}if(0===h[0]&&1===h[1])return!1;"globe"===a.projection.name&&(n=yx([n],[new y(0,0),new y(nn,nn)],e.tileID.canonical).map((e=>e.polygon)).flat());const g=f?s:null,[_,v]=function(e,t,r,n,i,a,o,s,l,u,c){return"globe"===e.projection.name?function(e,t,r,n,i,a,o,s,l,u,c){const d=[],h=[],f=e.projection.upVectorScale(c,e.center.lat,e.worldSize).metersToTile,p=[0,0,0,1],m=[0,0,0,1],g=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},_=_x();r>0&&(r+=_),n+=_;for(const _ of t){const t=[],y=[];for(const d of _){const h=d.x+i.x,_=d.y+i.y,v=e.projection.projectTilePoint(h,_,c),b=e.projection.upVector(c,d.x,d.y);let x=r,T=n;if(o){const e=Ax(h,_,r,n,o,s,l,u);x+=e.base,T+=e.top}0!==r?g(p,v.x+b[0]*f*x,v.y+b[1]*f*x,v.z+b[2]*f*x):g(p,v.x,v.y,v.z),g(m,v.x+b[0]*f*T,v.y+b[1]*f*T,v.z+b[2]*f*T),Td.transformMat4(p,p,a),Td.transformMat4(m,m,a),t.push(new Tx(p[0],p[1],p[2])),y.push(new Tx(m[0],m[1],m[2]))}d.push(t),h.push(y)}return[d,h]}(e,t,r,n,i,a,o,s,l,u,c):o?function(e,t,r,n,i,a,o,s,l){const u=[],c=[],d=[0,0,0,1];for(const h of e){const e=[],f=[];for(const u of h){const c=u.x+n.x,h=u.y+n.y,p=Ax(c,h,t,r,a,o,s,l);d[0]=c,d[1]=h,d[2]=p.base,d[3]=1,ld.transformMat4(d,d,i),d[3]=Math.max(d[3],1e-5);const m=new Tx(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=c,d[1]=h,d[2]=p.top,d[3]=1,ld.transformMat4(d,d,i),d[3]=Math.max(d[3],1e-5);const g=new Tx(d[0]/d[3],d[1]/d[3],d[2]/d[3]);e.push(m),f.push(g)}u.push(e),c.push(f)}return[u,c]}(t,r,n,i,a,o,s,l,u):function(e,t,r,n,i){const a=[],o=[],s=i[8]*t,l=i[9]*t,u=i[10]*t,c=i[11]*t,d=i[8]*r,h=i[9]*r,f=i[10]*r,p=i[11]*r;for(const t of e){const e=[],r=[];for(const a of t){const t=a.x+n.x,o=a.y+n.y,m=i[0]*t+i[4]*o+i[12],g=i[1]*t+i[5]*o+i[13],_=i[2]*t+i[6]*o+i[14],y=i[3]*t+i[7]*o+i[15],v=m+s,b=g+l,x=_+u,T=Math.max(y+c,1e-5),w=m+d,E=g+h,A=_+f,S=Math.max(y+p,1e-5);e.push(new Tx(v/T,b/T,x/T)),r.push(new Tx(w/S,E/S,A/S))}a.push(e),o.push(r)}return[a,o]}(t,r,n,i,a)}(a,n,d,c,u,o,g,h,p,a.center.lat,e.tileID.canonical),b=e.queryGeometry;return function(e,t,r){let n=1/0;ff(r,t)&&(n=Ex(r,t[0]));for(let i=0;i<t.length;i++){const a=t[i],o=e[i];for(let e=0;e<a.length-1;e++){const t=a[e],i=[t,a[e+1],o[e+1],o[e],t];df(r,i)&&(n=Math.min(n,Ex(r,i)))}}return n!==1/0&&n}(_,v,b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends fs{constructor(e,t){super(e,Px,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof $n,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Dx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new fy(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const r=Lx(this);return{config:new zl(this,t),defines:r,overrideFog:!1}}queryRadius(e){const t=e,r=kx(Af("line-width",this,t),Af("line-gap-width",this,t)),n=Af("line-offset",this,t);return r/2+Math.abs(n)+Sf(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=Pf(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*kx(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),l=this.paint.get("line-offset").evaluate(t,r);return l&&(n=function(e,t){const r=[],n=new y(0,0);for(let i=0;i<e.length;i++){const a=e[i],o=[];for(let e=0;e<a.length;e++){const r=a[e],i=a[e+1],s=0===e?n:r.sub(a[e-1])._unit()._perp(),l=e===a.length-1?n:i.sub(r)._unit()._perp(),u=s._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),o.push(u._mult(t)._add(r))}r.push(o)}return r}(n,l*e.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(bf(e,i[t]))return!0;if(pf(e,i,r))return!0}return!1}(o,n,s)}isTileClipped(){return!0}},symbol:X_,background:class extends fs{constructor(e,t){super(e,Fx,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends fs{constructor(e,t){super(e,qx,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof jx&&(e._source.onNorthPole||e._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Xf({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends fs{constructor(e,t){super(e,Vx,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,a=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&X("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?$x(a.azimuthal,90-a.polar,t):$x(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return $x(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends fs{constructor(e,t){super(e,Hx)}},model:class extends fs{constructor(e,t){super(e,Mb,t)}createBucket(e){return new Sb(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof _a}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Xx(e,t){return"custom"===e.type?new Gx(e):new Wx[e.type](e,t)}function Yx(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Zx extends At{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Vf({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:r}of this.requestors)this._notify(e,t,r);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,r){this._validate(e,r)&&(this.images[t][e]=r)}_validate(e,t){let r=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new Et(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new Et(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(t.content,t)||(this.fire(new Et(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let r=0;for(const n of e){if(n[0]<r||n[1]<n[0]||t<n[1])return!1;r=n[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,r){r.version=this.images[t][e].version+1,this.images[t][e]=r,this.updatedImages[t][e]=!0}removeImage(e,t){const r=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,r){let n=!0;const i=!!this.loaded[t];if(!i)for(const r of e)this.images[t][r]||(n=!1);i||n?this._notify(e,t,r):this.requestors.push({ids:e,scope:t,callback:r})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,t,r){const n={};for(const r of e){this.images[t][r]||this.fire(new wt("styleimagemissing",{id:r}));const e=this.images[t][r];e?n[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:X(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(e){const{width:t,height:r}=this.atlasImage[e];return{width:t,height:r}}getPattern(e,t){const r=this.patterns[t][e],n=this.getImage(e,t);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const r={w:n.data.width+2,h:n.data.height+2,x:0,y:0},i=new _g(r,n);this.patterns[t][e]={bin:r,position:i}}return this._updatePatternAtlas(t),this.patterns[t][e].position}bind(e,t){const r=e.gl;let n=this.atlasTexture[t];n?this.dirty&&(n.update(this.atlasImage[t]),this.dirty=!1):(n=new py(e,this.atlasImage[t],r.RGBA),this.atlasTexture[t]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const t=[];for(const r in this.patterns[e])t.push(this.patterns[e][r].bin);const{w:r,h:n}=mg(t),i=this.atlasImage[e];i.resize({width:r||1,height:n||1});for(const t in this.patterns[e]){const{bin:r}=this.patterns[e][t],n=r.x+1,a=r.y+1,o=this.images[e][t].data,s=o.width,l=o.height;Vf.copy(o,i,{x:0,y:0},{x:n,y:a},{width:s,height:l}),Vf.copy(o,i,{x:0,y:l-1},{x:n,y:a-1},{width:s,height:1}),Vf.copy(o,i,{x:0,y:0},{x:n,y:a+l},{width:s,height:1}),Vf.copy(o,i,{x:s-1,y:0},{x:n-1,y:a},{width:1,height:l}),Vf.copy(o,i,{x:0,y:0},{x:n+s,y:a},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const r of e){if(this.callbackDispatchedThisFrame[t][r])continue;this.callbackDispatchedThisFrame[t][r]=!0;const e=this.images[t][r];Yx(e)&&this.updateImage(r,t,e)}}}const Kx=new us({anchor:new os(St.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return K(e.expression.evaluate(t))}interpolate(e,t,r){return{x:Hn(e.x,t.x,r),y:Hn(e.y,t.y,r),z:Hn(e.z,t.z,r),azimuthal:Hn(e.azimuthal,t.azimuthal,r),polar:Hn(e.polar,t.polar,r)}}}(St.light.position),color:new os(St.light.color),intensity:new os(St.light.intensity)});class Jx extends At{constructor(e,t="flat"){super(),this._transitionable=new es(Kx),this.setLight(e,t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,r={}){this._validate(lo,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&vo(this,e.call(oo,k({value:t,style:{glyphs:!0,sprite:!0},styleSpec:St})))}}const Qx=new us({source:new os(St.terrain.source),exaggeration:new os(St.terrain.exaggeration)});let eT=class extends At{constructor(e,t){super(),this._transitionable=new es(Qx),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(e){this.scope=e}get(){return this._transitionable.serialize()}set(e){this._transitionable.setTransitionOrValue(e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new Ko(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof _a}};const tT=45,rT=65,nT=.05;function iT(e,t,r,n){const i=O(tT,rT,r),[a,o]=aT(e,n);let s=1-Math.min(1,Math.exp((t-a)/(o-a)*-6));return s*=s*s,s=Math.min(1,1.00747*s),s*i*e.alpha}function aT(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function oT(e,t,r,n,i){const a=Td.transformMat4([],[t,r,n],i.mercatorFogMatrix);return iT(e,Td.length(a),i.pitch,i._fov)}function sT(e,t,r,n,i,a,o){const s=[[r,n,0],[i,n,0],[i,a,0],[r,a,0]];let l=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const e of s){const r=Td.transformMat4([],e,t),n=Td.length(r);l=Math.min(l,n),u=Math.max(u,n)}return[iT(e,l,o.pitch,o._fov),iT(e,u,o.pitch,o._fov)]}const lT=new us({range:new os(St.fog.range),color:new os(St.fog.color),"high-color":new os(St.fog["high-color"]),"space-color":new os(St.fog["space-color"]),"horizon-blend":new os(St.fog["horizon-blend"]),"star-intensity":new os(St.fog["star-intensity"]),"vertical-range":new os(St.fog["vertical-range"])});class uT extends At{constructor(e,t){super(),this._transitionable=new es(lT),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}get state(){const e=this._transform,t="globe"===e.projection.name,r=xh(e.zoom),n=this.properties.get("range"),i=[.5,3];return{range:t?[Hn(i[0],n[0],r),Hn(i[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t={}){if(this._validate(ho,e,t))return;const r=k({},e);for(const e of Object.keys(St.fog))void 0===r[e]&&(r[e]=St.fog[e].default);this._transitionable.setTransitionOrValue(r)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const t=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:O(tT,rT,e))*t.a}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?function(e,t,r){const n=Kh.fromLngLat(t),i=r.elevation?r.elevation.getAtPointOrZero(n):0;return oT(e,n.x,n.y,i,r)}(this.state,e,t):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const t=this._transform.calculateFogTileMatrix(e.toUnwrapped());return sT(this.state,t,0,0,nn,nn,this._transform)}getOpacityForBounds(e,t,r,n,i){return this._transform.projection.supportsFog?sT(this.state,e,t,r,n,i,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?aT(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const t=[4,5,6,7];for(const r of t){const t=e.points[r];let n;if(t[2]>=0)n=t;else{const i=e.points[r-4];n=Wn(i,t,i[2]/(i[2]-t[2]))}if(oT(this.state,n[0],n[1],0,this._transform)>=nT)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&vo(this,e.call(oo,k({value:t,style:{glyphs:!0,sprite:!0},styleSpec:St})))}}class cT{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class dT{constructor(){this.tasks={},this.taskQueue=[],G(["process"],this),this.invoker=new cT(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:r}){return r=r||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-r:"maybePrepare"===e&&t?400-r:500:200-r:100-r}(t);if(0===n){Q();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Q();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<t&&(t=n.priority,e=r)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class hT{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},G(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new dT}send(e,t,r,n,i=!1,a){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=a,this.callbacks[o]=r);const s=new Set;return this.target.postMessage({id:o,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:Mo(t,s)},s),{cancel:()=>{r&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||Q()){const e=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((()=>this.processTask(r,t)),e&&e.metadata||{type:"message"})}else this.processTask(r,t)}processTask(e,t){if("<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Ro(t.error)):r(null,Ro(t.data)))}else{const r=new Set,n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Mo(t):null,data:Mo(n,r)},r)}:e=>{},i=Ro(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],i.source,i.scope)[e[1]](i,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class fT{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=N();const r=this.workerPool.acquire(this.id);for(let e=0;e<r.length;e++){const n=new fT.Actor(r[e],t,this.id);n.name=`Worker ${e}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,r){I(this.actors,((r,n)=>{r.send(e,t,n)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}fT.Actor=hT;class pT extends At{constructor(e,t,r,n){super(),this.scope=r,this._options=e,this.properties=new as(t),this._transitionable=new es(t,new Map(n)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const mT=new us({color:new os(St.properties_light_ambient.color),intensity:new os(St.properties_light_ambient.intensity)}),gT=new us({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([e,t]){const r=K([1,e,t]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:Hn(e.x,t.x,r),y:Hn(e.y,t.y,r),z:Hn(e.z,t.z,r)}}}(St.properties_light_directional.direction),color:new os(St.properties_light_directional.color),intensity:new os(St.properties_light_directional.intensity),"cast-shadows":new os(St.properties_light_directional["cast-shadows"]),"shadow-intensity":new os(St.properties_light_directional["shadow-intensity"])});class _T{constructor(e,t,r,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,t){let r,n;if(e instanceof y||"number"==typeof e[0]){const i=y.convert(e);r=[i],n=t.isPointAboveHorizon(i)}else{const i=y.convert(e[0]),a=y.convert(e[1]);r=[i,a],n=P(i,a).every((e=>t.isPointAboveHorizon(e)))}return new _T(r,t.getCameraPoint(),n,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return P(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const t=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new y(1,1)):this.screenBounds[1],n=P(t,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(n[3]=this.cameraPoint)),function(e,t){const r=[];for(let n=0;n<e.length;n++){const i=L(n-1,-1,e.length-1),a=L(n+1,-1,e.length-1),o=e[n],s=e[a],l=e[i].sub(o).unit(),u=s.sub(o).unit(),c=u.angleWithSep(l.x,l.y),d=l.add(u).unit().mult(-1*t/Math.sin(c/2));r.push(o.add(d))}return r}(n,e)}bufferedCameraGeometryGlobe(e){const t=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new y(1,1)):this.screenBounds[1],n=P(t,r,e),i=this.cameraPoint.clone();switch(3*((i.y>t.y)+(i.y>r.y))+((i.x>t.x)+(i.x>r.x))){case 0:n[0]=i,n[4]=i.clone();break;case 1:n.splice(1,0,i);break;case 2:n[1]=i;break;case 3:n.splice(4,0,i);break;case 5:n.splice(2,0,i);break;case 6:n[3]=i;break;case 7:n.splice(3,0,i);break;case 8:n[2]=i}return n}containsTile(e,t,r,n=0){const i=e.queryPadding/t._pixelsPerMercatorPixel+1,a=r?this._bufferedCameraMercator(i,t):this._bufferedScreenMercator(i,t);let o=e.tileID.wrap+(a.unwrapped?n:0);const s=a.polygon.map((t=>T_(e.tileTransform,t,o)));if(!xf(s,0,0,nn,nn))return;o=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const l=this.screenGeometryMercator.polygon.map((t=>w_(e.tileTransform,t,o))),u=l.map((e=>new y(e[0],e[1]))),c=t.getFreeCameraOptions().position||new Kh(0,0,0),d=w_(e.tileTransform,c,o),h=l.map((e=>{const t=Td.sub(e,e,d);return Td.normalize(t,t),new Fd(d,t)})),f=Hv(e,1,t.zoom)*t._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:h,bufferedTilespaceGeometry:s,bufferedTilespaceBounds:(p=S(s),p.min.x=C(p.min.x,0,nn),p.min.y=C(p.min.y,0,nn),p.max.x=C(p.max.x,0,nn),p.max.y=C(p.max.y,0,nn),p),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:f};var p}_bufferedScreenMercator(e,t){const r=bT(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,t){const r=bT(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(e,t){const r=function(e,t){const r=gd.multiply([],t.pixelMatrix,t.globeMatrix),n=[0,-Wd,0,1],i=[0,Wd,0,1],a=[0,0,0,1];ld.transformMat4(n,n,r),ld.transformMat4(i,i,r),ld.transformMat4(a,a,r);const o=new y(n[0]/n[3],n[1]/n[3]),s=new y(i[0]/i[3],i[1]/i[3]),l=bf(e,o)&&n[3]<a[3],u=bf(e,s)&&i[3]<a[3];if(!l&&!u)return null;const c=function(e,t,r){for(let n=1;n<e.length;n++){const i=vT(t.pointCoordinate3D(e[n-1]).x),a=vT(t.pointCoordinate3D(e[n]).x);if(r<0){if(i<a)return{idx:n,t:-i/(a-1-i)}}else if(a<i)return{idx:n,t:(1-i)/(a+1-i)}}return null}(e,t,l?-1:1);if(!c)return null;const{idx:d,t:h}=c;let f=d>1?yT(e.slice(0,d),t):[],p=d<e.length?yT(e.slice(d),t):[];f=f.map((e=>new y(vT(e.x),e.y))),p=p.map((e=>new y(vT(e.x),e.y)));const m=[...f];0===m.length&&m.push(p[p.length-1]);const g=Hn(m[m.length-1].y,(0===p.length?f[0]:p[0]).y,h);let _;return _=l?[new y(0,g),new y(0,0),new y(1,0),new y(1,g)]:[new y(1,g),new y(1,1),new y(0,1),new y(0,g)],m.push(..._),0===p.length?m.push(f[0]):m.push(...p),{polygon:m.map((e=>new Kh(e.x,e.y))),unwrapped:!1}}(e,t);if(r)return r;const n=function(e,t){let r=!1,n=-1/0,i=0;for(let t=0;t<e.length-1;t++)e[t].x>n&&(n=e[t].x,i=t);for(let t=0;t<e.length-1;t++){const n=(i+t)%(e.length-1),a=e[n],o=e[n+1];Math.abs(a.x-o.x)>.5&&(a.x<o.x?(a.x+=1,0===n&&(e[e.length-1].x+=1)):(o.x+=1,n+1===e.length-1&&(e[0].x+=1)),r=!0)}const a=Uh(t.center.lng);return r&&a<Math.abs(a-1)&&e.forEach((e=>{e.x-=1})),{polygon:e,unwrapped:r}}(yT(e,t).map((e=>new y(vT(e.x),e.y))),t);return{polygon:n.polygon.map((e=>new Kh(e.x,e.y))),unwrapped:n.unwrapped}}}function yT(e,t){return Qh(e,(e=>{const r=t.pointCoordinate3D(e);e.x=r.x,e.y=r.y}),1/256)}function vT(e){return e<0?1+e%1:e%1}function bT(e){return 100*e|0}function xT(e,t,r,n,i){const a=function(r,n){if(r)return i(r);if(n){e.url&&n.tiles&&e.tiles&&delete e.tiles;const r=B(k(n,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),r.tiles=t.canonicalizeTileset(r,e.url),i(null,r)}};return e.url?Te(t.transformRequest(t.normalizeSourceURL(e.url,null,r,n),ye.Source),a):st.frame((()=>a(null,e)))}class TT{constructor(e,t,r){this.bounds=Zl.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=Math.pow(2,e.z),r=Math.floor(Uh(this.bounds.getWest())*t),n=Math.floor(jh(this.bounds.getNorth())*t),i=Math.ceil(Uh(this.bounds.getEast())*t),a=Math.ceil(jh(this.bounds.getSouth())*t);return e.x>=r&&e.x<i&&e.y>=n&&e.y<a}}class wT{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new zf({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=U(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,a=e[0]*r,o=!0;n.push({left:i,right:a,isDash:o,zeroLength:0===e[0]});let s=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];i=s*r,s+=l,a=s*r,n.push({left:i,right:a,isDash:o,zeroLength:0===l})}return n}addRoundDash(e,t,r){const n=t/2;for(let t=-r;t<=r;t++){const i=this.width*(this.nextRow+r+t);let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const l=Math.abs(s-o.left),u=Math.abs(s-o.right),c=Math.min(l,u);let d;const h=t/r*(n+1);if(o.isDash){const e=n-Math.abs(h);d=Math.sqrt(c*c+e*e)}else d=n-Math.sqrt(c*c+h*h);this.image.data[i+s]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const r=e[t],n=e[t+1];r.zeroLength?e.splice(t,1):n&&n.isDash===r.isDash&&(n.left=r.left,e.splice(t,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let a=0,o=e[a];for(let r=0;r<this.width;r++){r/o.right>1&&(o=e[++a]);const n=Math.abs(r-o.left),s=Math.abs(r-o.right),l=Math.min(n,s);this.image.data[i+r]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,a=2*i+1;if(this.nextRow+a>this.height)return X("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let t=0;t<e.length;t++)e[t]<0&&(X("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),o+=e[t];if(0!==o){const r=this.width/o,a=this.getDashRanges(e,this.width,r);n?this.addRoundDash(a,r,i):this.addRegularDash(a,"square"===t?.5*r:0)}const s=this.nextRow+i;this.nextRow+=a;const l={tl:[s,i],br:[o,0]};return this.positions[r]=l,l}}Ao(wT,"LineAtlas");const ET=1*Wg;class AT{constructor(e){const t={},r=[];for(const n in e){const i=e[n],a=t[n]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?ET:1,o={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(o),a[e]=o}}const{w:n,h:i}=mg(r),a=new zf({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const o=t[r][e],s=i.metrics.localGlyph?ET:1;zf.copy(i.bitmap,a,{x:0,y:0},{x:o.x+s,y:o.y+s},i.bitmap)}}this.image=a,this.positions=t}}Ao(AT,"GlyphAtlas");class ST{constructor(e){this.tileID=new Dd(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=b_(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,t,r,n,i){this.status="parsing",this.data=e,this.collisionBoxArray=new Ks;const a=new tm(Object.keys(e.layers).sort()),o=new Gm(this.tileID,this.promoteId);o.bucketLayerIDs=[];const s={},l=new wT(256,256),u={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:r,brightness:this.brightness},c=t.familiesBySource[this.source];for(const t in c){const n=e.layers[t];if(!n)continue;let i=!1,l=!1,d=!1;for(const e of c[t])"symbol"===e[0].type?i=!0:l=!0,e[0].is3D()&&"model"!==e[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&X(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=a.encode(t),f=[];for(let e=0;e<n.length;e++){const r=n.feature(e),i=o.getId(r,t);f.push({feature:r,id:i,index:e,sourceLayerIndex:h})}for(const e of c[t]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(PT(e,this.zoom,u.brightness,r),(s[t.id]=t.createBucket({index:o.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,projection:this.projection.spec})).populate(f,u,this.tileID.canonical,this.tileTransform),o.bucketLayerIDs.push(e.map((e=>e.id)))))}}let d,h,f,p;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(d)return i(d);if(this.extraShadowCaster)this.status="done",i(null,{buckets:D(s).filter((e=>!e.isEmpty())),featureIndex:o,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:u.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(h&&f&&p){const e=new AT(h),t=new yg(f,p);for(const n in s){const i=s[n];i instanceof oy?(PT(i.layers,this.zoom,u.brightness,r),u_(i,h,e.positions,f,t.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):i.hasPattern&&(i instanceof fy||i instanceof Op||i instanceof ux)&&(PT(i.layers,this.zoom,u.brightness,r),i.addFeatures(u,this.tileID.canonical,t.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",i(null,{buckets:D(s).filter((e=>!e.isEmpty())),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,brightness:u.brightness})}};if(!this.extraShadowCaster){const e=V(u.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(e).length?n.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((e,t)=>{d||(d=e,h=t,g())}),void 0,!1,m):h={};const t=Object.keys(u.iconDependencies);t.length?n.send("getImages",{icons:t,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{d||(d=e,f=t,g())}),void 0,!1,m):f={};const r=Object.keys(u.patternDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{d||(d=e,p=t,g())}),void 0,!1,m):p={}}g()}}function PT(e,t,r,n){const i=new Ko(t,{brightness:r});for(const t of e)t.recalculate(i,n)}class MT{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add((()=>{n(e,r)}),t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r(((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,n)}),t):e(r,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{i.result||(i.callbacks=i.callbacks.filter((e=>e!==n)),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}}function RT(e,t,r){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=we(e.request,((e,n,i,a)=>{e?t(e):n&&t(null,{vectorTile:r?void 0:new Jp(new Em(n)),rawData:n,cacheControl:i,expires:a})}));return()=>{n.cancel(),t()}}),t)}class CT extends At{constructor(e,t,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,k(this,B(t,["url","scheme","tileSize","promoteId"])),this._options=k({type:"vector"},t),this._collectResourceTiming=!!t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new MT}load(e){this._loaded=!1,this.fire(new wt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=xT(this._options,this.map._requestManager,t,r,((n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new Et(n))):i&&(k(this,i),i.bounds&&(this.tileBounds=new TT(i.bounds,this.minzoom,this.maxzoom)),ze(i.tiles,this.map._requestManager._customAccessToken),this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new wt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=cs(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return k({},this._options)}loadTile(e,t){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,ye.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:st.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=t:e.request=e.actor.send("reloadTile",n,i.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",n,i.bind(this),void 0,!0);else{const t=RT.call({deduped:this._deduped},n,((t,r)=>{t||!r?i.call(this,t):(n.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},e.actor&&e.actor.send("loadTile",n,i.bind(this),void 0,!0))}),!0);e.request={cancel:t}}function i(r,n){return delete e.request,e.aborted?t(null):r&&404!==r.status?t(r):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),_e(this.dispatcher),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class OT extends At{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=k({type:"raster"},t),k(this,B(t,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new wt("dataloading",{dataType:"source"})),this._tileJSONRequest=xT(this._options,this.map._requestManager,null,null,((t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new Et(t)):r&&(k(this,r),r.bounds&&(this.tileBounds=new TT(r.bounds,this.minzoom,this.maxzoom)),ze(r.tiles),this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new wt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(t)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=cs(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return k({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const r=st.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=Me(this.map._requestManager.transformRequest(n,ye.Tile),((r,n,i,a)=>(delete e.request,e.aborted?(e.state="unloaded",t(null)):r?(e.state="errored",t(r)):n?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:i,expires:a}),e.setTexture(n,this.map.painter),e.state="loaded",_e(this.dispatcher),void t(null)):t(null))))}static loadTileData(e,t,r){e.setTexture(t,r)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let LT;function IT(){return null!=oM.workerClass?new oM.workerClass:new t.Worker(oM.workerUrl)}const DT="tianjingmapgl_preloaded_worker_pool";class kT{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<kT.workerCount;)this.workers.push(new IT);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[DT]}numActive(){return Object.keys(this.active).length}}let BT;function FT(){return BT||(BT=new kT),BT}kT.workerCount=2;let NT,qT,UT,jT=null;function GT(){return Q()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:qT||i.DRACO_URL}const zT=5123,VT=5126,$T={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[zT]:Uint16Array,5125:Uint32Array,[VT]:Float32Array},HT={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[zT]:"DT_UINT16",5125:"DT_UINT32",[VT]:"DT_FLOAT32"},WT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function XT(e,t,r){const n=r.json.bufferViews.length,i=r.buffers.length;t.bufferView=n,r.json.bufferViews[n]={buffer:i,byteLength:e.byteLength},r.buffers[i]=e}const YT="KHR_draco_mesh_compression";function ZT(e,t){const r=e.extensions&&e.extensions[YT];if(!r)return;const n=new UT.Decoder,i=tw(t,r.bufferView),a=new UT.Mesh;if(!n.DecodeArrayToMesh(i,i.byteLength,a))throw new Error("Failed to decode Draco mesh");const o=t.json.accessors[e.indices],s=$T[o.componentType],l=o.count*s.BYTES_PER_ELEMENT,u=UT._malloc(l);s===Uint16Array?n.GetTrianglesUInt16Array(a,l,u):n.GetTrianglesUInt32Array(a,l,u),XT(UT.memory.buffer.slice(u,u+l),o,t),UT._free(u);for(const i of Object.keys(r.attributes)){const o=n.GetAttributeByUniqueId(a,r.attributes[i]),s=t.json.accessors[e.attributes[i]],l=HT[s.componentType],u=s.count*WT[s.type]*$T[s.componentType].BYTES_PER_ELEMENT,c=UT._malloc(u);n.GetAttributeDataArrayForAllPoints(a,o,UT[l],u,c),XT(UT.memory.buffer.slice(c,c+u),s,t),UT._free(c)}n.destroy(),a.destroy(),delete e.extensions[YT]}const KT=1179937895,JT=new TextDecoder("utf8");function QT(e,t){return new URL(e,t).href}function ew(e,t,r,n){return fetch(QT(e.uri,n)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[r]=e}))}function tw(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function rw(e,r,n,i){if(e.uri){const a=QT(e.uri,i);return fetch(a).then((e=>e.blob())).then((e=>t.createImageBitmap(e))).then((e=>{r.images[n]=e}))}if(void 0!==e.bufferView){const i=tw(r,e.bufferView),a=new t.Blob([i],{type:e.mimeType});return t.createImageBitmap(a).then((e=>{r.images[n]=e}))}}function nw(e,t=0,r){const n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===KT){const r=new Uint32Array(e,t);let i=2;const a=(r[i++]>>2)-3,o=r[i++]>>2;if(i++,n.json=JSON.parse(JT.decode(r.subarray(i,i+o))),i+=o,i<a){const a=r[i++];i++;const o=t+(i<<2);n.buffers[0]=e.slice(o,o+a)}}else n.json=JSON.parse(JT.decode(new Uint8Array(e,t)));const{buffers:i,images:a,meshes:o,extensionsUsed:s}=n.json;let l=Promise.resolve();if(i){const e=[];for(let t=0;t<i.length;t++){const a=i[t];a.uri?e.push(ew(a,n,t,r)):n.buffers[t]||(n.buffers[t]=null)}l=Promise.all(e)}return l.then((()=>{const e=[],t=s&&s.includes(YT);if(t&&e.push(function(){if(!UT)return NT||(NT=function(e){let t,r=null;function n(){t=new Uint8Array(r.buffer)}function i(){throw new Error("Unexpected Draco error.")}const a={a:{a:i,d:function(e,r,n){return t.copyWithin(e,r,r+n)},c:function(e){const i=t.length,a=Math.max(e>>>0,Math.ceil(1.2*i)),o=Math.ceil((a-i)/65536);try{return r.grow(o),n(),!0}catch(e){return!1}},b:i}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,a):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,a)))).then((e=>{const{Rb:i,Qb:a,P:o,T:s,X:l,Ja:u,La:c,Qa:d,Va:h,Wa:f,eb:p,jb:m,f:g,e:_,yb:y,zb:v,Ab:b,Bb:x,Db:T,Gb:w}=e.instance.exports;r=_;const E=(()=>{let e=0,r=0,n=0,o=0;return s=>{n&&(i(o),i(e),r+=n,n=e=0),e||(r+=128,e=a(r));const l=s.length+7&-8;let u=e;l>=r&&(n=l,u=o=a(l));for(let e=0;e<s.length;e++)t[u+e]=s[e];return u}})();return n(),g(),{memory:_,_free:i,_malloc:a,Mesh:class{constructor(){this.ptr=o()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=u()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,r){const n=E(e),i=c(this.ptr,n,t,r.ptr);return!!l(i)}GetAttributeByUniqueId(e,t){return{ptr:d(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,r){h(this.ptr,e.ptr,t,r)}GetTrianglesUInt32Array(e,t,r){f(this.ptr,e.ptr,t,r)}GetAttributeDataArrayForAllPoints(e,t,r,n,i){p(this.ptr,e.ptr,t.ptr,r,n,i)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:b(),DT_UINT16:x(),DT_UINT32:T(),DT_FLOAT32:w()}}))}(fetch(GT())),NT.then((e=>{UT=e,NT=void 0})))}()),a)for(let t=0;t<a.length;t++)e.push(rw(a[t],n,t,r));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&o)for(const{primitives:e}of o)for(const t of e)ZT(t,n);return n}))}))}function iw(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>nw(t,0,e)))}class aw{constructor(e,t,r){if(this.triangleCount=t.length/3,this.min=new y(0,0),this.max=new y(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===r)return;const n=e.map((e=>e.x)),i=e.map((e=>e.y));this.min=new y(Math.min(...n),Math.min(...i)),this.max=new y(Math.max(...n),Math.max(...i));const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const o=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/o)),this.cellsY=Math.max(1,Math.ceil(a.y/o)),this.xScale=1/o,this.yScale=1/o;const s=[];for(let r=0;r<this.triangleCount;r++){const n=e[t[3*r+0]].sub(this.min),i=e[t[3*r+1]].sub(this.min),a=e[t[3*r+2]].sub(this.min),l=ow(Math.floor(Math.min(n.x,i.x,a.x)),this.xScale,this.cellsX),u=ow(Math.floor(Math.max(n.x,i.x,a.x)),this.xScale,this.cellsX),c=ow(Math.floor(Math.min(n.y,i.y,a.y)),this.yScale,this.cellsY),d=ow(Math.floor(Math.max(n.y,i.y,a.y)),this.yScale,this.cellsY),h=new y(0,0),f=new y(0,0),p=new y(0,0),m=new y(0,0);for(let e=c;e<=d;++e){h.y=f.y=e*o,p.y=m.y=(e+1)*o;for(let t=l;t<=u;++t)h.x=p.x=t*o,f.x=m.x=(t+1)*o,(Ef(n,i,a,h,f,m)||Ef(n,i,a,h,m,p))&&s.push({cellIdx:e*this.cellsX+t,triIdx:r})}}if(0===s.length)return;s.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<s.length;){const e=s[l].cellIdx,t={start:this.payload.length,len:0};for(;l<s.length&&s[l].cellIdx===e;)++t.len,this.payload.push(s[l++].triIdx);this.cells[e]=t}}query(e,t,r){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let e=0;e<this.lookup.length;e++)this.lookup[e]=0;const n=ow(e.x-this.min.x,this.xScale,this.cellsX),i=ow(t.x-this.min.x,this.xScale,this.cellsX),a=ow(e.y-this.min.y,this.yScale,this.cellsY),o=ow(t.y-this.min.y,this.yScale,this.cellsY);for(let e=a;e<=o;e++)for(let t=n;t<=i;t++){const n=this.cells[e*this.cellsX+t];if(n)for(let e=0;e<n.len;e++){const t=this.payload[n.start+e],i=Math.floor(t/8),a=1<<t%8;if(!(this.lookup[i]&a)&&(this.lookup[i]|=a,r.push(t),r.length===this.triangleCount))return}}}}function ow(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}function sw(e,t){const r=e.json.bufferViews[t.bufferView];return new $T[t.componentType](e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*WT[t.type])}function lw(e,t,r){const n=e.indices,i=e.attributes,a={};a.indexArray=new Ns;const o=t.json.accessors[n],s=o.count/3;a.indexArray.reserve(s);const l=sw(t,o);for(let e=0;e<s;e++)a.indexArray.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);a.indexArray._trim(),a.vertexArray=new Fs;const u=t.json.accessors[i.POSITION];a.vertexArray.reserve(u.count);const c=sw(t,u);for(let e=0;e<u.count;e++)a.vertexArray.emplaceBack(c[3*e],c[3*e+1],c[3*e+2]);if(a.vertexArray._trim(),a.aabb=new Vd(u.min,u.max),a.centroid=function(e,t){const r=[0,0,0],n=e.length;if(n>0){for(let i=0;i<n;i++){const n=3*e[i];r[0]+=t[n],r[1]+=t[n+1],r[2]+=t[n+2]}r[0]/=n,r[1]/=n,r[2]/=n}return r}(l,c),void 0!==i.COLOR_0){const e=t.json.accessors[i.COLOR_0],r=WT[e.type];if(e.componentType===VT){a.colorArray=3===r?new Fs:new As,a.colorArray.reserve(e.count);const n=sw(t,e);if(3===r)for(let t=0;t<e.count;t++)a.colorArray.emplaceBack(n[3*t],n[3*t+1],n[3*t+2]);else for(let t=0;t<e.count;t++)a.colorArray.emplaceBack(n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]);a.colorArray._trim()}else if(e.componentType===zT&&4===r){a.colorArray=new As,a.colorArray.resize(e.count);const r=sw(t,e),n=1/65535,i=a.colorArray.float32;for(let e=0;e<4*r.length;++e)i[e]=r[e]*n}else X(`glTF color buffer parsing for accessor ${JSON.stringify(e)} is not supported`)}if(void 0!==i.NORMAL){a.normalArray=new Fs;const e=t.json.accessors[i.NORMAL];a.normalArray.reserve(e.count);const r=sw(t,e);for(let t=0;t<e.count;t++)a.normalArray.emplaceBack(r[3*t],r[3*t+1],r[3*t+2]);a.normalArray._trim()}if(void 0!==i.TEXCOORD_0&&r.length>0){a.texcoordArray=new Hs;const e=t.json.accessors[i.TEXCOORD_0];a.texcoordArray.reserve(e.count);const r=sw(t,e);for(let t=0;t<e.count;t++)a.texcoordArray.emplaceBack(r[2*t],r[2*t+1]);a.texcoordArray._trim()}const d=e.material;return a.material=function(e,t){const{emissiveFactor:r=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:i=.5,normalTexture:a,occlusionTexture:o,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:u=[1,1,1,1],metallicFactor:c=1,roughnessFactor:d=1,baseColorTexture:h,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new ar(...u),metallicFactor:c,roughnessFactor:d,baseColorTexture:h?t[h.index]:void 0,metallicRoughnessTexture:f?t[f.index]:void 0},doubleSided:l,emissiveFactor:r,alphaMode:n,alphaCutoff:i,normalTexture:a?t[a.index]:void 0,occlusionTexture:o?t[o.index]:void 0,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==d?t.json.materials[d]:{defined:!1},r),void 0!==i._FEATURE_RGBA4444&&(a.featureData=new Uint32Array(sw(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer)),a}function uw(e,t,r){const{matrix:n,rotation:i,translation:a,scale:o,mesh:s,extras:l,children:u}=e,c={};if(c.matrix=n||gd.fromRotationTranslationScale([],i||[0,0,0,1],a||[0,0,0],o||[1,1,1]),void 0!==s){c.meshes=r[s];const e=c.anchor=[0,0];for(const t of c.meshes){const{min:r,max:n}=t.aabb;e[0]+=r[0]+n[0],e[1]+=r[1]+n[1]}e[0]=Math.floor(e[0]/c.meshes.length/2),e[1]=Math.floor(e[1]/c.meshes.length/2)}if(l&&(l.id&&(c.id=l.id),l.lights&&(c.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.codePointAt(e);return r}(e),r=[],n=t.length/24,i=new Uint16Array(t.buffer),a=new Float32Array(t.buffer);for(let e=0;e<n;e++){const t=i[2*e*6]/30,n=i[2*e*6+1]/30,o=i[2*e*6+10]/100,s=a[6*e+1],l=a[6*e+2],u=a[6*e+3],c=a[6*e+4],d=u-s,h=c-l,f=Math.hypot(d,h);r.push({pos:[s+.5*d,l+.5*h,n],normal:[h/f,-d/f,0],width:f,height:t,depth:o,points:[s,l,u,c]})}return r}(l.lights))),u){const e=[];for(const n of u)e.push(uw(t.json.nodes[n],t,r));c.children=e}return c}function cw(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,r]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let n=1;n<e.vertices.length;++n){const i=e.vertices[n];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),r.x=Math.max(r.x,i.x),r.y=Math.max(r.y,i.y)}const n=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),i=Math.max(8,n),a=new aw(e.vertices,e.indices,i);return{vertices:e.vertices,indices:e.indices,grid:a,min:t,max:r}}function dw(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const n=[];for(const e of r){if(!Array.isArray(e)||2!==e.length)continue;const t=e[0],r=e[1];"number"==typeof t&&"number"==typeof r&&n.push(new y(t,r))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let i=0;for(let e=0;e<n.length;e++){const t=n[e],r=n[(e+1)%n.length],a=n[(e+2)%n.length];i+=(t.x-r.x)*(a.y-r.y)-(a.x-r.x)*(t.y-r.y)}i>0&&n.reverse();const a=Sp(n.flatMap((e=>[e.x,e.y])),[]);return 0===a.length?null:{vertices:n,indices:a}}function hw(e){const t=[],r=[];let n=0;for(const i of e){n=t.length;const e=i.vertexArray.float32,a=i.indexArray.uint16;for(let r=0;r<i.vertexArray.length;r++)t.push(new y(e[3*r+0],e[3*r+1]));for(let e=0;e<3*i.indexArray.length;e++)r.push(a[e]+n)}if(r.length%3!=0)return null;for(let e=0;e<r.length;e+=3){const n=t[r[e+0]],i=t[r[e+1]],a=t[r[e+2]];(n.x-i.x)*(a.y-i.y)-(a.x-i.x)*(n.y-i.y)>0&&([r[e+1],r[e+2]]=[r[e+2],r[e+1]])}return{vertices:t,indices:r}}function fw(e){const r=function(e,r){const n=[],i=t.WebGL2RenderingContext;if(e.json.textures)for(const t of e.json.textures){const a={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==t.sampler&&Object.assign(a,e.json.samplers[t.sampler]),n.push({image:r[t.source],sampler:a,uploaded:!1})}return n}(e,e.images),n=function(e,t){const r=[];for(const n of e.json.meshes){const i=[];for(const r of n.primitives)i.push(lw(r,e,t));r.push(i)}return r}(e,r),{scenes:i,scene:a,nodes:o}=e.json,s=i?i[a||0].nodes:o,l=[];for(const t of s)l.push(uw(o[t],e,n));return function(e,t,r){const n={},i=new Set;for(let a=0;a<e.length;a++){const e=r[t[a]];if(!e.extras)continue;const o=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(o||s)&&i.add(a),"1.0.0"===o&&s&&(n[s]=a)}for(let a=0;a<e.length;a++){if(i.has(a))continue;const o=e[a],s=r[t[a]];if(!s.extras)continue;let l=null;o.id in n&&(l=hw(e[n[o.id]].meshes)),l||(l=dw(s)),l&&(o.footprint=cw(l))}if(i.size>0){const t=Array.from(i.values()).sort(((e,t)=>e-t));for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)}}(l,s,e.json.nodes),l}function pw(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,n=e.aabb.min[1]-1,i=gb/(e.aabb.max[0]-r+2),a=gb/(e.aabb.max[1]-n+2);for(let o=0;o<t.length;o+=3){const s=t[o+2],l=(t[o+0]-r)*i|0,u=(t[o+1]-n)*a|0;s>e.heightmap[u*gb+l]&&(e.heightmap[u*gb+l]=s)}}function mw(e,t){const r={};r.indexArray=new Ns,r.indexArray.reserve(4*e.length),r.vertexArray=new Fs,r.vertexArray.reserve(10*e.length),r.colorArray=new As,r.vertexArray.reserve(10*e.length);let n=0;for(const i of e){const e=Math.min(10,Math.max(4,1.3*i.height))*t,a=[-i.normal[1],i.normal[0],0],o=Math.min(.29,.1*i.width/i.depth),s=i.width-2*i.depth*t*(o+.01),l=Td.scaleAndAdd([],i.pos,a,s/2),u=Td.scaleAndAdd([],i.pos,a,-s/2),c=[l[0],l[1],l[2]+i.height],d=[u[0],u[1],u[2]+i.height],h=Td.scaleAndAdd([],i.normal,a,o);Td.scale(h,h,e);const f=Td.scaleAndAdd([],i.normal,a,-o);Td.scale(f,f,e),Td.add(h,l,h),Td.add(f,u,f),l[2]+=.1,u[2]+=.1,r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]),r.vertexArray.emplaceBack(l[0],l[1],l[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(l[0],l[1],l[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]);const p=s/e/2;r.colorArray.emplaceBack(-p-o,-1,p,.8),r.colorArray.emplaceBack(p+o,-1,p,.8),r.colorArray.emplaceBack(-p,0,p,1.3),r.colorArray.emplaceBack(p,0,p,1.3),r.colorArray.emplaceBack(p+o,-.8,p,.7),r.colorArray.emplaceBack(p+o,-.8,p,.7),r.colorArray.emplaceBack(0,0,p,1.3),r.colorArray.emplaceBack(0,0,p,1.3),r.colorArray.emplaceBack(p+o,-1.2,p,.8),r.colorArray.emplaceBack(p+o,-1.2,p,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const i={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=ar.white,i.pbrMetallicRoughness=a,r.material=i,r.aabb=new Vd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}Ao(aw,"TriangleGridIndex");const gw={vector:CT,raster:OT,"raster-dem":class extends OT{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-dem",this.maxzoom=22,this._options=k({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,r){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);e.request=Me(this.map._requestManager.transformRequest(n,ye.Tile),function(n,o,s,l){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:l});const r=t.ImageBitmap&&o instanceof t.ImageBitmap&&(null==LT&&(LT=t.OffscreenCanvas&&new t.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.createImageBitmap),LT),n=1-(o.width-((u=o.width)<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const c=r?o:st.getImageData(o,n),d={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:c,encoding:this.encoding,padding:n,convertToFloat:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",d,a.bind(this),void 0,!0))}var u}.bind(this));const i=this.map?.painter?.terrainUseFloatDEM();function a(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",r(null))}}_getNeighboringTiles(e){const t=e.canonical,r=Math.pow(2,t.z),n=(t.x-1+r)%r,i=0===t.x?e.wrap-1:e.wrap,a=(t.x+1+r)%r,o=t.x+1===r?e.wrap+1:e.wrap,s={};return s[new Dd(e.overscaledZ,i,t.z,n,t.y).key]={backfilled:!1},s[new Dd(e.overscaledZ,o,t.z,a,t.y).key]={backfilled:!1},t.y>0&&(s[new Dd(e.overscaledZ,i,t.z,n,t.y-1).key]={backfilled:!1},s[new Dd(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},s[new Dd(e.overscaledZ,o,t.z,a,t.y-1).key]={backfilled:!1}),t.y+1<r&&(s[new Dd(e.overscaledZ,i,t.z,n,t.y+1).key]={backfilled:!1},s[new Dd(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},s[new Dd(e.overscaledZ,o,t.z,a,t.y+1).key]={backfilled:!1}),s}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.hillshadeFBO&&(e.hillshadeFBO.destroy(),delete e.hillshadeFBO),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends At{constructor(e,t,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=t.data,this._options=k({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const i=nn/this.tileSize;this.workerOptions=k({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*i,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*i,extent:nn,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:nn,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*i,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new wt("dataloading",{dataType:"source"})),this._loaded=!1;const e=k({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(st.resolveURL(t),ye.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new Et(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new wt("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,t){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:st.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(r,n,((n,i)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):n?t(n):(e.loadVectorData(i,this.map.painter,"reloadTile"===r),t(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return k({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends jx{constructor(e,t,r,n){super(e,t,r,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,ye.Source).url);!function(e,r){const n=t.document.createElement("video");n.muted=!0,n.onloadstart=function(){r(null,n)};for(let r=0;r<e.length;r++){const i=t.document.createElement("source");Ee(e[r])||(n.crossOrigin="Anonymous"),i.src=e[r],n.appendChild(i)}}(this.urls,((e,t)=>{this._loaded=!0,e?this.fire(new Et(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Et(new Pt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new py(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:jx,model:class extends At{constructor(e,t,r,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const r=this._options.models[t],n=iw(this.map._requestManager.transformRequest(r.uri,ye.Model).url).then((e=>{if(!e)return;const n=fw(e),i=new yb(t,r.position,r.orientation,n);i.computeBoundsAndApplyParent(),this.models.push(i)})).catch((e=>{this.fire(new Et(new Error(`Could not load model ${t} from ${r.uri}: ${e.message}`)))}));e.push(n)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new Et(new Error(`Could not load models: ${e.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends At{constructor(e,t,r,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new wt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=xT(this._options,this.map._requestManager,t,r,((n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new Et(n))):i&&(k(this,i),i.bounds&&(this.tileBounds=new TT(i.bounds,this.minzoom,this.maxzoom)),ze(i.tiles,this.map._requestManager._customAccessToken),this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new wt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,ye.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",n,i.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,i.bind(this),void 0,!0);function i(r,n){return e.aborted?t(null):r&&404!==r.status?t(r):(n&&(n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(n),e.buckets={...e.buckets,...n.buckets}),e.state="loaded",void t(null))}}serialize(){return k({},this._options)}},canvas:class extends jx{constructor(e,r,n,i){super(e,r,n,i),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new Et(new Pt(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Et(new Pt(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new Et(new Pt(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.HTMLCanvasElement||this.fire(new Et(new Pt(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Et(new Pt(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.HTMLCanvasElement?this.options.canvas:t.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Et(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof my||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new py(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends At{constructor(e,t,r,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Et(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Et(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new TT(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),k(this,B(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return B(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new wt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new wt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,r){const{x:n,y:i,z:a}=e.tileID.canonical,o=new t.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:a},{signal:o.signal})).then(function(n){return delete e.request,e.aborted?(e.state="unloaded",r(null)):void 0===n?(e.state="errored",r(null)):null===n?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",r(null)):function(e){return e instanceof t.ImageData||e instanceof t.HTMLCanvasElement||e instanceof t.ImageBitmap||e instanceof t.HTMLImageElement}(n)?(this.loadTileData(e,n),e.state="loaded",void r(null)):(e.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((t=>{20!==t.code&&(e.state="errored",r(t))})),e.request.cancel=()=>o.abort()}loadTileData(e,t){OT.loadTileData(e,t,this._map.painter)}unloadTileData(e){OT.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:r,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:r,z:n})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const e=cs(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new wt("data",{dataType:"source",sourceDataType:"content"}))}}},_w=function(e,t,r,n){const i=new gw[t.type](e,t,r,n);if(i.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${i.id}`);return G(["load","abort","unload","serialize","prepare"],i),i};function yw(e,t){const r=gd.identity([]);return gd.scale(r,r,[.5*e.width,.5*-e.height,1]),gd.translate(r,r,[1,-1,0]),gd.multiply(r,r,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function vw(e,t,r,n,i,a,o,s=!1){const l=e.tilesIn(n,o,s);l.sort(xw);const u=[];for(const n of l)u.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(t,r,e._state,n,i,a,yw(e.transform,n.tile.tileID),s)});const c=function(e){const t={},r={};for(const n of e){const e=n.queryResults,i=n.wrappedTileID,a=r[i]=r[i]||{};for(const r in e){const n=e[r],i=a[r]=a[r]||{},o=t[r]=t[r]||[];for(const e of n)i[e.featureIndex]||(i[e.featureIndex]=!0,o.push(e))}}return t}(u);for(const t in c)c[t].forEach((t=>{const r=t.feature,n=r.layer;n&&"background"!==n.type&&"sky"!==n.type&&"slot"!==n.type&&(r.source=n.source,n["source-layer"]&&(r.sourceLayer=n["source-layer"]),r.state=void 0!==r.id?e.getFeatureState(n["source-layer"],r.id):{})}));return c}function bw(e,t){const r=e.getRenderableIds().map((t=>e.getTileByID(t))),n=[],i={};for(let e=0;e<r.length;e++){const a=r[e],o=a.tileID.canonical.key;i[o]||(i[o]=!0,a.querySourceFeatures(n,t))}return n}function xw(e,t){const r=e.tileID,n=t.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}class Tw{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const t=this.style._mergedLayers[e];if("fill-extrusion"===t.type)this.layers.push(t);else if("model"===t.type){const e=this.style.getLayerSource(t);e&&"batched-model"===e.type&&this.layers.push(t)}}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(let e=0;e<this.layers.length;++e){const r=this.layers[e],n=this.style.getLayerSourceCache(r);let i=1;"fill-extrusion"===r.type&&(i=r.paint.get("fill-extrusion-opacity")>0?r.paint.get("fill-extrusion-vertical-scale"):0);let a=n?n.getTile(t):null;if(!a&&n&&t.canonical.z>n.getSource().minzoom){let e=t.scaledTo(Math.min(n.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&(a=n.getTile(e),!a&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:a?a.getBucket(r):null,tileID:a?a.tileID:t,verticalScale:i})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){const i=e.symbolInstances.get(n),a=i.zOffset,o=this._getHeightAtTileOffset(t,i.tileAnchorX,i.tileAnchorY);i.zOffset=-1!==o?o:a,r||a===i.zOffset||(r=!0),e.hasAnyZOffset||0===i.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,t,r,n){let i=t,a=r;if(e.canonical.z!==n.canonical.z){const o=n.canonical,s=1/(1<<e.canonical.z-o.z);i=(t+e.canonical.x*nn)*s-o.x*nn|0,a=(r+e.canonical.y*nn)*s-o.y*nn|0}return{tileX:i,tileY:a}}_getHeightAtTileOffset(e,t,r){let n;for(let i=0;i<this.layers.length;++i){if("fill-extrusion"!==this.layers[i].type)continue;const{bucket:a,tileID:o,verticalScale:s}=this.currentBuildingBuckets[i];if(!a)continue;const{tileX:l,tileY:u}=this._mapCoordToOverlappingTile(e,t,r,o),c=a.getHeightAtTileCoord(l,u);if(c&&void 0!==c.height){if(!c.hidden)return c.height*s;n=c.height}}for(let i=0;i<this.layers.length;++i){if("model"!==this.layers[i].type)continue;const{bucket:a,tileID:o}=this.currentBuildingBuckets[i];if(!a)continue;const{tileX:s,tileY:l}=this._mapCoordToOverlappingTile(e,t,r,o),u=a.getHeightAtTileCoord(s,l);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:(u.height||0)*u.verticalScale}return-1}}var ww=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ew(e,t){const r={};for(const t in e)"ref"!==t&&(r[t]=e[t]);return ww.forEach((e=>{e in t&&(r[e]=t[e])})),r}function Aw(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Ew(e[r],t[e[r].ref]));return e}const Sw={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function Pw(e,t,r){r.push({command:Sw.addSource,args:[e,t[e]]})}function Mw(e,t,r){t.push({command:Sw.removeSource,args:[e]}),r[e]=!0}function Rw(e,t,r,n){Mw(e,r,n),Pw(e,t,r)}function Cw(e,t,r){let n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!v(e[r][n],t[r][n]))return!1;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!v(e[r][n],t[r][n]))return!1;return!0}function Ow(e,t,r,n,i,a){let o;for(o in t=t||{},e=e||{})e.hasOwnProperty(o)&&(v(e[o],t[o])||r.push({command:a,args:[n,o,t[o],i]}));for(o in t)t.hasOwnProperty(o)&&!e.hasOwnProperty(o)&&(v(e[o],t[o])||r.push({command:a,args:[n,o,t[o],i]}))}function Lw(e){return e.id}function Iw(e,t){return e[t.id]=t,e}class Dw{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=C(e,0,1);let t=1,r=this._distances[t];const n=e*this.paddedLength+this.padding;for(;r<n&&t<this._distances.length;)r=this._distances[++t];const i=t-1,a=this._distances[i],o=r-a,s=o>0?(n-a)/o:0;return this.points[i].mult(1-s).add(this.points[t].mult(s))}}class kw{constructor(e,t,r){const n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}insertCircle(e,t,r,n){this._forEachCell(t-n,r-n,t+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,t,r,n,i,a){this.boxCells[i].push(a)}_insertCircleCell(e,t,r,n,i,a){this.circleCells[i].push(a)}_query(e,t,r,n,i,a){if(r<0||e>this.width||n<0||t>this.height)return!i&&[];const o=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],n=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-n,y1:r-n,x2:t+n,y2:r+n})}return a?o.filter(a):o}return this._forEachCell(e,t,r,n,this._queryCell,o,{hitTest:i,seenUids:{box:{},circle:{}}},a),i?o.length>0:o}_queryCircle(e,t,r,n,i){const a=e-r,o=e+r,s=t-r,l=t+r;if(o<0||a>this.width||l<0||s>this.height)return!n&&[];const u=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,u,{hitTest:n,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},i),n?u.length>0:u}query(e,t,r,n,i){return this._query(e,t,r,n,!1,i)}hitTest(e,t,r,n,i){return this._query(e,t,r,n,!0,i)}hitTestCircle(e,t,r,n){return this._queryCircle(e,t,r,!0,n)}_queryCell(e,t,r,n,i,a,o,s){const l=o.seenUids,u=this.boxCells[i];if(null!==u){const i=this.bboxes;for(const c of u)if(!l.box[c]){l.box[c]=!0;const u=4*c;if(e<=i[u+2]&&t<=i[u+3]&&r>=i[u+0]&&n>=i[u+1]&&(!s||s(this.boxKeys[c]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[c],x1:i[u],y1:i[u+1],x2:i[u+2],y2:i[u+3]})}}}const c=this.circleCells[i];if(null!==c){const i=this.circles;for(const u of c)if(!l.circle[u]){l.circle[u]=!0;const c=3*u;if(this._circleAndRectCollide(i[c],i[c+1],i[c+2],e,t,r,n)&&(!s||s(this.circleKeys[u]))){if(o.hitTest)return a.push(!0),!0;{const e=i[c],t=i[c+1],r=i[c+2];a.push({key:this.circleKeys[u],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,n,i,a,o,s){const l=o.circle,u=o.seenUids,c=this.boxCells[i];if(null!==c){const e=this.bboxes;for(const t of c)if(!u.box[t]){u.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!s||s(this.boxKeys[t])))return a.push(!0),!0}}const d=this.circleCells[i];if(null!==d){const e=this.circles;for(const t of d)if(!u.circle[t]){u.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(e,t,r,n,i,a,o,s){const l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(r),d=this._convertToYCellCoord(n);for(let h=l;h<=c;h++)for(let l=u;l<=d;l++)if(i.call(this,e,t,r,n,this.xCellCount*l+h,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,n,i,a){const o=n-e,s=i-t,l=r+a;return l*l>o*o+s*s}_circleAndRectCollide(e,t,r,n,i,a,o){const s=(a-n)/2,l=Math.abs(e-(n+s));if(l>s+r)return!1;const u=(o-i)/2,c=Math.abs(t-(i+u));if(c>u+r)return!1;if(l<=s||c<=u)return!0;const d=l-s,h=c-u;return d*d+h*h<=r*r}}const Bw=100;class Fw{constructor(e,t,r=new kw(e.width+200,e.height+200,25),n=new kw(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Bw,this.screenBottomBoundary=e.height+Bw,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,r,n,i,a,o,s){let l=r.projectedAnchorX,u=r.projectedAnchorY,c=r.projectedAnchorZ;const d=r.elevation,h=r.tileID,f=e.getProjection();if(d&&h){const[e,t,n]=f.upVector(h.canonical,r.tileAnchorX,r.tileAnchorY),i=f.upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*d*i,u+=t*d*i,c+=n*d*i}const p=this.projectAndGetPerspectiveRatio(o,l,u,c,r.tileID,"globe"===f.name||!!d||this.transform.pitch>0,f),m=a*p.perspectiveRatio,g=(r.x1*t+n.x-r.padding)*m+p.point.x,_=(r.y1*t+n.y-r.padding)*m+p.point.y,y=(r.x2*t+n.x+r.padding)*m+p.point.x,v=(r.y2*t+n.y+r.padding)*m+p.point.y,b=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(g,_,y,v)||!i&&this.grid.hitTest(g,_,y,v,s)||b?{box:[],offscreen:!1,occluded:p.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p){const m=[],g=this.transform.elevation,_=e.getProjection(),v=g?g.getAtTileOffsetFunc(p,this.transform.center.lat,this.transform.worldSize,_):null,b=new y(r.tileAnchorX,r.tileAnchorY);let{x:x,y:T,z:w}=_.projectTilePoint(b.x,b.y,p.canonical);if(v){const[e,t,r]=v(b);x+=e,T+=t,w+=r}const E="globe"===_.name,A=this.projectAndGetPerspectiveRatio(o,x,T,w,p,E||!!g||this.transform.pitch>0,_),{perspectiveRatio:S}=A,P=(c?a/S:a*S)/eg,M=Jv(x,T,w,s),R=A.signedDistanceFromCamera>0?rb(P,i,r.lineOffsetX*P,r.lineOffsetY*P,!1,M,b,r,n,s,{},g&&!c?v:null,c&&!!g,_,p,c):null;let C=!1,O=!1,L=!0;if(R&&!A.occluded){const e=.5*h*S+f,r=new y(-100,-100),n=new y(this.screenRightBoundary,this.screenBottomBoundary),i=new Dw,{first:a,last:o}=R,s=a.path.length;let c=[];for(let e=s-1;e>=1;e--)c.push(a.path[e]);for(let e=1;e<o.path.length;e++)c.push(o.path[e]);const p=2.5*e;l&&(c=c.map((([e,t,r],n)=>(v&&!E&&(r=v(n<s-1?a.tilePath[s-1-n]:o.tilePath[n-s+2])[2]),Jv(e,t,r,l)))),c.some((e=>e[3]<=0))&&(c=[]));let g=[];if(c.length>0){let e=1/0,t=-1/0,i=1/0,a=-1/0;for(const r of c)e=Math.min(e,r[0]),i=Math.min(i,r[1]),t=Math.max(t,r[0]),a=Math.max(a,r[1]);t>=r.x&&e<=n.x&&a>=r.y&&i<=n.y&&(g=[c.map((e=>new y(e[0],e[1])))],(e<r.x||t>n.x||i<r.y||a>n.y)&&(g=zg(g,r.x,r.y,n.x,n.y)))}for(const r of g){i.reset(r,.25*e);let n=0;n=i.length<=.5*e?1:Math.ceil(i.paddedLength/p)+1;for(let r=0;r<n;r++){const a=r/Math.max(n-1,1),o=i.lerp(a),s=o.x+Bw,l=o.y+Bw;m.push(s,l,e,0);const c=s-e,h=l-e,f=s+e,p=l+e;if(L=L&&this.isOffscreen(c,h,f,p),O=O||this.isInsideGrid(c,h,f,p),!t&&this.grid.hitTestCircle(s,l,e,d)&&(C=!0,!u))return{circles:[],offscreen:!1,collisionDetected:C,occluded:!1}}}}return{circles:!u&&C||!O?[]:m,offscreen:L,collisionDetected:C,occluded:A.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const t=[];let r=1/0,n=1/0,i=-1/0,a=-1/0;for(const o of e){const e=new y(o.x+Bw,o.y+Bw);r=Math.min(r,e.x),n=Math.min(n,e.y),i=Math.max(i,e.x),a=Math.max(a,e.y),t.push(e)}const o=this.grid.query(r,n,i,a).concat(this.ignoredGrid.query(r,n,i,a)),s={},l={};for(const e of o){const r=e.key;void 0===s[r.bucketInstanceId]&&(s[r.bucketInstanceId]={}),s[r.bucketInstanceId][r.featureIndex]||df(t,[new y(e.x1,e.y1),new y(e.x2,e.y1),new y(e.x2,e.y2),new y(e.x1,e.y2)])&&(s[r.bucketInstanceId][r.featureIndex]=!0,void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]=[]),l[r.bucketInstanceId].push(r.featureIndex))}return l}insertCollisionBox(e,t,r,n,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,n,i){const a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:r,featureIndex:n,collisionGroupID:i};for(let t=0;t<e.length;t+=4)a.insertCircle(o,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,t,r,n,i,a,o){const s=[t,r,n,1];let l=!1;if(n||this.transform.pitch>0){if(ld.transformMat4(s,s,e),this.fogState&&i&&"globe"!==o.name){const e=function(e,t,r,n,i,a){const o=a.calculateFogTileMatrix(i),s=[t,r,n];return Td.transformMat4(s,s,o),iT(e,Td.length(s),a.pitch,a._fov)}(this.fogState,t,r,n,i.toUnwrapped(),this.transform);l=e>.9}}else ub(s,s,e);const u=s[3];return{point:new y((s[0]/u+1)/2*this.transform.width+Bw,(-s[1]/u+1)/2*this.transform.height+Bw),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&s[2]>u||l}}isOffscreen(e,t,r,n){return r<Bw||e>=this.screenRightBoundary||n<Bw||t>this.screenBottomBoundary}isInsideGrid(e,t,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=gd.identity([]);return gd.translate(e,e,[-100,-100,0]),e}}function Nw(e,t,r){const n=t.createTileMatrix(e,e.worldSize,r.toUnwrapped());return gd.multiply(new Float32Array(16),e.projMatrix,n)}function qw(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const n=r.clone();return n.setProjection(t.projection),Nw(n,t.getProjection(),e)}function Uw(e,t,r){return t.name===r.projection.name?e.projMatrix:Nw(r,t,e)}class jw{constructor(e,t,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class Gw{constructor(e,t,r,n,i,a=!1){this.text=new jw(e?e.text:null,t,r,i),this.icon=new jw(e?e.icon:null,t,n,i),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zw{constructor(e,t,r,n=!1){this.text=e,this.icon=t,this.skipFade=r,this.clipped=n}}class Vw{constructor(){this.invProjMatrix=gd.create(),this.viewportMatrix=gd.create(),this.circles=[]}}class $w{constructor(e,t,r,n,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}}class Hw{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Ww(e,t,r,n,i){const{horizontalAlign:a,verticalAlign:o}=Og(e),s=-(a-.5)*t,l=-(o-.5)*r,u=l_(e,n);return new y(s+u[0]*i,l+u[1]*i)}function Xw(e,t,r,n,i){const a=new y(e,t);return r&&a._rotate(n?i:-i),a}class Yw{constructor(e,t,r,n,i,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Fw(this.transform,i),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Hw(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,t,r,n){const i=r.getBucket(t),a=r.latestFeatureIndex;if(!i||!a||t.fqid!==i.layerIds[0])return;const o=i.layers[0].layout,s=r.collisionBoxArray,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/nn,c=r.tileID.toUnwrapped();this.transform.setProjection(i.projection);const d=(h=r.tileID,f=i.getProjection(),p=this.transform,f.name===this.projection?p.calculateProjMatrix(h.toUnwrapped()):Nw(p,f,h));var h,f,p;const m="map"===o.get("text-pitch-alignment"),g="map"===o.get("text-rotation-alignment");t.compileFilter();const _=t.dynamicFilter(),y=t.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(r),b=Zv(d,r.tileID.canonical,m,g,this.transform,i.getProjection(),v);let x=null;if(m){const e=Kv(d,r.tileID.canonical,m,g,this.transform,i.getProjection(),v);x=gd.multiply([],this.transform.labelPlaneMatrix,e)}let T=null;_&&r.latestFeatureIndex&&(T={unwrappedTileID:c,dynamicFilter:_,dynamicFilterNeedsFeature:y,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[i.bucketInstanceId]=new $w(i.bucketInstanceId,a,i.sourceLayerIndex,i.index,r.tileID);const w={bucket:i,layout:o,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:x,clippingData:T,scale:l,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:ig(i.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:ig(i.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(i.sourceID)};if(n)for(const t of i.sortKeyRanges){const{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i}=t;e.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:w})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:i.symbolInstances.length,parameters:w})}attemptAnchorPlacement(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_){const{textOffset0:y,textOffset1:v,crossTileID:b}=d,x=[y,v],T=Ww(e,r,n,x,i),w=this.collisionIndex.placeCollisionBox(f,i,t,Xw(T.x,T.y,a,o,this.transform.angle),c,s,l,u.predicate);if(m){const e=f.getSymbolInstanceIconSize(_,this.transform.zoom,d.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(f,e,m,Xw(T.x,T.y,a,o,this.transform.angle),c,s,l,u.predicate).box.length)return}if(w.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[b]&&this.prevPlacement.placements[b]&&this.prevPlacement.placements[b].text&&(t=this.prevPlacement.variableOffsets[b].anchor),this.variableOffsets[b]={textOffset:x,width:r,height:n,anchor:e,textScale:i,prevAnchor:t},this.markUsedJustification(f,e,d,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,d),this.placedOrientations[b]=p),{shift:T,placedGlyphBoxes:w}}}placeLayerBucketPart(e,t,r,n){const{bucket:i,layout:a,posMatrix:o,textLabelPlaneMatrix:s,labelToScreenMatrix:l,clippingData:u,textPixelRatio:c,holdingForFade:d,collisionBoxArray:h,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:p,collisionGroup:m}=e.parameters,g=a.get("text-optional"),_=a.get("icon-optional"),v=a.get("text-allow-overlap"),b=a.get("icon-allow-overlap"),x="map"===a.get("text-rotation-alignment"),T="map"===a.get("text-pitch-alignment"),w="viewport-y"===a.get("symbol-z-order"),E=a.get("symbol-z-elevate");this.transform.setProjection(i.projection);let A=v&&(b||!i.hasIconData()||_),S=b&&(v||!i.hasTextData()||g);!i.collisionArrays&&h&&i.deserializeCollisionBoxes(h),r&&n&&i.updateCollisionDebugBuffers(this.transform.zoom,h);const P=(e,n,h)=>{const{crossTileID:w,numVerticalGlyphVertices:E}=e;if(u){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[i.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(r,n,this.retainedQueryData[i.bucketInstanceId].tileID.canonical,new y(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[w]=new zw(!1,!1,!1,!0),void t.add(w)}if(t.has(w))return;if(d)return void(this.placements[w]=new zw(!1,!1,!1));let P=!1,M=!1,R=!0,C=!1,O=!1,L=null,I={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},k=null,B=null,F=null,N=0,q=0,U=0;h.textFeatureIndex?N=h.textFeatureIndex:e.useRuntimeCollisionCircles&&(N=e.featureIndex),h.verticalTextFeatureIndex&&(q=h.verticalTextFeatureIndex);const j=t=>{t.tileID=this.retainedQueryData[i.bucketInstanceId].tileID;const r=this.transform.elevation;t.elevation=e.zOffset+(r?r.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},G=h.textBox;if(G){j(G);const t=t=>{let r=vg.horizontal;if(i.allowVerticalPlacement&&!t&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[w];t&&(this.placedOrientations[w]=t,r=t,this.markUsedOrientation(i,r,e))}return r},r=(e,t)=>{if(i.allowVerticalPlacement&&E>0&&h.verticalTextBox){for(const r of i.writingModes)if(r===vg.vertical?(I=t(),D=I):I=e(),I&&I.box&&I.box.length)break}else I=e()};if(a.get("text-variable-anchor")){let s=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[w]){const e=this.prevPlacement.variableOffsets[w];s.indexOf(e.anchor)>0&&(s=s.filter((t=>t!==e.anchor)),s.unshift(e.anchor))}const l=(t,r,a)=>{const l=i.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),u=(t.x2-t.x1)*l+2*t.padding,d=(t.y2-t.y1)*l+2*t.padding,h=e.hasIconTextFit&&!b?r:null;h&&j(h);let g={box:[],offscreen:!1,occluded:!1};const _=v?2*s.length:s.length;for(let r=0;r<_;++r){const _=this.attemptAnchorPlacement(s[r%s.length],t,u,d,l,x,T,c,o,m,r>=s.length,e,n,i,a,h,f,p);if(_&&(g=_.placedGlyphBoxes,g&&g.box&&g.box.length)){P=!0,L=_.shift;break}}return g};r((()=>l(G,h.iconBox,vg.horizontal)),(()=>{const e=h.verticalTextBox;return e&&j(e),i.allowVerticalPlacement&&!(I&&I.box&&I.box.length)&&E>0&&e?l(e,h.verticalIconBox,vg.vertical):{box:null,offscreen:null,occluded:null}})),I&&(P=I.box,R=I.offscreen,C=I.occluded);const u=t(!(!I||!I.box));if(!P&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[w];t&&(this.variableOffsets[w]=t,this.markUsedJustification(i,t.anchor,e,u))}}else{const a=(t,r)=>{const a=i.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),s=this.collisionIndex.placeCollisionBox(i,a,t,new y(0,0),v,c,o,m.predicate);return s&&s.box&&s.box.length&&(this.markUsedOrientation(i,r,e),this.placedOrientations[w]=r),s};r((()=>a(G,vg.horizontal)),(()=>{const e=h.verticalTextBox;return i.allowVerticalPlacement&&E>0&&e?(j(e),a(e,vg.vertical)):{box:null,offscreen:null,occluded:null}})),t(!!(I&&I.box&&I.box.length))}}if(k=I,P=k&&k.box&&k.box.length>0,R=k&&k.offscreen,C=k&&k.occluded,e.useRuntimeCollisionCircles){const t=i.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),n=ng(i.textSizeData,f,t),u=a.get("text-padding");B=this.collisionIndex.placeCollisionCircles(i,v,t,i.lineVertexArray,i.glyphOffsetArray,n,o,s,l,r,T,m.predicate,e.collisionCircleDiameter*n/eg,u,this.retainedQueryData[i.bucketInstanceId].tileID),P=v||B.circles.length>0&&!B.collisionDetected,R=R&&B.offscreen,C=B.occluded}if(h.iconFeatureIndex&&(U=h.iconFeatureIndex),h.iconBox){const t=t=>{j(t);const r=e.hasIconTextFit&&L?Xw(L.x,L.y,x,T,this.transform.angle):new y(0,0),n=i.getSymbolInstanceIconSize(p,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(i,n,t,r,b,c,o,m.predicate)};D&&D.box&&D.box.length&&h.verticalIconBox?(F=t(h.verticalIconBox),M=F.box.length>0):(F=t(h.iconBox),M=F.box.length>0),R=R&&F.offscreen,O=F.occluded}const z=g||0===e.numHorizontalGlyphVertices&&0===E,V=_||0===e.numIconVertices;if(z||V?V?z||(M=M&&P):P=M&&P:M=P=M&&P,P&&k&&k.box&&this.collisionIndex.insertCollisionBox(k.box,a.get("text-ignore-placement"),i.bucketInstanceId,D&&D.box&&q?q:N,m.ID),M&&F&&this.collisionIndex.insertCollisionBox(F.box,a.get("icon-ignore-placement"),i.bucketInstanceId,U,m.ID),B&&(P&&this.collisionIndex.insertCollisionCircles(B.circles,a.get("text-ignore-placement"),i.bucketInstanceId,N,m.ID),r)){const e=i.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Vw);for(let e=0;e<B.circles.length;e+=4)t.circles.push(B.circles[e+0]),t.circles.push(B.circles[e+1]),t.circles.push(B.circles[e+2]),t.circles.push(B.collisionDetected?1:0)}const $="globe"!==i.projection.name;A=A&&($||!C),S=S&&($||!O),this.placements[w]=new zw(P||A,M||S,R||i.justReloaded),t.add(w)};if(E&&this.buildingIndex&&(this.buildingIndex.updateZOffset(i,this.retainedQueryData[i.bucketInstanceId].tileID),i.updateZOffset()),w){const e=i.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const r=e[t];P(i.symbolInstances.get(r),r,i.collisionArrays[r])}i.hasAnyZOffset&&X(`${i.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(i.hasAnyZOffset){const e=i.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const r=e[t];P(i.symbolInstances.get(r),r,i.collisionArrays[r])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)P(i.symbolInstances.get(t),t,i.collisionArrays[t]);if(r&&i.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[i.bucketInstanceId];gd.invert(e.invProjMatrix,o),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}i.justReloaded=!1}markUsedJustification(e,t,r,n){const{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:s,crossTileID:l}=r,u=c_(t),c=n===vg.vertical?s:"left"===u?i:"center"===u?a:"right"===u?o:-1;i>=0&&(e.text.placedSymbolArray.get(i).crossTileID=c>=0&&i!==c?0:l),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=c>=0&&a!==c?0:l),o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=c>=0&&o!==c?0:l),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=c>=0&&s!==c?0:l)}markUsedOrientation(e,t,r){const n=t===vg.horizontal||t===vg.horizontalOnly?t:0,i=t===vg.vertical?t:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l}=r,u=e.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=n),o>=0&&(u.get(o).placedOrientation=n),s>=0&&(u.get(s).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=i)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],a=i[e];a?(this.opacities[e]=new Gw(a,n,t.text,t.icon,null,t.clipped),r=r||t.text!==a.text.placed||t.icon!==a.icon.placed):(this.opacities[e]=new Gw(null,n,t.text,t.icon,t.skipFade,t.clipped),r=r||t.text||t.icon)}for(const e in i){const t=i[e];if(!this.opacities[e]){const i=new Gw(t,n,!1,!1);i.isHidden()||(this.opacities[e]=i,r=r||t.text.placed||t.icon.placed)}}for(const e in a)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=a[e]);for(const e in o)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=o[e]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const r=new Set;for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,n.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,n.tileID),t.updateZOffset()))}}updateBucketOpacities(e,t,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0].layout,i=!!e.layers[0].dynamicFilter(),a=new Gw(null,0,!1,!1,!0),o=n.get("text-allow-overlap"),s=n.get("icon-allow-overlap"),l=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),c="map"===n.get("text-pitch-alignment"),d=new Gw(null,0,o&&(s||!e.hasIconData()||n.get("icon-optional")),s&&(o||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const h=(e,t,r)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(r)};let f=0;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:p,numIconVertices:m}=n,g=t.has(p);let _=this.opacities[p];g?_=a:_||(_=d,this.opacities[p]=_),t.add(p);const v=o>0||s>0,b=m>0,x=this.placedOrientations[p],T=x===vg.vertical,w=x===vg.horizontal||x===vg.horizontalOnly;if(!v&&!b||_.isHidden()||f++,v){const t=iE(_.text);h(e.text,o,T?aE:t),h(e.text,s,w?aE:t);const r=_.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:u}=n,c=e.text.placedSymbolArray,d=r||T?1:0;i>=0&&(c.get(i).hidden=d),a>=0&&(c.get(a).hidden=d),l>=0&&(c.get(l).hidden=d),u>=0&&(c.get(u).hidden=r||w?1:0);const f=this.variableOffsets[p];f&&this.markUsedJustification(e,f.anchor,n,x);const m=this.placedOrientations[p];m&&(this.markUsedJustification(e,"left",n,m),this.markUsedOrientation(e,m,n))}if(b){const t=iE(_.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:i}=n,a=e.icon.placedSymbolArray,o=_.icon.isHidden()?1:0;r>=0&&(h(e.icon,m,T?aE:t),a.get(r).hidden=o),i>=0&&(h(e.icon,n.numVerticalIconVertices,w?aE:t),a.get(i).hidden=o)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const t=e.collisionArrays[r];if(t){let r=new y(0,0),a=!0;if(t.textBox||t.verticalTextBox){if(l){const e=this.variableOffsets[p];e?(r=Ww(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&r._rotate(c?this.transform.angle:-this.transform.angle)):a=!1}i&&(a=!_.clipped),t.textBox&&Zw(e.textCollisionBox.collisionVertexArray,_.text.placed,!a||T,r.x,r.y),t.verticalTextBox&&Zw(e.textCollisionBox.collisionVertexArray,_.text.placed,!a||w,r.x,r.y)}const o=a&&Boolean(!w&&t.verticalIconBox);t.iconBox&&Zw(e.iconCollisionBox.collisionVertexArray,_.icon.placed,o,n.hasIconTextFit?r.x:0,n.hasIconTextFit?r.y:0),t.verticalIconBox&&Zw(e.iconCollisionBox.collisionVertexArray,_.icon.placed,!o,n.hasIconTextFit?r.x:0,n.hasIconTextFit?r.y:0)}}}if(e.fullyClipped=0===f,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function Zw(e,t,r,n,i){e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0)}const Kw=Math.pow(2,25),Jw=Math.pow(2,24),Qw=Math.pow(2,17),eE=Math.pow(2,16),tE=Math.pow(2,9),rE=Math.pow(2,8),nE=Math.pow(2,1);function iE(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*Kw+t*Jw+r*Qw+t*eE+r*tE+t*rE+r*nE+t}const aE=0;class oE{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,r,n,i){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart),this._currentPartIndex++,i())return!0}return!1}}class sE{constructor(e,t,r,n,i,a,o,s,l){this.placement=new Yw(e,i,a,o,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,t,r,n){const i=st.now(),a=()=>{const e=st.now()-i;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const i=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=o)&&(!i.maxzoom||i.maxzoom>o)){const e=i,t=e.layout.get("symbol-z-elevate"),o=this._inProgressLayer=this._inProgressLayer||new oE(e),s=cs(i.source,i.scope);if(o.continuePlacement(t?n[s]:r[s],this.placement,this._showCollisionBoxes,i,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const lE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uE{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const i=lE[15&r];if(!i)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new uE(o,a,i,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=lE.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return cE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:a,nodeSize:o}=this,s=[0,i.length-1,0],l=[];for(;s.length;){const u=s.pop()||0,c=s.pop()||0,d=s.pop()||0;if(c-d<=o){for(let o=d;o<=c;o++){const s=a[2*o],u=a[2*o+1];s>=e&&s<=r&&u>=t&&u<=n&&l.push(i[o])}continue}const h=d+c>>1,f=a[2*h],p=a[2*h+1];f>=e&&f<=r&&p>=t&&p<=n&&l.push(i[h]),(0===u?e<=f:t<=p)&&(s.push(d),s.push(h-1),s.push(1-u)),(0===u?r>=f:n>=p)&&(s.push(h+1),s.push(c),s.push(1-u))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:a}=this,o=[0,n.length-1,0],s=[],l=r*r;for(;o.length;){const u=o.pop()||0,c=o.pop()||0,d=o.pop()||0;if(c-d<=a){for(let r=d;r<=c;r++)pE(i[2*r],i[2*r+1],e,t)<=l&&s.push(n[r]);continue}const h=d+c>>1,f=i[2*h],p=i[2*h+1];pE(f,p,e,t)<=l&&s.push(n[h]),(0===u?e-r<=f:t-r<=p)&&(o.push(d),o.push(h-1),o.push(1-u)),(0===u?e+r>=f:t+r>=p)&&(o.push(h+1),o.push(c),o.push(1-u))}return s}}function cE(e,t,r,n,i,a){if(i-n<=r)return;const o=n+i>>1;dE(e,t,o,n,i,a),cE(e,t,r,n,o-1,1-a),cE(e,t,r,o+1,i,1-a)}function dE(e,t,r,n,i,a){for(;i>n;){if(i-n>600){const o=i-n+1,s=r-n+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1);dE(e,t,r,Math.max(n,Math.floor(r-s*u/o+c)),Math.min(i,Math.floor(r+(o-s)*u/o+c)),a)}const o=t[2*r+a];let s=n,l=i;for(hE(e,t,n,r),t[2*i+a]>o&&hE(e,t,n,i);s<l;){for(hE(e,t,s,l),s++,l--;t[2*s+a]<o;)s++;for(;t[2*l+a]>o;)l--}t[2*n+a]===o?hE(e,t,n,l):(l++,hE(e,t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function hE(e,t,r,n){fE(e,r,n),fE(t,2*r,2*n),fE(t,2*r+1,2*n+1)}function fE(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function pE(e,t,r,n){const i=e-r,a=t-n;return i*i+a*a}const mE=512/nn/2;class gE{constructor(e,t,r){this.tileID=e,this.bucketInstanceId=r,this.index=new uE(t.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*nn,i=e.canonical.y*nn;for(let e=0;e<t.length;e++){const{key:r,crossTileID:a,tileAnchorX:o,tileAnchorY:s}=t.get(e),l=Math.floor((n+o)*mE),u=Math.floor((i+s)*mE);this.index.add(l,u),this.keys.push(r),this.crossTileIDs.push(a)}this.index.finish()}findMatches(e,t,r){const n=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),i=mE/Math.pow(2,t.canonical.z-this.tileID.canonical.z),a=t.canonical.x*nn,o=t.canonical.y*nn;for(let t=0;t<e.length;t++){const s=e.get(t);if(s.crossTileID)continue;const{key:l,tileAnchorX:u,tileAnchorY:c}=s,d=Math.floor((a+u)*i),h=Math.floor((o+c)*i),f=this.index.range(d-n,h-n,d+n,h+n);for(const e of f){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!r.has(t)){r.add(t),s.crossTileID=t;break}}}}}class _E{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yE{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const r=this.indexes[e],n={};for(const e in r){const i=r[e];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}this.indexes[e]=n}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const i=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in i){const a=i[r];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,n)}else{const a=i[e.scaledTo(Number(r)).key];a&&a.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){const i=t.symbolInstances.get(e);i.crossTileID||(i.crossTileID=r.generate(),n.add(i.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new gE(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r of t.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const n=this.indexes[r];for(const i in n)e[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],t=!0)}return t}}class vE{constructor(){this.layerIndexes={},this.crossTileIDs=new _E,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,n){let i=this.layerIndexes[e.fqid];void 0===i&&(i=this.layerIndexes[e.fqid]=new yE);let a=!1;const o={};"globe"!==n.name&&i.handleWrapJump(r);for(const r of t){const t=r.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(r.tileID,t,this.crossTileIDs)&&(a=!0),o[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(a=!0),a}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}var bE="\n#define EPSILON 0.0000001\r\n#define PI 3.141592653589793\r\n#define EXTENT 8192.0\r\n#define HALF_PI PI/2.0\r\n#define QUARTER_PI PI/4.0\r\n#define RAD_TO_DEG 180.0/PI\r\n#define DEG_TO_RAD PI/180.0\r\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\r\n{\r\nreturn pow(color,vec3(1./2.2));\r\n}vec3 sRGBToLinear(vec3 srgbIn)\r\n{\r\nreturn pow(srgbIn,vec3(2.2));\r\n}vec3 linearProduct(vec3 srgbIn,vec3 k)\r\n{\r\nreturn srgbIn*pow(k,vec3(1./2.2));\r\n}\n#if __VERSION__ >=300\r\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\r\n#else\r\n#define _HANDLE_WIREFRAME_DEPTH\r\n#endif\r\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\r\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\r\n_HANDLE_WIREFRAME_DEPTH;\r\n#else\r\n#define HANDLE_WIREFRAME_DEBUG\r\n#endif\r\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {\r\nfloat near=cutoff_params.x;\r\nfloat far=cutoff_params.y;\r\nfloat cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;\r\nfloat linearDepth=(depth-near)/(far-near);\r\nreturn clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);\r\n}\r\n#endif",xE="attribute highp vec3 a_pos_3f;\r\nuniform lowp mat4 u_matrix;\r\nvarying highp vec3 v_uv;\r\nvoid main() {\r\nconst mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);\r\nv_uv=half_neg_pi_around_x*a_pos_3f;\r\nvec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r\n}",TE="\n#define ELEVATION_SCALE 7.0\r\n#define ELEVATION_OFFSET 450.0\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nuniform vec3 u_tile_tl_up;\r\nuniform vec3 u_tile_tr_up;\r\nuniform vec3 u_tile_br_up;\r\nuniform vec3 u_tile_bl_up;\r\nuniform float u_tile_up_scale;\r\nvec3 elevationVector(vec2 pos) {\r\nvec2 uv=pos/EXTENT;\r\nvec3 up=normalize(mix(\r\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));\r\nreturn up*u_tile_up_scale;\r\n}\r\n#else\r\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\r\n#endif\nconst float skirtOffset=24575.0;\r\nvec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\r\n{\r\nfloat skirt=float(posWithComposedSkirt.x >=skirtOffset);\r\nvec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);\r\nreturn vec3(pos,skirt);\r\n}\r\n#ifdef TERRAIN\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nuniform highp sampler2D u_dem;\r\nuniform highp sampler2D u_dem_prev;\r\n#else\r\nuniform highp sampler2D u_dem;\r\nuniform highp sampler2D u_dem_prev;\r\n#endif\r\nuniform vec4 u_dem_unpack;\r\nuniform vec2 u_dem_tl;\r\nuniform vec2 u_dem_tl_prev;\r\nuniform float u_dem_scale;\r\nuniform float u_dem_scale_prev;\r\nuniform float u_dem_size;uniform float u_dem_lerp;\r\nuniform float u_exaggeration;\r\nuniform float u_meter_to_dem;\r\nuniform mat4 u_label_plane_matrix_inv;\r\nuniform sampler2D u_depth;\r\nuniform vec2 u_depth_size_inv;\r\nvec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {\r\nvec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;\r\nvec2 f=fract(pos);\r\nreturn vec4((pos-f+0.5)/(dem_size+2.0),f);\r\n}\r\nfloat decodeElevation(vec4 v) {\r\nreturn dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);\r\n}\r\nfloat currentElevation(vec2 apos) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);\r\nreturn u_exaggeration*texture(u_dem,pos).r;\r\n#else\r\nfloat dd=1.0/(u_dem_size+2.0);\r\nvec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);\r\nvec2 pos=r.xy;\r\nvec2 f=r.zw;\r\nfloat tl=decodeElevation(texture2D(u_dem,pos));\r\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));\r\nfloat bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));\r\nfloat br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));\r\nreturn u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r\n#endif\r\n}\r\nfloat prevElevation(vec2 apos) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);\r\nreturn u_exaggeration*texture(u_dem_prev,pos).r;\r\n#else\r\nfloat dd=1.0/(u_dem_size+2.0);\r\nvec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);\r\nvec2 pos=r.xy;\r\nvec2 f=r.zw;\r\nfloat tl=decodeElevation(texture2D(u_dem_prev,pos));\r\nfloat tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));\r\nfloat bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));\r\nfloat br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));\r\nreturn u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r\n#endif\r\n}\r\n#ifdef TERRAIN_VERTEX_MORPHING\r\nfloat elevation(vec2 apos) {\r\n#ifdef ZERO_EXAGGERATION\r\nreturn 0.0;\r\n#endif\r\nfloat nextElevation=currentElevation(apos);\r\nfloat prevElevation=prevElevation(apos);\r\nreturn mix(prevElevation,nextElevation,u_dem_lerp);\r\n}\r\n#else\r\nfloat elevation(vec2 apos) {\r\n#ifdef ZERO_EXAGGERATION\r\nreturn 0.0;\r\n#endif\r\nreturn currentElevation(apos);\r\n}\r\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\r\n{\r\nconst highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r\nreturn dot(rgba_depth,bit_shift)*2.0-1.0;\r\n}\r\nbool isOccluded(vec4 frag) {\r\nvec3 coord=frag.xyz/frag.w;\r\nfloat depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));\r\nreturn coord.z > depth+0.0005;\r\n}\r\nfloat occlusionFade(vec4 frag) {\r\nvec3 coord=frag.xyz/frag.w;\r\nvec3 df=vec3(5.0*u_depth_size_inv,0.0);\r\nvec2 uv=0.5*coord.xy+0.5;\r\nvec4 depth=vec4(\r\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\r\n);\r\nreturn dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));\r\n}vec4 fourSample(vec2 pos,vec2 off) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nfloat tl=texture(u_dem,pos).r;\r\nfloat tr=texture(u_dem,pos+vec2(off.x,0.0)).r;\r\nfloat bl=texture(u_dem,pos+vec2(0.0,off.y)).r;\r\nfloat br=texture(u_dem,pos+off).r;\r\n#else\r\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);\r\nfloat tl=dot(demtl,u_dem_unpack);\r\nvec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);\r\nfloat tr=dot(demtr,u_dem_unpack);\r\nvec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);\r\nfloat bl=dot(dembl,u_dem_unpack);\r\nvec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);\r\nfloat br=dot(dembr,u_dem_unpack);\r\n#endif\r\nreturn vec4(tl,tr,bl,br);\r\n}\r\nfloat flatElevation(vec2 pack) {\r\nvec2 apos=floor(pack/8.0);\r\nvec2 span=10.0*(pack-apos*8.0);\r\nvec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;\r\nfloat size=u_dem_size+2.0;\r\nfloat dd=1.0/size;\r\nvec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;\r\nvec2 f=fract(pos);\r\npos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));\r\nfloat z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);\r\nvec2 w=floor(0.5*(span*u_meter_to_dem-1.0));\r\nvec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));\r\nvec4 diff=abs(h.xzxy-h.ywzw);\r\nvec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));\r\nvec2 fix=slope*span;\r\nfloat base=z+max(fix.x,fix.y);\r\nreturn u_exaggeration*base;\r\n}\r\nfloat elevationFromUint16(float word) {\r\nreturn u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);\r\n}\n#else\r\nfloat elevation(vec2 pos) { return 0.0; }\r\nbool isOccluded(vec4 frag) { return false; }\r\nfloat occlusionFade(vec4 frag) { return 1.0; }\r\n#endif",wE="#ifdef FOG\r\nuniform mediump vec4 u_fog_color;\r\nuniform mediump vec2 u_fog_range;\r\nuniform mediump float u_fog_horizon_blend;\r\nuniform mediump mat4 u_fog_matrix;\r\nvarying vec3 v_fog_pos;\r\nfloat fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r\n}float fog_horizon_blending(vec3 camera_dir) {\r\nfloat t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r\n}float fog_opacity(float t) {\r\nconst float decay=6.0;\r\nfloat falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r\n}\r\nvec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;\r\n}\r\nvec3 fog_position(vec2 pos) {\r\nreturn fog_position(vec3(pos,0.0));\r\n}\r\nfloat fog(vec3 pos) {\r\nfloat depth=length(pos);\r\nfloat opacity=fog_opacity(fog_range(depth));\r\nreturn opacity*fog_horizon_blending(pos/depth);\r\n}\r\n#endif",EE="#ifdef FOG\r\nuniform mediump vec4 u_fog_color;\r\nuniform mediump vec2 u_fog_range;\r\nuniform mediump float u_fog_horizon_blend;\r\nuniform mediump vec2 u_fog_vertical_limit;\r\nuniform mediump float u_fog_temporal_offset;\r\nvarying vec3 v_fog_pos;\r\nuniform highp vec3 u_frustum_tl;\r\nuniform highp vec3 u_frustum_tr;\r\nuniform highp vec3 u_frustum_br;\r\nuniform highp vec3 u_frustum_bl;\r\nuniform highp vec3 u_globe_pos;\r\nuniform highp float u_globe_radius;\r\nuniform highp vec2 u_viewport;\r\nuniform float u_globe_transition;\r\nuniform int u_is_globe;\r\nfloat fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r\n}float fog_horizon_blending(vec3 camera_dir) {\r\nfloat t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r\n}float fog_opacity(float t) {\r\nconst float decay=6.0;\r\nfloat falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r\n}\r\nfloat globe_glow_progress() {\r\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\r\nhighp vec3 ray_dir=mix(\r\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r\nhighp vec3 dir=normalize(ray_dir);\r\nhighp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r\nhighp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;\r\nreturn sdf+PI*0.5;\r\n}float fog_opacity(vec3 pos) {\r\nfloat depth=length(pos);\r\nreturn fog_opacity(fog_range(depth));\r\n}\r\nvec3 fog_apply(vec3 color,vec3 pos) {\r\nfloat depth=length(pos);\r\nfloat opacity;\r\nif (u_is_globe==1) {\r\nfloat glow_progress=globe_glow_progress();\r\nfloat t=mix(glow_progress,depth,u_globe_transition);\r\nopacity=fog_opacity(fog_range(t));\r\n} else {\r\nopacity=fog_opacity(fog_range(depth));\r\nopacity*=fog_horizon_blending(pos/depth);\r\n}\r\nreturn mix(color,u_fog_color.rgb,opacity);\r\n}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {\r\nfloat alpha=EPSILON+color.a;\r\ncolor.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;\r\nreturn color;\r\n}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {\r\nfloat horizon_blend=fog_horizon_blending(normalize(camera_ray));\r\nreturn mix(sky_color,u_fog_color.rgb,horizon_blend);\r\n}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {\r\nfloat alpha=EPSILON+color.a;\r\ncolor.rgb=fog_apply(color.rgb/alpha,pos)*alpha;\r\nreturn color;\r\n}\r\nvec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {\r\nfloat verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));\r\nreturn mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));\r\n}\r\nvec3 fog_dither(vec3 color) {\r\n#ifdef FOG_DITHERING\r\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;\r\nreturn dither(color,dither_seed);\r\n#else\r\nreturn color;\r\n#endif\r\n}\r\nvec4 fog_dither(vec4 color) {\r\nreturn vec4(fog_dither(color.rgb),color.a);\r\n}\r\n#endif",AE="#ifdef RENDER_SHADOWS\r\nuniform mediump vec3 u_shadow_direction;\r\nuniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {\r\nfloat tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);\r\nfloat dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;\r\nreturn n*dotScale;\r\n}\r\nvec3 shadow_normal_offset_model(vec3 normal) {\r\nfloat dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;\r\nreturn normal*dotScale;\r\n}\r\nfloat shadow_normal_offset_multiplier0() {\r\nreturn u_shadow_normal_offset[1];\r\n}\r\nfloat shadow_normal_offset_multiplier1() {\r\nreturn u_shadow_normal_offset[2];\r\n}\r\n#endif//RENDER_SHADOWS",SE="#ifdef RENDER_SHADOWS\r\n#if defined(NATIVE) && __VERSION__ >=300\r\n#define TEXTURE_GATHER\r\n#endif\r\n#ifdef DEPTH_TEXTURE\r\nuniform highp sampler2D u_shadowmap_0;\r\nuniform highp sampler2D u_shadowmap_1;\r\n#else\r\nuniform sampler2D u_shadowmap_0;\r\nuniform sampler2D u_shadowmap_1;\r\n#endif\r\nuniform float u_shadow_intensity;\r\nuniform float u_shadow_map_resolution;\r\nuniform float u_shadow_texel_size;\r\nuniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;\r\nuniform mediump vec3 u_shadow_direction;\r\nuniform highp vec3 u_shadow_bias;\r\nhighp float shadow_sample_1(highp vec2 uv,highp float compare) {\r\nhighp float shadow_depth;\r\n#ifdef DEPTH_TEXTURE\r\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\r\n#else\r\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\r\n#endif\r\nreturn step(shadow_depth,compare);\r\n}\r\nhighp float shadow_sample_0(highp vec2 uv,highp float compare) {\r\nhighp float shadow_depth;\r\n#ifdef DEPTH_TEXTURE\r\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\r\n#else\r\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\r\n#endif\r\nreturn step(shadow_depth,compare);\r\n}\r\nfloat shadow_occlusion_1(highp vec4 pos,highp float bias) {\r\nhighp vec2 uv=pos.xy;\r\nreturn shadow_sample_1(uv,pos.z-bias);\r\n}\r\nfloat shadow_occlusion_0(highp vec4 pos,highp float bias) {\r\nhighp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\r\nhighp vec2 uv=pos.xy;\r\nhighp vec4 samples=textureGather(u_shadowmap_0,uv,0);\r\nlowp vec4 stepSamples=step(samples,vec4(compare0));\r\n#else\r\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);\r\nhighp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);\r\nhighp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);\r\nhighp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);\r\nlowp vec4 stepSamples=vec4(\r\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\r\n);\r\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));\r\nlowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);\r\nreturn mix(lerpx.x,lerpx.y,f.y);\r\n}\r\nfloat shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\r\n#ifdef SHADOWS_SINGLE_CASCADE\r\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;\r\nreturn shadow_occlusion_0(light_view_pos0,bias);\r\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;\r\nlight_view_pos1.xyz/=light_view_pos1.w;\r\nvec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);\r\nvec4 abs_bounds=abs(uv);\r\nif (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {\r\nlight_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r\nreturn shadow_occlusion_0(light_view_pos0,bias);\r\n}\r\nif (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {\r\nreturn 0.0;\r\n}\r\nlight_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;\r\nfloat occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\r\n#endif\n}\r\nhighp float calculate_shadow_bias(float NDotL) {\r\n#ifdef NORMAL_OFFSET\r\nreturn 0.5*u_shadow_bias.x;\r\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\r\n#endif\r\n}\r\nfloat shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r\nfloat NDotL=dot(N,u_shadow_direction);\r\nfloat bias=calculate_shadow_bias(NDotL);\r\nfloat occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r\nreturn mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r\n}\r\nfloat shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r\nfloat NDotL=dot(N,u_shadow_direction);\r\nfloat bias=0.0;\r\nfloat occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r\nreturn mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r\n}\r\nfloat shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r\nfloat bias=0.0;\r\nfloat occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r\nreturn 1.0-(u_shadow_intensity*occlusion);\r\n}\r\nfloat shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r\nfloat bias=calculate_shadow_bias(ndotl);\r\nreturn shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r\n}\r\n#endif";const PE=[];IE(bE,PE);const ME={"_prelude_fog.vertex.glsl":wE,"_prelude_terrain.vertex.glsl":TE,"_prelude_shadow.vertex.glsl":AE,"_prelude_fog.fragment.glsl":EE,"_prelude_shadow.fragment.glsl":SE,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;\r\nuniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;\r\nuniform mediump vec3 u_ground_radiance;\r\nfloat calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;\r\nfloat dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));\r\nfloat directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;\r\nfloat vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);\r\nreturn vertical_factor*ambient_directional_factor;\r\n}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);\r\nvec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;\r\nvec3 directional_contrib=u_lighting_directional_color*dir_factor;\r\nreturn linearProduct(color,ambient_contrib+directional_contrib);\r\n}\r\nvec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {\r\nreturn vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r\n}vec3 apply_lighting(vec3 color,vec3 normal) {\r\nfloat dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r\nreturn apply_lighting(color.rgb,normal,dir_factor);\r\n}\r\nvec4 apply_lighting(vec4 color,vec3 normal) {\r\nfloat dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r\nreturn vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r\n}\r\nvec3 apply_lighting_ground(vec3 color) {\r\nreturn color*u_ground_radiance;\r\n}\r\nvec4 apply_lighting_ground(vec4 color) {\r\nreturn vec4(apply_lighting_ground(color.rgb),color.a);\r\n}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);\r\n}\r\nvec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {\r\nreturn mix(apply_lighting_ground(color),color,emissive_strength);\r\n}\r\nvec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r\nfloat occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);\r\nreturn mix(fully_occluded_color,flood_light_color,occlusion_ramp);\r\n}\r\nvec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {\r\nvec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r\nreturn mix(fully_occluded_color,unlit_color,1.0-occlusion);\r\n}\r\n#endif//LIGHTING_3D_MODE"},RE={};DE("",TE),DE(EE,wE),DE(SE,AE);const CE=DE("\n#if __VERSION__ >=300\r\n#define varying in\r\n#define gl_FragColor glFragColor\r\n#define texture2D texture\r\n#define textureCube texture\r\nout vec4 glFragColor;\r\n#endif\r\nhighp vec3 hash(highp vec2 p) {\r\nhighp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));\r\np3+=dot(p3,p3.yxz+19.19);\r\nreturn fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\nvec3 dither(vec3 color,highp vec2 seed) {\r\nvec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;\r\nreturn color+rnd/255.0;\r\n}\r\nhighp float unpack_depth(highp vec4 rgba_depth)\r\n{\r\nconst highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r\nreturn dot(rgba_depth,bit_shift)*2.0-1.0;\r\n}highp vec4 pack_depth(highp float ndc_z) {\r\nhighp float depth=ndc_z*0.5+0.5;\r\nconst highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\r\nconst highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\r\nhighp vec4 res=fract(depth*bit_shift);\r\nres-=res.xxyz*bit_mask;\r\nreturn res;\r\n}\r\n#ifdef INDICATOR_CUTOUT\r\nuniform vec2 u_indicator_cutout_centers;\r\nuniform vec4 u_indicator_cutout_params;\r\n#endif\nvec4 applyCutout(vec4 color) {\r\n#ifdef INDICATOR_CUTOUT\r\nfloat holeMinOpacity=u_indicator_cutout_params.x;\r\nfloat holeRadius=max(u_indicator_cutout_params.y,0.0);\r\nfloat holeAspectRatio=u_indicator_cutout_params.z;\r\nfloat fadeStart=u_indicator_cutout_params.w;\r\nfloat distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));\r\nreturn color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\r\n#else\r\nreturn color;\r\n#endif\r\n}\r\n#ifdef RENDER_CUTOFF\r\nuniform highp vec4 u_cutoff_params;\r\nvarying float v_cutoff_opacity;\r\n#endif","\n#if __VERSION__ >=300\r\n#define attribute in\r\n#define varying out\r\n#define texture2D texture\r\n#endif\r\nfloat wrap(float n,float min,float max) {\r\nfloat d=max-min;\r\nfloat w=mod(mod(n-min,d)+d,d)+min;\r\nreturn (w==min) ? max : w;\r\n}\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\r\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;\r\nvec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;\r\nmercator-=mercator_center;\r\nmercator.x=wrap(mercator.x,-0.5,0.5);\r\nvec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);\r\nmercator_tile=matrix*mercator_tile;\r\nreturn mercator_tile.xyz;\r\n#else\r\nreturn vec3(0.0);\r\n#endif\r\n}\r\nvec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\r\nreturn mix(globe,mercator,t);\r\n}\r\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {\r\nvec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));\r\nvec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));\r\nvec3 yAxis=normalize(cross(normal,xAxis));\r\nreturn mat3(xAxis,yAxis,normal);\r\n}\r\n#endif\nvec2 unpack_float(const float packedValue) {\r\nint packedIntValue=int(packedValue);\r\nint v0=packedIntValue/256;\r\nreturn vec2(v0,packedIntValue-v0*256);\r\n}\r\nvec2 unpack_opacity(const float packedOpacity) {\r\nint intOpacity=int(packedOpacity)/2;\r\nreturn vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r\n}vec4 decode_color(const vec2 encodedColor) {\r\nreturn vec4(\r\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r\n);\r\n}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r\nreturn mix(packedValue[0],packedValue[1],t);\r\n}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r\nvec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r\nvec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r\nreturn mix(minColor,maxColor,t);\r\n}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r\nvec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r\nreturn (tile_units_to_pixels*pos+offset)/pattern_size;\r\n}\r\n#ifdef RENDER_CUTOFF\r\nuniform vec4 u_cutoff_params;\r\nvarying float v_cutoff_opacity;\r\n#endif\r\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),OE=bE;var LE={background:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform vec4 u_color;\r\nuniform float u_opacity;\r\n#ifdef LIGHTING_3D_MODE\r\nvarying vec4 v_color;\r\n#endif\r\nvoid main() {\r\nvec4 out_color;\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=v_color;\r\n#else\r\nout_color=u_color;\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_lighting.glsl"\r\nattribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\n#ifdef LIGHTING_3D_MODE\r\nuniform mediump vec4 u_color;\r\nvarying vec4 v_color;\r\nuniform float u_emissive_strength;\r\n#endif\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n#ifdef LIGHTING_3D_MODE\r\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),backgroundPattern:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform vec2 u_pattern_tl;\r\nuniform vec2 u_pattern_br;\r\nuniform vec2 u_texsize;\r\nuniform float u_opacity;\r\nuniform float u_emissive_strength;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\nvec2 imagecoord=mod(v_pos,1.0);\r\nvec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);\r\nvec4 out_color=texture2D(u_image,pos);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_tile_units_to_pixels;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),circle:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nvarying vec3 v_data;\r\nvarying float v_visibility;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nuniform float u_emissive_strength;\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\r\nvec2 extrude=v_data.xy;\r\nfloat extrude_length=length(extrude);\r\nlowp float antialiasblur=v_data.z;\r\nfloat antialiased_blur=-max(blur,antialiasblur);\r\nfloat opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);\r\nfloat color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r\n);\r\nvec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\r\n#endif\r\ngl_FragColor=out_color*(v_visibility*opacity_t);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_terrain.vertex.glsl"\r\n#define NUM_VISIBILITY_RINGS 2\r\n#define INV_SQRT2 0.70710678\r\n#define ELEVATION_BIAS 0.0001\r\n#define NUM_SAMPLES_PER_RING 16\r\nuniform mat4 u_matrix;\r\nuniform mat2 u_extrude_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nattribute vec2 a_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_tile_id;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_up_dir;\r\n#endif\r\nvarying vec3 v_data;\r\nvarying float v_visibility;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {\r\nreturn extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;\r\n}\r\nfloat cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {\r\nvec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);\r\nvec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);\r\nvec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);\r\nvec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);\r\nfloat h1=elevation(c1)+ELEVATION_BIAS;\r\nfloat h2=elevation(c2)+ELEVATION_BIAS;\r\nfloat h3=elevation(c3)+ELEVATION_BIAS;\r\nfloat h4=elevation(c4)+ELEVATION_BIAS;\r\nreturn max(h4,max(h3,max(h1,h2)));\r\n}\r\nfloat circle_elevation(vec2 pos) {\r\n#if defined(TERRAIN)\r\nreturn elevation(pos)+ELEVATION_BIAS;\r\n#else\r\nreturn 0.0;\r\n#endif\r\n}\r\nvec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {\r\nvec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\r\n#ifdef PITCH_WITH_MAP\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\r\n#else\r\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\r\n#endif\r\n#else\r\nreturn projected_center+vec4(sample_offset,0,0);\r\n#endif\r\n}\r\nfloat get_sample_step() {\r\n#ifdef PITCH_WITH_MAP\r\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\r\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\r\n#endif\r\n}\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\r\nvec4 world_center;\r\nmat3 surface_vectors;\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;\r\nsurface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r\nvec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r\nvec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);\r\nvec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r\nvec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);\r\nvec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r\nvec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r\nworld_center=vec4(pos,1);\r\n#else \r\nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);\r\nworld_center=vec4(circle_center,height,1);\r\n#endif\r\nvec4 projected_center=u_matrix*world_center;\r\nfloat view_scale=0.0;\r\n#ifdef PITCH_WITH_MAP\r\n#ifdef SCALE_WITH_MAP\r\nview_scale=1.0;\r\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\r\n#endif\r\n#else\r\n#ifdef SCALE_WITH_MAP\r\nview_scale=u_camera_to_center_distance;\r\n#else\r\nview_scale=projected_center.w;\r\n#endif\r\n#endif\r\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);\r\nfloat visibility=0.0;\r\n#ifdef TERRAIN\r\nfloat step=get_sample_step();\r\nvec4 occlusion_world_center;\r\nvec4 occlusion_projected_center;\r\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);\r\nocclusion_world_center=vec4(circle_center,cantilevered_height,1);\r\nocclusion_projected_center=u_matrix*occlusion_world_center;\r\n#else\r\nocclusion_world_center=world_center;\r\nocclusion_projected_center=projected_center;\r\n#endif\r\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {\r\nfloat scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);\r\nfor(int i=0; i < NUM_SAMPLES_PER_RING; i++) {\r\nvec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;\r\nvec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);\r\nvisibility+=float(!isOccluded(frag_pos));\r\n}\r\n}\r\nvisibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\r\n#else\r\nvisibility=1.0;\r\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\r\nvisibility=1.0;\r\n#endif\r\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r\nv_data=vec3(extrude.x,extrude.y,antialiasblur);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(world_center.xyz);\r\n#endif\r\n}'),clippingMask:DE("void main() {\r\ngl_FragColor=vec4(1.0);\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n}"),heatmap:DE('#include "_prelude_fog.fragment.glsl"\r\nuniform highp float u_intensity;\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main() {\r\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r\nfloat val=weight*u_intensity*GAUSS_COEF*exp(d);\r\ngl_FragColor=vec4(val,1.0,1.0,1.0);\r\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\r\n}\r\n#endif\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_terrain.vertex.glsl"\r\n#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform float u_extrude_scale;\r\nuniform float u_opacity;\r\nuniform float u_intensity;\r\nattribute vec2 a_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_tile_id;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_up_dir;\r\n#endif\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\r\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp float weight\r\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\r\nvec3 pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;\r\nmat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r\nvec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r\nvec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);\r\nvec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r\nvec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);\r\nvec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r\npos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r\n#else\r\npos=vec3(tilePos+extrude,elevation(tilePos));\r\n#endif\r\ngl_Position=u_matrix*vec4(pos,1);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}'),heatmapTexture:DE("uniform sampler2D u_image;\r\nuniform sampler2D u_color_ramp;\r\nuniform float u_opacity;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\nfloat t=texture2D(u_image,v_pos).r;\r\nvec4 color=texture2D(u_color_ramp,vec2(t,0.5));\r\ngl_FragColor=color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(0.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}","attribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=vec4(a_pos,0,1);\r\nv_pos=a_pos*0.5+0.5;\r\n}"),collisionBox:DE("varying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nvec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;\r\ngl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));\r\n}",'#include "_prelude_terrain.vertex.glsl"\r\nattribute vec3 a_pos;\r\nattribute vec2 a_anchor_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_placed;\r\nattribute vec2 a_shift;\r\nattribute float a_size_scale;\r\nattribute vec2 a_padding;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nvec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r\ngl_Position=projectedPoint;\r\ngl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r\nv_placed=a_placed.x;\r\nv_notUsed=a_placed.y;\r\n}'),collisionCircle:DE("varying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvoid main() {\r\nfloat alpha=0.5*min(v_perspective_ratio,1.0);\r\nfloat stroke_radius=0.9*max(v_perspective_ratio,1.0);\r\nfloat distance_to_center=length(v_extrude);\r\nfloat distance_to_edge=abs(distance_to_center-v_radius);\r\nfloat opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r\nvec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r\ngl_FragColor=color*alpha*opacity_t;\r\n}","attribute vec2 a_pos_2f;\r\nattribute float a_radius;\r\nattribute vec2 a_flags;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_inv_matrix;\r\nuniform vec2 u_viewport_size;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r\nvec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r\nrayStart.xyz/=rayStart.w;\r\nrayEnd.xyz  /=rayEnd.w;\r\nhighp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r\nreturn mix(rayStart.xyz,rayEnd.xyz,t);\r\n}\r\nvoid main() {\r\nvec2 quadCenterPos=a_pos_2f;\r\nfloat radius=a_radius;\r\nfloat collision=a_flags.x;\r\nfloat vertexIdx=a_flags.y;\r\nvec2 quadVertexOffset=vec2(\r\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r\nvec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r\nvec4 clipPos=u_matrix*vec4(tilePos,1.0);\r\nhighp float camera_to_anchor_distance=clipPos.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r\nv_radius=radius;\r\nv_extrude=quadVertexExtent*padding_factor;\r\nv_perspective_ratio=collision_perspective_ratio;\r\nv_collision=collision;\r\ngl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r\n}"),debug:DE("uniform highp vec4 u_color;\r\nuniform sampler2D u_overlay;\r\nvarying vec2 v_uv;\r\nvoid main() {\r\nvec4 overlay_color=texture2D(u_overlay,v_uv);\r\ngl_FragColor=mix(u_color,overlay_color,overlay_color.a);\r\n}",'#include "_prelude_terrain.vertex.glsl"\r\nattribute vec2 a_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_pos_3;\r\n#endif\r\nvarying vec2 v_uv;\r\nuniform mat4 u_matrix;\r\nuniform float u_overlay_scale;\r\nvoid main() {float h=elevation(a_pos);\r\nv_uv=a_pos/8192.0;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\r\n#else\r\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\r\n#endif\r\n}'),fill:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nuniform float u_emissive_strength;\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\nvec4 out_color=color;\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nattribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),fillOutline:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nvarying vec2 v_pos;\r\nuniform float u_emissive_strength;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\nfloat dist=length(v_pos-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\nvec4 out_color=outline_color;\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nattribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),fillOutlinePattern:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform vec2 u_texsize;\r\nuniform sampler2D u_image;\r\nuniform float u_emissive_strength;\r\nvarying vec2 v_pos;\r\nvarying vec2 v_pos_world;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec2 imagecoord=mod(v_pos,1.0);\r\nvec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\nvec4 out_color=texture2D(u_image,pos);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_tile_units_to_pixels;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\nvarying vec2 v_pos_world;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern\r\n#pragma mapbox: define lowp float pixel_ratio\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize lowp float pixel_ratio\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nvec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r\nv_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),fillPattern:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform vec2 u_texsize;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform float u_emissive_strength;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec2 imagecoord=mod(v_pos,1.0);\r\nvec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r\nvec4 out_color=texture2D(u_image,pos);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_tile_units_to_pixels;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern\r\n#pragma mapbox: define lowp float pixel_ratio\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize lowp float pixel_ratio\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),fillExtrusion:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_shadow.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nvarying vec4 v_color;\r\n#ifdef RENDER_SHADOWS\r\nvarying highp vec4 v_pos_light_view_0;\r\nvarying highp vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#endif\r\nuniform lowp float u_opacity;\r\n#ifdef FAUX_AO\r\nuniform lowp vec2 u_ao;\r\nvarying vec2 v_ao;\r\n#endif\r\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r\nvarying vec4 v_roof_color;\r\n#endif\r\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r\nvarying highp vec3 v_normal;\r\n#endif\r\nuniform vec3 u_flood_light_color;\r\nuniform highp float u_vertical_scale;\r\nuniform float u_flood_light_intensity;\r\nuniform vec3 u_ground_shadow_factor;\r\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r\nvarying float v_flood_radius;\r\nvarying float v_has_floodlight;\r\n#endif\r\nvarying float v_height;\r\nvoid main() {\r\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r\nvec3 normal=normalize(v_normal);\r\n#endif\r\nfloat z;\r\nvec4 color=v_color;\r\n#ifdef ZERO_ROOF_RADIUS\r\nz=float(normal.z > 0.00001);\r\n#ifdef LIGHTING_3D_MODE\r\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\r\n#else\ncolor=mix(v_color,v_roof_color,z);\r\n#endif\n#endif\nfloat h=max(0.0,v_height);\r\nfloat ao_shade=1.0;\r\n#ifdef FAUX_AO\r\nfloat intensity=u_ao[0];\r\nfloat h_floors=h/(u_ao[1]*u_vertical_scale);\r\nfloat y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r\nao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r\n#ifdef ZERO_ROOF_RADIUS\r\nconcave*=(1.0-z);\r\n#endif\r\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r\nao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r\n#ifdef LIGHTING_3D_MODE\r\n#ifdef FLOOD_LIGHT\r\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\r\n#endif\n#else\ncolor.rgb*=ao_shade;\r\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\r\nfloat flood_radiance=0.0;\r\n#ifdef FLOOD_LIGHT\r\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\r\n#endif\n#ifdef RENDER_SHADOWS\r\n#ifdef FLOOD_LIGHT\r\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);\r\nfloat ndotl=max(0.0,ndotl_unclamped);\r\nfloat occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);\r\nvec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r\ncolor.rgb=mix(litColor,floodLitColor,flood_radiance);\r\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);\r\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\r\n#ifdef FLOOD_LIGHT\r\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\r\n#endif\n#endif\ncolor*=u_opacity;\r\n#endif\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\r\n#endif\r\n#ifdef RENDER_CUTOFF\r\ncolor*=v_cutoff_opacity;\r\n#endif\r\n#ifdef INDICATOR_CUTOUT\r\ncolor=applyCutout(color);\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_terrain.vertex.glsl"\r\n#include "_prelude_shadow.vertex.glsl"\r\n#include "_prelude_lighting.glsl"\r\n#if __VERSION__ >=300\r\n#ifdef RENDER_CUTOFF\r\ninvariant gl_Position;\r\n#endif\r\n#endif\r\nuniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nuniform float u_edge_radius;\r\nattribute vec4 a_pos_normal_ed;\r\nattribute vec2 a_centroid_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_tile_id;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_up_dir;\r\nuniform float u_height_lift;\r\n#endif\r\nuniform highp float u_vertical_scale;\r\nvarying vec4 v_color;\r\n#ifdef RENDER_SHADOWS\r\nuniform mat4 u_light_matrix_0;\r\nuniform mat4 u_light_matrix_1;\r\nvarying highp vec4 v_pos_light_view_0;\r\nvarying highp vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#endif\r\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r\nvarying vec4 v_roof_color;\r\n#endif\r\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r\nvarying highp vec3 v_normal;\r\n#endif\r\n#ifdef FAUX_AO\r\nuniform lowp vec2 u_ao;\r\nvarying vec2 v_ao;\r\n#endif\r\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r\nvarying float v_flood_radius;\r\nvarying float v_has_floodlight;\r\n#endif\r\nvarying float v_height;\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define highp float flood_light_wall_radius\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize highp float flood_light_wall_radius\r\nbase*=u_vertical_scale;\r\nheight*=u_vertical_scale;\r\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r\nvec3 top_up_ny=top_up_ny_start.xyz;\r\nfloat x_normal=pos_nx.z/8192.0;\r\nvec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r\nv_normal=normal;\r\n#endif\r\nbase=max(0.0,base);\r\nheight=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r\nfloat t=top_up_ny.x;\r\nvec2 centroid_pos=vec2(0.0);\r\n#if defined(HAS_CENTROID) || defined(TERRAIN)\r\ncentroid_pos=a_centroid_pos;\r\n#endif\r\nfloat ele=0.0;\r\nfloat h=0.0;\r\nfloat c_ele;\r\nvec3 pos;\r\n#ifdef TERRAIN\r\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;\r\nele=elevation(pos_nx.xy);\r\nc_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);\r\npos=vec3(pos_nx.xy,h);\r\n#else\r\nh=t > 0.0 ? height : base;\r\npos=vec3(pos_nx.xy,h);\r\n#endif\r\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;\r\nh+=lift;\r\nvec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r\nvec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);\r\nvec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;\r\npos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r\n#endif\r\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);\r\ngl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r\nh=h-ele;\r\nv_height=h;\r\n#ifdef RENDER_SHADOWS\r\nvec3 shd_pos0=pos;\r\nvec3 shd_pos1=pos;\r\n#ifdef NORMAL_OFFSET\r\nvec3 offset=shadow_normal_offset(normal);\r\nshd_pos0+=offset*shadow_normal_offset_multiplier0();\r\nshd_pos1+=offset*shadow_normal_offset_multiplier1();\r\n#endif\r\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r\nv_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r\nv_depth=gl_Position.w;\r\n#endif\r\nfloat NdotL=0.0;\r\nfloat colorvalue=0.0;\r\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r\ncolor+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {\r\nfloat r=0.84;\r\nr=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r\n}\r\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r\nfloat start=top_up_ny_start.w;\r\nfloat y_ground=1.0-clamp(t+base,0.0,1.0);\r\nfloat top_height=height;\r\n#ifdef TERRAIN\r\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r\ny_ground+=y_ground*5.0/max(3.0,top_height);\r\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);\r\nNdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\r\ntop_height+=u_height_lift;\r\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r\n#endif\n#ifdef LIGHTING_3D_MODE\r\n#ifdef FLOOD_LIGHT\r\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);\r\nv_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);\r\nv_flood_radius=flood_light_wall_radius*u_vertical_scale;\r\n#endif\nv_color=vec4(color.rgb,1.0);\r\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);\r\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_color*=u_opacity;\r\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);\r\nroofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);\r\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\r\nv_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_roof_color*=u_opacity;\r\n#endif\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n#ifdef RENDER_CUTOFF\r\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r\n#endif\r\n}'),fillExtrusionDepth:DE("varying highp float v_depth;\r\nvoid main() {\r\n#ifndef DEPTH_TEXTURE\r\ngl_FragColor=pack_depth(v_depth);\r\n#endif\r\n}",'#include "_prelude_terrain.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform float u_edge_radius;\r\nuniform float u_vertical_scale;\r\nattribute vec4 a_pos_normal_ed;\r\nattribute vec2 a_centroid_pos;\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\nvarying highp float v_depth;\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\nbase*=u_vertical_scale;\r\nheight*=u_vertical_scale;\r\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r\nbase=max(0.0,base);\r\nheight=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r\nfloat t=top_up_ny.x;\r\nvec2 centroid_pos=vec2(0.0);\r\n#if defined(HAS_CENTROID) || defined(TERRAIN)\r\ncentroid_pos=a_centroid_pos;\r\n#endif\r\nvec3 pos;\r\n#ifdef TERRAIN\r\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;\r\nfloat ele=elevation(pos_nx.xy);\r\nfloat c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);\r\npos=vec3(pos_nx.xy,h);\r\n#else\r\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\r\n#endif\r\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);\r\ngl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r\nv_depth=gl_Position.z/gl_Position.w;\r\n}'),fillExtrusionPattern:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform vec2 u_texsize;\r\nuniform sampler2D u_image;\r\n#ifdef FAUX_AO\r\nuniform lowp vec2 u_ao;\r\nvarying vec3 v_ao;\r\n#endif\r\n#ifdef LIGHTING_3D_MODE\r\nvarying vec3 v_normal;\r\n#endif\r\nvarying vec2 v_pos;\r\nvarying vec4 v_lighting;\r\nuniform lowp float u_opacity;\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\n#pragma mapbox: define mediump vec4 pattern\r\n#pragma mapbox: define highp float pixel_ratio\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize highp float pixel_ratio\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec2 imagecoord=mod(v_pos,1.0);\r\nvec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r\nvec4 out_color=texture2D(u_image,pos);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\r\n#else\r\nout_color=out_color*v_lighting;\r\n#endif\r\n#ifdef FAUX_AO\r\nfloat intensity=u_ao[0];\r\nfloat h=max(0.0,v_ao.z);\r\nfloat h_floors=h/u_ao[1];\r\nfloat y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r\nfloat shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r\nshade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r\nout_color.rgb=out_color.rgb*shade;\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\n#ifdef INDICATOR_CUTOUT\r\nout_color=applyCutout(out_color);\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_terrain.vertex.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_height_factor;\r\nuniform float u_tile_units_to_pixels;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nattribute vec4 a_pos_normal_ed;\r\nattribute vec2 a_centroid_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_tile_id;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_up_dir;\r\nuniform float u_height_lift;\r\n#endif\r\nvarying vec2 v_pos;\r\nvarying vec4 v_lighting;\r\n#ifdef FAUX_AO\r\nuniform lowp vec2 u_ao;\r\nvarying vec3 v_ao;\r\n#endif\r\n#ifdef LIGHTING_3D_MODE\r\nvarying vec3 v_normal;\r\n#endif\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\n#pragma mapbox: define mediump vec4 pattern\r\n#pragma mapbox: define highp float pixel_ratio\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize highp float pixel_ratio\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r\nmediump vec3 top_up_ny=top_up_ny_start.xyz;\r\nfloat x_normal=pos_nx.z/8192.0;\r\nvec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r\nfloat edgedistance=a_pos_normal_ed.w;\r\nvec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r\nbase=max(0.0,base);\r\nheight=max(0.0,height);\r\nfloat t=top_up_ny.x;\r\nfloat z=t > 0.0 ? height : base;\r\nvec2 centroid_pos=vec2(0.0);\r\n#if defined(HAS_CENTROID) || defined(TERRAIN)\r\ncentroid_pos=a_centroid_pos;\r\n#endif\r\nfloat ele=0.0;\r\nfloat h=z;\r\nvec3 p;\r\nfloat c_ele;\r\n#ifdef TERRAIN\r\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;\r\nele=elevation(pos_nx.xy);\r\nc_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);\r\np=vec3(pos_nx.xy,h);\r\n#else\r\np=vec3(pos_nx.xy,z);\r\n#endif\r\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;\r\nh+=lift;\r\nvec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r\nvec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));\r\nvec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;\r\np=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r\n#endif\r\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);\r\ngl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\r\nvec2 pos=normal.z==1.0\r\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);\r\nv_lighting=vec4(0.0,0.0,0.0,1.0);\r\nfloat NdotL=0.0;\r\n#ifdef LIGHTING_3D_MODE\r\nNdotL=calculate_NdotL(normal);\r\n#else\r\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);\r\nNdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\r\n#endif\r\nif (normal.y !=0.0) {\r\nfloat r=0.84;\r\n#ifndef LIGHTING_3D_MODE\r\nr=mix(0.7,0.98,1.0-u_lightintensity);\r\n#endif\nNdotL*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r\n}\r\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r\nfloat start=top_up_ny_start.w;\r\nfloat y_ground=1.0-clamp(t+base,0.0,1.0);\r\nfloat top_height=height;\r\n#ifdef TERRAIN\r\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r\ny_ground+=y_ground*5.0/max(3.0,top_height);\r\n#endif\r\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);\r\nNdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\r\ntop_height+=u_height_lift;\r\n#endif\r\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r\n#endif\r\n#ifdef LIGHTING_3D_MODE\r\nv_normal=normal;\r\n#else\r\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_lighting*=u_opacity;\r\n#endif \r\n#ifdef FOG\r\nv_fog_pos=fog_position(p);\r\n#endif\r\n}'),groundShadow:DE('#include "_prelude_shadow.fragment.glsl"\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\nuniform vec3 u_ground_shadow_factor;\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\nvoid main() {\r\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r\nvec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\r\n#ifdef RENDER_CUTOFF\r\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\r\n#endif\r\n#ifdef FOG\r\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\r\n#endif\r\n#ifdef INDICATOR_CUTOUT\r\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\r\n#endif\r\ngl_FragColor=vec4(shadow,1.0);\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_light_matrix_0;\r\nuniform mat4 u_light_matrix_1;\r\nattribute vec2 a_pos;\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0.0,1.0);\r\nv_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);\r\nv_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\r\nv_depth=gl_Position.w;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\nv_fog_opacity=fog(v_fog_pos);\r\n#endif\r\n}'),fillExtrusionGroundEffect:DE("uniform highp float u_ao_pass;\r\nuniform highp float u_opacity;\r\nuniform highp float u_flood_light_intensity;\r\nuniform highp vec3 u_flood_light_color;\r\nuniform highp float u_attenuation;\r\nuniform sampler2D u_fb;\r\nuniform float u_fb_size;\r\n#ifdef SDF_SUBPASS\r\nvarying highp vec2 v_pos;\r\nvarying highp vec4 v_line_segment;\r\nvarying highp float v_flood_light_radius_tile;\r\nvarying highp vec2 v_ao;\r\nfloat line_df(highp vec2 a,highp vec2 b,highp vec2 p) {\r\nhighp vec2 ba=b-a;\r\nhighp vec2 pa=p-a;\r\nhighp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);\r\nreturn length(pa-r*ba);\r\n}\r\n#ifdef FOG\r\nvarying highp float v_fog;\r\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\r\nvec4 color=vec4(1.0);\r\n#ifdef CLEAR_FROM_TEXTURE\r\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\r\n#endif\ngl_FragColor=color;\r\n#else\n#ifdef SDF_SUBPASS\r\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);\r\nhighp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);\r\nd/=effect_radius;\r\nd=min(d,1.0);\r\nd=1.0-pow(1.0-d,u_attenuation);\r\nhighp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);\r\nhighp float fog=1.0;\r\n#ifdef FOG\r\nfog=v_fog;\r\n#endif\n#ifdef RENDER_CUTOFF\r\nfog*=v_cutoff_opacity;\r\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\r\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\r\n#ifdef OVERDRAW_INSPECTOR\r\ncolor=vec4(1.0);\r\n#endif\r\ngl_FragColor=color;\r\nHANDLE_WIREFRAME_DEBUG;\r\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\r\nattribute highp vec4 a_pos_end;\r\nattribute highp float a_angular_offset_factor;\r\nattribute highp float a_hidden_by_landmark;\r\n#ifdef SDF_SUBPASS\r\nvarying highp vec2 v_pos;\r\nvarying highp vec4 v_line_segment;\r\nvarying highp float v_flood_light_radius_tile;\r\nvarying highp vec2 v_ao;\r\n#ifdef FOG\r\nvarying highp float v_fog;\r\n#endif\r\n#endif\r\nuniform highp float u_flood_light_intensity;\r\nuniform highp mat4 u_matrix;\r\nuniform highp float u_ao_pass;\r\nuniform highp float u_meter_to_tile;\r\nuniform highp float u_edge_radius;uniform highp vec2 u_ao;\r\n#pragma mapbox: define highp float flood_light_ground_radius\r\nconst float TANGENT_CUTOFF=4.0;\r\nconst float NORM=32767.0;\r\nvoid main() {\r\n#pragma mapbox: initialize highp float flood_light_ground_radius\r\nvec2 p=a_pos_end.xy;\r\nvec2 q=floor(a_pos_end.zw*0.5);\r\nvec2 start_bottom=a_pos_end.zw-q*2.0;\r\nfloat fl_ground_radius=flood_light_ground_radius;\r\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\r\nfl_ground_radius=abs(flood_light_ground_radius);\r\n#endif\r\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;\r\nvec2 v=normalize(q-p);\r\nfloat ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;\r\nfloat angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;\r\nfloat angular_offset=angular_offset_factor*effect_radius;\r\nfloat top=1.0-start_bottom.y;\r\nfloat side=(0.5-start_bottom.x)*2.0;\r\nvec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);\r\nvec2 perp=vec2(v.y,-v.x);\r\nvec2 extrusion_perp=perp*effect_radius*top;\r\nvec3 pos=vec3(mix(q,p,start_bottom.x),0.0);\r\npos.xy+=extrusion_parallel+extrusion_perp;\r\n#ifdef SDF_SUBPASS\r\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;\r\nv_flood_light_radius_tile=flood_radius_tile;\r\nv_ao=vec2(u_ao.x,ao_radius);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\nv_fog=1.0-fog(v_fog_pos);\r\n#endif\r\n#endif\r\nfloat hidden_by_landmark=0.0;\r\n#ifdef HAS_CENTROID\r\nhidden_by_landmark=a_hidden_by_landmark;\r\n#endif\r\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);\r\nfloat hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);\r\nhidden+=hidden_by_landmark;\r\ngl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\r\n#ifdef RENDER_CUTOFF\r\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r\n#endif\r\n}'),hillshadePrepare:DE("#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_dimension;\r\nuniform float u_zoom;\r\nuniform vec4 u_unpack;\r\nfloat getElevation(vec2 coord) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nreturn texture(u_image,coord).r/4.0;\r\n#else\nvec4 data=texture2D(u_image,coord)*255.0;\r\ndata.a=-1.0;\r\nreturn dot(data,u_unpack)/4.0;\r\n#endif\r\n}\r\nvoid main() {\r\nvec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));\r\nfloat b=getElevation(v_pos+vec2(0,-epsilon.y));\r\nfloat c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));\r\nfloat d=getElevation(v_pos+vec2(-epsilon.x,0));\r\nfloat e=getElevation(v_pos+vec2(epsilon.x,0));\r\nfloat f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));\r\nfloat g=getElevation(v_pos+vec2(0,epsilon.y));\r\nfloat h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r\nfloat exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r\nvec2 deriv=vec2(\r\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\r\n)/pow(2.0,exaggeration+(19.2562-u_zoom));\r\ngl_FragColor=clamp(vec4(\r\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_dimension;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nhighp vec2 epsilon=1.0/u_dimension;\r\nfloat scale=(u_dimension.x-2.0)/u_dimension.x;\r\nv_pos=(a_texture_pos/8192.0)*scale+epsilon;\r\n}"),hillshade:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_latrange;\r\nuniform vec2 u_light;\r\nuniform vec4 u_shadow;\r\nuniform vec4 u_highlight;\r\nuniform vec4 u_accent;\r\nuniform float u_emissive_strength;\r\nvoid main() {\r\nvec4 pixel=texture2D(u_image,v_pos);\r\nvec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r\nfloat aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r\nfloat intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r\nfloat maxValue=0.5*PI;\r\nfloat scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r\nfloat shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r\nvec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r\ngl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\r\n#ifdef LIGHTING_3D_MODE\r\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\r\n#endif\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=a_texture_pos/8192.0;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}'),line:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform float u_alpha_discard_threshold;\r\nuniform highp vec2 u_trim_offset;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying highp vec4 v_uv;\r\n#ifdef RENDER_LINE_DASH\r\nuniform sampler2D u_dash_image;\r\nvarying vec2 v_tex;\r\n#endif\r\n#ifdef RENDER_LINE_GRADIENT\r\nuniform sampler2D u_gradient_image;\r\n#endif\r\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;\r\n}\r\nuniform float u_emissive_strength;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 dash\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float border_width\r\n#pragma mapbox: define lowp vec4 border_color\r\nfloat linearstep(float edge0,float edge1,float x) {\r\nreturn  clamp((x-edge0)/(edge1-edge0),0.0,1.0);\r\n}\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize lowp vec4 dash\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float border_width\r\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\n#ifdef RENDER_LINE_DASH\r\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;\r\nfloat sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;\r\nalpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\r\n#endif\r\nhighp vec4 out_color;\r\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\r\n#else\r\nout_color=color;\r\n#endif\r\nfloat trimmed=1.0;\r\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];\r\nhighp float end=v_uv[3];\r\nhighp float trim_start=u_trim_offset[0];\r\nhighp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {\r\nif (line_progress <=trim_end && line_progress >=trim_start) {\r\nout_color=vec4(0,0,0,0);\r\ntrimmed=0.0;\r\n}\r\n}\r\n#endif\r\nif (u_alpha_discard_threshold !=0.0) {\r\nif (alpha < u_alpha_discard_threshold) {\r\ndiscard;\r\n}\r\n}\r\n#ifdef RENDER_LINE_BORDER\r\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);\r\nfloat alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);\r\nif (alpha2 < 1.) {\r\nfloat smoothAlpha=smoothstep(0.6,1.0,alpha2);\r\nif (border_color.a==0.0) {    \r\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;\r\nif (out_color.a > 0.25 && Y < 0.25) {\r\nvec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;\r\nout_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));\r\n} else {\r\nout_color.rgb*=(0.6 +0.4*smoothAlpha);\r\n}\r\n} else {\r\nout_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);\r\n}\r\n}\r\n#endif\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\nout_color*=(alpha*opacity);\r\n#ifdef INDICATOR_CUTOUT\r\nout_color=applyCutout(out_color);\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r\nattribute highp vec4 a_packed;\r\n#endif\r\n#ifdef RENDER_LINE_DASH\r\nattribute float a_linesofar;\r\n#endif\r\nuniform mat4 u_matrix;\r\nuniform mat2 u_pixels_to_tile_units;\r\nuniform vec2 u_units_to_pixels;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying highp vec4 v_uv;\r\n#ifdef RENDER_LINE_DASH\r\nuniform vec2 u_texsize;\r\nuniform float u_tile_units_to_pixels;\r\nvarying vec2 v_tex;\r\n#endif\r\n#ifdef RENDER_LINE_GRADIENT\r\nuniform float u_image_height;\r\n#endif\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 dash\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float border_width\r\n#pragma mapbox: define lowp vec4 border_color\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize lowp vec4 dash\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float border_width\r\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r\nfloat a_uv_x=a_packed[0];\r\nfloat a_split_index=a_packed[1];\r\nhighp float a_clip_start=a_packed[2];\r\nhighp float a_clip_end=a_packed[3];\r\n#ifdef RENDER_LINE_GRADIENT\r\nhighp float texel_height=1.0/u_image_height;\r\nhighp float half_texel_height=0.5*texel_height;\r\nv_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\r\n#else\r\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\r\n#endif\r\n#endif\r\n#ifdef RENDER_LINE_DASH\r\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;\r\nfloat height=dash.y;\r\nv_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\r\n#endif\r\nv_width2=vec2(outset,inset);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}'),linePattern:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_texsize;\r\nuniform float u_tile_units_to_pixels;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp vec4 pattern\r\n#pragma mapbox: define lowp float pixel_ratio\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize lowp float pixel_ratio\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\nvec2 pattern_tl=pattern.xy;\r\nvec2 pattern_br=pattern.zw;\r\nvec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r\nvec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);\r\nfloat aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nfloat x=mod(v_linesofar/pattern_size.x*aspect,1.0);\r\nfloat y=0.5*v_normal.y+0.5;\r\nvec2 texel_size=1.0/u_texsize;\r\nvec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));\r\nvec4 color=texture2D(u_image,pos);\r\n#ifdef LIGHTING_3D_MODE\r\ncolor=apply_lighting_ground(color);\r\n#endif\r\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#endif\r\ncolor*=(alpha*opacity);\r\n#ifdef INDICATOR_CUTOUT\r\ncolor=applyCutout(color);\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_linesofar;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_units_to_pixels;\r\nuniform mat2 u_pixels_to_tile_units;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 pattern\r\n#pragma mapbox: define lowp float pixel_ratio\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize mediump vec4 pattern\r\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\nv_linesofar=a_linesofar;\r\nv_width2=vec2(outset,inset);\r\nv_width=floorwidth;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}'),raster:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform float u_fade_t;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image0;\r\nuniform sampler2D u_image1;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nuniform float u_brightness_low;\r\nuniform float u_brightness_high;\r\nuniform float u_saturation_factor;\r\nuniform float u_contrast_factor;\r\nuniform vec3 u_spin_weights;\r\n#ifdef RASTER_COLOR\r\nuniform sampler2D u_color_ramp;\r\nuniform highp vec2 u_colorization_scale;\r\nuniform highp vec4 u_colorization_mix;\r\nhighp vec4 colormap (highp float value) {\r\nhighp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;\r\nhighp vec2 coords=vec2(scaled_value,0.5);\r\nreturn texture2D(u_color_ramp,coords);\r\n}\r\n#endif\r\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);\r\nvec4 color1=texture2D(u_image1,v_pos1);\r\nvec4 color;\r\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);\r\ncolor=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;\r\nif (color.a > 0.0) {\r\ncolor.rgb/=color.a;\r\n}\r\n#else\r\nif (color0.a > 0.0) {\r\ncolor0.rgb/=color0.a;\r\n}\r\nif (color1.a > 0.0) {\r\ncolor1.rgb/=color1.a;\r\n}\r\ncolor=mix(color0,color1,u_fade_t);\r\n#endif\r\ncolor.a*=u_opacity;\r\nvec3 rgb=color.rgb;rgb=vec3(\r\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r\nrgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r\nvec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r\nvec3 out_color=mix(u_high_vec,u_low_vec,rgb);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_ground(out_color);\r\n#endif\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=vec4(out_color*color.a,color.a);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_normalize_matrix;\r\nuniform mat4 u_globe_matrix;\r\nuniform vec2 u_tl_parent;\r\nuniform float u_scale_parent;\r\nuniform vec2 u_perspective_transform;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_globe_pos;\r\nattribute vec2 a_uv;\r\n#else\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\n#endif\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nvoid main() {\r\nvec2 uv;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);\r\nuv=a_uv;\r\n#ifdef FOG\r\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\r\n#endif\r\n#else\r\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);\r\ngl_Position=u_matrix*vec4(a_pos*w,0,w);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\nuv=a_texture_pos/8192.0;\r\n#endif\r\nv_pos0=uv;\r\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r\n}'),symbolIcon:DE('#include "_prelude_lighting.glsl"\r\nuniform sampler2D u_texture;\r\n#ifdef ICON_TRANSITION\r\nuniform float u_icon_transition;\r\n#endif\r\nvarying float v_fade_opacity;\r\nvarying vec2 v_tex_a;\r\n#ifdef ICON_TRANSITION\r\nvarying vec2 v_tex_b;\r\n#endif\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nlowp float alpha=opacity*v_fade_opacity;\r\nvec4 out_color;\r\n#ifdef ICON_TRANSITION\r\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);\r\nvec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;\r\nout_color=(a+b)*alpha;\r\n#else\r\nout_color=texture2D(u_texture,v_tex_a)*alpha;\r\n#endif\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_terrain.vertex.glsl"\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_tex_size;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec4 a_projected_pos;\r\nattribute float a_fade_opacity;\r\n#ifdef Z_OFFSET\r\nattribute float a_z_offset;\r\n#endif\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_globe_anchor;\r\nattribute vec3 a_globe_normal;\r\n#endif\r\n#ifdef ICON_TRANSITION\r\nattribute vec2 a_texb;\r\n#endif\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform float u_fade_change;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform vec2 u_texsize;\r\nuniform vec3 u_up_vector;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nuniform vec3 u_tile_id;\r\nuniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_camera_forward;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_ecef_origin;\r\nuniform mat4 u_tile_matrix;\r\n#endif\r\nvarying vec2 v_tex_a;\r\n#ifdef ICON_TRANSITION\r\nvarying vec2 v_tex_b;\r\n#endif\r\nvarying float v_fade_opacity;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_tex_size.xy;\r\nvec2 a_size=a_tex_size.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nvec2 a_min_font_scale=a_pixeloffset.zw/256.0;\r\nhighp float segment_angle=-a_projected_pos[3];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec2 tile_anchor=a_pos;\r\nfloat e=elevation(tile_anchor);\r\n#ifdef Z_OFFSET\r\ne+=a_z_offset;\r\n#endif\r\nvec3 h=elevationVector(tile_anchor)*e;\r\nfloat globe_occlusion_fade;\r\nvec3 world_pos;\r\nvec3 mercator_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r\nworld_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);\r\nvec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r\nvec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r\n#else\r\nworld_pos=vec3(tile_anchor,0)+h;\r\nglobe_occlusion_fade=1.0;\r\n#endif\r\nvec4 projected_point=u_matrix*vec4(world_pos,1);\r\nhighp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat font_scale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjected_point;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);\r\noffsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\r\n#else\r\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\r\n#endif\r\nvec2 a=projected_point.xy/projected_point.w;\r\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nvec4 projected_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);\r\nprojected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\r\n#else\r\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r\n#endif\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\r\n#ifdef TERRAIN\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\r\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\r\nfloat projection_transition_fade=1.0;\r\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\r\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\r\n#endif\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;\r\nfloat alpha=opacity*out_fade_opacity;\r\nfloat hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r\nvec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r\n#else\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r\n#endif\r\nv_tex_a=a_tex/u_texsize;\r\n#ifdef ICON_TRANSITION\r\nv_tex_b=a_texb/u_texsize;\r\n#endif\r\nv_fade_opacity=out_fade_opacity;\r\n}'),symbolSDF:DE('#include "_prelude_lighting.glsl"\r\n#define SDF_PX 8.0\r\nuniform sampler2D u_texture;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform bool u_is_text;\r\nuniform bool u_is_halo;\r\n#if __VERSION__ >=300\r\nflat varying float v_draw_halo;\r\n#endif\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nvec2 tex=v_data0.xy;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fade_opacity=v_data1[2];\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nbool draw_halo;\r\n#if __VERSION__ >=300\r\ndraw_halo=v_draw_halo > 0.0;\r\n#else\r\ndraw_halo=u_is_halo;\r\n#endif\r\nif (draw_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\nvec4 out_color=color*(alpha*opacity*fade_opacity);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_terrain.vertex.glsl"\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_tex_size;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec4 a_projected_pos;\r\nattribute float a_fade_opacity;\r\n#ifdef Z_OFFSET\r\nattribute float a_z_offset;\r\n#endif\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_globe_anchor;\r\nattribute vec3 a_globe_normal;\r\n#endif\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nuniform vec3 u_up_vector;\r\nuniform bool u_is_halo;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nuniform vec3 u_tile_id;\r\nuniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_camera_forward;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_ecef_origin;\r\nuniform mat4 u_tile_matrix;\r\n#endif\r\n#if __VERSION__ >=300\r\nflat varying float v_draw_halo;\r\n#endif\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_tex_size.xy;\r\nvec2 a_size=a_tex_size.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nhighp float segment_angle=-a_projected_pos[3];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec2 tile_anchor=a_pos;\r\nfloat e=elevation(tile_anchor);\r\n#ifdef Z_OFFSET\r\ne+=a_z_offset;\r\n#endif\r\nvec3 h=elevationVector(tile_anchor)*e;\r\nfloat globe_occlusion_fade;\r\nvec3 world_pos;\r\nvec3 mercator_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r\nworld_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);\r\nvec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r\nvec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r\n#else\r\nworld_pos=vec3(tile_anchor,0)+h;\r\nglobe_occlusion_fade=1.0;\r\n#endif\r\nvec4 projected_point=u_matrix*vec4(world_pos,1);\r\nhighp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetprojected_point;\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);\r\noffsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\r\n#else\r\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\r\n#endif\r\nvec2 a=projected_point.xy/projected_point.w;\r\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nvec4 projected_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);\r\nprojected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\r\n#else\r\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r\n#endif\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\r\n#ifdef TERRAIN\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\r\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\r\nfloat projection_transition_fade=1.0;\r\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\r\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\r\n#endif\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\r\nfloat alpha=opacity*out_fade_opacity;\r\nfloat hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r\nvec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r\n#else\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r\n#endif\r\nfloat gamma_scale=gl_Position.w;\r\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\r\n#endif\r\nv_data0=a_tex/u_texsize;\r\nv_data1=vec3(gamma_scale,size,out_fade_opacity);\r\n}'),symbolTextAndIcon:DE('#include "_prelude_lighting.glsl"\r\n#define SDF_PX 8.0\r\n#define SDF 1.0\r\n#define ICON 0.0\r\nuniform sampler2D u_texture;\r\nuniform sampler2D u_texture_icon;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform bool u_is_halo;\r\n#if __VERSION__ >=300\r\nflat varying float v_draw_halo;\r\n#endif\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nfloat fade_opacity=v_data1[2];\r\nif (v_data1.w==ICON) {\r\nvec2 tex_icon=v_data0.zw;\r\nlowp float alpha=opacity*fade_opacity;\r\ngl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nreturn;\r\n}\r\nvec2 tex=v_data0.xy;\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fontScale=size/24.0;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nbool draw_halo;\r\n#if __VERSION__ >=300\r\ndraw_halo=v_draw_halo > 0.0;\r\n#else\r\ndraw_halo=u_is_halo;\r\n#endif\r\nif (draw_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\nvec4 out_color=color*(alpha*opacity*fade_opacity);\r\n#ifdef LIGHTING_3D_MODE\r\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_terrain.vertex.glsl"\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_tex_size;\r\nattribute vec4 a_projected_pos;\r\nattribute float a_fade_opacity;\r\n#ifdef Z_OFFSET\r\nattribute float a_z_offset;\r\n#endif\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nattribute vec3 a_globe_anchor;\r\nattribute vec3 a_globe_normal;\r\n#endif\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nuniform vec3 u_up_vector;\r\nuniform vec2 u_texsize_icon;\r\nuniform bool u_is_halo;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nuniform vec3 u_tile_id;\r\nuniform mat4 u_inv_rot_matrix;\r\nuniform vec2 u_merc_center;\r\nuniform vec3 u_camera_forward;\r\nuniform float u_zoom_transition;\r\nuniform vec3 u_ecef_origin;\r\nuniform mat4 u_tile_matrix;\r\n#endif\r\n#if __VERSION__ >=300\r\nflat varying float v_draw_halo;\r\n#endif\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\n#pragma mapbox: define lowp float emissive_strength\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\n#pragma mapbox: initialize lowp float emissive_strength\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_tex_size.xy;\r\nvec2 a_size=a_tex_size.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nfloat is_sdf=a_size[0]-2.0*a_size_min;\r\nhighp float segment_angle=-a_projected_pos[3];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec2 tile_anchor=a_pos;\r\nfloat e=elevation(tile_anchor);\r\n#ifdef Z_OFFSET\r\ne+=a_z_offset;\r\n#endif\r\nvec3 h=elevationVector(tile_anchor)*e;\r\nfloat globe_occlusion_fade;\r\nvec3 world_pos;\r\nvec3 mercator_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r\nworld_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);\r\nvec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r\nvec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r\n#else\r\nworld_pos=vec3(tile_anchor,0)+h;\r\nglobe_occlusion_fade=1.0;\r\n#endif\r\nvec4 projected_point=u_matrix*vec4(world_pos,1);\r\nhighp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat font_scale=size/24.0;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);\r\nvec2 a=projected_point.xy/projected_point.w;\r\nvec2 b=offset_projected_point.xy/offset_projected_point.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nvec4 projected_pos;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);\r\nprojected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\r\n#else\r\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r\n#endif\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\r\n#ifdef TERRAIN\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\r\n#endif\r\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r\nfloat projection_transition_fade=1.0;\r\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\r\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\r\n#endif\r\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\r\nfloat alpha=opacity*out_fade_opacity;\r\nfloat hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r\nvec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r\n#else\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r\n#endif\r\nfloat gamma_scale=gl_Position.w;\r\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\r\n#endif\r\nv_data0.xy=a_tex/u_texsize;\r\nv_data0.zw=a_tex/u_texsize_icon;\r\nv_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);\r\n}'),terrainRaster:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_shadow.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform sampler2D u_image0;\r\nvarying vec2 v_pos0;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\n#ifdef RENDER_SHADOWS\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#endif\r\nuniform vec3 u_ground_shadow_factor;\r\nvoid main() {\r\nvec4 image_color=texture2D(u_image0,v_pos0);\r\nvec4 color;\r\n#ifdef LIGHTING_3D_MODE\r\nconst vec3 normal=vec3(0.0,0.0,1.0);\r\n#ifdef RENDER_SHADOWS\r\nfloat cutoffOpacity=1.0;\r\n#ifdef RENDER_CUTOFF\r\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\r\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);\r\nvec3 emissive_base=image_color.rgb*image_color.a;\r\nfloat ndotl=u_shadow_direction.z;\r\nfloat occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);\r\nndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));\r\nvec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r\ncolor.rgb=lit+emissive;\r\ncolor.a=1.0;\r\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);\r\ncolor=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\r\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;\r\ncolor=apply_lighting(image_color,normal,lighting_factor);\r\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);\r\ncolor.a=1.0;\r\n#endif\n#endif\n#else\ncolor=image_color;\r\n#endif\n#ifdef FOG\r\n#ifdef ZERO_EXAGGERATION\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#else\r\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\r\n#endif\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_terrain.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nuniform float u_skirt_height;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos0;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\n#ifdef RENDER_SHADOWS\r\nuniform mat4 u_light_matrix_0;\r\nuniform mat4 u_light_matrix_1;\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth;\r\n#endif\r\nvoid main() {\r\nvec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);\r\nfloat skirt=decomposedPosAndSkirt.z;\r\nvec2 decodedPos=decomposedPosAndSkirt.xy;\r\nfloat elevation=elevation(decodedPos)-skirt*u_skirt_height;\r\nv_pos0=decodedPos/8192.0;\r\ngl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\r\n#ifdef FOG\r\n#ifdef ZERO_EXAGGERATION\r\nv_fog_pos=fog_position(decodedPos);\r\n#else\r\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\r\n#endif\r\n#endif\r\n#ifdef RENDER_SHADOWS\r\nvec3 pos=vec3(decodedPos,elevation);\r\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);\r\nv_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\r\nv_depth=gl_Position.w;\r\n#endif\r\n}'),terrainDepth:DE("#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\nvarying float v_depth;\r\nvoid main() {\r\ngl_FragColor=pack_depth(v_depth);\r\n}",'#include "_prelude_terrain.vertex.glsl"\r\nuniform mat4 u_matrix;\r\nattribute vec2 a_pos;\r\nvarying float v_depth;\r\nvoid main() {\r\nfloat elevation=elevation(a_pos);\r\ngl_Position=u_matrix*vec4(a_pos,elevation,1.0);\r\nv_depth=gl_Position.z/gl_Position.w;\r\n}'),skybox:DE('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;\r\nuniform lowp samplerCube u_cubemap;\r\nuniform lowp float u_opacity;\r\nuniform highp float u_temporal_offset;\r\nuniform highp vec3 u_sun_direction;\r\nfloat sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {\r\nhighp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;\r\nconst highp float smoothstep_delta=1e-5;\r\nreturn smoothstep(\r\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);\r\n}\r\nfloat map(float value,float start,float end,float new_start,float new_end) {\r\nreturn ((value-start)*(new_end-new_start))/(end-start)+new_start;\r\n}\r\nvoid main() {\r\nvec3 uv=v_uv;const float y_bias=0.015;\r\nuv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);\r\nvec3 sky_color=textureCube(u_cubemap,uv).rgb;\r\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\r\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);\r\ngl_FragColor=vec4(sky_color*u_opacity,u_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}',xE),skyboxGradient:DE('#include "_prelude_fog.fragment.glsl"\r\nvarying highp vec3 v_uv;\r\nuniform lowp sampler2D u_color_ramp;\r\nuniform highp vec3 u_center_direction;\r\nuniform lowp float u_radius;\r\nuniform lowp float u_opacity;\r\nuniform highp float u_temporal_offset;\r\nvoid main() {\r\nfloat progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r\nvec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\r\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\r\n#endif\r\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}',xE),skyboxCapture:DE("\nvarying highp vec3 v_position;\r\nuniform highp float u_sun_intensity;\r\nuniform highp float u_luminance;\r\nuniform lowp vec3 u_sun_direction;\r\nuniform highp vec4 u_color_tint_r;\r\nuniform highp vec4 u_color_tint_m;\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\r\n#define MIE_G                   0.76\r\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\r\n#define DENSITY_STEPS           4\r\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {\r\nfloat a=dot(dir,dir);\r\nfloat b=2.0*dot(dir,orig);\r\nfloat c=dot(orig,orig)-radius*radius;\r\nfloat d=sqrt(b*b-4.0*a*c);\r\nreturn (-b+d)/(2.0*a);\r\n}\r\nvec3 extinction(vec2 density) {\r\nreturn exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));\r\n}\r\nvec2 local_density(vec3 point) {\r\nfloat height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);\r\nfloat exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);\r\nreturn vec2(exp_r,exp_m);\r\n}\r\nfloat phase_ray(float cos_angle) {\r\nreturn (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);\r\n}\r\nfloat phase_mie(float cos_angle) {\r\nreturn (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/\n((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));\r\n}\r\nvec2 density_to_atmosphere(vec3 point,vec3 light_dir) {\r\nfloat ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);\r\nfloat step_len=ray_len/float(DENSITY_STEPS);\r\nvec2 density_point_to_atmosphere=vec2(0.0);\r\nfor (int i=0; i < DENSITY_STEPS;++i) {\r\nvec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);\r\ndensity_point_to_atmosphere+=local_density(point_on_ray)*step_len;;\r\n}\r\nreturn density_point_to_atmosphere;\r\n}\r\nvec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {\r\nvec2 density_orig_to_point=vec2(0.0);\r\nvec3 scatter_r=vec3(0.0);\r\nvec3 scatter_m=vec3(0.0);\r\nvec3 origin=vec3(0.0,PLANET_RADIUS,0.0);\r\nfloat ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);\r\nfloat step_len=ray_len/float(SAMPLE_STEPS);\r\nfor (int i=0; i < SAMPLE_STEPS;++i) {\r\nvec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;\r\ndensity_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;\r\nvec3 extinction=extinction(density_orig_to_atmosphere);\r\nscatter_r+=density.x*extinction;\r\nscatter_m+=density.y*extinction;\r\n}float cos_angle=dot(ray_dir,sun_direction);\r\nfloat phase_r=phase_ray(cos_angle);\r\nfloat phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;\r\nvec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;\r\nreturn (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;\r\n}\r\nconst float A=0.15;\r\nconst float B=0.50;\r\nconst float C=0.10;\r\nconst float D=0.20;\r\nconst float E=0.02;\r\nconst float F=0.30;\r\nvec3 uncharted2_tonemap(vec3 x) {\r\nreturn ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\r\n}\r\nvoid main() {\r\nvec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;\r\nray_direction.y+=y_bias;\r\nvec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;\r\ngl_FragColor=vec4(color,1.0);\r\n}","attribute highp vec3 a_pos_3f;\r\nuniform mat3 u_matrix_3f;\r\nvarying highp vec3 v_position;\r\nfloat map(float value,float start,float end,float new_start,float new_end) {\r\nreturn ((value-start)*(new_end-new_start))/(end-start)+new_start;\r\n}\r\nvoid main() {\r\nvec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);\r\nv_position=pos.xyz;\r\nv_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);\r\ngl_Position=vec4(a_pos_3f.xy,0.0,1.0);\r\n}"),globeRaster:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform sampler2D u_image0;\r\nvarying vec2 v_pos0;\r\n#ifndef FOG\r\nuniform highp vec3 u_frustum_tl;\r\nuniform highp vec3 u_frustum_tr;\r\nuniform highp vec3 u_frustum_br;\r\nuniform highp vec3 u_frustum_bl;\r\nuniform highp vec3 u_globe_pos;\r\nuniform highp float u_globe_radius;\r\nuniform vec2 u_viewport;\r\n#endif\r\nvoid main() {\r\nvec4 color;\r\n#ifdef CUSTOM_ANTIALIASING\r\nvec2 uv=gl_FragCoord.xy/u_viewport;\r\nhighp vec3 ray_dir=mix(\r\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r\nvec3 dir=normalize(ray_dir);\r\nvec3 closest_point=dot(u_globe_pos,dir)*dir;\r\nfloat norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;\r\nconst float antialias_pixel=2.0;\r\nfloat antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);\r\nfloat antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);\r\nvec4 raster=texture2D(u_image0,v_pos0);\r\n#ifdef LIGHTING_3D_MODE\r\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r\nraster=apply_lighting_with_emission_ground(raster,raster.a);\r\ncolor=vec4(raster.rgb*antialias,antialias);\r\n#else\nraster=apply_lighting_ground(raster);\r\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\r\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\r\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\r\n#ifdef LIGHTING_3D_MODE\r\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r\ncolor=apply_lighting_with_emission_ground(color,color.a);\r\ncolor.a=1.0;\r\n#else\ncolor=apply_lighting_ground(color);\r\n#endif\n#endif\n#endif\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_terrain.vertex.glsl"\r\nuniform mat4 u_proj_matrix;\r\nuniform mat4 u_normalize_matrix;\r\nuniform mat4 u_globe_matrix;\r\nuniform mat4 u_merc_matrix;\r\nuniform float u_zoom_transition;\r\nuniform vec2 u_merc_center;\r\nuniform mat3 u_grid_matrix;\r\nuniform float u_skirt_height;\r\n#ifdef GLOBE_POLES\r\nattribute vec3 a_globe_pos;\r\nattribute vec2 a_uv;\r\n#else\r\nattribute vec2 a_pos;\n#endif\r\nvarying vec2 v_pos0;\r\nfloat mercatorXfromLng(float lng) {\r\nreturn (180.0+lng)/360.0;\r\n}\r\nfloat mercatorYfromLat(float lat) {\r\nreturn (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;\r\n}\r\nvec3 latLngToECEF(vec2 latLng) {\r\nlatLng=DEG_TO_RAD*latLng;\r\nfloat cosLat=cos(latLng[0]);\r\nfloat sinLat=sin(latLng[0]);\r\nfloat cosLng=cos(latLng[1]);\r\nfloat sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;\r\nfloat sy=-sinLat*GLOBE_RADIUS;\r\nfloat sz=cosLat*cosLng*GLOBE_RADIUS;\r\nreturn vec3(sx,sy,sz);\r\n}\r\nvoid main() {\r\n#ifdef GLOBE_POLES\r\nvec3 globe_pos=a_globe_pos;\r\nvec2 uv=a_uv;\r\n#else\nfloat tiles=u_grid_matrix[0][2];\r\nfloat idx=u_grid_matrix[1][2];\r\nfloat idy=u_grid_matrix[2][2];\r\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r\nvec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r\nfloat mercatorY=mercatorYfromLat(latLng[0]);\r\nfloat uvY=mercatorY*tiles-idy;\r\nfloat mercatorX=mercatorXfromLng(latLng[1]);\r\nfloat uvX=mercatorX*tiles-idx;\r\nvec3 globe_pos=latLngToECEF(latLng.xy);\r\nvec2 merc_pos=vec2(mercatorX,mercatorY);\r\nvec2 uv=vec2(uvX,uvY);\r\n#endif\r\nv_pos0=uv;\r\nvec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\r\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\r\n#else\r\nvec3 up_vector=elevationVector(tile_pos);\r\n#endif\r\nfloat height=elevation(tile_pos);\r\nglobe_pos+=up_vector*height;\r\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\r\n#endif\r\n#ifdef GLOBE_POLES\r\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\r\n#else\r\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r\nvec4 merc_world_pos=vec4(0.0);\r\nif (u_zoom_transition > 0.0) {\r\nmerc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);\r\nmerc_world_pos.xy-=u_merc_center;\r\nmerc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r\nmerc_world_pos=u_merc_matrix*merc_world_pos;\r\n}\r\nvec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\r\n#endif\r\ngl_Position=u_proj_matrix*interpolated_pos;\r\n#ifdef FOG\r\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r\n#endif\r\n}'),globeAtmosphere:DE('#include "_prelude_fog.fragment.glsl"\r\nuniform float u_transition;\r\nuniform highp float u_fadeout_range;\r\nuniform highp float u_temporal_offset;\r\nuniform vec4 u_color;\r\nuniform vec4 u_high_color;\r\nuniform vec4 u_space_color;\r\nuniform float u_horizon_angle;\r\nvarying highp vec3 v_ray_dir;\r\nvarying highp vec3 v_horizon_dir;\r\nvoid main() {\r\nhighp vec3 dir=normalize(v_ray_dir);\r\nfloat globe_pos_dot_dir;\r\n#ifdef PROJECTION_GLOBE_VIEW\r\nglobe_pos_dot_dir=dot(u_globe_pos,dir);\r\nhighp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;\r\nfloat norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\r\n#ifdef ALPHA_PASS\r\ngl_FragColor=vec4(0,0,0,0);\r\nreturn;\r\n#else\r\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\r\n#else\r\ngl_FragColor=vec4(0,0,0,1);\r\n#endif\r\nreturn;\r\n#endif\r\n}\r\n#endif\r\nhighp vec3 horizon_dir=normalize(v_horizon_dir);\r\nfloat horizon_angle_mercator=dir.y < horizon_dir.y ?\r\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);\r\nfloat horizon_angle;\r\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;\r\nhighp float closest_point_to_center=length(closest_point-u_globe_pos);\r\nhighp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\r\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);\r\nhorizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\r\n#else\r\nhorizon_angle=horizon_angle_mercator;\r\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);\r\nfloat alpha_0=u_color.a;\r\nfloat alpha_1=u_high_color.a;\r\nfloat alpha_2=u_space_color.a;\r\nvec3 color_stop_0=u_color.rgb;\r\nvec3 color_stop_1=u_high_color.rgb;\r\nvec3 color_stop_2=u_space_color.rgb;\r\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);\r\nfloat a1=mix(a0,1.0,alpha_0);\r\nfloat a2=mix(a0,a1,t);\r\nfloat a =mix(alpha_2,a2,t);\r\ngl_FragColor=vec4(1.0,1.0,1.0,a);\r\n#else\r\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);\r\nvec3 c1=mix(c0,color_stop_0,alpha_0);\r\nvec3 c2=mix(c0,c1,t);\r\nvec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\r\n#endif\ngl_FragColor=vec4(c*t,t);\r\n#endif\r\n}',"attribute vec3 a_pos;\r\nattribute vec2 a_uv;uniform vec3 u_frustum_tl;\r\nuniform vec3 u_frustum_tr;\r\nuniform vec3 u_frustum_br;\r\nuniform vec3 u_frustum_bl;\r\nuniform float u_horizon;\r\nvarying highp vec3 v_ray_dir;\r\nvarying highp vec3 v_horizon_dir;\r\nvoid main() {\r\nv_ray_dir=mix(\r\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);\r\nv_horizon_dir=mix(\r\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);\r\ngl_Position=vec4(a_pos,1.0);\r\n}"),model:DE('#include "_prelude_fog.fragment.glsl"\r\n#include "_prelude_shadow.fragment.glsl"\r\n#include "_prelude_lighting.glsl"\r\nuniform float u_opacity;\r\nuniform vec3 u_lightcolor;\r\nuniform vec3 u_lightpos;\r\nuniform float u_lightintensity;\r\nuniform vec4 u_baseColorFactor;\r\nuniform vec4 u_emissiveFactor;\r\nuniform float u_metallicFactor;\r\nuniform float u_roughnessFactor;\r\nuniform float u_emissive_strength;\r\nvarying highp vec4 v_position_height;\r\nvarying lowp vec4 v_color_mix;\r\n#ifdef RENDER_SHADOWS\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth_shadows;\r\n#endif\r\n#pragma mapbox: define-attribute highp vec3 normal_3f\r\n#pragma mapbox: define-attribute highp vec3 color_3f\r\n#pragma mapbox: define-attribute highp vec4 color_4f\r\n#pragma mapbox: define-attribute highp vec2 uv_2f\r\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\r\n#pragma mapbox: initialize-attribute highp vec3 color_3f\r\n#pragma mapbox: initialize-attribute highp vec4 color_4f\r\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;\r\nvarying mediump vec4 v_height_based_emission_params;\r\n#endif\r\n#ifdef HAS_TEXTURE_u_baseColorTexture\r\nuniform sampler2D u_baseColorTexture;\r\nuniform bool u_baseTextureIsAlpha;\r\nuniform bool u_alphaMask;\r\nuniform float u_alphaCutoff;\r\n#endif\r\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\r\nuniform sampler2D u_metallicRoughnessTexture;\r\n#endif\r\n#ifdef HAS_TEXTURE_u_occlusionTexture\r\nuniform sampler2D u_occlusionTexture;\r\nuniform float u_aoIntensity;\r\n#endif\r\n#ifdef HAS_TEXTURE_u_normalTexture\r\nuniform sampler2D u_normalTexture;\r\n#endif\r\n#ifdef HAS_TEXTURE_u_emissionTexture\r\nuniform sampler2D u_emissionTexture;\r\n#endif\r\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\r\nvarying highp float v_depth;\r\nuniform sampler2D u_depthTexture;\r\nuniform vec2 u_inv_depth_size;\r\nbool isOccluded() {\r\nvec2 coord=gl_FragCoord.xy*u_inv_depth_size;\r\nhighp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;\r\n}\r\n#endif\r\nconst float M_PI=3.141592653589793;\r\n#define saturate(_x) clamp(_x,0.,1.)\r\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);\r\n}\r\nvec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\r\n{\r\n#ifdef LIGHTING_3D_MODE\r\nvec3 transformed_normal=vec3(-normal.xy,normal.z);\r\nfloat lighting_factor;\r\n#ifdef RENDER_SHADOWS\r\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\r\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\r\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);\r\nvec3 c=vec3(0.03,0.03,0.03);\r\nfloat directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);\r\ndirectional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);\r\nvec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));\r\nreturn c3;\r\n#endif\n}\r\nvec4 getBaseColor() {\r\nvec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\r\nalbedo*=vec4(color_3f,1.0);\r\n#endif\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\n#else\r\n#ifdef HAS_ATTRIBUTE_a_color_4f\r\nalbedo*=color_4f;\r\n#endif\r\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\r\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);\r\nif(u_alphaMask) {\r\nif (texColor.w < u_alphaCutoff) {\r\ndiscard;\r\n}\r\n}\r\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {\r\ntexColor.rgb/=texColor.w;\r\n}\r\ntexColor.w=1.0;\r\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);\r\nif(u_baseTextureIsAlpha) {\r\nif (texColor.w < 0.5) {\r\ndiscard;\r\n}\r\nalbedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));\r\n} else {albedo*=texColor;\r\n}\r\n#endif\r\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\r\n}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\r\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));\r\nhighp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));\r\nhighp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));\r\nhighp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );\r\nhighp vec3 dp1perp=cross( N,dp1 );\r\nhighp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\r\nhighp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);\r\nhighp float lengthB=dot(B,B);\r\nhighp float maxLength=max(lengthT,lengthB);\r\nhighp float invmax=inversesqrt( maxLength );\r\nhighp mat3 res=mat3( T*invmax,B*invmax,N );\r\nreturn res;\r\n#else\r\nreturn mat3(1.0);\r\n#endif\r\n}\r\nhighp vec3 getNormal(){\r\nhighp vec3 n;\r\n#ifdef HAS_ATTRIBUTE_a_normal_3f\r\nn=normalize(normal_3f);\r\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));\r\nhighp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\r\n#endif\r\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;\r\nnMap=normalize(2.0*nMap-vec3(1.0));\r\nhighp vec3 v=normalize(-v_position_height.xyz);\r\nhighp mat3 TBN=cotangentFrame(n,v,uv_2f);\r\nn=normalize(TBN*nMap);\r\n#endif\r\nreturn n;\r\n}\r\nstruct Material {\r\nfloat perceptualRoughness;\r\nfloat alphaRoughness;\r\nfloat metallic;\r\nvec3 f90;\r\nvec4 baseColor;\r\nvec3 diffuseColor;\r\nvec3 specularColor;\r\nhighp vec3 normal;\r\n};\r\nMaterial getPBRMaterial() {\r\nMaterial mat;\r\nmat.baseColor=getBaseColor();\r\nmat.perceptualRoughness=u_roughnessFactor;\r\nmat.metallic=u_metallicFactor;\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;\r\nmat.metallic=v_roughness_metallic_emissive_alpha.y;\r\nmat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\r\n#endif\r\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \r\nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);\r\nmat.perceptualRoughness*=mrSample.g;\r\nmat.metallic*=mrSample.b;\r\n#endif\r\nconst float c_minRoughness=0.04;\r\nmat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);\r\nmat.metallic=saturate(mat.metallic);\r\nmat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);\r\nmat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);\r\nmat.diffuseColor*=1.0-mat.metallic;\r\nmat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);\r\nhighp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);\r\nmat.f90=vec3(reflectance90);\r\nmat.normal=getNormal();\r\nreturn mat;\r\n}float V_GGX(float NdotL,float NdotV,float roughness)\r\n{\r\nfloat a2=roughness*roughness;\r\nfloat GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);\r\nfloat GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);\r\nreturn 0.5/(GGXV+GGXL);\r\n}float V_GGXFast(float NdotL,float NdotV,float roughness) {\r\nfloat a=roughness;\r\nfloat GGXV=NdotL*(NdotV*(1.0-a)+a);\r\nfloat GGXL=NdotV*(NdotL*(1.0-a)+a);\r\nreturn 0.5/(GGXV+GGXL);\r\n}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\r\n{\r\nreturn specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);\r\n}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\r\n{\r\nfloat x=1.0-VdotH;\r\nfloat x4=x*x*x*x;\r\nreturn specularColor+(1.0-specularColor)*x4*x;\r\n}float D_GGX(highp float NdotH,float alphaRoughness)\r\n{\r\nhighp float a4=alphaRoughness*alphaRoughness;\r\nhighp float f=(NdotH*a4-NdotH)*NdotH+1.0;\r\nreturn a4/(M_PI*f*f);\r\n}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\r\n{\r\nfloat f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;\r\nreturn (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));\r\n}\r\nvec3 diffuseLambertian(Material mat)\r\n{\r\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\r\n#else\r\nreturn mat.diffuseColor/M_PI;\r\n#endif\r\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\r\n{\r\nvec4 c0=vec4(-1,-0.0275,-0.572,0.022);\r\nvec4 c1=vec4(1,0.0425,1.04,-0.04);\r\nhighp vec4 r=roughness*c0+c1;\r\nhighp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;\r\nvec2 AB=vec2(-1.04,1.04)*a004+r.zw;\r\nreturn specularColor*AB.x+AB.y;\r\n}\r\nvec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\r\n{\r\nvec3 env_light=vec3(0.65,0.65,0.65);\r\n#ifdef LIGHTING_3D_MODE\r\nfloat ambient_factor=calculate_ambient_directional_factor(normal);\r\nenv_light=u_lighting_ambient_color*ambient_factor;\r\n#endif\r\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);\r\nvec3 indirectSpecular= envBRDF*env_light;\r\nvec3 indirectDiffuse=mat.diffuseColor*env_light;\r\nreturn indirectSpecular+indirectDiffuse;\r\n}\r\nvec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\r\n{\r\nhighp vec3 n=mat.normal;\r\nhighp vec3 v=normalize(-v_position_height.xyz);\r\nhighp vec3 l=normalize(lightPosition);\r\nhighp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);\r\nfloat NdotL=saturate(dot(n,l));\r\nhighp float NdotH=saturate(dot(n,h));\r\nfloat VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;\r\nvec3 transformed_normal=vec3(-n.xy,n.z);\r\nfloat lighting_factor;\r\n#ifdef RENDER_SHADOWS\r\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r\n#else\r\nlighting_factor=NdotL;\r\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;\r\nvec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);\r\nvec3 color=(saturate(directLightColor)+indirectLightColor);\r\nfloat intensityFactor=1.0;\r\n#if !defined(LIGHTING_3D_MODE)\r\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\r\n#endif\ncolor*=intensityFactor;\r\nreturn color;\r\n}\r\nvoid main() {\r\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\r\nif (isOccluded()) {\r\ndiscard;\r\n}\r\n#endif\r\nvec3 lightDir=u_lightpos;\r\nvec3 lightColor=u_lightcolor;\r\n#ifdef LIGHTING_3D_MODE\r\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;\r\nlightColor=u_lighting_directional_color;\r\n#endif\r\nvec4 finalColor;\r\n#ifdef DIFFUSE_SHADED\r\nvec3 N=getNormal();\r\nvec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;\r\ndiffuse*=ao;\r\n#endif\r\nfinalColor=vec4(diffuse,1.0)*u_opacity;\r\n#else\nMaterial mat=getPBRMaterial();\r\nvec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;\r\ncolor*=ao;\r\n#endif\nvec4 emissive=u_emissiveFactor;\r\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\r\n#endif\r\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;\r\nresEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);\r\ncolor=mix(color,v_color_mix.rgb,min(1.0,resEmission));\r\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));\r\ndistance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));\r\nopacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\r\n#endif\r\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);\r\ncolor=linearTosRGB(color);\r\ncolor*=opacity;\r\nfinalColor=vec4(color,opacity);\r\n#endif\n#ifdef FOG\r\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\r\n#endif\r\n#ifdef RENDER_CUTOFF\r\nfinalColor*=v_cutoff_opacity;\r\n#endif\r\n#ifdef INDICATOR_CUTOUT\r\nfinalColor=applyCutout(finalColor);\r\n#endif\r\ngl_FragColor=finalColor;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nHANDLE_WIREFRAME_DEBUG;\r\n}','#include "_prelude_fog.vertex.glsl"\r\n#include "_prelude_shadow.vertex.glsl"\r\nattribute vec3 a_pos_3f;\r\n#pragma mapbox: define-attribute highp vec3 normal_3f\r\n#pragma mapbox: define-attribute highp vec2 uv_2f\r\n#pragma mapbox: define-attribute highp vec3 color_3f\r\n#pragma mapbox: define-attribute highp vec4 color_4f\r\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\r\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;\r\nuniform mat4 u_lighting_matrix;\r\nuniform vec3 u_camera_pos;\r\nuniform vec4 u_color_mix;\r\n#ifdef INSTANCED_ARRAYS\r\nattribute vec4 a_normal_matrix0;\r\nattribute vec4 a_normal_matrix1;\r\nattribute vec4 a_normal_matrix2;\r\nattribute vec4 a_normal_matrix3;\r\n#else\r\nuniform highp mat4 u_normal_matrix;\r\n#endif\r\n#ifdef RENDER_SHADOWS\r\nuniform mat4 u_light_matrix_0;\r\nuniform mat4 u_light_matrix_1;\r\nvarying vec4 v_pos_light_view_0;\r\nvarying vec4 v_pos_light_view_1;\r\nvarying float v_depth_shadows;\r\n#endif\r\nvarying vec4 v_position_height;\r\nvarying lowp vec4 v_color_mix;\r\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\r\nvarying highp float v_depth;\r\n#endif\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;\r\nvarying mediump vec4 v_height_based_emission_params;\n#endif\r\nvoid main() {\r\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\r\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\r\n#pragma mapbox: initialize-attribute highp vec3 color_3f\r\n#pragma mapbox: initialize-attribute highp vec4 color_4f\r\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\r\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\r\nhighp mat4 normal_matrix;\r\n#ifdef INSTANCED_ARRAYS\r\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r\n#else\r\nnormal_matrix=u_normal_matrix;\r\n#endif\r\nvec3 local_pos;\r\nmat3 rs;\r\n#ifdef MODEL_POSITION_ON_GPU\r\nvec3 pos_color=normal_matrix[0].xyz;\r\nvec4 translate=normal_matrix[1];\r\nvec3 pos_a=floor(pos_color);\r\nvec3 rgb=1.05*(pos_color-pos_a);\r\nfloat color_mix=pos_a.z/100.0;\r\nv_color_mix=vec4(sRGBToLinear(rgb),color_mix);\r\nfloat meter_to_tile=normal_matrix[0].w;\r\nvec4 pos=vec4(pos_a.xy,translate.z,1.0);\r\nrs[0].x=normal_matrix[1].w;\r\nrs[0].yz=normal_matrix[2].xy;\r\nrs[1].xy=normal_matrix[2].zw;\r\nrs[1].z=normal_matrix[3].x;\r\nrs[2].xyz=normal_matrix[3].yzw;\r\nvec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);\r\nvec3 rotated_pos_node=rs*pos_node.xyz;\r\nvec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r\npos.xyz+=pos_model_tile;\r\nlocal_pos=pos.xyz;\r\ngl_Position=u_matrix*pos;\r\npos.z*=meter_to_tile;\r\nv_position_height.xyz=pos.xyz-u_camera_pos;\r\n#else\r\nlocal_pos=a_pos_3f;\r\ngl_Position=u_matrix*vec4(a_pos_3f,1);\r\nv_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));\r\nv_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\r\n#endif\r\nv_position_height.w=a_pos_3f.z;\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\nvec4 albedo_c=decode_color(pbr.xy);\r\nvec2 e_r_m=unpack_float(pbr.z);\r\nvec2 r_m= unpack_float(e_r_m.y*16.0);\r\nr_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);\r\nv_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;\r\nv_height_based_emission_params.x=heightBasedRelativeIntepolation;\r\nv_height_based_emission_params.y=heightBasedEmissiveStrength.z;\r\nvec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;\r\nv_height_based_emission_params.z=emissionMultiplierValues.x;\r\nv_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\r\n#endif\r\n#ifdef FOG\r\nv_fog_pos=fog_position(local_pos);\r\n#endif\r\n#ifdef RENDER_CUTOFF\r\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r\n#endif\r\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\r\nv_depth=gl_Position.z/gl_Position.w;\r\n#endif\r\n#ifdef HAS_ATTRIBUTE_a_normal_3f\r\n#ifdef MODEL_POSITION_ON_GPU\r\nfloat x_squared_scale=dot(rs[0],rs[0]);\r\nfloat y_squared_scale=dot(rs[1],rs[1]);\r\nfloat z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);\r\nnormal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);\r\nnormal_3f=normalize(normal_3f);\r\n#else\r\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\r\n#endif\r\n#endif\r\n#ifdef HAS_ATTRIBUTE_a_pbr\r\n#ifdef HAS_ATTRIBUTE_a_color_4f\r\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\r\n#endif\r\n#endif\r\n#ifdef RENDER_SHADOWS\r\nvec3 shadow_pos=local_pos;\r\n#ifdef NORMAL_OFFSET\r\n#ifdef HAS_ATTRIBUTE_a_normal_3f\r\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));\r\nshadow_pos+=offset*shadow_normal_offset_multiplier0();\r\n#else\r\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));\r\nshadow_pos+=offset*shadow_normal_offset_multiplier0();\r\n#endif\r\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);\r\nv_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);\r\nv_depth_shadows=gl_Position.w;\r\n#endif\n}'),modelDepth:DE("varying highp float v_depth;\r\nvoid main() {\r\n#ifndef DEPTH_TEXTURE\r\ngl_FragColor=pack_depth(v_depth);\r\n#endif\r\n}","attribute vec3 a_pos_3f;\r\nuniform mat4 u_matrix;\r\nvarying highp float v_depth;\r\n#ifdef MODEL_POSITION_ON_GPU\r\n#ifdef INSTANCED_ARRAYS\r\nattribute vec4 a_normal_matrix0;\r\nattribute vec4 a_normal_matrix1;\r\nattribute vec4 a_normal_matrix2;\r\nattribute vec4 a_normal_matrix3;\r\n#else\r\nuniform highp mat4 u_instance;\r\n#endif\r\nuniform highp mat4 u_node_matrix;\r\n#endif\r\nvoid main() {\r\n#ifdef MODEL_POSITION_ON_GPU\r\nhighp mat4 instance;\r\n#ifdef INSTANCED_ARRAYS\r\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r\n#else\r\ninstance=u_instance;\r\n#endif\r\nvec3 pos_color=instance[0].xyz;\r\nvec4 translate=instance[1];\r\nvec3 pos_a=floor(pos_color);\r\nfloat meter_to_tile=instance[0].w;\r\nvec4 pos=vec4(pos_a.xy,translate.z,1.0);\r\nmat3 rs;\r\nrs[0].x=instance[1].w;\r\nrs[0].yz=instance[2].xy;\r\nrs[1].xy=instance[2].zw;\r\nrs[1].z=instance[3].x;\r\nrs[2].xyz=instance[3].yzw;\r\nvec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);\r\nvec3 rotated_pos_node=rs*pos_node.xyz;\r\nvec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r\npos.xyz+=pos_model_tile;\r\ngl_Position=u_matrix*pos;\r\n#else\r\ngl_Position=u_matrix*vec4(a_pos_3f,1);\r\n#endif\r\nv_depth=gl_Position.z/gl_Position.w;\r\n}"),stars:DE("varying highp vec2 v_uv;\r\nvarying mediump float v_intensity;float shapeCircle(in vec2 uv)\r\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);\r\nreturn 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);\r\n}\r\nvoid main() {\r\nfloat alpha=shapeCircle(v_uv);\r\nvec3 color=vec3(1.0,1.0,1.0);\r\nalpha*=v_intensity;\r\ngl_FragColor=vec4(color*alpha,alpha);\r\nHANDLE_WIREFRAME_DEBUG;\r\n}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;\r\nuniform vec3 u_right;uniform float u_intensity_multiplier;\r\nvarying highp vec2 v_uv;\r\nvarying mediump float v_intensity;\r\nvoid main() {\r\nv_uv=a_uv;\r\nv_intensity=a_fade_opacity*u_intensity_multiplier;\r\nvec3 pos=a_pos_3f;\r\npos+=a_uv.x*u_right*a_size_scale;\r\npos+=a_uv.y*u_up*a_size_scale;\r\ngl_Position=u_matrix*vec4(pos,1.0);\r\n}")};function IE(e,t){const r=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of r)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const r=e.split(" ");for(const e of r)t.includes(e)||t.push(e)}}function DE(e,t){const r=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let i=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);i&&(i=i.filter(((e,t)=>i.indexOf(e)===t)));const a={},o=[],s=[];e=e.replace(r,((e,t)=>(s.push(t),""))),t=t.replace(r,((e,t)=>(o.push(t),"")));let l=[...PE];IE(e,l),IE(t,l);for(const e of[...o,...s])ME[e]||console.error(`Undefined include: ${e}`),RE[e]||(RE[e]=[],IE(ME[e],RE[e])),l=[...l,...RE[e]];return{fragmentSource:e=e.replace(n,((e,t,r,n,i)=>(a[i]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${r} ${n} ${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    varying ${r} ${n} ${i};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(n,((e,t,r,n,i)=>{const o="float"===n?"vec2":n,s=i.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\nattribute ${r} ${n} a_${i};\n#endif\n`:a[i]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${r} ${o} a_${i};\nvarying ${r} ${n} ${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"initialize"===t?"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    attribute ${r} ${n} a_${i};\n    varying ${r} ${n} ${i};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${i} = a_${i};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${r} ${o} a_${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"define-instanced"===t?"mat4"===s?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${i}0;\nattribute vec4 a_${i}1;\nattribute vec4 a_${i}2;\nattribute vec4 a_${i}3;\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${r} ${o} a_${i};\n#else\nuniform ${r} ${n} u_${i};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${r} ${n} ${i} = a_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = a_${i};\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${r} ${n} ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${r} ${n} ${i} = u_${i};\n#endif\n`})),staticAttributes:i,usedDefines:l,vertexIncludes:o,fragmentIncludes:s}}class kE{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,n,i,a,o,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!l&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(l=!0);let u=this.boundDynamicVertexBuffers.length!==o.length;for(let e=0;!u&&e<o.length;e++)this.boundDynamicVertexBuffers[e]!==o[e]&&(u=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||l||u||this.boundIndexBuffer!==i||this.boundVertexOffset!==a)this.freshBind(t,r,n,i,a,o,s);else{e.bindVertexArrayOES.set(this.vao);for(const r of o)r&&(r.bind(),s&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,t,s));i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,r,n,i,a,o){const s=e.numAttributes,l=this.context,u=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=a,t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const t of r)t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const t of a)t&&(t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i),o&&t.instanceCount&&t.setVertexAttribDivisor(u,e,o));n&&n.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function BE(e,t){const r=Math.pow(2,t.canonical.z),n=t.canonical.y;return[new Kh(0,n/r).toLngLat().lat,new Kh(0,(n+1)/r).toLngLat().lat]}function FE(e,t,r,n,i,a,o){const s=e.context,l=s.gl,u=r.hillshadeFBO;if(!u)return;e.prepareDrawTile();const c=e.isTileAffectedByFog(t),d=e.getOrCreateProgram("hillshade",{overrideFog:c});s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.colorAttachment.get());const h=((e,t,r,n)=>{const i=r.paint.get("hillshade-shadow-color"),a=r.paint.get("hillshade-highlight-color"),o=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-emissive-strength");let l=T(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))l-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const t=e.style.directionalLight.properties.get("direction");l=T(J(t.x,t.y,t.z)[1])}const u=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),u),u_image:0,u_latrange:BE(0,t.tileID),u_light:[r.paint.get("hillshade-exaggeration"),l],u_shadow:i,u_highlight:a,u_emissive_strength:s,u_accent:o}})(e,r,n,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(s,d,t.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:m}=e.getTileBoundsBuffers(r);d.draw(e,l.TRIANGLES,i,a,o,xv.disabled,h,n.id,f,p,m)}function NE(e,t,r){if(!t.needsDEMTextureUpload)return;const n=e.context,i=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(r.stride);const a=r.getPixels();t.demTexture?t.demTexture.update(a,{premultiply:!1}):t.demTexture=new py(n,a,e.terrainUseFloatDEM()?i.R32F:i.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function qE(e,t,r){const n=e.context,i=n.gl;if(!t.dem)return;const a=t.dem;if(n.activeTexture.set(i.TEXTURE1),NE(e,t,a),!t.demTexture)return;t.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE);const o=a.dim;n.activeTexture.set(i.TEXTURE0);let s=t.hillshadeFBO;if(!s){const e=new py(n,{width:o,height:o,data:null},i.RGBA);e.bind(i.LINEAR,i.CLAMP_TO_EDGE),s=t.hillshadeFBO=n.createFramebuffer(o,o,!0,"renderbuffer"),s.colorAttachment.set(e.texture)}n.bindFramebuffer.set(s.framebuffer),n.viewport.set([0,0,o,o]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:u,tileBoundsSegments:c}=e.getMercatorTileBoundsBuffers(),d=[];e.terrainUseFloatDEM()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(e,i.TRIANGLES,pv.disabled,gv.disabled,yv.unblended,xv.disabled,((e,t)=>{const r=t.stride,n=gd.create();return gd.ortho(n,0,nn,-nn,0,0,1),gd.translate(n,n,[0,-nn,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:t.unpackVector}})(t.tileID,a),r.id,l,u,c),t.needsHillshadePrepare=!1}const UE=e=>({u_matrix:new Ll(e),u_image0:new Al(e),u_skirt_height:new Sl(e),u_ground_shadow_factor:new Ml(e)}),jE=(e,t,r)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),GE=(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:r,u_zoom_transition:i,u_merc_center:a,u_image0:0,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:d,u_viewport:h,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9),u_skirt_height:f}),zE=(e,t)=>{if(t>0&&e.terrain&&X("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const r=e.transform,n=Math.max(Math.abs(r._zoom-(e.minCutoffZoom-1)),1),i=r.isLODDisabled(!1)?O(60,45,r.pitch):O(30,15,r.pitch),a=r._farZ-r._nearZ,o=t*r.height,s=((1-(l=i))*(.75*r.cameraToCenterDistance)+l*(r._farZ+o))*n;var l;return{shouldRenderCutoff:i<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(s-r._nearZ)/a,(s-o-r._nearZ)/a]}}};function VE(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const $E=new class{constructor(){this.operations={}}newMorphing(e,t,r,n,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:n,phase:0,duration:i,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},HE={0:null,1:"TERRAIN_VERTEX_MORPHING"};function WE(e,t,r){if(0===t)return 0;const n=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*n}function XE(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}const YE=e=>({u_matrix:e});function ZE(e,t,r,n,i){if(i>0){const a=st.now(),o=(a-e.timeAdded)/i,s=t?(a-t.timeAdded)/i:-1,l=r.getSource(),u=n.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),c=!t||Math.abs(t.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=c&&e.refreshedUponExpiration?1:C(c?o:1-s,0,1);return e.refreshedUponExpiration&&o>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class KE extends wv{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},r=new fT(FT(),null),n=_w("mock-dem",t,r,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class JE extends wv{constructor(e){const t=_w("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new fT(FT(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,r)=>{if(t[r.key]="",!this._tiles[r.key]){const t=new Ay(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[r.key]=t}return t}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const r=Object.values(t);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class QE extends Dd{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class eA extends Um{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,i]=function(e){const t=new bs,r=new Ns,n=131;t.reserve(17161),r.reserve(33800);const i=nn/128,a=nn+i/2,o=a+i;for(let e=-i;e<o;e+=i)for(let r=-i;r<o;r+=i){const n=r<0||r>a||e<0||e>a?24575:0,i=C(Math.round(r),0,nn),o=C(Math.round(e),0,nn);t.emplaceBack(i+n,o)}const s=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)s(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)})),[t,r,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(r,Rd.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=ul.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=ul.simpleSegment(0,0,r.length,i),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new JE(t.map),this.orthoMatrix=gd.create(),gd.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,nn,0,nn,0,1);const o=a.gl;this._overlapStencilMode=new gv({func:o.GEQUAL,mask:255},0,255,o.KEEP,o.KEEP,o.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new KE(t.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,t,r){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const n=e.terrain.properties,i=0===e.terrain.drapeRenderMode,a=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=st.now();const o=e.terrain&&e.terrain.scope,s=n.get("source"),l=i?this._mockSourceCache:e.getSourceCache(s,o);if(!l)return void X(`Couldn't find terrain source "${s}".`);if(this.sourceCache=l,this._exaggeration=a?this.calculateExaggeration(t):n.get("exaggeration"),!t.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),t.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0,this._previousZoom=t.zoom}else this._disable()}calculateExaggeration(e){const t=this._previousCameraAltitude,r=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=r;const n=null!=t?r-t:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const i=e.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(i);let o=i-this._previousZoom;const s=this._previousUpdateTimestamp;let l=i;null!=this._evaluationZoom&&(l=this._evaluationZoom,Math.abs(i-l)>.5&&(o=.5*(i-l+o)),o*n<0&&(l+=o)),this._evaluationZoom=l;const u=a.getExaggeration(l),c=u===a.getExaggeration(Math.max(0,l-.1));if(c&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-s));return(c||u<.1||Math.abs(o)<1e-4)&&(d=Math.min(.2,4*d)),Hn(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const t=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(Kh.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=t.getIds().map((e=>{const n=t.getTileByID(e).tileID;return n.projMatrix=r.calculateProjMatrix(n.toUnwrapped()),n}));!function(e,t){const r=t.transform.pointCoordinate(t.transform.getCameraPoint()),n=new y(r.x,r.y);e.sort(((e,t)=>{if(t.overscaledZ-e.overscaledZ)return t.overscaledZ-e.overscaledZ;const r=new y(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),i=new y(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=n.mult(1<<e.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(r)-a.distSqr(i)}))}(n,this.painter);const i=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const t in a){const r=a[t];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,e[t],i),r.usedForTerrain)continue;const n=e[t];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[t.id]=n.map((e=>new QE(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(i),this.renderingToTexture=!1;const o={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const r=t.tileID.key;r in o||(this._visibleDemTiles.push(t),o[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],i=n.dem;!i||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),NE(this.painter,n,i))}}_prepareDemTileUniforms(e,t,r,n){if(!t||null==t.demTexture)return!1;const i=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-i.z),o=n||"";return r[`u_dem_tl${o}`]=[i.x*a%1,i.y*a%1],r[`u_dem_scale${o}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,t=e.gl;if(!this._emptyDepthBufferTexture){const r=new Vf({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new py(e,r,t.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,r)=>{if(!r.dem)return t;const n=r.dem.tree.minimums[0];return n>0&&e++,t+n}),0);return e?t/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl;e.activeTexture.set(t.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,i]=(()=>{if(this.painter.terrainUseFloatDEM()){const e=new $f({width:1,height:1},new Float32Array([r]));return[t.R32F,e]}{const e=new Vf({width:1,height:1},new Uint8Array(qm.pack(r,this.sourceCache.getSource().encoding)));return[t.RGBA,e]}})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(i,{premultiply:!1}):a=this._emptyDEMTexture=new py(e,i,n,{premultiply:!1}),a}setupElevationDraw(e,t,r){const n=this.painter.context,i=n.gl,a=(o=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:qm.getUnpackVector(o),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var o;a.u_exaggeration=this.exaggeration();let s=null,l=null,u=1;if(r&&r.morphing&&this._useVertexMorphing){const t=r.morphing.srcDemTile,n=r.morphing.dstDemTile;u=r.morphing.phase,t&&n&&(this._prepareDemTileUniforms(e,t,a,"_prev")&&(l=t),this._prepareDemTileUniforms(e,n,a)&&(s=n))}const c=e=>e&&e.demTexture&&this.painter.terrainUseFloatDEM()?i.LINEAR:i.NEAREST,d=e=>{a.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&s)n.activeTexture.set(i.TEXTURE2),s.demTexture.bind(c(s),i.CLAMP_TO_EDGE),n.activeTexture.set(i.TEXTURE4),l.demTexture.bind(c(l),i.CLAMP_TO_EDGE),s.demTexture&&d(s.demTexture),a.u_dem_lerp=u;else{s=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(i.TEXTURE2);const t=this._prepareDemTileUniforms(e,s,a)?s.demTexture:this.emptyDEMTexture;t.bind(c(s),i.CLAMP_TO_EDGE),d(t)}if(n.activeTexture.set(i.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&s){const e=(1<<s.tileID.canonical.z)*Gh(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=e}if(r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),t.setTerrainUniformValues(n,a),"globe"===this.painter.transform.projection.name){const i=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);t.setGlobeUniformValues(n,i)}}globeUniformValues(e,t,r){const n=e.projection;return{u_tile_tl_up:n.upVector(t,0,0),u_tile_tr_up:n.upVector(t,nn,0),u_tile_br_up:n.upVector(t,nn,nn),u_tile_bl_up:n.upVector(t,0,nn),u_tile_up_scale:r?eh(1):n.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const t=this.painter,r=this.painter.context;0!==e.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,t,r,n,i){if("globe"===e.transform.projection.name)!function(e,t,r,n,i){const a=e.context,o=a.gl;let s,l;const u=e.transform,c=wh(e,a,u),d=(t,r)=>{if(l===r)return;const n=[HE[r],"PROJECTION_GLOBE_VIEW"];c&&n.push("CUSTOM_ANTIALIASING");const i=e.isTileAffectedByFog(t);s=e.getOrCreateProgram("globeRaster",{defines:n,overrideFog:i}),l=r},h=e.colorModeForRenderPass(),f=new pv(o.LEQUAL,pv.ReadWrite,e.depthRangeFor3D);$E.update(i);const p=function(e){const t=e.pixelsPerMeter,r=t/Gh(1,e.center.lat),n=gd.identity(new Float64Array(16));return gd.translate(n,n,[e.point.x,e.point.y,0]),gd.scale(n,n,[r,r,t]),Float32Array.from(n)}(u),m=[Uh(u.center.lng),jh(u.center.lat)],g=e.globeSharedBuffers,_=[u.width*st.devicePixelRatio,u.height*st.devicePixelRatio],y=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=e.transform,c=WE(u.zoom,t.exaggeration(),t.sourceCache._source.tileSize);l=-1;const b=o.TRIANGLES;for(const l of n){const n=r.getTile(l),x=gv.disabled,T=t.prevTerrainTileForTile[l.key],w=t.terrainTileForTile[l.key];VE(T,w)&&$E.newMorphing(l.key,T,w,i,250),a.activeTexture.set(o.TEXTURE0),n.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const E=$E.getMorphValuesForProxy(l.key),S=E?1:0;E&&Rt(v,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:A(E.phase)}});const P=uh(l.canonical),M=Ah(P.getCenter().lat),R=Eh(l.canonical,P,M,u.worldSize/u._pixelsPerMercatorPixel),C=gh(ih(l.canonical)),O=GE(u.projMatrix,y,p,C,xh(u.zoom),m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,c,R);if(d(l,S),s&&(t.setupElevationDraw(n,s,v),e.uploadCommonUniforms(a,s,l.toUnwrapped()),g)){const[t,r,n]=g.getGridBuffers(M,0!==c);s.draw(e,b,f,x,h,xv.backCCW,O,"globe_raster",t,r,n)}}}if(g&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const i=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];c&&i.push("CUSTOM_ANTIALIASING"),s=e.getOrCreateProgram("globeRaster",{defines:i});for(const i of n){const{x:n,y:l,z:c}=i.canonical,d=0===l,p=l===(1<<c)-1,[y,b,x,T]=g.getPoleBuffers(c,!1);if(T&&(d||p)){const l=r.getTile(i);a.activeTexture.set(o.TEXTURE0),l.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);let g=Th(c,n,u);const w=gh(ih(i.canonical)),E=(t,r)=>t.draw(e,o.TRIANGLES,f,gv.disabled,h,xv.disabled,GE(u.projMatrix,g,g,w,0,m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,0),"globe_pole_raster",r,x,T);t.setupElevationDraw(l,s,v),e.uploadCommonUniforms(a,s,i.toUnwrapped()),d&&e.renderDefaultNorthPole&&E(s,y),p&&e.renderDefaultSouthPole&&(g=gd.scale(gd.create(),g,[1,-1,1]),E(s,b))}}}}(e,t,r,n,i);else{const a=e.context,o=a.gl;let s,l;const u=e.shadowRenderer,c=zE(e,e.longestCutoffRange),d=t=>{if(l===t)return;const r=[];r.push(HE[t]),c.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),s=e.getOrCreateProgram("terrainRaster",{defines:r}),l=t},h=e.colorModeForRenderPass(),f=new pv(o.LEQUAL,pv.ReadWrite,e.depthRangeFor3D);$E.update(i);const p=e.transform,m=WE(p.zoom,t.exaggeration(),t.sourceCache._source.tileSize);let g=[0,0,0];if(u){const t=e.style.directionalLight,r=e.style.ambientLight;t&&r&&(g=DS(t,r))}{l=-1;const _=o.TRIANGLES,[y,v]=[t.gridIndexBuffer,t.gridSegments];for(const l of n){const n=r.getTile(l),b=gv.disabled,x=t.prevTerrainTileForTile[l.key],T=t.terrainTileForTile[l.key];VE(x,T)&&$E.newMorphing(l.key,x,T,i,250),a.activeTexture.set(o.TEXTURE0),n.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);const w=$E.getMorphValuesForProxy(l.key),E=w?1:0;let S;w&&(S={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:A(w.phase)}});const P=jE(l.projMatrix,XE(l.canonical,p.renderWorldCopies)?m/10:m,g);if(d(E),!s)continue;t.setupElevationDraw(n,s,S);const M=l.toUnwrapped();u&&u.setupShadows(M,s),e.uploadCommonUniforms(a,s,M,null,c),s.draw(e,_,f,b,h,xv.backCCW,P,"terrain_raster",t.gridBuffer,y,v)}}}}(t,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const t=this.painter,r=this.painter.context,n=this.proxySourceCache,i=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),o=t.style.order,s=[];let l=0;for(const u of i){const i=n.getTileByID(u.proxyTileKey),c=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][e]:void 0,d=void 0!==c?n.renderCache[c]:this.pool[l++],h=void 0!==c;if(i.texture=d.tex,h&&!d.dirty){s.push(i.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:ar.transparent,stencil:0}),d.dirty=!1);for(let e=a.start;e<=a.end;++e){const n=t.style._mergedLayers[o[e]];if(n.isHidden(t.transform.zoom))continue;const i=t.style.getLayerSourceCache(n),a=i?this.proxyToSource[u.key][i.id]:[u];if(!a)continue;const s=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(i?i.id:null)&&(this._setupStencil(d,a,n,i),f=i?i.id:null),t.renderLayer(t,i,n,s)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const n=t.style._mergedLayers[o[e]];if(n.isHidden(t.transform.zoom))continue;const i=t.style.getLayerSourceCache(n),a=i?this.proxyToSource[u.key][i.id]:[u];if(!a)continue;const s=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(i?i.id:null)&&(this._setupStencil(d,a,n,i),f=i?i.id:null),t.renderLayer(t,i,n,s)}this.renderedToTile?(d.dirty=!0,s.push(i.tileID)):h||--l,5===l&&(l=0,this.renderToBackBuffer(s))}return this.renderToBackBuffer(s),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let r=-1,n=t;for(let i=0;i<t;++i)this._style.isLayerDraped(e._mergedLayers[e.order[i]])?r=Math.max(r,i):n=Math.min(n,i);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((e=>e.dem)).map((n=>{const i=n.tileID,a=1<<i.overscaledZ,{x:o,y:s}=i.canonical,l=o/a,u=(o+1)/a,c=s/a,d=(s+1)/a;return{minx:l,miny:c,maxx:u,maxy:d,t:n.dem.tree.raycastRoot(l,c,u,d,e,t,r),tile:n}}));n.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const i of n){if(null==i.t)return null;const n=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,e,t,r);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,t=e.gl,r=this.drapeBufferSize;e.activeTexture.set(t.TEXTURE0);const n=new py(e,{width:r[0],height:r[1],data:null},t.RGBA);n.bind(t.LINEAR,t.CLAMP_TO_EDGE);const i=e.createFramebuffer(r[0],r[1],!0,null);return i.colorAttachment.set(n.texture),i.depthAttachment=new hv(e,i.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,i.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):i.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:i,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],r=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!r&&t.shouldRedrape():!r&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof CT){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const r=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(r);if(n&&!t[n.id]&&!r.isHidden(this.painter.transform.zoom)&&"line"===r.type&&r.widthExpression()instanceof _a){t[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t]._source instanceof OT){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const r=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(r);if(!n||t[n.id])continue;if(r.isHidden(this.painter.transform.zoom)||"raster"!==r.type)continue;const i=r.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=ZE(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,i);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const r=[];this._pendingGroundEffectLayers=[];let n,i=0,a=this._style._mergedLayers[e[i]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++i<t;)a=this._style._mergedLayers[e[i]];for(;i<t;++i){const t=this._style._mergedLayers[e[i]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=i):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(i),void 0!==n&&(r.push({start:n,end:i-1}),n=void 0)))}if(void 0!==n&&r.push({start:n,end:i-1}),0!==r.length){const e=r[r.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let r=0;r<e.length;++r){const n=Object.values(e[r]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let i=r.length-1;i>=0;i--){const a=r[i];if(t.getTileByID(a.key),void 0!==t.proxyCachedFBO[a.key]){const r=e[a.key],i=this.proxyToSource[a.key];let o=0;for(const e in i){const t=i[e],a=r[e];if(!a||a.length!==t.length||t.some(((t,r)=>t!==a[r]||n[e]&&n[e].hasOwnProperty(t.key)))){o=-1;break}++o}for(const e in t.proxyCachedFBO[a.key])t.renderCache[t.proxyCachedFBO[a.key][e]].dirty=o<0||o!==Object.values(r).length}}const i=[...this._drapedRenderBatches];i.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of i)for(const n of r){if(t.proxyCachedFBO[n.key])continue;let r=t.renderCachePool.pop();void 0===r&&t.renderCache.length<50&&(r=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==r&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][e.start]=r,t.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,a=i.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let o;if(r.isTileClipped())o=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):gv.disabled}_renderTileClippingMasks(e,t){const r=this.painter,n=this.painter.context,i=n.gl;r._tileClippingMaskIDs={},n.setColorMode(yv.disabled),n.setDepthMode(pv.disabled);const a=r.getOrCreateProgram("clippingMask");for(const n of e){const e=r._tileClippingMaskIDs[n.key]=--t;a.draw(r,i.TRIANGLES,pv.disabled,new gv({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),yv.disabled,xv.disabled,YE(n.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const t=this.painter.transform;if(e.x<0||e.x>t.width||e.y<0||e.y>t.height)return null;const r=[e.x,e.y,1,1];ld.transformMat4(r,r,t.pixelMatrixInverse),ld.scale(r,r,1/r[3]),r[0]/=t.worldSize,r[1]/=t.worldSize;const n=t._camera.position,i=Gh(1,t.center.lat),a=[n[0],n[1],n[2]/i,0],o=Td.subtract([],r.slice(0,3),a);Td.normalize(o,o);const s=this.raycast(a,o,this._exaggeration);return null!==s&&s?(Td.scaleAndAdd(a,a,o,s),a[3]=a[2],a[2]*=i,a):null}drawDepth(){const e=this.painter,t=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),i=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===i||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,r=t.createFramebuffer(n,i,!0,"renderbuffer");t.activeTexture.set(e.TEXTURE0);const a=new py(t,{width:n,height:i,data:null},e.RGBA);a.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(a.texture);const o=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,n,i);r.depthAttachment.set(o),this._depthFBO=r,this._depthTexture=a}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,n,i]),function(e,t,r,n){if("globe"===e.transform.projection.name)return;const i=e.context,a=i.gl;i.clear({depth:1});const o=e.getOrCreateProgram("terrainDepth"),s=new pv(a.LESS,pv.ReadWrite,e.depthRangeFor3D);for(const i of n){const n=r.getTile(i),l=jE(i.projMatrix,0,[0,0,0]);t.setupElevationDraw(n,o),o.draw(e,a.TRIANGLES,s,gv.disabled,yv.unblended,xv.backCCW,l,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,r){if(e.getSource()instanceof jx)return this._setupProxiedCoordsForImageSource(e,t,r);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],i=this.proxyCoords;for(let t=0;t<i.length;t++){const a=i[t],o=this._findTileCoveringTileID(a,e);if(o){const t=this._createProxiedId(a,o,r[a.key]&&r[a.key][e.id]);n.push(t),this.proxyToSource[a.key][e.id]=[t]}}let a=!1;for(let i=0;i<t.length;i++){const o=e.getTile(t[i]);if(!o||!o.hasData())continue;const s=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==o.tileID.canonical.z){const t=this.proxyToSource[s.tileID.key][e.id],i=this._createProxiedId(s.tileID,o,r[s.tileID.key]&&r[s.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[s.tileID.key][e.id]=[i],n.push(i),a=!0}}this._sourceTilesOverlap[e.id]=a}_setupProxiedCoordsForImageSource(e,t,r){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],i=this.proxyCoords,a=e.getSource(),o=a.tileID;if(!o)return;const s=new y(o.x,o.y)._div(1<<o.z),l=a.coordinates.map(Kh.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e)),{min:new y(Number.MAX_VALUE,Number.MAX_VALUE),max:new y(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,t)=>{const r=e.wrap+e.canonical.x/(1<<e.canonical.z),n=e.canonical.y/(1<<e.canonical.z),i=nn/(1<<e.canonical.z),a=t.wrap+t.canonical.x/(1<<t.canonical.z),o=t.canonical.y/(1<<t.canonical.z);return r+i<a+l.min.x||r>a+l.max.x||n+i<o+l.min.y||n>o+l.max.y};for(let a=0;a<i.length;a++){const o=i[a];for(let i=0;i<t.length;i++){const a=e.getTile(t[i]);if(!a||!a.hasData())continue;if(u(o,a.tileID))continue;const s=this._createProxiedId(o,a,r[o.key]&&r[o.key][e.id]),l=this.proxyToSource[o.key][e.id];l?l.push(s):this.proxyToSource[o.key][e.id]=[s],n.push(s)}}}_createProxiedId(e,t,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===t.tileID.key));if(e)return e}if(t.tileID.key!==e.key){const r=e.canonical.z-t.tileID.canonical.z;let i,a,o;n=gd.create();const s=t.tileID.wrap-e.wrap<<e.overscaledZ;r>0?(i=nn>>r,a=i*((t.tileID.canonical.x<<r)-e.canonical.x+s),o=i*((t.tileID.canonical.y<<r)-e.canonical.y)):(i=nn<<-r,a=nn*(t.tileID.canonical.x-(e.canonical.x+s<<-r)),o=nn*(t.tileID.canonical.y-(e.canonical.y<<-r))),gd.ortho(n,0,i,0,i,0,1),gd.translate(n,n,[a,o,0])}return new QE(t.tileID,e.key,n)}_findTileCoveringTileID(e,t){let r=t.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[t.id],i=n[e.key];if(r=i?t.getTileByID(i):null,r&&r.hasData()||null===i)return r;let a=r?r.tileID:e,o=a.overscaledZ;const s=t.getSource().minzoom,l=[];if(!i){const n=t.getSource().maxzoom;if(e.canonical.z>=n){const r=e.canonical.z-n;t.getSource().reparseOverscaled?(o=Math.max(e.canonical.z+2,t.transform.tileZoom),a=new Dd(o,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r)):0!==r&&(o=n,a=new Dd(o,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r))}a.key!==e.key&&(l.push(a.key),r=t.getTile(a))}const u=e=>{l.forEach((t=>{n[t]=e})),l.length=0};for(o-=1;o>=s&&(!r||!r.hasData());o--){r&&u(r.tileID.key);const e=a.calculateScaledKey(o);if(r=t.getTileByID(e),r&&r.hasData())break;const i=n[e];if(null===i)break;void 0===i?l.push(e):r=t.getTileByID(i)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[t.key]=!0}}function tA(e,t,r){const n=function(e,t,r){const n=Td.dot(t,e),i=Td.dot(r,[.2126,.7152,.0722]),a=(e,t,r)=>(1-r)*e+r*t,o=a(1-.3*Math.min(i,1),1,Math.min(n+1,1));return a(.92,1,Math.asin(C(t[2],-1,1))/Math.PI+.5)*o}(e,[0,0,1],t),i=[0,0,0];Td.scale(i,r.slice(0,3),n);const a=[0,0,0];Td.scale(a,t.slice(0,3),e[2]);const o=[0,0,0];return Td.add(o,i,a),se(o)}const rA=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],nA=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class iA{static cacheKey(e,t,r,n){let i=`${t}${n?n.cacheKey:""}`;for(const t of r)e.usedDefines.includes(t)&&(i+=`/${t}`);return i}constructor(e,t,r,n,i,a){const o=e.gl;this.program=o.createProgram(),this.configuration=n,this.name=t,this.fixedDefines=[...a];const s=function(e){const t=[];for(let r=0;r<e.length;r++){if(null===e[r])continue;const n=e[r].split(" ");t.push(n.pop())}return t}(r.staticAttributes),l=n?n.getBinderAttributes():[],u=s.concat(l);let c=n?n.defines():[];c=c.concat(a.map((e=>`#define ${e}`)));const d="#version 300 es\n";let h=d+c.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",OE,CE.fragmentSource).join("\n");for(const e of r.fragmentIncludes)h+=`\n${ME[e]}`;h+=`\n${r.fragmentSource}`;let f=d+c.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",OE,CE.vertexSource).join("\n");for(const e of r.vertexIncludes)f+=`\n${ME[e]}`;f+=`\n${r.vertexSource}`;const p=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);o.shaderSource(p,h),o.compileShader(p),o.attachShader(this.program,p);const m=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(m,f),o.compileShader(m),o.attachShader(this.program,m),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)if(u[e]){const t=u[e].startsWith("a_")?u[e]:`a_${u[e]}`;o.bindAttribLocation(this.program,e,t),this.attributes[t]=e}o.linkProgram(this.program),o.deleteShader(m),o.deleteShader(p),this.fixedUniforms=i(e),this.binderUniforms=n?n.getUniforms(e):[],a.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new Al(e),u_dem_prev:new Al(e),u_dem_unpack:new Rl(e),u_dem_tl:new Pl(e),u_dem_scale:new Sl(e),u_dem_tl_prev:new Pl(e),u_dem_scale_prev:new Sl(e),u_dem_size:new Sl(e),u_dem_lerp:new Sl(e),u_exaggeration:new Sl(e),u_depth:new Al(e),u_depth_size_inv:new Pl(e),u_meter_to_dem:new Sl(e),u_label_plane_matrix_inv:new Ll(e)}))(e)),a.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new Ml(e),u_tile_tr_up:new Ml(e),u_tile_br_up:new Ml(e),u_tile_bl_up:new Ml(e),u_tile_up_scale:new Sl(e)}))(e)),a.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new Ll(e),u_fog_range:new Pl(e),u_fog_color:new Rl(e),u_fog_horizon_blend:new Sl(e),u_fog_vertical_limit:new Pl(e),u_fog_temporal_offset:new Sl(e),u_frustum_tl:new Ml(e),u_frustum_tr:new Ml(e),u_frustum_br:new Ml(e),u_frustum_bl:new Ml(e),u_globe_pos:new Ml(e),u_globe_radius:new Sl(e),u_globe_transition:new Sl(e),u_is_globe:new Al(e),u_viewport:new Pl(e)}))(e)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new Rl(e)}))(e)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new Ml(e),u_lighting_directional_dir:new Ml(e),u_lighting_directional_color:new Ml(e),u_ground_radiance:new Ml(e)}))(e)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new Ll(e),u_light_matrix_1:new Ll(e),u_fade_range:new Pl(e),u_shadow_normal_offset:new Ml(e),u_shadow_intensity:new Sl(e),u_shadow_texel_size:new Sl(e),u_shadow_map_resolution:new Sl(e),u_shadow_direction:new Ml(e),u_shadow_bias:new Ml(e),u_shadowmap_0:new Al(e),u_shadowmap_1:new Al(e)}))(e))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}_drawDebugWireframe(e,t,r,n,i,a,o,s,l,u){const c=e.options.wireframe;if(!1===c.terrain&&!1===c.layers2D&&!1===c.layers3D)return;const d=e.context;if(!(()=>!(!c.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!c.layers2D||e._terrain&&e._terrain.renderingToTexture||!rA.includes(this.name))||!(!c.layers3D||!nA.includes(this.name)))())return;const h=d.gl,f=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,i,d);if(!f)return;const p=[...this.fixedDefines];p.push("DEBUG_WIREFRAME");const m=e.getOrCreateProgram(this.name,{config:this.configuration,defines:p});d.program.set(m.program);const g=(e,t,r)=>{if(t[e]&&r[e])for(const n in t[e])r[e][n]&&r[e][n].set(r.program,n,t[e][n].current)};l&&l.setUniforms(m.program,d,m.binderUniforms,o,{zoom:s}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),f.bind(),d.setColorMode(new yv([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ZERO,h.ONE],ar.transparent,[!0,!0,!0,!1])),d.setDepthMode(new pv(t.func===h.LESS?h.LEQUAL:t.func,pv.ReadOnly,t.range)),d.setStencilMode(gv.disabled);const _=3*a.primitiveLength*2,y=3*a.primitiveOffset*2*2;u&&u>1?h.drawElementsInstanced(h.LINES,_,h.UNSIGNED_SHORT,y,u):h.drawElements(h.LINES,_,h.UNSIGNED_SHORT,y),i.bind(),d.program.set(this.program),d.setDepthMode(t),d.setStencilMode(r),d.setColorMode(n)}draw(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(r),g.setStencilMode(n),g.setColorMode(i),g.setCullFace(a);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,o[e]);f&&f.setUniforms(this.program,g,this.binderUniforms,d,{zoom:h});const y={[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t],v=m&&m>0?1:void 0;for(const a of c.get()){const o=a.vaos||(a.vaos={});(o[s]||(o[s]=new kE)).bind(g,this,l,f?f.getPaintVertexBuffers():[],u,a.vertexOffset,p||[],v),m&&m>1?_.drawElementsInstanced(t,a.primitiveLength*y,_.UNSIGNED_SHORT,a.primitiveOffset*y*2,m):_.drawElements(t,a.primitiveLength*y,_.UNSIGNED_SHORT,a.primitiveOffset*y*2),t===_.TRIANGLES&&this._drawDebugWireframe(e,r,n,i,u,a,d,h,f,m)}}}function aA(e,t){const r=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,i=n*(t.tileID.canonical.x+t.tileID.wrap*r),a=n*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/Hv(t,1,e.transform.tileZoom),u_pixel_coord_upper:[i>>16,a>>16],u_pixel_coord_lower:[65535&i,65535&a]}}const oA=gd.create(),sA=(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p)=>{const m=t.style.light,g=m.properties.get("position"),_=[g.x,g.y,g.z],y=pd.create();"viewport"===m.properties.get("anchor")&&(pd.fromRotation(y,-t.transform.angle),Td.transformMat3(_,_,y));const v=m.properties.get("color"),b=t.transform,x={u_matrix:e,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:oA,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:i,u_edge_radius:a,u_flood_light_color:d,u_vertical_scale:h,u_flood_light_intensity:f,u_ground_shadow_factor:p};return"globe"===b.projection.name&&(x.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],x.u_zoom_transition=l,x.u_inv_rot_matrix=c,x.u_merc_center=u,x.u_up_dir=b.projection.upVector(new Ld(0,0,0),u[0]*nn,u[1]*nn),x.u_height_lift=s),x},lA=(e,t,r)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:r}),uA=(e,t,r,n,i,a,o,s,l,u,c,d,h,f)=>{const p=sA(e,t,r,n,i,a,o,l,u,c,d,h,f,1,[0,0,0]),m={u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8};return k(p,aA(t,s),m)},cA=(e,t)=>({u_matrix:e,u_emissive_strength:t}),dA=(e,t,r,n)=>k(cA(e,t),aA(r,n)),hA=(e,t,r)=>({u_matrix:e,u_world:r,u_emissive_strength:t}),fA=(e,t,r,n,i)=>k(dA(e,t,r,n),{u_world:i}),pA=(e,t,r,n)=>{const i=nn/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(n),u_extrude_scale:[t.pixelsToGLUnits[0]/i,t.pixelsToGLUnits[1]/i]}},mA=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r}),gA=gd.create(),_A=(e,t,r,n,i,a,o)=>{const s=e.transform,l="globe"===s.projection.name,u=l?vh(s.zoom,t.canonical)*s._pixelsPerMercatorPixel:Hv(r,1,a),c={u_matrix:t.projMatrix,u_extrude_scale:u,u_intensity:o,u_inv_rot_matrix:gA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){c.u_inv_rot_matrix=n,c.u_merc_center=i,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=xh(s.zoom);const e=i[0]*nn,r=i[1]*nn;c.u_up_dir=s.projection.upVector(new Ld(0,0,0),e,r)}return c},yA=(e,t,r,n,i,a,o,s,l,u,c)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_tl_parent:n,u_scale_parent:i,u_fade_t:a.mix,u_opacity:a.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(h=o.paint.get("raster-saturation"),h>0?1-1/(1.001-h):-h),u_contrast_factor:(d=o.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:vA(o.paint.get("raster-hue-rotate")),u_perspective_transform:s,u_colorization_mix:u,u_colorization_scale:bA(c),u_color_ramp:l};var d,h};function vA(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}function bA([e,t]){if(e===t)return[e,t];const r=(t+e)/2,n=(t-e)/2*256/255;return[-(e=r-n)/((t=r+n)-e),1/(t-e)]}const xA=gd.create(),TA=(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g)=>{const _=i.transform,y={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:_.getCameraToCenterDistance(m),u_rotate_symbol:+r,u_aspect_ratio:_.width/_.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xA,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xA,u_up_vector:[0,-1,0],u_icon_transition:g||0};return"globe"===m.name&&(y.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],y.u_zoom_transition=d,y.u_inv_rot_matrix=f,y.u_merc_center=h,y.u_camera_forward=_._camera.forward(),y.u_ecef_origin=function(e,t){const r=[0,0,0],n=gh(ih(t.canonical));return Td.transformMat4(r,r,n),Td.transformMat4(r,r,e),r}(_.globeMatrix,c.toUnwrapped()),y.u_tile_matrix=Float32Array.from(_.globeMatrix),y.u_up_vector=p),y},wA=(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g)=>k(TA(e,t,r,n,i,a,o,s,l,u,d,h,f,p,m,g),{u_gamma_scale:n?i.transform.getCameraToCenterDistance(g)*Math.cos(i.terrain?0:i.transform._pitch):1,u_device_pixel_ratio:st.devicePixelRatio,u_is_halo:+c,undefined:void 0}),EA=(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m)=>k(wA(e,t,r,n,i,a,o,s,!0,l,!0,c,d,h,f,p,m),{u_texsize_icon:u,u_texture_icon:1}),AA=(e,t,r,n)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:n}),SA=(e,t,r,n,i,a,o)=>k(function(e,t,r,n){const i=r.imageManager.getPattern(e.toString(),t),{width:a,height:o}=r.imageManager.getPixelSize(t),s=Math.pow(2,n.tileID.overscaledZ),l=n.tileSize*Math.pow(2,r.transform.tileZoom)/s,u=l*(n.tileID.canonical.x+n.tileID.wrap*s),c=l*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[a,o],u_pattern_size:i.displaySize,u_tile_units_to_pixels:1/Hv(n,1,r.transform.tileZoom),u_pixel_coord_upper:[u>>16,c>>16],u_pixel_coord_lower:[65535&u,65535&c]}}(i,a,n,o),{u_matrix:e,u_emissive_strength:t,u_opacity:r}),PA={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},MA=(e,t,r,n,i,a,o,s,l,u,c,d=[0,0,0])=>{const h=n.style.light,f=h.properties.get("position"),p=[-f.x,-f.y,f.z],m=pd.create();"viewport"===h.properties.get("anchor")&&(pd.fromRotation(m,-n.transform.angle),Td.transformMat3(p,p,m));const g="MASK"===u.alphaMode,_=h.properties.get("color"),y=c.paint.get("model-ambient-occlusion-intensity"),v=c.paint.get("model-color").constantOr(ar.white),b=c.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:r,u_lightpos:p,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_camera_pos:d,u_opacity:i,u_baseTextureIsAlpha:0,u_alphaMask:+g,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[a.r,a.g,a.b,a.a],u_emissiveFactor:[o[0],o[1],o[2],1],u_metallicFactor:s,u_roughnessFactor:l,u_baseColorTexture:PA.BaseColor,u_metallicRoughnessTexture:PA.MetallicRoughness,u_normalTexture:PA.Normal,u_occlusionTexture:PA.Occlusion,u_emissionTexture:PA.Emission,u_color_mix:[v.r,v.g,v.b,b],u_aoIntensity:y}},RA=new Float32Array(16),CA=(e,t=RA,r=RA)=>({u_matrix:e,u_instance:t,u_node_matrix:r}),OA={fillExtrusion:e=>({u_matrix:new Ll(e),u_lightpos:new Ml(e),u_lightintensity:new Sl(e),u_lightcolor:new Ml(e),u_vertical_gradient:new Sl(e),u_opacity:new Sl(e),u_edge_radius:new Sl(e),u_ao:new Pl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_up_dir:new Ml(e),u_height_lift:new Sl(e),u_flood_light_color:new Ml(e),u_vertical_scale:new Sl(e),u_flood_light_intensity:new Sl(e),u_ground_shadow_factor:new Ml(e)}),fillExtrusionDepth:e=>({u_matrix:new Ll(e),u_edge_radius:new Sl(e),u_vertical_scale:new Sl(e)}),fillExtrusionPattern:e=>({u_matrix:new Ll(e),u_lightpos:new Ml(e),u_lightintensity:new Sl(e),u_lightcolor:new Ml(e),u_vertical_gradient:new Sl(e),u_height_factor:new Sl(e),u_edge_radius:new Sl(e),u_ao:new Pl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_up_dir:new Ml(e),u_height_lift:new Sl(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Sl(e),u_opacity:new Sl(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Ll(e),u_opacity:new Sl(e),u_ao_pass:new Sl(e),u_meter_to_tile:new Sl(e),u_ao:new Pl(e),u_flood_light_intensity:new Sl(e),u_flood_light_color:new Ml(e),u_attenuation:new Sl(e),u_edge_radius:new Sl(e),u_fb:new Al(e),u_fb_size:new Sl(e)}),fill:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e)}),fillPattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Sl(e)}),fillOutline:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e),u_world:new Pl(e)}),fillOutlinePattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e),u_world:new Pl(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Sl(e)}),circle:e=>({u_camera_to_center_distance:new Sl(e),u_extrude_scale:new Bl(e),u_device_pixel_ratio:new Sl(e),u_matrix:new Ll(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_up_dir:new Ml(e),u_emissive_strength:new Sl(e)}),collisionBox:e=>({u_matrix:new Ll(e),u_camera_to_center_distance:new Sl(e),u_extrude_scale:new Pl(e)}),collisionCircle:e=>({u_matrix:new Ll(e),u_inv_matrix:new Ll(e),u_camera_to_center_distance:new Sl(e),u_viewport_size:new Pl(e)}),debug:e=>({u_color:new Cl(e),u_matrix:new Ll(e),u_overlay:new Al(e),u_overlay_scale:new Sl(e)}),clippingMask:e=>({u_matrix:new Ll(e)}),heatmap:e=>({u_extrude_scale:new Sl(e),u_intensity:new Sl(e),u_matrix:new Ll(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_up_dir:new Ml(e)}),heatmapTexture:e=>({u_image:new Al(e),u_color_ramp:new Al(e),u_opacity:new Sl(e)}),hillshade:e=>({u_matrix:new Ll(e),u_image:new Al(e),u_latrange:new Pl(e),u_light:new Pl(e),u_shadow:new Cl(e),u_highlight:new Cl(e),u_emissive_strength:new Sl(e),u_accent:new Cl(e)}),hillshadePrepare:e=>({u_matrix:new Ll(e),u_image:new Al(e),u_dimension:new Pl(e),u_zoom:new Sl(e),u_unpack:new Rl(e)}),line:e=>({u_matrix:new Ll(e),u_pixels_to_tile_units:new Bl(e),u_device_pixel_ratio:new Sl(e),u_units_to_pixels:new Pl(e),u_dash_image:new Al(e),u_gradient_image:new Al(e),u_image_height:new Sl(e),u_texsize:new Pl(e),u_tile_units_to_pixels:new Sl(e),u_alpha_discard_threshold:new Sl(e),u_trim_offset:new Pl(e),u_emissive_strength:new Sl(e)}),linePattern:e=>({u_matrix:new Ll(e),u_texsize:new Pl(e),u_pixels_to_tile_units:new Bl(e),u_device_pixel_ratio:new Sl(e),u_image:new Al(e),u_units_to_pixels:new Pl(e),u_tile_units_to_pixels:new Sl(e),u_alpha_discard_threshold:new Sl(e)}),raster:e=>({u_matrix:new Ll(e),u_normalize_matrix:new Ll(e),u_globe_matrix:new Ll(e),u_tl_parent:new Pl(e),u_scale_parent:new Sl(e),u_fade_t:new Sl(e),u_opacity:new Sl(e),u_image0:new Al(e),u_image1:new Al(e),u_brightness_low:new Sl(e),u_brightness_high:new Sl(e),u_saturation_factor:new Sl(e),u_contrast_factor:new Sl(e),u_spin_weights:new Ml(e),u_perspective_transform:new Pl(e),u_colorization_mix:new Rl(e),u_colorization_scale:new Pl(e),u_color_ramp:new Al(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Sl(e),u_size:new Sl(e),u_camera_to_center_distance:new Sl(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Sl(e),u_fade_change:new Sl(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_camera_forward:new Ml(e),u_tile_matrix:new Ll(e),u_up_vector:new Ml(e),u_ecef_origin:new Ml(e),u_texture:new Al(e),u_icon_transition:new Sl(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Sl(e),u_size:new Sl(e),u_camera_to_center_distance:new Sl(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Sl(e),u_fade_change:new Sl(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_texture:new Al(e),u_gamma_scale:new Sl(e),u_device_pixel_ratio:new Sl(e),u_tile_id:new Ml(e),u_zoom_transition:new Sl(e),u_inv_rot_matrix:new Ll(e),u_merc_center:new Pl(e),u_camera_forward:new Ml(e),u_tile_matrix:new Ll(e),u_up_vector:new Ml(e),u_ecef_origin:new Ml(e),u_is_halo:new Al(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Sl(e),u_size:new Sl(e),u_camera_to_center_distance:new Sl(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Sl(e),u_fade_change:new Sl(e),u_matrix:new Ll(e),u_label_plane_matrix:new Ll(e),u_coord_matrix:new Ll(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_texsize_icon:new Pl(e),u_texture:new Al(e),u_texture_icon:new Al(e),u_gamma_scale:new Sl(e),u_device_pixel_ratio:new Sl(e),u_is_halo:new Al(e)}),background:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e),u_opacity:new Sl(e),u_color:new Cl(e)}),backgroundPattern:e=>({u_matrix:new Ll(e),u_emissive_strength:new Sl(e),u_opacity:new Sl(e),u_image:new Al(e),u_pattern_tl:new Pl(e),u_pattern_br:new Pl(e),u_texsize:new Pl(e),u_pattern_size:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Sl(e)}),terrainRaster:UE,terrainDepth:UE,skybox:e=>({u_matrix:new Ll(e),u_sun_direction:new Ml(e),u_cubemap:new Al(e),u_opacity:new Sl(e),u_temporal_offset:new Sl(e)}),skyboxGradient:e=>({u_matrix:new Ll(e),u_color_ramp:new Al(e),u_center_direction:new Ml(e),u_radius:new Sl(e),u_opacity:new Sl(e),u_temporal_offset:new Sl(e)}),skyboxCapture:e=>({u_matrix_3f:new Dl(e),u_sun_direction:new Ml(e),u_sun_intensity:new Sl(e),u_color_tint_r:new Rl(e),u_color_tint_m:new Rl(e),u_luminance:new Sl(e)}),globeRaster:e=>({u_proj_matrix:new Ll(e),u_globe_matrix:new Ll(e),u_normalize_matrix:new Ll(e),u_merc_matrix:new Ll(e),u_zoom_transition:new Sl(e),u_merc_center:new Pl(e),u_image0:new Al(e),u_grid_matrix:new Dl(e),u_skirt_height:new Sl(e),u_frustum_tl:new Ml(e),u_frustum_tr:new Ml(e),u_frustum_br:new Ml(e),u_frustum_bl:new Ml(e),u_globe_pos:new Ml(e),u_globe_radius:new Sl(e),u_viewport:new Pl(e)}),globeAtmosphere:e=>({u_frustum_tl:new Ml(e),u_frustum_tr:new Ml(e),u_frustum_br:new Ml(e),u_frustum_bl:new Ml(e),u_horizon:new Sl(e),u_transition:new Sl(e),u_fadeout_range:new Sl(e),u_color:new Rl(e),u_high_color:new Rl(e),u_space_color:new Rl(e),u_temporal_offset:new Sl(e),u_horizon_angle:new Sl(e)}),model:e=>({u_matrix:new Ll(e),u_lighting_matrix:new Ll(e),u_normal_matrix:new Ll(e),u_lightpos:new Ml(e),u_lightintensity:new Sl(e),u_lightcolor:new Ml(e),u_camera_pos:new Ml(e),u_opacity:new Sl(e),u_baseColorFactor:new Rl(e),u_emissiveFactor:new Rl(e),u_metallicFactor:new Sl(e),u_roughnessFactor:new Sl(e),u_baseTextureIsAlpha:new Al(e),u_alphaMask:new Al(e),u_alphaCutoff:new Sl(e),u_baseColorTexture:new Al(e),u_metallicRoughnessTexture:new Al(e),u_normalTexture:new Al(e),u_occlusionTexture:new Al(e),u_emissionTexture:new Al(e),u_color_mix:new Rl(e),u_aoIntensity:new Sl(e)}),modelDepth:e=>({u_matrix:new Ll(e),u_instance:new Ll(e),u_node_matrix:new Ll(e)}),groundShadow:e=>({u_matrix:new Ll(e),u_ground_shadow_factor:new Ml(e)}),stars:e=>({u_matrix:new Ll(e),u_up:new Ml(e),u_right:new Ml(e),u_intensity_multiplier:new Sl(e)})};let LA;function IA(e,t,r,n,i,a,o){const s=e.context,l=s.gl,u=e.transform,c=e.getOrCreateProgram("collisionBox"),d=[];let h=0,f=0;for(let s=0;s<n.length;s++){const p=n[s],m=t.getTile(p),g=m.getBucket(r);if(!g)continue;const _=qw(p,g,u);let y=_;0===i[0]&&0===i[1]||(y=e.translatePosMatrix(_,m,i,a));const v=o?g.textCollisionBox:g.iconCollisionBox,b=g.collisionCircleArray;if(b.length>0){const e=gd.create(),t=y;gd.mul(e,g.placementInvProjMatrix,u.glCoordMatrix),gd.mul(e,e,g.placementViewportMatrix),d.push({circleArray:b,circleOffset:f,transform:t,invTransform:e,projection:g.getProjection()}),h+=b.length/4,f=h}v&&(e.terrain&&e.terrain.setupElevationDraw(m,c),c.draw(e,l.LINES,pv.disabled,gv.disabled,e.colorModeForRenderPass(),xv.disabled,pA(y,u,m,g.getProjection()),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!o||!d.length)return;const p=e.getOrCreateProgram("collisionCircle"),m=new ks;m.resize(4*h),m._trim();let g=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const r=4*t,n=e.circleArray[r+0],i=e.circleArray[r+1],a=e.circleArray[r+2],o=e.circleArray[r+3];m.emplace(g++,n,i,a,o,0),m.emplace(g++,n,i,a,o,1),m.emplace(g++,n,i,a,o,2),m.emplace(g++,n,i,a,o,3)}(!LA||LA.length<2*h)&&(LA=function(e){const t=2*e,r=new Ns;r.resize(t),r._trim();for(let e=0;e<t;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(h));const _=s.createIndexBuffer(LA,!0),y=s.createVertexBuffer(m,Qm.members,!0);for(const t of d){const n={u_matrix:t.transform,u_inv_matrix:t.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(t.projection),u_viewport_size:[v.width,v.height]};p.draw(e,l.TRIANGLES,pv.disabled,gv.disabled,e.colorModeForRenderPass(),xv.disabled,n,r.id,y,_,ul.simpleSegment(0,2*t.circleOffset,t.circleArray.length,t.circleArray.length/2),null,u.zoom)}var v;y.destroy(),_.destroy()}const DA=gd.create();function kA({width:e,height:t,anchor:r,textOffset:n,textScale:i},a){const{horizontalAlign:o,verticalAlign:s}=Og(r),l=-(o-.5)*e,u=-(s-.5)*t,c=l_(r,n);return new y((l/i+c[0])*a,(u/i+c[1])*a)}function BA(e,t,r,n,i,a,o,s,l,u,c){const d=e.text.placedSymbolArray,h=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,p={},m=e.getProjection(),g=Uw(s,m,a),_=a.elevation,y=m.upVectorScale(s.canonical,a.center.lat,a.worldSize).metersToTile;h.clear();for(let f=0;f<d.length;f++){const v=d.get(f),{tileAnchorX:b,tileAnchorY:x,numGlyphs:T}=v,w=v.hidden||!v.crossTileID||e.allowVerticalPlacement&&!v.placedOrientation?null:n[v.crossTileID];if(w){let n=0,d=0,f=0;if(_){const e=_?_.getAtTileOffset(s,b,x):0,[t,r,i]=m.upVector(s.canonical,b,x);n=e*t*y,d=e*r*y,f=e*i*y}let[E,A,S,P]=Jv(v.projectedAnchorX+n,v.projectedAnchorY+d,v.projectedAnchorZ+f,r?g:o);const M=Qv(a.getCameraToCenterDistance(m),P);let R=i.evaluateSizeForFeature(e.textSizeData,u,v)*M/eg;r&&(R*=e.tilePixelRatio/l);const C=kA(w,R);r?(({x:E,y:A,z:S}=m.projectTilePoint(b+C.x,x+C.y,s.canonical)),[E,A,S]=Jv(E+n,A+d,S+f,o)):(t&&C._rotate(-a.angle),E+=C.x,A+=C.y,S=0);const O=e.allowVerticalPlacement&&v.placedOrientation===vg.vertical?Math.PI/2:0;for(let e=0;e<T;e++)ty(h,E,A,S,O);c&&v.associatedIconIndex>=0&&(p[v.associatedIconIndex]={x:E,y:A,z:S,angle:O})}else lb(T,h)}if(c){f.clear();const t=e.icon.placedSymbolArray;for(let e=0;e<t.length;e++){const r=t.get(e),{numGlyphs:n}=r,i=p[e];if(r.hidden||!i)lb(n,f);else{const{x:e,y:t,z:r,angle:a}=i;for(let i=0;i<n;i++)ty(f,e,t,r,a)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(h)}function FA(e,t,r){return r.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function NA(e,t,r,n,i,a,o,s,l,u,c,d){const h=e.context,f=h.gl,p=e.transform,m="map"===s,g="map"===l,_=m&&"point"!==r.layout.get("symbol-placement"),y=m&&!g&&!_,v=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let b=!1;const x=e.depthModeForSublayer(0,pv.ReadOnly),T=[Uh(p.center.lng),jh(p.center.lat)],w=r.layout.get("text-variable-anchor"),E="globe"===p.projection.name,A=[],S=[0,-1,0];let P=S;!E&&!p.mercatorFromTransition||m||(P=function(e){const t=e._camera.getWorldToCamera(e.worldSize,1),r=gd.multiply([],t,e.globeMatrix);gd.invert(r,r);const n=[0,0,0],i=[0,1,0,0];return ld.transformMat4(i,i,r),n[0]=i[0],n[1]=i[1],n[2]=i[2],Td.normalize(n,n),n}(p));for(const s of n){const n=t.getTile(s),l=n.getBucket(r);if(!l)continue;if("mercator"===l.projection.name&&E)continue;const c=i?l.text:l.icon;if(!c||l.fullyClipped||!c.segments.get().length)continue;const d=c.programConfigurations.get(r.id),h=i||l.sdfIcons,x=i?l.textSizeData:l.iconSizeData,M=g||0!==p.pitch,R=ig(x,p.zoom);let C,O,L,I,D=[0,0],k=null;if(i)O=n.glyphAtlasTexture,L=f.LINEAR,C=n.glyphAtlasTexture.size,l.iconsInText&&(D=n.imageAtlasTexture.size,k=n.imageAtlasTexture,I=M||e.options.rotating||e.options.zooming||"composite"===x.kind||"camera"===x.kind?f.LINEAR:f.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;O=n.imageAtlasTexture,L=h||e.options.rotating||e.options.zooming||t||M?f.LINEAR:f.NEAREST,C=n.imageAtlasTexture.size}const B="globe"===l.projection.name,F=B?P:S,N=B?xh(p.zoom):0,q=Uw(s,l.getProjection(),p),U=p.calculatePixelsToTileUnitsMatrix(n),j=Yv(q,n.tileID.canonical,g,m,p,l.getProjection(),U),G=e.terrain&&g&&_?gd.invert(gd.create(),j):DA,z=Kv(q,n.tileID.canonical,g,m,p,l.getProjection(),U),V=w&&l.hasTextData(),$=l.hasIconTextFit()&&V&&l.hasIconData();if(_){const t=p.elevation,r=t?t.getAtTileOffsetFunc(s,p.center.lat,p.worldSize,l.getProjection()):null,a=Zv(q,n.tileID.canonical,g,m,p,l.getProjection(),U);tb(l,q,e,i,a,z,g,u,r,s)}const H=_||i&&w||$,W=e.translatePosMatrix(q,n,a,o),X=H?DA:j,Y=e.translatePosMatrix(z,n,a,o,!0),Z=l.getProjection().createInversionMatrix(p,s.canonical),K=r.paint.get("icon-image-cross-fade").constantOr(0),J=[];e.terrainRenderModeElevated()&&g&&J.push("PITCH_WITH_MAP_TERRAIN"),B&&(J.push("PROJECTION_GLOBE_VIEW"),H&&J.push("PROJECTED_POS_ON_VIEWPORT")),K>0&&J.push("ICON_TRANSITION"),c.zOffsetVertexBuffer&&J.push("Z_OFFSET");const Q=h&&0!==r.paint.get(i?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=h?l.iconsInText?EA(x.kind,R,y,g,e,W,X,Y,C,D,s,N,T,Z,F,l.getProjection()):wA(x.kind,R,y,g,e,W,X,Y,i,C,!0,s,N,T,Z,F,l.getProjection()):TA(x.kind,R,y,g,e,W,X,Y,i,C,s,N,T,Z,F,l.getProjection(),K);const te={program:e.getOrCreateProgram(FA(h,i,l),{config:d,defines:J}),buffers:c,uniformValues:ee,atlasTexture:O,atlasTextureIcon:k,atlasInterpolation:L,atlasInterpolationIcon:I,isSDF:h,hasHalo:Q,tile:n,labelPlaneMatrixInv:G};if(v&&l.canOverlap){b=!0;const e=c.segments.get();for(const t of e)A.push({segments:new ul([t]),sortKey:t.sortKey,state:te})}else A.push({segments:c.segments,sortKey:0,state:te})}b&&A.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of A){const n=t.state;if(e.terrain&&e.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:p.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),h.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(h.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,n.program),n.hasHalo){const i=n.uniformValues;i.u_is_halo=1,qA(n.buffers,t.segments,r,e,n.program,x,c,d,i,2),i.u_is_halo=0}else{if(n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,qA(n.buffers,t.segments,r,e,n.program,x,c,d,i,1)),i.u_is_halo=0}qA(n.buffers,t.segments,r,e,n.program,x,c,d,n.uniformValues,1)}}}function qA(e,t,r,n,i,a,o,s,l,u){const c=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];i.draw(n,n.context.gl.TRIANGLES,a,o,s,xv.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),c,u)}function UA(e,t,r,n,i,a,o){const s=e.context.gl,l=r.paint.get("fill-pattern"),u=l&&l.constantOr(1);let c,d,h,f,p;o?(d=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",c=s.LINES):(d=u?"fillPattern":"fill",c=s.TRIANGLES);for(const m of n){const n=t.getTile(m);if(u&&!n.patternsLoaded())continue;const g=n.getBucket(r);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(r.id),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(d,{config:_,overrideFog:y});u&&(e.context.activeTexture.set(s.TEXTURE0),n.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),_.updatePaintBuffers());const b=l.constantOr(null);if(b&&n.imageAtlas){const e=n.imageAtlas.patternPositions[b.toString()];e&&_.setConstantPatternPositions(e)}const x=e.translatePosMatrix(m.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),T=r.paint.get("fill-emissive-strength");if(o){f=g.indexBuffer2,p=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[s.drawingBufferWidth,s.drawingBufferHeight];h="fillOutlinePattern"===d&&u?fA(x,T,e,n,t):hA(x,T,t)}else f=g.indexBuffer,p=g.segments,h=u?dA(x,T,e,n):cA(x,T);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,c,i,e.stencilModeForClipping(m),a,xv.disabled,h,r.id,g.layoutVertexBuffer,f,p,r.paint,e.transform.zoom,_,void 0)}}function jA(e,t,r,n,i,a,o,s){const l=e.context,u=l.gl,c=e.transform,d=r.paint.get("fill-extrusion-pattern"),h=d.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),p=e.style.enable3dLights(),m=r.paint.get(p&&!h?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],_=r.layout.get("fill-extrusion-edge-radius"),y=_>0&&!r.paint.get("fill-extrusion-rounded-roof"),v=y?0:_,b="globe"===c.projection.name?_x():0,x="globe"===c.projection.name,T=x?xh(c.zoom):0,w=[Uh(c.center.lng),jh(c.center.lat)],E=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),A=r.paint.get("fill-extrusion-flood-light-intensity"),S=r.paint.get("fill-extrusion-vertical-scale"),P=zE(e,r.paint.get("fill-extrusion-cutoff-fade-range")),M=[];let R;x&&M.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&M.push("FAUX_AO"),y&&M.push("ZERO_ROOF_RADIUS"),s&&M.push("HAS_CENTROID"),A>0&&M.push("FLOOD_LIGHT"),P.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const C="shadow"===e.renderPass,O=e.shadowRenderer,L=C&&!!O;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let I=[0,0,0];if(O){const t=e.style.directionalLight,r=e.style.ambientLight;t&&r&&(I=DS(t,r)),R=M.concat(["SHADOWS_SINGLE_CASCADE"])}const D=L?"fillExtrusionDepth":h?"fillExtrusionPattern":"fillExtrusion";for(const p of n){const n=t.getTile(p),m=n.getBucket(r);if(!m||m.projection.name!==c.projection.name)continue;let _=!1;O&&(_=0===O.getMaxCascadeForTile(p.toUnwrapped()));const y=e.isTileAffectedByFog(p),L=m.programConfigurations.get(r.id),k=e.getOrCreateProgram(D,{config:L,defines:_?R:M,overrideFog:y});if(e.terrain){const t=e.terrain;e.style.terrainSetForDrapingOnly(),t.setupElevationDraw(n,k,{useMeterToDem:!0})}if(!m.centroidVertexBuffer){const e=k.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!C&&O&&O.setupShadows(n.tileID.toUnwrapped(),k,"vector-tile",n.tileID.overscaledZ),h&&(e.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),L.updatePaintBuffers());const B=d.constantOr(null);if(B&&n.imageAtlas){const e=n.imageAtlas.patternPositions[B.toString()];e&&L.setConstantPatternPositions(e)}const F=r.paint.get("fill-extrusion-vertical-gradient");let N;if(C&&O){if(WA(n.tileID,m,e))continue;const t=O.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());N=lA(t,v,S)}else{const t=e.translatePosMatrix(p.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=c.projection.createInversionMatrix(c,p.canonical);N=h?uA(t,e,F,f,g,v,p,n,b,T,w,i,E,S):sA(t,e,F,f,g,v,p,b,T,w,i,E,S,A,I)}e.uploadCommonUniforms(l,k,p.toUnwrapped(),null,P);const q=[];(e.terrain||s)&&q.push(m.centroidVertexBuffer),x&&q.push(m.layoutVertexExtBuffer),k.draw(e,l.gl.TRIANGLES,i,a,o,xv.backCCW,N,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,e.transform.zoom,L,q)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function GA(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g,_,y){const v=e.context,b=v.gl,x=e.transform,T=e.transform.zoom,w=[],E=zE(e,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(w.push("CLEAR_SUBPASS"),y&&(w.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(b.TEXTURE0),y.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&w.push("SDF_SUBPASS"),g&&w.push("HAS_CENTROID"),E.shouldRenderCutoff&&w.push("RENDER_CUTOFF");const A=r.layout.get("fill-extrusion-edge-radius"),S=(t,n,u,_,b)=>{const x=n.programConfigurations.get(r.id),S=e.isTileAffectedByFog(t),P=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:x,defines:w,overrideFog:S}),M=((e,t,r,n,i,a,o,s,l,u,c)=>({u_matrix:t,u_opacity:r,u_ao_pass:n?1:0,u_meter_to_tile:i,u_ao:a,u_flood_light_intensity:o,u_flood_light_color:s,u_attenuation:l,u_edge_radius:u,u_fb:0,u_fb_size:c}))(0,_,c,l,b,[d,h*b],f,p,m,T>=17?0:A*b,y?y.size[0]:0),R=[];g&&R.push(n.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(v,P,t.toUnwrapped(),null,E),P.draw(e,v.gl.TRIANGLES,i,a,o,s,M,r.id,n.vertexBuffer,n.indexBuffer,u,r.paint,T,x,R)};for(const i of n){const n=t.getTile(i),a=n.getBucket(r);if(!a||a.projection.name!==x.projection.name||!a.groundEffect||a.groundEffect&&!a.groundEffect.hasData())continue;const o=a.groundEffect,s=1/a.tileToMeter;{const t=e.translatePosMatrix(i.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),a=o.getDefaultSegment();S(i,o,a,t,s)}if(_)for(let a=0;a<4;a++){const o=Bd[a](i),l=t.getTile(o);if(!l)continue;const u=l.getBucket(r);if(!u||u.projection.name!==x.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const c=u.groundEffect;let d,h;0===a?(d=[-nn,0,0],h=1):1===a?(d=[nn,0,0],h=0):2===a?(d=[0,-nn,0],h=3):(d=[0,nn,0],h=2);const f=c.regionSegments[h];if(!f)continue;const p=new Float32Array(16);gd.translate(p,i.projMatrix,d),S(i,c,f,e.translatePosMatrix(p,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),s)}}}function zA(e,t,r,n,i,a,o){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const s=a?a.findDEMTileFor(r):null;if(!(s&&s.dem||o))return;const l=e=>{const r=t.getSource().minzoom,n=e=>{const r=t.getTileByID(e);if(r&&r.hasData())return r.getBucket(i)},a=[0,-1,1];for(const t of a){if(e.overscaledZ+t<r)continue;const i=n(e.calculateScaledKey(e.overscaledZ+t));if(i)return i}},u=[0,0,0],c=(e,t)=>(u[0]=Math.min(e.min.y,t.min.y),u[1]=Math.max(e.max.y,t.max.y),u[2]=nn-t.min.x>e.max.x?t.min.x-nn:e.max.x,u),d=(e,t)=>(u[0]=Math.min(e.min.x,t.min.x),u[1]=Math.max(e.max.x,t.max.x),u[2]=nn-t.min.y>e.max.y?t.min.y-nn:e.max.y,u),h=[(e,t)=>c(e,t),(e,t)=>c(t,e),(e,t)=>d(e,t),(e,t)=>d(t,e)],f=(e,t,n,i,o,l,u)=>{if(!a)return 0;const c=[[l?n:e,l?e:n,0],[l?n:t,l?t:n,0]],d=u<0?nn+u:u,h=[l?d:(e+t)/2,l?(e+t)/2:d,0];return 0===n&&u<0||0!==n&&u>0?a.getForTilePoints(o,[h],!0,i):c.push(h),a.getForTilePoints(r,c,!0,s),Math.max(c[0][2],c[1][2],h[2])/a.exaggeration()};for(let e=0;e<4;e++){const t=n.borderFeatureIndices[e];if(0===t.length)continue;const i=Bd[e](r),s=l(i);if(!(s&&s instanceof ux))continue;if(n.borderDoneWithNeighborZ[e]===s.canonical.z)continue;0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const u=a?a.findDEMTileFor(i):null;if(!(u&&u.dem||o))continue;const c=(e<2?1:5)-e,d=s.borderDoneWithNeighborZ[c]!==n.canonical.z,_=s.borderFeatureIndices[c];let v=0;if(n.canonical.z!==s.canonical.z){for(const e of t)n.showCentroid(n.featuresOnBorder[e]);if(d)for(const e of _)s.showCentroid(s.featuresOnBorder[e]);n.borderDoneWithNeighborZ[e]=s.canonical.z,s.borderDoneWithNeighborZ[c]=n.canonical.z}for(const r of t){const t=n.featuresOnBorder[r],a=n.centroidData[t.centroidDataIndex],l=t.borders[e];let d;for(;v<_.length;){d=s.featuresOnBorder[_[v]];const e=d.borders[c];if(e[1]>l[0]+3||e[0]>l[0]-3)break;s.showCentroid(d),v++}if(d&&v<_.length){const r=v;let b=0;for(;!(d.borders[c][0]>l[1]-3)&&(b++,++v!==_.length);)d=s.featuresOnBorder[_[v]];if(d=s.featuresOnBorder[_[r]],b>1){const e=d.borders[c];Math.abs(l[0]-e[0])<3&&Math.abs(l[1]-e[1])<3&&(b=1,v=r+1)}else if(0===b){n.showCentroid(t);continue}const x=s.centroidData[d.centroidDataIndex];o&&1===b&&(((m=a).flags|(g=x).flags)&Jb?(m.flags|=Jb,g.flags|=Jb):(m.flags&=2147483647,g.flags&=2147483647));let T=new y(0,0);if(b>1)v=r;else if(u&&u.dem&&!(t.intersectsCount()>1||d.intersectsCount()>1)){const t=h[e](a,x),r=e%2?nn-1:0;p=f(t[0],Math.min(nn-1,t[1]),r,u,i,e<2,t[2]),T=new y(Math.ceil(7*(p+450)),0)}a.centroidXY=x.centroidXY=T,n.writeCentroidToBuffer(a),s.writeCentroidToBuffer(x)}else n.showCentroid(t)}n.borderDoneWithNeighborZ[e]=s.canonical.z,s.borderDoneWithNeighborZ[c]=n.canonical.z}var p,m,g;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(e)}const VA=[1,0,0],$A=[0,1,0],HA=[0,0,1];function WA(e,t,r){const n=r.transform,i=r.shadowRenderer;if(!i)return!0;const a=e.toUnwrapped(),o=n.tileSize*i._cascades[r.currentShadowCascade].scale;let s=t.maxHeight;if(n.elevation){const t=n.elevation.getMinMaxForTile(e);t&&(s+=t.max)}const l=[...i.shadowDirection];l[2]=-l[2];const u=i.computeSimplifiedTileShadowVolume(a,s,o,l);if(!u)return!1;const c=[VA,$A,HA,l,[l[0],0,l[2]],[0,l[1],l[2]]],d="globe"===n.projection.name,h=n.scaleZoom(o),f=zd.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,h,!d),p=i.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,c)||0===p.intersectsPrecise(u.vertices,u.planes,c)}const XA=new ar(1,0,0,1),YA=new ar(0,1,0,1),ZA=new ar(0,0,1,1),KA=new ar(1,0,1,1),JA=new ar(0,1,1,1);function QA(e,t,r){const n=e.context,i=e.transform,a=n.gl,o="globe"===i.projection.name,s=o?["PROJECTION_GLOBE_VIEW"]:[];let l=r.projMatrix;if(o&&xh(i.zoom)>0){const e=_h(oh(r.canonical,i));l=gd.multiply(new Float32Array(16),i.globeMatrix,e),gd.multiply(l,i.projMatrix,l)}const u=e.getOrCreateProgram("debug",{defines:s}),c=t.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(c,u);const d=pv.disabled,h=gv.disabled,f=e.colorModeForRenderPass(),p="$debug";n.activeTexture.set(a.TEXTURE0),e.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o?c._makeGlobeTileDebugBuffers(e.context,i):c._makeDebugTileBoundsBuffers(e.context,i.projection);const m=c._tileDebugBuffer||e.debugBuffer,g=c._tileDebugIndexBuffer||e.debugIndexBuffer,_=c._tileDebugSegments||e.debugSegments;u.draw(e,a.LINE_STRIP,d,h,f,xv.disabled,mA(l,ar.red),p,m,g,_,null,null,null,[c._globeTileDebugBorderBuffer]);const y=c.latestRawTileData,v=Math.floor((y&&y.byteLength||0)/1024),b=t.getTile(r).tileSize,x=512/Math.min(b,512)*(r.overscaledZ/i.zoom)*.5;let T=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(T+=` => ${r.overscaledZ}`),T+=` ${v}kb`,function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,n=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,T);const w=c._tileDebugTextBuffer||e.debugBuffer,E=c._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,A=c._tileDebugTextSegments||e.debugSegments;u.draw(e,a.TRIANGLES,d,h,yv.alphaBlended,xv.disabled,mA(l,ar.transparent,x),p,w,E,A,null,null,null,[c._globeTileDebugTextBuffer])}function eS(e,t,r,n){rS(e,0,t+r/2,e.transform.width,r,n)}function tS(e,t,r,n){rS(e,t-r/2,0,r,e.transform.height,n)}function rS(e,t,r,n,i,a){const o=e.context,s=o.gl;s.enable(s.SCISSOR_TEST),s.scissor(t*st.devicePixelRatio,r*st.devicePixelRatio,n*st.devicePixelRatio,i*st.devicePixelRatio),o.clear({color:a}),s.disable(s.SCISSOR_TEST)}const nS=ys([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:iS}=nS;function aS(e,t,r,n){e.emplaceBack(t,r,n)}class oS{constructor(e){this.vertexArray=new Fs,this.indices=new Ns,aS(this.vertexArray,-1,-1,1),aS(this.vertexArray,1,-1,1),aS(this.vertexArray,-1,1,1),aS(this.vertexArray,1,1,1),aS(this.vertexArray,-1,-1,-1),aS(this.vertexArray,1,-1,-1),aS(this.vertexArray,-1,1,-1),aS(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,iS),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=ul.simpleSegment(0,0,36,12)}}function sS(e,t,r,n,i,a){const o=e.context.gl,s=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),u=t.paint.get("sky-atmosphere-sun-intensity"),c=((e,t,r,n,i)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:r,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(pd.fromMat4(pd.create(),n),i,u,s,l);o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+a,t.skyboxTexture,0),r.draw(e,o.TRIANGLES,pv.disabled,gv.disabled,yv.unblended,xv.frontCW,c,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const lS=ys([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class uS{constructor(e){const t=new Gs;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);const r=new Ns;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,lS.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=ul.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const cS=ys([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class dS{constructor(){this.colorModeAlphaBlendedWriteRGB=new yv([1,_v,1,_v],ar.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yv([1,0,1,0],ar.transparent,[!1,!1,!1,!0])}update(e){const t=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new uS(t);const e=100,r=200,n=function(e){const t=zi(30),r=[];for(let e=0;e<16e3;++e){const e=2*Math.PI*t(),n=Math.acos(1-2*t())-.5*Math.PI;r.push(Td.fromValues(Math.cos(n)*Math.cos(e),Math.cos(n)*Math.sin(e),Math.sin(n)))}return r}(),i=zi(300),a=new zs,o=new Ns;let s=0;for(let t=0;t<n.length;++t){const l=Td.scale([],n[t],200),u=Math.max(0,1+.01*e*(1*i()-.5)),c=Math.max(0,1+.01*r*(1*i()-.5));a.emplaceBack(l[0],l[1],l[2],-1,-1,u,c),a.emplaceBack(l[0],l[1],l[2],1,-1,u,c),a.emplaceBack(l[0],l[1],l[2],1,1,u,c),a.emplaceBack(l[0],l[1],l[2],-1,1,u,c),o.emplaceBack(s+0,s+1,s+2),o.emplaceBack(s+0,s+2,s+3),s+=4}this.starsVx=t.createVertexBuffer(a,cS.members),this.starsIdx=t.createIndexBuffer(o),this.starsSegments=ul.simpleSegment(0,0,a.length,o.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,t){const r=e.context,n=r.gl,i=e.transform,a=new pv(n.LEQUAL,pv.ReadOnly,[0,1]),o=xh(i.zoom),s=t.properties.get("color").toArray01(),l=t.properties.get("high-color").toArray01(),u=t.properties.get("space-color").toArray01PremultipliedAlpha(),c=5e-4,d=C((t.properties.get("horizon-blend")-0)/1*.2495+c,5e-4,.25),h=wh(e,r,i)&&d===c?i.worldSize/(2*Math.PI*1.025)-1:i.globeRadius,f=e.frameCounter/1e3%1,p=Td.length(i.globeCenterInViewSpace),m=Math.sqrt(Math.pow(p,2)-Math.pow(h,2)),g=Math.acos(m/p),_=t=>{const c="globe"===i.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&c.push("ALPHA_PASS");const h=e.getOrCreateProgram("globeAtmosphere",{defines:c}),p=((e,t,r,n,i,a,o,s,l,u,c,d)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:r,u_frustum_bl:n,u_horizon:i,u_transition:a,u_fadeout_range:o,u_color:s,u_high_color:l,u_space_color:u,u_temporal_offset:c,u_horizon_angle:d}))(i.frustumCorners.TL,i.frustumCorners.TR,i.frustumCorners.BR,i.frustumCorners.BL,i.frustumCorners.horizon,o,d,s,l,u,f,g);e.uploadCommonUniforms(r,h);const m=this.atmosphereBuffer;m&&h.draw(e,n.TRIANGLES,a,gv.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,xv.backCW,p,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};_(!1),_(!0)}drawStars(e,t){const r=C(t.properties.get("star-intensity"),0,1);if(0===r)return;const n=e.context,i=n.gl,a=e.transform,o=e.getOrCreateProgram("stars"),s=yd.identity([]);yd.rotateX(s,s,-a._pitch),yd.rotateZ(s,s,-a.angle),yd.rotateX(s,s,T(a._center.lat)),yd.rotateY(s,s,-T(a._center.lng));const l=gd.fromQuat(new Float32Array(16),s),u=gd.multiply([],a.starsProjMatrix,l),c=pd.fromMat4([],l),d=pd.invert([],c),h=[0,1,0];Td.transformMat3(h,h,d),Td.scale(h,h,.15);const f=[1,0,0];Td.transformMat3(f,f,d),Td.scale(f,f,.15);const p=((e,t,r,n)=>({u_matrix:Float32Array.from(e),u_up:t,u_right:r,u_intensity_multiplier:n}))(u,h,f,r);e.uploadCommonUniforms(n,o),this.starsVx&&this.starsIdx&&o.draw(e,i.TRIANGLES,pv.disabled,gv.disabled,this.colorModeAlphaBlendedWriteRGB,xv.disabled,p,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function hS(e,t){const r=[...e],n=t.cameraWorldSizeForFog/t.worldSize,i=gd.identity([]);return gd.scale(i,i,[n,n,1]),gd.multiply(r,i,r),gd.multiply(r,t.worldToFogMatrix,r),r}function fS(e,t,r,n){const i=r.material,a=n.context,{baseColorTexture:o,metallicRoughnessTexture:s}=i.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:u,emissionTexture:c}=i;function d(t,r,n){if(t&&(e.push(r),a.activeTexture.set(a.gl.TEXTURE0+n),t.gfxTexture)){const{minFilter:e,magFilter:r,wrapS:n,wrapT:i}=t.sampler;t.gfxTexture.bindExtraParam(e,r,n,i)}}d(o,"HAS_TEXTURE_u_baseColorTexture",PA.BaseColor),d(s,"HAS_TEXTURE_u_metallicRoughnessTexture",PA.MetallicRoughness),d(l,"HAS_TEXTURE_u_normalTexture",PA.Normal),d(u,"HAS_TEXTURE_u_occlusionTexture",PA.Occlusion),d(c,"HAS_TEXTURE_u_emissionTexture",PA.Emission),r.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(e.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==i.alphaMode&&"MASK"!==i.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),i.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function pS(e,t,r,n,i,a){const o=r.paint.get("model-opacity"),s=t.context,l=new pv(t.context.gl.LEQUAL,pv.ReadWrite,t.depthRangeFor3D),u=t.transform,c=e.mesh,d=c.material,h=d.pbrMetallicRoughness,f=t.style.fog;let p;p="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:gd.multiply([],n.zScaleMatrix,e.nodeModelMatrix),gd.multiply(p,n.negCameraPosMatrix,p);const m=gd.invert([],p);gd.transpose(m,m);const g=MA(new Float32Array(e.worldViewProjection),new Float32Array(p),new Float32Array(m),t,o,h.baseColorFactor,d.emissiveFactor,h.metallicFactor,h.roughnessFactor,d,r),_={defines:[]},y=[];fS(_.defines,y,c,t);const v=t.shadowRenderer;v&&(v.useNormalOffset=!1);let b=null;if(f){const r=hS(e.nodeModelMatrix,t.transform);if(b=new Float32Array(r),"globe"!==u.projection.name){const e=c.aabb.min,t=c.aabb.max,[n,i]=f.getOpacityForBounds(r,e[0],e[1],t[0],t[1]);_.overrideFog=n>=nT||i>=nT}}const x=zE(t,r.paint.get("model-cutoff-fade-range"));x.shouldRenderCutoff&&_.defines.push("RENDER_CUTOFF");const T=t.getOrCreateProgram("model",_);t.uploadCommonUniforms(s,T,null,b,x),"shadow"!==t.renderPass&&v&&v.setupShadowsFromMatrix(e.nodeModelMatrix,T),T.draw(t,s.gl.TRIANGLES,l,i,a,c.material.doubleSided?xv.disabled:xv.backCCW,g,r.id,c.vertexBuffer,c.indexBuffer,c.segments,r.paint,t.transform.zoom,void 0,y)}function mS(e,t,r,n,i,a,o){let s;s="globe"===e.projection.name?mb(r,e):[...r],gd.multiply(s,s,t.matrix);const l=gd.multiply([],n,s);if(t.meshes)for(const e of t.meshes){if("BLEND"!==e.material.alphaMode){o.push({mesh:e,depth:0,modelIndex:i,worldViewProjection:l,nodeModelMatrix:s});continue}const t=Td.transformMat4([],e.centroid,l);t[2]>0&&a.push({mesh:e,depth:t[2],modelIndex:i,worldViewProjection:l,nodeModelMatrix:s})}if(t.children)for(const s of t.children)mS(e,s,r,n,i,a,o)}function gS(e,t,r,n){const i=r.shadowRenderer;if(!i)return;const a=i.getShadowPassDepthMode(),o=i.getShadowPassColorMode(),s=i.calculateShadowPassMatrixFromMatrix(t),l=CA(s);r.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,a,gv.disabled,o,xv.backCCW,l,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,r.transform.zoom,void 0,void 0)}function _S(e,t,r){const n=t.updateZoomBasedPaintProperties(),i=function(e,t,r){let n,i,a,o=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&o>0){const t=e.terrain,i=t.findDEMTileFor(r);i&&i.dem?n=jm.create(t,r,i):o=0}if(0===o&&(t.terrainElevationMin=0,t.terrainElevationMax=0),o===t.validForExaggeration&&(0===o||n&&n._demTile&&n._demTile.tileID===t.validForDEMTile.id&&n._dem._timestamp===t.validForDEMTile.timestamp))return!1;for(const e in t.instancesPerModel){const r=t.instancesPerModel[e];for(let e=0;e<r.instancedDataArray.length;++e){const s=(n?o*n.getElevationAt(0|r.instancedDataArray.float32[16*e],0|r.instancedDataArray.float32[16*e+1],!0,!0):0)+r.instancesEvaluatedElevation[e];r.instancedDataArray.float32[16*e+6]=s,i=i?Math.min(t.terrainElevationMin,s):s,a=a?Math.max(t.terrainElevationMax,s):s}}return t.terrainElevationMin=i||0,t.terrainElevationMax=a||0,t.validForExaggeration=o,t.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,r);(n||i)&&(t.uploaded=!1,t.upload(e.context))}const yS={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new Vd([0,0,0],[nn,nn,0])};function vS(e,t){const r=1<<e.canonical.z,n=t.getFreeCameraOptions().position,i=t.elevation,a=e.canonical.x/r,o=(e.canonical.x+1)/r,s=e.canonical.y/r,l=(e.canonical.y+1)/r;let u=t._centerAltitude;if(i){const t=i.getMinMaxForTile(e);t&&t.max>u&&(u=t.max)}const c=C(n.x,a,o)-n.x,d=C(n.y,s,l)-n.y,h=Gh(u,t.center.lat)-n.z;return t._zoomFromMercatorZ(Math.sqrt(c*c+d*d+h*h))}function bS(e,t,r,n,i,a,o){const s=e.context,l="shadow"===e.renderPass,u=e.shadowRenderer,c=l&&u?u.getShadowPassDepthMode():new pv(s.gl.LEQUAL,pv.ReadWrite,e.depthRangeFor3D),d=e.isTileAffectedByFog(a);if(r.meshes)for(const h of r.meshes){const f=["MODEL_POSITION_ON_GPU"],p=[];let m,g,_;n.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const y=zE(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&u)m=e.getOrCreateProgram("modelDepth",{defines:f}),g=CA(o.shadowTileMatrix,o.shadowTileMatrix,Float32Array.from(r.matrix)),_=u.getShadowPassColorMode();else{fS(f,p,h,e),m=e.getOrCreateProgram("model",{defines:f,overrideFog:d});const n=h.material,l=n.pbrMetallicRoughness,c=t.paint.get("model-opacity");g=MA(a.projMatrix,Float32Array.from(r.matrix),new Float32Array(16),e,c,l.baseColorFactor,n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,t,i),u&&(o.shadowUniformsInitialized?m.setShadowUniformValues(s,u.getShadowUniformValues()):(u.setupShadows(a.toUnwrapped(),m,"model-tile",a.overscaledZ),o.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||c<1||"OPAQUE"!==n.alphaMode?yv.alphaBlended:yv.unblended}e.uploadCommonUniforms(s,m,a.toUnwrapped(),null,y);const v=h.material.doubleSided?xv.disabled:xv.backCCW;if(n.instancedDataArray.length>20)p.push(n.instancedDataBuffer),m.draw(e,s.gl.TRIANGLES,c,gv.disabled,_,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,p,n.instancedDataArray.length);else{const r=l?"u_instance":"u_normal_matrix";for(let i=0;i<n.instancedDataArray.length;++i)g[r]=new Float32Array(n.instancedDataArray.arrayBuffer,64*i,16),m.draw(e,s.gl.TRIANGLES,c,gv.disabled,_,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,p)}}if(r.children)for(const s of r.children)bS(e,t,s,n,i,a,o)}const xS=[1,-1,1];function TS(e,t,r,n){if(!r.modelManager)return!0;const i=r.modelManager;if(!r.shadowRenderer)return!0;const a=r.shadowRenderer,o=t.aabb;let s=!0,l=e.maxHeight;if(0===l){let t=0;for(const r in e.instancesPerModel){const e=i.getModel(r,n);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):s=!1}l=e.maxScale*t*1.41+e.maxVerticalOffset,s&&(e.maxHeight=l)}o.max[2]=l,o.min[2]+=e.terrainElevationMin,o.max[2]+=e.terrainElevationMax,Td.transformMat4(o.min,o.min,t.tileMatrix),Td.transformMat4(o.max,o.max,t.tileMatrix);const u=o.intersects(a.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===u),0===u}class wS{}class ES{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,t,r){{const r=this._storage.get(t.id);if(r)return r.lastUsedFrameIdx=e,r.buf}const n=r.gl,i=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),a=new ArrayBuffer(i),o=new Int16Array(a);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const s=new Ls;for(let e=0;e<i/2;e+=3){const t=o[e],r=o[e+1],n=o[e+2];s.emplaceBack(t,r),s.emplaceBack(r,n),s.emplaceBack(n,t)}const l=r.bindVertexArrayOES.current,u=new wS;return u.buf=new Py(r,s),u.lastUsedFrameIdx=e,this._storage.set(t.id,u),r.bindVertexArrayOES.set(l),u.buf}update(e){for(const[t,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const AS={symbol:function(e,t,r,n,i){if("translucent"!==e.renderPass)return;const a=gv.disabled,o=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,t,r,n,i,a,o){const s=t.transform,l="map"===i,u="map"===a;for(const t of e){const e=n.getTile(t),i=e.getBucket(r);if(!i||!i.text||!i.text.segments.get().length)continue;const a=ig(i.textSizeData,s.zoom),c=Uw(t,i.getProjection(),s),d=s.calculatePixelsToTileUnitsMatrix(e),h=Yv(c,e.tileID.canonical,u,l,s,i.getProjection(),d),f=i.hasIconTextFit()&&i.hasIconData();if(a){const r=Math.pow(2,s.zoom-e.tileID.overscaledZ);BA(i,l,u,o,ag,s,h,t,r,a,f)}}}(n,e,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),i),0!==r.paint.get("icon-opacity").constantOr(1)&&NA(e,t,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,o),0!==r.paint.get("text-opacity").constantOr(1)&&NA(e,t,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,o),t.map.showCollisionBoxes&&(IA(e,t,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),IA(e,t,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,r,n){if("translucent"!==e.renderPass)return;const i=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),o=r.paint.get("circle-stroke-opacity"),s=void 0!==r.layout.get("circle-sort-key").constantOr(1),l=r.paint.get("circle-emissive-strength");if(0===i.constantOr(1)&&(0===a.constantOr(1)||0===o.constantOr(1)))return;const u=e.context,c=u.gl,d=e.transform,h=e.depthModeForSublayer(0,pv.ReadOnly),f=gv.disabled,p=e.colorModeForDrapableLayerRenderPass(l),m="globe"===d.projection.name,g=[Uh(d.center.lng),jh(d.center.lat)],_=[];for(let i=0;i<n.length;i++){const a=n[i],o=t.getTile(a),l=o.getBucket(r);if(!l||l.projection.name!==d.projection.name)continue;const u=l.programConfigurations.get(r.id),c=If(r),h=e.isTileAffectedByFog(a);m&&c.push("PROJECTION_GLOBE_VIEW");const f=e.getOrCreateProgram("circle",{config:u,defines:c,overrideFog:h}),p=l.layoutVertexBuffer,y=l.globeExtVertexBuffer,v=l.indexBuffer,b=d.projection.createInversionMatrix(d,a.canonical),x={programConfiguration:u,program:f,layoutVertexBuffer:p,globeExtVertexBuffer:y,indexBuffer:v,uniformValues:Lf(e,a,o,b,g,r),tile:o};if(s){const e=l.segments.get();for(const t of e)_.push({segments:new ul([t]),sortKey:t.sortKey,state:x})}else _.push({segments:l.segments,sortKey:0,state:x})}s&&_.sort(((e,t)=>e.sortKey-t.sortKey));const y={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const t of _){const{programConfiguration:n,program:i,layoutVertexBuffer:a,globeExtVertexBuffer:o,indexBuffer:s,uniformValues:l,tile:m}=t.state,g=t.segments;e.terrain&&e.terrain.setupElevationDraw(m,i,y),e.uploadCommonUniforms(u,i,m.tileID.toUnwrapped()),i.draw(e,c.TRIANGLES,h,f,p,xv.disabled,l,r.id,a,s,g,r.paint,d.zoom,n,[o])}},heatmap:function(e,t,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const i=e.context,a=i.gl,o=gv.disabled,s=new yv([a.ONE,a.ONE,a.ONE,a.ONE],ar.transparent,[!0,!0,!0,!0]);!function(e,t,r,n){const i=e.gl,a=t.width*n,o=t.height*n;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,a,o]);let s=r.heatmapFbo;if(!s||s&&(s.width!==a||s.height!==o)){s&&s.destroy();const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),s=r.heatmapFbo=e.createFramebuffer(a,o,!0,null),function(e,t,r,n,i,a){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,i,a,0,o.RGBA,e.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),n.colorAttachment.set(r)}(e,0,t,s,a,o)}else i.bindTexture(i.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(i,e,r,"globe"===e.transform.projection.name?.5:.25),i.clear({color:ar.transparent});const l=e.transform,u="globe"===l.projection.name,c=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?xv.frontCCW:xv.disabled,h=[Uh(l.center.lng),jh(l.center.lat)];for(let f=0;f<n.length;f++){const p=n[f];if(t.hasRenderableParent(p))continue;const m=t.getTile(p),g=m.getBucket(r);if(!g||g.projection.name!==l.projection.name)continue;const _=e.isTileAffectedByFog(p),y=g.programConfigurations.get(r.id),v=e.getOrCreateProgram("heatmap",{config:y,defines:c,overrideFog:_}),{zoom:b}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(i,v,p.toUnwrapped());const x=l.projection.createInversionMatrix(l,p.canonical);v.draw(e,a.TRIANGLES,pv.disabled,o,s,d,_A(e,p,m,x,h,b,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,e.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}i.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,t){const r=e.context,n=r.gl,i=t.heatmapFbo;if(!i)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let a=t.colorRampTexture;a||(a=t.colorRampTexture=new py(r,t.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,n.TRIANGLES,pv.disabled,gv.disabled,e.colorModeForRenderPass(),xv.disabled,((e,t,r,n)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,t),t.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,t.paint,e.transform.zoom)}(e,r))},line:function(e,t,r,n){if("translucent"!==e.renderPass)return;const i=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0===i.constantOr(1)||0===a.constantOr(1))return;const o=r.paint.get("line-emissive-strength"),s=e.depthModeForSublayer(0,pv.ReadOnly),l=e.colorModeForDrapableLayerRenderPass(o),u=e.terrain&&e.terrain.renderingToTexture?1:st.devicePixelRatio,c=r.paint.get("line-dasharray"),d=c.constantOr(1),h=r.layout.get("line-cap"),f=r.paint.get("line-pattern"),p=f.constantOr(1),m=r.paint.get("line-pattern").constantOr(1),g=1!==r.paint.get("line-opacity").constantOr(1);let _=!m&&g;const y=r.paint.get("line-gradient"),v=p?"linePattern":"line",b=e.context,x=b.gl,T=Lx(r);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(_=!1);for(const i of n){const n=t.getTile(i);if(p&&!n.patternsLoaded())continue;const a=n.getBucket(r);if(!a)continue;e.prepareDrawTile();const o=a.programConfigurations.get(r.id),m=e.isTileAffectedByFog(i),g=e.getOrCreateProgram(v,{config:o,defines:T,overrideFog:m}),w=f.constantOr(null);if(w&&n.imageAtlas){const e=n.imageAtlas.patternPositions[w.toString()];e&&o.setConstantPatternPositions(e)}const E=c.constantOr(null),A=h.constantOr(null);if(!p&&E&&A&&n.lineAtlas){const e=n.lineAtlas.getDash(E,A);e&&o.setConstantPatternPositions(e)}let[S,P]=r.paint.get("line-trim-offset");if("round"===A||"square"===A){const e=1;S!==P&&(0===S&&(S-=e),1===P&&(P+=e))}const M=e.terrain?i.projMatrix:null,R=p?Rx(e,n,r,M,u):Mx(e,n,r,M,a.lineClipsArray.length,u,[S,P]);if(y){const n=a.gradients[r.id];let o=n.texture;if(r.gradientVersion!==n.version){let s=256;if(r.stepInterpolant){const r=t.getSource().maxzoom,n=i.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-i.canonical.z):1;s=C(U(a.maxLineLength/nn*1024*n),256,b.maxTextureSize)}n.gradient=Xf({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new py(b,n.gradient,x.RGBA),n.version=r.gradientVersion,o=n.texture}b.activeTexture.set(x.TEXTURE1),o.bind(r.stepInterpolant?x.NEAREST:x.LINEAR,x.CLAMP_TO_EDGE)}d&&(b.activeTexture.set(x.TEXTURE0),n.lineAtlasTexture.bind(x.LINEAR,x.REPEAT),o.updatePaintBuffers()),p&&(b.activeTexture.set(x.TEXTURE0),n.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),o.updatePaintBuffers()),e.uploadCommonUniforms(b,g,i.toUnwrapped());const O=t=>{g.draw(e,x.TRIANGLES,s,t,l,xv.disabled,R,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,r.paint,e.transform.zoom,o,[a.layoutVertexBuffer2])};if(_){const t=e.stencilModeForClipping(i).ref;0===t&&e.terrain&&b.clear({stencil:0});const r={func:x.EQUAL,mask:255};R.u_alpha_discard_threshold=.8,O(new gv(r,t,255,x.KEEP,x.KEEP,x.INVERT)),R.u_alpha_discard_threshold=0,O(new gv(r,t,255,x.KEEP,x.KEEP,x.KEEP))}else O(e.stencilModeForClipping(i))}_&&(e.resetStencilClippingMasks(),e.terrain&&b.clear({stencil:0}))},fill:function(e,t,r,n){const i=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0===a.constantOr(1))return;const o=r.paint.get("fill-emissive-strength"),s=e.colorModeForDrapableLayerRenderPass(o),l=r.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===i.constantOr(ar.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const i=e.depthModeForSublayer(1,"opaque"===e.renderPass?pv.ReadWrite:pv.ReadOnly);UA(e,t,r,n,i,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const i=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,pv.ReadOnly);UA(e,t,r,n,i,s,!0)}},"fill-extrusion":function(e,t,r,n){const i=r.paint.get("fill-extrusion-opacity"),a=e.context,o=a.gl,s=e.terrain,l=s&&s.renderingToTexture,u=r.paint.get("fill-extrusion-cutoff-fade-range");if(0===i)return;const c=e.conflationActive&&e.layerUsedInConflation(r,t.getSource());if(c&&function(e,t,r,n){for(const i of n){const n=t.getTile(i).getBucket(r);n&&(n.updateReplacement(i,e.replacementSource),n.uploadCentroid(e.context))}}(e,t,r,n),s||c)for(const i of n){const n=t.getTile(i).getBucket(r);n&&zA(e.context,t,i,n,r,s,c)}if("shadow"===e.renderPass&&e.shadowRenderer){const a=e.shadowRenderer;if(s&&i<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof _a)return;const o=a.getShadowPassDepthMode(),l=a.getShadowPassColorMode();jA(e,t,r,n,o,gv.disabled,l,c)}else if("translucent"===e.renderPass){const d=!r.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const a=new pv(e.context.gl.LEQUAL,pv.ReadWrite,e.depthRangeFor3D);0===u&&1===i&&d?jA(e,t,r,n,a,gv.disabled,yv.unblended,c):(jA(e,t,r,n,a,gv.disabled,yv.disabled,c),jA(e,t,r,n,a,e.stencilModeFor3D(),e.colorModeForRenderPass(),c),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&d&&(!s&&"globe"!==e.transform.projection.name||l)){const i=r.paint.get("fill-extrusion-opacity"),u=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),h=r.paint.get("fill-extrusion-flood-light-intensity"),f=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),p=u>0&&d>0,m=h>0,g=(e,t,r)=>(1-r)*e+r*t,_=a=>{const s=e.depthModeForSublayer(1,pv.ReadOnly,o.LEQUAL,!0),l=r.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=g(.1,3,l),m=e._showOverdrawInspector;if(!m){const l=new gv({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),m=new yv([o.ONE,o.ONE,o.ONE,o.ONE],ar.transparent,[!1,!1,!1,!0],o.MIN);GA(e,t,r,n,s,l,m,xv.disabled,a,"sdf",i,u,d,h,f,p,c,!1)}{const l=m?gv.disabled:new gv({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),g=m?e.colorModeForRenderPass():new yv([o.ONE_MINUS_DST_ALPHA,o.DST_ALPHA,o.ONE,o.ONE],ar.transparent,[!0,!0,!0,!0]);GA(e,t,r,n,s,l,g,xv.disabled,a,"color",i,u,d,h,f,p,c,!1)}};if(l){const l=(a,s,l)=>{const p=e.depthModeForSublayer(1,pv.ReadOnly,o.LEQUAL,!1),m=r.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_=g(.1,3,m);{const l=new yv([o.ONE,o.ONE,o.ONE,o.ONE],ar.transparent,[!1,!1,!1,!0]);GA(e,t,r,n,p,gv.disabled,l,xv.disabled,a,"clear",i,u,d,h,f,_,c,s)}{const l=new gv({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),m=new yv([o.ONE,o.ONE,o.ONE,o.ONE],ar.transparent,[!1,!1,!1,!0],o.MIN);GA(e,t,r,n,p,l,m,xv.disabled,a,"sdf",i,u,d,h,f,_,c,s)}{const l=a?o.ZERO:o.ONE_MINUS_DST_ALPHA,m=new gv({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),g=new yv([l,o.DST_ALPHA,o.ONE_MINUS_DST_ALPHA,o.ZERO],ar.transparent,[!0,!0,!0,!0]);GA(e,t,r,n,p,m,g,xv.disabled,a,"color",i,u,d,h,f,_,c,s)}{const m=new yv([o.ONE,o.ONE,o.ONE,a?o.ZERO:o.ONE],ar.transparent,[!1,!1,!1,!0],a?o.FUNC_ADD:o.MAX);GA(e,t,r,n,p,gv.disabled,m,xv.disabled,a,"clear",i,u,d,h,f,_,c,s,l)}};if(p||m){let t;if(e.prepareDrawTile(),s){const e=s.drapeBufferSize[0],r=s.drapeBufferSize[1];t=s.framebufferCopyTexture,t&&(!t||t.size[0]===e&&t.size[1]===r)||(t&&t.destroy(),t=s.framebufferCopyTexture=new py(a,new Vf({width:e,height:r}),o.RGBA)),t.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,e,r,0)}p&&l(!0,!1,t),m&&l(!1,!0,t)}}else p&&_(!0),m&&_(!1)}}},hillshade:function(e,t,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const i=e.context,a=e.terrain&&e.terrain.renderingToTexture,[o,s]="translucent"!==e.renderPass||a?[{},n]:e.stencilConfigForOverlap(n);for(const n of s){const i=t.getTile(n);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)qE(e,i,r);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,pv.ReadOnly),s=r.paint.get("hillshade-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(s),u=a&&e.terrain?e.terrain.stencilModeForRTTOverlap(n):o[n.overscaledZ];FE(e,n,i,r,t,u,l)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,r,n,i,a){if("translucent"!==e.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const o=e.context,s=o.gl,l=t.getSource(),u=function(e,t,r){const n=[];let i,a;if(e.paint.get("raster-color")){n.push("RASTER_COLOR"),i=e.paint.get("raster-color-mix"),a=e.paint.get("raster-color-range"),t.activeTexture.set(r.TEXTURE2);let o=e.colorRampTexture;o||(o=e.colorRampTexture=new py(t,e.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE)}return{mix:i,range:a,defines:n}}(r,o,s),c=u.defines;let d=!1;if(l instanceof jx&&!n.length){if("globe"!==e.transform.projection.name)return;if(l.onNorthPole)d=!0,c.push("PROJECTION_GLOBE_VIEW");else{if(!l.onSouthPole)return;d=!0,c.push("PROJECTION_GLOBE_VIEW")}}const h=e.colorModeForDrapableLayerRenderPass(),f=e.terrain&&e.terrain.renderingToTexture,p=!e.options.moving,m="nearest"===r.paint.get("raster-resampling")?s.NEAREST:s.LINEAR;if(d){const n=t.getSource();if(!(n instanceof jx))return;const i=n.texture;if(!i)return;const a=e.globeSharedBuffers;if(!a)return;const l=new pv(s.LEQUAL,pv.ReadWrite,e.depthRangeFor3D),c=Float32Array.from(e.transform.projMatrix);let d=Th(0,0,e.transform);const f=Float32Array.from(gh(ih(new Ld(0,0,0)))),p={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),i.bind(m,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),i.bind(m,s.CLAMP_TO_EDGE),i.useMipmap&&o.extTextureFilterAnisotropic&&e.transform.pitch>20&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax);const[g,_,y,v]=a.getPoleBuffers(0,!0);let b;n.onNorthPole?(b=g,e.renderDefaultNorthPole=!1):(d=gd.scale(gd.create(),d,[1,-1,1]),b=_,e.renderDefaultSouthPole=!1);const x=yA(c,f,d,[0,0],1,p,r,n.perspectiveTransform||[0,0],2,u.mix||[0,0,0,0],u.range||[0,0]),T=e.getOrCreateProgram("raster",{defines:u.defines});return e.uploadCommonUniforms(o,T,null),void T.draw(e,s.TRIANGLES,l,gv.disabled,h,xv.disabled,x,r.id,b,y,v)}if(!n.length)return;const[g,_]=l instanceof jx||f?[{},n]:e.stencilConfigForOverlap(n),y=_[_.length-1].overscaledZ;for(const n of _){const i=f?pv.disabled:e.depthModeForSublayer(n.overscaledZ-y,1===r.paint.get("raster-opacity")?pv.ReadWrite:pv.ReadOnly,s.LESS),c=n.toUnwrapped(),d=t.getTile(n);if(f&&(!d||!d.hasData()))continue;if(!d.texture)continue;const _=f?n.projMatrix:e.transform.calculateProjMatrix(c,p),v=e.terrain&&f?e.terrain.stencilModeForRTTOverlap(n):g[n.overscaledZ],b=a?0:r.paint.get("raster-fade-duration");d.registerFadeDuration(b);const x=t.findLoadedParent(n,0),T=ZE(d,x,t,e.transform,b);let w,E;e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),d.texture.bind(m,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),x?(x.texture.bind(m,s.CLAMP_TO_EDGE),w=Math.pow(2,x.tileID.overscaledZ-d.tileID.overscaledZ),E=[d.tileID.canonical.x*w%1,d.tileID.canonical.y*w%1]):d.texture.bind(m,s.CLAMP_TO_EDGE),d.texture.useMipmap&&o.extTextureFilterAnisotropic&&e.transform.pitch>20&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax);const A=l instanceof jx?l.perspectiveTransform:[0,0],S=new Float32Array(16),P=yA(_,S,S,E||[0,0],w||1,T,r,A,2,u.mix||[0,0,0,0],u.range||[0,0]),M=e.isTileAffectedByFog(n),R=e.getOrCreateProgram("raster",{defines:u.defines,overrideFog:M});if(e.uploadCommonUniforms(o,R,c),l instanceof jx)l.boundsBuffer&&l.boundsSegments&&R.draw(e,s.TRIANGLES,i,gv.disabled,h,xv.disabled,P,r.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:n,tileBoundsSegments:a}=e.getTileBoundsBuffers(d);R.draw(e,s.TRIANGLES,i,v,h,xv.disabled,P,r.id,t,n,a)}}e.resetStencilClippingMasks()},background:function(e,t,r,n){const i=r.paint.get("background-color"),a=r.paint.get("background-opacity"),o=r.paint.get("background-emissive-strength");if(0===a)return;const s=e.context,l=s.gl,u=e.transform,c=u.tileSize,d=r.paint.get("background-pattern");if(e.isPatternMissing(d,r.scope))return;const h=!d&&1===i.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==h)return;const f=gv.disabled,p=e.depthModeForSublayer(0,"opaque"===h?pv.ReadWrite:pv.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(o),g=d?"backgroundPattern":"background";let _,y=n;y||(_=e.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),d&&(s.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,r.scope));for(const h of y){const y=e.isTileAffectedByFog(h),v=e.getOrCreateProgram(g,{overrideFog:y}),b=h.toUnwrapped(),x=n?h.projMatrix:e.transform.calculateProjMatrix(b);e.prepareDrawTile();const T=t?t.getTile(h):_?_[h.key]:new Ay(h,c,u.zoom,e),w=d?SA(x,o,a,e,d,r.scope,{tileID:h,tileSize:c}):AA(x,o,a,i);e.uploadCommonUniforms(s,v,b);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:A,tileBoundsSegments:S}=e.getTileBoundsBuffers(T);v.draw(e,l.TRIANGLES,p,f,m,xv.disabled,w,r.id,E,A,S)}},sky:function(e,t,r){const n=e._atmosphere?xh(e.transform.zoom):1,i=r.paint.get("sky-opacity")*n;if(0===i)return;const a=e.context,o=r.paint.get("sky-type"),s=new pv(a.gl.LEQUAL,pv.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,t,r,n){const i=e.context,a=i.gl;let o=t.skyboxFbo;if(!o){o=t.skyboxFbo=i.createFramebuffer(32,32,!0,null),t.skyboxGeometry=new oS(i),t.skyboxTexture=i.gl.createTexture(),a.bindTexture(a.TEXTURE_CUBE_MAP,t.skyboxTexture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR);for(let e=0;e<6;++e)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,a.RGBA,32,32,0,a.RGBA,a.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(o.framebuffer),i.viewport.set([0,0,32,32]);const s=t.getCenter(e,!0),l=e.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);gd.identity(u),gd.rotateY(u,u,.5*-Math.PI),sS(e,t,l,u,s,0),gd.identity(u),gd.rotateY(u,u,.5*Math.PI),sS(e,t,l,u,s,1),gd.identity(u),gd.rotateX(u,u,.5*-Math.PI),sS(e,t,l,u,s,2),gd.identity(u),gd.rotateX(u,u,.5*Math.PI),sS(e,t,l,u,s,3),gd.identity(u),sS(e,t,l,u,s,4),gd.identity(u),gd.rotateY(u,u,Math.PI),sS(e,t,l,u,s,5),i.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,t,r,n,i){const a=e.context,o=a.gl,s=e.transform,l=e.getOrCreateProgram("skybox");a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture);const u=((e,t,r,n,i)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:i}))(s.skyboxMatrix,t.getCenter(e,!1),0,n,i);e.uploadCommonUniforms(a,l),l.draw(e,o.TRIANGLES,r,gv.disabled,e.colorModeForRenderPass(),xv.backCW,u,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,r,s,i,l):"gradient"===o&&"sky"===e.renderPass&&function(e,t,r,n,i){const a=e.context,o=a.gl,s=e.transform,l=e.getOrCreateProgram("skyboxGradient");t.skyboxGeometry||(t.skyboxGeometry=new oS(a)),a.activeTexture.set(o.TEXTURE0);let u=t.colorRampTexture;u||(u=t.colorRampTexture=new py(a,t.colorRamp,o.RGBA)),u.bind(o.LINEAR,o.CLAMP_TO_EDGE);const c=((e,t,r,n,i)=>({u_matrix:e,u_color_ramp:0,u_center_direction:t,u_radius:T(r),u_opacity:n,u_temporal_offset:i}))(s.skyboxMatrix,t.getCenter(e,!1),t.paint.get("sky-gradient-radius"),n,i);e.uploadCommonUniforms(a,l),l.draw(e,o.TRIANGLES,r,gv.disabled,e.colorModeForRenderPass(),xv.backCW,c,"skyboxGradient",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,r,s,i,l)},debug:function(e,t,r){for(let n=0;n<r.length;n++)QA(e,t,r[n])},custom:function(e,t,r,n){const i=e.context,a=r.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&r.isLayerDraped(t)){if("offscreen"===e.renderPass){const t=a.prerender;if(t){if(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const r=e.transform.pointMerc;t.call(a,i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),xh(e.transform.zoom),[r.x,r.y],e.transform.pixelsPerMeterRatio)}else t.call(a,i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const t=a.renderToTile;if(t){const r=n[0].canonical,o=new Kh(r.x+n[0].wrap*(1<<r.z),r.y,r.z);i.setDepthMode(pv.disabled),i.setStencilMode(gv.disabled),i.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(a,i.gl,o),i.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(gv.disabled);const t="3d"===a.renderingMode?new pv(e.context.gl.LEQUAL,pv.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,pv.ReadOnly);if(i.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;a.render(i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),xh(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else a.render(i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}else X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,r,n){if("opaque"===e.renderPass)return;const i=r.paint.get("model-opacity");if(0===i)return;const a=r.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!a)return;if(e.terrain&&i<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof _a)return}const o=e.shadowRenderer,s=r.paint.get("model-receive-shadows");o&&(o.useNormalOffset=!0,s||(o.enabled=!1));const l=()=>{o&&(o.useNormalOffset=!0,s||(o.enabled=!0))},u=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,t,r,n){const i=e.transform;if("mercator"!==i.projection.name)return void X(`Drawing 3D models for ${i.projection.name} projection is not yet implemented`);const a=i.getFreeCameraOptions().position;if(!e.modelManager)return;const o=e.modelManager,s=e.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const l=r._unevaluatedLayout._values["model-id"],u={...r.layout.get("model-id").parameters};for(const c of n){const n=t.getTile(c).getBucket(r);if(!n||n.projection.name!==i.projection.name)continue;const d=vS(c,i);u.zoom=d;const h=l.possiblyEvaluate(u);if(_S(e,n,c),yS.shadowUniformsInitialized=!1,yS.useSingleShadowCascade=!!s&&0===s.getMaxCascadeForTile(c.toUnwrapped()),"shadow"===e.renderPass&&s){if(1===e.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const t=i.calculatePosMatrix(c.toUnwrapped(),i.worldSize);if(yS.tileMatrix.set(t),yS.shadowTileMatrix=Float32Array.from(s.calculateShadowPassMatrixFromMatrix(t)),yS.aabb.min.fill(0),yS.aabb.max[0]=yS.aabb.max[1]=nn,yS.aabb.max[2]=0,TS(n,yS,e,r.scope))continue}const f=1<<c.canonical.z,p=[((a.x-c.wrap)*f-c.canonical.x)*nn,(a.y*f-c.canonical.y)*nn,a.z*f*nn];for(let t in n.instancesPerModel){const i=n.instancesPerModel[t];i.features.length>0&&(t=h.evaluate(i.features[0].feature,{}));const a=o.getModel(t,r.scope);if(a&&a.uploaded)for(const t of a.nodes)bS(e,r,t,i,p,c,yS)}}}(e,t,r,n),void l();if(!u.loaded())return;if("batched-model"===u.type)return function(e,t,r,n){const i=e.context,a=e.transform,o=e.style.fog,s=e.shadowRenderer;if("mercator"!==a.projection.name)return void X(`Drawing 3D landmark models for ${a.projection.name} projection is not yet implemented`);const l=e.transform.getFreeCameraOptions().position,u=Td.scale([],[l.x,l.y,l.z],e.transform.worldSize);Td.negate(u,u);const c=gd.identity([]),d=Xh(a.center.lat,a.zoom),h=gd.fromScaling([],[1,1,1/d]);gd.translate(c,c,u);const f=r.paint.get("model-opacity"),p=new pv(i.gl.LEQUAL,pv.ReadWrite,e.depthRangeFor3D),m=new pv(i.gl.LEQUAL,pv.ReadOnly,e.depthRangeFor3D),g=function(l,u){for(const d of n){const n=t.getTile(d).getBucket(r);if(!n||!n.uploaded)continue;let g=!1;s&&(g=0===s.getMaxCascadeForTile(d.toUnwrapped()));const _=a.calculatePosMatrix(d.toUnwrapped(),a.worldSize),y=n.modelTraits;for(const t of n.getNodesInfo()){if(t.hiddenByReplacement)continue;if(!t.node.meshes)continue;const n=t.node,v="light-beam"===e.renderPass,b=[..._],x=t.evaluatedScale;let T=0;e.terrain&&n.elevation&&(T=n.elevation*e.terrain.exaggeration()),gd.translate(b,b,[(n.anchor?n.anchor[0]:0)*(x[0]-1),(n.anchor?n.anchor[1]:0)*(x[1]-1),T]),x!==_b&&gd.scale(b,b,x),gd.multiply(b,b,n.matrix);const w=gd.multiply([],h,b);gd.multiply(w,c,w);const E=gd.invert([],w);gd.transpose(E,E),gd.scale(E,E,xS);const A=gd.multiply([],a.projMatrix,b);for(let c=0;c<n.meshes.length;++c){const h=n.meshes[c],_=c===n.lightMeshIndex;if(_){if(!v&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(v)continue;const x={defines:[]},T=[];fS(x.defines,T,h,e),4&y||x.defines.push("DIFFUSE_SHADED"),g&&x.defines.push("SHADOWS_SINGLE_CASCADE");const S="shadow"===e.renderPass;if(S){gS(h,b,e,r);continue}let P=null;if(o){const t=hS(b,e.transform);if(P=new Float32Array(t),"globe"!==a.projection.name){const e=h.aabb.min,r=h.aabb.max,[n,i]=o.getOpacityForBounds(t,e[0],e[1],r[0],r[1]);x.overrideFog=n>=nT||i>=nT}}const M=e.getOrCreateProgram("model",x);!S&&s&&(s.useNormalOffset=!!h.normalBuffer,s.setupShadowsFromMatrix(b,M,s.useNormalOffset)),e.uploadCommonUniforms(i,M,d.toUnwrapped(),P);const R=h.material,C=R.pbrMetallicRoughness;C.metallicFactor=.9,C.roughnessFactor=.5;const O=MA(new Float32Array(A),new Float32Array(w),new Float32Array(E),e,f,C.baseColorFactor,R.emissiveFactor,C.metallicFactor,C.roughnessFactor,R,r);M.draw(e,i.gl.TRIANGLES,u&&!_?p:m,gv.disabled,l?_||f<1||t.hasTranslucentParts?yv.alphaBlended:yv.unblended:yv.disabled,xv.backCCW,O,r.id,h.vertexBuffer,h.indexBuffer,h.segments,r.paint,e.transform.zoom,void 0,T)}}}};(function(e,t,r,n){const i=e.terrain?e.terrain.exaggeration():0,a=e.transform.zoom;for(const o of n){const n=t.getTile(o).getBucket(r);n&&(e.conflationActive&&n.updateReplacement(o,e.replacementSource),n.evaluateScale(e,r),e.terrain&&i>0&&n.elevationUpdate(e.terrain,i,o,r.source),n.needsReEvaluation(e,a,r)&&n.evaluate(r))}})(e,t,r,n),1===f?g(!0,!0):(g(!1,!0),g(!0,!1))}(e,t,r,n),void l();const c=u.getModels(),d=[],h=e.transform.getFreeCameraOptions().position,f=Td.scale([],[h.x,h.y,h.z],e.transform.worldSize);Td.negate(f,f);const p=[],m=[];let g=0;for(const t of c){const n=r.paint.get("model-rotation").constantOr(null),i=r.paint.get("model-scale").constantOr(null),a=r.paint.get("model-translation").constantOr(null);t.computeModelMatrix(e,n,i,a,!0,!0,!1);const o=gd.identity([]),s=Xh(t.position.lat,e.transform.zoom),l=gd.fromScaling([],[1,1,1/s]);gd.translate(o,o,f),d.push({zScaleMatrix:l,negCameraPosMatrix:o});for(const r of t.nodes)mS(e.transform,r,t.matrix,e.transform.projMatrix,g,p,m);g++}if(p.sort(((e,t)=>t.depth-e.depth)),"shadow"!==e.renderPass){if(1===i)for(const t of m)pS(t,e,r,d[t.modelIndex],gv.disabled,e.colorModeForRenderPass());else{for(const t of m)pS(t,e,r,d[t.modelIndex],gv.disabled,yv.disabled);for(const t of m)pS(t,e,r,d[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of p)pS(t,e,r,d[t.modelIndex],gv.disabled,e.colorModeForRenderPass());l()}else{for(const t of m)gS(t.mesh,t.nodeModelMatrix,e,r);for(const t of p)gS(t.mesh,t.nodeModelMatrix,e,r);l()}}},SS={modelUpload:function(e,t,r){const n=t.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(e.modelManager&&e.modelManager.upload(e,r));if("batched-model"===n.type)return;const i=n.getModels();for(const t of i)t.upload(e.context)}};class PS{constructor(e,t){this.context=new Tv(e),this.transform=t,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=wv.maxUnderzooming+wv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new Nb,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new OS(this),this._wireframeDebugCache=new ES,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new eA(this,e));const n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,t),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=t.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const i=r+.78*(n-r);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,t){if(this.width=e*st.devicePixelRatio,this.height=t*st.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const e=this.context,r=new bs;r.emplaceBack(0,0),r.emplaceBack(nn,0),r.emplaceBack(0,nn),r.emplaceBack(nn,nn),this.tileExtentBuffer=e.createVertexBuffer(r,Rd.members),this.tileExtentSegments=ul.simpleSegment(0,0,4,2);const n=new bs;n.emplaceBack(0,0),n.emplaceBack(nn,0),n.emplaceBack(0,nn),n.emplaceBack(nn,nn),this.debugBuffer=e.createVertexBuffer(n,Rd.members),this.debugSegments=ul.simpleSegment(0,0,4,5);const i=new bs;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(i,Rd.members),this.viewportSegments=ul.simpleSegment(0,0,4,2);const a=new Ts;a.emplaceBack(0,0,0,0),a.emplaceBack(nn,0,nn,0),a.emplaceBack(0,nn,0,nn),a.emplaceBack(nn,nn,nn,nn),this.mercatorBoundsBuffer=e.createVertexBuffer(a,wy.members),this.mercatorBoundsSegments=ul.simpleSegment(0,0,4,2);const o=new Ns;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(o);const s=new $s;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new py(e,new Vf({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=gd.create();const l=this.context.gl;this.stencilClearMode=new gv({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,pv.disabled,this.stencilClearMode,yv.disabled,xv.disabled,YE(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,r){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const n=this.context,i=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(yv.disabled),n.setDepthMode(pv.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of r){const r=t.getTile(e),n=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:o,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=this.getTileBoundsBuffers(r);a.draw(this,i.TRIANGLES,pv.disabled,new gv({func:i.ALWAYS,mask:0},n,255,i.KEEP,i.KEEP,i.REPLACE),yv.disabled,xv.disabled,YE(e.projMatrix),"$clipping",o,s,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new gv({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new gv({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,r=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=r[r.length-1].overscaledZ,i=r[0].overscaledZ-n+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let r=0;r<i;r++)e[r+n]=new gv({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,r]}return[{[n]:gv.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const t=1/8;return new yv([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new ar(t,t,t,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?yv.unblended:yv.alphaBlended}colorModeForDrapableLayerRenderPass(e){const t=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new yv([t.ONE,t.ONE_MINUS_SRC_ALPHA,t.CONSTANT_ALPHA,t.ONE_MINUS_SRC_ALPHA],new ar(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,r,n=!1){if(!this.opaquePassEnabledForLayer()&&!n)return pv.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new pv(r||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=r;const n=this.style._mergedLayers,i=this.style.order,a=i.map((e=>n[e])),o=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(st.now()),this.imageManager.beginFrame();let s=0,l=!1;for(const e in o){const t=o[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++s)}const u={},c={},d={},h={},f={};for(const e in o){const t=o[e];u[e]=t.getVisibleCoordinates(),c[e]=u[e].slice().reverse(),d[e]=t.getVisibleCoordinates(!0).reverse(),h[e]=t.getShadowCasterCoordinates(),f[e]=t.sortCoordinatesByDistance(u[e])}const p=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(s){const e=[];for(const t of a)this.layerUsedInConflation(t,p(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const r of e){const e=this.style.getLayerSourceCache(r);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:r.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of a){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=p(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<a.length;e++)if(a[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(d),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in o)for(const t of u[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Lh(this.context));for(const t of a){if(t.isHidden(this.transform.zoom))continue;const r=e.getLayerSourceCache(t);this.uploadLayer(this,t,r)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dS),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Xe.has(this.context.gl))return;this.renderPass="offscreen";for(const t of a){const r=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=r?c[r.id]:void 0;("custom"===t.type||"raster"===t.type||t.isSky()||n&&n.length)&&this.renderLayer(this,r,t,n)}this.depthRangeFor3D=[0,1-(a.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,h)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(r.showOverdrawInspector)return ar.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const e=this.style.fog.properties.get("color").toArray01();return new ar(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const e=this.style.fog.properties.get("space-color").toArray01();return new ar(...e)}return ar.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);if(t.isSky())continue;const n=r?(t.is3D()?f:c)[r.id]:void 0;this._renderTileClippingMasks(t,r,n),this.renderLayer(this,r,t,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||xh(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,r,t,r?c[r.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(g&&(b=g.getShadowCastingLayerCount());this.currentLayer<i.length;){const t=a[this.currentLayer],r=e.getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(_&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer);continue}let n;if(r&&(n=("symbol"===t.type?d:t.is3D()?f:c)[r.id]),this._renderTileClippingMasks(t,r,r?u[r.id]:void 0),this.renderLayer(this,r,t,n),!_&&g&&b>0&&t.hasShadowPass()&&0==--b&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=a[this.currentLayer];if(!t.hasLightBeamPass())continue;const r=e.getLayerSourceCache(t);this.renderLayer(this,r,t,r?c[r.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let t=null;a.forEach((r=>{const n=e.getLayerSourceCache(r);n&&!r.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!t||t.getSource().maxzoom<n.getSource().maxzoom)&&(t=n)})),t&&this.options.showTileBoundaries&&AS.debug(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;eS(e,e.transform.height-(t.top||0),3,XA),eS(e,t.bottom||0,3,YA),tS(e,t.left||0,3,ZA),tS(e,e.transform.width-(t.right||0),3,KA);const r=e.transform.centerPoint;!function(e,t,r,n){rS(e,t-1,r-10,2,20,n),rS(e,t-10,r-1,20,2,n)}(e,r.x,e.transform.height-r.y,JA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(e,t,r){this.gpuTimingStart(t),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(t.type)||e.terrain&&"custom"===t.type)&&SS[`${t.type}Upload`]&&SS[`${t.type}Upload`](e,r,t.scope),this.gpuTimingEnd()}renderLayer(e,t,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(r.type)||e.terrain&&"custom"===r.type)&&AS[r.type](e,t,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,r=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(t.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,r=t.createQuery();this.deferredRenderGpuTimeQueries.push(r),t.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const r in e){const n=e[r],i=this.context.extTimerQuery,a=i.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;i.deleteQueryEXT(n.query),t[r]=a}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,r=this.context.gl;let n=0;for(const i of e)n+=t.getQueryParameter(i,r.QUERY_RESULT)/1e6,t.deleteQueryEXT(i);return n}translatePosMatrix(e,t,r,n,i){if(!r[0]&&!r[1])return e;const a=i?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const o=[i?r[0]:Hv(t,r[0],this.transform.zoom),i?r[1]:Hv(t,r[1],this.transform.zoom),0],s=new Float32Array(16);return gd.translate(s,e,o),s}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,r){const n=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,i=this.terrain&&0===this.terrain.exaggeration(),a=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(a.push("LIGHTING_3D_MODE"),a.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||a.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||a.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):a.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(a.push("TERRAIN"),this.terrainUseFloatDEM()&&a.push("TERRAIN_DEM_FLOAT_FORMAT"),i&&a.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&a.push("GLOBE"),!this._fogVisible||n||void 0!==t&&!t||a.push("FOG","FOG_DITHERING"),n&&a.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&a.push("OVERDRAW_INSPECTOR"),a}getOrCreateProgram(e,t){this.cache=this.cache||{};const r=t&&t.defines||[],n=t&&t.config,i=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(r),a=iA.cacheKey(LE[e],e,i,n);return this.cache[a]||(this.cache[a]=new iA(this.context,e,LE[e],n,OA[e],i)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new py(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,t){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const i=((e,t)=>{const r=e.properties.get("direction"),n=e.properties.get("color").toArray01(),i=e.properties.get("intensity"),a=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),s=[r.x,r.y,r.z],l=oe(a,o),u=oe(n,i);return{u_lighting_ambient_color:l,u_lighting_directional_dir:s,u_lighting_directional_color:u,u_ground_radiance:tA(s,u,l)}})(r,n);t.setLightsUniformValues(e,i)}}}uploadCommonUniforms(e,t,r,n,i){if(this.uploadCommonLightUniforms(e,t),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const i=a.getOpacity(this.transform.pitch),o=((e,t,r,n,i,a,o,s,l,u,c,d)=>{const h=e.transform,f=t.properties.get("color").toArray01();f[3]=n;const p=e.frameCounter/1e3%1,[m,g]=t.properties.get("vertical-range");return{u_fog_matrix:r?h.calculateFogTileMatrix(r):d||e.identityMat,u_fog_range:t.getFovAdjustedRange(h._fov),u_fog_color:f,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,g),g],u_fog_temporal_offset:p,u_frustum_tl:i,u_frustum_tr:a,u_frustum_br:o,u_frustum_bl:s,u_globe_pos:l,u_globe_radius:u,u_viewport:c,u_globe_transition:xh(h.zoom),u_is_globe:+("globe"===h.projection.name)}})(this,a,r,i,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*st.devicePixelRatio,this.transform.height*st.devicePixelRatio],n);t.setFogUniformValues(e,o)}i&&t.setCutoffUniformValues(e,i.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)t[n.key]=e[n.key]||new Ay(n,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=nT||t[1]>=nT}}const MS=2048;class RS{constructor(e,t){this.aabb=e,this.lastCascade=t}}class CS{add(e,t){const r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],t.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],t.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],t.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],t.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],t.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],t.max[2])):this.receivers[e.key]=new RS(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,t,r){const n=Vd.fromPoints(e.points);let i=0;for(const e in this.receivers){const a=this.receivers[e];if(!a)continue;if(!n.intersectsAabb(a.aabb))continue;a.aabb.min=n.closestPoint(a.aabb.min),a.aabb.max=n.closestPoint(a.aabb.max);const o=a.aabb.getCorners();for(let e=0;e<r.length;e++){let n=!0;for(const i of o){const a=[i[0]*t,i[1]*t,i[2]];if(Td.transformMat4(a,a,r[e].matrix),a[0]<-1||a[0]>1||a[1]<-1||a[1]>1){n=!1;break}}if(a.lastCascade=e,i=Math.max(i,e),n)break}}return i+1}}class OS{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new CS,this._depthMode=new pv(e.context.gl.LEQUAL,pv.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,t){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!t||!t.properties)return;const n=t.properties.get("shadow-intensity");if(!t.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=r.style.order.reduce(((t,n)=>{const i=r.style._mergedLayers[n];return t+(i.hasShadowPass()&&!i.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const i=r.context,a=MS,o=MS;if(0===this._cascades.length)for(let e=0;e<2;++e){const e=r._shadowMapDebug,t=i.gl,n=i.createFramebuffer(a,o,e,"texture"),s=new py(i,{width:a,height:o,data:null},t.DEPTH_COMPONENT);if(n.depthAttachment.set(s.texture),e){const e=new py(i,{width:a,height:o,data:null},t.RGBA);n.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:n,texture:s,matrix:[],far:0,boundingSphereRadius:0,frustum:new zd,scale:0})}this.shadowDirection=IS(t);let s=0;if(e.elevation){const t=e.elevation,r=[1e4,-1e4];t.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;r[0]=Math.min(r[0],t.minimums[0]),r[1]=Math.max(r[1],t.maximums[0])})),1e4!==r[0]&&(s=(r[1]-r[0])*t.exaggeration())}const l=1.5*e.cameraToCenterDistance,u=3*l,c=new Float64Array(16);for(let t=0;t<2;++t){const r=this._cascades[t];let n=e.height/50,i=1;0===t?i=l:(n=l,i=u);const[a,o]=kS(e,this.shadowDirection,n,i,MS,s);r.scale=e.scale,r.matrix=a,r.boundingSphereRadius=o,gd.invert(c,r.matrix),r.frustum=zd.fromInvProjectionMatrix(c,1,0,!0),r.far=i}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=MS,this._uniformValues.u_shadowmap_0=PA.ShadowMap0,this._uniformValues.u_shadowmap_1=PA.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const d=r.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(d){const r=d.getMinMaxForTile(e);r&&(t=r)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,t){if(!this._enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,MS,MS]);for(let i=0;i<this._numCascadesToRender;++i){r.currentShadowCascade=i,n.bindFramebuffer.set(this._cascades[i].framebuffer.framebuffer),n.clear({color:ar.white,depth:1});for(const n of e.order){const i=e._mergedLayers[n];if(!i.hasShadowPass()||i.isHidden(r.transform.zoom))continue;const a=e.getLayerSourceCache(i),o=a?t[a.id]:void 0;("model"===i.type||o&&o.length)&&r.renderLayer(r,a,i,o)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,r=e.context,n=t.directionalLight,i=t.ambientLight;if(!n||!i)return;const a=[],o=zE(e,e.longestCutoffRange);o.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const s=DS(n,i),l=new pv(r.gl.LEQUAL,pv.ReadOnly,e.depthRangeFor3D);for(const t of this._groundShadowTiles){const n=t.toUnwrapped(),i=e.isTileAffectedByFog(t),u=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:i});this.setupShadows(n,u),e.uploadCommonUniforms(r,u,n,null,o);const c={u_matrix:e.transform.calculateProjMatrix(n),u_ground_shadow_factor:s};u.draw(e,r.gl.TRIANGLES,l,gv.disabled,yv.multiply,xv.disabled,c,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yv.unblended:yv.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const t=this.painter.transform,r=t.calculatePosMatrix(e,t.worldSize);return gd.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(e){return gd.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,t,r,n=0){if(!this._enabled)return;const i=this.painter.transform,a=this.painter.context,o=a.gl,s=this._uniformValues,l=new Float64Array(16),u=i.calculatePosMatrix(e,i.worldSize);for(let e=0;e<2;e++)gd.multiply(l,this._cascades[e].matrix,u),s[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),a.activeTexture.set(o.TEXTURE0+PA.ShadowMap0+e),this._cascades[e].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const t=Zh(e.canonical),a=2/i.tileSize*nn/MS,o=a*this._cascades[0].boundingSphereRadius,l=a*this._cascades[1].boundingSphereRadius,u=("vector-tile"===r?1:3)/Math.pow(2,n-e.canonical.z-(1-i.zoom+Math.floor(i.zoom)));s.u_shadow_normal_offset=[t,o*u,l*u],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(a,s)}setupShadowsFromMatrix(e,t,r=!1){if(!this._enabled)return;const n=this.painter.context,i=n.gl,a=this._uniformValues,o=new Float64Array(16);for(let t=0;t<2;t++)gd.multiply(o,this._cascades[t].matrix,e),a[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(o),n.activeTexture.set(i.TEXTURE0+PA.ShadowMap0+t),this._cascades[t].texture.bind(i.NEAREST,i.CLAMP_TO_EDGE);if(this.useNormalOffset=r,r){const e=5;a.u_shadow_normal_offset=[1,e,e],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(n,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,t,r,n){if(n[2]>=0)return{};const i=function(e,t,r){const n=r/(1<<e.canonical.z);return new Vd([e.canonical.x*n+e.wrap*r,e.canonical.y*n+e.wrap*r,0],[(e.canonical.x+1)*n+e.wrap*r,(e.canonical.y+1)*n+e.wrap*r,t])}(e,t,r).getCorners(),a=t/-n[2];n[0]<0?(Td.add(i[0],i[0],[n[0]*a,0,0]),Td.add(i[3],i[3],[n[0]*a,0,0])):n[0]>0&&(Td.add(i[1],i[1],[n[0]*a,0,0]),Td.add(i[2],i[2],[n[0]*a,0,0])),n[1]<0?(Td.add(i[0],i[0],[0,n[1]*a,0]),Td.add(i[1],i[1],[0,n[1]*a,0])):n[1]>0&&(Td.add(i[2],i[2],[0,n[1]*a,0]),Td.add(i[3],i[3],[0,n[1]*a,0]));const o={};return o.vertices=i,o.planes=[LS(i[1],i[0],i[4]),LS(i[2],i[1],i[5]),LS(i[3],i[2],i[6]),LS(i[0],i[3],i[7])],o}addShadowReceiver(e,t,r){this._receivers.add(e,Vd.fromTileIdAndHeight(e,t,r))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function LS(e,t,r){const n=Td.sub([],r,t),i=Td.sub([],e,t),a=Td.cross([],n,i),o=Td.length(a);return 0===o?[0,0,1,0]:(Td.scale(a,a,1/o),[a[0],a[1],a[2],-Td.dot(a,t)])}function IS(e){const t=e.properties.get("direction"),r=J(t.x,t.y,t.z);r[2]=C(r[2],0,75);const n=K([r[0],r[1],r[2]]);return Td.fromValues(n.x,n.y,n.z)}function DS(e,t){const r=e.properties.get("color"),n=e.properties.get("intensity"),i=e.properties.get("direction"),a=[i.x,i.y,i.z],o=t.properties.get("color"),s=t.properties.get("intensity"),l=Math.max(Td.dot([0,0,1],a),0),u=[0,0,0];Td.scale(u,o.toArray01Linear().slice(0,3),s);const c=[0,0,0];return Td.scale(c,r.toArray01Linear().slice(0,3),l*n),se([u[0]>0?u[0]/(u[0]+c[0]):0,u[1]>0?u[1]/(u[1]+c[1]):0,u[2]>0?u[2]/(u[2]+c[2]):0])}function kS(e,t,r,n,i,a){const o=e.zoom,s=e.scale,l=e.worldSize,u=1/l,c=e.aspect,d=Math.sqrt(1+c*c)*Math.tan(.5*e.fovX),h=d*d,f=n-r,p=n+r;let m,g;h>f/p?(m=n,g=n*d):(m=.5*p*(1+h),g=.5*Math.sqrt(f*f+2*(n*n+r*r)*h+p*p*h*h));const _=e.projection.pixelsPerMeter(e.center.lat,l),y=e._camera.getCameraToWorldMercator(),v=[0,0,-m*u];Td.transformMat4(v,v,y);let b=g*u;const x=e._edgeInsets;if(!(0===x.left&&0===x.top&&0===x.right&&0===x.bottom||x.left===x.right&&x.top===x.bottom)){const t=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?_:1),i=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,r,n);i[8]=2*-e.centerOffset.x/e.width,i[9]=2*e.centerOffset.y/e.height;const a=new Float64Array(16);gd.mul(a,i,t);const u=new Float64Array(16);gd.invert(u,a);const c=zd.fromInvProjectionMatrix(u,l,o,!0);for(const t of c.points){const r=((T=t)[0]/=s,T[1]/=s,T[2]=Gh(T[2],e._center.lat),T);b=Math.max(b,Td.len(Td.subtract([],v,r)))}}var T;b*=i/(i-1);const w=Math.acos(t[2]),E=Math.atan2(-t[0],-t[1]),A=new qv;A.position=v,A.setPitchBearing(w,E);const S=A.getWorldToCamera(l,_),P=b*l,M=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*P),R=A.getCameraToClipOrthographic(-P,P,-P,P,M,(P+a*_)/t[2]),C=new Float64Array(16);gd.multiply(C,R,S);const O=Td.fromValues(Math.floor(1e6*v[0])/1e6*l,Math.floor(1e6*v[1])/1e6*l,0),L=.5*i,I=[0,0,0];Td.transformMat4(I,O,C),Td.scale(I,I,L);const D=[Math.floor(I[0]),Math.floor(I[1]),Math.floor(I[2])],k=[0,0,0];Td.sub(k,I,D),Td.scale(k,k,-1/L);const B=new Float64Array(16);return gd.identity(B),gd.translate(B,B,k),gd.multiply(C,B,C),[C,P]}class BS extends At{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,t){return iw(this.requestManager.transformRequest(t,ye.Model).url).then((t=>{if(!t)return;const r=fw(t),n=new yb(e,void 0,void 0,r);return n.computeBoundsAndApplyParent(),n})).catch((r=>{this.fire(new Et(new Error(`Could not load model ${e} from ${t}: ${r.message}`)))}))}load(e,t){this.models[t]||(this.models[t]={});const r=Object.keys(e);this.numModelsLoading[t]=(this.numModelsLoading[t]||0)+r.length;const n=[];for(const t of r)n.push(this.loadModel(t,e[t]));Promise.allSettled(n).then((e=>{for(let n=0;n<e.length;n++){const{status:i,value:a}=e[n];"fulfilled"===i&&a&&(this.models[t][r[n]]=a)}this.numModelsLoading[t]-=r.length,this.fire(new wt("data",{dataType:"style"}))})).catch((e=>{this.fire(new Et(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,r){this.models[r]||(this.models[r]={}),this.hasModel(e,r)&&this.removeModel(e,r),this.load({[e]:this.requestManager.normalizeModelURL(t)},r)}addModels(e,t){const r={};for(const t in e)r[t]=this.requestManager.normalizeModelURL(e[t]);this.load(r,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const r=this.models[t][e];delete this.models[t][e],r.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const r in this.models[t])this.models[t][r].upload(e.context)}}const FS=(e,t)=>vo(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),NS=B(Sw,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),qS=B(Sw,["setCenter","setZoom","setBearing","setPitch"]),US={version:8,layers:[],sources:{}},jS={duration:300,delay:0},GS=new Set(["fill","line","background","hillshade","raster"]);class zS extends At{constructor(e,t={}){super(),this.map=e,this.scope=t.scope||"",this.fragments=[],this.importDepth=t.importDepth||0,this.importsCache=t.importsCache||new Map,this.resolvedImports=t.resolvedImports||new Set,this.transition=k({},jS),this._buildingIndex=new Tw(this),this.crossTileSymbolIndex=new vE,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=t.styleChanges||new ps,this.dispatcher=t.dispatcher?t.dispatcher:new fT(FT(),this),t.imageManager?this.imageManager=t.imageManager:(this.imageManager=new Zx,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=t.glyphManager?t.glyphManager:new Xg(e._requestManager,t.localFontFamily?2:t.localIdeographFontFamily?1:0,t.localFontFamily||t.localIdeographFontFamily),t.modelManager?this.modelManager=t.modelManager:(this.modelManager=new BS(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",be());const r=this;this._rtlTextPluginCallback=zS.registerForPluginStateChange((e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,t)=>{if($o(e),t&&t.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const r=this._layers[e];r.source===t.id&&this._validateLayer(r)}}))}loadURL(e,t={}){this.fire(new wt("dataloading",{dataType:"style"}));const r="boolean"==typeof t.validate?t.validate:!Oe(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken),this.resolvedImports.add(e);const n=this.importsCache.get(e);if(n)return this._load(n,r);const i=this.map._requestManager.transformRequest(e,ye.Style);this._request=Te(i,((t,n)=>{if(this._request=null,t)this.fire(new Et(t));else if(n)return this.importsCache.set(e,n),this._load(n,r)}))}loadJSON(e,t={}){this.fire(new wt("dataloading",{dataType:"style"})),this._request=st.frame((()=>{this._request=null,this._load(e,!1!==t.validate)}))}loadEmpty(){this.fire(new wt("dataloading",{dataType:"style"})),this._load(US,!1)}_loadImports(e,t){if(this.importDepth>=4)return X("Style doesn't support nesting deeper than 5"),this._reloadImports();const r=[];for(const n of e){const e=this._createFragmentStyle(n),i=new Promise((t=>e.on("style.import.load",t)));if(r.push(i),this.resolvedImports.has(n.url)){e.loadEmpty();continue}const a=n.data||this.importsCache.get(n.url);a?e.loadJSON(a,{validate:t}):n.url?e.loadURL(n.url,{validate:t}):e.loadEmpty(),this.fragments.push({style:e,id:n.id,config:n.config})}Promise.all(r).then((()=>this._reloadImports()))}_createFragmentStyle(e){const t=this.scope?cs(e.id,this.scope):e.id,r=new zS(this.map,{scope:t,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return r.setEventedParent(this.map,{style:r}),r.setConfig(e.config),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new wt("data",{dataType:"style"})),this.fire(new wt(e?"style.load":"style.import.load"))}_load(e,t){const r=e.schema;if(this.isRootStyle()&&(e.fragment||r&&!1!==e.fragment)){const r=k({},US,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(r,t)}if(this.updateSchema(r),t&&FS(this,oo(e)))return;this._loaded=!0,this.stylesheet=H(e);for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=Aw(this.stylesheet.layers);if(this._order=n.map((e=>e.id)),this.stylesheet.light&&X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Jx(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Jx(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of n){const t=Xx(e,this.options);t.setScope(this.scope),t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const r=this.getOwnLayerSourceCache(t),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&t.canCastShadows()&&n&&(r.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const i=this.stylesheet.terrain;if(i&&!this.terrainSetForDrapingOnly()&&this._createTerrain(i,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new wt("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,t);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new wt(e?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,t,r,n,i,a,o,s;this.forEachFragmentStyle((l=>{if(l.stylesheet){if(null!=l.light&&(e=l.light),l.stylesheet.lights)for(const e of l.stylesheet.lights)"ambient"===e.type&&null!=l.ambientLight&&(t=l.ambientLight),"directional"===e.type&&null!=l.directionalLight&&(r=l.directionalLight);(l.stylesheet.terrain||l.stylesheet.projection&&"globe"===l.stylesheet.projection.name)&&null!=l.terrain&&(!n||n&&0===n.drapeRenderMode||1===l.terrain.drapeRenderMode)&&(n=l.terrain),l.stylesheet.fog&&null!=l.fog&&(i=l.fog),null!=l.stylesheet.camera&&(s=l.stylesheet.camera),null!=l.stylesheet.projection&&(a=l.stylesheet.projection),null!=l.stylesheet.transition&&(o=l.stylesheet.transition)}})),this.light=e,this.ambientLight=t,this.directionalLight=r,this.terrain=n,this.fog=i,this.camera=s||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=k({},jS,o),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=r=>{for(const e of r.fragments)t(e.style);e(r)};t(this)}mergeTerrain(){let e;this.forEachFragmentStyle((t=>{null!=t.terrain&&(!e||e&&0===e.drapeRenderMode||1===t.terrain.drapeRenderMode)&&(e=t.terrain)})),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const e={},t={},r={};this.forEachFragmentStyle((n=>{for(const t in n._sourceCaches){const r=cs(t,n.scope);e[r]=n._sourceCaches[t]}for(const e in n._otherSourceCaches){const r=cs(e,n.scope);t[r]=n._otherSourceCaches[e]}for(const e in n._symbolSourceCaches){const t=cs(e,n.scope);r[t]=n._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=t,this._mergedSymbolSourceCaches=r}mergeLayers(){const e={},t=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((r=>{for(const n of r._order){const i=r._layers[n];if("slot"===i.type){const t=ds(n);if(e[t])continue;e[t]=[]}i.slot&&e[i.slot]?e[i.slot].push(i):t.push(i)}})),this._mergedOrder=[];const n=(t=[])=>{for(const i of t)if("slot"===i.type){const t=ds(i.id);e[t]&&n(e[t])}else{const e=cs(i.id,i.scope);this._mergedOrder.push(e),r[e]=i,i.is3D()&&(this._has3DLayers=!0),"circle"===i.type&&(this._hasCircleLayers=!0),"symbol"===i.type&&(this._hasSymbolLayers=!0)}};n(t),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=k({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,t,r){let n,i,a;const o=st.devicePixelRatio>1?"@2x":"";let s=Te(t.transformRequest(t.normalizeSpriteURL(e,o,".json"),ye.SpriteJSON),((e,t)=>{s=null,a||(a=e,n=t,u())})),l=Me(t.transformRequest(t.normalizeSpriteURL(e,o,".png"),ye.SpriteImage),((e,t)=>{l=null,a||(a=e,i=t,u())}));function u(){if(a)r(a);else if(n&&i){const e=st.getImageData(i),t={};for(const r in n){const{width:i,height:a,x:o,y:s,sdf:l,pixelRatio:u,stretchX:c,stretchY:d,content:h}=n[r],f=new Vf({width:i,height:a});Vf.copy(e,f,{x:o,y:s},{x:0,y:0},{width:i,height:a}),t[r]={data:f,pixelRatio:u,sdf:l,stretchX:c,stretchY:d,content:h}}r(null,t)}}return{cancel(){s&&(s.cancel(),s=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,((e,t)=>{if(this._spriteRequest=null,e)this.fire(new Et(e));else if(t)for(const e in t)this.imageManager.addImage(e,this.scope,t[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new wt("data",{dataType:"style"}))}))}_validateLayer(e){const t=this.getOwnSource(e.source);if(!t)return;const r=e.sourceLayer;r&&("geojson"===t.type||t.vectorLayerIds&&-1===t.vectorLayerIds.indexOf(r))&&this.fire(new Et(new Error(`Source layer "${r}" does not exist on source "${t.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const r=this.fragments[t];return r&&r.style&&(e.data=r.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):GS.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const t=this.getOwnLayer(e);if(t)return t;this.fire(new Et(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const t=this.getOwnSource(e);if(t)return t;this.fire(new Et(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const t=this.calculateLightsBrightness();e.brightness=t||0,t!==this._brightness&&(this._brightness=t,this.dispatcher.broadcast("setBrightness",t));const r=this._changes.changed;if(this._changes.changed){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:r,removedIds:n}=t[e];(r||n)&&this._updateWorkerLayers(e,r,n)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const n={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];n[e]=t.used,t.used=!1}for(const t of this._mergedOrder){const r=this._mergedLayers[t];if(r.recalculate(e,this._availableImages),!r.isHidden(e.zoom)){const e=this.getOwnLayerSourceCache(r);e&&(e.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let t=r.minzoom||0;t<(r.maxzoom||25.5);t++){const t=this.map.painter;if(t){const n=r.getProgramIds();if(!n)continue;for(const i of n){const n=r.getDefaultProgramParams(i,e.zoom);n&&(t.style=this,this.fog&&(t._fogVisible=!0,n.overrideFog=!0,t.getOrCreateProgram(i,n)),t._fogVisible=!1,n.overrideFog=!1,t.getOrCreateProgram(i,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,t.getOrCreateProgram(i,n)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const e in n){const t=this._mergedSourceCaches[e];n[e]!==t.used&&t.getSource().fire(new wt("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new wt("data",{dataType:"style"}));for(const{style:t}of this.fragments)t.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,t,r){const n=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:t?n._serializeLayers(t):[],scope:e,removedIds:r||[],options:n.options})}setState(e){if(this._checkLoaded(),FS(this,oo(e)))return!1;(e=H(e)).layers=Aw(e.layers);const t=function(e,t){if(!e)return[{command:Sw.setStyle,args:[t]}];let r=[];try{if(!v(e.version,t.version))return[{command:Sw.setStyle,args:[t]}];v(e.center,t.center)||r.push({command:Sw.setCenter,args:[t.center]}),v(e.zoom,t.zoom)||r.push({command:Sw.setZoom,args:[t.zoom]}),v(e.bearing,t.bearing)||r.push({command:Sw.setBearing,args:[t.bearing]}),v(e.pitch,t.pitch)||r.push({command:Sw.setPitch,args:[t.pitch]}),v(e.sprite,t.sprite)||r.push({command:Sw.setSprite,args:[t.sprite]}),v(e.glyphs,t.glyphs)||r.push({command:Sw.setGlyphs,args:[t.glyphs]}),v(e.transition,t.transition)||r.push({command:Sw.setTransition,args:[t.transition]}),v(e.light,t.light)||r.push({command:Sw.setLight,args:[t.light]}),v(e.fog,t.fog)||r.push({command:Sw.setFog,args:[t.fog]}),v(e.projection,t.projection)||r.push({command:Sw.setProjection,args:[t.projection]}),v(e.lights,t.lights)||r.push({command:Sw.setLights,args:[t.lights]}),v(e.camera,t.camera)||r.push({command:Sw.setCamera,args:[t.camera]});const n={},i=[];!function(e,t,r,n){let i;for(i in t=t||{},e=e||{})e.hasOwnProperty(i)&&(t.hasOwnProperty(i)||Mw(i,r,n));for(i in t){if(!t.hasOwnProperty(i))continue;const a=t[i];e.hasOwnProperty(i)?v(e[i],a)||("geojson"===e[i].type&&"geojson"===a.type&&Cw(e,t,i)?r.push({command:Sw.setGeoJSONSourceData,args:[i,a.data]}):Rw(i,t,r,n)):Pw(i,t,r)}}(e.sources,t.sources,i,n);const a=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:Sw.removeLayer,args:[e.id]}):a.push(e)}));let o=e.terrain;o&&n[o.source]&&(r.push({command:Sw.setTerrain,args:[void 0]}),o=void 0),r=r.concat(i),v(o,t.terrain)||r.push({command:Sw.setTerrain,args:[t.terrain]}),function(e,t,r){t=t||[];const n=(e=e||[]).map(Lw),i=t.map(Lw),a=e.reduce(Iw,{}),o=t.reduce(Iw,{}),s=n.slice(),l=Object.create(null);let u,c,d,h,f,p,m;for(u=0,c=0;u<n.length;u++)d=n[u],o.hasOwnProperty(d)?c++:(r.push({command:Sw.removeLayer,args:[d]}),s.splice(s.indexOf(d,c),1));for(u=0,c=0;u<i.length;u++)d=i[i.length-1-u],s[s.length-1-u]!==d&&(a.hasOwnProperty(d)?(r.push({command:Sw.removeLayer,args:[d]}),s.splice(s.lastIndexOf(d,s.length-c),1)):c++,p=s[s.length-u],r.push({command:Sw.addLayer,args:[o[d],p]}),s.splice(s.length-u,0,d),l[d]=!0);for(u=0;u<i.length;u++)if(d=i[u],h=a[d],f=o[d],!l[d]&&!v(h,f))if(v(h.source,f.source)&&v(h["source-layer"],f["source-layer"])&&v(h.type,f.type)){for(m in Ow(h.layout,f.layout,r,d,null,Sw.setLayoutProperty),Ow(h.paint,f.paint,r,d,null,Sw.setPaintProperty),v(h.slot,f.slot)||r.push({command:Sw.setSlot,args:[d,f.slot]}),v(h.filter,f.filter)||r.push({command:Sw.setFilter,args:[d,f.filter]}),v(h.minzoom,f.minzoom)&&v(h.maxzoom,f.maxzoom)||r.push({command:Sw.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),h)h.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Ow(h[m],f[m],r,d,m.slice(6),Sw.setPaintProperty):v(h[m],f[m])||r.push({command:Sw.setLayerProperty,args:[d,m,f[m]]}));for(m in f)f.hasOwnProperty(m)&&!h.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Ow(h[m],f[m],r,d,m.slice(6),Sw.setPaintProperty):v(h[m],f[m])||r.push({command:Sw.setLayerProperty,args:[d,m,f[m]]}))}else r.push({command:Sw.removeLayer,args:[d]}),p=s[s.lastIndexOf(d)+1],r.push({command:Sw.addLayer,args:[f,p]})}(a,t.layers,r),function(e=[],t=[],r){t=t||[];const n=(e=e||[]).map(Lw),i=t.map(Lw),a=e.reduce(Iw,{}),o=t.reduce(Iw,{}),s=n.slice();let l,u,c,d;for(l=0,u=0;l<n.length;l++)c=n[l],o.hasOwnProperty(c)?u++:(r.push({command:Sw.removeImport,args:[c]}),s.splice(s.indexOf(c,u),1));for(l=0,u=0;l<i.length;l++)c=i[i.length-1-l],s[s.length-1-l]!==c&&(a.hasOwnProperty(c)?(r.push({command:Sw.removeImport,args:[c]}),s.splice(s.lastIndexOf(c,s.length-u),1)):u++,d=s[s.length-l],r.push({command:Sw.addImport,args:[o[c],d]}),s.splice(s.length-l,0,c));for(const e of t){const t=a[e.id];if(!t||v(t,e))continue;v(t.config,e.config)||r.push({command:Sw.setImportConfig,args:[e.id,e.config]}),v(t.url,e.url)||r.push({command:Sw.setImportUrl,args:[e.id,e.url]});const n=e.data;v(t&&t.data,n)||r.push({command:Sw.setImportData,args:[e.id,n]})}}(e.imports,t.imports,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Sw.setStyle,args:[t]}]}return r}(this.serialize(),e).filter((e=>!(e.command in qS)));if(0===t.length)return!1;const r=t.filter((e=>!(e.command in NS)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return t.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,t){return this.getImage(e)?this.fire(new Et(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new Et(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new wt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,r={}){return this._checkLoaded(),this._validate(_o,`models.${e}`,t,null,r)||(this.modelManager.addModel(e,t,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new Et(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,t,r={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!t.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(t).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(t.type)>=0&&this._validate(so,`sources.${e}`,t,null,r))return;this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const n=_w(e,t,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const i=e=>{const t=(e?"symbol:":"other:")+n.id,r=cs(t,this.scope),i=this._sourceCaches[t]=new wv(r,n,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=i,i.onAdd(this.map)};i(!1),"vector"!==t.type&&"geojson"!==t.type||i(!0),n.onAdd&&n.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const t=this.getOwnSource(e);if(!t)throw new Error("There is no source with this ID");for(const t in this._layers)if(this._layers[t].source===e)return this.fire(new Et(new Error(`Source "${e}" cannot be removed while layer "${t}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new Et(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(e);for(const e of r){const t=ds(e.id);delete this._sourceCaches[t],delete this._changes.updatedSourceCaches[e.id],e.fire(new wt("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.changed=!0}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const r=this.getOwnSourceCache(t);r&&e.push(r.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const t=this._getTransitionParameters();for(const r of e){if(this._validate(uo,"lights",r))return;switch(r.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(r),e.updateTransitions(t)}else this.ambientLight=new pT(r,mT,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(r),e.updateTransitions(t)}else this.directionalLight=new pT(r,gT,this.scope,this.options)}}const r=new Ko(this.z||0,t);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,t=this.ambientLight;if(!e||!t)return;const r=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=e.properties.get("color").toArray01(),i=e.properties.get("intensity"),a=e.properties.get("direction"),o=1-J(a.x,a.y,a.z)[2]/90,s=r(n)*i*o,l=t.properties.get("color").toArray01(),u=t.properties.get("intensity");return(s+r(l)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}setConfigProperty(e,t,r){const n=ma(r);if("success"!==n.result)return void FS(this,n.value);const i=n.value.expression,a=this.getFragmentStyle(e);a.options.set(t,i),a.updateConfigDependencies()}setConfig(e,t){if(this.options.clear(),e){for(const t in e){const r=ma(e[t]);"success"===r.result&&this.options.set(t,r.value.expression)}this.updateSchema(t)}}updateSchema(e){if(e)for(const t in e){if(this.options.has(t))continue;const r=ma(e[t].default);"success"===r.result&&this.options.set(t,r.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,t,r={}){this._checkLoaded();const n=e.id;if(this._layers[n])return void this.fire(new Et(new Error(`Layer with id "${n}" already exists on this map`)));let i;if("custom"===e.type){if(FS(this,function(e){const t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t}(e)))return;i=Xx(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=k(e=H(e),{source:n})),this._validate(fo,`layers.${n}`,e,{arrayIndex:-1},r))return;i=Xx(e,this.options),this._validateLayer(i),i.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[i.id]=i.serialize()}i.isConfigDependent&&this._configDependentLayers.add(i.fqid),i.setScope(this.scope);const a=t?this._order.indexOf(t):this._order.length;if(t&&-1===a)return void this.fire(new Et(new Error(`Layer with id "${t}" does not exist on this map.`)));this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=i;const o=this.getOwnLayerSourceCache(i),s=!!this.directionalLight&&this.directionalLight.shadowsEnabled();o&&i.canCastShadows()&&s&&(o.castsShadows=!0);const l=this._changes.getRemovedLayer(i);if(l&&i.source&&o&&"custom"!==i.type){this._changes.discardLayerRemoval(i);const e=cs(i.source,i.scope);l.type!==i.type?this._changes.updatedSourceCaches[e]="clear":(this._changes.updatedSourceCaches[e]="reload",o.pause())}this._updateLayer(i),i.onAdd&&i.onAdd(this.map),i.scope=this.scope,this.mergeLayers()}moveLayer(e,t){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e))return;if(e===t)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=t?this._order.indexOf(t):this._order.length;t&&-1===n?this.fire(new Et(new Error(`Layer with id "${t}" does not exist on this map.`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const n=this.getOwnLayerSourceCache(t);if(n&&n.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===t.source&&this._layers[r].canCastShadows()){e=!0;break}n.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===t&&n.maxzoom===r||(null!=t&&(n.minzoom=t),null!=r&&(n.maxzoom=r),this._updateLayer(n)))}setSlot(e,t){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==t&&(r.slot=t,this._updateLayer(r))}setFilter(e,t,r={}){this._checkLoaded();const n=this._checkLayer(e);if(n&&!v(n.filter,t))return null==t?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(po,`layers.${n.id}.filter`,t,{layerType:n.type},r)||(n.filter=H(t),this._updateLayer(n)))}getFilter(e){const t=this._checkLayer(e);if(t)return H(t.filter)}setLayoutProperty(e,t,r,n={}){this._checkLoaded();const i=this._checkLayer(e);i&&(v(i.getLayoutProperty(t),r)||(i.setLayoutProperty(t,r,n),i.isConfigDependent&&this._configDependentLayers.add(i.fqid),this._updateLayer(i)))}getLayoutProperty(e,t){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(t)}setPaintProperty(e,t,r,n={}){this._checkLoaded();const i=this._checkLayer(e);if(!i)return;if(v(i.getPaintProperty(t),r))return;const a=i.setPaintProperty(t,r,n);i.isConfigDependent&&this._configDependentLayers.add(i.fqid),a&&this._updateLayer(i),this._changes.changed=!0,this._changes.updatedPaintProps.add(i.fqid)}getPaintProperty(e,t){const r=this._checkLayer(e);if(r)return r.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();const r=e.source,n=e.sourceLayer,i=this._checkSource(r);if(!i)return;const a=i.type;if("geojson"===a&&n)return void this.fire(new Et(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!n)return void this.fire(new Et(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new Et(new Error("The feature id parameter must be provided.")));const o=this.getOwnSourceCaches(r);for(const r of o)r.setFeatureState(n,e.id,t)}removeFeatureState(e,t){this._checkLoaded();const r=e.source,n=this._checkSource(r);if(!n)return;const i=n.type,a="vector"===i?e.sourceLayer:void 0;if("vector"===i&&!a)return void this.fire(new Et(new Error("The sourceLayer parameter must be provided for vector source types.")));if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new Et(new Error("A feature id is required to remove its specific state property.")));const o=this.getOwnSourceCaches(r);for(const r of o)r.removeFeatureState(a,e.id,t)}getFeatureState(e){this._checkLoaded();const t=e.source,r=e.sourceLayer,n=this._checkSource(t);if(n){if("vector"!==n.type||r)return void 0===e.id&&this.fire(new Et(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(t)[0].getFeatureState(r,e.id);this.fire(new Et(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=k({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return k({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),t=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return $({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:t,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._changes.updateLayer(e);const t=this.getLayerSourceCache(e),r=cs(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[r]&&t&&"raster"!==t.getSource().type&&(this._changes.updatedSourceCaches[r]="reload",t.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type,r=this.order,n={},i=[];for(let a=r.length-1;a>=0;a--){const o=r[a];if(t(o)){n[o]=a;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const a=[];for(let o=r.length-1;o>=0;o--){const s=r[o];if(t(s))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(n[t.layer.id]<o)break;a.push(t),i.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)a.push(t.feature)}}return a}queryRenderedFeatures(e,t,r){t&&t.filter&&this._validate(po,"queryRenderedFeatures.filter",t.filter,null,t),t.scope=this.scope,t.availableImages=this._availableImages,t.serializedLayers=this._serializedLayers;const n={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new Et(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._mergedLayers[e];if(!t)return this.fire(new Et(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[t.source]=!0}}const i=[],a=t.serializedLayers||{},o=t&&t.layers?t.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),s=_T.createFromScreenPoints(e,r);for(const e in this._mergedSourceCaches){const l=this._mergedSourceCaches[e].getSource();if(!l||l.scope!==t.scope)continue;const u=this._mergedSourceCaches[e].getSource().id;t.layers&&!n[u]||i.push(vw(this._mergedSourceCaches[e],this._mergedLayers,a,s,t,r,o,!!this.map._showQueryGeometry))}return this.placement&&i.push(function(e,t,r,n,i,a,o){const s={},l=a.queryRenderedSymbols(n),u=[];for(const e of Object.keys(l).map(Number))u.push(o[e]);u.sort(xw);for(const r of u){const n=r.featureIndex.lookupSymbolFeatures(l[r.bucketInstanceId],t,r.bucketIndex,r.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(const e in n){const t=s[e]=s[e]||[],i=n[e];i.sort(((e,t)=>{const n=r.featureSortOrder;if(n){const r=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const t in s)s[t].forEach((n=>{const i=n.feature,a=r(e[t]);if(!a)return;const o=a.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}));return s}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),s.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(i)}querySourceFeatures(e,t){t&&t.filter&&this._validate(po,"querySourceFeatures.filter",t.filter,null,t);const r=this.getOwnSourceCaches(e);let n=[];for(const e of r)n=n.concat(bw(e,t));return n}addSourceType(e,t,r){return zS.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(zS.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,t,r={}){this._checkLoaded();const n=this.light.getLight();let i=!1;for(const t in e)if(!v(e[t],n[t])){i=!0;break}if(!i)return;const a=this._getTransitionParameters();this.light.setLight(e,t,r),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,t=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=e;if(1===t){if("object"==typeof r.source){const e="terrain-dem-src";this.addSource(e,r.source),r=H(r),r=k(r,{source:e})}if(this._validate(co,"terrain",r))return}if(!this.terrain||this.terrain&&t!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,t),this.fire(new wt("data",{dataType:"style"}))}else{const t=this.terrain,n=t.get();for(const e of Object.keys(St.terrain))!r.hasOwnProperty(e)&&St.terrain[e].default&&(r[e]=St.terrain[e].default);for(const r in e)if(!v(e[r],n[r])){t.set(e),this.stylesheet.terrain=e;const r=this._getTransitionParameters({duration:0});t.updateTransitions(r),this.fire(new wt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new uT(e,this.map.transform);this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const t=this.fog;if(!v(t.get(),e)){t.set(e),this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:st.now(),transition:k(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?e.push(r):t.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const r=this.terrain=new eT(e,t);r.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(e,t,r,n,i={}){if(i&&!1===i.validate)return!1;const a=k({},this.serialize());return FS(this,e.call(oo,k({key:t,style:a,value:r,styleSpec:St},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Wo.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const e of t)e.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload()}updateSources(e){let t;this.directionalLight&&(t=IS(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(e,t,r,n,i=!1){let a=!1,o=!1;const s={},l={};for(const t of this._mergedOrder){const r=this._mergedLayers[t];if("symbol"!==r.type)continue;const n=cs(r.source,r.scope);let i=s[n];if(!i){const e=this.getLayerSourceCache(r);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));l[n]=t.slice(),i=s[n]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const o=this.crossTileSymbolIndex.addLayer(r,i,e.center.lng,e.projection);a=a||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),i=i||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new wt("neworder")),(i||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(st.now(),e.zoom))&&(this.pauseablePlacement=new sE(e,this._mergedOrder,i,t,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,s,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(st.now()),o=!0),a&&this.pauseablePlacement.placement.setStale()),o||a)for(const e of this._mergedOrder){const t=this._mergedLayers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,s[cs(t.source,t.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(st.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const t=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==t.findIndex((({id:t})=>t===e.id))?this.fire(new Et(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(t.push(e),this._loadImports([e],!0),this)}setImportUrl(e,t){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;r[n].url=t;const i=this.fragments[n];i.style=this._createFragmentStyle({id:e,url:t});const a=new Promise((e=>i.style.on("style.import.load",e)));return i.style.loadURL(t),a.then((()=>this._reloadImports())),this}setImportData(e,t){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];return-1===r?this:t?(this.fragments[r].style.setState(t),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,t){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];if(-1===r)return this;t?n[r].config=t:delete n[r].config;const i=this.fragments[r],a=i.style.stylesheet&&i.style.stylesheet.schema;return i.config=t,i.style.setConfig(t,a),i.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],r=this.getImportIndex(e);return-1===r||(t.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(e){const t=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===t&&this.fire(new Et(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),t}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[t];r&&e.push(r.getSource())}return e}getSource(e,t){const r=this.getSourceCache(e,t);return r&&r.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(e,t){const r=cs(e,t);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(e){const t=cs(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[t]:this._mergedOtherSourceCaches[t]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const t=this._changes.updatedSourceCaches[e];"reload"===t?this.reloadSource(e):"clear"===t&&this.clearSource(e)}}updateLayers(e){for(const t of this._changes.updatedPaintProps){const r=this.getLayer(t);r&&r.updateTransitions(e)}}getImages(e,t,r){this.imageManager.getImages(t.icons,t.scope,r),this._updateTilesForChangedImages();const n=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};n(this._otherSourceCaches[t.source]),n(this._symbolSourceCaches[t.source])}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,t.scope,r)}getResource(e,t,r){return xe(t,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){const t=this.getOwnSourceCaches(e);return 0===t.length?(this.fire(new Et(new Error(`There is no source with ID '${e}'`))),!1):t.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function VS(e,t){let r=!1,n=null;const i=()=>{n=null,r&&(e(),n=setTimeout(i,t),r=!1)};return()=>(r=!0,n||i(),n)}zS.getSourceType=function(e){return gw[e]},zS.setSourceType=function(e,t){gw[e]=t},zS.registerForPluginStateChange=function(e){return e({pluginStatus:zo,pluginURL:Vo}),Wo.on("pluginStateChange",e),e};class $S{constructor(e){this._hashName=e&&encodeURIComponent(e),G(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=VS(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const r=HS(e);if(this._hashName){const e=this._hashName;let n=!1;const i=t.location.hash.slice(1).split("&").map((t=>{const i=t.split("=")[0];return i===e?(n=!0,`${i}=${r}`):t})).filter((e=>e));return n||i.push(`${e}=${r}`),`#${i.join("&")}`}return`#${r}`}_getCurrentHash(){const e=t.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.location.href.replace(/(#.+)?$/,this.getHashString());t.history.replaceState(t.history.state,null,e)}}function HS(e,t){const r=e.getCenter(),n=Math.round(100*e.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,i),o=Math.round(r.lng*a)/a,s=Math.round(r.lat*a)/a,l=e.getBearing(),u=e.getPitch();let c=t?`/${o}/${s}/${n}`:`${n}/${s}/${o}`;return(l||u)&&(c+="/"+Math.round(10*l)/10),u&&(c+=`/${Math.round(u)}`),c}const WS={linearity:.3,easing:M(0,0,.3,1)},XS=k({deceleration:2500,maxSpeed:1400},WS),YS=k({deceleration:20,maxSpeed:1400},WS),ZS=k({deceleration:1e3,maxSpeed:360},WS),KS=k({deceleration:1e3,maxSpeed:90},WS);class JS{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:st.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=st.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const t={zoom:0,bearing:0,pitch:0,pan:new y(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)t.zoom+=e.zoomDelta||0,t.bearing+=e.bearingDelta||0,t.pitch+=e.pitchDelta||0,e.panDelta&&t.pan._add(e.panDelta),e.around&&(t.around=e.around),e.pinchAround&&(t.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(t.pan.mag()){const i=eP(t.pan.mag(),r,k({},XS,e||{}));n.offset=t.pan.mult(i.amount/t.pan.mag()),n.center=this._map.transform.center,QS(n,i)}if(t.zoom){const e=eP(t.zoom,r,YS);n.zoom=this._map.transform.zoom+e.amount,QS(n,e)}if(t.bearing){const e=eP(t.bearing,r,ZS);n.bearing=this._map.transform.bearing+C(e.amount,-179,179),QS(n,e)}if(t.pitch){const e=eP(t.pitch,r,KS);n.pitch=this._map.transform.pitch+e.amount,QS(n,e)}if(n.zoom||n.bearing){const e=void 0===t.pinchAround?t.around:t.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function QS(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function eP(e,t,r){const{maxSpeed:n,linearity:i,deceleration:a}=r,o=C(e*i/(t/1e3),-n,n),s=Math.abs(o)/(a*i);return{easing:r.easing,duration:1e3*s,amount:o*(s/2)}}class tP extends wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r,n={}){const i=_t(t.getCanvasContainer(),r);super(e,k({point:i,lngLat:t.unproject(i),originalEvent:r},n)),this._defaultPrevented=!1,this.target=t}}class rP extends wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){const n="touchend"===e?r.changedTouches:r.touches,i=yt(t.getCanvasContainer(),n),a=i.map((e=>t.unproject(e))),o=i.reduce(((e,t,r,n)=>e.add(t.div(n.length))),new y(0,0));super(e,{points:i,point:o,lngLats:a,lngLat:t.unproject(o),originalEvent:r}),this._defaultPrevented=!1}}class nP extends wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class iP{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new nP(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new tP(e.type,this._map,e))}mouseup(e){this._map.fire(new tP(e.type,this._map,e))}preclick(e){const t=k({},e);t.type="preclick",this._map.fire(new tP(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new tP(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new tP(e.type,this._map,e))}mouseover(e){this._map.fire(new tP(e.type,this._map,e))}mouseout(e){this._map.fire(new tP(e.type,this._map,e))}touchstart(e){return this._firePreventable(new rP(e.type,this._map,e))}touchmove(e){this._map.fire(new rP(e.type,this._map,e))}touchend(e){this._map.fire(new rP(e.type,this._map,e))}touchcancel(e){this._map.fire(new rP(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class aP{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new tP(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tP("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new tP(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oP{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(ft(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const r=t,n=this._startPos,i=this._lastPos;if(!n||!i||i.equals(r)||!this._box&&r.dist(n)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=lt("div","tianjingmapgl-boxzoom",this._container),this._container.classList.add("tianjingmapgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(n.x,r.x),o=Math.max(n.x,r.x),s=Math.min(n.y,r.y),l=Math.max(n.y,r.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${a}px,${s}px)`,this._box.style.width=o-a+"px",this._box.style.height=l-s+"px")}))}mouseupWindow(e,t){if(!this._active)return;const r=this._startPos,n=t;if(r&&0===e.button){if(this.reset(),gt(),r.x!==n.x||r.y!==n.y)return this._map.fire(new wt("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("tianjingmapgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pt(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new wt(e,{originalEvent:t}))}}function sP(e,t){const r={};for(let n=0;n<e.length;n++)r[e[n].identifier]=t[n];return r}class lP{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const t=new y(0,0);for(const r of e)t._add(r);return t.div(e.length)}(t),this.touches=sP(r,t)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;const n=sP(r,t);for(const e in this.touches){const t=n[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class uP{constructor(e){this.singleTap=new lP(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){const n=this.singleTap.touchend(e,t,r);if(n){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class cP{constructor(){this._zoomIn=new uP({numTouches:1,numTaps:2}),this._zoomOut=new uP({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){const n=this._zoomIn.touchend(e,t,r),i=this._zoomOut.touchend(e,t,r);return n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dP={0:1,2:2};class hP{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const r=vt(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}mousemoveWindow(e,t){const r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const r=dP[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&vt(e)===this._eventButton&&(this._moved&&gt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fP extends hP{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class pP extends hP{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=.8*(t.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){e.preventDefault()}}class mP extends hP{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=-.5*(t.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){e.preventDefault()}}class gP{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),G(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new y(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(e,t,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!re())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,r)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,r){r.length>0&&(this._active=!0);const n=sP(r,t),i=new y(0,0),a=new y(0,0);let o=0;for(const e in n){const t=n[e],r=this._touches[e];r&&(i._add(t),a._add(t.sub(r)),o++,n[e]=t)}if(this._touches=n,o<this._minTouches||!a.mag())return;const s=a.div(o);return this._sum._add(s),this._sum.mag()<this._clickTolerance?void 0:{around:i.div(o),panDelta:s}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("tianjingmapgl-touch-pan-blocker-override","tianjingmapgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("tianjingmapgl-touch-pan-blocker-override","tianjingmapgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=lt("div","tianjingmapgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("tianjingmapgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("tianjingmapgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class _P{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[i,a]=n,o=yP(r,t,i),s=yP(r,t,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;const[n,i]=this._firstTwoTouches,a=yP(r,t,n),o=yP(r,t,i);a&&o||(this._active&&gt(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yP(e,t,r){for(let n=0;n<e.length;n++)if(e[n].identifier===r)return t[n]}function vP(e,t){return Math.log(e/t)/Math.LN2}class bP extends _P{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(vP(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vP(this._distance,r),pinchAround:t}}}function xP(e,t){return 180*e.angleWith(t)/Math.PI}class TP extends _P{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xP(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const n=xP(e,r);return Math.abs(n)<t}}function wP(e){return Math.abs(e.y)>Math.abs(e.x)}class EP extends _P{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,wP(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,r){const n=this._lastPoints;if(!n)return;const i=e[0].sub(n[0]),a=e[1].sub(n[1]);return this._map._cooperativeGestures&&!re()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(i,a,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,i=t.mag()>=2;if(!n&&!i)return;if(!n||!i)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return wP(e)&&wP(t)&&a}}const AP={panStep:100,bearingStep:15,pitchStep:10};class SP{constructor(){const e=AP;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,n=0,i=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:o=>{const s=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:PP,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:o.getBearing()+r*this._bearingStep,pitch:o.getPitch()+n*this._pitchStep,offset:[-i*this._panStep,-a*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function PP(e){return e*(2-e)}const MP=4.000244140625;class RP{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,G(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||re()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=e.deltaMode===t.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=st.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%MP==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=_t(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const t=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const r="wheel"===this._type&&Math.abs(this._delta)>MP?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==n&&(n=1/n);const i=t(),a=Math.pow(2,i),o="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=i,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:t(),n=this._startZoom,i=this._easing;let a,o=!1;if("wheel"===this._type&&n&&i){const e=Math.min((st.now()-this._lastWheelEventTime)/200,1);a=Hn(n,r,i(e)),e<1?this._frameId||(this._frameId=!0):o=!0}else a=r,o=!0;this._active=!0,o&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let s=a-t();return s*this._lastDelta<0&&(s=0),{noInertia:!0,needsRenderFrame:!o,zoomDelta:s,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let t=R;if(this._prevEase){const e=this._prevEase,r=(st.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),i=.27/Math.sqrt(n*n+1e-4)*.01;t=M(i,Math.sqrt(.0729-i*i),.25,1)}return this._prevEase={start:st.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=lt("div","tianjingmapgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("tianjingmapgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("tianjingmapgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class CP{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class OP{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class LP{constructor(){this._tap=new uP({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=t[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class IP{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("tianjingmapgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("tianjingmapgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class DP{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class kP{constructor(e,t,r,n){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("tianjingmapgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("tianjingmapgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const BP=e=>e.zoom||e.drag||e.pitch||e.rotate;class FP extends wt{}class NP{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){const r=Td.sub([],t,e);this.radius=Td.length(r[2]<0?Td.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){Td.div(e,e,this.constants),Td.normalize(e,e),Td.mul(e,e,this.constants);const t=Td.scale([],e,this.radius);if(t[2]>0){const e=Td.scale([],[0,0,1],Td.dot(t,[0,0,1])),r=Td.scale([],Td.normalize([],[t[0],t[1],0]),this.radius),n=Td.add([],t,Td.scale([],Td.sub([],Td.add([],r,e),t),2));t[0]=n[0],t[1]=n[1]}return t}}function qP(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class UP{constructor(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new JS(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new NP,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),G(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.document,"mousemove",{capture:!0}],[t.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t,"blur",void 0]];for(const[e,r,n]of this._listeners)e.addEventListener(r,e===t.document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[e,r,n]of this._listeners)e.removeEventListener(r,e===t.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new iP(t,e));const n=t.boxZoom=new oP(t,e);this._add("boxZoom",n);const i=new cP,a=new OP;t.doubleClickZoom=new CP(a,i),this._add("tapZoom",i),this._add("clickZoom",a);const o=new LP;this._add("tapDragZoom",o);const s=t.touchPitch=new EP(t);this._add("touchPitch",s);const l=new pP(e),u=new mP(e);t.dragRotate=new DP(e,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);const c=new fP(e),d=new gP(t,e);t.dragPan=new IP(r,c,d),this._add("mousePan",c),this._add("touchPan",d,["touchZoom","touchRotate"]);const h=new TP,f=new bP;t.touchZoomRotate=new kP(r,f,h,o),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new aP(t));const p=t.scrollZoom=new RP(t,this);this._add("scrollZoom",p,["mousePan"]);const m=t.keyboard=new SP;this._add("keyboard",m);for(const r of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[r]&&t[r].enable(e[r])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!BP(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const n in e)if(n!==r&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(e,t){this._updatingCamera=!0;const r="renderFrame"===e.type,n=r?void 0:e,i={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?yt(this._el,s):r?void 0:_t(this._el,e);for(const{handlerName:r,handler:u,allowed:c}of this._handlers){if(!u.isEnabled())continue;let d;this._blockedByActive(o,c,r)?u.reset():u[t||e.type]&&(d=u[t||e.type](e,l,s),this.mergeHandlerResult(i,a,d,r,n),d&&d.needsRenderFrame&&this._triggerRenderFrame()),(d||u.isActive())&&(o[r]=u)}const u={};for(const e in this._previousActiveHandlers)o[e]||(u[e]=n);this._previousActiveHandlers=o,(Object.keys(u).length||qP(i))&&(this._changes.push([i,a,u]),this._triggerRenderFrame()),(Object.keys(o).length||qP(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=i;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))}mergeHandlerResult(e,t,r,n,i){if(!r)return;k(e,r);const a={handlerName:n,originalEvent:r.originalEvent||i};void 0!==r.zoomDelta&&(t.zoom=a),void 0!==r.panDelta&&(t.drag=a),void 0!==r.pitchDelta&&(t.pitch=a),void 0!==r.bearingDelta&&(t.rotate=a)}_applyChanges(){const e={},t={},r={};for(const[n,i,a]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new y(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.aroundCoord&&(e.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),k(t,i),k(r,a);this._updateMapTransform(e,t,r),this._changes=[]}_updateMapTransform(e,t,r){const n=this._map,i=n.transform,a=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!qP(e)){const e=i.zoom;i.cameraElevationReference="sea",null!=this._originalZoom&&i._orthographicProjectionAtLowPitch&&"globe"!==i.projection.name&&0===i.pitch?(i.cameraElevationReference="ground",i.zoom=this._originalZoom):(i.recenterOnTerrain(),i.cameraElevationReference="ground"),e!==i.zoom&&this._map._update(!0)}if(i._isCameraConstrained&&n._stop(!0),!qP(e))return void this._fireEvents(t,r,!0);let{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:u,around:c,aroundCoord:d,pinchAround:h}=e;i._isCameraConstrained&&(s>0&&(s=0),i._isCameraConstrained=!1),void 0!==h&&(c=h),(s||(e=>t[e]&&!this._eventsInProgress[e])("drag"))&&c&&(this._dragOrigin=a(i.pointCoordinate3D(c)),this._originalZoom=i.zoom,this._trackingEllipsoid.setup(i._camera.position,this._dragOrigin)),i.cameraElevationReference="sea",n._stop(!0),c=c||n.transform.centerPoint,l&&(i.bearing+=l),u&&(i.pitch+=u),i._updateCameraState();const f=[0,0,0];if(o)if("mercator"===i.projection.name){const e=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(c).dir),t=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(c.sub(o)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const e=i.pointCoordinate(c);if("globe"===i.projection.name){o=o.rotate(-i.angle);const t=i._pixelsPerMercatorPixel/i.worldSize;f[0]=-o.x*Yh(Vh(e.y))*t,f[1]=-o.y*Yh(i.center.lat)*t}else{const t=i.pointCoordinate(c.sub(o));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const p=i.zoom,m=[0,0,0];if(s){const e=a(d||i.pointCoordinate3D(c)),t={dir:Td.normalize([],Td.sub([],e,i._camera.position))};if(t.dir[2]<0){const r=i.zoomDeltaToMovement(e,s);Td.scale(m,t.dir,r)}}const g=Td.add(f,f,m);i._translateCameraConstrained(g),s&&Math.abs(i.zoom-p)>1e-4&&i.recenterOnTerrain(),i.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,r,!0)}_fireEvents(e,t,r){const n=BP(this._eventsInProgress),i=BP(e),a={};for(const t in e){const{originalEvent:r}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=r),this._eventsInProgress[t]=e[t]}!n&&i&&this._fireEvent("movestart",i.originalEvent);for(const e in a)this._fireEvent(e,a[e]);i&&this._fireEvent("move",i.originalEvent);for(const t in e){const{originalEvent:r}=e[t];this._fireEvent(t,r)}const o={};let s;for(const e in this._eventsInProgress){const{handlerName:r,originalEvent:n}=this._eventsInProgress[e];this._handlersById[r].isActive()||(delete this._eventsInProgress[e],s=t[r]||n,o[`${e}end`]=s)}for(const e in o)this._fireEvent(e,o[e]);const l=BP(this._eventsInProgress);if(r&&(n||i)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:s})):(this._map.fire(new wt("moveend",{originalEvent:s})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new wt(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new FP("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const jP="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class GP extends At{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this._respectPrefersReducedMotion=!1!==t.respectPrefersReducedMotion,G(["_renderFrameCallback"],this)}getCenter(){return new Bh(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,r){return e=y.convert(e).mult(-1),this.panTo(this.transform.center,k({offset:e},t),r)}panTo(e,t,r){return this.easeTo(k({center:e},t),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,r){return this.easeTo(k({zoom:e},t),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,r){return this.easeTo(k({bearing:e},t),r)}resetNorth(e,t){return this.rotateTo(0,k({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(k({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=Zl.convert(e);const r=t&&t.bearing||0,n=t&&t.pitch||0,i=e.getNorthWest(),a=e.getSouthEast();return this._cameraForBounds(this.transform,i,a,r,n,t)}_extendCameraOptions(e){const t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=k({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=k(t,e.padding),e}_minimumAABBFrustumDistance(e,t){const r=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,r,n,i,a){const o=e.clone(),s=this._extendCameraOptions(a);o.bearing=n,o.pitch=i;const l=Bh.convert(t),u=Bh.convert(r),c=.5*(l.lat+u.lat),d=.5*(l.lng+u.lng),h=hh(c,d),f=Td.normalize([],h),p=Td.normalize([],Td.cross([],f,[0,1,0])),m=Td.cross([],p,f),g=[p[0],p[1],p[2],0,m[0],m[1],m[2],0,f[0],f[1],f[2],0,0,0,0,1],_=[h,hh(l.lat,l.lng),hh(u.lat,l.lng),hh(u.lat,u.lng),hh(l.lat,u.lng),hh(c,l.lng),hh(c,u.lng),hh(l.lat,d),hh(u.lat,d)];let y=Vd.fromPoints(_.map((e=>[Td.dot(p,e),Td.dot(m,e),Td.dot(f,e)])));const v=Td.transformMat4([],y.center,g);0===Td.squaredLength(v)&&Td.set(v,0,0,1),Td.normalize(v,v),Td.scale(v,v,Wd),o.center=function([e,t,r]){const n=Math.hypot(e,t,r),i=Math.atan2(e,r),a=.5*Math.PI-Math.acos(-t/n);return new Bh(w(i),w(a))}(v);const b=o.getWorldToCameraMatrix(),x=gd.invert(new Float64Array(16),b);y=Vd.applyTransform(y,gd.multiply([],b,g)),Td.transformMat4(v,v,b);const T=.5*(y.max[2]-y.min[2]),E=this._minimumAABBFrustumDistance(o,y),A=Td.scale([],[0,0,1],T),S=Td.add(A,v,A),P=E+(0===o.pitch?0:Td.distance(v,S)),M=o.globeCenterInViewSpace,R=Td.sub([],v,[M[0],M[1],M[2]]);Td.normalize(R,R),Td.scale(R,R,P);const C=Td.add([],v,R);Td.transformMat4(C,C,x);const O=Ih/Wd,L=Td.length(C),I=Gh(Math.max(L*O-Ih,Number.EPSILON),0),D=Math.min(o.zoomFromMercatorZAdjusted(I),s.maxZoom);return D>.5*($d+Hd)?(o.setProjection({name:"mercator"}),o.zoom=D,this._cameraForBounds(o,t,r,n,i,a)):{center:o.center,zoom:D,bearing:n,pitch:i}}queryTerrainElevation(e,t){const r=this.transform.elevation;return r?(t=k({},{exaggerated:!0},t),r.getAtPoint(Kh.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,r,n,i,a){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,t,r,n,i,a);const o=e.clone(),s=this._extendCameraOptions(a),l=o.padding;o.bearing=n,o.pitch=i;const u=Bh.convert(t),c=Bh.convert(r),d=new Bh(u.lng,c.lat),h=new Bh(c.lng,u.lat),f=o.project(u),p=o.project(c),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(c),_=this.queryTerrainElevation(d),v=this.queryTerrainElevation(h),b=[[f.x,f.y,Math.min(m||0,g||0,_||0,v||0)],[p.x,p.y,Math.max(m||0,g||0,_||0,v||0)]];let x=Vd.fromPoints(b);const w=o.getWorldToCameraMatrix(),E=gd.invert(new Float64Array(16),w);x=Vd.applyTransform(x,w);const A=Td.sub([],x.max,x.min),S=l.left||0,P=l.right||0,M=l.bottom||0,R=l.top||0,{left:C,right:O,top:L,bottom:I}=s.padding,D=.5*(S+P),k=.5*(R+M),B=Math.min(o.scaleZoom(o.scale*Math.min((o.width-(S+P+C+O))/A[0],(o.height-(M+R+I+L))/A[1])),s.maxZoom),F=o.scale/o.zoomScale(B);x=new Vd([x.min[0]-(C+D)*F,x.min[1]-(I+k)*F,x.min[2]],[x.max[0]+(O+D)*F,x.max[1]+(L+k)*F,x.max[2]]);const N=.5*A[2],q=this._minimumAABBFrustumDistance(o,x),U=[0,0,1,0];ld.transformMat4(U,U,w),ld.normalize(U,U);const j=Td.scale([],U,q+N),G=Td.add([],x.center,j),z=("number"==typeof s.offset.x&&"number"==typeof s.offset.y?new y(s.offset.x,s.offset.y):y.convert(s.offset)).rotate(-T(n));x.center[0]-=z.x*F,x.center[1]+=z.y*F,Td.transformMat4(x.center,x.center,E),Td.transformMat4(G,G,E);const V=[x.center[0],x.center[1],G[2]*o.pixelsPerMeter];Td.scale(V,V,1/o.worldSize);const $=zh(V[0]),H=Vh(V[1]),W=Math.min(o._zoomFromMercatorZ(V[2]),s.maxZoom),X=new Bh($,H);return o.mercatorFromTransition&&W<.5*($d+Hd)?(o.setProjection({name:"globe"}),o.zoom=W,this._cameraForBounds(o,t,r,n,i,a)):{center:X,zoom:W,bearing:n,pitch:i}}fitBounds(e,t,r){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,r)}fitScreenCoordinates(e,t,r,n,i){const a=y.convert(e),o=y.convert(t),s=new y(Math.min(a.x,o.x),Math.min(a.y,o.y)),l=new y(Math.max(a.x,o.x),Math.max(a.y,o.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,o))return this;const u=this.transform.pointLocation3D(s),c=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(new y(s.x,l.y)),h=this.transform.pointLocation3D(new y(l.x,s.y)),f=[Math.min(u.lng,c.lng,d.lng,h.lng),Math.min(u.lat,c.lat,d.lat,h.lat)],p=[Math.max(u.lng,c.lng,d.lng,h.lng),Math.max(u.lat,c.lat,d.lat,h.lat)],m=n&&n.pitch?n.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,p,r,m,n);return this._fitInternal(g,n,i)}_fitInternal(e,t,r){return e?(delete(t=k(e,t)).padding,t.linear?this.easeTo(t,r):this.flyTo(t,r)):this}jumpTo(e,t){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,i=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=Bh.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(i=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new wt("movestart",t)).fire(new wt("move",t)),n&&this.fire(new wt("zoomstart",t)).fire(new wt("zoom",t)).fire(new wt("zoomend",t)),i&&this.fire(new wt("rotatestart",t)).fire(new wt("rotate",t)).fire(new wt("rotateend",t)),a&&this.fire(new wt("pitchstart",t)).fire(new wt("pitch",t)).fire(new wt("pitchend",t)),this.fire(new wt("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||X(jP),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){const r=this.transform;if(!r.projection.supportsFreeCamera)return X(jP),this;this.stop();const n=r.zoom,i=r.pitch,a=r.bearing;r.setFreeCameraOptions(e);const o=n!==r.zoom,s=i!==r.pitch,l=a!==r.bearing;return this.fire(new wt("movestart",t)).fire(new wt("move",t)),o&&this.fire(new wt("zoomstart",t)).fire(new wt("zoom",t)).fire(new wt("zoomend",t)),l&&this.fire(new wt("rotatestart",t)).fire(new wt("rotate",t)).fire(new wt("rotateend",t)),s&&this.fire(new wt("pitchstart",t)).fire(new wt("pitch",t)).fire(new wt("pitchend",t)),this.fire(new wt("moveend",t)),this}easeTo(e,t){this._stop(!1,e.easeId),(!1===(e=k({offset:[0,0],duration:500,easing:R},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const r=this.transform,n=this.getZoom(),i=this.getBearing(),a=this.getPitch(),o=this.getPadding(),s="zoom"in e?+e.zoom:n,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,u="pitch"in e?+e.pitch:a,c="padding"in e?e.padding:r.padding,d=y.convert(e.offset);let h,f,p;if("globe"===r.projection.name){const t=Kh.fromLngLat(r.center),n=d.rotate(-r.angle);t.x+=n.x/r.worldSize,t.y+=n.y/r.worldSize;const i=t.toLngLat(),a=Bh.convert(e.center||i);this._normalizeCenter(a),h=r.centerPoint.add(n),f=new y(t.x,t.y).mult(r.worldSize),p=new y(Uh(a.lng),jh(a.lat)).mult(r.worldSize).sub(f)}else{h=r.centerPoint.add(d);const t=r.pointLocation(h),n=Bh.convert(e.center||t);this._normalizeCenter(n),f=r.project(t),p=r.project(n).sub(f)}const m=r.zoomScale(s-n);let g,_;e.around&&(g=Bh.convert(e.around),_=r.locationPoint(g));const v=this._zooming||s!==n,b=this._rotating||i!==l,x=this._pitching||u!==a,T=!r.isPaddingEqual(c),w=r=>y=>{if(v&&(r.zoom=Hn(n,s,y)),b&&(r.bearing=Hn(i,l,y)),x&&(r.pitch=Hn(a,u,y)),T&&(r.interpolatePadding(o,c,y),h=r.centerPoint.add(d)),g)r.setLocationAtPoint(g,_);else{const e=r.zoomScale(r.zoom-n),t=s>n?Math.min(2,m):Math.max(.5,m),i=Math.pow(t,1-y),a=r.unproject(f.add(p.mult(y*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?a.wrap():a,h)}return e.preloadOnly||this._fireMoveEvents(t),r};if(e.preloadOnly){const t=this._emulate(w,e.duration,r);return this._preloadTiles(t),this}const E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=b,this._pitching=x,this._padding=T,this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,E),this._ease(w(r),(e=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(t,e)}),e),this}_prepareEase(e,t,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),t||r.moving||this.fire(new wt("movestart",e)),this._zooming&&!r.zooming&&this.fire(new wt("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new wt("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new wt("pitchstart",e))}_fireMoveEvents(e){this.fire(new wt("move",e)),this._zooming&&this.fire(new wt("zoom",e)),this._rotating&&this.fire(new wt("rotate",e)),this._pitching&&this.fire(new wt("pitch",e))}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new wt("zoomend",e)),n&&this.fire(new wt("rotateend",e)),i&&this.fire(new wt("pitchend",e)),this.fire(new wt("moveend",e))}flyTo(e,t){if(this._prefersReducedMotion(e)){const r=B(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,t)}this.stop(),e=k({offset:[0,0],speed:1.2,curve:1.42,easing:R},e);const r=this.transform,n=this.getZoom(),i=this.getBearing(),a=this.getPitch(),o=this.getPadding(),s="zoom"in e?C(+e.zoom,r.minZoom,r.maxZoom):n,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,u="pitch"in e?+e.pitch:a,c="padding"in e?e.padding:r.padding,d=r.zoomScale(s-n),h=y.convert(e.offset);let f=r.centerPoint.add(h);const p=r.pointLocation(f),m=Bh.convert(e.center||p);this._normalizeCenter(m);const g=r.project(p),_=r.project(m).sub(g);let v=e.curve;const b=Math.max(r.width,r.height),x=b/d,T=_.mag();if("minZoom"in e){const t=C(Math.min(e.minZoom,n,s),r.minZoom,r.maxZoom),i=b/r.zoomScale(t-n);v=Math.sqrt(i/T*2)}const w=v*v;function E(e){const t=(x*x-b*b+(e?-1:1)*w*w*T*T)/(2*(e?x:b)*w*T);return Math.log(Math.sqrt(t*t+1)-t)}function A(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const P=E(0);let M=function(e){return S(P)/S(P+v*e)},O=function(e){return b*((S(P)*(A(t=P+v*e)/S(t))-A(P))/w)/T;var t},L=(E(1)-P)/v;if(Math.abs(T)<1e-6||!isFinite(L)){if(Math.abs(b-x)<1e-6)return this.easeTo(e,t);const r=x<b?-1:1;L=Math.abs(Math.log(x/b))/v,O=function(){return 0},M=function(e){return Math.exp(r*v*e)}}e.duration="duration"in e?+e.duration:1e3*L/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const I=i!==l,D=u!==a,F=!r.isPaddingEqual(c),N=r=>d=>{const p=d*L,y=1/M(p);r.zoom=1===d?s:n+r.scaleZoom(y),I&&(r.bearing=Hn(i,l,d)),D&&(r.pitch=Hn(a,u,d)),F&&(r.interpolatePadding(o,c,d),f=r.centerPoint.add(h));const v=1===d?m:r.unproject(g.add(_.mult(O(p))).mult(y));return r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),r._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(t),r};if(e.preloadOnly){const t=this._emulate(N,e.duration,r);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=I,this._pitching=D,this._padding=F,this._prepareEase(t,!1),this._ease(N(r),(()=>this._afterEase(t)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,r){!1===r.animate||0===r.duration?(e(1),t()):(this._easeStart=st.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((st.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=L(e,-180,180);const r=Math.abs(e-t);return Math.abs(e-360-t)<r&&(e-=360),Math.abs(e+360-t)<r&&(e+=360),e}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&st.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,t,r){const n=Math.ceil(15*t/1e3),i=[],a=e(r.clone());for(let e=0;e<=n;e++){const t=a(e/n);i.push(t.clone())}return i}}class zP{constructor(e={}){this.options=e,G(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=lt("div","tianjingmapgl-ctrl tianjingmapgl-ctrl-attrib"),this._compactButton=lt("button","tianjingmapgl-ctrl-attrib-button",this._container),lt("span","tianjingmapgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=lt("div","tianjingmapgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("tianjingmapgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const r=this._map._getUIString(`AttributionControl.${t}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("tianjingmapgl-compact-show")?(this._container.classList.remove("tianjingmapgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("tianjingmapgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.ACCESS_TOKEN}];if(e){const r=t.reduce(((e,r,n)=>(r.value&&(e+=`${r.key}=${r.value}${n<t.length-1?"&":""}`),e)),"?");e.href=`${i.FEEDBACK_URL}/${r}#${HS(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const r in t){const n=t[r];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,r)=>{for(let n=r+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("tianjingmapgl-attrib-empty")):this._container.classList.add("tianjingmapgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("tianjingmapgl-compact"):this._container.classList.remove("tianjingmapgl-compact","tianjingmapgl-compact-show")}}class VP{constructor(){G(["_updateLogo","_updateCompact"],this)}onAdd(e){return this._map=e,this._container=lt("div","tianjingmapgl-ctrl"),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("tianjingmapgl-compact"):t.classList.remove("tianjingmapgl-compact")}}}class $P{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const t of r)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function HP(e,t,r){if(e=new Bh(e.lng,e.lat),t){const n=new Bh(e.lng-360,e.lat),i=new Bh(e.lng+360,e.lat),a=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),o=r.locationPoint(e).distSqr(t),s=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(n).distSqr(t)<o&&(s||Math.abs(n.lng-r.center.lng)<a)?e=n:r.locationPoint(i).distSqr(t)<o&&(s||Math.abs(i.lng-r.center.lng)<a)&&(e=i)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const WP={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class XP extends At{constructor(e,r){if(super(),(e instanceof t.HTMLElement||r)&&(e=k({element:e},r)),G(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=y.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=lt("div");const t=41,r=27,n=ut("svg",{display:"block",height:t*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${t}`},this._element),i=ut("radialGradient",{id:"shadowGradient"},ut("defs",{},n));ut("stop",{offset:"10%","stop-opacity":.4},i),ut("stop",{offset:"100%","stop-opacity":.05},i),ut("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),ut("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),ut("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),ut("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=y.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("tianjingmapgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const n=this._element.classList;for(const e in WP)n.remove(`tianjingmapgl-marker-anchor-${e}`);n.add(`tianjingmapgl-marker-anchor-${this._anchor}`);const i=e&&e.className?e.className.trim().split(/\s+/):[];n.add(...i),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Bh.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,r=13.5,n=Math.sqrt(Math.pow(r,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-r+n)],"bottom-right":[-n,-1*(t-r+n)],left:[r,-1*(t-r)],right:[-r,-1*(t-r)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const r=e.unproject(t),n=e.getFreeCameraOptions();if(!n.position)return!1;const i=n.position.toLngLat();return i.distanceTo(r)<.9*i.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const t=this._pos;if(!t||t.x<0||t.x>e.transform.width||t.y<0||t.y>e.transform.height)return void this._clearFadeTimer();const r=e.unproject(t);let n;e._showingGlobe()&&Mh(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(r),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${WP[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const e=this._pos,t=this._map,r=this.getPitchAlignment();if(!t||!e||"map"!==r)return"";if(!t._showingGlobe()){const e=t.getPitch();return e?`rotateX(${e}deg)`:""}const n=w(Ph(t.transform,this._lngLat)),i=e.sub(Sh(t.transform)),a=Math.abs(i.x)+Math.abs(i.y);if(0===a)return"";const o=n/a;return`rotateX(${-i.y*o}deg) rotateY(${i.x*o}deg)`}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(t._showingGlobe()){const e=t.project(new Bh(this._lngLat.lng,this._lngLat.lat+.001)),n=t.project(new Bh(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);r=w(Math.atan2(n.y,n.x))-90}else r=-t.getBearing();else if("horizon"===n){const n=O(4,6,t.getZoom()),i=Sh(t.transform);i.y+=n*t.transform.height;const a=e.sub(i),o=w(Math.atan2(a.y,a.x));r=(o>90?o-270:o+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){t.cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=HP(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),!0===e?this._updateFrameId=t.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),r._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=y.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const t=this._map;if(!t)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const n=this._clickTolerance||t._clickTolerance;if(e.point.dist(r)<n)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new wt("dragstart"))),this.fire(new wt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new wt("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const YP={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ZP=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function KP(e=new y(0,0),t="bottom"){if("number"==typeof e){const r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new y(0,e);case"top-left":return new y(r,r);case"top-right":return new y(-r,r);case"bottom":return new y(0,-e);case"bottom-left":return new y(r,-r);case"bottom-right":return new y(-r,-r);case"left":return new y(e,0);case"right":return new y(-e,0)}return new y(0,0)}return e instanceof y||Array.isArray(e)?y.convert(e):y.convert(e[t]||[0,0])}class JP{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const t=A((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-t)+this._end*t}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const QP={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use âŒ˜ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},eM={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},tM={showCompass:!0,showZoom:!0,visualizePitch:!1};class rM{constructor(e,t,r=!1){this._clickTolerance=10,this.element=t,this.mouseRotate=new pP({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new mP({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),G(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),ft()}move(e,t){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,t),i=n&&n.bearingDelta;if(i&&r.setBearing(r.getBearing()+i),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),i=n&&n.pitchDelta;i&&r.setPitch(r.getPitch()+i)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pt(),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(k({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),_t(this.element,e)),t.addEventListener("mousemove",this.mousemove),t.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,_t(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=yt(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=yt(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const nM={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},iM={maxWidth:100,unit:"metric"},aM={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},oM={version:r,supported:et,setRTLTextPlugin:function(e,t,r=!1){if(zo===qo||zo===Uo||zo===jo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vo=st.resolveURL(e),zo=qo,Go=t,Ho(),r||Yo()},getRTLTextPluginStatus:Xo,Map:class extends GP{constructor(e){if(Ze.mark(Ye.create),null!=(e=k({},eM,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==te){const t=e.navigator?e.navigator.userAgent:null;te=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return te}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(t)&&(e.antialias=!1,X("Antialiasing is disabled for this WebGL context to avoid browser bug: /tianjingmap-gl-js/issues/11609")),super(new hb(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new $P,this._domRenderTaskQueue=new $P,this._controls=[],this._markers=[],this._popups=[],this._mapId=N(),this._locale=k({},QP,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new JP(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Ce(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof t.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),G(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==t&&(this._fullscreenchangeEvent="onfullscreenchange"in t.document?"fullscreenchange":"webkitfullscreenchange",t.addEventListener("online",this._onWindowOnline,!1),t.addEventListener("resize",this._onWindowResize,!1),t.addEventListener("orientationchange",this._onWindowResize,!1),t.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new UP(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||i.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new $S("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const t=e.bounds;t&&(this.resize(),this.fitBounds(t,k({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new zP({customAttribution:e.customAttribution})),this._logoControl=new VP,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new wt(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new wt(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Et(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[t];return-1!==t.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Et(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new wt("movestart",e)).fire(new wt("move",e)),this.fire(new wt("resize",e)),t&&this.fire(new wt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Zl.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new wt("zoomstart")).fire(new wt("zoom")).fire(new wt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new wt("zoomstart")).fire(new wt("zoom")).fire(new wt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new wt("pitchstart")).fire(new wt("pitch")).fire(new wt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new wt("pitchstart")).fire(new wt("pitch")).fire(new wt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?t.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?t.navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let r;"globe"===t&&e.zoom>=Hd?(e.setMercatorFromTransition(),r=!0):"mercator"===t&&e.zoom<Hd&&(e.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=Hd?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Bh.convert(e))}unproject(e){return this.transform.pointLocation3D(y.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){if("mouseenter"===e||"mouseover"===e){let n=!1;const i=i=>{const a=t.filter((e=>this.getLayer(e))),o=a.length?this.queryRenderedFeatures(i.point,{layers:a}):[];o.length?n||(n=!0,r.call(this,new tP(e,this,i.originalEvent,{features:o}))):n=!1},a=()=>{n=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:i,mouseout:a}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const i=i=>{const a=t.filter((e=>this.getLayer(e)));(a.length?this.queryRenderedFeatures(i.point,{layers:a}):[]).length?n=!0:n&&(n=!1,r.call(this,new tP(e,this,i.originalEvent)))},a=t=>{n&&(n=!1,r.call(this,new tP(e,this,t.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:i,mouseout:a}}}{const n=e=>{const n=t.filter((e=>this.getLayer(e))),i=n.length?this.queryRenderedFeatures(e.point,{layers:n}):[];i.length&&(e.features=i,r.call(this,e),delete e.features)};return{layers:new Set(t),listener:r,delegates:{[e]:n}}}}on(e,t,r){if(void 0===r)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const n=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const n=this._createDelegatedListener(e,t,r);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,r){if(void 0===r)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const e of t)if(!this._isValidId(e))return this;const n=(e,t)=>{if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0},i=this._delegatedListeners?this._delegatedListeners[e]:void 0;return i&&(e=>{for(let i=0;i<e.length;i++){const a=e[i];if(a.listener===r&&n(a.layers,t)){for(const e in a.delegates)this.off(e,a.delegates[e]);return e.splice(i,1),this}}})(i),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof y||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const e of t.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&X(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(y.convert(e))}setStyle(e,t){return!1!==(t=k({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new zS(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zS(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),n=this._requestManager.transformRequest(r,ye.Style);Te(n,((e,r)=>{e?this.fire(new Et(e)):r&&this._updateDiff(r,t)}))}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(r){X(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(X("There is no style added to the map."),!1)}_isValidId(e){return!function(e){return e.indexOf("")>=0}(e)||(this.fire(new Et(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const r=e[t]._tiles;for(const e in r){const t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,r,{pixelRatio:n=1,sdf:i=!1,stretchX:a,stretchY:o,content:s}={}){if(this._lazyInitEmptyStyle(),r instanceof t.HTMLImageElement||t.ImageBitmap&&r instanceof t.ImageBitmap){const{width:t,height:l,data:u}=st.getImageData(r);this.style.addImage(e,{data:new Vf({width:t,height:l},u),pixelRatio:n,stretchX:a,stretchY:o,content:s,sdf:i,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new Et(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:t,height:l}=r,u=r;this.style.addImage(e,{data:new Vf({width:t,height:l},new Uint8Array(u.data)),pixelRatio:n,stretchX:a,stretchY:o,content:s,sdf:i,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,r){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new Et(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=r instanceof t.HTMLImageElement||t.ImageBitmap&&r instanceof t.ImageBitmap?st.getImageData(r):r,{width:a,height:o}=i;void 0!==a&&void 0!==o?a===n.data.width&&o===n.data.height?(n.data.replace(i.data,!(r instanceof t.HTMLImageElement||t.ImageBitmap&&r instanceof t.ImageBitmap)),this.style.updateImage(e,n)):this.fire(new Et(new Error(`The width and height of the updated image (${a}, ${o})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new Et(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Et(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,r){Me(this._requestManager.transformRequest(e,ye.Image),((e,n)=>{r(e,n instanceof t.HTMLImageElement?st.getImageData(n):n)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Et(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t,r={}){return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r,n={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,n),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r,n={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,n),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Bh.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let n,i,a,o=this._container;for(;o&&(!i||!a);){const e=t.getComputedStyle(o).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(a=n[3])),o=o.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=a?Math.abs(r/a):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("tianjingmapgl-map"),(this._missingCSSCanary=lt("div","tianjingmapgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=lt("div","tianjingmapgl-canvas-container",e);this._canvas=lt("canvas","tianjingmapgl-canvas",t),this._interactive&&(t.classList.add("tianjingmapgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=lt("div","tianjingmapgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{n[e]=lt("div",`tianjingmapgl-ctrl-${e}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const r=st.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=k({},et.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(function(e,t){Xe.add(e)}(t),this.painter=new PS(t,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),a.testSupport(t)):this.fire(new Et(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new wt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new wt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let r;this.fire(new wt("renderstart"));const n=this.painter.context.extTimerQuery,i=st.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=a.createQuery(),a.beginQuery(n.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,t=this.transform.pitch,r=st.now(),n=new Ko(e,{now:r,fadeDuration:o,pitch:t,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new wt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new wt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const e=st.now()-i;a.endQuery(n.TIME_ELAPSED_EXT),setTimeout((()=>{const n=a.getQueryParameter(r,a.QUERY_RESULT)/1e6;a.deleteQuery(r),this.fire(new wt("gpu-timing-frame",{cpuTime:e,gpuTime:n})),t.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:n}})}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const t=this.painter.queryGpuTimers(e);this.fire(new wt("gpu-timing-layer",{layerTimes:t}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const t=this.painter.queryGpuTimeDeferredRender(e);this.fire(new wt("gpu-timing-deferred-render",{gpuTime:t}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(s=this._updateAverageElevation(i,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new wt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new wt("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,Ze.mark(Ye.fullLoad),this._performanceMetricsCollection&&He(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const a=Math.abs(t-i);if(a>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(i),r(i);this._averageElevation.easeTo(i,e,300)}else if(a>1e-4)return this._averageElevation.jumpTo(i),r(i)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,n=r.createFramebuffer();function i(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);const t=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,t),t}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,r){let n=r[1]-r[0];const i=e.length/4;for(let a=0;a<t.length;a++){const o=t[a];let s=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(s+=1);n+=(r[a+2]-r[a+1])*(1-s/i)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t&&(t.removeEventListener("resize",this._onWindowResize,!1),t.removeEventListener("orientationchange",this._onWindowResize,!1),t.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.removeEventListener("online",this._onWindowOnline,!1),t.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("tianjingmapgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Xe.delete(this.painter.context.gl),this._removed=!0,this.fire(new wt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=st.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(e){return I(this.style?Object.values(this.style._sourceCaches):[],((t,r)=>t._preloadTiles(e,r)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===t.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){!function(e,t){de=e,he=t}(e,t)}get version(){return r}},NavigationControl:class{constructor(e){this.options=k({},tM,e),this._container=lt("div","tianjingmapgl-ctrl tianjingmapgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(G(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("tianjingmapgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),lt("span","tianjingmapgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("tianjingmapgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),lt("span","tianjingmapgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(G(["_rotateCompassArrow"],this),this._compass=this._createButton("tianjingmapgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=lt("span","tianjingmapgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rM(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=lt("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends At{constructor(e){super(),this.options=k({geolocation:t.navigator.geolocation},nM,e),G(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=VS(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=lt("div","tianjingmapgl-ctrl tianjingmapgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const r=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.navigator.permissions?t.navigator.permissions.query({name:"geolocation"}).then((e=>r("denied"!==e.state))).catch((()=>r())):r()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new wt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("tianjingmapgl-user-location-dot-stale"),this.fire(new wt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new Bh(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=k({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),n,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new Bh(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=Gh(1,e._center.lat)*e.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("tianjingmapgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("tianjingmapgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("tianjingmapgl-user-location-dot-stale"),this.fire(new wt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=lt("button","tianjingmapgl-ctrl-geolocate",this._container),lt("span","tianjingmapgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){X("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=lt("div","tianjingmapgl-user-location"),this._dotElement.appendChild(lt("div","tianjingmapgl-user-location-dot")),this._dotElement.appendChild(lt("div","tianjingmapgl-user-location-heading")),this._userLocationDotMarker=new XP({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=lt("div","tianjingmapgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new XP({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active"),this.fire(new wt("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new wt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background-error"),this.fire(new wt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new wt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.addEventListener("ondeviceorientationabsolute"in t?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.DeviceMotionEvent&&"function"==typeof t.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.removeEventListener("deviceorientation",this._onDeviceOrientation),t.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("tianjingmapgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zP,ScaleControl:class{constructor(e){this.options=k({},iM,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),G(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,n=t._containerWidth/2-e/2,i=t.unproject([n,r]),a=t.unproject([n+e,r]),o=i.distanceTo(a);if("imperial"===this.options.unit){const t=3.2808*o;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,r){this._map._requestDomTask((()=>{const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let r=e/t;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r),t*r}(t),i=n/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(n):`${n}&nbsp;${aM[r]}`,this._container.style.width=e*i+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=lt("div","tianjingmapgl-ctrl tianjingmapgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.HTMLElement?this._container=e.container:X("Full screen control 'container' must be a DOM element.")),G(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=lt("div","tianjingmapgl-ctrl tianjingmapgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.document.fullscreenEnabled&&!t.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=lt("button","tianjingmapgl-ctrl-fullscreen",this._controlContainer);lt("span","tianjingmapgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.document.fullscreenElement||t.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("tianjingmapgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("tianjingmapgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.document.exitFullscreen?t.document.exitFullscreen():t.document.webkitCancelFullScreen&&t.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends At{constructor(e){super(),this.options=k(Object.create(YP),e),G(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("tianjingmapgl-track-pointer")):e.on("move",this._update),this.fire(new wt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("tianjingmapgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new wt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Bh.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("tianjingmapgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("tianjingmapgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.document.createTextNode(e))}setHTML(e){const r=t.document.createDocumentFragment(),n=t.document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)r.appendChild(i);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=lt("div","tianjingmapgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=lt("button","tianjingmapgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,n=this._pos;if(!t||!r||!n)return"bottom";const i=r.offsetWidth,a=r.offsetHeight,o=n.x<i/2,s=n.x>t.transform.width-i/2;if(n.y+e<a)return o?"top-left":s?"top-right":"top";if(n.y>t.transform.height-a){if(o)return"bottom-left";if(s)return"bottom-right"}return o?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("tianjingmapgl-popup"),this._anchor&&t.push(`tianjingmapgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("tianjingmapgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=lt("div","tianjingmapgl-popup",t.getContainer()),this._tip=lt("div","tianjingmapgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=HP(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const r=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),n=KP(this.options.offset),i=this._anchor=this._getAnchor(n.y),a=KP(this.options.offset,i),o=r.add(a).round();t._requestDomTask((()=>{this._container&&i&&(this._container.style.transform=`${WP[i]} translate(${o.x}px,${o.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const e=Mh(t.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ZP);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:XP,Style:zS,LngLat:Bh,LngLatBounds:Zl,Point:y,MercatorCoordinate:Kh,FreeCameraOptions:Nv,Evented:At,config:i,prewarm:function(){FT().acquire(DT)},clearPrewarmedResources:function(){const e=BT;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(DT),BT=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.ACCESS_TOKEN},set accessToken(e){i.ACCESS_TOKEN=e},get baseApiUrl(){return i.API_URL},set baseApiUrl(e){i.API_URL=e},get workerCount(){return kT.workerCount},set workerCount(e){kT.workerCount=e},get maxParallelImageRequests(){return i.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){i.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(e){if(!fe())return;const r=t.caches.delete(le);e&&r.catch(e).then((()=>e()))}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return GT()},set dracoUrl(e){!function(e){qT=st.resolveURL(e),jT||(jT=new fT(FT(),new At)),jT.broadcast("setDracoUrl",qT)}(e)},setNow:st.setNow,restoreNow:st.restoreNow};e.A=hT,e.D=qm,e.E=nn,e.F=Gm,e.K=uE,e.O=Dd,e.P=y,e.T=Db,e.V=Qp,e.a=Up,e.b=nm,e.c=Xx,e.d=class extends At{constructor(e,t,r,n,i,a){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||RT,this.loading={},this.loaded={},this.deduped=new MT(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler,this.brightness=a}loadTile(e,t){const r=e.uid,n=e&&e.request,i=n&&n.collectResourceTiming,a=this.loading[r]=new ST(e);a.abort=this.loadVectorData(e,((o,s)=>{const l=!this.loading[r];if(delete this.loading[r],l||o||!s)return a.status="done",l||(this.loaded[r]=a),t(o);const u=s.rawData,c={};s.expires&&(c.expires=s.expires),s.cacheControl&&(c.cacheControl=s.cacheControl),a.vectorTile=s.vectorTile||new Jp(new Em(u));const d=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return t(e);const a={};if(i){const e=Qe(n);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,k({rawTileData:u.slice(0)},r,c,a))}))};this.isSpriteLoaded?d():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(d,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):d()})),this.loaded=this.loaded||{},this.loaded[r]=a}))}reloadTile(e,t){const r=this.loaded,n=e.uid,i=this;if(r&&r[n]){const a=r[n];a.showCollisionBoxes=e.showCollisionBoxes,a.projection=e.projection,a.brightness=e.brightness,a.tileTransform=b_(e.tileID.canonical,e.projection),a.extraShadowCaster=e.extraShadowCaster;const o=(e,r)=>{const n=a.reloadCallback;n&&(delete a.reloadCallback,a.parse(a.vectorTile,i.layerIndex,this.availableImages,i.actor,n)),t(e,r)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}},e.e=ma,e.f=Qe,e.g=h,e.h=Te,e.i=we,e.j=function(e,t){const r=fw(e);for(const e of r){for(const t of e.meshes)pw(t);e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(mw(e.lights,t)))}return r},e.k=Ko,e.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==KT){const r=new Uint32Array(e,0,7),[,,n,i,a,o]=r;t=r.byteLength+i+a+o+a,(n!==e.byteLength||t>=e.byteLength)&&X("Invalid b3dm header information.")}return nw(e,t)},e.m=V_,e.n=Zo,e.o=wt,e.p=g,e.q=function(e){pe(),ue&&ue.then((t=>{t.keys().then((r=>{for(let n=0;n<r.length-e;n++)t.delete(r[n])}))}))},e.r=ww,e.s=oM,e.t=Zh,e.v=D,e.w=t})),n(0,(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let r="[";for(const n of e)r+=`${t(n)},`;return`${r}]`}let r="{";for(const n of Object.keys(e).sort())r+=`${n}:${t(e[n])},`;return`${r}}`}function r(r){let n="";for(const i of e.r)n+=`/${t(r[i])}`;return n}class n{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,n,i){this._options=i;for(const r of t){this._layerConfigs[r.id]=r;const t=this._layers[r.id]=e.c(r,this._options);t.setScope(this.scope),t.compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id]}for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const a=function(e,t){const n={};for(let i=0;i<e.length;i++){const a=t&&t[e[i].id]||r(e[i]);t&&(t[e[i].id]=a);let o=n[a];o||(o=n[a]=[]),o.push(e[i])}const i=[];for(const e in n)i.push(n[e]);return i}(e.v(this._layerConfigs),this.keyCache);for(const e of a){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const a=r.sourceLayer||"_geojsonTileLayer";let o=i[a];o||(o=i[a]=[]),o.push(t)}}}class i{loadTile(t,r){const{uid:n,encoding:i,rawImageData:a,padding:o}=t,s=e.w.ImageBitmap&&a instanceof e.w.ImageBitmap?this.getImageData(a,o):a;r(null,new e.D(n,s,i,t.convertToFloat,o<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}function a(e,t){if(0!==e.length){o(e[0],t);for(var r=1;r<e.length;r++)o(e[r],!t)}}function o(e,t){for(var r=0,n=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}r+n>=0!=!!t&&e.reverse()}var s=e.g((function e(t,r){var n,i=t&&t.type;if("FeatureCollection"===i)for(n=0;n<t.features.length;n++)e(t.features[n],r);else if("GeometryCollection"===i)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],r);else if("Feature"===i)e(t.geometry,r);else if("Polygon"===i)a(t.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<t.coordinates.length;n++)a(t.coordinates[n],r);return t}));const l=e.V.prototype.toGeoJSON;let u=class{constructor(t){this._feature=t,this.extent=e.E,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const n=[];for(const t of r)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,r){return l.call(this,e,t,r)}},c=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.E,this.length=t.length,this._features=t}feature(e){return new u(this._features[e])}};var d={exports:{}},h=e.p,f=e.a.VectorTileFeature,p=m;function m(e,t){this.options=t||{},this.features=e,this.length=e.length}function g(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}m.prototype.feature=function(e){return new g(this.features[e],this.options.extent)},g.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],n=[],i=0;i<r.length;i++)n.push(new h(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,i=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[t,n,r,i]},g.prototype.toGeoJSON=f.prototype.toGeoJSON;var _=e.b,y=p;function v(e){var t=new _;return function(e,t){for(var r in e.layers)t.writeMessage(3,b,e.layers[r])}(e,t),t.finish()}function b(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),t.writeMessage(2,x,n);var i=n.keys;for(r=0;r<i.length;r++)t.writeStringField(3,i[r]);var a=n.values;for(r=0;r<a.length;r++)t.writeMessage(4,S,a[r])}function x(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,T,e),t.writeVarintField(3,r.type),t.writeMessage(4,A,r)}function T(e,t){var r=e.feature,n=e.keys,i=e.values,a=e.keycache,o=e.valuecache;for(var s in r.properties){var l=r.properties[s],u=a[s];if(null!==l){void 0===u&&(n.push(s),a[s]=u=n.length-1),t.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var d=c+":"+l,h=o[d];void 0===h&&(i.push(l),o[d]=h=i.length-1),t.writeVarint(h)}}}function w(e,t){return(t<<3)+(7&e)}function E(e){return e<<1^e>>31}function A(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,a=0,o=r.length,s=0;s<o;s++){var l=r[s],u=1;1===n&&(u=l.length),t.writeVarint(w(1,u));for(var c=3===n?l.length-1:l.length,d=0;d<c;d++){1===d&&1!==n&&t.writeVarint(w(2,c-1));var h=l[d].x-i,f=l[d].y-a;t.writeVarint(E(h)),t.writeVarint(E(f)),i+=h,a+=f}3===n&&t.writeVarint(w(7,1))}}function S(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}d.exports=v,d.exports.fromVectorTileJs=v,d.exports.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var n in e)r[n]=new y(e[n].features,t),r[n].name=n,r[n].version=t.version,r[n].extent=t.extent;return v({layers:r})},d.exports.GeoJSONWrapper=y;var P=e.g(d.exports);const M={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},R=Math.fround||(C=new Float32Array(1),e=>(C[0]=+e,C[0]));var C;const O=3,L=5,I=6;class D{constructor(e){this.options=Object.assign(Object.create(M),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;const a=[];for(let t=0;t<e.length;t++){const r=e[t];if(!r.geometry)continue;const[n,i]=r.geometry.coordinates,o=R(F(n)),s=R(N(i));a.push(o,s,1/0,t,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[n+1]=this._createTree(a);t&&console.timeEnd(i);for(let e=n;e>=r;e--){const r=+Date.now();o=this.trees[e]=this._createTree(this._cluster(o,e)),t&&console.log("z%d: %d clusters in %dms",e,o.numItems,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,a],t),o=this.getClusters([-180,n,i,a],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],s=o.range(F(r),N(a),F(i),N(n)),l=o.data,u=[];for(const e of s){const t=this.stride*e;u.push(l[t+L]>1?k(l,t,this.clusterProps):this.points[l[t+O]])}return u}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const a=i.data;if(t*this.stride>=a.length)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=i.within(a[t*this.stride],a[t*this.stride+1],o),l=[];for(const t of s){const r=t*this.stride;a[r+4]===e&&l.push(a[r+L]>1?k(a,r,this.clusterProps):this.points[a[r+O]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){const n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:a,radius:o}=this.options,s=o/a,l=(r-s)/i,u=(r+1+s)/i,c={features:[]};return this._addTileFeatures(n.range((t-s)/i,l,(t+1+s)/i,u),n.data,t,r,i,c),0===t&&this._addTileFeatures(n.range(1-s/i,l,1,u),n.data,i,r,i,c),t===i-1&&this._addTileFeatures(n.range(0,l,s/i,u),n.data,-1,r,i,c),c.features.length?c:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const a=this.getChildren(t);for(const t of a){const a=t.properties;if(a&&a.cluster?i+a.point_count<=n?i+=a.point_count:i=this._appendLeaves(e,a.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_createTree(t){const r=new e.K(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,n,i,a){for(const o of e){const e=o*this.stride,s=t[e+L]>1;let l,u,c;if(s)l=B(t,e,this.clusterProps),u=t[e],c=t[e+1];else{const r=this.points[t[e+O]];l=r.properties;const[n,i]=r.geometry.coordinates;u=F(n),c=N(i)}const d={type:1,geometry:[[Math.round(this.options.extent*(u*i-r)),Math.round(this.options.extent*(c*i-n))]],tags:l};let h;h=s||this.options.generateId?t[e+O]:this.points[t[e+O]].id,void 0!==h&&(d.id=h),a.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:i,minPoints:a}=this.options,o=r/(n*Math.pow(2,t)),s=e.data,l=[],u=this.stride;for(let r=0;r<s.length;r+=u){if(s[r+2]<=t)continue;s[r+2]=t;const n=s[r],c=s[r+1],d=e.within(s[r],s[r+1],o),h=s[r+L];let f=h;for(const e of d){const r=e*u;s[r+2]>t&&(f+=s[r+L])}if(f>h&&f>=a){let e,a=n*h,o=c*h,p=-1;const m=((r/u|0)<<5)+(t+1)+this.points.length;for(const n of d){const l=n*u;if(s[l+2]<=t)continue;s[l+2]=t;const c=s[l+L];a+=s[l]*c,o+=s[l+1]*c,s[l+4]=m,i&&(e||(e=this._map(s,r,!0),p=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(s,l)))}s[r+4]=m,l.push(a/f,o/f,1/0,m,-1,f),i&&l.push(p)}else{for(let e=0;e<u;e++)l.push(s[r+e]);if(f>1)for(const e of d){const r=e*u;if(!(s[r+2]<=t)){s[r+2]=t;for(let e=0;e<u;e++)l.push(s[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+L]>1){const n=this.clusterProps[e[t+I]];return r?Object.assign({},n):n}const n=this.points[e[t+O]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function k(e,t,r){return{type:"Feature",id:e[t+O],properties:B(e,t,r),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),q(e[t+1])]}};var n}function B(e,t,r){const n=e[t+L],i=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,a=e[t+I],o=-1===a?{}:Object.assign({},r[a]);return Object.assign(o,{cluster:!0,cluster_id:e[t+O],point_count:n,point_count_abbreviated:i})}function F(e){return e/360+.5}function N(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function q(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var U={exports:{}};U.exports=function(){function e(r,n,i,a){for(var o,s=a,l=i-n>>1,u=i-n,c=r[n],d=r[n+1],h=r[i],f=r[i+1],p=n+3;p<i;p+=3){var m=t(r[p],r[p+1],c,d,h,f);if(m>s)o=p,s=m;else if(m===s){var g=Math.abs(p-l);g<u&&(o=p,u=g)}}s>a&&(o-n>3&&e(r,n,o,a),r[o+2]=s,i-o>3&&e(r,o,i,a))}function t(e,t,r,n,i,a){var o=i-r,s=a-n;if(0!==o||0!==s){var l=((e-r)*o+(t-n)*s)/(o*o+s*s);l>1?(r=i,n=a):l>0&&(r+=o*l,n+=s*l)}return(o=e-r)*o+(s=t-n)*s}function r(e,t,r,i){var a={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)n(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)n(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)n(e,t[i][a])}(a),a}function n(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function i(e,t,n,l){if(t.geometry){var u=t.geometry.coordinates,c=t.geometry.type,d=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),h=[],f=t.id;if(n.promoteId?f=t.properties[n.promoteId]:n.generateId&&(f=l||0),"Point"===c)a(u,h);else if("MultiPoint"===c)for(var p=0;p<u.length;p++)a(u[p],h);else if("LineString"===c)o(u,h,d,!1);else if("MultiLineString"===c){if(n.lineMetrics){for(p=0;p<u.length;p++)o(u[p],h=[],d,!1),e.push(r(f,"LineString",h,t.properties));return}s(u,h,d,!1)}else if("Polygon"===c)s(u,h,d,!0);else{if("MultiPolygon"!==c){if("GeometryCollection"===c){for(p=0;p<t.geometry.geometries.length;p++)i(e,{id:f,geometry:t.geometry.geometries[p],properties:t.properties},n,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<u.length;p++){var m=[];s(u[p],m,d,!0),h.push(m)}}e.push(r(f,c,h,t.properties))}}function a(e,t){t.push(l(e[0])),t.push(u(e[1])),t.push(0)}function o(t,r,n,i){for(var a,o,s=0,c=0;c<t.length;c++){var d=l(t[c][0]),h=u(t[c][1]);r.push(d),r.push(h),r.push(0),c>0&&(s+=i?(a*h-d*o)/2:Math.sqrt(Math.pow(d-a,2)+Math.pow(h-o,2))),a=d,o=h}var f=r.length-3;r[2]=1,e(r,0,f,n),r[f+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function s(e,t,r,n){for(var i=0;i<e.length;i++){var a=[];o(e[i],a,r,n),t.push(a)}}function l(e){return e/360+.5}function u(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function c(e,t,n,i,a,o,s,l){if(i/=t,o>=(n/=t)&&s<i)return e;if(s<n||o>=i)return null;for(var u=[],c=0;c<e.length;c++){var f=e[c],m=f.geometry,g=f.type,_=0===a?f.minX:f.minY,y=0===a?f.maxX:f.maxY;if(_>=n&&y<i)u.push(f);else if(!(y<n||_>=i)){var v=[];if("Point"===g||"MultiPoint"===g)d(m,v,n,i,a);else if("LineString"===g)h(m,v,n,i,a,!1,l.lineMetrics);else if("MultiLineString"===g)p(m,v,n,i,a,!1);else if("Polygon"===g)p(m,v,n,i,a,!0);else if("MultiPolygon"===g)for(var b=0;b<m.length;b++){var x=[];p(m[b],x,n,i,a,!0),x.length&&v.push(x)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(b=0;b<v.length;b++)u.push(r(f.id,g,v[b],f.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),u.push(r(f.id,g,v,f.tags))}}}return u.length?u:null}function d(e,t,r,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=r&&o<=n&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function h(e,t,r,n,i,a,o){for(var s,l,u=f(e),c=0===i?g:_,d=e.start,h=0;h<e.length-3;h+=3){var p=e[h],y=e[h+1],v=e[h+2],b=e[h+3],x=e[h+4],T=0===i?p:y,w=0===i?b:x,E=!1;o&&(s=Math.sqrt(Math.pow(p-b,2)+Math.pow(y-x,2))),T<r?w>r&&(l=c(u,p,y,b,x,r),o&&(u.start=d+s*l)):T>n?w<n&&(l=c(u,p,y,b,x,n),o&&(u.start=d+s*l)):m(u,p,y,v),w<r&&T>=r&&(l=c(u,p,y,b,x,r),E=!0),w>n&&T<=n&&(l=c(u,p,y,b,x,n),E=!0),!a&&E&&(o&&(u.end=d+s*l),t.push(u),u=f(e)),o&&(d+=s)}var A=e.length-3;p=e[A],y=e[A+1],v=e[A+2],(T=0===i?p:y)>=r&&T<=n&&m(u,p,y,v),A=u.length-3,a&&A>=3&&(u[A]!==u[0]||u[A+1]!==u[1])&&m(u,u[0],u[1],u[2]),u.length&&t.push(u)}function f(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function p(e,t,r,n,i,a){for(var o=0;o<e.length;o++)h(e[o],t,r,n,i,a,!1)}function m(e,t,r,n){e.push(t),e.push(r),e.push(n)}function g(e,t,r,n,i,a){var o=(a-t)/(n-t);return e.push(a),e.push(r+(i-r)*o),e.push(1),o}function _(e,t,r,n,i,a){var o=(a-r)/(i-r);return e.push(t+(n-t)*o),e.push(a),e.push(1),o}function y(e,t){for(var n=[],i=0;i<e.length;i++){var a,o=e[i],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=v(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){a=[];for(var l=0;l<o.geometry.length;l++)a.push(v(o.geometry[l],t))}else if("MultiPolygon"===s)for(a=[],l=0;l<o.geometry.length;l++){for(var u=[],c=0;c<o.geometry[l].length;c++)u.push(v(o.geometry[l][c],t));a.push(u)}n.push(r(o.id,s,a,o.tags))}return n}function v(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function b(e,t){if(e.transformed)return e;var r,n,i,a=1<<e.z,o=e.x,s=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(x(u[n],u[n+1],t,a,o,s));else for(n=0;n<u.length;n++){var d=[];for(i=0;i<u[n].length;i+=2)d.push(x(u[n][i],u[n][i+1],t,a,o,s));l.geometry.push(d)}}return e.transformed=!0,e}function x(e,t,r,n,i,a){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-a))]}function T(e,t,r,n,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,w(o,e[s],a,i);var l=e[s].minX,u=e[s].minY,c=e[s].maxX,d=e[s].maxY;l<o.minX&&(o.minX=l),u<o.minY&&(o.minY=u),c>o.maxX&&(o.maxX=c),d>o.maxY&&(o.maxY=d)}return o}function w(e,t,r,n){var i=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)E(o,i,e,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<i.length;s++)E(o,i[s],e,r,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)E(o,u[s],e,r,!0,0===s)}if(o.length){var c=t.tags||null;if("LineString"===a&&n.lineMetrics){for(var d in c={},t.tags)c[d]=t.tags[d];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==t.id&&(h.id=t.id),e.features.push(h)}}function E(e,t,r,n,i,a){var o=n*n;if(n>0&&t.size<(i?o:n))r.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;i&&function(e,t){for(var r=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)r+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],s=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=s}}(s,a),e.push(s)}}function A(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)i(r,e.features[n],t,n);else i(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var r=t.buffer/t.extent,n=e,i=c(e,1,-1-r,r,0,-1,2,t),a=c(e,1,1-r,2+r,0,-1,2,t);return(i||a)&&(n=c(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=y(i,1).concat(n)),a&&(n=n.concat(y(a,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function S(e,t,r){return 32*((1<<e)*r+t)+e}return A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(e,t,r,n,i,a,o){for(var s=[e,t,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var d=1<<t,h=S(t,r,n),f=this.tiles[h];if(!f&&(u>1&&console.time("creation"),f=this.tiles[h]=T(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===l.maxZoom||t===i)continue;var m=1<<i-t;if(r!==Math.floor(a/m)||n!==Math.floor(o/m))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){u>1&&console.time("clipping");var g,_,y,v,b,x,w=.5*l.buffer/l.extent,E=.5-w,A=.5+w,P=1+w;g=_=y=v=null,b=c(e,d,r-w,r+A,0,f.minX,f.maxX,l),x=c(e,d,r+E,r+P,0,f.minX,f.maxX,l),e=null,b&&(g=c(b,d,n-w,n+A,1,f.minY,f.maxY,l),_=c(b,d,n+E,n+P,1,f.minY,f.maxY,l),b=null),x&&(y=c(x,d,n-w,n+A,1,f.minY,f.maxY,l),v=c(x,d,n+E,n+P,1,f.minY,f.maxY,l),x=null),u>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*r,2*n),s.push(_||[],t+1,2*r,2*n+1),s.push(y||[],t+1,2*r+1,2*n),s.push(v||[],t+1,2*r+1,2*n+1)}}},A.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e,s=S(e,t=(t%o+o)%o,r);if(this.tiles[s])return b(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,c=t,d=r;!l&&u>0;)u--,c=Math.floor(c/2),d=Math.floor(d/2),l=this.tiles[S(u,c,d)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",u,c,d),a>1&&console.time("drilling down"),this.splitTile(l.source,u,c,d,e,t,r),a>1&&console.timeEnd("drilling down"),this.tiles[s]?b(this.tiles[s],i):null):null},function(e,t){return new A(e,t)}}();var j=e.g(U.exports);function G(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return t(null,null);const i=new c(n.features);let a=P(i);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:i,rawData:a.buffer})}class z extends e.d{constructor(e,t,r,n,i,a){super(e,t,r,n,G,a),i&&(this.loadGeoJSON=i)}loadData(t,r){const n=t&&t.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(t,((a,o)=>{if(a||!o)return r(a);if("object"!=typeof o)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{s(o,!0);try{if(t.filter){const r=e.e(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=o.features.filter((e=>r.value.evaluate({zoom:0},e)));o={type:"FeatureCollection",features:n}}this._geoJSONIndex=t.cluster?new D(function({superclusterOptions:t,clusterProperties:r}){if(!r||!t)return t;const n={},i={},a={accumulated:null,zoom:0},o={properties:null},s=Object.keys(r);for(const t of s){const[a,o]=r[t],s=e.e(o),l=e.e("string"==typeof a?[a,["accumulated"],["get",t]]:a);n[t]=s.value,i[t]=l.value}return t.map=e=>{o.properties=e;const t={};for(const e of s)t[e]=n[e].evaluate(a,o);return t},t.reduce=(e,t)=>{o.properties=t;for(const t of s)a.accumulated=e[t],e[t]=i[t].evaluate(a,o)},t}(t)).load(o.features):j(o,t.geojsonVtOptions)}catch(a){return r(a)}this.loaded={};const l={};if(i){const r=e.f(n);r&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(r)))}r(null,l)}}))}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.h(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class V{constructor(t,r){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=r}parse(t,r,n,i){this.status="parsing";const a=new e.O(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),o={},s=r.familiesBySource[n.source],l=new e.F(a,n.promoteId);return l.bucketLayerIDs=[],e.l(t).then((t=>{if(!t)return i(new Error("Could not parse tile"));const r=e.j(t,1/e.t(n.tileID.canonical)),u=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features"),c=new e.k(this.zoom,{brightness:this.brightness});for(const n in s)for(const i of s[n]){const n=i[0],s=t.json.extensionsUsed;n.recalculate(c,[]);const l=new e.T(r,a,s&&s.includes("MAPBOX_mesh_features"),this.brightness);u||(l.needsUpload=!0),o[n.fqid]=l,l.evaluate(n)}this.status="done",i(null,{buckets:o,featureIndex:l})})).catch((e=>i(new Error(e.message))))}}class ${constructor(e,t,r,n,i,a){this.actor=e,this.layerIndex=t,this.brightness=a,this.loading={},this.loaded={}}loadTile(t,r){const n=t.uid,i=this.loading[n]=new V(t,this.brightness);e.i(t.request,((e,a)=>{const o=!this.loading[n];return delete this.loading[n],o||e?(i.status="done",o||(this.loaded[n]=i),r(e)):a&&0!==a.byteLength?void i.parse(a,this.layerIndex,t,((e,t)=>{i.status="done",this.loaded=this.loaded||{},this.loaded[n]=i,e||!t?r(e):r(null,t)})):(i.status="done",this.loaded[n]=i,r())}))}reloadTile(e,t){const r=this.loaded,n=e.uid;if(r&&r[n]){const i=r[n];i.projection=e.projection,i.brightness=e.brightness;const a=(r,n)=>{i.reloadCallback&&(delete i.reloadCallback,this.loadTile(e,t)),t(r,n)};"parsing"===i.status?i.reloadCallback=a:"done"===i.status&&this.loadTile(e,t)}}abortTile(e,t){const r=e.uid;this.loading[r]&&delete this.loading[r],t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class H{constructor(t){this.self=t,this.actor=new e.A(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.m({name:"mercator"}),this.workerSourceTypes={vector:e.d,geojson:z,"batched-model":$},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.n.isParsed())throw new Error("RTL text plugin already registered.");e.n.applyArabicShaping=t.applyArabicShaping,e.n.processBidirectionalText=t.processBidirectionalText,e.n.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,{scope:r,isLoaded:n}){if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][r]=n,this.workerSources[t]&&this.workerSources[t][r])for(const i in this.workerSources[t][r]){const a=this.workerSources[t][r][i];for(const t in a)a[t]instanceof e.d&&(a[t].isSpriteLoaded=n,a[t].fire(new e.o("isSpriteLoaded")))}}setImages(e,{scope:t,images:r},n){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=r,this.workerSources[e]&&this.workerSources[e][t]){for(const n in this.workerSources[e][t]){const i=this.workerSources[e][t][n];for(const e in i)i[e].availableImages=r}n()}else n()}setProjection(t,r){this.projections[t]=e.m(r)}setBrightness(e,t,r){this.brightness=t,r()}setLayers(e,t,r){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),r()}updateLayers(e,t,r){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),r()}loadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,r)}loadDEMTile(e,t,r){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,r)}reloadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,r)}removeSource(e,t,r){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const n=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(t,r,n){try{e.n.setState(r);const t=e.n.getPluginURL();if(e.n.isLoaded()&&!e.n.isParsed()&&null!=t){this.self.importScripts(t);const r=e.n.isParsed();n(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),r)}}catch(e){n(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][t];return r||(r=[]),r}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][t];return r||(r=this.layerIndexes[e][t]=new n,r.scope=t),r}getWorkerSource(e,t,r,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][n]||(this.workerSources[e][n]={}),this.workerSources[e][n][t]||(this.workerSources[e][n][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][n][t][r]){const i={send:(t,r,n,i,a,o)=>{this.actor.send(t,r,n,e,a,o)},scheduler:this.actor.scheduler};this.workerSources[e][n][t][r]=new this.workerSourceTypes[t](i,this.getLayerIndex(e,n),this.getAvailableImages(e,n),this.isSpriteLoaded[e][n],void 0,this.brightness)}return this.workerSources[e][n][t][r]}getDEMWorkerSource(e,t,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]={}),this.demWorkerSources[e][r][t]||(this.demWorkerSources[e][r][t]=new i),this.demWorkerSources[e][r][t]}enforceCacheSizeLimit(t,r){e.q(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new H(self)),H})),n(0,(function(e){return e.s})),r}()}(tianjingmapGl);var tianjingmapGlExports=tianjingmapGl.exports,tianjingmapgl=getDefaultExportFromCjs(tianjingmapGlExports);
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const REVISION="159",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",LinearTransfer="linear",SRGBTransfer="srgb",Rec709Primaries="rec709",P3Primaries="p3",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e);e.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&n]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toLowerCase()}function clamp(e,t,r){return Math.max(t,Math.min(r,e))}function euclideanModulo(e,t){return(e%t+t)%t}function mapLinear(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)}function inverseLerp(e,t,r){return e!==t?(r-e)/(t-e):0}function lerp(e,t,r){return(1-r)*e+r*t}function damp(e,t,r,n){return lerp(e,t,1-Math.exp(-r*n))}function pingpong(e,t=1){return t-Math.abs(euclideanModulo(e,2*t)-t)}function smoothstep(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)}function smootherstep(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)}function randInt(e,t){return e+Math.floor(Math.random()*(t-e+1))}function randFloat(e,t){return e+Math.random()*(t-e)}function randFloatSpread(e){return e*(.5-Math.random())}function seededRandom(e){void 0!==e&&(_seed=e);let t=_seed+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}function degToRad(e){return e*DEG2RAD}function radToDeg(e){return e*RAD2DEG}function isPowerOfTwo(e){return 0==(e&e-1)&&0!==e}function ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function floorPowerOfTwo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function setQuaternionFromProperEuler(e,t,r,n,i){const a=Math.cos,o=Math.sin,s=a(r/2),l=o(r/2),u=a((t+n)/2),c=o((t+n)/2),d=a((t-n)/2),h=o((t-n)/2),f=a((n-t)/2),p=o((n-t)/2);switch(i){case"XYX":e.set(s*c,l*d,l*h,s*u);break;case"YZY":e.set(l*h,s*c,l*d,s*u);break;case"ZXZ":e.set(l*d,l*h,s*c,s*u);break;case"XZX":e.set(s*c,l*p,l*f,s*u);break;case"YXY":e.set(l*f,s*c,l*p,s*u);break;case"ZYZ":e.set(l*p,l*f,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function denormalize(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function normalize(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD:DEG2RAD,RAD2DEG:RAD2DEG,generateUUID:generateUUID,clamp:clamp,euclideanModulo:euclideanModulo,mapLinear:mapLinear,inverseLerp:inverseLerp,lerp:lerp,damp:damp,pingpong:pingpong,smoothstep:smoothstep,smootherstep:smootherstep,randInt:randInt,randFloat:randFloat,randFloatSpread:randFloatSpread,seededRandom:seededRandom,degToRad:degToRad,radToDeg:radToDeg,isPowerOfTwo:isPowerOfTwo,ceilPowerOfTwo:ceilPowerOfTwo,floorPowerOfTwo:floorPowerOfTwo,setQuaternionFromProperEuler:setQuaternionFromProperEuler,normalize:normalize,denormalize:denormalize};class Vector2{constructor(e=0,t=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(e,t,r,n,i,a,o,s,l){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,n,i,a,o,s,l)}set(e,t,r,n,i,a,o,s,l){const u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=r,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],u=r[4],c=r[7],d=r[2],h=r[5],f=r[8],p=n[0],m=n[3],g=n[6],_=n[1],y=n[4],v=n[7],b=n[2],x=n[5],T=n[8];return i[0]=a*p+o*_+s*b,i[3]=a*m+o*y+s*x,i[6]=a*g+o*v+s*T,i[1]=l*p+u*_+c*b,i[4]=l*m+u*y+c*x,i[7]=l*g+u*v+c*T,i[2]=d*p+h*_+f*b,i[5]=d*m+h*y+f*x,i[8]=d*g+h*v+f*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-r*i*u+r*o*s+n*i*l-n*a*s}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,d=o*s-u*i,h=l*i-a*s,f=t*c+r*d+n*h;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=c*p,e[1]=(n*l-u*r)*p,e[2]=(o*r-n*a)*p,e[3]=d*p,e[4]=(u*t-n*s)*p,e[5]=(n*i-o*t)*p,e[6]=h*p,e[7]=(r*s-l*t)*p,e[8]=(a*t-r*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function createElementNS(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function createCanvasElement(){const e=createElementNS("canvas");return e.style.display="block",e}const _cache={};function warnOnce(e){e in _cache||(_cache[e]=!0,console.warn(e))}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=(new Matrix3).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=(new Matrix3).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),COLOR_SPACES={[LinearSRGBColorSpace]:{transfer:LinearTransfer,primaries:Rec709Primaries,toReference:e=>e,fromReference:e=>e},[SRGBColorSpace]:{transfer:SRGBTransfer,primaries:Rec709Primaries,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[LinearDisplayP3ColorSpace]:{transfer:LinearTransfer,primaries:P3Primaries,toReference:e=>e.applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:e=>e.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3)},[DisplayP3ColorSpace]:{transfer:SRGBTransfer,primaries:P3Primaries,toReference:e=>e.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:e=>e.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}},SUPPORTED_WORKING_COLOR_SPACES=new Set([LinearSRGBColorSpace,LinearDisplayP3ColorSpace]),ColorManagement={enabled:!0,_workingColorSpace:LinearSRGBColorSpace,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!SUPPORTED_WORKING_COLOR_SPACES.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,r){return!1!==this.enabled&&t!==r&&t&&r?(0,COLOR_SPACES[r].fromReference)((0,COLOR_SPACES[t].toReference)(e)):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return COLOR_SPACES[e].primaries},getTransfer:function(e){return e===NoColorSpace?LinearTransfer:COLOR_SPACES[e].transfer}};function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_canvas&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const r=_canvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=createElementNS("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),i=n.data;for(let e=0;e<i.length;e++)i[e]=255*SRGBToLinear(i[e]/255);return r.putImageData(n,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t[e]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*SRGBToLinear(t[e]/255)):SRGBToLinear(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _sourceId=0;class Source{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,r=n.length;t<r;t++)e.push(serializeImage(n[t].isDataTexture?n[t].image:n[t]))}else e=serializeImage(n);r.url=e}return t||(e.images[this.uuid]=r),r}}function serializeImage(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,n=ClampToEdgeWrapping,i=LinearFilter,a=LinearMipmapLinearFilter,o=RGBAFormat,s=UnsignedByteType,l=Texture.DEFAULT_ANISOTROPY,u=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof u?this.colorSpace=u:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(e){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null,Texture.DEFAULT_MAPPING=UVMapping,Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(e=0,t=0,r=0,n=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,i;const a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],d=s[1],h=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(u-d)<a&&Math.abs(c-p)<a&&Math.abs(f-m)<a){if(Math.abs(u+d)<o&&Math.abs(c+p)<o&&Math.abs(f+m)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,_=(g+1)/2,y=(u+d)/4,v=(c+p)/4,b=(f+m)/4;return e>s&&e>_?e<a?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(e),n=y/r,i=v/r):s>_?s<a?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(s),r=y/n,i=b/n):_<a?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(_),r=v/i,n=b/i),this.set(r,n,i,t),this}let _=Math.sqrt((m-f)*(m-f)+(c-p)*(c-p)+(d-u)*(d-u));return Math.abs(_)<.001&&(_=1),this.x=(m-f)/_,this.y=(c-p)/_,this.z=(d-u)/_,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t);const n={width:e,height:t,depth:1};void 0!==r.encoding&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new Texture(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Source(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,t=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:n},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Data3DTexture extends Texture{constructor(e=null,t=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:n},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Quaternion{constructor(e=0,t=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,i,a,o){let s=r[n+0],l=r[n+1],u=r[n+2],c=r[n+3];const d=i[a+0],h=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=f,void(e[t+3]=p);if(c!==p||s!==d||l!==h||u!==f){let e=1-o;const t=s*d+l*h+u*f+c*p,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const i=Math.sqrt(n),a=Math.atan2(i,t*r);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*r;if(s=s*e+d*i,l=l*e+h*i,u=u*e+f*i,c=c*e+p*i,e===1-o){const e=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=e,l*=e,u*=e,c*=e}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,r,n,i,a){const o=r[n],s=r[n+1],l=r[n+2],u=r[n+3],c=i[a],d=i[a+1],h=i[a+2],f=i[a+3];return e[t]=o*f+u*c+s*h-l*d,e[t+1]=s*f+u*d+l*c-o*h,e[t+2]=l*f+u*h+o*d-s*c,e[t+3]=u*f-o*c-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,n=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(r/2),u=o(n/2),c=o(i/2),d=s(r/2),h=s(n/2),f=s(i/2);switch(a){case"XYZ":this._x=d*u*c+l*h*f,this._y=l*h*c-d*u*f,this._z=l*u*f+d*h*c,this._w=l*u*c-d*h*f;break;case"YXZ":this._x=d*u*c+l*h*f,this._y=l*h*c-d*u*f,this._z=l*u*f-d*h*c,this._w=l*u*c+d*h*f;break;case"ZXY":this._x=d*u*c-l*h*f,this._y=l*h*c+d*u*f,this._z=l*u*f+d*h*c,this._w=l*u*c-d*h*f;break;case"ZYX":this._x=d*u*c-l*h*f,this._y=l*h*c+d*u*f,this._z=l*u*f-d*h*c,this._w=l*u*c+d*h*f;break;case"YZX":this._x=d*u*c+l*h*f,this._y=l*h*c+d*u*f,this._z=l*u*f-d*h*c,this._w=l*u*c-d*h*f;break;case"XZY":this._x=d*u*c-l*h*f,this._y=l*h*c-d*u*f,this._z=l*u*f+d*h*c,this._w=l*u*c+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],d=r+o+c;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-s)*e,this._y=(i-l)*e,this._z=(a-n)*e}else if(r>o&&r>c){const e=2*Math.sqrt(1+r-o-c);this._w=(u-s)/e,this._x=.25*e,this._y=(n+a)/e,this._z=(i+l)/e}else if(o>c){const e=2*Math.sqrt(1+o-r-c);this._w=(i-l)/e,this._x=(n+a)/e,this._y=.25*e,this._z=(s+u)/e}else{const e=2*Math.sqrt(1+c-r-o);this._w=(a-n)/e,this._x=(i+l)/e,this._y=(s+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=r*u+a*o+n*l-i*s,this._y=n*u+a*s+i*o-r*l,this._z=i*u+a*l+r*s-n*o,this._w=a*u-r*o-n*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,n=this._y,i=this._z,a=this._w;let o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*r+t*this._x,this._y=e*n+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),u=Math.atan2(l,o),c=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=a*c+this._w*d,this._x=r*c+this._x*d,this._y=n*c+this._y*d,this._z=i*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(n),r*Math.sin(i),r*Math.cos(i),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,r=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*n-o*r),u=2*(o*t-i*n),c=2*(i*r-a*t);return this.x=t+s*l+a*c-o*u,this.y=r+s*u+o*l-i*c,this.z=n+s*c+i*u-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return _vector$c.copy(this).projectOnVector(e),this.sub(_vector$c)}reflect(e){return this.sub(_vector$c.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(clamp(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$c=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(_vector$b.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(_vector$b.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=_vector$b.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(void 0!==r){const n=r.getAttribute("position");if(!0===t&&void 0!==n&&!0!==e.isInstancedMesh)for(let t=0,r=n.count;t<r;t++)!0===e.isMesh?e.getVertexPosition(t,_vector$b):_vector$b.fromBufferAttribute(n,t),_vector$b.applyMatrix4(e.matrixWorld),this.expandByPoint(_vector$b);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),_box$4.copy(e.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),_box$4.copy(r.boundingBox)),_box$4.applyMatrix4(e.matrixWorld),this.union(_box$4)}const n=e.children;for(let e=0,r=n.length;e<r;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$b),_vector$b.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$4.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)&&(t=[1,0,0,0,1,0,0,0,1],!!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$b).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(_vector$b).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(e,t,r,n,i){for(let a=0,o=e.length-3;a<=o;a+=3){_testAxis.fromArray(e,a);const o=i.x*Math.abs(_testAxis.x)+i.y*Math.abs(_testAxis.y)+i.z*Math.abs(_testAxis.z),s=t.dot(_testAxis),l=r.dot(_testAxis),u=n.dot(_testAxis);if(Math.max(-Math.max(s,l,u),Math.min(s,l,u))>o)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):_box$3.setFromPoints(e).getCenter(r);let n=0;for(let t=0,i=e.length;t<i;t++)n=Math.max(n,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_v1$6.subVectors(e,this.center);const t=_v1$6.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),r=.5*(e-this.radius);this.center.addScaledVector(_v1$6,r/e),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(_v2$3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(e.center).sub(_v2$3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$a)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_vector$a.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$a.copy(this.origin).addScaledVector(this.direction,t),_vector$a.distanceToSquared(e))}distanceSqToSegment(e,t,r,n){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);const i=.5*e.distanceTo(t),a=-this.direction.dot(_segDir),o=_diff.dot(this.direction),s=-_diff.dot(_segDir),l=_diff.lengthSq(),u=Math.abs(1-a*a);let c,d,h,f;if(u>0)if(c=a*s-o,d=a*o-s,f=i*u,c>=0)if(d>=-f)if(d<=f){const e=1/u;c*=e,d*=e,h=c*(c+a*d+2*o)+d*(a*c+d+2*s)+l}else d=i,c=Math.max(0,-(a*d+o)),h=-c*c+d*(d+2*s)+l;else d=-i,c=Math.max(0,-(a*d+o)),h=-c*c+d*(d+2*s)+l;else d<=-f?(c=Math.max(0,-(-a*i+o)),d=c>0?-i:Math.min(Math.max(-i,-s),i),h=-c*c+d*(d+2*s)+l):d<=f?(c=0,d=Math.min(Math.max(-i,-s),i),h=d*(d+2*s)+l):(c=Math.max(0,-(a*i+o)),d=c>0?i:Math.min(Math.max(-i,-s),i),h=-c*c+d*(d+2*s)+l);else d=a>0?-i:i,c=Math.max(0,-(a*d+o)),h=-c*c+d*(d+2*s)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,c),n&&n.copy(_segCenter).addScaledVector(_segDir,d),h}intersectSphere(e,t){_vector$a.subVectors(e.center,this.origin);const r=_vector$a.dot(this.direction),n=_vector$a.dot(_vector$a)-r*r,i=e.radius*e.radius;if(n>i)return null;const a=Math.sqrt(i-n),o=r-a,s=r+a;return s<0?null:this.at(o<0?s:o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,n,i,a,o,s;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(r=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),u>=0?(i=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(i=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),r>a||i>n?null:((i>r||isNaN(r))&&(r=i),(a<n||isNaN(n))&&(n=a),c>=0?(o=(e.min.z-d.z)*c,s=(e.max.z-d.z)*c):(o=(e.max.z-d.z)*c,s=(e.min.z-d.z)*c),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,_vector$a)}intersectTriangle(e,t,r,n,i){_edge1.subVectors(t,e),_edge2.subVectors(r,e),_normal$1.crossVectors(_edge1,_edge2);let a,o=this.direction.dot(_normal$1);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}_diff.subVectors(this.origin,e);const s=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(s<0)return null;const l=a*this.direction.dot(_edge1.cross(_diff));if(l<0)return null;if(s+l>o)return null;const u=-a*_diff.dot(_normal$1);return u<0?null:this.at(u/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m)}set(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,n=1/_v1$5.setFromMatrixColumn(e,0).length(),i=1/_v1$5.setFromMatrixColumn(e,1).length(),a=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){const e=a*u,r=a*c,n=o*u,i=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=r+n*l,t[5]=e-i*l,t[9]=-o*s,t[2]=i-e*l,t[6]=n+r*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*u,r=s*c,n=l*u,i=l*c;t[0]=e+i*o,t[4]=n*o-r,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=r*o-n,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*u,r=s*c,n=l*u,i=l*c;t[0]=e-i*o,t[4]=-a*c,t[8]=n+r*o,t[1]=r+n*o,t[5]=a*u,t[9]=i-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*u,r=a*c,n=o*u,i=o*c;t[0]=s*u,t[4]=n*l-r,t[8]=e*l+i,t[1]=s*c,t[5]=i*l+e,t[9]=r*l-n,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,r=a*l,n=o*s,i=o*l;t[0]=s*u,t[4]=i-e*c,t[8]=n*c+r,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=r*c+n,t[10]=e-i*c}else if("XZY"===e.order){const e=a*s,r=a*l,n=o*s,i=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=e*c+i,t[5]=a*u,t[9]=r*c-n,t[2]=n*c-r,t[6]=o*u,t[10]=i*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,r){const n=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),n[0]=_x.x,n[4]=_y.x,n[8]=_z.x,n[1]=_x.y,n[5]=_y.y,n[9]=_z.y,n[2]=_x.z,n[6]=_y.z,n[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],u=r[1],c=r[5],d=r[9],h=r[13],f=r[2],p=r[6],m=r[10],g=r[14],_=r[3],y=r[7],v=r[11],b=r[15],x=n[0],T=n[4],w=n[8],E=n[12],A=n[1],S=n[5],P=n[9],M=n[13],R=n[2],C=n[6],O=n[10],L=n[14],I=n[3],D=n[7],k=n[11],B=n[15];return i[0]=a*x+o*A+s*R+l*I,i[4]=a*T+o*S+s*C+l*D,i[8]=a*w+o*P+s*O+l*k,i[12]=a*E+o*M+s*L+l*B,i[1]=u*x+c*A+d*R+h*I,i[5]=u*T+c*S+d*C+h*D,i[9]=u*w+c*P+d*O+h*k,i[13]=u*E+c*M+d*L+h*B,i[2]=f*x+p*A+m*R+g*I,i[6]=f*T+p*S+m*C+g*D,i[10]=f*w+p*P+m*O+g*k,i[14]=f*E+p*M+m*L+g*B,i[3]=_*x+y*A+v*R+b*I,i[7]=_*T+y*S+v*C+b*D,i[11]=_*w+y*P+v*O+b*k,i[15]=_*E+y*M+v*L+b*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],d=e[10],h=e[14];return e[3]*(+i*s*c-n*l*c-i*o*d+r*l*d+n*o*h-r*s*h)+e[7]*(+t*s*h-t*l*d+i*a*d-n*a*h+n*l*u-i*s*u)+e[11]*(+t*l*c-t*o*h-i*a*c+r*a*h+i*o*u-r*l*u)+e[15]*(-n*o*u-t*s*c+t*o*d+n*a*c-r*a*d+r*s*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15],_=c*m*l-p*d*l+p*s*h-o*m*h-c*s*g+o*d*g,y=f*d*l-u*m*l-f*s*h+a*m*h+u*s*g-a*d*g,v=u*p*l-f*c*l+f*o*h-a*p*h-u*o*g+a*c*g,b=f*c*s-u*p*s-f*o*d+a*p*d+u*o*m-a*c*m,x=t*_+r*y+n*v+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/x;return e[0]=_*T,e[1]=(p*d*i-c*m*i-p*n*h+r*m*h+c*n*g-r*d*g)*T,e[2]=(o*m*i-p*s*i+p*n*l-r*m*l-o*n*g+r*s*g)*T,e[3]=(c*s*i-o*d*i-c*n*l+r*d*l+o*n*h-r*s*h)*T,e[4]=y*T,e[5]=(u*m*i-f*d*i+f*n*h-t*m*h-u*n*g+t*d*g)*T,e[6]=(f*s*i-a*m*i-f*n*l+t*m*l+a*n*g-t*s*g)*T,e[7]=(a*d*i-u*s*i+u*n*l-t*d*l-a*n*h+t*s*h)*T,e[8]=v*T,e[9]=(f*c*i-u*p*i-f*r*h+t*p*h+u*r*g-t*c*g)*T,e[10]=(a*p*i-f*o*i+f*r*l-t*p*l-a*r*g+t*o*g)*T,e[11]=(u*o*i-a*c*i-u*r*l+t*c*l+a*r*h-t*o*h)*T,e[12]=b*T,e[13]=(u*p*n-f*c*n+f*r*d-t*p*d-u*r*m+t*c*m)*T,e[14]=(f*o*n-a*p*n-f*r*s+t*p*s+a*r*m-t*o*m)*T,e[15]=(a*c*n-u*o*n+u*r*s-t*c*s-a*r*d+t*o*d)*T,this}scale(e){const t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,u*o+r,u*s-n*a,0,l*s-n*o,u*s+n*a,i*s*s+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,n,i,a){return this.set(1,r,i,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,r){const n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,c=o+o,d=i*l,h=i*u,f=i*c,p=a*u,m=a*c,g=o*c,_=s*l,y=s*u,v=s*c,b=r.x,x=r.y,T=r.z;return n[0]=(1-(p+g))*b,n[1]=(h+v)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(h-v)*x,n[5]=(1-(d+g))*x,n[6]=(m+_)*x,n[7]=0,n[8]=(f+y)*T,n[9]=(m-_)*T,n[10]=(1-(d+p))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){const n=this.elements;let i=_v1$5.set(n[0],n[1],n[2]).length();const a=_v1$5.set(n[4],n[5],n[6]).length(),o=_v1$5.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],_m1$2.copy(this);const s=1/i,l=1/a,u=1/o;return _m1$2.elements[0]*=s,_m1$2.elements[1]*=s,_m1$2.elements[2]*=s,_m1$2.elements[4]*=l,_m1$2.elements[5]*=l,_m1$2.elements[6]*=l,_m1$2.elements[8]*=u,_m1$2.elements[9]*=u,_m1$2.elements[10]*=u,t.setFromRotationMatrix(_m1$2),r.x=i,r.y=a,r.z=o,this}makePerspective(e,t,r,n,i,a,o=WebGLCoordinateSystem){const s=this.elements,l=2*i/(t-e),u=2*i/(r-n),c=(t+e)/(t-e),d=(r+n)/(r-n);let h,f;if(o===WebGLCoordinateSystem)h=-(a+i)/(a-i),f=-2*a*i/(a-i);else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);h=-a/(a-i),f=-a*i/(a-i)}return s[0]=l,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=u,s[9]=d,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,r,n,i,a,o=WebGLCoordinateSystem){const s=this.elements,l=1/(t-e),u=1/(r-n),c=1/(a-i),d=(t+e)*l,h=(r+n)*u;let f,p;if(o===WebGLCoordinateSystem)f=(a+i)*c,p=-2*c;else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);f=i*c,p=-1*c}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-d,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=p,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$1=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,r=0,n=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const n=e.elements,i=n[0],a=n[4],o=n[8],s=n[1],l=n[5],u=n[9],c=n[2],d=n[6],h=n[10];switch(t){case"XYZ":this._y=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(clamp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return _matrix$1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix$1,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const e=new Vector3,t=new Euler,r=new Quaternion,n=new Vector3(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);const n=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),n&&(_m1$1.extractRotation(n.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const n=this.children;for(let i=0,a=n.length;i<a;i++)n[i].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,n=t.length;r<n;r++){const n=t[r];!0!==n.matrixWorldAutoUpdate&&!0!==e||n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++){const r=e[t];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const r=t.shapes;if(Array.isArray(r))for(let t=0,n=r.length;t<n;t++)i(e.shapes,r[t]);else i(e.shapes,r)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let r=0,n=this.material.length;r<n;r++)t.push(i(e.materials,this.material[r]));n.material=t}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++)n.animations.push(i(e.animations,this.animations[t]))}if(t){const t=a(e.geometries),n=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),u=a(e.animations),c=a(e.nodes);t.length>0&&(r.geometries=t),n.length>0&&(r.materials=n),i.length>0&&(r.textures=i),o.length>0&&(r.images=o),s.length>0&&(r.shapes=s),l.length>0&&(r.skeletons=l),u.length>0&&(r.animations=u),c.length>0&&(r.nodes=c)}return r.object=n,r;function a(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0),Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0,Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(e=new Vector3,t=new Vector3,r=new Vector3){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,n){n.subVectors(r,t),_v0$1.subVectors(e,t),n.cross(_v0$1);const i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}static getBarycoord(e,t,r,n,i){_v0$1.subVectors(n,t),_v1$3.subVectors(r,t),_v2$2.subVectors(e,t);const a=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),s=_v0$1.dot(_v2$2),l=_v1$3.dot(_v1$3),u=_v1$3.dot(_v2$2),c=a*l-o*o;if(0===c)return i.set(-2,-1,-1);const d=1/c,h=(l*s-o*u)*d,f=(a*u-o*s)*d;return i.set(1-h-f,f,h)}static containsPoint(e,t,r,n){return this.getBarycoord(e,t,r,n,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,r,n,i,a,o,s){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(e,t,r,n,i,a,o,s)}static getInterpolation(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,_v3$1),s.setScalar(0),s.addScaledVector(i,_v3$1.x),s.addScaledVector(a,_v3$1.y),s.addScaledVector(o,_v3$1.z),s}static isFrontFacing(e,t,r,n){return _v0$1.subVectors(r,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(n)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,r,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,n,i){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(e,this.a,this.b,this.c,t,r,n,i)}getInterpolation(e,t,r,n,i){return Triangle.getInterpolation(e,this.a,this.b,this.c,t,r,n,i)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,n=this.b,i=this.c;let a,o;_vab.subVectors(n,r),_vac.subVectors(i,r),_vap.subVectors(e,r);const s=_vab.dot(_vap),l=_vac.dot(_vap);if(s<=0&&l<=0)return t.copy(r);_vbp.subVectors(e,n);const u=_vab.dot(_vbp),c=_vac.dot(_vbp);if(u>=0&&c<=u)return t.copy(n);const d=s*c-u*l;if(d<=0&&s>=0&&u<=0)return a=s/(s-u),t.copy(r).addScaledVector(_vab,a);_vcp.subVectors(e,i);const h=_vab.dot(_vcp),f=_vac.dot(_vcp);if(f>=0&&h<=f)return t.copy(i);const p=h*l-s*f;if(p<=0&&l>=0&&f<=0)return o=l/(l-f),t.copy(r).addScaledVector(_vac,o);const m=u*f-h*c;if(m<=0&&c-u>=0&&h-f>=0)return _vbc.subVectors(i,n),o=(c-u)/(c-u+(h-f)),t.copy(n).addScaledVector(_vbc,o);const g=1/(m+p+d);return a=p*g,o=d*g,t.copy(r).addScaledVector(_vab,a).addScaledVector(_vac,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}class Color{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ColorManagement.toWorkingColorSpace(this,t),this}setRGB(e,t,r,n=ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=r,ColorManagement.toWorkingColorSpace(this,n),this}setHSL(e,t,r,n=ColorManagement.workingColorSpace){if(e=euclideanModulo(e,1),t=clamp(t,0,1),r=clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=hue2rgb(i,n,e+1/3),this.g=hue2rgb(i,n,e),this.b=hue2rgb(i,n,e-1/3)}return ColorManagement.toWorkingColorSpace(this,n),this}setStyle(e,t=SRGBColorSpace){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=n[2];switch(n[1]){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=SRGBColorSpace){const r=_colorKeywords[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),65536*Math.round(clamp(255*_color.r,0,255))+256*Math.round(clamp(255*_color.g,0,255))+Math.round(clamp(255*_color.b,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const r=_color.r,n=_color.g,i=_color.b,a=Math.max(r,n,i),o=Math.min(r,n,i);let s,l;const u=(o+a)/2;if(o===a)s=0,l=0;else{const e=a-o;switch(l=u<=.5?e/(a+o):e/(2-a-o),a){case r:s=(n-i)/e+(n<i?6:0);break;case n:s=(i-r)/e+2;break;case i:s=(r-n)/e+4}s/=6}return e.h=s,e.s=l,e.l=u,e}getRGB(e,t=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);const t=_color.r,r=_color.g,n=_color.b;return e!==SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*n)})`}offsetHSL(e,t,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+t,_hslA.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);const r=lerp(_hslA.h,_hslB.h,t),n=lerp(_hslA.s,_hslB.s,t),i=lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,n,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,n=this.b,i=e.elements;return this.r=i[0]*t+i[3]*r+i[6]*n,this.g=i[1]*t+i[4]*r+i[7]*n,this.b=i[2]*t+i[5]*r+i[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(r.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(r.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(r.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const t=n(e.textures),i=n(e.images);t.length>0&&(r.textures=t),i.length>0&&(r.images=i)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const e=t.length;r=new Array(e);for(let n=0;n!==e;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _vector$9=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=StaticDrawUsage,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn('THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyMatrix3(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyMatrix4(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyNormalMatrix(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.transformDirection(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=denormalize(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=normalize(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=denormalize(t,this.array)),t}setX(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=denormalize(t,this.array)),t}setY(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=denormalize(t,this.array)),t}setZ(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=denormalize(t,this.array)),t}setW(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,n){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),n=normalize(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),n=normalize(n,this.array),i=normalize(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),e}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Float32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Float32Array(e),t,r)}}let _id$2=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const t=(new Matrix3).getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1.makeRotationFromQuaternion(e),this.applyMatrix4(_m1),this}rotateX(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this}rotateY(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this}rotateZ(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this}translate(e,t,r){return _m1.makeTranslation(e,t,r),this.applyMatrix4(_m1),this}scale(e,t,r){return _m1.makeScale(e,t,r),this.applyMatrix4(_m1),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(e){const t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++)_box$2.setFromBufferAttribute(t[e]),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(e){const r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++)_boxMorphTargets.setFromBufferAttribute(t[e]),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max));_box$2.getCenter(r);let n=0;for(let t=0,i=e.count;t<i;t++)_vector$8.fromBufferAttribute(e,t),n=Math.max(n,r.distanceToSquared(_vector$8));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)_vector$8.fromBufferAttribute(a,t),o&&(_offset.fromBufferAttribute(e,t),_vector$8.add(_offset)),n=Math.max(n,r.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,n=t.position.array,i=t.normal.array,a=t.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const s=this.getAttribute("tangent").array,l=[],u=[];for(let e=0;e<o;e++)l[e]=new Vector3,u[e]=new Vector3;const c=new Vector3,d=new Vector3,h=new Vector3,f=new Vector2,p=new Vector2,m=new Vector2,g=new Vector3,_=new Vector3;function y(e,t,r){c.fromArray(n,3*e),d.fromArray(n,3*t),h.fromArray(n,3*r),f.fromArray(a,2*e),p.fromArray(a,2*t),m.fromArray(a,2*r),d.sub(c),h.sub(c),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-p.y).multiplyScalar(i),_.copy(h).multiplyScalar(p.x).addScaledVector(d,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[r].add(g),u[e].add(_),u[t].add(_),u[r].add(_))}let v=this.groups;0===v.length&&(v=[{start:0,count:r.length}]);for(let e=0,t=v.length;e<t;++e){const t=v[e],n=t.start;for(let e=n,i=n+t.count;e<i;e+=3)y(r[e+0],r[e+1],r[e+2])}const b=new Vector3,x=new Vector3,T=new Vector3,w=new Vector3;function E(e){T.fromArray(i,3*e),w.copy(T);const t=l[e];b.copy(t),b.sub(T.multiplyScalar(T.dot(t))).normalize(),x.crossVectors(w,t);const r=x.dot(u[e])<0?-1:1;s[4*e]=b.x,s[4*e+1]=b.y,s[4*e+2]=b.z,s[4*e+3]=r}for(let e=0,t=v.length;e<t;++e){const t=v[e],n=t.start;for(let e=n,i=n+t.count;e<i;e+=3)E(r[e+0]),E(r[e+1]),E(r[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new BufferAttribute(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);const n=new Vector3,i=new Vector3,a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,u=new Vector3,c=new Vector3;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),f=e.getX(d+1),p=e.getX(d+2);n.fromBufferAttribute(t,h),i.fromBufferAttribute(t,f),a.fromBufferAttribute(t,p),u.subVectors(a,i),c.subVectors(n,i),u.cross(c),o.fromBufferAttribute(r,h),s.fromBufferAttribute(r,f),l.fromBufferAttribute(r,p),o.add(u),s.add(u),l.add(u),r.setXYZ(h,o.x,o.y,o.z),r.setXYZ(f,s.x,s.y,s.z),r.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),u.subVectors(a,i),c.subVectors(n,i),u.cross(c),r.setXYZ(e+0,u.x,u.y,u.z),r.setXYZ(e+1,u.x,u.y,u.z),r.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)_vector$8.fromBufferAttribute(e,t),_vector$8.normalize(),e.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function e(e,t){const r=e.array,n=e.itemSize,i=e.normalized,a=new r.constructor(t.length*n);let o=0,s=0;for(let i=0,l=t.length;i<l;i++){o=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*n;for(let e=0;e<n;e++)a[s++]=r[o++]}return new BufferAttribute(a,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,r=this.index.array,n=this.attributes;for(const i in n){const a=e(n[i],r);t.setAttribute(i,a)}const i=this.morphAttributes;for(const n in i){const a=[],o=i[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],r);a.push(n)}t.morphAttributes[n]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,r=a.length;e<r;e++){const r=a[e];t.addGroup(r.start,r.count,r.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const t in r)e.data.attributes[t]=r[t].toJSON(e.data);const n={};let i=!1;for(const t in this.morphAttributes){const r=this.morphAttributes[t],a=[];for(let t=0,n=r.length;t<n;t++)a.push(r[t].toJSON(e.data));a.length>0&&(n[t]=a,i=!0)}i&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const n=e.attributes;for(const e in n)this.setAttribute(e,n[e].clone(t));const i=e.morphAttributes;for(const e in i){const r=[],n=i[e];for(let e=0,i=n.length;e<i;e++)r.push(n[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$6=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const r=this.geometry,n=r.morphAttributes.position,i=r.morphTargetsRelative;t.fromBufferAttribute(r.attributes.position,e);const a=this.morphTargetInfluences;if(n&&a){_morphA.set(0,0,0);for(let r=0,o=n.length;r<o;r++){const o=a[r];0!==o&&(_tempA.fromBufferAttribute(n[r],e),_morphA.addScaledVector(i?_tempA:_tempA.sub(t),o))}t.add(_morphA)}return t}raycast(e,t){const r=this.geometry,n=this.matrixWorld;if(void 0!==this.material){if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$6.copy(r.boundingSphere),_sphere$6.applyMatrix4(n),_ray$3.copy(e.ray).recast(e.near),!1===_sphere$6.containsPoint(_ray$3.origin)){if(null===_ray$3.intersectSphere(_sphere$6,_sphereHitAt))return;if(_ray$3.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2)return}_inverseMatrix$3.copy(n).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$3),null!==r.boundingBox&&!1===_ray$3.intersectsBox(r.boundingBox)||this._computeIntersections(e,t,_ray$3)}}_computeIntersections(e,t,r){let n;const i=this.geometry,a=this.material,o=i.index,s=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,c=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==o)if(Array.isArray(a))for(let i=0,s=d.length;i<s;i++){const s=d[i],f=a[s.materialIndex];for(let i=Math.max(s.start,h.start),a=Math.min(o.count,Math.min(s.start+s.count,h.start+h.count));i<a;i+=3)n=checkGeometryIntersection(this,f,e,r,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),n&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=s.materialIndex,t.push(n))}else for(let i=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);i<s;i+=3)n=checkGeometryIntersection(this,a,e,r,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),n&&(n.faceIndex=Math.floor(i/3),t.push(n));else if(void 0!==s)if(Array.isArray(a))for(let i=0,o=d.length;i<o;i++){const o=d[i],f=a[o.materialIndex];for(let i=Math.max(o.start,h.start),a=Math.min(s.count,Math.min(o.start+o.count,h.start+h.count));i<a;i+=3)n=checkGeometryIntersection(this,f,e,r,l,u,c,i,i+1,i+2),n&&(n.faceIndex=Math.floor(i/3),n.face.materialIndex=o.materialIndex,t.push(n))}else for(let i=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);i<o;i+=3)n=checkGeometryIntersection(this,a,e,r,l,u,c,i,i+1,i+2),n&&(n.faceIndex=Math.floor(i/3),t.push(n))}}function checkIntersection(e,t,r,n,i,a,o,s){let l;if(l=t.side===BackSide?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,t.side===FrontSide,s),null===l)return null;_intersectionPointWorld.copy(s),_intersectionPointWorld.applyMatrix4(e.matrixWorld);const u=r.ray.origin.distanceTo(_intersectionPointWorld);return u<r.near||u>r.far?null:{distance:u,point:_intersectionPointWorld.clone(),object:e}}function checkGeometryIntersection(e,t,r,n,i,a,o,s,l,u){e.getVertexPosition(s,_vA$1),e.getVertexPosition(l,_vB$1),e.getVertexPosition(u,_vC$1);const c=checkIntersection(e,t,r,n,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(c){i&&(_uvA$1.fromBufferAttribute(i,s),_uvB$1.fromBufferAttribute(i,l),_uvC$1.fromBufferAttribute(i,u),c.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),a&&(_uvA$1.fromBufferAttribute(a,s),_uvB$1.fromBufferAttribute(a,l),_uvC$1.fromBufferAttribute(a,u),c.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),c.uv2=c.uv1),o&&(_normalA.fromBufferAttribute(o,s),_normalB.fromBufferAttribute(o,l),_normalC.fromBufferAttribute(o,u),c.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const e={a:s,b:l,c:u,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,e.normal),c.face=e}return c}class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,n=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};const o=this;n=Math.floor(n),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],u=[],c=[];let d=0,h=0;function f(e,t,r,n,i,a,f,p,m,g,_){const y=a/m,v=f/g,b=a/2,x=f/2,T=p/2,w=m+1,E=g+1;let A=0,S=0;const P=new Vector3;for(let a=0;a<E;a++){const o=a*v-x;for(let s=0;s<w;s++)P[e]=(s*y-b)*n,P[t]=o*i,P[r]=T,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=p>0?1:-1,u.push(P.x,P.y,P.z),c.push(s/m),c.push(1-a/g),A+=1}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const r=d+t+w*(e+1),n=d+(t+1)+w*(e+1),i=d+(t+1)+w*e;s.push(d+t+w*e,r,i),s.push(r,n,i),S+=6}o.addGroup(h,S,_),h+=S,d+=A}f("z","y","x",-1,-1,r,t,e,a,i,0),f("z","y","x",1,-1,r,t,-e,a,i,1),f("x","z","y",1,1,e,r,t,n,a,2),f("x","z","y",1,-1,e,r,-t,n,a,3),f("x","y","z",1,-1,e,t,r,n,i,4),f("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(e){const t={};for(const r in e){t[r]={};for(const n in e[r]){const i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[r][n]=null):t[r][n]=i.clone():t[r][n]=Array.isArray(i)?i.slice():i}}return t}function mergeUniforms(e){const t={};for(let r=0;r<e.length;r++){const n=cloneUniforms(e[r]);for(const e in n)t[e]=n[e]}return t}function cloneUniformsGroups(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}function getUnlitUniformColorSpace(e){return null===e.getRenderTarget()?e.outputColorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;t.uniforms[r]=n&&n.isTexture?{type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?{type:"c",value:n.getHex()}:n&&n.isVector2?{type:"v2",value:n.toArray()}:n&&n.isVector3?{type:"v3",value:n.toArray()}:n&&n.isVector4?{type:"v4",value:n.toArray()}:n&&n.isMatrix3?{type:"m3",value:n.toArray()}:n&&n.isMatrix4?{type:"m4",value:n.toArray()}:{value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const e in this.extensions)!0===this.extensions[e]&&(r[e]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class PerspectiveCamera extends Camera{constructor(e=50,t=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*RAD2DEG*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*RAD2DEG*Math.atan(Math.tan(.5*DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*n/e,t-=a.offsetY*r/o,n*=a.width/e,r*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new PerspectiveCamera(fov,aspect,e,t);n.layers=this.layers,this.add(n);const i=new PerspectiveCamera(fov,aspect,e,t);i.layers=this.layers,this.add(i);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,this.add(a);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,this.add(o);const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,this.add(s);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,n,i,a,o,s]=t;for(const e of t)this.remove(e);if(e===WebGLCoordinateSystem)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==WebGPUCoordinateSystem)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,o,s,l,u]=this.children,c=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,n),e.render(t,i),e.setRenderTarget(r,1,n),e.render(t,a),e.setRenderTarget(r,2,n),e.render(t,o),e.setRenderTarget(r,3,n),e.render(t,s),e.setRenderTarget(r,4,n),e.render(t,l),r.texture.generateMipmaps=p,e.setRenderTarget(r,5,n),e.render(t,u),e.setRenderTarget(c,d,h),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e,t,r,n,i,a,o,s,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,r,n,i,a,o,s,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];void 0!==t.encoding&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new BoxGeometry(5,5,5),n=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:BackSide,blending:NoBlending});n.uniforms.tEquirect.value=t;const i=new Mesh(r,n),a=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,i),t.minFilter=a,i.geometry.dispose(),i.material.dispose(),this}clear(e,t,r,n){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,r,n);e.setRenderTarget(i)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const n=_vector1.subVectors(r,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(_vector1),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:t.copy(e.start).addScaledVector(r,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||_normalMatrix.getNormalMatrix(e),n=this.coplanarPoint(_vector1).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _sphere$5=new Sphere,_vector$7=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,r=new Plane,n=new Plane,i=new Plane,a=new Plane){this.planes=[e,t,r,n,i,a]}set(e,t,r,n,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=WebGLCoordinateSystem){const r=this.planes,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],h=n[8],f=n[9],p=n[10],m=n[11],g=n[12],_=n[13],y=n[14],v=n[15];if(r[0].setComponents(s-i,d-l,m-h,v-g).normalize(),r[1].setComponents(s+i,d+l,m+h,v+g).normalize(),r[2].setComponents(s+a,d+u,m+f,v+_).normalize(),r[3].setComponents(s-a,d-u,m-f,v-_).normalize(),r[4].setComponents(s-o,d-c,m-p,v-y).normalize(),t===WebGLCoordinateSystem)r[5].setComponents(s+o,d+c,m+p,v+y).normalize();else{if(t!==WebGPUCoordinateSystem)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,c,p,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$5.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$5.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_sphere$5)}intersectsSprite(e){return _sphere$5.center.set(0,0,0),_sphere$5.radius=.7071067811865476,_sphere$5.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$5)}intersectsSphere(e){const t=this.planes,r=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const n=t[r];if(_vector$7.x=n.normal.x>0?e.max.x:e.min.x,_vector$7.y=n.normal.y>0?e.max.y:e.min.y,_vector$7.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let e=null,t=!1,r=null,n=null;function i(t,a){r(t,a),n=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==r&&(n=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function WebGLAttributes(e,t){const r=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=n.get(t);r&&(e.deleteBuffer(r.buffer),n.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=n.get(t);if(void 0===a)n.set(t,function(t,n){const i=t.array,a=t.usage,o=i.byteLength,s=e.createBuffer();let l;if(e.bindBuffer(n,s),e.bufferData(n,i,a),t.onUploadCallback(),i instanceof Float32Array)l=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!r)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=e.HALF_FLOAT}else l=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=e.SHORT;else if(i instanceof Uint32Array)l=e.UNSIGNED_INT;else if(i instanceof Int32Array)l=e.INT;else if(i instanceof Int8Array)l=e.BYTE;else if(i instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);l=e.UNSIGNED_BYTE}return{buffer:s,type:l,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,i));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const a=n.array,o=n._updateRange,s=n.updateRanges;if(e.bindBuffer(i,t),-1===o.count&&0===s.length&&e.bufferSubData(i,0,a),0!==s.length){for(let t=0,n=s.length;t<n;t++){const n=s[t];r?e.bufferSubData(i,n.start*a.BYTES_PER_ELEMENT,a,n.start,n.count):e.bufferSubData(i,n.start*a.BYTES_PER_ELEMENT,a.subarray(n.start,n.start+n.count))}n.clearUpdateRanges()}-1!==o.count&&(r?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),n.onUploadCallback()}(a.buffer,t,i),a.version=t.version}}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};const i=e/2,a=t/2,o=Math.floor(r),s=Math.floor(n),l=o+1,u=s+1,c=e/o,d=t/s,h=[],f=[],p=[],m=[];for(let e=0;e<u;e++){const t=e*d-a;for(let r=0;r<l;r++)f.push(r*c-i,-t,0),p.push(0,0,1),m.push(r/o),m.push(1-e/s)}for(let e=0;e<s;e++)for(let t=0;t<o;t++){const r=t+l*(e+1),n=t+1+l*(e+1),i=t+1+l*e;h.push(t+l*e,r,i),h.push(r,n,i)}this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}var alphahash_fragment="#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment="#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex="#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex="#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common$3="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment="\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps="#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";const vertex$h="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragment$h="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$g="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$g="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$f="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$f="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$e="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",fragment$e="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",vertex$d="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",fragment$d="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",vertex$c="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragment$c="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$b="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$b="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$a="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",fragment$a="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$9="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$9="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$8="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",fragment$8="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$7="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",fragment$7="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",vertex$6="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$6="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$5="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",fragment$5="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$4="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$4="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$3="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",fragment$3="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$2="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$2="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",vertex$1="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$1="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",ShaderChunk={alphahash_fragment:alphahash_fragment,alphahash_pars_fragment:alphahash_pars_fragment,alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,alphatest_pars_fragment:alphatest_pars_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,batching_pars_vertex:batching_pars_vertex,batching_vertex:batching_vertex,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,iridescence_fragment:iridescence_fragment,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common$3,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,colorspace_fragment:colorspace_fragment,colorspace_pars_fragment:colorspace_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_fragment:lights_lambert_fragment,lights_lambert_pars_fragment:lights_lambert_pars_fragment,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphcolor_vertex:morphcolor_vertex,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normal_pars_fragment:normal_pars_fragment,normal_pars_vertex:normal_pars_vertex,normal_vertex:normal_vertex,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,iridescence_pars_fragment:iridescence_pars_fragment,opaque_fragment:opaque_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmission_fragment:transmission_fragment,transmission_pars_fragment:transmission_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,worldpos_vertex:worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(e,t,r,n,i,a,o){const s=new Color(0);let l,u,c=!0===a?0:1,d=null,h=0,f=null;function p(t,r){t.getRGB(_rgb,getUnlitUniformColorSpace(e)),n.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,r,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),c=t,p(s,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,p(s,c)},render:function(a,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?r:t).get(_)),null===_?p(s,c):_&&_.isColor&&(p(_,1),g=!0);const y=e.xr.getEnvironmentBlendMode();"additive"===y?n.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===y&&n.buffers.color.setClear(0,0,0,0,o),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===CubeUVReflectionMapping)?(void 0===u&&(u=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=ColorManagement.getTransfer(_.colorSpace)!==SRGBTransfer,d===_&&h===_.version&&f===e.toneMapping||(u.material.needsUpdate=!0,d=_,h=_.version,f=e.toneMapping),u.layers.enableAll(),a.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=ColorManagement.getTransfer(_.colorSpace)!==SRGBTransfer,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),d===_&&h===_.version&&f===e.toneMapping||(l.material.needsUpdate=!0,d=_,h=_.version,f=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function WebGLBindingStates(e,t,r,n){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==a,s={},l=f(null);let u=l,c=!1;function d(t){return n.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return n.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function f(e){const t=[],r=[],n=[];for(let e=0;e<i;e++)t[e]=0,r[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=u.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function m(e){g(e,0)}function g(r,i){const a=u.enabledAttributes,o=u.attributeDivisors;u.newAttributes[r]=1,0===a[r]&&(e.enableVertexAttribArray(r),a[r]=1),o[r]!==i&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),o[r]=i)}function _(){const t=u.newAttributes,r=u.enabledAttributes;for(let n=0,i=r.length;n<i;n++)r[n]!==t[n]&&(e.disableVertexAttribArray(n),r[n]=0)}function y(t,r,n,i,a,o,s){!0===s?e.vertexAttribIPointer(t,r,n,a,o):e.vertexAttribPointer(t,r,n,i,a,o)}function v(){b(),c=!0,u!==l&&(u=l,d(u.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,v,b){let x=!1;if(o){const t=function(t,r,i){const o=!0===i.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let u=l[r.id];void 0===u&&(u={},l[r.id]=u);let c=u[o];return void 0===c&&(c=f(n.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c),c}(v,h,l);u!==t&&(u=t,d(u.object)),x=function(e,t,r,n){const i=u.attributes,a=t.attributes;let o=0;const s=r.getAttributes();for(const t in s)if(s[t].location>=0){const r=i[t];let n=a[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===r)return!0;if(r.attribute!==n)return!0;if(n&&r.data!==n.data)return!0;o++}return u.attributesNum!==o||u.index!==n}(i,v,h,b),x&&function(e,t,r,n){const i={},a=t.attributes;let o=0;const s=r.getAttributes();for(const t in s)if(s[t].location>=0){let r=a[t];void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor));const n={};n.attribute=r,r&&r.data&&(n.data=r.data),i[t]=n,o++}u.attributes=i,u.attributesNum=o,u.index=n}(i,v,h,b)}else{const e=!0===l.wireframe;u.geometry===v.id&&u.program===h.id&&u.wireframe===e||(u.geometry=v.id,u.program=h.id,u.wireframe=e,x=!0)}null!==b&&r.update(b,e.ELEMENT_ARRAY_BUFFER),(x||c)&&(c=!1,function(i,a,o,s){if(!1===n.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(const t in u){const a=u[t];if(a.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const t=o.normalized,l=o.itemSize,u=r.get(o);if(void 0===u)continue;const c=u.buffer,d=u.type,h=u.bytesPerElement,f=!0===n.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||o.gpuType===IntType);if(o.isInterleavedBufferAttribute){const r=o.data,n=r.stride,u=o.offset;if(r.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,r.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,n*h,(u+l/a.locationSize*e)*h,f)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,d,t,l*h,l/a.locationSize*e*h,f)}}else if(void 0!==c){const r=c[t];if(void 0!==r)switch(r.length){case 2:e.vertexAttrib2fv(a.location,r);break;case 3:e.vertexAttrib3fv(a.location,r);break;case 4:e.vertexAttrib4fv(a.location,r);break;default:e.vertexAttrib1fv(a.location,r)}}}}_()}(i,l,h,v),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.get(b).buffer))},reset:v,resetDefaultState:b,dispose:function(){v();for(const e in s){const t=s[e];for(const e in t){const r=t[e];for(const e in r)h(r[e].object),delete r[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const r=t[e];for(const e in r)h(r[e].object),delete r[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const r=s[t];if(void 0===r[e.id])continue;const n=r[e.id];for(const e in n)h(n[e].object),delete n[e];delete r[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:_}}function WebGLBufferRenderer(e,t,r,n){const i=n.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,n){e.drawArrays(a,t,n),r.update(n,a,1)},this.renderInstances=function(n,o,s){if(0===s)return;let l,u;if(i)l=e,u="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](a,n,o,s),r.update(o,a,s)},this.renderMultiDraw=function(e,n,i){if(0===i)return;const o=t.get("WEBGL_multi_draw");if(null===o)for(let t=0;t<i;t++)this.render(e[t],n[t]);else{o.multiDrawArraysWEBGL(a,e,0,n,0,i);let t=0;for(let e=0;e<i;e++)t+=n[e];r.update(t,a,1)}}}function WebGLCapabilities(e,t,r){let n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==r.precision?r.precision:"highp";const s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||t.has("WEBGL_draw_buffers"),u=!0===r.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,v=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function WebGLClipping(e){const t=this;let r=null,n=0,i=!1,a=!1;const o=new Plane,s=new Matrix3,l={value:null,needsUpdate:!1};function u(e,r,n,i){const a=null!==e?e.length:0;let u=null;if(0!==a){if(u=l.value,!0!==i||null===u){const t=n+4*a,i=r.matrixWorldInverse;s.getNormalMatrix(i),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,r=n;t!==a;++t,r+=4)o.copy(e[t]).applyMatrix4(i,s),o.normal.toArray(u,r),u[r+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const r=0!==e.length||t||0!==n||i;return i=t,n=e.length,r},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){r=u(e,t,0)},this.setState=function(o,s,c){const d=o.clippingPlanes,h=o.clipIntersection,f=o.clipShadows,p=e.get(o);if(!i||null===d||0===d.length||a&&!f)a?u(null):(l.value!==r&&(l.value=r,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0);else{const e=a?0:n,t=4*e;let i=p.clippingState||null;l.value=i,i=u(d,s,t,c);for(let e=0;e!==t;++e)i[e]=r[e];p.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function WebGLCubeMaps(e){let t=new WeakMap;function r(e,t){return t===EquirectangularReflectionMapping?e.mapping=CubeReflectionMapping:t===EquirectangularRefractionMapping&&(e.mapping=CubeRefractionMapping),e}function n(e){const r=e.target;r.removeEventListener("dispose",n);const i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===EquirectangularReflectionMapping||a===EquirectangularRefractionMapping){if(t.has(i))return r(t.get(i).texture,i.mapping);{const a=i.image;if(a&&a.height>0){const o=new WebGLCubeRenderTarget(a.height/2);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",n),r(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class OrthographicCamera extends Camera{constructor(e=-1,t=1,r=1,n=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,n=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,r,n,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},n=_createRenderTarget(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(e,t,r);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(n)),this._blurMaterial=_getBlurShader(n,e,t)}return n}_compileMaterial(e){const t=new Mesh(this._lodPlanes[0],e);this._renderer.compile(t,_flatCamera)}_sceneToCubeUV(e,t,r,n){const i=new PerspectiveCamera(90,1,t,r),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.toneMapping;s.getClearColor(_clearColor),s.toneMapping=NoToneMapping,s.autoClear=!1;const c=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),d=new Mesh(new BoxGeometry,c);let h=!1;const f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,h=!0):(c.color.copy(_clearColor),h=!0);for(let t=0;t<6;t++){const r=t%3;0===r?(i.up.set(0,a[t],0),i.lookAt(o[t],0,0)):1===r?(i.up.set(0,0,a[t]),i.lookAt(0,o[t],0)):(i.up.set(0,a[t],0),i.lookAt(0,0,o[t]));const l=this._cubeSize;_setViewport(n,r*l,t>2?l:0,l,l),s.setRenderTarget(n),h&&s.render(d,i),s.render(e,i)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=u,s.autoClear=l,e.background=f}_textureToCubeUV(e,t){const r=this._renderer,n=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial());const i=n?this._cubemapMaterial:this._equirectMaterial,a=new Mesh(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;_setViewport(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(a,_flatCamera)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const r=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]);this._blur(e,t-1,t,r,_axisDirections[(t-1)%_axisDirections.length])}t.autoClear=r}_blur(e,t,r,n,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,n,"latitudinal",i),this._halfBlur(a,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Mesh(this._lodPlanes[n],l),c=l.uniforms,d=this._sizeLods[r]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/(2*MAX_SAMPLES-1),f=i/h,p=isFinite(i)?1+Math.floor(3*f):MAX_SAMPLES;p>MAX_SAMPLES&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${MAX_SAMPLES}`);const m=[];let g=0;for(let e=0;e<MAX_SAMPLES;++e){const t=e/f,r=Math.exp(-t*t/2);m.push(r),0===e?g+=r:e<p&&(g+=2*r)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);const{_lodMax:_}=this;c.dTheta.value=h,c.mipInt.value=_-r;const y=this._sizeLods[n];_setViewport(t,3*y*(n>_-LOD_MIN?n-_+LOD_MIN:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(u,_flatCamera)}}function _createPlanes(e){const t=[],r=[],n=[];let i=e;const a=e-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);r.push(a);let s=1/a;o>e-LOD_MIN?s=EXTRA_LOD_SIGMA[o-e+LOD_MIN-1]:0===o&&(s=0),n.push(s);const l=1/(a-2),u=-l,c=1+l,d=[u,u,c,u,c,c,u,u,c,c,u,c],h=6,f=6,p=3,m=2,g=1,_=new Float32Array(p*f*h),y=new Float32Array(m*f*h),v=new Float32Array(g*f*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,r=e>2?0:-1;_.set([t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0],p*f*e),y.set(d,m*f*e),v.set([e,e,e,e,e,e],g*f*e)}const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(_,p)),b.setAttribute("uv",new BufferAttribute(y,m)),b.setAttribute("faceIndex",new BufferAttribute(v,g)),t.push(b),i>LOD_MIN&&i--}return{lodPlanes:t,sizeLods:r,sigmas:n}}function _createRenderTarget(e,t,r){const n=new WebGLRenderTarget(e,t,r);return n.texture.mapping=CubeUVReflectionMapping,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function _setViewport(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function _getBlurShader(e,t,r){const n=new Float32Array(MAX_SAMPLES),i=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function WebGLCubeUVMaps(e){let t=new WeakMap,r=null;function n(e){const r=e.target;r.removeEventListener("dispose",n);const i=t.get(r);void 0!==i&&(t.delete(r),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=a===EquirectangularReflectionMapping||a===EquirectangularRefractionMapping,s=a===CubeReflectionMapping||a===CubeRefractionMapping;if(o||s){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let n=t.get(i);return null===r&&(r=new PMREMGenerator(e)),n=o?r.fromEquirectangular(i,n):r.fromCubemap(i,n),t.set(i,n),n.texture}if(t.has(i))return t.get(i).texture;{const a=i.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;for(let r=0;r<6;r++)void 0!==e[r]&&t++;return 6===t}(a)){null===r&&(r=new PMREMGenerator(e));const a=o?r.fromEquirectangular(i):r.fromCubemap(i);return t.set(i,a),i.addEventListener("dispose",n),a.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function WebGLExtensions(e){const t={};function r(r){if(void 0!==t[r])return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(e){return null!==r(e)},init:function(e){e.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(e){const t=r(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function WebGLGeometries(e,t,r,n){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);for(const e in s.morphAttributes){const r=s.morphAttributes[e];for(let e=0,n=r.length;e<n;e++)t.remove(r[e])}s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),n.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,r.memory.geometries--}function s(e){const r=[],n=e.index,i=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],i=e[t+1],a=e[t+2];r.push(n,i,i,a,a,n)}}else{if(void 0===i)return;o=i.version;for(let e=0,t=i.array.length/3-1;e<t;e+=3){const t=e+0,n=e+1,i=e+2;r.push(t,n,n,i,i,t)}}const s=new(arrayNeedsUint32(r)?Uint32BufferAttribute:Uint16BufferAttribute)(r,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,r.memory.geometries++),t},update:function(r){const n=r.attributes;for(const r in n)t.update(n[r],e.ARRAY_BUFFER);const i=r.morphAttributes;for(const r in i){const n=i[r];for(let r=0,i=n.length;r<i;r++)t.update(n[r],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const r=e.index;null!==r&&t.version<r.version&&s(e)}else s(e);return a.get(e)}}}function WebGLIndexedBufferRenderer(e,t,r,n){const i=n.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,n){e.drawElements(a,n,o,t*s),r.update(n,a,1)},this.renderInstances=function(n,l,u){if(0===u)return;let c,d;if(i)c=e,d="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[d](a,l,o,n*s,u),r.update(l,a,u)},this.renderMultiDraw=function(e,n,i){if(0===i)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<i;t++)this.render(e[t]/s,n[t]);else{l.multiDrawElementsWEBGL(a,n,0,o,e,0,i);let t=0;for(let e=0;e<i;e++)t+=n[e];r.update(t,a,1)}}}function WebGLInfo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,n,i){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=i*(r/3);break;case e.LINES:t.lines+=i*(r/2);break;case e.LINE_STRIP:t.lines+=i*(r-1);break;case e.LINE_LOOP:t.lines+=i*r;break;case e.POINTS:t.points+=i*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(e,t,r){const n={},i=new Float32Array(8),a=new WeakMap,o=new Vector4,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,u,c){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const h=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=void 0!==h?h.length:0;let p=a.get(u);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();const _=void 0!==u.morphAttributes.position,y=void 0!==u.morphAttributes.normal,v=void 0!==u.morphAttributes.color,b=u.morphAttributes.position||[],x=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let w=0;!0===_&&(w=1),!0===y&&(w=2),!0===v&&(w=3);let E=u.attributes.position.count*w,A=1;E>t.maxTextureSize&&(A=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const S=new Float32Array(E*A*4*f),P=new DataArrayTexture(S,E,A,f);P.type=FloatType,P.needsUpdate=!0;const M=4*w;for(let C=0;C<f;C++){const O=b[C],L=x[C],I=T[C],D=E*A*4*C;for(let k=0;k<O.count;k++){const B=k*M;!0===_&&(o.fromBufferAttribute(O,k),S[D+B+0]=o.x,S[D+B+1]=o.y,S[D+B+2]=o.z,S[D+B+3]=0),!0===y&&(o.fromBufferAttribute(L,k),S[D+B+4]=o.x,S[D+B+5]=o.y,S[D+B+6]=o.z,S[D+B+7]=0),!0===v&&(o.fromBufferAttribute(I,k),S[D+B+8]=o.x,S[D+B+9]=o.y,S[D+B+10]=o.z,S[D+B+11]=4===I.itemSize?o.w:1)}}function R(){P.dispose(),a.delete(u),u.removeEventListener("dispose",R)}p={count:f,texture:P,size:new Vector2(E,A)},a.set(u,p),u.addEventListener("dispose",R)}let m=0;for(let F=0;F<d.length;F++)m+=d[F];const g=u.morphTargetsRelative?1:1-m;c.getUniforms().setValue(e,"morphTargetBaseInfluence",g),c.getUniforms().setValue(e,"morphTargetInfluences",d),c.getUniforms().setValue(e,"morphTargetsTexture",p.texture,r),c.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{const N=void 0===d?0:d.length;let q=n[u.id];if(void 0===q||q.length!==N){q=[];for(let V=0;V<N;V++)q[V]=[V,0];n[u.id]=q}for(let $=0;$<N;$++){const H=q[$];H[0]=$,H[1]=d[$]}q.sort(absNumericalSort);for(let W=0;W<8;W++)W<N&&q[W][1]?(s[W][0]=q[W][0],s[W][1]=q[W][1]):(s[W][0]=Number.MAX_SAFE_INTEGER,s[W][1]=0);s.sort(numericalSort);const U=u.morphAttributes.position,j=u.morphAttributes.normal;let G=0;for(let X=0;X<8;X++){const Y=s[X],Z=Y[0],K=Y[1];Z!==Number.MAX_SAFE_INTEGER&&K?(U&&u.getAttribute("morphTarget"+X)!==U[Z]&&u.setAttribute("morphTarget"+X,U[Z]),j&&u.getAttribute("morphNormal"+X)!==j[Z]&&u.setAttribute("morphNormal"+X,j[Z]),i[X]=K,G+=K):(U&&!0===u.hasAttribute("morphTarget"+X)&&u.deleteAttribute("morphTarget"+X),j&&!0===u.hasAttribute("morphNormal"+X)&&u.deleteAttribute("morphNormal"+X),i[X]=0)}const z=u.morphTargetsRelative?1:1-G;c.getUniforms().setValue(e,"morphTargetBaseInfluence",z),c.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function WebGLObjects(e,t,r,n){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(o){const s=n.render.frame,l=t.get(o,o.geometry);if(i.get(l)!==s&&(t.update(l),i.set(l,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),i.get(o)!==s&&(r.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&r.update(o.instanceColor,e.ARRAY_BUFFER),i.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;i.get(e)!==s&&(e.update(),i.set(e,s))}return l},dispose:function(){i=new WeakMap}}}class DepthTexture extends Texture{constructor(e,t,r,n,i,a,o,s,l,u){if((u=void 0!==u?u:DepthFormat)!==DepthFormat&&u!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===DepthFormat&&(r=UnsignedIntType),void 0===r&&u===DepthStencilFormat&&(r=UnsignedInt248Type),super(null,n,i,a,o,s,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1);emptyShadowTexture.compareFunction=LessEqualCompare;const emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten$1(e,t,r){const n=e[0];if(n<=0||n>0)return e;const i=t*r;let a=arrayCacheF32[i];if(void 0===a&&(a=new Float32Array(i),arrayCacheF32[i]=a),0!==t){n.toArray(a,0);for(let n=1,i=0;n!==t;++n)i+=r,e[n].toArray(a,i)}return a}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function copyArray(e,t){for(let r=0,n=t.length;r<n;r++)e[r]=t[r]}function allocTexUnits(e,t){let r=arrayCacheI32[t];void 0===r&&(r=new Int32Array(t),arrayCacheI32[t]=r);for(let n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function setValueV1f(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2fv(this.addr,t),copyArray(r,t)}}function setValueV3f(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(arraysEqual(r,t))return;e.uniform3fv(this.addr,t),copyArray(r,t)}}function setValueV4f(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4fv(this.addr,t),copyArray(r,t)}}function setValueM2(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat2array.set(n),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,n)}}function setValueM3(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat3array.set(n),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,n)}}function setValueM4(e,t){const r=this.cache,n=t.elements;if(void 0===n){if(arraysEqual(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat4array.set(n),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,n)}}function setValueV1i(e,t){const r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2iv(this.addr,t),copyArray(r,t)}}function setValueV3i(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(arraysEqual(r,t))return;e.uniform3iv(this.addr,t),copyArray(r,t)}}function setValueV4i(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4iv(this.addr,t),copyArray(r,t)}}function setValueV1ui(e,t){const r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function setValueV2ui(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2uiv(this.addr,t),copyArray(r,t)}}function setValueV3ui(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(arraysEqual(r,t))return;e.uniform3uiv(this.addr,t),copyArray(r,t)}}function setValueV4ui(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4uiv(this.addr,t),copyArray(r,t)}}function setValueT1(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2D(t||(this.type===e.SAMPLER_2D_SHADOW?emptyShadowTexture:emptyTexture),i)}function setValueT3D1(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||empty3dTexture,i)}function setValueT6(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTextureCube(t||emptyCubeTexture,i)}function setValueT2DArray1(e,t,r){const n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||emptyArrayTexture,i)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV2fArray(e,t){const r=flatten$1(t,this.size,2);e.uniform2fv(this.addr,r)}function setValueV3fArray(e,t){const r=flatten$1(t,this.size,3);e.uniform3fv(this.addr,r)}function setValueV4fArray(e,t){const r=flatten$1(t,this.size,4);e.uniform4fv(this.addr,r)}function setValueM2Array(e,t){const r=flatten$1(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function setValueM3Array(e,t){const r=flatten$1(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function setValueM4Array(e,t){const r=flatten$1(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV1uiArray(e,t){e.uniform1uiv(this.addr,t)}function setValueV2uiArray(e,t){e.uniform2uiv(this.addr,t)}function setValueV3uiArray(e,t){e.uniform3uiv(this.addr,t)}function setValueV4uiArray(e,t){e.uniform4uiv(this.addr,t)}function setValueT1Array(e,t,r){const n=this.cache,i=t.length,a=allocTexUnits(r,i);arraysEqual(n,a)||(e.uniform1iv(this.addr,a),copyArray(n,a));for(let e=0;e!==i;++e)r.setTexture2D(t[e]||emptyTexture,a[e])}function setValueT3DArray(e,t,r){const n=this.cache,i=t.length,a=allocTexUnits(r,i);arraysEqual(n,a)||(e.uniform1iv(this.addr,a),copyArray(n,a));for(let e=0;e!==i;++e)r.setTexture3D(t[e]||empty3dTexture,a[e])}function setValueT6Array(e,t,r){const n=this.cache,i=t.length,a=allocTexUnits(r,i);arraysEqual(n,a)||(e.uniform1iv(this.addr,a),copyArray(n,a));for(let e=0;e!==i;++e)r.setTextureCube(t[e]||emptyCubeTexture,a[e])}function setValueT2DArrayArray(e,t,r){const n=this.cache,i=t.length,a=allocTexUnits(r,i);arraysEqual(n,a)||(e.uniform1iv(this.addr,a),copyArray(n,a));for(let e=0;e!==i;++e)r.setTexture2DArray(t[e]||emptyArrayTexture,a[e])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=getSingularSetter(t.type)}}class PureArrayUniform{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=getPureArraySetter(t.type)}}class StructuredUniform{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const n=this.seq;for(let i=0,a=n.length;i!==a;++i){const a=n[i];a.setValue(e,t[a.id],r)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,r){const n=e.name,i=n.length;for(RePathPart.lastIndex=0;;){const a=RePathPart.exec(n);let o=a[1];const s=a[3];if("]"===a[2]&&(o|=0),void 0===s||"["===s&&RePathPart.lastIndex+2===i){addUniform(r,void 0===s?new SingleUniform(o,e,t):new PureArrayUniform(o,e,t));break}{let e=r.map[o];void 0===e&&(e=new StructuredUniform(o),addUniform(r,e)),r=e}}}class WebGLUniforms{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const r=e.getActiveUniform(t,n);parseUniform(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,r,n){const i=this.map[t];void 0!==i&&i.setValue(e,r,n)}setOptional(e,t,r){const n=t[r];void 0!==n&&this.setValue(e,r,n)}static upload(e,t,r,n){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=r[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,n)}}static seqWithValue(e,t){const r=[];for(let n=0,i=e.length;n!==i;++n){const i=e[n];i.id in t&&r.push(i)}return r}}function WebGLShader(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(e,t){const r=e.split("\n"),n=[],i=Math.max(t-6,0),a=Math.min(t+6,r.length);for(let e=i;e<a;e++){const i=e+1;n.push(`${i===t?">":" "} ${i}: ${r[e]}`)}return n.join("\n")}function getEncodingComponents(e){const t=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),r=ColorManagement.getPrimaries(e);let n;switch(t===r?n="":t===P3Primaries&&r===Rec709Primaries?n="LinearDisplayP3ToLinearSRGB":t===Rec709Primaries&&r===P3Primaries&&(n="LinearSRGBToLinearDisplayP3"),e){case LinearSRGBColorSpace:case LinearDisplayP3ColorSpace:return[n,"LinearTransferOETF"];case SRGBColorSpace:case DisplayP3ColorSpace:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[n,"LinearTransferOETF"]}}function getShaderErrors(e,t,r){const n=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const n=parseInt(a[1]);return r.toUpperCase()+"\n\n"+i+"\n\n"+handleSource(e.getShaderSource(t),n)}return i}function getTexelEncodingFunction(e,t){const r=getEncodingComponents(t);return`vec4 ${e}( vec4 value ) { return ${r[0]}( ${r[1]}( value ) ); }`}function getToneMappingFunction(e,t){let r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;case CustomToneMapping:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(e){const t=[];for(const r in e){const n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}function fetchAttributeLocations(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i),a=n.name;let o=1;n.type===e.FLOAT_MAT2&&(o=2),n.type===e.FLOAT_MAT3&&(o=3),n.type===e.FLOAT_MAT4&&(o=4),r[a]={type:n.type,location:e.getAttribLocation(t,a),locationSize:o}}return r}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){const r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(e,t){let r=ShaderChunk[t];if(void 0===r){const e=shaderChunkMap.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");r=ShaderChunk[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return resolveIncludes(r)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(e,t,r,n){let i="";for(let e=parseInt(t);e<parseInt(r);e++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function generatePrecision(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}function generateEnvMapModeDefine(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===CubeRefractionMapping&&(t="ENVMAP_MODE_REFRACTION"),t}function generateEnvMapBlendingDefine(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function generateCubeUVSize(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const r=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:n,maxMip:r}}function WebGLProgram(e,t,r,n){const i=e.getContext(),a=r.defines;let o=r.vertexShader,s=r.fragmentShader;const l=generateShadowMapTypeDefine(r),u=generateEnvMapTypeDefine(r),c=generateEnvMapModeDefine(r),d=generateEnvMapBlendingDefine(r),h=generateCubeUVSize(r),f=r.isWebGL2?"":generateExtensions(r),p=generateDefines(a),m=i.createProgram();let g,_,y=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(g=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,p].filter(filterEmptyLine).join("\n"),g.length>0&&(g+="\n"),_=[f,"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,p].filter(filterEmptyLine).join("\n"),_.length>0&&(_+="\n")):(g=[generatePrecision(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,p,r.batching?"#define USE_BATCHING":"",r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+c:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.displacementMap?"#define USE_DISPLACEMENTMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.mapUv?"#define MAP_UV "+r.mapUv:"",r.alphaMapUv?"#define ALPHAMAP_UV "+r.alphaMapUv:"",r.lightMapUv?"#define LIGHTMAP_UV "+r.lightMapUv:"",r.aoMapUv?"#define AOMAP_UV "+r.aoMapUv:"",r.emissiveMapUv?"#define EMISSIVEMAP_UV "+r.emissiveMapUv:"",r.bumpMapUv?"#define BUMPMAP_UV "+r.bumpMapUv:"",r.normalMapUv?"#define NORMALMAP_UV "+r.normalMapUv:"",r.displacementMapUv?"#define DISPLACEMENTMAP_UV "+r.displacementMapUv:"",r.metalnessMapUv?"#define METALNESSMAP_UV "+r.metalnessMapUv:"",r.roughnessMapUv?"#define ROUGHNESSMAP_UV "+r.roughnessMapUv:"",r.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+r.anisotropyMapUv:"",r.clearcoatMapUv?"#define CLEARCOATMAP_UV "+r.clearcoatMapUv:"",r.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+r.clearcoatNormalMapUv:"",r.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+r.clearcoatRoughnessMapUv:"",r.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+r.iridescenceMapUv:"",r.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+r.iridescenceThicknessMapUv:"",r.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+r.sheenColorMapUv:"",r.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+r.sheenRoughnessMapUv:"",r.specularMapUv?"#define SPECULARMAP_UV "+r.specularMapUv:"",r.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+r.specularColorMapUv:"",r.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+r.specularIntensityMapUv:"",r.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+r.transmissionMapUv:"",r.thicknessMapUv?"#define THICKNESSMAP_UV "+r.thicknessMapUv:"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors&&r.isWebGL2?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),_=[f,generatePrecision(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,p,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.envMap?"#define "+c:"",r.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",r.outputColorSpace),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),o=resolveIncludes(o),o=replaceLightNums(o,r),o=replaceClippingPlaneNums(o,r),s=resolveIncludes(s),s=replaceLightNums(s,r),s=replaceClippingPlaneNums(s,r),o=unrollLoops(o),s=unrollLoops(s),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["precision mediump sampler2DArray;","#define varying in",r.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const v=y+_+s,b=WebGLShader(i,i.VERTEX_SHADER,y+g+o),x=WebGLShader(i,i.FRAGMENT_SHADER,v);function T(t){if(e.debug.checkShaderErrors){const r=i.getProgramInfoLog(m).trim(),n=i.getShaderInfoLog(b).trim(),a=i.getShaderInfoLog(x).trim();let o=!0,s=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,b,x);else{const e=getShaderErrors(i,b,"vertex"),t=getShaderErrors(i,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+r+"\n"+e+"\n"+t)}else""!==r?console.warn("THREE.WebGLProgram: Program Info Log:",r):""!==n&&""!==a||(s=!1);s&&(t.diagnostics={runnable:o,programLog:r,vertexShader:{log:n,prefix:g},fragmentShader:{log:a,prefix:_}})}i.deleteShader(b),i.deleteShader(x),w=new WebGLUniforms(i,m),E=fetchAttributeLocations(i,m)}let w,E;i.attachShader(m,b),i.attachShader(m,x),void 0!==r.index0AttributeName?i.bindAttribLocation(m,0,r.index0AttributeName):!0===r.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===w&&T(this),w},this.getAttributes=function(){return void 0===E&&T(this),E};let A=!1===r.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===A&&(A=i.getProgramParameter(m,COMPLETION_STATUS_KHR)),A},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=x,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.fragmentShader,r=this._getShaderStage(e.vertexShader),n=this._getShaderStage(t),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(n)&&(i.add(n),n.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new WebGLShaderStage(e),t.set(e,r)),r}}class WebGLShaderStage{constructor(e){this.id=_id$1++,this.code=e,this.usedTimes=0}}function WebGLPrograms(e,t,r,n,i,a,o){const s=new Layers,l=new WebGLShaderCache,u=[],c=i.isWebGL2,d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,s,u,g,_){const y=g.fog,v=_.geometry,b=(a.isMeshStandardMaterial?r:t).get(a.envMap||(a.isMeshStandardMaterial?g.environment:null)),x=b&&b.mapping===CubeUVReflectionMapping?b.image.height:null,T=p[a.type];null!==a.precision&&(f=i.getMaxPrecision(a.precision),f!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));const w=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,E=void 0!==w?w.length:0;let A,S,P,M,R=0;if(void 0!==v.morphAttributes.position&&(R=1),void 0!==v.morphAttributes.normal&&(R=2),void 0!==v.morphAttributes.color&&(R=3),T){const e=ShaderLib[T];A=e.vertexShader,S=e.fragmentShader}else A=a.vertexShader,S=a.fragmentShader,l.update(a),P=l.getVertexShaderID(a),M=l.getFragmentShaderID(a);const C=e.getRenderTarget(),O=!0===_.isInstancedMesh,L=!!a.map,I=!!b,D=!!a.aoMap,k=!!a.lightMap,B=!!a.bumpMap,F=!!a.normalMap,N=!!a.displacementMap,q=!!a.emissiveMap,U=!!a.metalnessMap,j=!!a.roughnessMap,G=a.anisotropy>0,z=a.clearcoat>0,V=a.iridescence>0,$=a.sheen>0,H=a.transmission>0,W=G&&!!a.anisotropyMap,X=z&&!!a.clearcoatMap,Y=z&&!!a.clearcoatNormalMap,Z=z&&!!a.clearcoatRoughnessMap,K=V&&!!a.iridescenceMap,J=V&&!!a.iridescenceThicknessMap,Q=$&&!!a.sheenColorMap,ee=$&&!!a.sheenRoughnessMap,te=!!a.specularMap,re=!!a.specularColorMap,ne=!!a.specularIntensityMap,ie=H&&!!a.transmissionMap,ae=H&&!!a.thicknessMap,oe=!!a.alphaMap,se=!!a.extensions,le=!!v.attributes.uv1,ue=!!v.attributes.uv2,ce=!!v.attributes.uv3;let de=NoToneMapping;return a.toneMapped&&(null!==C&&!0!==C.isXRRenderTarget||(de=e.toneMapping)),{isWebGL2:c,shaderID:T,shaderType:a.type,shaderName:a.name,vertexShader:A,fragmentShader:S,defines:a.defines,customVertexShaderID:P,customFragmentShaderID:M,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:!0===_.isBatchedMesh,instancing:O,instancingColor:O&&null!==_.instanceColor,supportsVertexTextures:h,outputColorSpace:null===C?e.outputColorSpace:!0===C.isXRRenderTarget?C.texture.colorSpace:LinearSRGBColorSpace,map:L,matcap:!!a.matcap,envMap:I,envMapMode:I&&b.mapping,envMapCubeUVHeight:x,aoMap:D,lightMap:k,bumpMap:B,normalMap:F,displacementMap:h&&N,emissiveMap:q,normalMapObjectSpace:F&&a.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:F&&a.normalMapType===TangentSpaceNormalMap,metalnessMap:U,roughnessMap:j,anisotropy:G,anisotropyMap:W,clearcoat:z,clearcoatMap:X,clearcoatNormalMap:Y,clearcoatRoughnessMap:Z,iridescence:V,iridescenceMap:K,iridescenceThicknessMap:J,sheen:$,sheenColorMap:Q,sheenRoughnessMap:ee,specularMap:te,specularColorMap:re,specularIntensityMap:ne,transmission:H,transmissionMap:ie,thicknessMap:ae,gradientMap:!!a.gradientMap,opaque:!1===a.transparent&&a.blending===NormalBlending,alphaMap:oe,alphaTest:a.alphaTest>0,alphaHash:!!a.alphaHash,combine:a.combine,mapUv:L&&m(a.map.channel),aoMapUv:D&&m(a.aoMap.channel),lightMapUv:k&&m(a.lightMap.channel),bumpMapUv:B&&m(a.bumpMap.channel),normalMapUv:F&&m(a.normalMap.channel),displacementMapUv:N&&m(a.displacementMap.channel),emissiveMapUv:q&&m(a.emissiveMap.channel),metalnessMapUv:U&&m(a.metalnessMap.channel),roughnessMapUv:j&&m(a.roughnessMap.channel),anisotropyMapUv:W&&m(a.anisotropyMap.channel),clearcoatMapUv:X&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:Y&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Z&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:K&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:J&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:Q&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ee&&m(a.sheenRoughnessMap.channel),specularMapUv:te&&m(a.specularMap.channel),specularColorMapUv:re&&m(a.specularColorMap.channel),specularIntensityMapUv:ne&&m(a.specularIntensityMap.channel),transmissionMapUv:ie&&m(a.transmissionMap.channel),thicknessMapUv:ae&&m(a.thicknessMap.channel),alphaMapUv:oe&&m(a.alphaMap.channel),vertexTangents:!!v.attributes.tangent&&(F||G),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,vertexUv1s:le,vertexUv2s:ue,vertexUv3s:ce,pointsUvs:!0===_.isPoints&&!!v.attributes.uv&&(L||oe),fog:!!y,useFog:!0===a.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:E,morphTextureStride:R,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:de,useLegacyLights:e._useLegacyLights,decodeVideoTexture:L&&!0===a.map.isVideoTexture&&ColorManagement.getTransfer(a.map.colorSpace)===SRGBTransfer,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===DoubleSide,flipSided:a.side===BackSide,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:se&&!0===a.extensions.derivatives,extensionFragDepth:se&&!0===a.extensions.fragDepth,extensionDrawBuffers:se&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:se&&!0===a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(r,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0),t.supportsVertexTextures&&s.enable(1),t.instancing&&s.enable(2),t.instancingColor&&s.enable(3),t.matcap&&s.enable(4),t.envMap&&s.enable(5),t.normalMapObjectSpace&&s.enable(6),t.normalMapTangentSpace&&s.enable(7),t.clearcoat&&s.enable(8),t.iridescence&&s.enable(9),t.alphaTest&&s.enable(10),t.vertexColors&&s.enable(11),t.vertexAlphas&&s.enable(12),t.vertexUv1s&&s.enable(13),t.vertexUv2s&&s.enable(14),t.vertexUv3s&&s.enable(15),t.vertexTangents&&s.enable(16),t.anisotropy&&s.enable(17),t.alphaHash&&s.enable(18),t.batching&&s.enable(19),e.push(s.mask),s.disableAll(),t.fog&&s.enable(0),t.useFog&&s.enable(1),t.flatShading&&s.enable(2),t.logarithmicDepthBuffer&&s.enable(3),t.skinning&&s.enable(4),t.morphTargets&&s.enable(5),t.morphNormals&&s.enable(6),t.morphColors&&s.enable(7),t.premultipliedAlpha&&s.enable(8),t.shadowMapEnabled&&s.enable(9),t.useLegacyLights&&s.enable(10),t.doubleSided&&s.enable(11),t.flipSided&&s.enable(12),t.useDepthPacking&&s.enable(13),t.dithering&&s.enable(14),t.transmission&&s.enable(15),t.sheen&&s.enable(16),t.opaque&&s.enable(17),t.pointsUvs&&s.enable(18),t.decodeVideoTexture&&s.enable(19),e.push(s.mask)}(r,t),r.push(e.outputColorSpace)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){const t=p[e.type];let r;return r=t?UniformsUtils.clone(ShaderLib[t].uniforms):e.uniforms,r},acquireProgram:function(t,r){let n;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===r){n=t,++n.usedTimes;break}}return void 0===n&&(n=new WebGLProgram(e,r,t,a),u.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function WebGLProperties(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(){const e=[];let t=0;const r=[],n=[],i=[];function a(r,n,i,a,o,s){let l=e[t];return void 0===l?(l={id:r.id,object:r,geometry:n,material:i,groupOrder:a,renderOrder:r.renderOrder,z:o,group:s},e[t]=l):(l.id=r.id,l.object=r,l.geometry=n,l.material=i,l.groupOrder=a,l.renderOrder=r.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:r,transmissive:n,transparent:i,init:function(){t=0,r.length=0,n.length=0,i.length=0},push:function(e,t,o,s,l,u){const c=a(e,t,o,s,l,u);o.transmission>0?n.push(c):!0===o.transparent?i.push(c):r.push(c)},unshift:function(e,t,o,s,l,u){const c=a(e,t,o,s,l,u);o.transmission>0?n.unshift(c):!0===o.transparent?i.unshift(c):r.unshift(c)},finish:function(){for(let r=t,n=e.length;r<n;r++){const t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||painterSortStable),n.length>1&&n.sort(t||reversePainterSortStable),i.length>1&&i.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(){let e=new WeakMap;return{get:function(t,r){const n=e.get(t);let i;return void 0===n?(i=new WebGLRenderList,e.set(t,[i])):r>=n.length?(i=new WebGLRenderList,n.push(i)):i=n[r],i},dispose:function(){e=new WeakMap}}}function UniformsCache(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":r={direction:new Vector3,color:new Color};break;case"SpotLight":r={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":r={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=r,r}}}function ShadowUniformsCache(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function WebGLLights(e,t){const r=new UniformsCache,n=ShadowUniformsCache(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new Vector3);const a=new Vector3,o=new Matrix4,s=new Matrix4;return{setup:function(a,o){let s=0,l=0,u=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,d=0,h=0,f=0,p=0,m=0,g=0,_=0,y=0,v=0,b=0;a.sort(shadowCastingAndTexturingLightsFirst);const x=!0===o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,T=t.intensity,w=t.distance,E=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*T*x,l+=o.g*T*x,u+=o.b*T*x;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],T);b++}else if(t.isDirectionalLight){const e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){const e=t.shadow,r=n.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,i.directionalShadow[c]=r,i.directionalShadowMap[c]=E,i.directionalShadowMatrix[c]=t.shadow.matrix,m++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=r.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(T*x),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[h]=e;const a=t.shadow;if(t.map&&(i.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&v++),i.spotLightMatrix[h]=a.matrix,t.castShadow){const e=n.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,i.spotShadow[h]=e,i.spotShadowMap[h]=E,_++}h++}else if(t.isRectAreaLight){const e=r.get(t);e.color.copy(o).multiplyScalar(T),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[f]=e,f++}else if(t.isPointLight){const e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,r=n.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,r.shadowCameraNear=e.camera.near,r.shadowCameraFar=e.camera.far,i.pointShadow[d]=r,i.pointShadowMap[d]=E,i.pointShadowMatrix[d]=t.shadow.matrix,g++}i.point[d]=e,d++}else if(t.isHemisphereLight){const e=r.get(t);e.skyColor.copy(t.color).multiplyScalar(T*x),e.groundColor.copy(t.groundColor).multiplyScalar(T*x),i.hemi[p]=e,p++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,i.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=UniformsLib.LTC_HALF_1,i.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=l,i.ambient[2]=u;const T=i.hash;T.directionalLength===c&&T.pointLength===d&&T.spotLength===h&&T.rectAreaLength===f&&T.hemiLength===p&&T.numDirectionalShadows===m&&T.numPointShadows===g&&T.numSpotShadows===_&&T.numSpotMaps===y&&T.numLightProbes===b||(i.directional.length=c,i.spot.length=h,i.rectArea.length=f,i.point.length=d,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=_+y-v,i.spotLightMap.length=y,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=b,T.directionalLength=c,T.pointLength=d,T.spotLength=h,T.rectAreaLength=f,T.hemiLength=p,T.numDirectionalShadows=m,T.numPointShadows=g,T.numSpotShadows=_,T.numSpotMaps=y,T.numLightProbes=b,i.version=nextVersion++)},setupView:function(e,t){let r=0,n=0,l=0,u=0,c=0;const d=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=i.directional[r];e.direction.setFromMatrixPosition(h.matrixWorld),a.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),r++}else if(h.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(h.matrixWorld),a.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),l++}else if(h.isRectAreaLight){const e=i.rectArea[u];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),s.identity(),o.copy(h.matrixWorld),o.premultiply(d),s.extractRotation(o),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),u++}else if(h.isPointLight){const e=i.point[n];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),n++}else if(h.isHemisphereLight){const e=i.hemi[c];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(d),c++}}},state:i}}function WebGLRenderState(e,t){const r=new WebGLLights(e,t),n=[],i=[];return{init:function(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:r},setupLights:function(e){r.setup(n,e)},setupLightsView:function(e){r.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function WebGLRenderStates(e,t){let r=new WeakMap;return{get:function(n,i=0){const a=r.get(n);let o;return void 0===a?(o=new WebGLRenderState(e,t),r.set(n,[o])):i>=a.length?(o=new WebGLRenderState(e,t),a.push(o)):o=a[i],o},dispose:function(){r=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vertex="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragment="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function WebGLShadowMap(e,t,r){let n=new Frustum;const i=new Vector2,a=new Vector2,o=new Vector4,s=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),l=new MeshDistanceMaterial,u={},c=r.maxTextureSize,d={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},h=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new BufferGeometry;p.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Mesh(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let _=this.type;function y(r,n){const a=t.update(m);h.defines.VSM_SAMPLES!==r.blurSamples&&(h.defines.VSM_SAMPLES=r.blurSamples,f.defines.VSM_SAMPLES=r.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===r.mapPass&&(r.mapPass=new WebGLRenderTarget(i.x,i.y)),h.uniforms.shadow_pass.value=r.map.texture,h.uniforms.resolution.value=r.mapSize,h.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(n,null,a,h,m,null),f.uniforms.shadow_pass.value=r.mapPass.texture,f.uniforms.resolution.value=r.mapSize,f.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(n,null,a,f,m,null)}function v(t,r,n,i){let a=null;const o=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===n.isPointLight?l:s,e.localClippingEnabled&&!0===r.clipShadows&&Array.isArray(r.clippingPlanes)&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0||r.map&&r.alphaTest>0){const e=a.uuid,t=r.uuid;let n=u[e];void 0===n&&(n={},u[e]=n);let i=n[t];void 0===i&&(i=a.clone(),n[t]=i),a=i}return a.visible=r.visible,a.wireframe=r.wireframe,a.side=i===VSMShadowMap?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:d[r.side],a.alphaMap=r.alphaMap,a.alphaTest=r.alphaTest,a.map=r.map,a.clipShadows=r.clipShadows,a.clippingPlanes=r.clippingPlanes,a.clipIntersection=r.clipIntersection,a.displacementMap=r.displacementMap,a.displacementScale=r.displacementScale,a.displacementBias=r.displacementBias,a.wireframeLinewidth=r.wireframeLinewidth,a.linewidth=r.linewidth,!0===n.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=n),a}function b(r,i,a,o,s){if(!1===r.visible)return;if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&s===VSMShadowMap)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);const n=t.update(r),l=r.material;if(Array.isArray(l)){const t=n.groups;for(let u=0,c=t.length;u<c;u++){const c=t[u],d=l[c.materialIndex];if(d&&d.visible){const t=v(r,d,o,s);r.onBeforeShadow(e,r,i,a,n,t,c),e.renderBufferDirect(a,null,n,t,r,c),r.onAfterShadow(e,r,i,a,n,t,c)}}}else if(l.visible){const t=v(r,l,o,s);r.onBeforeShadow(e,r,i,a,n,t,null),e.renderBufferDirect(a,null,n,t,r,null),r.onAfterShadow(e,r,i,a,n,t,null)}}const l=r.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,a,o,s)}this.render=function(t,r,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(NoBlending),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const f=_!==VSMShadowMap&&this.type===VSMShadowMap,p=_===VSMShadowMap&&this.type!==VSMShadowMap;for(let l=0,u=t.length;l<u;l++){const u=t[l],d=u.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;i.copy(d.mapSize);const m=d.getFrameExtents();if(i.multiply(m),a.copy(d.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/m.x),i.x=a.x*m.x,d.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/m.y),i.y=a.y*m.y,d.mapSize.y=a.y)),null===d.map||!0===f||!0===p){const e=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};null!==d.map&&d.map.dispose(),d.map=new WebGLRenderTarget(i.x,i.y,e),d.map.texture.name=u.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),h.viewport(o),d.updateMatrices(u,e),n=d.getFrustum(),b(r,s,d.camera,u,this.type)}!0!==d.isPointLightShadow&&this.type===VSMShadowMap&&y(d,s),d.needsUpdate=!1}_=this.type,g.needsUpdate=!1,e.setRenderTarget(l,u,d)}}function WebGLState(e,t,r){const n=r.isWebGL2,i=new function(){let t=!1;const r=new Vector4;let n=null;const i=new Vector4(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,r=null,n=null,i=null;return{setTest:function(t){t?G(e.DEPTH_TEST):z(e.DEPTH_TEST)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){switch(t){case NeverDepth:e.depthFunc(e.NEVER);break;case AlwaysDepth:e.depthFunc(e.ALWAYS);break;case LessDepth:e.depthFunc(e.LESS);break;case LessEqualDepth:e.depthFunc(e.LEQUAL);break;case EqualDepth:e.depthFunc(e.EQUAL);break;case GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case GreaterDepth:e.depthFunc(e.GREATER);break;case NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},o=new function(){let t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(r){t||(r?G(e.STENCIL_TEST):z(e.STENCIL_TEST))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,u=null}}},s=new WeakMap,l=new WeakMap;let u={},c={},d=new WeakMap,h=[],f=null,p=!1,m=null,g=null,_=null,y=null,v=null,b=null,x=null,T=new Color(0,0,0),w=0,E=!1,A=null,S=null,P=null,M=null,R=null;const C=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let O=!1,L=0;const I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(I)[1]),O=L>=1):-1!==I.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),O=L>=2);let D=null,k={};const B=e.getParameter(e.SCISSOR_BOX),F=e.getParameter(e.VIEWPORT),N=(new Vector4).fromArray(B),q=(new Vector4).fromArray(F);function U(t,r,i,a){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<i;s++)!n||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(r+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(r,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const j={};function G(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function z(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}j[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),j[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(j[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),j[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),G(e.DEPTH_TEST),a.setFunc(LessEqualDepth),W(!1),X(CullFaceBack),G(e.CULL_FACE),H(NoBlending);const V={[AddEquation]:e.FUNC_ADD,[SubtractEquation]:e.FUNC_SUBTRACT,[ReverseSubtractEquation]:e.FUNC_REVERSE_SUBTRACT};if(n)V[MinEquation]=e.MIN,V[MaxEquation]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(V[MinEquation]=e.MIN_EXT,V[MaxEquation]=e.MAX_EXT)}const $={[ZeroFactor]:e.ZERO,[OneFactor]:e.ONE,[SrcColorFactor]:e.SRC_COLOR,[SrcAlphaFactor]:e.SRC_ALPHA,[SrcAlphaSaturateFactor]:e.SRC_ALPHA_SATURATE,[DstColorFactor]:e.DST_COLOR,[DstAlphaFactor]:e.DST_ALPHA,[OneMinusSrcColorFactor]:e.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:e.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:e.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:e.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:e.CONSTANT_COLOR,[OneMinusConstantColorFactor]:e.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:e.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,r,n,i,a,o,s,l,u,c){if(t!==NoBlending){if(!1===p&&(G(e.BLEND),p=!0),t===CustomBlending)a=a||r,o=o||n,s=s||i,r===g&&a===v||(e.blendEquationSeparate(V[r],V[a]),g=r,v=a),n===_&&i===y&&o===b&&s===x||(e.blendFuncSeparate($[n],$[i],$[o],$[s]),_=n,y=i,b=o,x=s),!1!==l.equals(T)&&u===w||(e.blendColor(l.r,l.g,l.b,u),T.copy(l),w=u),m=t,E=!1;else if(t!==m||c!==E){if(g===AddEquation&&v===AddEquation||(e.blendEquation(e.FUNC_ADD),g=AddEquation,v=AddEquation),c)switch(t){case NormalBlending:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.ONE,e.ONE);break;case SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case MultiplyBlending:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case NormalBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case MultiplyBlending:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,y=null,b=null,x=null,T.set(0,0,0),w=0,m=t,E=c}}else!0===p&&(z(e.BLEND),p=!1)}function W(t){A!==t&&(e.frontFace(t?e.CW:e.CCW),A=t)}function X(t){t!==CullFaceNone?(G(e.CULL_FACE),t!==S&&e.cullFace(t===CullFaceBack?e.BACK:t===CullFaceFront?e.FRONT:e.FRONT_AND_BACK)):z(e.CULL_FACE),S=t}function Y(t,r,n){t?(G(e.POLYGON_OFFSET_FILL),M===r&&R===n||(e.polygonOffset(r,n),M=r,R=n)):z(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:a,stencil:o},enable:G,disable:z,bindFramebuffer:function(t,r){return c[t]!==r&&(e.bindFramebuffer(t,r),c[t]=r,n&&(t===e.DRAW_FRAMEBUFFER&&(c[e.FRAMEBUFFER]=r),t===e.FRAMEBUFFER&&(c[e.DRAW_FRAMEBUFFER]=r)),!0)},drawBuffers:function(n,i){let a=h,o=!1;if(n)if(a=d.get(i),void 0===a&&(a=[],d.set(i,a)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let r=0,n=t.length;r<n;r++)a[r]=e.COLOR_ATTACHMENT0+r;a.length=t.length,o=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,o=!0);else a[0]!==e.BACK&&(a[0]=e.BACK,o=!0);o&&(r.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:H,setMaterial:function(t,r){t.side===DoubleSide?z(e.CULL_FACE):G(e.CULL_FACE);let n=t.side===BackSide;r&&(n=!n),W(n),t.blending===NormalBlending&&!1===t.transparent?H(NoBlending):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),i.setMask(t.colorWrite);const s=t.stencilWrite;o.setTest(s),s&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?G(e.SAMPLE_ALPHA_TO_COVERAGE):z(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:X,setLineWidth:function(t){t!==P&&(O&&e.lineWidth(t),P=t)},setPolygonOffset:Y,setScissorTest:function(t){t?G(e.SCISSOR_TEST):z(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+C-1),D!==t&&(e.activeTexture(t),D=t)},bindTexture:function(t,r,n){void 0===n&&(n=null===D?e.TEXTURE0+C-1:D);let i=k[n];void 0===i&&(i={type:void 0,texture:void 0},k[n]=i),i.type===t&&i.texture===r||(D!==n&&(e.activeTexture(n),D=n),e.bindTexture(t,r||j[t]),i.type=t,i.texture=r)},unbindTexture:function(){const t=k[D];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let n=l.get(r);void 0===n&&(n=new WeakMap,l.set(r,n));let i=n.get(t);void 0===i&&(i=e.getUniformBlockIndex(r,t.name),n.set(t,i))},uniformBlockBinding:function(t,r){const n=l.get(r).get(t);s.get(r)!==n&&(e.uniformBlockBinding(r,n,t.__bindingPointIndex),s.set(r,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===q.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),q.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===n&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},D=null,k={},c={},d=new WeakMap,h=[],f=null,p=!1,m=null,g=null,_=null,y=null,v=null,b=null,x=null,T=new Color(0,0,0),w=0,E=!1,A=null,S=null,P=null,M=null,R=null,N.set(0,0,e.canvas.width,e.canvas.height),q.set(0,0,e.canvas.width,e.canvas.height),i.reset(),a.reset(),o.reset()}}}function WebGLTextures(e,t,r,n,i,a,o){const s=i.isWebGL2,l=i.maxTextures,u=i.maxCubemapSize,c=i.maxTextureSize,d=i.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return _?new OffscreenCanvas(e,t):createElementNS("canvas")}function v(e,t,r,n){let i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?floorPowerOfTwo:Math.floor,a=n(i*e.width),o=n(i*e.height);void 0===m&&(m=y(a,o));const s=r?y(a,o):m;return s.width=a,s.height=o,s.getContext("2d").drawImage(e,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return isPowerOfTwo(e.width)&&isPowerOfTwo(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function T(t){e.generateMipmap(t)}function w(r,n,i,a,o=!1){if(!1===s)return n;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let l=n;if(n===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),n===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),n===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),n===e.RGBA){const t=o?LinearTransfer:ColorManagement.getTransfer(a);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===SRGBTransfer?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function E(e,t,r){return!0===x(e,r)||e.isFramebufferTexture&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function A(t){return t===NearestFilter||t===NearestMipmapNearestFilter||t===NearestMipmapLinearFilter?e.NEAREST:e.LINEAR}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=n.get(e);if(void 0===t.__webglInit)return;const r=e.source,i=g.get(r);if(i){const n=i[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&M(e),0===Object.keys(i).length&&g.delete(r)}n.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function P(t){const r=t.target;r.removeEventListener("dispose",P),function(t){const r=t.texture,i=n.get(t),a=n.get(r);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(i.__webglFramebuffer[t]))for(let r=0;r<i.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(i.__webglFramebuffer[t][r]);else e.deleteFramebuffer(i.__webglFramebuffer[t]);i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,i=r.length;t<i;t++){const i=n.get(r[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--),n.remove(r[t])}n.remove(r),n.remove(t)}(r)}function M(t){const r=n.get(t);e.deleteTexture(r.__webglTexture),delete g.get(t.source)[r.__cacheKey],o.memory.textures--}let R=0;function C(t,i){const a=n.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void B(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const O={[RepeatWrapping]:e.REPEAT,[ClampToEdgeWrapping]:e.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:e.MIRRORED_REPEAT},L={[NearestFilter]:e.NEAREST,[NearestMipmapNearestFilter]:e.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:e.NEAREST_MIPMAP_LINEAR,[LinearFilter]:e.LINEAR,[LinearMipmapNearestFilter]:e.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:e.LINEAR_MIPMAP_LINEAR},I={[NeverCompare]:e.NEVER,[AlwaysCompare]:e.ALWAYS,[LessCompare]:e.LESS,[LessEqualCompare]:e.LEQUAL,[EqualCompare]:e.EQUAL,[GreaterEqualCompare]:e.GEQUAL,[GreaterCompare]:e.GREATER,[NotEqualCompare]:e.NOTEQUAL};function D(r,a,o){if(o?(e.texParameteri(r,e.TEXTURE_WRAP_S,O[a.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,O[a.wrapT]),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,O[a.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,L[a.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,L[a.minFilter])):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===ClampToEdgeWrapping&&a.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,A(a.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,A(a.minFilter)),a.minFilter!==NearestFilter&&a.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(r,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(r,e.TEXTURE_COMPARE_FUNC,I[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===NearestFilter)return;if(a.minFilter!==NearestMipmapLinearFilter&&a.minFilter!==LinearMipmapLinearFilter)return;if(a.type===FloatType&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===HalfFloatType&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(r,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function k(t,r){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",S));const i=r.source;let a=g.get(i);void 0===a&&(a={},g.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(r);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,n=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&M(r)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return n}function B(t,i,o){let l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);const u=k(t,i),d=i.source;r.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=n.get(d);if(d.version!==h.__version||!0===u){r.activeTexture(e.TEXTURE0+o);const t=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),n=i.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(i.colorSpace),f=i.colorSpace===NoColorSpace||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);const p=function(e){return!s&&(e.wrapS!==ClampToEdgeWrapping||e.wrapT!==ClampToEdgeWrapping||e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter)}(i)&&!1===b(i.image);let m=v(i.image,p,!1,c);m=G(i,m);const g=b(m)||s,_=a.convert(i.format,i.colorSpace);let y,A=a.convert(i.type),S=w(i.internalFormat,_,A,i.colorSpace,i.isVideoTexture);D(l,i,g);const P=i.mipmaps,M=s&&!0!==i.isVideoTexture&&S!==RGB_ETC1_Format,R=void 0===h.__version||!0===u,C=E(i,m,g);if(i.isDepthTexture)S=e.DEPTH_COMPONENT,s?S=i.type===FloatType?e.DEPTH_COMPONENT32F:i.type===UnsignedIntType?e.DEPTH_COMPONENT24:i.type===UnsignedInt248Type?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:i.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===DepthFormat&&S===e.DEPTH_COMPONENT&&i.type!==UnsignedShortType&&i.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=UnsignedIntType,A=a.convert(i.type)),i.format===DepthStencilFormat&&S===e.DEPTH_COMPONENT&&(S=e.DEPTH_STENCIL,i.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=UnsignedInt248Type,A=a.convert(i.type))),R&&(M?r.texStorage2D(e.TEXTURE_2D,1,S,m.width,m.height):r.texImage2D(e.TEXTURE_2D,0,S,m.width,m.height,0,_,A,null));else if(i.isDataTexture)if(P.length>0&&g){M&&R&&r.texStorage2D(e.TEXTURE_2D,C,S,P[0].width,P[0].height);for(let t=0,n=P.length;t<n;t++)y=P[t],M?r.texSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,A,y.data):r.texImage2D(e.TEXTURE_2D,t,S,y.width,y.height,0,_,A,y.data);i.generateMipmaps=!1}else M?(R&&r.texStorage2D(e.TEXTURE_2D,C,S,m.width,m.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,_,A,m.data)):r.texImage2D(e.TEXTURE_2D,0,S,m.width,m.height,0,_,A,m.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){M&&R&&r.texStorage3D(e.TEXTURE_2D_ARRAY,C,S,P[0].width,P[0].height,m.depth);for(let t=0,n=P.length;t<n;t++)y=P[t],i.format!==RGBAFormat?null!==_?M?r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,y.width,y.height,m.depth,_,y.data,0,0):r.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,S,y.width,y.height,m.depth,0,y.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?r.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,y.width,y.height,m.depth,_,A,y.data):r.texImage3D(e.TEXTURE_2D_ARRAY,t,S,y.width,y.height,m.depth,0,_,A,y.data)}else{M&&R&&r.texStorage2D(e.TEXTURE_2D,C,S,P[0].width,P[0].height);for(let t=0,n=P.length;t<n;t++)y=P[t],i.format!==RGBAFormat?null!==_?M?r.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,y.data):r.compressedTexImage2D(e.TEXTURE_2D,t,S,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?r.texSubImage2D(e.TEXTURE_2D,t,0,0,y.width,y.height,_,A,y.data):r.texImage2D(e.TEXTURE_2D,t,S,y.width,y.height,0,_,A,y.data)}else if(i.isDataArrayTexture)M?(R&&r.texStorage3D(e.TEXTURE_2D_ARRAY,C,S,m.width,m.height,m.depth),r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,_,A,m.data)):r.texImage3D(e.TEXTURE_2D_ARRAY,0,S,m.width,m.height,m.depth,0,_,A,m.data);else if(i.isData3DTexture)M?(R&&r.texStorage3D(e.TEXTURE_3D,C,S,m.width,m.height,m.depth),r.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,_,A,m.data)):r.texImage3D(e.TEXTURE_3D,0,S,m.width,m.height,m.depth,0,_,A,m.data);else if(i.isFramebufferTexture){if(R)if(M)r.texStorage2D(e.TEXTURE_2D,C,S,m.width,m.height);else{let t=m.width,n=m.height;for(let i=0;i<C;i++)r.texImage2D(e.TEXTURE_2D,i,S,t,n,0,_,A,null),t>>=1,n>>=1}}else if(P.length>0&&g){M&&R&&r.texStorage2D(e.TEXTURE_2D,C,S,P[0].width,P[0].height);for(let t=0,n=P.length;t<n;t++)y=P[t],M?r.texSubImage2D(e.TEXTURE_2D,t,0,0,_,A,y):r.texImage2D(e.TEXTURE_2D,t,S,_,A,y);i.generateMipmaps=!1}else M?(R&&r.texStorage2D(e.TEXTURE_2D,C,S,m.width,m.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,_,A,m)):r.texImage2D(e.TEXTURE_2D,0,S,_,A,m);x(i,g)&&T(l),h.__version=d.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function F(t,i,o,s,l,u){const c=a.convert(o.format,o.colorSpace),d=a.convert(o.type),f=w(o.internalFormat,c,d,o.colorSpace);if(!n.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>u),n=Math.max(1,i.height>>u);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?r.texImage3D(l,u,f,t,n,i.depth,0,c,d,null):r.texImage2D(l,u,f,t,n,0,c,d,null)}r.bindFramebuffer(e.FRAMEBUFFER,t),j(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,l,n.get(o).__webglTexture,0,U(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,l,n.get(o).__webglTexture,u),r.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,r,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){let i=!0===s?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(n||j(r)){const t=r.depthTexture;t&&t.isDepthTexture&&(t.type===FloatType?i=e.DEPTH_COMPONENT32F:t.type===UnsignedIntType&&(i=e.DEPTH_COMPONENT24));const n=U(r);j(r)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,i,r.width,r.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,n,i,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){const i=U(r);n&&!1===j(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,r.width,r.height):j(r)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let i=0;i<t.length;i++){const o=t[i],s=a.convert(o.format,o.colorSpace),l=a.convert(o.type),u=w(o.internalFormat,s,l,o.colorSpace),c=U(r);n&&!1===j(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,u,r.width,r.height):j(r)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,u,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,u,r.width,r.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function q(t){const i=n.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),C(i.depthTexture,0);const a=n.get(i.depthTexture).__webglTexture,o=U(i);if(i.depthTexture.format===DepthFormat)j(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");j(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)r.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=e.createRenderbuffer(),N(i.__webglDepthbuffer[n],t,!1)}else r.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),N(i.__webglDepthbuffer,t,!1);r.bindFramebuffer(e.FRAMEBUFFER,null)}function U(e){return Math.min(d,e.samples)}function j(e){const r=n.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}function G(e,r){const n=e.colorSpace,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===_SRGBAFormat||n!==LinearSRGBColorSpace&&n!==NoColorSpace&&(ColorManagement.getTransfer(n)===SRGBTransfer?!1===s?!0===t.has("EXT_sRGB")&&i===RGBAFormat?(e.format=_SRGBAFormat,e.minFilter=LinearFilter,e.generateMipmaps=!1):r=ImageUtils.sRGBToLinear(r):i===RGBAFormat&&a===UnsignedByteType||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),r}this.allocateTextureUnit=function(){const e=R;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),R+=1,e},this.resetTextureUnits=function(){R=0},this.setTexture2D=C,this.setTexture2DArray=function(t,i){const a=n.get(t);t.version>0&&a.__version!==t.version?B(a,t,i):r.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=n.get(t);t.version>0&&a.__version!==t.version?B(a,t,i):r.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;const l=k(t,i),c=i.source;r.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const d=n.get(c);if(c.version!==d.__version||!0===l){r.activeTexture(e.TEXTURE0+o);const t=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),n=i.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(i.colorSpace),h=i.colorSpace===NoColorSpace||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const f=i.isCompressedTexture||i.image[0].isCompressedTexture,p=i.image[0]&&i.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=f||p?p?i.image[e].image:i.image[e]:v(i.image[e],!1,!0,u),m[e]=G(i,m[e]);const g=m[0],_=b(g)||s,y=a.convert(i.format,i.colorSpace),A=a.convert(i.type),S=w(i.internalFormat,y,A,i.colorSpace),P=s&&!0!==i.isVideoTexture,M=void 0===d.__version||!0===l;let R,C=E(i,g,_);if(D(e.TEXTURE_CUBE_MAP,i,_),f){P&&M&&r.texStorage2D(e.TEXTURE_CUBE_MAP,C,S,g.width,g.height);for(let t=0;t<6;t++){R=m[t].mipmaps;for(let n=0;n<R.length;n++){const a=R[n];i.format!==RGBAFormat?null!==y?P?r.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,a.width,a.height,y,a.data):r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):P?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,a.width,a.height,y,A,a.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,a.width,a.height,0,y,A,a.data)}}}else{R=i.mipmaps,P&&M&&(R.length>0&&C++,r.texStorage2D(e.TEXTURE_CUBE_MAP,C,S,m[0].width,m[0].height));for(let t=0;t<6;t++)if(p){P?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,y,A,m[t].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,m[t].width,m[t].height,0,y,A,m[t].data);for(let n=0;n<R.length;n++){const i=R[n].image[t].image;P?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,i.width,i.height,y,A,i.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,i.width,i.height,0,y,A,i.data)}}else{P?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,y,A,m[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,y,A,m[t]);for(let n=0;n<R.length;n++){const i=R[n];P?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,y,A,i.image[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,y,A,i.image[t])}}}x(i,_)&&T(e.TEXTURE_CUBE_MAP),d.__version=c.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,i):r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,r,i){const a=n.get(t);void 0!==r&&F(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&q(t)},this.setupRenderTarget=function(t){const l=t.texture,u=n.get(t),c=n.get(l);t.addEventListener("dispose",P),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=l.version,o.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,f=b(t)||s;if(d){u.__webglFramebuffer=[];for(let t=0;t<6;t++)if(s&&l.mipmaps&&l.mipmaps.length>0){u.__webglFramebuffer[t]=[];for(let r=0;r<l.mipmaps.length;r++)u.__webglFramebuffer[t][r]=e.createFramebuffer()}else u.__webglFramebuffer[t]=e.createFramebuffer()}else{if(s&&l.mipmaps&&l.mipmaps.length>0){u.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)u.__webglFramebuffer[t]=e.createFramebuffer()}else u.__webglFramebuffer=e.createFramebuffer();if(h)if(i.drawBuffers){const r=t.texture;for(let t=0,i=r.length;t<i;t++){const i=n.get(r[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===j(t)){const n=h?l:[l];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],r.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer);for(let r=0;r<n.length;r++){const i=n[r];u.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,u.__webglColorRenderbuffer[r]);const o=a.convert(i.format,i.colorSpace),s=a.convert(i.type),l=w(i.internalFormat,o,s,i.colorSpace,!0===t.isXRRenderTarget),c=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.RENDERBUFFER,u.__webglColorRenderbuffer[r])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),N(u.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){r.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),D(e.TEXTURE_CUBE_MAP,l,f);for(let r=0;r<6;r++)if(s&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)F(u.__webglFramebuffer[r][n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,n);else F(u.__webglFramebuffer[r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0);x(l,f)&&T(e.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(h){const i=t.texture;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=n.get(o);r.bindTexture(e.TEXTURE_2D,s.__webglTexture),D(e.TEXTURE_2D,o,f),F(u.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),x(o,f)&&T(e.TEXTURE_2D)}r.unbindTexture()}else{let n=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?n=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),r.bindTexture(n,c.__webglTexture),D(n,l,f),s&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)F(u.__webglFramebuffer[r],t,l,e.COLOR_ATTACHMENT0,n,r);else F(u.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,n,0);x(l,f)&&T(n),r.unbindTexture()}t.depthBuffer&&q(t)},this.updateRenderTargetMipmap=function(t){const i=b(t)||s,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let o=0,s=a.length;o<s;o++){const s=a[o];if(x(s,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=n.get(s).__webglTexture;r.bindTexture(i,a),T(i),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===j(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const l=[],u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=n.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<i.length;t++)r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);r.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let r=0;r<i.length;r++){l.push(e.COLOR_ATTACHMENT0+r),t.depthBuffer&&l.push(u);const h=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[r]),!0===h&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[u]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[u])),d){const t=n.get(i[r]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),f&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(r.bindFramebuffer(e.READ_FRAMEBUFFER,null),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);const a=n.get(i[t]).__webglTexture;r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=q,this.setupFrameBufferTexture=F,this.useMultisampledRTT=j}function WebGLUtils(e,t,r){const n=r.isWebGL2;return{convert:function(r,i=NoColorSpace){let a;const o=ColorManagement.getTransfer(i);if(r===UnsignedByteType)return e.UNSIGNED_BYTE;if(r===UnsignedShort4444Type)return e.UNSIGNED_SHORT_4_4_4_4;if(r===UnsignedShort5551Type)return e.UNSIGNED_SHORT_5_5_5_1;if(r===ByteType)return e.BYTE;if(r===ShortType)return e.SHORT;if(r===UnsignedShortType)return e.UNSIGNED_SHORT;if(r===IntType)return e.INT;if(r===UnsignedIntType)return e.UNSIGNED_INT;if(r===FloatType)return e.FLOAT;if(r===HalfFloatType)return n?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(r===AlphaFormat)return e.ALPHA;if(r===RGBAFormat)return e.RGBA;if(r===LuminanceFormat)return e.LUMINANCE;if(r===LuminanceAlphaFormat)return e.LUMINANCE_ALPHA;if(r===DepthFormat)return e.DEPTH_COMPONENT;if(r===DepthStencilFormat)return e.DEPTH_STENCIL;if(r===_SRGBAFormat)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(r===RedFormat)return e.RED;if(r===RedIntegerFormat)return e.RED_INTEGER;if(r===RGFormat)return e.RG;if(r===RGIntegerFormat)return e.RG_INTEGER;if(r===RGBAIntegerFormat)return e.RGBA_INTEGER;if(r===RGB_S3TC_DXT1_Format||r===RGBA_S3TC_DXT1_Format||r===RGBA_S3TC_DXT3_Format||r===RGBA_S3TC_DXT5_Format)if(o===SRGBTransfer){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(r===RGB_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(r===RGB_S3TC_DXT1_Format)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===RGB_PVRTC_4BPPV1_Format||r===RGB_PVRTC_2BPPV1_Format||r===RGBA_PVRTC_4BPPV1_Format||r===RGBA_PVRTC_2BPPV1_Format){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(r===RGB_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===RGB_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===RGBA_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===RGBA_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===RGB_ETC1_Format)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===RGB_ETC2_Format||r===RGBA_ETC2_EAC_Format){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(r===RGB_ETC2_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===RGBA_ETC2_EAC_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(r===RGBA_ASTC_4x4_Format||r===RGBA_ASTC_5x4_Format||r===RGBA_ASTC_5x5_Format||r===RGBA_ASTC_6x5_Format||r===RGBA_ASTC_6x6_Format||r===RGBA_ASTC_8x5_Format||r===RGBA_ASTC_8x6_Format||r===RGBA_ASTC_8x8_Format||r===RGBA_ASTC_10x5_Format||r===RGBA_ASTC_10x6_Format||r===RGBA_ASTC_10x8_Format||r===RGBA_ASTC_10x10_Format||r===RGBA_ASTC_12x10_Format||r===RGBA_ASTC_12x12_Format){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(r===RGBA_ASTC_4x4_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===RGBA_ASTC_5x4_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===RGBA_ASTC_5x5_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===RGBA_ASTC_6x5_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===RGBA_ASTC_6x6_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===RGBA_ASTC_8x5_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===RGBA_ASTC_8x6_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===RGBA_ASTC_8x8_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===RGBA_ASTC_10x5_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===RGBA_ASTC_10x6_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===RGBA_ASTC_10x8_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===RGBA_ASTC_10x10_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===RGBA_ASTC_12x10_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===RGBA_ASTC_12x12_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===RGBA_BPTC_Format||r===RGB_BPTC_SIGNED_Format||r===RGB_BPTC_UNSIGNED_Format){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(r===RGBA_BPTC_Format)return o===SRGBTransfer?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===RGB_BPTC_SIGNED_Format)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===RGB_BPTC_UNSIGNED_Format)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(r===RED_RGTC1_Format||r===SIGNED_RED_RGTC1_Format||r===RED_GREEN_RGTC2_Format||r===SIGNED_RED_GREEN_RGTC2_Format){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(r===RGBA_BPTC_Format)return a.COMPRESSED_RED_RGTC1_EXT;if(r===SIGNED_RED_RGTC1_Format)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===RED_GREEN_RGTC2_Format)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===SIGNED_RED_GREEN_RGTC2_Format)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return r===UnsignedInt248Type?n?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[r]?e[r]:null}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let n=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,r),i=this._getHandJoint(l,n);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const n=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),i=.02,o=.005;l.inputState.pinching&&n>i+o?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&n<=i-o&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(n=t.getPose(e.targetRaySpace,r),null===n&&null!==i&&(n=i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return null!==o&&(o.visible=null!==n),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const r=new Group;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class WebXRManager extends EventDispatcher{constructor(e,t){super();const r=this;let n=null,i=1,a=null,o="local-floor",s=1,l=null,u=null,c=null,d=null,h=null,f=null;const p=t.getContextAttributes();let m=null,g=null;const _=[],y=[],v=new Vector2;let b=null;const x=new PerspectiveCamera;x.layers.enable(1),x.viewport=new Vector4;const T=new PerspectiveCamera;T.layers.enable(2),T.viewport=new Vector4;const w=[x,T],E=new ArrayCamera;E.layers.enable(1),E.layers.enable(2);let A=null,S=null;function P(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const r=_[t];void 0!==r&&(r.update(e.inputSource,e.frame,l||a),r.dispatchEvent({type:e.type,data:e.inputSource}))}function M(){n.removeEventListener("select",P),n.removeEventListener("selectstart",P),n.removeEventListener("selectend",P),n.removeEventListener("squeeze",P),n.removeEventListener("squeezestart",P),n.removeEventListener("squeezeend",P),n.removeEventListener("end",M),n.removeEventListener("inputsourceschange",R);for(let e=0;e<_.length;e++){const t=y[e];null!==t&&(y[e]=null,_[e].disconnect(t))}A=null,S=null,e.setRenderTarget(m),h=null,d=null,c=null,n=null,g=null,D.stop(),r.isPresenting=!1,e.setPixelRatio(b),e.setSize(v.width,v.height,!1),r.dispatchEvent({type:"sessionend"})}function R(e){for(let t=0;t<e.removed.length;t++){const r=e.removed[t],n=y.indexOf(r);n>=0&&(y[n]=null,_[n].disconnect(r))}for(let t=0;t<e.added.length;t++){const r=e.added[t];let n=y.indexOf(r);if(-1===n){for(let e=0;e<_.length;e++){if(e>=y.length){y.push(r),n=e;break}if(null===y[e]){y[e]=r,n=e;break}}if(-1===n)break}const i=_[n];i&&i.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new WebXRController,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new WebXRController,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new WebXRController,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return c},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(u){if(n=u,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",P),n.addEventListener("selectstart",P),n.addEventListener("selectend",P),n.addEventListener("squeeze",P),n.addEventListener("squeezestart",P),n.addEventListener("squeezeend",P),n.addEventListener("end",M),n.addEventListener("inputsourceschange",R),!0!==p.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(v),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2)h=new XRWebGLLayer(n,t,{antialias:void 0!==n.renderState.layers||p.antialias,alpha:!0,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i}),n.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),g=new WebGLRenderTarget(h.framebufferWidth,h.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:e.outputColorSpace,stencilBuffer:p.stencil});else{let r=null,a=null,o=null;p.depth&&(o=p.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,r=p.stencil?DepthStencilFormat:DepthFormat,a=p.stencil?UnsignedInt248Type:UnsignedIntType);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};c=new XRWebGLBinding(n,t),d=c.createProjectionLayer(s),n.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),g=new WebGLRenderTarget(d.textureWidth,d.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,r),stencilBuffer:p.stencil,colorSpace:e.outputColorSpace,samples:p.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await n.requestReferenceSpace(o),D.setContext(n),D.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};const C=new Vector3,O=new Vector3;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;E.near=T.near=x.near=e.near,E.far=T.far=x.far=e.far,A===E.near&&S===E.far||(n.updateRenderState({depthNear:E.near,depthFar:E.far}),A=E.near,S=E.far);const t=e.parent,r=E.cameras;L(E,t);for(let e=0;e<r.length;e++)L(r[e],t);2===r.length?function(e,t,r){C.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(r.matrixWorld);const n=C.distanceTo(O),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=o*c,f=o*d,p=n/(-c+d),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,_=s+p;e.projectionMatrix.makePerspective(h-m,f+(n-m),l*s/_*g,u*s/_*g,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,x,T):E.projectionMatrix.copy(x.projectionMatrix),function(e,t,r){null===r?e.matrix.copy(t.matrixWorld):(e.matrix.copy(r.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*RAD2DEG*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,t)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let I=null;const D=new WebGLAnimation;D.setAnimationLoop((function(t,n){if(u=n.getViewerPose(l||a),f=n,null!==u){const t=u.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let r=!1;t.length!==E.cameras.length&&(E.cameras.length=0,r=!0);for(let n=0;n<t.length;n++){const i=t[n];let a=null;if(null!==h)a=h.getViewport(i);else{const t=c.getViewSubImage(d,i);a=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=w[n];void 0===o&&(o=new PerspectiveCamera,o.layers.enable(n),o.viewport=new Vector4,w[n]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===r&&E.cameras.push(o)}}for(let e=0;e<_.length;e++){const t=y[e],r=_[e];null!==t&&void 0!==r&&r.update(t,n,l||a)}I&&I(t,n),n.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:n}),f=null})),this.setAnimationLoop=function(e){I=e},this.dispose=function(){}}}function WebGLMaterials(e,t){function r(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map,r(i.map,n.mapTransform)),i.alphaMap&&(n.alphaMap.value=i.alphaMap,r(i.alphaMap,n.alphaMapTransform)),i.bumpMap&&(n.bumpMap.value=i.bumpMap,r(i.bumpMap,n.bumpMapTransform),n.bumpScale.value=i.bumpScale,i.side===BackSide&&(n.bumpScale.value*=-1)),i.normalMap&&(n.normalMap.value=i.normalMap,r(i.normalMap,n.normalMapTransform),n.normalScale.value.copy(i.normalScale),i.side===BackSide&&n.normalScale.value.negate()),i.displacementMap&&(n.displacementMap.value=i.displacementMap,r(i.displacementMap,n.displacementMapTransform),n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap,r(i.emissiveMap,n.emissiveMapTransform)),i.specularMap&&(n.specularMap.value=i.specularMap,r(i.specularMap,n.specularMapTransform)),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const a=t.get(i).envMap;if(a&&(n.envMap.value=a,n.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*t,r(i.lightMap,n.lightMapTransform)}i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity,r(i.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(t,r){r.color.getRGB(t.fogColor.value,getUnlitUniformColorSpace(e)),r.isFog?(t.fogNear.value=r.near,t.fogFar.value=r.far):r.isFogExp2&&(t.fogDensity.value=r.density)},refreshMaterialUniforms:function(e,i,a,o,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.metalness.value=n.metalness,n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap,r(n.metalnessMap,e.metalnessMapTransform)),e.roughness.value=n.roughness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap,r(n.roughnessMap,e.roughnessMapTransform)),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,r(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,r(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,r(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,r(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,r(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===BackSide&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,r(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,r(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,r(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,r(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,r(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,r(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,r(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,s)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,r){const n=t.get(r).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map,r(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function WebGLUniformsGroups(e,t,r,n){let i={},a={},o=[];const s=r.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,r){const n=e.value;if(void 0===r[t]){if("number"==typeof n)r[t]=n;else{const e=Array.isArray(n)?n:[n],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());r[t]=i}return!0}if("number"==typeof n){if(r[t]!==n)return r[t]=n,!0}else{const e=Array.isArray(r[t])?r[t]:[r[t]],i=Array.isArray(n)?n:[n];for(let t=0;t<e.length;t++){const r=e[t];if(!1===r.equals(i[t]))return r.copy(i[t]),!0}}return!1}function u(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){const r=t.target;r.removeEventListener("dispose",c);const n=o.indexOf(r.__bindingPointIndex);o.splice(n,1),e.deleteBuffer(i[r.id]),delete i[r.id],delete a[r.id]}return{bind:function(e,t){n.uniformBlockBinding(e,t.program)},update:function(r,d){let h=i[r.id];void 0===h&&(function(e){const t=e.uniforms;let r=0,n=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],a={boundary:0,storage:0},o=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=o.length;e<t;e++){const t=u(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}i.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=r,e>0&&(n=r%16,0!==n&&16-n-a.boundary<0&&(r+=16-n,i.__offset=r)),r+=a.storage}n=r%16,n>0&&(r+=16-n),e.__size=r,e.__cache={}}(r),h=function(t){const r=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;const n=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,r,n),n}(r),i[r.id]=h,r.addEventListener("dispose",c)),n.updateUBOMapping(r,d.program);const f=t.render.frame;a[r.id]!==f&&(function(t){const r=t.uniforms,n=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,i[t.id]);for(let t=0,i=r.length;t<i;t++){const i=r[t];if(!0===l(i,t,n)){const t=i.__offset,r=Array.isArray(i.value)?i.value:[i.value];let n=0;for(let a=0;a<r.length;a++){const o=r[a],s=u(o);"number"==typeof o?(i.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+n,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=o.elements[0],i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=o.elements[0],i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=o.elements[0]):(o.toArray(i.__data,n),n+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(r),a[r.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}class WebGLRenderer{constructor(e={}){const{canvas:t=createCanvasElement(),context:r=null,depth:n=!0,stencil:i=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:c=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==r?r.getContextAttributes().alpha:a;const h=new Uint32Array(4),f=new Int32Array(4);let p=null,m=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const y=this;let v=!1,b=0,x=0,T=null,w=-1,E=null;const A=new Vector4,S=new Vector4;let P=null;const M=new Color(0);let R=0,C=t.width,O=t.height,L=1,I=null,D=null;const k=new Vector4(0,0,C,O),B=new Vector4(0,0,C,O);let F=!1;const N=new Frustum;let q=!1,U=!1,j=null;const G=new Matrix4,z=new Vector2,V=new Vector3,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===T?L:1}let W,X,Y,Z,K,J,Q,ee,te,re,ne,ie,ae,oe,se,le,ue,ce,de,he,fe,pe,me,ge,_e=r;function ye(e,r){for(let n=0;n<e.length;n++){const i=t.getContext(e[n],r);if(null!==i)return i}return null}try{const e={alpha:!0,depth:n,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${REVISION}`),t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",Te,!1),t.addEventListener("webglcontextcreationerror",we,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),_e=ye(t,e),null===_e)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&_e instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){W=new WebGLExtensions(_e),X=new WebGLCapabilities(_e,W,e),W.init(X),pe=new WebGLUtils(_e,W,X),Y=new WebGLState(_e,W,X),Z=new WebGLInfo(_e),K=new WebGLProperties,J=new WebGLTextures(_e,W,Y,K,X,pe,Z),Q=new WebGLCubeMaps(y),ee=new WebGLCubeUVMaps(y),te=new WebGLAttributes(_e,X),me=new WebGLBindingStates(_e,W,te,X),re=new WebGLGeometries(_e,te,Z,me),ne=new WebGLObjects(_e,re,te,Z),de=new WebGLMorphtargets(_e,X,J),le=new WebGLClipping(K),ie=new WebGLPrograms(y,Q,ee,W,X,me,le),ae=new WebGLMaterials(y,K),oe=new WebGLRenderLists,se=new WebGLRenderStates(W,X),ce=new WebGLBackground(y,Q,ee,Y,ne,d,s),ue=new WebGLShadowMap(y,ne,X),ge=new WebGLUniformsGroups(_e,Z,X,Y),he=new WebGLBufferRenderer(_e,W,Z,X),fe=new WebGLIndexedBufferRenderer(_e,W,Z,X),Z.programs=ie.programs,y.capabilities=X,y.extensions=W,y.properties=K,y.renderLists=oe,y.shadowMap=ue,y.state=Y,y.info=Z}ve();const be=new WebXRManager(y,_e);function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Te(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const e=Z.autoReset,t=ue.enabled,r=ue.autoUpdate,n=ue.needsUpdate,i=ue.type;ve(),Z.autoReset=e,ue.enabled=t,ue.autoUpdate=r,ue.needsUpdate=n,ue.type=i}function we(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),K.remove(e)}(t)}function Ae(e,t,r){!0===e.transparent&&e.side===DoubleSide&&!1===e.forceSinglePass?(e.side=BackSide,e.needsUpdate=!0,De(e,t,r),e.side=FrontSide,e.needsUpdate=!0,De(e,t,r),e.side=DoubleSide):De(e,t,r)}this.xr=be,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(C,O,!1))},this.getSize=function(e){return e.set(C,O)},this.setSize=function(e,r,n=!0){be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,O=r,t.width=Math.floor(e*L),t.height=Math.floor(r*L),!0===n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return e.set(C*L,O*L).floor()},this.setDrawingBufferSize=function(e,r,n){C=e,O=r,L=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return e.copy(A)},this.getViewport=function(e){return e.copy(k)},this.setViewport=function(e,t,r,n){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,r,n),Y.viewport(A.copy(k).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,r,n){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,r,n),Y.scissor(S.copy(B).multiplyScalar(L).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){Y.setScissorTest(F=e)},this.setOpaqueSort=function(e){I=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(e=!0,t=!0,r=!0){let n=0;if(e){let e=!1;if(null!==T){const t=T.texture.format;e=t===RGBAIntegerFormat||t===RGIntegerFormat||t===RedIntegerFormat}if(e){const e=T.texture.type,t=e===UnsignedByteType||e===UnsignedIntType||e===UnsignedShortType||e===UnsignedInt248Type||e===UnsignedShort4444Type||e===UnsignedShort5551Type,r=ce.getClearColor(),n=ce.getClearAlpha(),i=r.r,a=r.g,o=r.b;t?(h[0]=i,h[1]=a,h[2]=o,h[3]=n,_e.clearBufferuiv(_e.COLOR,0,h)):(f[0]=i,f[1]=a,f[2]=o,f[3]=n,_e.clearBufferiv(_e.COLOR,0,f))}else n|=_e.COLOR_BUFFER_BIT}t&&(n|=_e.DEPTH_BUFFER_BIT),r&&(n|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",Te,!1),t.removeEventListener("webglcontextcreationerror",we,!1),oe.dispose(),se.dispose(),K.dispose(),Q.dispose(),ee.dispose(),ne.dispose(),me.dispose(),ge.dispose(),ie.dispose(),be.dispose(),be.removeEventListener("sessionstart",Pe),be.removeEventListener("sessionend",Me),j&&(j.dispose(),j=null),Re.stop()},this.renderBufferDirect=function(e,t,r,n,i,a){null===t&&(t=$);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,r,n,i){!0!==t.isScene&&(t=$),J.resetTextureUnits();const a=t.fog,o=null===T?y.outputColorSpace:!0===T.isXRRenderTarget?T.texture.colorSpace:LinearSRGBColorSpace,s=(n.isMeshStandardMaterial?ee:Q).get(n.envMap||(n.isMeshStandardMaterial?t.environment:null)),l=!0===n.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,u=!!r.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),c=!!r.morphAttributes.position,d=!!r.morphAttributes.normal,h=!!r.morphAttributes.color;let f=NoToneMapping;n.toneMapped&&(null!==T&&!0!==T.isXRRenderTarget||(f=y.toneMapping));const p=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,g=void 0!==p?p.length:0,_=K.get(n),v=m.state.lights;!0!==q||!0!==U&&e===E||le.setState(n,e,e===E&&n.id===w);let b=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==v.state.version||_.outputColorSpace!==o||i.isBatchedMesh&&!1===_.batching?b=!0:i.isBatchedMesh||!0!==_.batching?i.isInstancedMesh&&!1===_.instancing?b=!0:i.isInstancedMesh||!0!==_.instancing?i.isSkinnedMesh&&!1===_.skinning?b=!0:i.isSkinnedMesh||!0!==_.skinning?i.isInstancedMesh&&!0===_.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===_.instancingColor&&null!==i.instanceColor||_.envMap!==s||!0===n.fog&&_.fog!==a?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===le.numPlanes&&_.numIntersection===le.numIntersection?(_.vertexAlphas!==l||_.vertexTangents!==u||_.morphTargets!==c||_.morphNormals!==d||_.morphColors!==h||_.toneMapping!==f||!0===X.isWebGL2&&_.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,_.__version=n.version);let x=_.currentProgram;!0===b&&(x=De(n,t,i));let A=!1,S=!1,P=!1;const M=x.getUniforms(),R=_.uniforms;if(Y.useProgram(x.program)&&(A=!0,S=!0,P=!0),n.id!==w&&(w=n.id,S=!0),A||E!==e){M.setValue(_e,"projectionMatrix",e.projectionMatrix),M.setValue(_e,"viewMatrix",e.matrixWorldInverse);const t=M.map.cameraPosition;void 0!==t&&t.setValue(_e,V.setFromMatrixPosition(e.matrixWorld)),X.logarithmicDepthBuffer&&M.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&M.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),E!==e&&(E=e,S=!0,P=!0)}if(i.isSkinnedMesh){M.setOptional(_e,i,"bindMatrix"),M.setOptional(_e,i,"bindMatrixInverse");const e=i.skeleton;e&&(X.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),M.setValue(_e,"boneTexture",e.boneTexture,J)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}i.isBatchedMesh&&(M.setOptional(_e,i,"batchingTexture"),M.setValue(_e,"batchingTexture",i._matricesTexture,J));const C=r.morphAttributes;if((void 0!==C.position||void 0!==C.normal||void 0!==C.color&&!0===X.isWebGL2)&&de.update(i,r,x),(S||_.receiveShadow!==i.receiveShadow)&&(_.receiveShadow=i.receiveShadow,M.setValue(_e,"receiveShadow",i.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(R.envMap.value=s,R.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1),S&&(M.setValue(_e,"toneMappingExposure",y.toneMappingExposure),_.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(R,P),a&&!0===n.fog&&ae.refreshFogUniforms(R,a),ae.refreshMaterialUniforms(R,n,L,O,j),WebGLUniforms.upload(_e,ke(_),R,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(WebGLUniforms.upload(_e,ke(_),R,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&M.setValue(_e,"center",i.center),M.setValue(_e,"modelViewMatrix",i.modelViewMatrix),M.setValue(_e,"normalMatrix",i.normalMatrix),M.setValue(_e,"modelMatrix",i.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const e=n.uniformsGroups;for(let t=0,r=e.length;t<r;t++)if(X.isWebGL2){const r=e[t];ge.update(r,x),ge.bind(r,x)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return x}(e,t,r,n,i);Y.setMaterial(n,o);let l=r.index,u=1;if(!0===n.wireframe){if(l=re.getWireframeAttribute(r),void 0===l)return;u=2}const c=r.drawRange,d=r.attributes.position;let h=c.start*u,f=(c.start+c.count)*u;null!==a&&(h=Math.max(h,a.start*u),f=Math.min(f,(a.start+a.count)*u)),null!==l?(h=Math.max(h,0),f=Math.min(f,l.count)):null!=d&&(h=Math.max(h,0),f=Math.min(f,d.count));const p=f-h;if(p<0||p===1/0)return;let g;me.setup(i,n,s,r,l);let _=he;if(null!==l&&(g=te.get(l),_=fe,_.setIndex(g)),i.isMesh)!0===n.wireframe?(Y.setLineWidth(n.wireframeLinewidth*H()),_.setMode(_e.LINES)):_.setMode(_e.TRIANGLES);else if(i.isLine){let e=n.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*H()),_.setMode(i.isLineSegments?_e.LINES:i.isLineLoop?_e.LINE_LOOP:_e.LINE_STRIP)}else i.isPoints?_.setMode(_e.POINTS):i.isSprite&&_.setMode(_e.TRIANGLES);if(i.isBatchedMesh)_.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)_.renderInstances(h,p,i.count);else if(r.isInstancedBufferGeometry){const e=Math.min(r.instanceCount,void 0!==r._maxInstanceCount?r._maxInstanceCount:1/0);_.renderInstances(h,p,e)}else _.render(h,p)},this.compile=function(e,t,r=null){null===r&&(r=e),m=se.get(r),m.init(),_.push(m),r.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==r&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(y._useLegacyLights);const n=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];Ae(a,r,e),n.add(a)}else Ae(t,r,e),n.add(t)})),_.pop(),m=null,n},this.compileAsync=function(e,t,r=null){const n=this.compile(e,t,r);return new Promise((t=>{function r(){n.forEach((function(e){K.get(e).currentProgram.isReady()&&n.delete(e)})),0!==n.size?setTimeout(r,10):t(e)}null!==W.get("KHR_parallel_shader_compile")?r():setTimeout(r,10)}))};let Se=null;function Pe(){Re.stop()}function Me(){Re.start()}const Re=new WebGLAnimation;function Ce(e,t,r,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||N.intersectsSprite(e)){n&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=ne.update(e),i=e.material;i.visible&&p.push(e,t,i,r,V.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||N.intersectsObject(e))){const t=ne.update(e),i=e.material;if(n&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),V.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center)),V.applyMatrix4(e.matrixWorld).applyMatrix4(G)),Array.isArray(i)){const n=t.groups;for(let a=0,o=n.length;a<o;a++){const o=n[a],s=i[o.materialIndex];s&&s.visible&&p.push(e,t,s,r,V.z,o)}}else i.visible&&p.push(e,t,i,r,V.z,null)}const i=e.children;for(let e=0,a=i.length;e<a;e++)Ce(i[e],t,r,n)}function Oe(e,t,r,n){const i=e.opaque,a=e.transmissive,o=e.transparent;m.setupLightsView(r),!0===q&&le.setGlobalState(y.clippingPlanes,r),a.length>0&&function(e,t,r,n){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;const i=X.isWebGL2;null===j&&(j=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:i?4:0})),y.getDrawingBufferSize(z),i?j.setSize(z.x,z.y):j.setSize(floorPowerOfTwo(z.x),floorPowerOfTwo(z.y));const a=y.getRenderTarget();y.setRenderTarget(j),y.getClearColor(M),R=y.getClearAlpha(),R<1&&y.setClearColor(16777215,.5),y.clear();const o=y.toneMapping;y.toneMapping=NoToneMapping,Le(e,r,n),J.updateMultisampleRenderTarget(j),J.updateRenderTargetMipmap(j);let s=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.object,o=i.geometry,l=i.material,u=i.group;if(l.side===DoubleSide&&a.layers.test(n.layers)){const e=l.side;l.side=BackSide,l.needsUpdate=!0,Ie(a,r,n,o,l,u),l.side=e,l.needsUpdate=!0,s=!0}}!0===s&&(J.updateMultisampleRenderTarget(j),J.updateRenderTargetMipmap(j)),y.setRenderTarget(a),y.setClearColor(M,R),y.toneMapping=o}(i,a,t,r),n&&Y.viewport(A.copy(n)),i.length>0&&Le(i,t,r),a.length>0&&Le(a,t,r),o.length>0&&Le(o,t,r),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Le(e,t,r){const n=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,l=null===n?a.material:n,u=a.group;o.layers.test(r.layers)&&Ie(o,t,r,s,l,u)}}function Ie(e,t,r,n,i,a){e.onBeforeRender(y,t,r,n,i,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(y,t,r,n,e,a),!0===i.transparent&&i.side===DoubleSide&&!1===i.forceSinglePass?(i.side=BackSide,i.needsUpdate=!0,y.renderBufferDirect(r,t,n,i,e,a),i.side=FrontSide,i.needsUpdate=!0,y.renderBufferDirect(r,t,n,i,e,a),i.side=DoubleSide):y.renderBufferDirect(r,t,n,i,e,a),e.onAfterRender(y,t,r,n,i,a)}function De(e,t,r){!0!==t.isScene&&(t=$);const n=K.get(e),i=m.state.lights,a=i.state.version,o=ie.getParameters(e,i.state,m.state.shadowsArray,t,r),s=ie.getProgramCacheKey(o);let l=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||n.environment),void 0===l&&(e.addEventListener("dispose",Ee),l=new Map,n.programs=l);let u=l.get(s);if(void 0!==u){if(n.currentProgram===u&&n.lightsStateVersion===a)return Be(e,o),u}else o.uniforms=ie.getUniforms(e),e.onBuild(r,o,y),e.onBeforeCompile(o,y),u=ie.acquireProgram(o,s),l.set(s,u),n.uniforms=o.uniforms;const c=n.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(c.clippingPlanes=le.uniform),Be(e,o),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=a,n.needsLights&&(c.ambientLightColor.value=i.state.ambient,c.lightProbe.value=i.state.probe,c.directionalLights.value=i.state.directional,c.directionalLightShadows.value=i.state.directionalShadow,c.spotLights.value=i.state.spot,c.spotLightShadows.value=i.state.spotShadow,c.rectAreaLights.value=i.state.rectArea,c.ltc_1.value=i.state.rectAreaLTC1,c.ltc_2.value=i.state.rectAreaLTC2,c.pointLights.value=i.state.point,c.pointLightShadows.value=i.state.pointShadow,c.hemisphereLights.value=i.state.hemi,c.directionalShadowMap.value=i.state.directionalShadowMap,c.directionalShadowMatrix.value=i.state.directionalShadowMatrix,c.spotShadowMap.value=i.state.spotShadowMap,c.spotLightMatrix.value=i.state.spotLightMatrix,c.spotLightMap.value=i.state.spotLightMap,c.pointShadowMap.value=i.state.pointShadowMap,c.pointShadowMatrix.value=i.state.pointShadowMatrix),n.currentProgram=u,n.uniformsList=null,u}function ke(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=WebGLUniforms.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Be(e,t){const r=K.get(e);r.outputColorSpace=t.outputColorSpace,r.batching=t.batching,r.instancing=t.instancing,r.instancingColor=t.instancingColor,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){Se&&Se(e)})),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Se=e,be.setAnimationLoop(e),null===e?Re.stop():Re.start()},be.addEventListener("sessionstart",Pe),be.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==v){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,T),m=se.get(e,_.length),m.init(),_.push(m),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(G),U=this.localClippingEnabled,q=le.init(this.clippingPlanes,U),p=oe.get(e,g.length),p.init(),g.push(p),Ce(e,t,0,y.sortObjects),p.finish(),!0===y.sortObjects&&p.sort(I,D),this.info.render.frame++,!0===q&&le.beginShadows(),ue.render(m.state.shadowsArray,e,t),!0===q&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(p,e),m.setupLights(y._useLegacyLights),t.isArrayCamera){const r=t.cameras;for(let t=0,n=r.length;t<n;t++){const n=r[t];Oe(p,e,n,n.viewport)}}else Oe(p,e,t);null!==T&&(J.updateMultisampleRenderTarget(T),J.updateRenderTargetMipmap(T)),!0===e.isScene&&e.onAfterRender(y,e,t),me.resetDefaultState(),w=-1,E=null,_.pop(),m=_.length>0?_[_.length-1]:null,g.pop(),p=g.length>0?g[g.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(e,t,r){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=r;const n=K.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===r,n.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const r=K.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){T=e,b=t,x=r;let n=!0,i=null,a=!1,o=!1;if(e){const s=K.get(e);void 0!==s.__useDefaultFramebuffer?(Y.bindFramebuffer(_e.FRAMEBUFFER,null),n=!1):void 0===s.__webglFramebuffer?J.setupRenderTarget(e):s.__hasExternalTextures&&J.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const u=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(u[t])?u[t][r]:u[t],a=!0):i=X.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:Array.isArray(u)?u[r]:u,A.copy(e.viewport),S.copy(e.scissor),P=e.scissorTest}else A.copy(k).multiplyScalar(L).floor(),S.copy(B).multiplyScalar(L).floor(),P=F;if(Y.bindFramebuffer(_e.FRAMEBUFFER,i)&&X.drawBuffers&&n&&Y.drawBuffers(e,i),Y.viewport(A),Y.scissor(S),Y.setScissorTest(P),a){const n=K.get(e.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,r)}else if(o){const n=K.get(e.texture);_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,n.__webglTexture,r||0,t||0)}w=-1},this.readRenderTargetPixels=function(e,t,r,n,i,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){Y.bindFramebuffer(_e.FRAMEBUFFER,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==RGBAFormat&&pe.convert(s)!==_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=l===HalfFloatType&&(W.has("EXT_color_buffer_half_float")||X.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===UnsignedByteType||pe.convert(l)===_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_TYPE)||l===FloatType&&(X.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&_e.readPixels(t,r,n,i,pe.convert(s),pe.convert(l),a)}finally{const e=null!==T?K.get(T).__webglFramebuffer:null;Y.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){const n=Math.pow(2,-r),i=Math.floor(t.image.width*n),a=Math.floor(t.image.height*n);J.setTexture2D(t,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,r,0,0,e.x,e.y,i,a),Y.unbindTexture()},this.copyTextureToTexture=function(e,t,r,n=0){const i=t.image.width,a=t.image.height,o=pe.convert(r.format),s=pe.convert(r.type);J.setTexture2D(r,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,r.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,r.unpackAlignment),t.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,n,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):_e.texSubImage2D(_e.TEXTURE_2D,n,e.x,e.y,o,s,t.image),0===n&&r.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,n,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=pe.convert(n.format),u=pe.convert(n.type);let c;if(n.isData3DTexture)J.setTexture3D(n,0),c=_e.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(n,0),c=_e.TEXTURE_2D_ARRAY}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,n.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,n.unpackAlignment);const d=_e.getParameter(_e.UNPACK_ROW_LENGTH),h=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),f=_e.getParameter(_e.UNPACK_SKIP_PIXELS),p=_e.getParameter(_e.UNPACK_SKIP_ROWS),m=_e.getParameter(_e.UNPACK_SKIP_IMAGES),g=r.isCompressedTexture?r.mipmaps[0]:r.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,g.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,g.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,e.min.x),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,e.min.y),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,e.min.z),r.isDataTexture||r.isData3DTexture?_e.texSubImage3D(c,i,t.x,t.y,t.z,a,o,s,l,u,g.data):r.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(c,i,t.x,t.y,t.z,a,o,s,l,g.data)):_e.texSubImage3D(c,i,t.x,t.y,t.z,a,o,s,l,u,g),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,d),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,h),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,f),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,p),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,m),0===i&&n.generateMipmaps&&_e.generateMipmap(c),Y.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){b=0,x=0,T=null,Y.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===DisplayP3ColorSpace?"display-p3":"srgb",t.unpackColorSpace=ColorManagement.workingColorSpace===LinearDisplayP3ColorSpace?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class InterleavedBuffer{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn('THREE.InterleavedBuffer: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$6=new Vector3;class InterleavedBufferAttribute{constructor(e,t,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)_vector$6.fromBufferAttribute(this,t),_vector$6.applyMatrix4(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)_vector$6.fromBufferAttribute(this,t),_vector$6.applyNormalMatrix(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)_vector$6.fromBufferAttribute(this,t),_vector$6.transformDirection(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}setX(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=denormalize(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=denormalize(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=denormalize(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=denormalize(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),n=normalize(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),n=normalize(n,this.array),i=normalize(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$4=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(r),!1!==e.ray.intersectsSphere(_sphere$4)&&(_inverseMatrix$2.copy(r).invert(),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2),null!==this.boundingBox&&!1===_ray$2.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,_ray$2)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Vector4,t=this.geometry.attributes.skinWeight;for(let r=0,n=t.count;r<n;r++){e.fromBufferAttribute(t,r);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,n=this.geometry;_skinIndex.fromBufferAttribute(n.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(n.attributes.skinWeight,e),_basePosition.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=_skinWeight.getComponent(e);if(0!==n){const i=_skinIndex.getComponent(e);_matrix4.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),t.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),n)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(e=null,t=1,r=1,n,i,a,o,s,l=NearestFilter,u=NearestFilter,c,d){super(null,a,o,s,l,u,n,i,c,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Matrix4;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let n=0,i=e.length;n<i;n++)_offsetMatrix.multiplyMatrices(e[n]?e[n].matrixWorld:_identityMatrix$1,t[n]),_offsetMatrix.toArray(r,16*n);null!==n&&(n.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new DataTexture(t,e,e,RGBAFormat,FloatType);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){const n=e.bones[r];let i=t[n];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),i=new Bone),this.bones.push(i),this.boneInverses.push((new Matrix4).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let n=0,i=t.length;n<i;n++)e.bones.push(t[n].uuid),e.boneInverses.push(r[n].toArray());return e}}class InstancedBufferAttribute extends BufferAttribute{constructor(e,t,r,n=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$3=new Sphere;class InstancedMesh extends Mesh{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<r;e++)this.setMatrixAt(e,_identity)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Box3),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,_instanceLocalMatrix),_box3.copy(e.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,_instanceLocalMatrix),_sphere$3.copy(e.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$3)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,n=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,void 0!==_mesh$1.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(r),!1!==e.ray.intersectsSphere(_sphere$3)))for(let i=0;i<n;i++){this.getMatrixAt(i,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(e,_instanceIntersects);for(let e=0,r=_instanceIntersects.length;e<r;e++){const r=_instanceIntersects[e];r.instanceId=i,r.object=this,t.push(r)}_instanceIntersects.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[0];for(let e=1,n=t.count;e<n;e++)_start$1.fromBufferAttribute(t,e-1),_end$1.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$1.copy(r.boundingSphere),_sphere$1.applyMatrix4(n),_sphere$1.radius+=i,!1===e.ray.intersectsSphere(_sphere$1))return;_inverseMatrix$1.copy(n).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new Vector3,u=new Vector3,c=new Vector3,d=new Vector3,h=this.isLineSegments?2:1,f=r.index,p=r.attributes.position;if(null!==f)for(let r=Math.max(0,a.start),n=Math.min(f.count,a.start+a.count)-1;r<n;r+=h){const n=f.getX(r),i=f.getX(r+1);if(l.fromBufferAttribute(p,n),u.fromBufferAttribute(p,i),_ray$1.distanceSqToSegment(l,u,d,c)>s)continue;d.applyMatrix4(this.matrixWorld);const a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}else for(let r=Math.max(0,a.start),n=Math.min(p.count,a.start+a.count)-1;r<n;r+=h){if(l.fromBufferAttribute(p,r),u.fromBufferAttribute(p,r+1),_ray$1.distanceSqToSegment(l,u,d,c)>s)continue;d.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[];for(let e=0,n=t.count;e<n;e+=2)_start.fromBufferAttribute(t,e),_end.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(n),_sphere.radius+=i,!1===e.ray.intersectsSphere(_sphere))return;_inverseMatrix.copy(n).invert(),_ray.copy(e.ray).applyMatrix4(_inverseMatrix);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=r.index,u=r.attributes.position;if(null!==l)for(let r=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);r<i;r++){const i=l.getX(r);_position$2.fromBufferAttribute(u,i),testPoint(_position$2,i,s,n,e,t,this)}else for(let r=Math.max(0,a.start),i=Math.min(u.count,a.start+a.count);r<i;r++)_position$2.fromBufferAttribute(u,r),testPoint(_position$2,r,s,n,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function testPoint(e,t,r,n,i,a,o){const s=_ray.distanceSqToPoint(e);if(s<r){const r=new Vector3;_ray.closestPointToPoint(e,r),r.applyMatrix4(n);const l=i.ray.origin.distanceTo(r);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:r,index:t,face:null,object:o})}}class MeshStandardMaterial extends Material{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function convertArray(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function getKeyframeOrder(e){const t=e.length,r=new Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort((function(t,r){return e[t]-e[r]})),r}function sortedArray(e,t,r){const n=e.length,i=new e.constructor(n);for(let a=0,o=0;o!==n;++a){const n=r[a]*t;for(let r=0;r!==t;++r)i[o++]=e[n+r]}return i}function flattenJSON(e,t,r,n){let i=1,a=e[0];for(;void 0!==a&&void 0===a[n];)a=e[i++];if(void 0===a)return;let o=a[n];if(void 0!==o)if(Array.isArray(o))do{o=a[n],void 0!==o&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[n],void 0!==o&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{o=a[n],void 0!==o&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}class Interpolant{constructor(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{let a;r:{n:if(!(e<n)){for(let a=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(i=n,n=t[++r],e<n)break t}a=t.length;break r}if(e>=i)break e;{const o=t[1];e<o&&(r=2,i=o);for(let a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(r===a)break;if(n=i,i=t[--r-1],e>=i)break t}a=r,r=0}}for(;r<a;){const n=r+a>>>1;e<t[n]?a=n:r=n+1}if(n=t[r],i=t[r-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n;for(let e=0;e!==n;++e)t[e]=r[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(e,t,r,n){super(e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(e,t,r){const n=this.parameterPositions;let i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:i=e,o=2*t-r;break;case WrapAroundEnding:i=n.length-2,o=t+n[i]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e,s=2*r-t;break;case WrapAroundEnding:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}const l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*u,this._offsetNext=a*u}interpolate_(e,t,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(r-t)/(n-t),p=f*f,m=p*f,g=-d*m+2*d*p-d*f,_=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*m+(1.5+h)*p+.5*f,v=h*m-h*p;for(let e=0;e!==o;++e)i[e]=g*a[u+e]+_*a[l+e]+y*a[s+e]+v*a[c+e];return i}}class LinearInterpolant extends Interpolant{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(r-t)/(n-t),c=1-u;for(let e=0;e!==o;++e)i[e]=a[l+e]*c+a[s+e]*u;return i}}class DiscreteInterpolant extends Interpolant{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=convertArray(t,this.TimeBufferType),this.values=convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:convertArray(e.times,Array),values:convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(r.interpolation=t)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,n=t.length;r!==n;++r)t[r]*=e}return this}trim(e,t){const r=this.times,n=r.length;let i=0,a=n-1;for(;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=r.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==i;t++){const n=r[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==a&&a>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,a),e=!1;break}a=n}if(void 0!==n&&isTypedArray(n))for(let t=0,r=n.length;t!==r;++t){const r=n[t];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,r),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===InterpolateSmooth,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(n)i=!0;else{const e=o*r,n=e-r,a=e+r;for(let o=0;o!==r;++o){const r=t[e+o];if(r!==t[n+o]||r!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const n=o*r,i=a*r;for(let e=0;e!==r;++e)t[i+e]=t[n+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*r,n=a*r,o=0;o!==r;++o)t[n+o]=t[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,r,n){super(e,t,r,n)}interpolate_(e,t,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(r-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)Quaternion.slerpFlat(i,0,a,l-o,a,l,s);return i}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,r,n=NormalAnimationBlendMode){this.name=e,this.tracks=r,this.duration=t,this.blendMode=n,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,n=1/(e.fps||1);for(let e=0,i=r.length;e!==i;++e)t.push(parseKeyframeTrack(r[e]).scale(n));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=r.length;e!==n;++e)t.push(KeyframeTrack.toJSON(r[e]));return n}static CreateFromMorphTargetSequence(e,t,r,n){const i=t.length,a=[];for(let e=0;e<i;e++){let o=[],s=[];o.push((e+i-1)%i,e,(e+1)%i),s.push(0,1,0);const l=getKeyframeOrder(o);o=sortedArray(o,1,l),s=sortedArray(s,1,l),n||0!==o[0]||(o.push(i),s.push(s[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[e].name+"]",o,s).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const n={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,r=e.length;t<r;t++){const r=e[t],a=r.name.match(i);if(a&&a.length>1){const e=a[1];let t=n[e];t||(n[e]=t=[]),t.push(r)}}const a=[];for(const e in n)a.push(this.CreateFromMorphTargetSequence(e,n[e],t,r));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(e,t,r,n,i){if(0!==r.length){const a=[],o=[];flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let r=0;r<i[t].morphTargets.length;r++)e[i[t].morphTargets[r]]=-1;for(const r in e){const e=[],a=[];for(let n=0;n!==i[t].morphTargets.length;++n){const n=i[t];e.push(n.time),a.push(n.morphTarget===r?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+r+"]",e,a))}s=e.length*a}else{const a=".bones["+t[e].name+"]";r(VectorKeyframeTrack,a+".position",i,"pos",n),r(QuaternionKeyframeTrack,a+".quaternion",i,"rot",n),r(VectorKeyframeTrack,a+".scale",i,"scl",n)}}return 0===n.length?null:new this(i,s,n,o)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(e.type);if(void 0===e.times){const t=[],r=[];flattenJSON(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,r){const n=this;let i,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===a&&void 0!==n.onStart&&n.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){const r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise((function(n,i){r.load(e,n,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(e,t){super(e),this.response=t}}class FileLoader extends Loader{constructor(e){super(e)}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Cache.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==loading[e])return void loading[e].push({onLoad:t,onProgress:r,onError:n});loading[e]=[],loading[e].push({onLoad:t,onProgress:r,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,s=this.responseType;fetch(a).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const r=loading[e],n=t.body.getReader(),i=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=i?parseInt(i):0,o=0!==a;let s=0;const l=new ReadableStream({start(e){!function t(){n.read().then((({done:n,value:i})=>{if(n)e.close();else{s+=i.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onProgress&&t.onProgress(n)}e.enqueue(i),t()}}))}()}});return new Response(l)}throw new HttpError(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),r=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(r);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{Cache.add(e,t);const r=loading[e];delete loading[e];for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{const r=loading[e];if(void 0===r)throw this.manager.itemError(e),t;delete loading[e];for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ImageLoader extends Loader{constructor(e){super(e)}load(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Cache.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const o=createElementNS("img");function s(){u(),Cache.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){u(),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,r,n){const i=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),r,n),i}}class Light extends Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*RAD2DEG*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class SpotLight extends Light{constructor(e,t,r=0,n=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=n,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,n=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(_lookTarget),r.updateMatrixWorld(),n.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(e,t,r=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class LoaderUtils{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ImageBitmapLoader extends Loader{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Cache.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(r){Cache.add(e,r),t&&t(r),i.manager.itemEnd(e)})).catch((function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(e,t,r){const n=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class PropertyBinding{constructor(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,r):new PropertyBinding(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(e){const t=_trackRe.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=r.nodeName.substring(n+1);-1!==_supportedObjectNames.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){const r=function(e){for(let n=0;n<e.length;n++){const i=e[n];if(i.name===t||i.uuid===t)return i;const a=r(i.children);if(a)return a}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)e[t++]=r[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,n=t.propertyName;let i=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let n=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const a=e[n];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite,PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);class GLTFLoader extends Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new GLTFMaterialsClearcoatExtension(e)})),this.register((function(e){return new GLTFTextureBasisUExtension(e)})),this.register((function(e){return new GLTFTextureWebPExtension(e)})),this.register((function(e){return new GLTFMaterialsSheenExtension(e)})),this.register((function(e){return new GLTFMaterialsTransmissionExtension(e)})),this.register((function(e){return new GLTFMaterialsVolumeExtension(e)})),this.register((function(e){return new GLTFMaterialsIorExtension(e)})),this.register((function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)})),this.register((function(e){return new GLTFMaterialsSpecularExtension(e)})),this.register((function(e){return new GLTFMaterialsIridescenceExtension(e)})),this.register((function(e){return new GLTFLightsExtension(e)})),this.register((function(e){return new GLTFMeshoptCompression(e)})),this.register((function(e){return new GLTFMeshGpuInstancing(e)}))}load(e,t,r,n){const i=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},s=new FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{i.parse(r,a,(function(r){t(r),i.manager.itemEnd(e)}),o)}catch(e){o(e)}}),r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let i;const a={},o={};if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(LoaderUtils.decodeText(new Uint8Array(e,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{a[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){return void(n&&n(e))}i=JSON.parse(a[EXTENSIONS.KHR_BINARY_GLTF].content)}else i=JSON.parse(LoaderUtils.decodeText(new Uint8Array(e)));else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const s=new GLTFParser(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});s.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](s);o[t.name]=t,a[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],r=i.extensionsRequired||[];switch(t){case EXTENSIONS.KHR_MATERIALS_UNLIT:a[t]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[t]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:a[t]=new GLTFDracoMeshCompressionExtension(i,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:a[t]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:a[t]=new GLTFMeshQuantizationExtension;break;default:r.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}s.setExtensions(a),s.setPlugins(o),s.parse(r,n)}parseAsync(e,t){const r=this;return new Promise((function(n,i){r.parse(e,t,n,i)}))}}function GLTFRegistry(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let n=t.cache.get(r);if(n)return n;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let o;const s=new Color(16777215);void 0!==a.color&&s.fromArray(a.color);const l=void 0!==a.range?a.range:0;switch(a.type){case"directional":o=new DirectionalLight(s),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new PointLight(s),o.distance=l;break;case"spot":o=new SpotLight(s),o.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,void 0!==a.intensity&&(o.intensity=a.intensity),o.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(o),t.cache.add(r,n),n}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return r._getNodeRef(t.cache,i,e)}))}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(e,t,r){const n=[];e.color=new Color(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture,sRGBEncoding))}return Promise.all(n)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Vector2(e,e)}return Promise.all(i)}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&i.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&i.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=n.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&i.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,sRGBEncoding)),void 0!==a.sheenRoughnessTexture&&i.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&i.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Color(o[0],o[1],o[2]),Promise.all(i)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],a=n.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&i.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Color(o[0],o[1],o[2]),void 0!==a.specularColorTexture&&i.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,sRGBEncoding)),Promise.all(i)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,a)}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const a=i.extensions[t],o=n.images[a.source];let s=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,a.source,s);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const r=e.count,n=e.byteStride,a=new Uint8Array(t,e.byteOffset||0,e.byteLength||0);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(r,n,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(r*n);return i.decodeGltfBuffer(new Uint8Array(t),r,n,a,e.mode,e.filter),t}))}))}return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const n=t.meshes[r.mesh];for(const e of n.primitives)if(e.mode!==WEBGL_CONSTANTS.TRIANGLES&&e.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&e.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&void 0!==e.mode)return null;const i=r.extensions[this.name].attributes,a=[],o={};for(const e in i)a.push(this.parser.getDependency("accessor",i[e]).then((t=>(o[e]=t,o[e]))));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then((e=>{const t=e.pop(),r=t.isGroup?t.children:[t],n=e[0].count,i=[];for(const e of r){const t=new Matrix4,r=new Vector3,a=new Quaternion,s=new Vector3(1,1,1),l=new InstancedMesh(e.geometry,e.material,n);for(let e=0;e<n;e++)o.TRANSLATION&&r.fromBufferAttribute(o.TRANSLATION,e),o.ROTATION&&a.fromBufferAttribute(o.ROTATION,e),o.SCALE&&s.fromBufferAttribute(o.SCALE,e),l.setMatrixAt(e,t.compose(r,a,s));for(const t in o)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,o[t]);Object3D.prototype.copy.call(l,e),l.frustumCulled=!1,this.parser.assignFinalMaterial(l),i.push(l)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(e){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,n=new DataView(e,BINARY_EXTENSION_HEADER_LENGTH);let i=0;for(;i<r;){const t=n.getUint32(i,!0);i+=4;const r=n.getUint32(i,!0);if(i+=4,r===BINARY_EXTENSION_CHUNK_TYPES.JSON){const r=new Uint8Array(e,BINARY_EXTENSION_HEADER_LENGTH+i,t);this.content=LoaderUtils.decodeText(r)}else if(r===BINARY_EXTENSION_CHUNK_TYPES.BIN){const r=BINARY_EXTENSION_HEADER_LENGTH+i;this.body=e.slice(r,r+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(const e in a){const t=ATTRIBUTES[e]||e.toLowerCase();o[t]=a[e]}for(const t in e.attributes){const n=ATTRIBUTES[t]||t.toLowerCase();if(void 0!==a[t]){const i=r.accessors[e.attributes[t]];l[n]=WEBGL_COMPONENT_TYPES[i.componentType].name,s[n]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=s[t];void 0!==r&&(e.attributes[t].normalized=r)}t(e)}),o,l)}))}))}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class GLTFMeshStandardSGMaterial extends MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class GLTFMaterialsPbrSpecularGlossinessExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return GLTFMeshStandardSGMaterial}extendParams(e,t,r){const n=t.extensions[this.name];e.color=new Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&i.push(r.assignTexture(e,"map",n.diffuseTexture,sRGBEncoding)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",t)),i.push(r.assignTexture(e,"specularMap",t,sRGBEncoding))}return Promise.all(i)}createMaterial(e){const t=new GLTFMeshStandardSGMaterial(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[i+e];return t}interpolate_(e,t,r,n){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=n-t,c=(r-t)/u,d=c*c,h=d*c,f=e*l,p=f-l,m=-2*h+3*d,g=h-d,_=1-m,y=g-d+c;for(let e=0;e!==o;e++)i[e]=_*a[p+e+o]+y*(a[p+e+s]*u)+m*a[f+e+o]+g*(a[f+e]*u);return i}}const _q=new Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,r,n){const i=super.interpolate_(e,t,r,n);return _q.fromArray(i).normalize().toArray(i),i}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),e.DefaultMaterial}function addUnknownExtensionsToUserData(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function assignExtrasToUserData(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function addMorphTargets(e,t,r){let n=!1,i=!1,a=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(i=!0),void 0!==r.COLOR_0&&(a=!0),n&&i&&a)break}if(!n&&!i&&!a)return Promise.resolve(e);const o=[],s=[],l=[];for(let u=0,c=t.length;u<c;u++){const c=t[u];if(n){const t=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}if(a){const t=void 0!==c.COLOR_0?r.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(l)]).then((function(t){const r=t[1],o=t[2];return n&&(e.morphAttributes.position=t[0]),i&&(e.morphAttributes.normal=r),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}function updateMorphTargets(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(e){const t=e.extensions&&e.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+createAttributesKey(t.attributes):e.indices+":"+createAttributesKey(e.attributes)+":"+e.mode,r}function createAttributesKey(e){let t="";const r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;this.textureLoader="undefined"==typeof createImageBitmap||r||n&&i<98?new TextureLoader(this.options.manager):new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};addUnknownExtensionsToUserData(i,a,n),assignExtrasToUserData(a,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone(),i=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[r,n]of e.children.entries())i(n,t.children[r])};return i(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&r.push(i)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,i){r.load(LoaderUtils.resolveURL(t.uri,n.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteOffset||0;return e.slice(r,r+(t.byteLength||0))}))}loadAccessor(e){const t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const i=[];return i.push(void 0!==n.bufferView?this.getDependency("bufferView",n.bufferView):null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],a=WEBGL_TYPE_SIZES[n.type],o=WEBGL_COMPONENT_TYPES[n.componentType],s=o.BYTES_PER_ELEMENT,l=n.byteOffset||0,u=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,c=!0===n.normalized;let d,h;if(u&&u!==s*a){const e=Math.floor(l/u),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let f=t.cache.get(r);f||(d=new o(i,e*u,n.count*u/s),f=new InterleavedBuffer(d,u/s),t.cache.add(r,f)),h=new InterleavedBufferAttribute(f,a,l%u/s,c)}else d=null===i?new o(n.count*a):new o(i,l,n.count*a),h=new BufferAttribute(d,a,c);if(void 0!==n.sparse){const t=n.sparse.values.byteOffset||0,r=new(0,WEBGL_COMPONENT_TYPES[n.sparse.indices.componentType])(e[1],n.sparse.indices.byteOffset||0,n.sparse.count*WEBGL_TYPE_SIZES.SCALAR),s=new o(e[2],t,n.sparse.count*a);null!==i&&(h=new BufferAttribute(h.array.slice(),h.itemSize,h.normalized));for(let e=0,t=r.length;e<t;e++){const t=r[e];if(h.setX(t,s[e*a]),a>=2&&h.setY(t,s[e*a+1]),a>=3&&h.setZ(t,s[e*a+2]),a>=4&&h.setW(t,s[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return h}))}loadTexture(e){const t=this.json,r=t.textures[e].source,n=t.images[r];let i=this.textureLoader;if(n.uri){const e=this.options.manager.getHandler(n.uri);null!==e&&(i=e)}return this.loadTextureImage(e,r,i)}loadTextureImage(e,t,r){const n=this,i=this.json,a=i.textures[e],o=i.images[t],s=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];const l=this.loadImageSource(t,r).then((function(t){t.flipY=!1,t.name=a.name||o.name||"";const r=(i.samplers||{})[a.sampler]||{};return t.magFilter=WEBGL_FILTERS[r.magFilter]||LinearFilter,t.minFilter=WEBGL_FILTERS[r.minFilter]||LinearMipmapLinearFilter,t.wrapS=WEBGL_WRAPPINGS[r.wrapS]||RepeatWrapping,t.wrapT=WEBGL_WRAPPINGS[r.wrapT]||RepeatWrapping,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[s]=l,l}loadImageSource(e,t){const r=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=r.images[e],a=self.URL||self.webkitURL;let o=i.uri||"",s=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(e){s=!0;const t=new Blob([e],{type:i.mimeType});return o=a.createObjectURL(t),o}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(r,i){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){const t=new Texture(e);t.needsUpdate=!0,r(t)}),t.load(LoaderUtils.resolveURL(e,n.path),a,void 0,i)}))})).then((function(e){return!0===s&&a.revokeObjectURL(o),e.userData.mimeType=i.mimeType||getImageURIMimeType(i.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,r,n){const i=this;return this.getDependency("texture",r.index).then((function(a){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(a);a=i.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),i.associations.set(a,t)}}return void 0!==n&&(a.encoding=n),e[t]=a,a}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const n=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new PointsMaterial,Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new LineBasicMaterial,Material.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(n||i||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),i&&(t.vertexColors=!0),a&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return MeshStandardMaterial}loadMaterial(e){const t=this,r=this.extensions,n=this.json.materials[e];let i;const a={},o=n.extensions||{},s=[];if(o[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=e.getMaterialType(),s.push(e.extendParams(a,n,t))}else if(o[EXTENSIONS.KHR_MATERIALS_UNLIT]){const e=r[EXTENSIONS.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),s.push(e.extendParams(a,n,t))}else{const r=n.pbrMetallicRoughness||{};if(a.color=new Color(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==r.baseColorTexture&&s.push(t.assignTexture(a,"map",r.baseColorTexture,sRGBEncoding)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(s.push(t.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),s.push(t.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),i=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),s.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===n.doubleSided&&(a.side=DoubleSide);const l=n.alphaMode||ALPHA_MODES.OPAQUE;if(l===ALPHA_MODES.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===ALPHA_MODES.MASK&&(a.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&i!==MeshBasicMaterial&&(s.push(t.assignTexture(a,"normalMap",n.normalTexture)),a.normalScale=new Vector2(1,1),void 0!==n.normalTexture.scale)){const e=n.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==n.occlusionTexture&&i!==MeshBasicMaterial&&(s.push(t.assignTexture(a,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(a.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&i!==MeshBasicMaterial&&(a.emissive=(new Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&i!==MeshBasicMaterial&&s.push(t.assignTexture(a,"emissiveMap",n.emissiveTexture,sRGBEncoding)),Promise.all(s).then((function(){let o;return o=i===GLTFMeshStandardSGMaterial?r[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new i(a),n.name&&(o.name=n.name),assignExtrasToUserData(o,n),t.associations.set(o,{materials:e}),n.extensions&&addUnknownExtensionsToUserData(r,o,n),o}))}createUniqueName(e){const t=PropertyBinding.sanitizeNodeName(e||"");let r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,n=this.primitiveCache;function i(e){return r[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return addPrimitiveAttributes(r,e,t)}))}const a=[];for(let r=0,o=e.length;r<o;r++){const o=e[r],s=createPrimitiveKey(o),l=n[s];if(l)a.push(l.promise);else{let e;e=o.extensions&&o.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?i(o):addPrimitiveAttributes(new BufferGeometry,o,t),n[s]={primitive:o,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,r=this.extensions,n=this.json.meshes[e],i=n.primitives,a=[];for(let e=0,t=i.length;e<t;e++){const t=void 0===i[e].material?createDefaultMaterial(this.cache):this.getDependency("material",i[e].material);a.push(t)}return a.push(t.loadGeometries(i)),Promise.all(a).then((function(a){const o=a.slice(0,a.length-1),s=a[a.length-1],l=[];for(let a=0,u=s.length;a<u;a++){const u=s[a],c=i[a];let d;const h=o[a];if(c.mode===WEBGL_CONSTANTS.TRIANGLES||c.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||c.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===c.mode)d=!0===n.isSkinnedMesh?new SkinnedMesh(u,h):new Mesh(u,h),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),c.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?d.geometry=toTrianglesDrawMode(d.geometry,TriangleStripDrawMode):c.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(d.geometry=toTrianglesDrawMode(d.geometry,TriangleFanDrawMode));else if(c.mode===WEBGL_CONSTANTS.LINES)d=new LineSegments(u,h);else if(c.mode===WEBGL_CONSTANTS.LINE_STRIP)d=new Line(u,h);else if(c.mode===WEBGL_CONSTANTS.LINE_LOOP)d=new LineLoop(u,h);else{if(c.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new Points(u,h)}Object.keys(d.geometry.morphAttributes).length>0&&updateMorphTargets(d,n),d.name=t.createUniqueName(n.name||"mesh_"+e),assignExtrasToUserData(d,n),c.extensions&&addUnknownExtensionsToUserData(r,d,c),t.assignFinalMaterial(d),l.push(d)}for(let r=0,n=l.length;r<n;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return l[0];const u=new Group;t.associations.set(u,{meshes:e});for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u}))}loadCamera(e){let t;const r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new PerspectiveCamera(MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),assignExtrasToUserData(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))}loadAnimation(e){const t=this.json.animations[e],r=[],n=[],i=[],a=[],o=[];for(let e=0,s=t.channels.length;e<s;e++){const s=t.channels[e],l=t.samplers[s.sampler],u=s.target,c=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;r.push(this.getDependency("node",u.node)),n.push(this.getDependency("accessor",c)),i.push(this.getDependency("accessor",d)),a.push(l),o.push(u)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(r){const n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=i[e],u=a[e],c=o[e],d=s[e];if(void 0===t)continue;let h;switch(t.updateMatrix(),PATH_PROPERTIES[d.path]){case PATH_PROPERTIES.weights:h=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:h=QuaternionKeyframeTrack;break;default:h=VectorKeyframeTrack}const f=t.name?t.name:t.uuid,p=void 0!==c.interpolation?INTERPOLATION[c.interpolation]:InterpolateLinear,m=[];PATH_PROPERTIES[d.path]===PATH_PROPERTIES.weights?t.traverse((function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(f);let g=u.array;if(u.normalized){const e=getNormalizedComponentScale(g.constructor),t=new Float32Array(g.length);for(let r=0,n=g.length;r<n;r++)t[r]=g[r]*e;g=t}for(let e=0,t=m.length;e<t;e++){const t=new h(m[e]+"."+PATH_PROPERTIES[d.path],r.array,g,p);"CUBICSPLINE"===c.interpolation&&(t.createInterpolant=function(e){return new(this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}return new AnimationClip(t.name?t.name:"animation_"+e,void 0,l)}))}createNodeMesh(e){const t=this,r=this.json.nodes[e];return void 0===r.mesh?null:t.getDependency("mesh",r.mesh).then((function(e){const n=t._getNodeRef(t.meshCache,r.mesh,e);return void 0!==r.weights&&n.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),n}))}loadNode(e){const t=this.extensions,r=this,n=this.json.nodes[e],i=n.name?r.createUniqueName(n.name):"";return function(){const t=[],i=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return i&&t.push(i),void 0!==n.camera&&t.push(r.getDependency("camera",n.camera).then((function(e){return r._getNodeRef(r.cameraCache,n.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(a){let o;if(o=!0===n.isBone?new Bone:a.length>1?new Group:1===a.length?a[0]:new Object3D,o!==a[0])for(let e=0,t=a.length;e<t;e++)o.add(a[e]);if(n.name&&(o.userData.name=n.name,o.name=i),assignExtrasToUserData(o,n),n.extensions&&addUnknownExtensionsToUserData(t,o,n),void 0!==n.matrix){const e=new Matrix4;e.fromArray(n.matrix),o.applyMatrix4(e)}else void 0!==n.translation&&o.position.fromArray(n.translation),void 0!==n.rotation&&o.quaternion.fromArray(n.rotation),void 0!==n.scale&&o.scale.fromArray(n.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,r=this.extensions,n=this.json.scenes[e],i=this,a=new Group;n.name&&(a.name=i.createUniqueName(n.name)),assignExtrasToUserData(a,n),n.extensions&&addUnknownExtensionsToUserData(r,a,n);const o=n.nodes||[],s=[];for(let e=0,r=o.length;e<r;e++)s.push(buildNodeHierarchy(o[e],a,t,i));return Promise.all(s).then((function(){return i.associations=(e=>{const t=new Map;for(const[e,r]of i.associations)(e instanceof Material||e instanceof Texture)&&t.set(e,r);return e.traverse((e=>{const r=i.associations.get(e);null!=r&&t.set(e,r)})),t})(a),a}))}}function buildNodeHierarchy(e,t,r,n){const i=r.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===i.skin)return e;let t;return n.getDependency("skin",i.skin).then((function(e){t=e;const r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(n.getDependency("node",t.joints[e]));return Promise.all(r)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const n=[],i=[];for(let e=0,a=r.length;e<a;e++){const a=r[e];if(a){n.push(a);const r=new Matrix4;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*e),i.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new Skeleton(n,i),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const a=[];if(i.children){const t=i.children;for(let i=0,o=t.length;i<o;i++)a.push(buildNodeHierarchy(t[i],e,r,n))}return Promise.all(a)}))}function computeBounds(e,t,r){const n=t.attributes,i=new Box3;if(void 0===n.POSITION)return;{const e=r.json.accessors[n.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new Vector3(t[0],t[1],t[2]),new Vector3(a[0],a[1],a[2])),e.normalized){const t=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new Vector3,t=new Vector3;for(let n=0,i=a.length;n<i;n++){const i=a[n];if(void 0!==i.POSITION){const n=r.json.accessors[i.POSITION],a=n.min,o=n.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),n.normalized){const e=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const o=new Sphere;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=o}function addPrimitiveAttributes(e,t,r){const n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const r=ATTRIBUTES[t]||t.toLowerCase();r in e.attributes||i.push(a(n[t],r))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(n)}return assignExtrasToUserData(e,t),computeBounds(e,t,r),Promise.all(i).then((function(){return void 0!==t.targets?addMorphTargets(e,t.targets,r):e}))}function toTrianglesDrawMode(e,t){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,i=[];if(t===TriangleFanDrawMode)for(let e=1;e<=n;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(i),a}class Model3DLayer{constructor(e){if(!e)throw new Error("parameters missing for mapbox 3D model layer");if(!e.id)throw new Error("id parameter missing for mapbox 3D model layer");if(!e.url)throw new Error("url parameter missing for mapbox 3D model layer");if(!e.modelTransform)throw new Error("modelTransform parameter missing for mapbox 3D model layer");this.id=e.id,this.url=e.url,this.modelTransform=e.modelTransform,this.type="custom",this.renderingMode="3d"}onAdd(e,t){this.camera=new Camera,this.scene=new Scene;const r=new DirectionalLight(16777215);r.position.set(0,-70,100).normalize(),this.scene.add(r);const n=new DirectionalLight(16777215);n.position.set(0,70,100).normalize(),this.scene.add(n),(new GLTFLoader).load(this.url,(e=>{this.scene.add(e.scene)})),this.map=e,this.renderer=new WebGLRenderer({canvas:e.getCanvas(),context:t,antialias:!0}),this.renderer.autoClear=!1}render(e,t){const r=(new Matrix4).makeRotationAxis(new Vector3(1,0,0),this.modelTransform.rotateX),n=(new Matrix4).makeRotationAxis(new Vector3(0,1,0),this.modelTransform.rotateY),i=(new Matrix4).makeRotationAxis(new Vector3(0,0,1),this.modelTransform.rotateZ),a=(new Matrix4).fromArray(t),o=(new Matrix4).makeTranslation(this.modelTransform.translateX,this.modelTransform.translateY,this.modelTransform.translateZ).scale(new Vector3(this.modelTransform.scale,-this.modelTransform.scale,this.modelTransform.scale)).multiply(r).multiply(n).multiply(i);this.camera.projectionMatrix=a.multiply(o),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint()}}var mapboxGlDraw={exports:{}};!function(e,t){e.exports=function(){var e=function(e,t){var r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on:function(e,t,n){if(void 0===r[e])throw new Error("Invalid event type: "+e);r[e].push({selector:t,fn:n})},render:function(e){t.store.featureChanged(e)}},i=function(e,i){for(var a=r[e],o=a.length;o--;){var s=a[o];if(s.selector(i)){s.fn.call(n,i)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){i("drag",e)},click:function(e){i("click",e)},mousemove:function(e){i("mousemove",e)},mousedown:function(e){i("mousedown",e)},mouseup:function(e){i("mouseup",e)},mouseout:function(e){i("mouseout",e)},keydown:function(e){i("keydown",e)},keyup:function(e){i("keyup",e)},touchstart:function(e){i("touchstart",e)},touchmove:function(e){i("touchmove",e)},touchend:function(e){i("touchend",e)},tap:function(e){i("tap",e)}}};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r={},n={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function i(e){var t=0;if(e&&e.length>0){t+=Math.abs(a(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(a(e[r]))}return t}function a(e){var t,r,i,a,s,l,u=0,c=e.length;if(c>2){for(l=0;l<c;l++)l===c-2?(i=c-2,a=c-1,s=0):l===c-1?(i=c-1,a=0,s=1):(i=l,a=l+1,s=l+2),t=e[i],r=e[a],u+=(o(e[s][0])-o(t[0]))*Math.sin(o(r[1]));u=u*n.RADIUS*n.RADIUS/2}return u}function o(e){return e*Math.PI/180}r.geometry=function e(t){var r,n=0;switch(t.type){case"Polygon":return i(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)n+=i(t.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)n+=e(t.geometries[r]);return n}},r.ring=a;var s={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},l={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},u={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},c={POLYGON:"polygon",LINE:"line_string",POINT:"point"},d={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},h={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},f={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},p={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},m={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},g={ACTIVE:"true",INACTIVE:"false"},_=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],y=-85,v=Object.freeze({__proto__:null,classes:s,sources:l,cursors:u,types:c,geojsonTypes:d,modes:h,events:f,updateActions:p,meta:m,activeStates:g,interactions:_,LAT_MIN:-90,LAT_RENDERED_MIN:y,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),b={Point:0,LineString:1,MultiLineString:1,Polygon:2};function x(e,t){var r=b[e.geometry.type]-b[t.geometry.type];return 0===r&&e.geometry.type===d.POLYGON?e.area-t.area:r}function T(e){return e.map((function(e){return e.geometry.type===d.POLYGON&&(e.area=r.geometry({type:d.FEATURE,property:{},geometry:e.geometry})),e})).sort(x).map((function(e){return delete e.area,e}))}function w(e,t){return void 0===t&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function E(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,r=e.length;t<r;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}E.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},E.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},E.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},E.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach((function(r){t.push({k:r,v:e._items[r]})})),Object.keys(this._nums).forEach((function(r){t.push({k:JSON.parse(r),v:e._nums[r]})})),t.sort((function(e,t){return e.v-t.v})).map((function(e){return e.k}))},E.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var A=[m.FEATURE,m.MIDPOINT,m.VERTEX],S={click:function(e,t,r){return P(e,t,r,r.options.clickBuffer)},touch:function(e,t,r){return P(e,t,r,r.options.touchBuffer)}};function P(e,t,r,n){if(null===r.map)return[];var i=e?w(e,n):t,a={};r.options.styles&&(a.layers=r.options.styles.map((function(e){return e.id})).filter((function(e){return null!=r.map.getLayer(e)})));var o=r.map.queryRenderedFeatures(i,a).filter((function(e){return-1!==A.indexOf(e.properties.meta)})),s=new E,l=[];return o.forEach((function(e){var t=e.properties.id;s.has(t)||(s.add(t),l.push(e))})),T(l)}function M(e,t){var r=S.click(e,null,t),n={mouse:u.NONE};return r[0]&&(n.mouse=r[0].properties.active===g.ACTIVE?u.MOVE:u.POINTER,n.feature=r[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(n.mouse=u.ADD),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),r[0]}function R(e,t){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function C(e,t,r){void 0===r&&(r={});var n=null!=r.fineTolerance?r.fineTolerance:4,i=null!=r.grossTolerance?r.grossTolerance:12,a=null!=r.interval?r.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var o=R(e.point,t.point);return o<n||o<i&&t.time-e.time<a}function O(e,t,r){void 0===r&&(r={});var n=null!=r.tolerance?r.tolerance:25,i=null!=r.interval?r.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,R(e.point,t.point)<n&&t.time-e.time<i}var L={exports:{}},I=L.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var r=Math.log(Math.pow(2,e))/Math.log(t),n=2;r===1/0;n*=2)r=Math.log(Math.pow(2,e/n))/Math.log(t)*n;var i=r-Math.floor(r),a="";for(n=0;n<Math.floor(r);n++)a=Math.floor(Math.random()*t).toString(t)+a;if(i){var o=Math.pow(t,i);a=Math.floor(Math.random()*o).toString(t)+a}var s=parseInt(a,t);return s!==1/0&&s>=Math.pow(2,e)?I(e,t):a};I.rack=function(e,t,r){var n=function(n){var a=0;do{if(a++>10){if(!r)throw new Error("too many ID collisions, use more bits");e+=r}var o=I(e,t)}while(Object.hasOwnProperty.call(i,o));return i[o]=n,o},i=n.hats={};return n.get=function(e){return n.hats[e]},n.set=function(e,t){return n.hats[e]=t,n},n.bits=e||128,n.base=t||16,n};var D=t(L.exports),k=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||D(),this.type=t.geometry.type};k.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},k.prototype.incomingCoords=function(e){this.setCoordinates(e)},k.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},k.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},k.prototype.setProperty=function(e,t){this.properties[e]=t},k.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:d.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},k.prototype.internal=function(e){var t={id:this.id,meta:m.FEATURE,"meta:type":this.type,active:g.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var r in this.properties)t["user_"+r]=this.properties[r];return{type:d.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var B=function(e,t){k.call(this,e,t)};(B.prototype=Object.create(k.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},B.prototype.updateCoordinate=function(e,t,r){this.coordinates=3===arguments.length?[t,r]:[e,t],this.changed()},B.prototype.getCoordinate=function(){return this.getCoordinates()};var F=function(e,t){k.call(this,e,t)};(F.prototype=Object.create(k.prototype)).isValid=function(){return this.coordinates.length>1},F.prototype.addCoordinate=function(e,t,r){this.changed();var n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])},F.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},F.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},F.prototype.updateCoordinate=function(e,t,r){var n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};var N=function(e,t){k.call(this,e,t),this.coordinates=this.coordinates.map((function(e){return e.slice(0,-1)}))};(N.prototype=Object.create(k.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(e){return e.length>2}))},N.prototype.incomingCoords=function(e){this.coordinates=e.map((function(e){return e.slice(0,-1)})),this.changed()},N.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},N.prototype.addCoordinate=function(e,t,r){this.changed();var n=e.split(".").map((function(e){return parseInt(e,10)}));this.coordinates[n[0]].splice(n[1],0,[t,r])},N.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map((function(e){return parseInt(e,10)})),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))},N.prototype.getCoordinate=function(e){var t=e.split(".").map((function(e){return parseInt(e,10)}));return JSON.parse(JSON.stringify(this.coordinates[t[0]][t[1]]))},N.prototype.getCoordinates=function(){return this.coordinates.map((function(e){return e.concat([e[0]])}))},N.prototype.updateCoordinate=function(e,t,r){this.changed();var n=e.split("."),i=parseInt(n[0],10),a=parseInt(n[1],10);void 0===this.coordinates[i]&&(this.coordinates[i]=[]),this.coordinates[i][a]=[t,r]};var q={MultiPoint:B,MultiLineString:F,MultiPolygon:N},U=function(e,t,r,n,i){var a=r.split("."),o=parseInt(a[0],10),s=a[1]?a.slice(1).join("."):null;return e[o][t](s,n,i)},j=function(e,t){if(k.call(this,e,t),delete this.coordinates,this.model=q[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function G(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(j.prototype=Object.create(k.prototype))._coordinatesToFeatures=function(e){var t=this,r=this.model.bind(this);return e.map((function(e){return new r(t.ctx,{id:D(),type:d.FEATURE,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})}))},j.prototype.isValid=function(){return this.features.every((function(e){return e.isValid()}))},j.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},j.prototype.getCoordinate=function(e){return U(this.features,"getCoordinate",e)},j.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(e){return e.type===d.POLYGON?e.getCoordinates():e.coordinates}))))},j.prototype.updateCoordinate=function(e,t,r){U(this.features,"updateCoordinate",e,t,r),this.changed()},j.prototype.addCoordinate=function(e,t,r){U(this.features,"addCoordinate",e,t,r),this.changed()},j.prototype.removeCoordinate=function(e){U(this.features,"removeCoordinate",e),this.changed()},j.prototype.getFeatures=function(){return this.features},G.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},G.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce((function(e,r){return void 0===e[r.feature_id]&&(e[r.feature_id]=!0,t._ctx.store.get(r.feature_id).changed()),e}),{})},G.prototype.getSelected=function(){return this._ctx.store.getSelected()},G.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},G.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},G.prototype.getFeature=function(e){return this._ctx.store.get(e)},G.prototype.select=function(e){return this._ctx.store.select(e)},G.prototype.deselect=function(e){return this._ctx.store.deselect(e)},G.prototype.deleteFeature=function(e,t){return void 0===t&&(t={}),this._ctx.store.delete(e,t)},G.prototype.addFeature=function(e){return this._ctx.store.add(e)},G.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},G.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},G.prototype.setActionableState=function(e){return void 0===e&&(e={}),this._ctx.events.actionable({trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1})},G.prototype.changeMode=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),this._ctx.events.changeMode(e,t,r)},G.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},G.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},G.prototype.featuresAt=function(e,t,r){if(void 0===r&&(r="click"),"click"!==r&&"touch"!==r)throw new Error("invalid buffer type");return S[r](e,t,this._ctx)},G.prototype.newFeature=function(e){var t=e.geometry.type;return t===d.POINT?new B(this._ctx,e):t===d.LINE_STRING?new F(this._ctx,e):t===d.POLYGON?new N(this._ctx,e):new j(this._ctx,e)},G.prototype.isInstanceOf=function(e,t){if(e===d.POINT)return t instanceof B;if(e===d.LINE_STRING)return t instanceof F;if(e===d.POLYGON)return t instanceof N;if("MultiFeature"===e)return t instanceof j;throw new Error("Unknown feature class: "+e)},G.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},G.prototype.onSetup=function(){},G.prototype.onDrag=function(){},G.prototype.onClick=function(){},G.prototype.onMouseMove=function(){},G.prototype.onMouseDown=function(){},G.prototype.onMouseUp=function(){},G.prototype.onMouseOut=function(){},G.prototype.onKeyUp=function(){},G.prototype.onKeyDown=function(){},G.prototype.onTouchStart=function(){},G.prototype.onTouchMove=function(){},G.prototype.onTouchEnd=function(){},G.prototype.onTap=function(){},G.prototype.onStop=function(){},G.prototype.onTrash=function(){},G.prototype.onCombineFeature=function(){},G.prototype.onUncombineFeature=function(){},G.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var z={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},V=Object.keys(z);function $(e){return[].concat(e).filter((function(e){return void 0!==e}))}function H(){var e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(l.HOT))return u();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var r=[],n=[];e.isDirty?n=e.getAllIds():(r=e.getChangedIds().filter((function(t){return void 0!==e.get(t)})),n=e.sources.hot.filter((function(t){return t.properties.id&&-1===r.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)})).map((function(e){return e.properties.id}))),e.sources.hot=[];var i=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter((function(e){return-1===r.indexOf(e.properties.id||e.properties.parent)}));var a=i!==e.sources.cold.length||n.length>0;function o(r,n){var i=e.get(r).internal(t);e.ctx.events.currentModeRender(i,(function(t){e.sources[n].push(t)}))}if(r.forEach((function(e){return o(e,"hot")})),n.forEach((function(e){return o(e,"cold")})),a&&e.ctx.map.getSource(l.COLD).setData({type:d.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(l.HOT).setData({type:d.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(f.SELECTION_CHANGE,{features:e.getSelected().map((function(e){return e.toGeoJSON()})),points:e.getSelectedCoordinates().map((function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e.coordinates}}}))}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var s=e._deletedFeaturesToEmit.map((function(e){return e.toGeoJSON()}));e._deletedFeaturesToEmit=[],e.ctx.map.fire(f.DELETE,{features:s})}function u(){e.isDirty=!1,e.clearChangedIds()}u(),e.ctx.map.fire(f.RENDER,{})}function W(e){var t,r=this;this._features={},this._featureIds=new E,this._selectedFeatureIds=new E,this._selectedCoordinates=[],this._changedFeatureIds=new E,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame((function(){t=null,H.call(r)})))},this.isDirty=!1}function X(e,t){var r=e._selectedCoordinates.filter((function(t){return e._selectedFeatureIds.has(t.feature_id)}));e._selectedCoordinates.length===r.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=r}W.prototype.createRenderBatch=function(){var e=this,t=this.render,r=0;return this.render=function(){r++},function(){e.render=t,r>0&&e.render()}},W.prototype.setDirty=function(){return this.isDirty=!0,this},W.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},W.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},W.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},W.prototype.getAllIds=function(){return this._featureIds.values()},W.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},W.prototype.delete=function(e,t){var r=this;return void 0===t&&(t={}),$(e).forEach((function(e){r._featureIds.has(e)&&(r._featureIds.delete(e),r._selectedFeatureIds.delete(e),t.silent||-1===r._deletedFeaturesToEmit.indexOf(r._features[e])&&r._deletedFeaturesToEmit.push(r._features[e]),delete r._features[e],r.isDirty=!0)})),X(this,t),this},W.prototype.get=function(e){return this._features[e]},W.prototype.getAll=function(){var e=this;return Object.keys(this._features).map((function(t){return e._features[t]}))},W.prototype.select=function(e,t){var r=this;return void 0===t&&(t={}),$(e).forEach((function(e){r._selectedFeatureIds.has(e)||(r._selectedFeatureIds.add(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))})),this},W.prototype.deselect=function(e,t){var r=this;return void 0===t&&(t={}),$(e).forEach((function(e){r._selectedFeatureIds.has(e)&&(r._selectedFeatureIds.delete(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))})),X(this,t),this},W.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},W.prototype.setSelected=function(e,t){var r=this;return void 0===t&&(t={}),e=$(e),this.deselect(this._selectedFeatureIds.values().filter((function(t){return-1===e.indexOf(t)})),{silent:t.silent}),this.select(e.filter((function(e){return!r._selectedFeatureIds.has(e)})),{silent:t.silent}),this},W.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},W.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},W.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},W.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map((function(t){return e.get(t)}))},W.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map((function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}}))},W.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},W.prototype.setFeatureProperty=function(e,t,r){this.get(e).setProperty(t,r),this.featureChanged(e)},W.prototype.storeMapConfig=function(){var e=this;_.forEach((function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())}))},W.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach((function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()}))},W.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};var Y=Object.prototype.hasOwnProperty,Z=t((function(){for(var e=arguments,t={},r=0;r<arguments.length;r++){var n=e[r];for(var i in n)Y.call(n,i)&&(t[i]=n[i])}return t})),K=["mode","feature","mouse"];function J(t){var r=null,n=null,i={onRemove:function(){return t.map.off("load",i.connect),clearInterval(n),i.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,r&&r.parentNode&&r.parentNode.removeChild(r),r=null,this},connect:function(){t.map.off("load",i.connect),clearInterval(n),i.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(a){var o=a.fire;return a.fire=function(e,t){var r=arguments;return 1===o.length&&1!==arguments.length&&(r=[Z({},{type:e},t)]),o.apply(a,r)},t.map=a,t.events=function(t){var r=Object.keys(t.options.modes).reduce((function(e,r){return e[r]=function(e){var t=Object.keys(e);return function(r,n){void 0===n&&(n={});var i={},a=t.reduce((function(t,r){return t[r]=e[r],t}),new G(r));return{start:function(){var t=this;i=a.onSetup(n),V.forEach((function(r){var n,o=z[r],s=function(){return!1};e[o]&&(s=function(){return!0}),t.on(r,s,(n=o,function(e){return a[n](i,e)}))}))},stop:function(){a.onStop(i)},trash:function(){a.onTrash(i)},combineFeatures:function(){a.onCombineFeatures(i)},uncombineFeatures:function(){a.onUncombineFeatures(i)},render:function(e,t){a.toDisplayFeatures(i,e,t)}}}}(t.options.modes[r]),e}),{}),n={},i={},a={},o=null,s=null;a.drag=function(e,r){r({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:u.DRAG}),s.drag(e)):e.originalEvent.stopPropagation()},a.mousedrag=function(e){a.drag(e,(function(e){return!C(n,e)}))},a.touchdrag=function(e){a.drag(e,(function(e){return!O(i,e)}))},a.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return a.mousedrag(e);var r=M(e,t);e.featureTarget=r,s.mousemove(e)},a.mousedown=function(e){n={time:(new Date).getTime(),point:e.point};var r=M(e,t);e.featureTarget=r,s.mousedown(e)},a.mouseup=function(e){var r=M(e,t);e.featureTarget=r,C(n,{point:e.point,time:(new Date).getTime()})?s.click(e):s.mouseup(e)},a.mouseout=function(e){s.mouseout(e)},a.touchstart=function(e){if(t.options.touchEnabled){i={time:(new Date).getTime(),point:e.point};var r=S.touch(e,null,t)[0];e.featureTarget=r,s.touchstart(e)}},a.touchmove=function(e){if(t.options.touchEnabled)return s.touchmove(e),a.touchdrag(e)},a.touchend=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled){var r=S.touch(e,null,t)[0];e.featureTarget=r,O(i,{time:(new Date).getTime(),point:e.point})?s.tap(e):s.touchend(e)}};var l=function(e){return!(8===e||46===e||e>=48&&e<=57)};function c(n,i,a){void 0===a&&(a={}),s.stop();var l=r[n];if(void 0===l)throw new Error(n+" is not valid");o=n;var u=l(t,i);s=e(u,t),a.silent||t.map.fire(f.MODE_CHANGE,{mode:n}),t.store.setDirty(),t.store.render()}a.keydown=function(e){(e.srcElement||e.target).classList.contains("mapboxgl-canvas")&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?l(e.keyCode)?s.keydown(e):49===e.keyCode&&t.options.controls.point?c(h.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?c(h.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&c(h.DRAW_POLYGON):(e.preventDefault(),s.trash()))},a.keyup=function(e){l(e.keyCode)&&s.keyup(e)},a.zoomend=function(){t.store.changeZoom()},a.data=function(e){if("style"===e.dataType){var r=t.setup,n=t.map,i=t.store;t.options.styles.some((function(e){return n.getLayer(e.id)}))||(r.addLayers(),i.setDirty(),i.render())}};var d={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=e(r[o=t.options.defaultMode](t),t)},changeMode:c,actionable:function(e){var r=!1;Object.keys(e).forEach((function(t){if(void 0===d[t])throw new Error("Invalid action type");d[t]!==e[t]&&(r=!0),d[t]=e[t]})),r&&t.map.fire(f.ACTIONABLE,{actions:d})},currentModeName:function(){return o},currentModeRender:function(e,t){return s.render(e,t)},fire:function(e,t){a[e]&&a[e](t)},addEventListeners:function(){t.map.on("mousemove",a.mousemove),t.map.on("mousedown",a.mousedown),t.map.on("mouseup",a.mouseup),t.map.on("data",a.data),t.map.on("touchmove",a.touchmove),t.map.on("touchstart",a.touchstart),t.map.on("touchend",a.touchend),t.container.addEventListener("mouseout",a.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",a.keydown),t.container.addEventListener("keyup",a.keyup))},removeEventListeners:function(){t.map.off("mousemove",a.mousemove),t.map.off("mousedown",a.mousedown),t.map.off("mouseup",a.mouseup),t.map.off("data",a.data),t.map.off("touchmove",a.touchmove),t.map.off("touchstart",a.touchstart),t.map.off("touchend",a.touchend),t.container.removeEventListener("mouseout",a.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",a.keydown),t.container.removeEventListener("keyup",a.keyup))},trash:function(e){s.trash(e)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return o}}}(t),t.ui=function(e){var t={},r=null,n={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function a(e){i=Z(i,e)}function o(){var t,r;if(e.container){var a=[],o=[];K.forEach((function(e){i[e]!==n[e]&&(a.push(e+"-"+n[e]),null!==i[e]&&o.push(e+"-"+i[e]))})),a.length>0&&(t=e.container.classList).remove.apply(t,a),o.length>0&&(r=e.container.classList).add.apply(r,o),n=Z(n,i)}}function l(e,t){void 0===t&&(t={});var n=document.createElement("button");return n.className=s.CONTROL_BUTTON+" "+t.className,n.setAttribute("title",t.title),t.container.appendChild(n),n.addEventListener("click",(function(n){if(n.preventDefault(),n.stopPropagation(),n.target===r)return u(),void t.onDeactivate();d(e),t.onActivate()}),!0),n}function u(){r&&(r.classList.remove(s.ACTIVE_BUTTON),r=null)}function d(e){u();var n=t[e];n&&n&&"trash"!==e&&(n.classList.add(s.ACTIVE_BUTTON),r=n)}return{setActiveButton:d,queueMapClasses:a,updateMapClasses:o,clearMapClasses:function(){a({mode:null,feature:null,mouse:null}),o()},addButtons:function(){var r=e.options.controls,n=document.createElement("div");return n.className=s.CONTROL_GROUP+" "+s.CONTROL_BASE,r?(r[c.LINE]&&(t[c.LINE]=l(c.LINE,{container:n,className:s.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:function(){return e.events.changeMode(h.DRAW_LINE_STRING)},onDeactivate:function(){return e.events.trash()}})),r[c.POLYGON]&&(t[c.POLYGON]=l(c.POLYGON,{container:n,className:s.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:function(){return e.events.changeMode(h.DRAW_POLYGON)},onDeactivate:function(){return e.events.trash()}})),r[c.POINT]&&(t[c.POINT]=l(c.POINT,{container:n,className:s.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:function(){return e.events.changeMode(h.DRAW_POINT)},onDeactivate:function(){return e.events.trash()}})),r.trash&&(t.trash=l("trash",{container:n,className:s.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){e.events.trash()}})),r.combine_features&&(t.combine_features=l("combineFeatures",{container:n,className:s.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){e.events.combineFeatures()}})),r.uncombine_features&&(t.uncombine_features=l("uncombineFeatures",{container:n,className:s.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){e.events.uncombineFeatures()}})),n):n},removeButtons:function(){Object.keys(t).forEach((function(e){var r=t[e];r.parentNode&&r.parentNode.removeChild(r),delete t[e]}))}}}(t),t.container=a.getContainer(),t.store=new W(t),r=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=a.boxZoom.isEnabled(),a.boxZoom.disable(),a.dragPan.disable(),a.dragPan.enable()),a.loaded()?i.connect():(a.on("load",i.connect),n=setInterval((function(){a.loaded()&&i.connect()}),16)),t.events.start(),r},addLayers:function(){t.map.addSource(l.COLD,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(l.HOT,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach((function(e){t.map.addLayer(e)})),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach((function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)})),t.map.getSource(l.COLD)&&t.map.removeSource(l.COLD),t.map.getSource(l.HOT)&&t.map.removeSource(l.HOT)}};return t.setup=i,i}var Q=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ee(e){return function(t){var r=t.featureTarget;return!!r&&!!r.properties&&r.properties.meta===e}}function te(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function re(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===g.ACTIVE&&e.featureTarget.properties.meta===m.FEATURE}function ne(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===g.INACTIVE&&e.featureTarget.properties.meta===m.FEATURE}function ie(e){return void 0===e.featureTarget}function ae(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===m.FEATURE}function oe(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===m.VERTEX}function se(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function le(e){return 27===e.keyCode}function ue(e){return 13===e.keyCode}var ce=Object.freeze({__proto__:null,isOfMetaType:ee,isShiftMousedown:te,isActiveFeature:re,isInactiveFeature:ne,noTarget:ie,isFeature:ae,isVertex:oe,isShiftDown:se,isEscapeKey:le,isEnterKey:ue,isTrue:function(){return!0}}),de=he;function he(e,t){this.x=e,this.y=t}he.prototype={clone:function(){return new he(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},he.convert=function(e){return e instanceof he?e:Array.isArray(e)?new he(e[0],e[1]):e};var fe=t(de);function pe(e,t){var r=t.getBoundingClientRect();return new fe(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function me(e,t,r,n){return{type:d.FEATURE,properties:{meta:m.VERTEX,parent:e,coord_path:r,active:n?g.ACTIVE:g.INACTIVE},geometry:{type:d.POINT,coordinates:t}}}function ge(e,t,r){var n=t.geometry.coordinates,i=r.geometry.coordinates;if(n[1]>85||n[1]<y||i[1]>85||i[1]<y)return null;var a={lng:(n[0]+i[0])/2,lat:(n[1]+i[1])/2};return{type:d.FEATURE,properties:{meta:m.MIDPOINT,parent:e,lng:a.lng,lat:a.lat,coord_path:r.properties.coord_path},geometry:{type:d.POINT,coordinates:[a.lng,a.lat]}}}function _e(e,t,r){void 0===t&&(t={}),void 0===r&&(r=null);var n,i=e.geometry,a=i.type,o=i.coordinates,s=e.properties&&e.properties.id,l=[];function u(e,r){var n="",i=null;e.forEach((function(e,a){var o=null!=r?r+"."+a:String(a),u=me(s,e,o,c(o));if(t.midpoints&&i){var d=ge(s,i,u);d&&l.push(d)}i=u;var h=JSON.stringify(e);n!==h&&l.push(u),0===a&&(n=h)}))}function c(e){return!!t.selectedPaths&&-1!==t.selectedPaths.indexOf(e)}return a===d.POINT?l.push(me(s,o,r,c(r))):a===d.POLYGON?o.forEach((function(e,t){u(e,null!==r?r+"."+t:String(t))})):a===d.LINE_STRING?u(o,r):0===a.indexOf(d.MULTI_PREFIX)&&(n=a.replace(d.MULTI_PREFIX,""),o.forEach((function(r,i){l=l.concat(_e({type:d.FEATURE,properties:e.properties,geometry:{type:n,coordinates:r}},t,i))}))),l}var ye={enable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable:function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}},ve={exports:{}},be=function(e){if(!e||!e.type)return null;var t=xe[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null},xe={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Te=t(be),we=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce((function(t,r){return t.concat(e(r))}),[]),t;case"Feature":return t.geometry?e(t.geometry).map((function(e){var r={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(r.id=t.id),r})):[t];case"MultiPoint":return t.coordinates.map((function(e){return{type:"Point",coordinates:e}}));case"MultiPolygon":return t.coordinates.map((function(e){return{type:"Polygon",coordinates:e}}));case"MultiLineString":return t.coordinates.map((function(e){return{type:"LineString",coordinates:e}}));case"GeometryCollection":return t.geometries.map(e).reduce((function(e,t){return e.concat(t)}),[]);case"Point":case"Polygon":case"LineString":return[t]}}}),Ee=be,Ae=function(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}(we);Ae instanceof Function||(Ae=Ae.default);var Se={exports:{}},Pe=Se.exports=function(e){return new Me(e)};function Me(e){this.value=e}function Re(e,t,r){var n=[],i=[],a=!0;return function e(o){var s=r?Ce(o):o,l={},u=!0,c={node:s,node_:o,path:[].concat(n),parent:i[i.length-1],parents:i,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){c.isRoot||(c.parent.node[c.key]=e),c.node=e,t&&(u=!1)},delete:function(e){delete c.parent.node[c.key],e&&(u=!1)},remove:function(e){Ie(c.parent.node)?c.parent.node.splice(c.key,1):delete c.parent.node[c.key],e&&(u=!1)},keys:null,before:function(e){l.before=e},after:function(e){l.after=e},pre:function(e){l.pre=e},post:function(e){l.post=e},stop:function(){a=!1},block:function(){u=!1}};if(!a)return c;function d(){if("object"==typeof c.node&&null!==c.node){c.keys&&c.node_===c.node||(c.keys=Oe(c.node)),c.isLeaf=0==c.keys.length;for(var e=0;e<i.length;e++)if(i[e].node_===o){c.circular=i[e];break}}else c.isLeaf=!0,c.keys=null;c.notLeaf=!c.isLeaf,c.notRoot=!c.isRoot}d();var h=t.call(c,c.node);return void 0!==h&&c.update&&c.update(h),l.before&&l.before.call(c,c.node),u?("object"!=typeof c.node||null===c.node||c.circular||(i.push(c),d(),De(c.keys,(function(t,i){n.push(t),l.pre&&l.pre.call(c,c.node[t],t);var a=e(c.node[t]);r&&ke.call(c.node,t)&&(c.node[t]=a.node),a.isLast=i==c.keys.length-1,a.isFirst=0==i,l.post&&l.post.call(c,a),n.pop()})),i.pop()),l.after&&l.after.call(c,c.node),c):c}(e).node}function Ce(e){if("object"==typeof e&&null!==e){var t;if(Ie(e))t=[];else if("[object Date]"===Le(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===Le(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===Le(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===Le(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===Le(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===Le(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var r=function(){};r.prototype=e.constructor&&e.constructor.prototype||e.__proto__||{},t=new r}return De(Oe(e),(function(r){t[r]=e[r]})),t}return e}Me.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!ke.call(t,n)){t=void 0;break}t=t[n]}return t},Me.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!ke.call(t,n))return!1;t=t[n]}return!0},Me.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];ke.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t,t},Me.prototype.map=function(e){return Re(this.value,e,!0)},Me.prototype.forEach=function(e){return this.value=Re(this.value,e,!1),this.value},Me.prototype.reduce=function(e,t){var r=1===arguments.length,n=r?this.value:t;return this.forEach((function(t){this.isRoot&&r||(n=e.call(this,n,t))})),n},Me.prototype.paths=function(){var e=[];return this.forEach((function(t){e.push(this.path)})),e},Me.prototype.nodes=function(){var e=[];return this.forEach((function(t){e.push(this.node)})),e},Me.prototype.clone=function(){var e=[],t=[];return function r(n){for(var i=0;i<e.length;i++)if(e[i]===n)return t[i];if("object"==typeof n&&null!==n){var a=Ce(n);return e.push(n),t.push(a),De(Oe(n),(function(e){a[e]=r(n[e])})),e.pop(),t.pop(),a}return n}(this.value)};var Oe=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};function Le(e){return Object.prototype.toString.call(e)}var Ie=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},De=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)};De(Oe(Me.prototype),(function(e){Pe[e]=function(t){var r=[].slice.call(arguments,1),n=new Me(t);return n[e].apply(n,r)}}));var ke=Object.hasOwnProperty||function(e,t){return t in e},Be=Se.exports,Fe=Ne;function Ne(e){if(!(this instanceof Ne))return new Ne(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}Ne.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},Ne.prototype.equals=function(e){var t;return t=e instanceof Ne?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},Ne.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ne.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof Ne?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},Ne.prototype.bbox=function(){return this._valid?this._bbox:null},Ne.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],r=e[1];return this._bbox[0]<=t&&this._bbox[1]<=r&&this._bbox[2]>=t&&this._bbox[3]>=r},Ne.prototype.intersect=function(e){return this._valid?(t=e instanceof Ne?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},Ne.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},Ne.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var qe=Be,Ue=Fe,je={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ge=Object.keys(je);function ze(e){for(var t=Ue(),r=function(e){if(!e)return[];var t=Ae(Ee(e)),r=[];return t.features.forEach((function(e){e.geometry&&(r=r.concat(function(e){return function e(t){return Array.isArray(t)&&t.length&&"number"==typeof t[0]?[t]:t.reduce((function(t,r){return Array.isArray(r)&&Array.isArray(r[0])?t.concat(e(r)):(t.push(r),t)}),[])}(e)}(e.geometry.coordinates)))})),r}(e),n=0;n<r.length;n++)t.include(r[n]);return t}ve.exports=function(e){return ze(e).bbox()},ve.exports.polygon=function(e){return ze(e).polygon()},ve.exports.bboxify=function(e){return qe(e).map((function(e){e&&Ge.some((function(t){return!!e[t]&&-1!==je[t].indexOf(e.type)}))&&(e.bbox=ze(e).bbox(),this.update(e))}))};var Ve=t(ve.exports),$e=-90;function He(e,t){var r=$e,n=90,i=$e,a=90,o=270,s=-270;e.forEach((function(e){var t=Ve(e),l=t[1],u=t[3],c=t[0],d=t[2];l>r&&(r=l),u<n&&(n=u),u>i&&(i=u),l<a&&(a=l),c<o&&(o=c),d>s&&(s=d)}));var l=t;return r+l.lat>85&&(l.lat=85-r),i+l.lat>90&&(l.lat=90-i),n+l.lat<-85&&(l.lat=-85-n),a+l.lat<$e&&(l.lat=$e-a),o+l.lng<=-270&&(l.lng+=360*Math.ceil(Math.abs(l.lng)/360)),s+l.lng>=270&&(l.lng-=360*Math.ceil(Math.abs(l.lng)/360)),l}function We(e,t){var r=He(e.map((function(e){return e.toGeoJSON()})),t);e.forEach((function(e){var t,n=e.getCoordinates(),i=function(e){var t={lng:e[0]+r.lng,lat:e[1]+r.lat};return[t.lng,t.lat]},a=function(e){return e.map((function(e){return i(e)}))};e.type===d.POINT?t=i(n):e.type===d.LINE_STRING||e.type===d.MULTI_POINT?t=n.map(i):e.type===d.POLYGON||e.type===d.MULTI_LINE_STRING?t=n.map(a):e.type===d.MULTI_POLYGON&&(t=n.map((function(e){return e.map((function(e){return a(e)}))}))),e.incomingCoords(t)}))}var Xe={onSetup:function(e){var t=this,r={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(r.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),r},fireUpdate:function(){this.map.fire(f.UPDATE,{action:p.MOVE,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(){var e=this,t=this.getSelected(),r=t.filter((function(t){return e.isInstanceOf("MultiFeature",t)})),n=!1;if(t.length>1){n=!0;var i=t[0].type.replace("Multi","");t.forEach((function(e){e.type.replace("Multi","")!==i&&(n=!1)}))}this.setActionableState({combineFeatures:n,uncombineFeatures:r.length>0,trash:t.length>0})},getUniqueIds:function(e){return e.length?e.map((function(e){return e.properties.id})).filter((function(e){return void 0!==e})).reduce((function(e,t){return e.add(t),e}),new E).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){ye.enable(this)},onMouseMove:function(e,t){return ae(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};Xe.onTap=Xe.onClick=function(e,t){return ie(t)?this.clickAnywhere(e,t):ee(m.VERTEX)(t)?this.clickOnVertex(e,t):ae(t)?this.clickOnFeature(e,t):void 0},Xe.clickAnywhere=function(e){var t=this,r=this.getSelectedIds();r.length&&(this.clearSelectedFeatures(),r.forEach((function(e){return t.doRender(e)}))),ye.enable(this),this.stopExtendedInteractions(e)},Xe.clickOnVertex=function(e,t){this.changeMode(h.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:u.MOVE})},Xe.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},Xe.clickOnFeature=function(e,t){var r=this;ye.disable(this),this.stopExtendedInteractions(e);var n=se(t),i=this.getSelectedIds(),a=t.featureTarget.properties.id,o=this.isSelected(a);if(!n&&o&&this.getFeature(a).type!==d.POINT)return this.changeMode(h.DIRECT_SELECT,{featureId:a});o&&n?(this.deselect(a),this.updateUIClasses({mouse:u.POINTER}),1===i.length&&ye.enable(this)):!o&&n?(this.select(a),this.updateUIClasses({mouse:u.MOVE})):o||n||(i.forEach((function(e){return r.doRender(e)})),this.setSelected(a),this.updateUIClasses({mouse:u.MOVE})),this.doRender(a)},Xe.onMouseDown=function(e,t){return re(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&te(t)?this.startBoxSelect(e,t):void 0},Xe.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=pe(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},Xe.onTouchStart=function(e,t){if(re(t))return this.startOnActiveFeature(e,t)},Xe.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},Xe.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:u.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(s.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var r=pe(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),i=Math.max(e.boxSelectStartLocation.x,r.x),a=Math.min(e.boxSelectStartLocation.y,r.y),o=Math.max(e.boxSelectStartLocation.y,r.y),l="translate("+n+"px, "+a+"px)";e.boxSelectElement.style.transform=l,e.boxSelectElement.style.WebkitTransform=l,e.boxSelectElement.style.width=i-n+"px",e.boxSelectElement.style.height=o-a+"px"},Xe.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};We(this.getSelected(),r),e.dragMoveLocation=t.lngLat},Xe.onTouchEnd=Xe.onMouseUp=function(e,t){var r=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var n=[e.boxSelectStartLocation,pe(t.originalEvent,this.map.getContainer())],i=this.featuresAt(null,n,"click"),a=this.getUniqueIds(i).filter((function(e){return!r.isSelected(e)}));a.length&&(this.select(a),a.forEach((function(e){return r.doRender(e)})),this.updateUIClasses({mouse:u.MOVE}))}this.stopExtendedInteractions(e)},Xe.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?g.ACTIVE:g.INACTIVE,r(t),this.fireActionable(),t.properties.active===g.ACTIVE&&t.geometry.type!==d.POINT&&_e(t).forEach(r)},Xe.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Xe.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t=[],r=[],n=e[0].type.replace("Multi",""),i=0;i<e.length;i++){var a=e[i];if(a.type.replace("Multi","")!==n)return;a.type.includes("Multi")?a.getCoordinates().forEach((function(e){t.push(e)})):t.push(a.getCoordinates()),r.push(a.toGeoJSON())}if(r.length>1){var o=this.newFeature({type:d.FEATURE,properties:r[0].properties,geometry:{type:"Multi"+n,coordinates:t}});this.addFeature(o),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([o.id]),this.map.fire(f.COMBINE_FEATURES,{createdFeatures:[o.toGeoJSON()],deletedFeatures:r})}this.fireActionable()}},Xe.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(0!==t.length){for(var r=[],n=[],i=function(i){var a=t[i];e.isInstanceOf("MultiFeature",a)&&(a.getFeatures().forEach((function(t){e.addFeature(t),t.properties=a.properties,r.push(t.toGeoJSON()),e.select([t.id])})),e.deleteFeature(a.id,{silent:!0}),n.push(a.toGeoJSON()))},a=0;a<t.length;a++)i(a);r.length>1&&this.map.fire(f.UNCOMBINE_FEATURES,{createdFeatures:r,deletedFeatures:n}),this.fireActionable()}};var Ye=ee(m.VERTEX),Ze=ee(m.MIDPOINT),Ke={fireUpdate:function(){this.map.fire(f.UPDATE,{action:p.CHANGE_COORDINATES,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);se(t)||-1!==n?se(t)&&-1===n&&e.selectedCoordPaths.push(r.coord_path):e.selectedCoordPaths=[r.coord_path];var i=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(i)},onMidpoint:function(e,t){this.startDragging(e,t);var r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]},pathsToCoordinates:function(e,t){return t.map((function(t){return{feature_id:e,coord_path:t}}))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,r){We(this.getSelected(),r),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,r){for(var n=e.selectedCoordPaths.map((function(t){return e.feature.getCoordinate(t)})),i=He(n.map((function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e}}})),r),a=0;a<n.length;a++){var o=n[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],o[0]+i.lng,o[1]+i.lat)}},clickNoTarget:function(){this.changeMode(h.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(h.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===d.POINT)throw new TypeError("direct_select mode doesn't handle point features");var n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),ye.disable(this),this.setActionableState({trash:!0}),n},onStop:function(){ye.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,r){e.featureId===t.properties.id?(t.properties.active=g.ACTIVE,r(t),_e(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=g.INACTIVE,r(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort((function(e,t){return t.localeCompare(e,"en",{numeric:!0})})).forEach((function(t){return e.feature.removeCoordinate(t)})),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(h.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var r=re(t),n=Ye(t),i=Ze(t),a=0===e.selectedCoordPaths.length;return this.updateUIClasses(r&&a||n&&!a?{mouse:u.MOVE}:{mouse:u.NONE}),(n||r||i)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};Ke.onTouchStart=Ke.onMouseDown=function(e,t){return Ye(t)?this.onVertex(e,t):re(t)?this.onFeature(e,t):Ze(t)?this.onMidpoint(e,t):void 0},Ke.onDrag=function(e,t){if(!0===e.canDragMove){e.dragMoving=!0,t.originalEvent.stopPropagation();var r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat}},Ke.onClick=function(e,t){return ie(t)?this.clickNoTarget(e,t):re(t)?this.clickActiveFeature(e,t):ne(t)?this.clickInactive(e,t):void this.stopDragging(e)},Ke.onTap=function(e,t){return ie(t)?this.clickNoTarget(e,t):re(t)?this.clickActiveFeature(e,t):ne(t)?this.clickInactive(e,t):void 0},Ke.onTouchEnd=Ke.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var Je={};function Qe(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}Je.onSetup=function(){var e=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(c.POINT),this.setActionableState({trash:!0}),{point:e}},Je.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},Je.onTap=Je.onClick=function(e,t){this.updateUIClasses({mouse:u.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(f.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.point.id]})},Je.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Je.toDisplayFeatures=function(e,t,r){var n=t.properties.id===e.point.id;if(t.properties.active=n?g.ACTIVE:g.INACTIVE,!n)return r(t)},Je.onTrash=Je.stopDrawingAndRemove,Je.onKeyUp=function(e,t){if(le(t)||ue(t))return this.stopDrawingAndRemove(e,t)};var et={onSetup:function(){var e=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(c.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Qe(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:u.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),oe(t)&&this.updateUIClasses({mouse:u.POINTER})}};et.onTap=et.onClick=function(e,t){return oe(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},et.onKeyUp=function(e,t){le(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)):ue(t)&&this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},et.onStop=function(e){this.updateUIClasses({mouse:u.NONE}),ye.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(f.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},et.toDisplayFeatures=function(e,t,r){var n=t.properties.id===e.polygon.id;if(t.properties.active=n?g.ACTIVE:g.INACTIVE,!n)return r(t);if(0!==t.geometry.coordinates.length){var i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta=m.FEATURE,r(me(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){var a=t.geometry.coordinates[0].length-3;r(me(e.polygon.id,t.geometry.coordinates[0][a],"0."+a,!1))}if(i<=4&&(r({type:d.FEATURE,properties:t.properties,geometry:{coordinates:[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]],type:d.LINE_STRING}}),3===i))return;return r(t)}}},et.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)};var tt={onSetup:function(e){var t,r,n=(e=e||{}).featureId,i="forward";if(n){if(!(t=this.getFeature(n)))throw new Error("Could not find a feature with the provided featureId");var a=e.from;if(a&&"Feature"===a.type&&a.geometry&&"Point"===a.geometry.type&&(a=a.geometry),a&&"Point"===a.type&&a.coordinates&&2===a.coordinates.length&&(a=a.coordinates),!a||!Array.isArray(a))throw new Error("Please use the `from` property to indicate which point to continue the line from");var o=t.coordinates.length-1;if(t.coordinates[o][0]===a[0]&&t.coordinates[o][1]===a[1])t.addCoordinate.apply(t,[r=o+1].concat(t.coordinates[o]));else{if(t.coordinates[0][0]!==a[0]||t.coordinates[0][1]!==a[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",t.addCoordinate.apply(t,[r=0].concat(t.coordinates[0]))}}else t=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.LINE_STRING,coordinates:[]}}),r=0,this.addFeature(t);return this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(c.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:r,direction:i}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Qe(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Qe(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:u.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),oe(t)&&this.updateUIClasses({mouse:u.POINTER})}};tt.onTap=tt.onClick=function(e,t){if(oe(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},tt.onKeyUp=function(e,t){ue(t)?this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]}):le(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT))},tt.onStop=function(e){ye.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(f.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},tt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},tt.toDisplayFeatures=function(e,t,r){var n=t.properties.id===e.line.id;if(t.properties.active=n?g.ACTIVE:g.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=m.FEATURE,r(me(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),r(t))};var rt={simple_select:Xe,direct_select:Ke,draw_point:Je,draw_polygon:et,draw_line_string:tt},nt={defaultMode:h.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Q,modes:rt,controls:{},userProperties:!1},it={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},at={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ot(e,t){return e.map((function(e){return e.source?e:Z(e,{id:e.id+"."+t,source:"hot"===t?l.HOT:l.COLD})}))}var st={exports:{}};!function(e,t){var r="__lodash_hash_undefined__",n=9007199254740991,i="[object Arguments]",a="[object Array]",o="[object Boolean]",s="[object Date]",l="[object Error]",u="[object Function]",c="[object Map]",d="[object Number]",h="[object Object]",f="[object Promise]",p="[object RegExp]",m="[object Set]",g="[object String]",_="[object WeakMap]",y="[object ArrayBuffer]",v="[object DataView]",b=/^\[object .+?Constructor\]$/,x=/^(?:0|[1-9]\d*)$/,T={};T["[object Float32Array]"]=T["[object Float64Array]"]=T["[object Int8Array]"]=T["[object Int16Array]"]=T["[object Int32Array]"]=T["[object Uint8Array]"]=T["[object Uint8ClampedArray]"]=T["[object Uint16Array]"]=T["[object Uint32Array]"]=!0,T[i]=T[a]=T[y]=T[o]=T[v]=T[s]=T[l]=T[u]=T[c]=T[d]=T[h]=T[p]=T[m]=T[g]=T[_]=!1;var w="object"==typeof global&&global&&global.Object===Object&&global,E="object"==typeof self&&self&&self.Object===Object&&self,A=w||E||Function("return this")(),S=t&&!t.nodeType&&t,P=S&&e&&!e.nodeType&&e,M=P&&P.exports===S,R=M&&w.process,C=function(){try{return R&&R.binding&&R.binding("util")}catch(e){}}(),O=C&&C.isTypedArray;function L(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function I(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function D(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var k,B,F,N=Array.prototype,q=Object.prototype,U=A["__core-js_shared__"],j=Function.prototype.toString,G=q.hasOwnProperty,z=(k=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+k:"",V=q.toString,$=RegExp("^"+j.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),H=M?A.Buffer:void 0,W=A.Symbol,X=A.Uint8Array,Y=q.propertyIsEnumerable,Z=N.splice,K=W?W.toStringTag:void 0,J=Object.getOwnPropertySymbols,Q=H?H.isBuffer:void 0,ee=(B=Object.keys,F=Object,function(e){return B(F(e))}),te=Se(A,"DataView"),re=Se(A,"Map"),ne=Se(A,"Promise"),ie=Se(A,"Set"),ae=Se(A,"WeakMap"),oe=Se(Object,"create"),se=Ce(te),le=Ce(re),ue=Ce(ne),ce=Ce(ie),de=Ce(ae),he=W?W.prototype:void 0,fe=he?he.valueOf:void 0;function pe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ge(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _e(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ge;++t<r;)this.add(e[t])}function ye(e){var t=this.__data__=new me(e);this.size=t.size}function ve(e,t){for(var r=e.length;r--;)if(Oe(e[r][0],t))return r;return-1}function be(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?function(e){var t=G.call(e,K),r=e[K];try{e[K]=void 0;var n=!0}catch(e){}var i=V.call(e);return n&&(t?e[K]=r:delete e[K]),i}(e):function(e){return V.call(e)}(e)}function xe(e){return Ne(e)&&be(e)==i}function Te(e,t,r,n,u){return e===t||(null==e||null==t||!Ne(e)&&!Ne(t)?e!=e&&t!=t:function(e,t,r,n,u,f){var _=Ie(e),b=Ie(t),x=_?a:Me(e),T=b?a:Me(t),w=(x=x==i?h:x)==h,E=(T=T==i?h:T)==h,A=x==T;if(A&&De(e)){if(!De(t))return!1;_=!0,w=!1}if(A&&!w)return f||(f=new ye),_||qe(e)?we(e,t,r,n,u,f):function(e,t,r,n,i,a,u){switch(r){case v:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!a(new X(e),new X(t)));case o:case s:case d:return Oe(+e,+t);case l:return e.name==t.name&&e.message==t.message;case p:case g:return e==t+"";case c:var h=I;case m:if(h||(h=D),e.size!=t.size&&!(1&n))return!1;var f=u.get(e);if(f)return f==t;n|=2,u.set(e,t);var _=we(h(e),h(t),n,i,a,u);return u.delete(e),_;case"[object Symbol]":if(fe)return fe.call(e)==fe.call(t)}return!1}(e,t,x,r,n,u,f);if(!(1&r)){var S=w&&G.call(e,"__wrapped__"),P=E&&G.call(t,"__wrapped__");if(S||P){var M=S?e.value():e,R=P?t.value():t;return f||(f=new ye),u(M,R,r,n,f)}}return!!A&&(f||(f=new ye),function(e,t,r,n,i,a){var o=1&r,s=Ee(e),l=s.length;if(l!=Ee(t).length&&!o)return!1;for(var u=l;u--;){var c=s[u];if(!(o?c in t:G.call(t,c)))return!1}var d=a.get(e);if(d&&a.get(t))return d==t;var h=!0;a.set(e,t),a.set(t,e);for(var f=o;++u<l;){var p=e[c=s[u]],m=t[c];if(n)var g=o?n(m,p,c,t,e,a):n(p,m,c,e,t,a);if(!(void 0===g?p===m||i(p,m,r,n,a):g)){h=!1;break}f||(f="constructor"==c)}if(h&&!f){var _=e.constructor,y=t.constructor;_==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(h=!1)}return a.delete(e),a.delete(t),h}(e,t,r,n,u,f))}(e,t,r,n,Te,u))}function we(e,t,r,n,i,a){var o=1&r,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var c=-1,d=!0,h=2&r?new _e:void 0;for(a.set(e,t),a.set(t,e);++c<s;){var f=e[c],p=t[c];if(n)var m=o?n(p,f,c,t,e,a):n(f,p,c,e,t,a);if(void 0!==m){if(m)continue;d=!1;break}if(h){if(!L(t,(function(e,t){if(!h.has(t)&&(f===e||i(f,e,r,n,a)))return h.push(t)}))){d=!1;break}}else if(f!==p&&!i(f,p,r,n,a)){d=!1;break}}return a.delete(e),a.delete(t),d}function Ee(e){return function(e,t,r){var n=t(e);return Ie(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ue,Pe)}function Ae(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function Se(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Fe(e)||function(e){return!!z&&z in e}(e))&&(ke(e)?$:b).test(Ce(e))}(r)?r:void 0}pe.prototype.clear=function(){this.__data__=oe?oe(null):{},this.size=0},pe.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},pe.prototype.get=function(e){var t=this.__data__;if(oe){var n=t[e];return n===r?void 0:n}return G.call(t,e)?t[e]:void 0},pe.prototype.has=function(e){var t=this.__data__;return oe?void 0!==t[e]:G.call(t,e)},pe.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=oe&&void 0===t?r:t,this},me.prototype.clear=function(){this.__data__=[],this.size=0},me.prototype.delete=function(e){var t=this.__data__,r=ve(t,e);return!(r<0||(r==t.length-1?t.pop():Z.call(t,r,1),--this.size,0))},me.prototype.get=function(e){var t=this.__data__,r=ve(t,e);return r<0?void 0:t[r][1]},me.prototype.has=function(e){return ve(this.__data__,e)>-1},me.prototype.set=function(e,t){var r=this.__data__,n=ve(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},ge.prototype.clear=function(){this.size=0,this.__data__={hash:new pe,map:new(re||me),string:new pe}},ge.prototype.delete=function(e){var t=Ae(this,e).delete(e);return this.size-=t?1:0,t},ge.prototype.get=function(e){return Ae(this,e).get(e)},ge.prototype.has=function(e){return Ae(this,e).has(e)},ge.prototype.set=function(e,t){var r=Ae(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},_e.prototype.add=_e.prototype.push=function(e){return this.__data__.set(e,r),this},_e.prototype.has=function(e){return this.__data__.has(e)},ye.prototype.clear=function(){this.__data__=new me,this.size=0},ye.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},ye.prototype.get=function(e){return this.__data__.get(e)},ye.prototype.has=function(e){return this.__data__.has(e)},ye.prototype.set=function(e,t){var r=this.__data__;if(r instanceof me){var n=r.__data__;if(!re||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ge(n)}return r.set(e,t),this.size=r.size,this};var Pe=J?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o)&&(a[i++]=o)}return a}(J(e),(function(t){return Y.call(e,t)})))}:function(){return[]},Me=be;function Re(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||x.test(e))&&e>-1&&e%1==0&&e<t}function Ce(e){if(null!=e){try{return j.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Oe(e,t){return e===t||e!=e&&t!=t}(te&&Me(new te(new ArrayBuffer(1)))!=v||re&&Me(new re)!=c||ne&&Me(ne.resolve())!=f||ie&&Me(new ie)!=m||ae&&Me(new ae)!=_)&&(Me=function(e){var t=be(e),r=t==h?e.constructor:void 0,n=r?Ce(r):"";if(n)switch(n){case se:return v;case le:return c;case ue:return f;case ce:return m;case de:return _}return t});var Le=xe(function(){return arguments}())?xe:function(e){return Ne(e)&&G.call(e,"callee")&&!Y.call(e,"callee")},Ie=Array.isArray,De=Q||function(){return!1};function ke(e){if(!Fe(e))return!1;var t=be(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Be(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function Fe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ne(e){return null!=e&&"object"==typeof e}var qe=O?function(e){return function(t){return e(t)}}(O):function(e){return Ne(e)&&Be(e.length)&&!!T[be(e)]};function Ue(e){return null!=(t=e)&&Be(t.length)&&!ke(t)?function(e,t){var r=Ie(e),n=!r&&Le(e),i=!r&&!n&&De(e),a=!r&&!n&&!i&&qe(e),o=r||n||i||a,s=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=s.length;for(var u in e)!G.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Re(u,l))||s.push(u);return s}(e):function(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||q))return ee(e);var t,r,n=[];for(var i in Object(e))G.call(e,i)&&"constructor"!=i&&n.push(i);return n}(e);var t}e.exports=function(e,t){return Te(e,t)}}(st,st.exports);var lt=t(st.exports);function ut(e,t){return e.length===t.length&&JSON.stringify(e.map((function(e){return e})).sort())===JSON.stringify(t.map((function(e){return e})).sort())}var ct={Polygon:N,LineString:F,Point:B,MultiPolygon:j,MultiLineString:j,MultiPoint:j},dt=Object.freeze({__proto__:null,CommonSelectors:ce,constrainFeatureMovement:He,createMidPoint:ge,createSupplementaryPoints:_e,createVertex:me,doubleClickZoom:ye,euclideanDistance:R,featuresAt:S,getFeatureAtAndSetCursors:M,isClick:C,isEventAtCoordinates:Qe,isTap:O,mapEventToBoundingBox:w,ModeHandler:e,moveFeatures:We,sortFeatures:T,stringSetsAreEqual:ut,StringSet:E,theme:Q,toDenseArray:$});function ht(e){!function(e,t){var r={options:e=function(e){void 0===e&&(e={});var t=Z(e);return e.controls||(t.controls={}),t.controls=Z(!1===e.displayControlsDefault?at:it,e.controls),(t=Z(nt,t)).styles=ot(t.styles,"cold").concat(ot(t.styles,"hot")),t}(e)};t=function(e,t){return t.modes=h,t.getFeatureIdsAt=function(t){return S.click({point:t},null,e).map((function(e){return e.properties.id}))},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getSelectedIds().map((function(t){return e.store.get(t)})).map((function(e){return e.toGeoJSON()}))}},t.getSelectedPoints=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map((function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e.coordinates}}}))}},t.set=function(r){if(void 0===r.type||r.type!==d.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");var n=e.store.createRenderBatch(),i=e.store.getAllIds().slice(),a=t.add(r),o=new E(a);return(i=i.filter((function(e){return!o.has(e)}))).length&&t.delete(i),n(),a},t.add=function(t){var r=JSON.parse(JSON.stringify(Te(t))).features.map((function(t){if(t.id=t.id||D(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){var r=ct[t.geometry.type];if(void 0===r)throw new Error("Invalid geometry type: "+t.geometry.type+".");var n=new r(e,t);e.store.add(n)}else{var i=e.store.get(t.id);i.properties=t.properties,lt(i.properties,t.properties)||e.store.featureChanged(i.id),lt(i.getCoordinates(),t.geometry.coordinates)||i.incomingCoords(t.geometry.coordinates)}return t.id}));return e.store.render(),r},t.get=function(t){var r=e.store.get(t);if(r)return r.toGeoJSON()},t.getAll=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getAll().map((function(e){return e.toGeoJSON()}))}},t.delete=function(r){return e.store.delete(r,{silent:!0}),t.getMode()!==h.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===h.DIRECT_SELECT?e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(r,n){return void 0===n&&(n={}),r===h.SIMPLE_SELECT&&t.getMode()===h.SIMPLE_SELECT?(ut(n.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(n.featureIds,{silent:!0}),e.store.render()),t):(r===h.DIRECT_SELECT&&t.getMode()===h.DIRECT_SELECT&&n.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,n,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(r,n,i){return e.store.setFeatureProperty(r,n,i),t},t}(r,t),r.api=t;var n=J(r);t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=c,t.options=e}(e,this)}return ht.modes=rt,ht.constants=v,ht.lib=dt,ht}()}(mapboxGlDraw);var mapboxGlDrawExports=mapboxGlDraw.exports,MapboxDraw=getDefaultExportFromCjs(mapboxGlDrawExports),es5$t={},interopRequireDefault={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}(interopRequireDefault);var interopRequireDefaultExports=interopRequireDefault.exports,_typeof$2={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(_typeof$2);var _typeofExports=_typeof$2.exports,assert$f={};function assert$e(e,t){if(!e)throw new Error(t||"loader assertion failed.")}Object.defineProperty(assert$f,"__esModule",{value:!0}),assert$f.assert=assert$e;var globals$5={},_interopRequireDefault$N=interopRequireDefaultExports;Object.defineProperty(globals$5,"__esModule",{value:!0}),globals$5.window=globals$5.self=globals$5.nodeVersion=globals$5.isWorker=globals$5.isBrowser=global$1=globals$5.global=globals$5.document=void 0;var _typeof2$5=_interopRequireDefault$N(_typeofExports),globals$4={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==global$1&&global$1,document:"undefined"!=typeof document&&document},self_=globals$4.self||globals$4.window||globals$4.global||{};globals$5.self=self_;var window_=globals$4.window||globals$4.self||globals$4.global||{};globals$5.window=window_;var global_=globals$4.global||globals$4.self||globals$4.window||{},global$1=globals$5.global=global_,document_=globals$4.document||{};globals$5.document=document_;var isBrowser$2=Boolean("object"!==("undefined"==typeof process?"undefined":(0,_typeof2$5.default)(process))||"[object process]"!==String(process)||process.browser);globals$5.isBrowser=isBrowser$2;var isWorker="function"==typeof importScripts;globals$5.isWorker=isWorker;var matches="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),nodeVersion=matches&&parseFloat(matches[1])||0;globals$5.nodeVersion=nodeVersion;var mergeLoaderOptions$1={},slicedToArray={exports:{}},arrayWithHoles={exports:{}},hasRequiredArrayWithHoles;function requireArrayWithHoles(){return hasRequiredArrayWithHoles||(hasRequiredArrayWithHoles=1,function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports}(arrayWithHoles)),arrayWithHoles.exports}var iterableToArrayLimit={exports:{}},hasRequiredIterableToArrayLimit;function requireIterableToArrayLimit(){return hasRequiredIterableToArrayLimit||(hasRequiredIterableToArrayLimit=1,function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],l=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports}(iterableToArrayLimit)),iterableToArrayLimit.exports}var unsupportedIterableToArray={exports:{}},arrayLikeToArray={exports:{}},hasRequiredArrayLikeToArray,hasRequiredUnsupportedIterableToArray;function requireArrayLikeToArray(){return hasRequiredArrayLikeToArray||(hasRequiredArrayLikeToArray=1,function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports}(arrayLikeToArray)),arrayLikeToArray.exports}function requireUnsupportedIterableToArray(){return hasRequiredUnsupportedIterableToArray||(hasRequiredUnsupportedIterableToArray=1,function(e){var t=requireArrayLikeToArray();e.exports=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(unsupportedIterableToArray)),unsupportedIterableToArray.exports}var nonIterableRest={exports:{}},hasRequiredNonIterableRest,hasRequiredSlicedToArray;function requireNonIterableRest(){return hasRequiredNonIterableRest||(hasRequiredNonIterableRest=1,function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(nonIterableRest)),nonIterableRest.exports}function requireSlicedToArray(){return hasRequiredSlicedToArray||(hasRequiredSlicedToArray=1,function(e){var t=requireArrayWithHoles(),r=requireIterableToArrayLimit(),n=requireUnsupportedIterableToArray(),i=requireNonIterableRest();e.exports=function(e,a){return t(e)||r(e,a)||n(e,a)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(slicedToArray)),slicedToArray.exports}var defineProperty={exports:{}},toPropertyKey={exports:{}},toPrimitive={exports:{}},hasRequiredToPrimitive,hasRequiredToPropertyKey,hasRequiredDefineProperty;function requireToPrimitive(){return hasRequiredToPrimitive||(hasRequiredToPrimitive=1,function(e){var t=_typeofExports.default;e.exports=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(toPrimitive)),toPrimitive.exports}function requireToPropertyKey(){return hasRequiredToPropertyKey||(hasRequiredToPropertyKey=1,function(e){var t=_typeofExports.default,r=requireToPrimitive();e.exports=function(e){var n=r(e,"string");return"symbol"===t(n)?n:String(n)},e.exports.__esModule=!0,e.exports.default=e.exports}(toPropertyKey)),toPropertyKey.exports}function requireDefineProperty(){return hasRequiredDefineProperty||(hasRequiredDefineProperty=1,function(e){var t=requireToPropertyKey();e.exports=function(e,r,n){return(r=t(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports}(defineProperty)),defineProperty.exports}var _interopRequireDefault$M=interopRequireDefaultExports;Object.defineProperty(mergeLoaderOptions$1,"__esModule",{value:!0}),mergeLoaderOptions$1.mergeLoaderOptions=mergeLoaderOptions;var _typeof2$4=_interopRequireDefault$M(_typeofExports),_slicedToArray2$6=_interopRequireDefault$M(requireSlicedToArray()),_defineProperty2$k=_interopRequireDefault$M(requireDefineProperty());function ownKeys$d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$d(Object(r),!0).forEach((function(t){(0,_defineProperty2$k.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mergeLoaderOptions(e,t){for(var r=_objectSpread$d({},e),n=0,i=Object.entries(t);n<i.length;n++){var a=(0,_slicedToArray2$6.default)(i[n],2),o=a[0],s=a[1];s&&"object"===(0,_typeof2$4.default)(s)?(r[o]=r[o]||{},Object.assign(r[o],t[o])):r[o]=t[o]}return r}var createLoaderWorker$1={},regeneratorRuntime$1={exports:{}},hasRequiredRegeneratorRuntime,regenerator,hasRequiredRegenerator;function requireRegeneratorRuntime(){return hasRequiredRegeneratorRuntime||(hasRequiredRegeneratorRuntime=1,function(e){var t=_typeofExports.default;function r(){e.exports=r=function(){return i},e.exports.__esModule=!0,e.exports.default=e.exports;var n,i={},a=Object.prototype,o=a.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(n){h=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i=Object.create((t&&t.prototype instanceof b?t:b).prototype),a=new I(n||[]);return s(i,"_invoke",{value:R(e,r,a)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}i.wrap=f;var m="suspendedStart",g="suspendedYield",_="executing",y="completed",v={};function b(){}function x(){}function T(){}var w={};h(w,u,(function(){return this}));var E=Object.getPrototypeOf,A=E&&E(E(D([])));A&&A!==a&&o.call(A,u)&&(w=A);var S=T.prototype=b.prototype=Object.create(w);function P(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,r){function n(i,a,s,l){var u=p(e[i],e,a);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==t(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):r.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,l)}))}l(u.arg)}var i;s(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(a,a):a()}})}function R(e,t,r){var i=m;return function(a,o){if(i===_)throw new Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:n,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var l=C(s,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===m)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=_;var u=p(e,t,r);if("normal"===u.type){if(i=r.done?y:g,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function C(e,t){var r=t.method,i=e.iterator[r];if(i===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(i,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function D(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function t(){for(;++i<e.length;)if(o.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return x.prototype=T,s(S,"constructor",{value:T,configurable:!0}),s(T,"constructor",{value:x,configurable:!0}),x.displayName=h(T,d,"GeneratorFunction"),i.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,h(e,d,"GeneratorFunction")),e.prototype=Object.create(S),e},i.awrap=function(e){return{__await:e}},P(M.prototype),h(M.prototype,c,(function(){return this})),i.AsyncIterator=M,i.async=function(e,t,r,n,a){void 0===a&&(a=Promise);var o=new M(f(e,t,r,n),a);return i.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),h(S,d,"Generator"),h(S,u,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),i.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},i.values=D,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}},i}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(regeneratorRuntime$1)),regeneratorRuntime$1.exports}function requireRegenerator(){if(hasRequiredRegenerator)return regenerator;hasRequiredRegenerator=1;var e=requireRegeneratorRuntime()();regenerator=e;try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}return regenerator}var asyncToGenerator={exports:{}},hasRequiredAsyncToGenerator;function requireAsyncToGenerator(){return hasRequiredAsyncToGenerator||(hasRequiredAsyncToGenerator=1,function(e){function t(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,a){var o=e.apply(r,n);function s(e){t(o,i,a,s,l,"next",e)}function l(e){t(o,i,a,s,l,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}(asyncToGenerator)),asyncToGenerator.exports}var es5$s={},version$5={},hasRequiredVersion$5;function requireVersion$5(){return hasRequiredVersion$5||(hasRequiredVersion$5=1,Object.defineProperty(version$5,"__esModule",{value:!0}),version$5.VERSION=void 0,version$5.VERSION="3.4.14"),version$5}var assert$d={},hasRequiredAssert$a;function requireAssert$a(){return hasRequiredAssert$a||(hasRequiredAssert$a=1,Object.defineProperty(assert$d,"__esModule",{value:!0}),assert$d.assert=function(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}),assert$d}var globals$3={},hasRequiredGlobals$3;function requireGlobals$3(){if(hasRequiredGlobals$3)return globals$3;hasRequiredGlobals$3=1;var e=interopRequireDefaultExports;Object.defineProperty(globals$3,"__esModule",{value:!0}),globals$3.window=globals$3.self=globals$3.nodeVersion=globals$3.isWorker=globals$3.isMobile=globals$3.isBrowser=globals$3.global=globals$3.document=void 0;var t=e(_typeofExports),r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};globals$3.self=r.self||r.window||r.global||{},globals$3.window=r.window||r.self||r.global||{},globals$3.global=r.global||r.self||r.window||{},globals$3.document=r.document||{};var n="object"!==("undefined"==typeof process?"undefined":(0,t.default)(process))||"[object process]"!==String(process)||process.browser;globals$3.isBrowser=n;var i="function"==typeof importScripts;globals$3.isWorker=i;var a="undefined"!=typeof window&&void 0!==window.orientation;globals$3.isMobile=a;var o="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),s=o&&parseFloat(o[1])||0;return globals$3.nodeVersion=s,globals$3}var workerJob={},classCallCheck={exports:{}},hasRequiredClassCallCheck;function requireClassCallCheck(){return hasRequiredClassCallCheck||(hasRequiredClassCallCheck=1,function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}(classCallCheck)),classCallCheck.exports}var createClass={exports:{}},hasRequiredCreateClass,hasRequiredWorkerJob;function requireCreateClass(){return hasRequiredCreateClass||(hasRequiredCreateClass=1,function(e){var t=requireToPropertyKey();function r(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}(createClass)),createClass.exports}function requireWorkerJob(){if(hasRequiredWorkerJob)return workerJob;hasRequiredWorkerJob=1;var e=interopRequireDefaultExports;Object.defineProperty(workerJob,"__esModule",{value:!0}),workerJob.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireAssert$a(),a=function(){function e(r,i){var a=this;(0,t.default)(this,e),(0,n.default)(this,"name",void 0),(0,n.default)(this,"workerThread",void 0),(0,n.default)(this,"isRunning",!0),(0,n.default)(this,"result",void 0),(0,n.default)(this,"_resolve",(function(){})),(0,n.default)(this,"_reject",(function(){})),this.name=r,this.workerThread=i,this.result=new Promise((function(e,t){a._resolve=e,a._reject=t}))}return(0,r.default)(e,[{key:"postMessage",value:function(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}},{key:"done",value:function(e){(0,i.assert)(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){(0,i.assert)(this.isRunning),this.isRunning=!1,this._reject(e)}}]),e}();return workerJob.default=a,workerJob}var workerThread={},worker_threadsBrowser={},hasRequiredWorker_threadsBrowser;function requireWorker_threadsBrowser(){if(hasRequiredWorker_threadsBrowser)return worker_threadsBrowser;hasRequiredWorker_threadsBrowser=1;var e=interopRequireDefaultExports;Object.defineProperty(worker_threadsBrowser,"__esModule",{value:!0}),worker_threadsBrowser.parentPort=worker_threadsBrowser.Worker=worker_threadsBrowser.NodeWorkerType=worker_threadsBrowser.NodeWorker=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=function(){function e(){(0,t.default)(this,e)}return(0,r.default)(e,[{key:"terminate",value:function(){}}]),e}();return worker_threadsBrowser.NodeWorkerType=worker_threadsBrowser.NodeWorker=worker_threadsBrowser.Worker=n,worker_threadsBrowser.parentPort=null,worker_threadsBrowser}var getLoadableWorkerUrl={},hasRequiredGetLoadableWorkerUrl;function requireGetLoadableWorkerUrl(){if(hasRequiredGetLoadableWorkerUrl)return getLoadableWorkerUrl;hasRequiredGetLoadableWorkerUrl=1,Object.defineProperty(getLoadableWorkerUrl,"__esModule",{value:!0}),getLoadableWorkerUrl.getLoadableWorkerURL=function(n){(0,e.assert)(n.source&&!n.url||!n.source&&n.url);var i,a=t.get(n.source||n.url);return a||(n.url&&(a=(i=n.url).startsWith("http")?r("try {\n  importScripts('".concat(i,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):i,t.set(n.url,a)),n.source&&(a=r(n.source),t.set(n.source,a))),(0,e.assert)(a),a};var e=requireAssert$a(),t=new Map;function r(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}return getLoadableWorkerUrl}var getTransferList={},hasRequiredGetTransferList,hasRequiredWorkerThread;function requireGetTransferList(){if(hasRequiredGetTransferList)return getTransferList;hasRequiredGetTransferList=1;var e=interopRequireDefaultExports;Object.defineProperty(getTransferList,"__esModule",{value:!0}),getTransferList.getTransferList=function e(n){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0,o=a||new Set;if(n)if(r(n))o.add(n);else if(r(n.buffer))o.add(n.buffer);else if(ArrayBuffer.isView(n));else if(i&&"object"===(0,t.default)(n))for(var s in n)e(n[s],i,o);return void 0===a?Array.from(o):[]},getTransferList.getTransferListForWriter=function e(r){if(null===r)return{};var n=Object.assign({},r);return Object.keys(n).forEach((function(i){n[i]="object"!==(0,t.default)(r[i])||ArrayBuffer.isView(r[i])||r[i]instanceof Array?"function"==typeof n[i]||n[i]instanceof RegExp?{}:r[i]:e(r[i])})),n};var t=e(_typeofExports);function r(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}return getTransferList}function requireWorkerThread(){if(hasRequiredWorkerThread)return workerThread;hasRequiredWorkerThread=1;var e=interopRequireDefaultExports;Object.defineProperty(workerThread,"__esModule",{value:!0}),workerThread.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireWorker_threadsBrowser(),a=requireGlobals$3(),o=requireAssert$a(),s=requireGetLoadableWorkerUrl(),l=requireGetTransferList(),u=function(){},c=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"name",void 0),(0,n.default)(this,"source",void 0),(0,n.default)(this,"url",void 0),(0,n.default)(this,"terminated",!1),(0,n.default)(this,"worker",void 0),(0,n.default)(this,"onMessage",void 0),(0,n.default)(this,"onError",void 0),(0,n.default)(this,"_loadableURL","");var i=r.name,s=r.source,l=r.url;(0,o.assert)(s||l),this.name=i,this.source=s,this.url=l,this.onMessage=u,this.onError=function(e){return console.log(e)},this.worker=a.isBrowser?this._createBrowserWorker():this._createNodeWorker()}return(0,r.default)(e,[{key:"destroy",value:function(){this.onMessage=u,this.onError=u,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,t){t=t||(0,l.getTransferList)(e),this.worker.postMessage(e,t)}},{key:"_getErrorFromErrorEvent",value:function(e){var t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=(0,s.getLoadableWorkerURL)({source:this.source,url:this.url});var t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e._getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(e){return console.error(e)},t}},{key:"_createNodeWorker",value:function(){var e,t=this;if(this.url){var r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new i.NodeWorker(r,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new i.NodeWorker(this.source,{eval:!0})}return e.on("message",(function(e){t.onMessage(e)})),e.on("error",(function(e){t.onError(e)})),e.on("exit",(function(e){})),e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof Worker&&a.isBrowser||void 0!==i.NodeWorker&&!a.isBrowser}}]),e}();return workerThread.default=c,workerThread}var workerFarm={},workerPool={},hasRequiredWorkerPool,hasRequiredWorkerFarm;function requireWorkerPool(){if(hasRequiredWorkerPool)return workerPool;hasRequiredWorkerPool=1;var e=interopRequireDefaultExports;Object.defineProperty(workerPool,"__esModule",{value:!0}),workerPool.default=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=requireGlobals$3(),s=e(requireWorkerThread()),l=e(requireWorkerJob());function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=function(){function e(t){(0,n.default)(this,e),(0,a.default)(this,"name","unnamed"),(0,a.default)(this,"source",void 0),(0,a.default)(this,"url",void 0),(0,a.default)(this,"maxConcurrency",1),(0,a.default)(this,"maxMobileConcurrency",1),(0,a.default)(this,"onDebug",(function(){})),(0,a.default)(this,"reuseWorkers",!0),(0,a.default)(this,"props",{}),(0,a.default)(this,"jobQueue",[]),(0,a.default)(this,"idleQueue",[]),(0,a.default)(this,"count",0),(0,a.default)(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}var u,d;return(0,i.default)(e,[{key:"destroy",value:function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=c(c({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}},{key:"startJob",value:(d=(0,r.default)(t.default.mark((function e(r){var n,i,a,o=this,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:function(e,t,r){return e.done(r)},i=s.length>2&&void 0!==s[2]?s[2]:function(e,t){return e.error(t)},a=new Promise((function(e){return o.jobQueue.push({name:r,onMessage:n,onError:i,onStart:e}),o})),this._startQueuedJob(),e.next=6,a;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_startQueuedJob",value:(u=(0,r.default)(t.default.mark((function e(){var r,n,i;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobQueue.length){e.next=2;break}return e.abrupt("return");case 2:if(r=this._getAvailableWorker()){e.next=5;break}return e.abrupt("return");case 5:if(!(n=this.jobQueue.shift())){e.next=18;break}return this.onDebug({message:"Starting job",name:n.name,workerThread:r,backlog:this.jobQueue.length}),i=new l.default(n.name,r),r.onMessage=function(e){return n.onMessage(i,e.type,e.payload)},r.onError=function(e){return n.onError(i,e)},n.onStart(i),e.prev=12,e.next=15,i.result;case 15:return e.prev=15,this.returnWorkerToQueue(r),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[12,,15,18]])}))),function(){return u.apply(this,arguments)})},{key:"returnWorkerToQueue",value:function(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new s.default({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return o.isMobile?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return s.default.isSupported()}}]),e}();return workerPool.default=d,workerPool}function requireWorkerFarm(){if(hasRequiredWorkerFarm)return workerFarm;hasRequiredWorkerFarm=1;var e=interopRequireDefaultExports;Object.defineProperty(workerFarm,"__esModule",{value:!0}),workerFarm.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireWorkerPool()),a=e(requireWorkerThread());function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},d=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"props",void 0),(0,n.default)(this,"workerPools",new Map),this.props=u({},c),this.setProps(r),this.workerPools=new Map}return(0,r.default)(e,[{key:"destroy",value:function(){var e,t=o(this.workerPools.values());try{for(t.s();!(e=t.n()).done;)e.value.destroy()}catch(e){t.e(e)}finally{t.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=u(u({},this.props),e);var t,r=o(this.workerPools.values());try{for(r.s();!(t=r.n()).done;)t.value.setProps(this._getWorkerPoolProps())}catch(e){r.e(e)}finally{r.f()}}},{key:"getWorkerPool",value:function(e){var t=e.name,r=e.source,n=e.url,a=this.workerPools.get(t);return a||((a=new i.default({name:t,source:r,url:n})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return a.default.isSupported()}},{key:"getWorkerFarm",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e._workerFarm=e._workerFarm||new e({})).setProps(t),e._workerFarm}}]),e}();return workerFarm.default=d,(0,n.default)(d,"_workerFarm",void 0),workerFarm}var workerBody={},hasRequiredWorkerBody;function requireWorkerBody(){if(hasRequiredWorkerBody)return workerBody;hasRequiredWorkerBody=1;var _interopRequireDefault=interopRequireDefaultExports;Object.defineProperty(workerBody,"__esModule",{value:!0}),workerBody.default=void 0;var _classCallCheck2=_interopRequireDefault(requireClassCallCheck()),_createClass2=_interopRequireDefault(requireCreateClass()),_getTransferList=requireGetTransferList();function getParentPort(){var parentPort;try{eval("globalThis.parentPort = require('worker_threads').parentPort"),parentPort=globalThis.parentPort}catch(e){}return parentPort}var onMessageWrapperMap=new Map,WorkerBody=function(){function e(){(0,_classCallCheck2.default)(this,e)}return(0,_createClass2.default)(e,null,[{key:"inWorkerThread",value:function(){return"undefined"!=typeof self||Boolean(getParentPort())}},{key:"onmessage",set:function(e){function t(t){var r=getParentPort()?t:t.data;e(r.type,r.payload)}var r=getParentPort();r?(r.on("message",t),r.on("exit",(function(){return console.debug("Node worker closing")}))):globalThis.onmessage=t}},{key:"addEventListener",value:function(e){var t=onMessageWrapperMap.get(e);t||(t=function(t){if(isKnownMessage(t)){var r=getParentPort()?t:t.data;e(r.type,r.payload)}}),getParentPort()?console.error("not implemented"):globalThis.addEventListener("message",t)}},{key:"removeEventListener",value:function(e){var t=onMessageWrapperMap.get(e);onMessageWrapperMap.delete(e),getParentPort()?console.error("not implemented"):globalThis.removeEventListener("message",t)}},{key:"postMessage",value:function(e,t){var r={source:"loaders.gl",type:e,payload:t},n=(0,_getTransferList.getTransferList)(t),i=getParentPort();i?i.postMessage(r,n):globalThis.postMessage(r,n)}}]),e}();function isKnownMessage(e){var t=e.data;return"message"===e.type&&t&&"string"==typeof t.source&&t.source.startsWith("loaders.gl")}return workerBody.default=WorkerBody,workerBody}var processOnWorker={},getWorkerUrl={},hasRequiredGetWorkerUrl,hasRequiredProcessOnWorker;function requireGetWorkerUrl(){if(hasRequiredGetWorkerUrl)return getWorkerUrl;hasRequiredGetWorkerUrl=1,Object.defineProperty(getWorkerUrl,"__esModule",{value:!0}),getWorkerUrl.getWorkerName=function(e){var t=e.version!==r?" (worker-utils@".concat(r,")"):"";return"".concat(e.name,"@").concat(e.version).concat(t)},getWorkerUrl.getWorkerURL=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n[r.id]||{},a="".concat(r.id,"-worker.js"),o=i.workerUrl;if(o||"compression"!==r.id||(o=n.workerUrl),"test"===n._workerType&&(o="modules/".concat(r.module,"/dist/").concat(a)),!o){var s=r.version;"latest"===s&&(s=t);var l=s?"@".concat(s):"";o="https://unpkg.com/@loaders.gl/".concat(r.module).concat(l,"/dist/").concat(a)}return(0,e.assert)(o),o};var e=requireAssert$a();requireVersion$5();var t="latest",r="3.4.14";return getWorkerUrl}function requireProcessOnWorker(){if(hasRequiredProcessOnWorker)return processOnWorker;hasRequiredProcessOnWorker=1;var e=interopRequireDefaultExports;Object.defineProperty(processOnWorker,"__esModule",{value:!0}),processOnWorker.canProcessOnWorker=function(e,t){return!!n.default.isSupported()&&e.worker&&(null==t?void 0:t.worker)},processOnWorker.processOnWorker=function(e,t){return o.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireWorkerFarm()),i=requireGetWorkerUrl(),a=requireGetTransferList();function o(){return o=(0,r.default)(t.default.mark((function e(r,o){var l,u,c,d,h,f,p,m,g,_,y=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=y.length>2&&void 0!==y[2]?y[2]:{},u=y.length>3&&void 0!==y[3]?y[3]:{},c=(0,i.getWorkerName)(r),d=n.default.getWorkerFarm(l),f={name:c,source:h=l.source},h||(f.url=(0,i.getWorkerURL)(r,l)),p=d.getWorkerPool(f),m=l.jobName||r.name,e.next=11,p.startJob(m,s.bind(null,u));case 11:return g=e.sent,_=(0,a.getTransferListForWriter)(l),g.postMessage("process",{input:o,options:_}),e.next=16,g.result;case 16:return e.abrupt("return",e.sent.result);case 18:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(e,t,r,n){return l.apply(this,arguments)}function l(){return l=(0,r.default)(t.default.mark((function e(r,n,i,a){var o,s,l,u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=i,e.next="done"===e.t0?3:"error"===e.t0?5:"process"===e.t0?7:23;break;case 3:return n.done(a),e.abrupt("break",24);case 5:return n.error(new Error(a.error)),e.abrupt("break",24);case 7:if(o=a.id,s=a.input,l=a.options,e.prev=8,r.process){e.next=12;break}return n.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),e.abrupt("return");case 12:return e.next=14,r.process(s,l);case 14:n.postMessage("done",{id:o,result:e.sent}),e.next=22;break;case 18:e.prev=18,e.t1=e.catch(8),u=e.t1 instanceof Error?e.t1.message:"unknown error",n.postMessage("error",{id:o,error:u});case 22:return e.abrupt("break",24);case 23:console.warn("process-on-worker: unknown message ".concat(i));case 24:case"end":return e.stop()}}),e,null,[[8,18]])}))),l.apply(this,arguments)}return processOnWorker}var createWorker={},asyncQueue$1={},hasRequiredAsyncQueue$1,hasRequiredCreateWorker;function requireAsyncQueue$1(){if(hasRequiredAsyncQueue$1)return asyncQueue$1;hasRequiredAsyncQueue$1=1;var e=interopRequireDefaultExports;Object.defineProperty(asyncQueue$1,"__esModule",{value:!0}),asyncQueue$1.default=void 0;var t,r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty());t=Symbol.asyncIterator;var a=function(){function e(){(0,r.default)(this,e),(0,i.default)(this,"_values",void 0),(0,i.default)(this,"_settlers",void 0),(0,i.default)(this,"_closed",void 0),this._values=[],this._settlers=[],this._closed=!1}return(0,n.default)(e,[{key:t,value:function(){return this}},{key:"push",value:function(e){return this.enqueue(e)}},{key:"enqueue",value:function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.push(e)}},{key:"close",value:function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0}},{key:"next",value:function(){var e=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(t,r){e._settlers.push({resolve:t,reject:r})}))}}]),e}();return asyncQueue$1.default=a,asyncQueue$1}function requireCreateWorker(){if(hasRequiredCreateWorker)return createWorker;hasRequiredCreateWorker=1;var e=interopRequireDefaultExports;Object.defineProperty(createWorker,"__esModule",{value:!0}),createWorker.createWorker=function(e,o){if(i.default.inWorkerThread()){var l,c={process:u};i.default.onmessage=(l=(0,r.default)(t.default.mark((function r(l,u){var d,h,f,p,m,g,_;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,t.t0=l,t.next="process"===t.t0?4:"process-in-batches"===t.t0?11:"input-batch"===t.t0?46:"input-done"===t.t0?48:50;break;case 4:if(e){t.next=6;break}throw new Error("Worker does not support atomic processing");case 6:return t.next=8,e(u.input,u.options||{},c);case 8:return i.default.postMessage("done",{result:t.sent}),t.abrupt("break",50);case 11:if(o){t.next=13;break}throw new Error("Worker does not support batched processing");case 13:s=new n.default,d=o(s,u.options||{},c),h=!1,f=!1,t.prev=18,m=a(d);case 20:return t.next=22,m.next();case 22:if(!(h=!(g=t.sent).done)){t.next=28;break}i.default.postMessage("output-batch",{result:g.value});case 25:h=!1,t.next=20;break;case 28:t.next=34;break;case 30:t.prev=30,t.t1=t.catch(18),f=!0,p=t.t1;case 34:if(t.prev=34,t.prev=35,!h||null==m.return){t.next=39;break}return t.next=39,m.return();case 39:if(t.prev=39,!f){t.next=42;break}throw p;case 42:return t.finish(39);case 43:return t.finish(34);case 44:return i.default.postMessage("done",{}),t.abrupt("break",50);case 46:return s.push(u.input),t.abrupt("break",50);case 48:return s.close(),t.abrupt("break",50);case 50:t.next=56;break;case 52:t.prev=52,t.t2=t.catch(0),_=t.t2 instanceof Error?t.t2.message:"",i.default.postMessage("error",{error:_});case 56:case"end":return t.stop()}}),r,null,[[0,52],[18,30,34,44],[35,,39,43]])}))),function(e,t){return l.apply(this,arguments)})}};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireAsyncQueue$1()),i=e(requireWorkerBody());function a(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new o(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function o(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return o=function(e){this.s=e,this.n=e.next},o.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new o(e)}var s,l=0;function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r,n){var a=l++;i.default.addEventListener((function e(t,o){if(o.id===a)switch(t){case"done":i.default.removeEventListener(e),r(o.result);break;case"error":i.default.removeEventListener(e),n(o.error)}})),i.default.postMessage("process",{id:a,input:e,options:t})}))}return createWorker}var validateWorkerVersion={},hasRequiredValidateWorkerVersion;function requireValidateWorkerVersion(){if(hasRequiredValidateWorkerVersion)return validateWorkerVersion;hasRequiredValidateWorkerVersion=1,Object.defineProperty(validateWorkerVersion,"__esModule",{value:!0}),validateWorkerVersion.validateWorkerVersion=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.VERSION;return(0,e.assert)(r,"no worker provided"),!(!n||!r.version)};var e=requireAssert$a(),t=requireVersion$5();return validateWorkerVersion}var libraryUtils={},requireUtils_browser={},hasRequiredRequireUtils_browser,hasRequiredLibraryUtils;function requireRequireUtils_browser(){return hasRequiredRequireUtils_browser||(hasRequiredRequireUtils_browser=1,Object.defineProperty(requireUtils_browser,"__esModule",{value:!0}),requireUtils_browser.requireFromString=requireUtils_browser.requireFromFile=requireUtils_browser.readFileAsText=requireUtils_browser.readFileAsArrayBuffer=void 0,requireUtils_browser.readFileAsArrayBuffer=null,requireUtils_browser.readFileAsText=null,requireUtils_browser.requireFromFile=null,requireUtils_browser.requireFromString=null),requireUtils_browser}function requireLibraryUtils(){if(hasRequiredLibraryUtils)return libraryUtils;hasRequiredLibraryUtils=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(libraryUtils,"__esModule",{value:!0}),libraryUtils.getLibraryUrl=d,libraryUtils.loadLibrary=function(e){return c.apply(this,arguments)};var r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=requireGlobals$3(),a=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=s(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireRequireUtils_browser()),o=requireAssert$a();function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}requireVersion$5();var l="3.4.14",u={};function c(){return c=(0,n.default)(r.default.mark((function e(t){var n,i,a=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},(n=a.length>1&&void 0!==a[1]?a[1]:null)&&(t=d(t,n,i)),u[t]=u[t]||h(t),e.next=6,u[t];case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e,t,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:i.isBrowser?r.CDN?((0,o.assert)(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(t,"@").concat(l,"/dist/libs/").concat(e)):i.isWorker?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}function h(e){return f.apply(this,arguments)}function f(){return(f=(0,n.default)(r.default.mark((function e(t){var n,o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.endsWith("wasm")){e.next=7;break}return e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.arrayBuffer();case 6:return e.abrupt("return",e.sent);case 7:if(i.isBrowser){e.next=20;break}if(e.prev=8,e.t0=a&&a.requireFromFile,!e.t0){e.next=14;break}return e.next=13,a.requireFromFile(t);case 13:e.t0=e.sent;case 14:return e.abrupt("return",e.t0);case 17:return e.prev=17,e.t1=e.catch(8),e.abrupt("return",null);case 20:if(!i.isWorker){e.next=22;break}return e.abrupt("return",importScripts(t));case 22:return e.next=24,fetch(t);case 24:return o=e.sent,e.next=27,o.text();case 27:return e.abrupt("return",p(e.sent,t));case 29:case"end":return e.stop()}}),e,null,[[8,17]])})))).apply(this,arguments)}function p(e,t){if(!i.isBrowser)return a.requireFromString&&a.requireFromString(e,t);if(i.isWorker)return eval.call(i.global,e),null;var r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}return libraryUtils}var _nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),require$$16=getAugmentedNamespace(_nodeResolve_empty$1),hasRequiredEs5$b;function requireEs5$b(){return hasRequiredEs5$b||(hasRequiredEs5$b=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AsyncQueue",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"ChildProcessProxy",{enumerable:!0,get:function(){return _.default}}),e.NullWorker=void 0,Object.defineProperty(e,"WorkerBody",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"WorkerFarm",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"WorkerJob",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"WorkerPool",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"WorkerThread",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return n.assert}}),Object.defineProperty(e,"canProcessOnWorker",{enumerable:!0,get:function(){return c.canProcessOnWorker}}),Object.defineProperty(e,"createWorker",{enumerable:!0,get:function(){return d.createWorker}}),Object.defineProperty(e,"getLibraryUrl",{enumerable:!0,get:function(){return m.getLibraryUrl}}),Object.defineProperty(e,"getTransferList",{enumerable:!0,get:function(){return p.getTransferList}}),Object.defineProperty(e,"getTransferListForWriter",{enumerable:!0,get:function(){return p.getTransferListForWriter}}),Object.defineProperty(e,"getWorkerURL",{enumerable:!0,get:function(){return h.getWorkerURL}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return i.isBrowser}}),Object.defineProperty(e,"isWorker",{enumerable:!0,get:function(){return i.isWorker}}),Object.defineProperty(e,"loadLibrary",{enumerable:!0,get:function(){return m.loadLibrary}}),Object.defineProperty(e,"processOnWorker",{enumerable:!0,get:function(){return c.processOnWorker}}),Object.defineProperty(e,"validateWorkerVersion",{enumerable:!0,get:function(){return f.validateWorkerVersion}});var r=requireVersion$5(),n=requireAssert$a(),i=requireGlobals$3(),a=t(requireWorkerJob()),o=t(requireWorkerThread()),s=t(requireWorkerFarm()),l=t(requireWorkerPool()),u=t(requireWorkerBody()),c=requireProcessOnWorker(),d=requireCreateWorker(),h=requireGetWorkerUrl(),f=requireValidateWorkerVersion(),p=requireGetTransferList(),m=requireLibraryUtils(),g=t(requireAsyncQueue$1()),_=t(require$$16);e.NullWorker={id:"null",name:"null",module:"worker-utils",version:r.VERSION,options:{null:{}}}}(es5$s)),es5$s}var _interopRequireDefault$L=interopRequireDefaultExports;Object.defineProperty(createLoaderWorker$1,"__esModule",{value:!0}),createLoaderWorker$1.createLoaderWorker=createLoaderWorker;var _regenerator$n=_interopRequireDefault$L(requireRegenerator()),_defineProperty2$j=_interopRequireDefault$L(requireDefineProperty()),_asyncToGenerator2$i=_interopRequireDefault$L(requireAsyncToGenerator()),_workerUtils$4=requireEs5$b();function ownKeys$c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$c(Object(r),!0).forEach((function(t){(0,_defineProperty2$j.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var requestId=0;function createLoaderWorker(e){var t;_workerUtils$4.WorkerBody.inWorkerThread()&&(_workerUtils$4.WorkerBody.onmessage=(t=(0,_asyncToGenerator2$i.default)(_regenerator$n.default.mark((function t(r,n){var i,a,o,s,l,u;return _regenerator$n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r,t.next="process"===t.t0?3:16;break;case 3:return t.prev=3,i=n.input,o=void 0===(a=n.options)?{}:a,l=void 0===(s=n.context)?{}:s,t.next=7,parseData({loader:e,arrayBuffer:i,options:o,context:_objectSpread$c(_objectSpread$c({},l),{},{parse:parseOnMainThread})});case 7:_workerUtils$4.WorkerBody.postMessage("done",{result:t.sent}),t.next=15;break;case 11:t.prev=11,t.t1=t.catch(3),u=t.t1 instanceof Error?t.t1.message:"",_workerUtils$4.WorkerBody.postMessage("error",{error:u});case 15:return t.abrupt("break",16);case 16:case"end":return t.stop()}}),t,null,[[3,11]])}))),function(e,r){return t.apply(this,arguments)}))}function parseOnMainThread(e,t){return new Promise((function(r,n){var i=requestId++;_workerUtils$4.WorkerBody.addEventListener((function e(t,a){if(a.id===i)switch(t){case"done":_workerUtils$4.WorkerBody.removeEventListener(e),r(a.result);break;case"error":_workerUtils$4.WorkerBody.removeEventListener(e),n(a.error)}})),_workerUtils$4.WorkerBody.postMessage("process",{id:i,input:e,options:t})}))}function parseData(e){return _parseData.apply(this,arguments)}function _parseData(){return _parseData=(0,_asyncToGenerator2$i.default)(_regenerator$n.default.mark((function e(t){var r,n,i,a,o,s,l;return _regenerator$n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.arrayBuffer,i=t.options,a=t.context,!(r=t.loader).parseSync&&!r.parse){e.next=6;break}o=n,s=r.parseSync||r.parse,e.next=13;break;case 6:if(!r.parseTextSync){e.next=12;break}l=new TextDecoder,o=l.decode(n),s=r.parseTextSync,e.next=13;break;case 12:throw new Error("Could not load data with ".concat(r.name," loader"));case 13:return i=_objectSpread$c(_objectSpread$c({},i),{},{modules:r&&r.options&&r.options.modules||{},worker:!1}),e.next=16,s(o,_objectSpread$c({},i),a,r);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)}))),_parseData.apply(this,arguments)}var parseWithWorker$1={},_interopRequireDefault$K=interopRequireDefaultExports;Object.defineProperty(parseWithWorker$1,"__esModule",{value:!0}),parseWithWorker$1.canParseWithWorker=canParseWithWorker,parseWithWorker$1.parseWithWorker=parseWithWorker;var _regenerator$m=_interopRequireDefault$K(requireRegenerator()),_asyncToGenerator2$h=_interopRequireDefault$K(requireAsyncToGenerator()),_workerUtils$3=requireEs5$b();function canParseWithWorker(e,t){return!!_workerUtils$3.WorkerFarm.isSupported()&&!!(_workerUtils$3.isBrowser||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}function parseWithWorker(e,t,r,n,i){return _parseWithWorker.apply(this,arguments)}function _parseWithWorker(){return _parseWithWorker=(0,_asyncToGenerator2$h.default)(_regenerator$m.default.mark((function e(t,r,n,i,a){var o,s,l,u,c,d;return _regenerator$m.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.id,s=(0,_workerUtils$3.getWorkerURL)(t,n),l=_workerUtils$3.WorkerFarm.getWorkerFarm(n),u=l.getWorkerPool({name:o,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),e.next=8,u.startJob("process-on-worker",onMessage.bind(null,a));case 8:return(c=e.sent).postMessage("process",{input:r,options:n,context:i}),e.next=12,c.result;case 12:return d=e.sent,e.next=15,d.result;case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)}))),_parseWithWorker.apply(this,arguments)}function onMessage(e,t,r,n){return _onMessage.apply(this,arguments)}function _onMessage(){return _onMessage=(0,_asyncToGenerator2$h.default)(_regenerator$m.default.mark((function e(t,r,n,i){var a,o,s,l;return _regenerator$m.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="done"===e.t0?3:"error"===e.t0?5:"process"===e.t0?7:20;break;case 3:return r.done(i),e.abrupt("break",21);case 5:return r.error(new Error(i.error)),e.abrupt("break",21);case 7:return a=i.id,o=i.input,s=i.options,e.prev=8,e.next=11,t(o,s);case 11:r.postMessage("done",{id:a,result:e.sent}),e.next=19;break;case 15:e.prev=15,e.t1=e.catch(8),l=e.t1 instanceof Error?e.t1.message:"unknown error",r.postMessage("error",{id:a,error:l});case 19:return e.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return e.stop()}}),e,null,[[8,15]])}))),_onMessage.apply(this,arguments)}var encodeWithWorker={};Object.defineProperty(encodeWithWorker,"__esModule",{value:!0}),encodeWithWorker.canEncodeWithWorker=canEncodeWithWorker;var _workerUtils$2=requireEs5$b(),_globals=globals$5;function canEncodeWithWorker(e,t){return!!_workerUtils$2.WorkerFarm.isSupported()&&!!(_globals.isBrowser||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}var parseJson={},getFirstCharacters$2={};function getFirstCharacters$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?getMagicString$2(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?getMagicString$2(e,0,t):""}function getMagicString$2(e,t,r){if(e.byteLength<=t+r)return"";for(var n=new DataView(e),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(t+a));return i}Object.defineProperty(getFirstCharacters$2,"__esModule",{value:!0}),getFirstCharacters$2.getFirstCharacters=getFirstCharacters$1,getFirstCharacters$2.getMagicString=getMagicString$2,Object.defineProperty(parseJson,"__esModule",{value:!0}),parseJson.parseJSON=parseJSON;var _getFirstCharacters=getFirstCharacters$2;function parseJSON(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat((0,_getFirstCharacters.getFirstCharacters)(e),'"'))}}var arrayBufferUtils={};function _createForOfIteratorHelper$9(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$9(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$9(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$9(e,t):void 0}}function _arrayLikeToArray$9(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function compareArrayBuffers(e,t,r){if(e.byteLength<(r=r||e.byteLength)||t.byteLength<r)return!1;for(var n=new Uint8Array(e),i=new Uint8Array(t),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function concatenateArrayBuffers(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=t.map((function(e){return e instanceof ArrayBuffer?new Uint8Array(e):e})),a=i.reduce((function(e,t){return e+t.byteLength}),0),o=new Uint8Array(a),s=0,l=_createForOfIteratorHelper$9(i);try{for(l.s();!(n=l.n()).done;){var u=n.value;o.set(u,s),s+=u.byteLength}}catch(e){l.e(e)}finally{l.f()}return o.buffer}function concatenateTypedArrays(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t,i=n&&n.length>1&&n[0].constructor||null;if(!i)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');for(var a=new i(n.reduce((function(e,t){return e+t.length}),0)),o=0,s=0,l=n;s<l.length;s++){var u=l[s];a.set(u,o),o+=u.length}return a}function sliceArrayBuffer(e,t,r){var n=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}Object.defineProperty(arrayBufferUtils,"__esModule",{value:!0}),arrayBufferUtils.compareArrayBuffers=compareArrayBuffers,arrayBufferUtils.concatenateArrayBuffers=concatenateArrayBuffers,arrayBufferUtils.concatenateTypedArrays=concatenateTypedArrays,arrayBufferUtils.sliceArrayBuffer=sliceArrayBuffer;var memoryCopyUtils={};Object.defineProperty(memoryCopyUtils,"__esModule",{value:!0}),memoryCopyUtils.copyArrayBuffer=copyArrayBuffer,memoryCopyUtils.copyToArray=copyToArray,memoryCopyUtils.padToNBytes=padToNBytes;var _assert$5=assert$f;function padToNBytes(e,t){return(0,_assert$5.assert)(e>=0),(0,_assert$5.assert)(t>0),e+(t-1)&~(t-1)}function copyArrayBuffer(e,t,r){var n=new Uint8Array(e,r,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.byteLength),i=new Uint8Array(t);return n.set(i),e}function copyToArray(e,t,r){var n;return n=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer||e.arrayBuffer,e.byteOffset,e.byteLength),t.set(n,r),r+padToNBytes(n.byteLength,4)}var dataviewCopyUtils={};Object.defineProperty(dataviewCopyUtils,"__esModule",{value:!0}),dataviewCopyUtils.copyBinaryToDataView=copyBinaryToDataView,dataviewCopyUtils.copyPaddedArrayBufferToDataView=copyPaddedArrayBufferToDataView,dataviewCopyUtils.copyPaddedStringToDataView=copyPaddedStringToDataView,dataviewCopyUtils.copyStringToDataView=copyStringToDataView,dataviewCopyUtils.padStringToByteAlignment=padStringToByteAlignment;var _memoryCopyUtils=memoryCopyUtils;function padStringToByteAlignment(e,t){for(var r=e.length,n=Math.ceil(r/t)*t-r,i="",a=0;a<n;++a)i+=" ";return e+i}function copyStringToDataView(e,t,r,n){if(e)for(var i=0;i<n;i++)e.setUint8(t+i,r.charCodeAt(i));return t+n}function copyBinaryToDataView(e,t,r,n){if(e)for(var i=0;i<n;i++)e.setUint8(t+i,r[i]);return t+n}function copyPaddedArrayBufferToDataView(e,t,r,n){var i=(0,_memoryCopyUtils.padToNBytes)(r.byteLength,n),a=i-r.byteLength;if(e){var o=new Uint8Array(e.buffer,e.byteOffset+t,r.byteLength),s=new Uint8Array(r);o.set(s);for(var l=0;l<a;++l)e.setUint8(t+r.byteLength+l,32)}return t+i}function copyPaddedStringToDataView(e,t,r,n){return copyPaddedArrayBufferToDataView(e,t,(new TextEncoder).encode(r),n)}var textIterators={},awaitAsyncGenerator={exports:{}},OverloadYield={exports:{}},hasRequiredOverloadYield,hasRequiredAwaitAsyncGenerator;function requireOverloadYield(){return hasRequiredOverloadYield||(hasRequiredOverloadYield=1,function(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports}(OverloadYield)),OverloadYield.exports}function requireAwaitAsyncGenerator(){return hasRequiredAwaitAsyncGenerator||(hasRequiredAwaitAsyncGenerator=1,function(e){var t=requireOverloadYield();e.exports=function(e){return new t(e,0)},e.exports.__esModule=!0,e.exports.default=e.exports}(awaitAsyncGenerator)),awaitAsyncGenerator.exports}var wrapAsyncGenerator={exports:{}},AsyncGenerator={exports:{}},hasRequiredAsyncGenerator,hasRequiredWrapAsyncGenerator;function requireAsyncGenerator(){return hasRequiredAsyncGenerator||(hasRequiredAsyncGenerator=1,function(e){var t=requireOverloadYield();function r(e){var r,n;function i(r,n){try{var o=e[r](n),s=o.value,l=s instanceof t;Promise.resolve(l?s.v:s).then((function(t){if(l){var n="return"===r?"return":"next";if(!s.k||t.done)return i(n,t);t=e[n](t).value}a(o.done?"return":"normal",t)}),(function(e){i("throw",e)}))}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?i(r.key,r.arg):n=null}this._invoke=function(e,t){return new Promise((function(a,o){var s={key:e,arg:t,resolve:a,reject:o,next:null};n?n=n.next=s:(r=n=s,i(e,t))}))},"function"!=typeof e.return&&(this.return=void 0)}r.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},r.prototype.next=function(e){return this._invoke("next",e)},r.prototype.throw=function(e){return this._invoke("throw",e)},r.prototype.return=function(e){return this._invoke("return",e)},e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(AsyncGenerator)),AsyncGenerator.exports}function requireWrapAsyncGenerator(){return hasRequiredWrapAsyncGenerator||(hasRequiredWrapAsyncGenerator=1,function(e){var t=requireAsyncGenerator();e.exports=function(e){return function(){return new t(e.apply(this,arguments))}},e.exports.__esModule=!0,e.exports.default=e.exports}(wrapAsyncGenerator)),wrapAsyncGenerator.exports}var _interopRequireDefault$J=interopRequireDefaultExports;Object.defineProperty(textIterators,"__esModule",{value:!0}),textIterators.makeLineIterator=makeLineIterator,textIterators.makeNumberedLineIterator=makeNumberedLineIterator,textIterators.makeTextDecoderIterator=makeTextDecoderIterator,textIterators.makeTextEncoderIterator=makeTextEncoderIterator;var _regenerator$l=_interopRequireDefault$J(requireRegenerator()),_awaitAsyncGenerator2$4=_interopRequireDefault$J(requireAwaitAsyncGenerator()),_wrapAsyncGenerator2$4=_interopRequireDefault$J(requireWrapAsyncGenerator());function _asyncIterator$5(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator$5(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator$5(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator$5=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator$5.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator$5(e)}function makeTextDecoderIterator(e){return _makeTextDecoderIterator.apply(this,arguments)}function _makeTextDecoderIterator(){return _makeTextDecoderIterator=(0,_wrapAsyncGenerator2$4.default)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _regenerator$l.default.mark((function r(){var n,i,a,o,s,l,u;return _regenerator$l.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=new TextDecoder(void 0,t),i=!1,a=!1,r.prev=3,s=_asyncIterator$5(e);case 5:return r.next=7,(0,_awaitAsyncGenerator2$4.default)(s.next());case 7:if(!(i=!(l=r.sent).done)){r.next=14;break}return u=l.value,r.next=11,"string"==typeof u?u:n.decode(u,{stream:!0});case 11:i=!1,r.next=5;break;case 14:r.next=20;break;case 16:r.prev=16,r.t0=r.catch(3),a=!0,o=r.t0;case 20:if(r.prev=20,r.prev=21,!i||null==s.return){r.next=25;break}return r.next=25,(0,_awaitAsyncGenerator2$4.default)(s.return());case 25:if(r.prev=25,!a){r.next=28;break}throw o;case 28:return r.finish(25);case 29:return r.finish(20);case 30:case"end":return r.stop()}}),r,null,[[3,16,20,30],[21,,25,29]])}))()})),_makeTextDecoderIterator.apply(this,arguments)}function makeTextEncoderIterator(e){return _makeTextEncoderIterator.apply(this,arguments)}function _makeTextEncoderIterator(){return(_makeTextEncoderIterator=(0,_wrapAsyncGenerator2$4.default)(_regenerator$l.default.mark((function e(t){var r,n,i,a,o,s,l;return _regenerator$l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new TextEncoder,n=!1,i=!1,e.prev=3,o=_asyncIterator$5(t);case 5:return e.next=7,(0,_awaitAsyncGenerator2$4.default)(o.next());case 7:if(!(n=!(s=e.sent).done)){e.next=14;break}return l=s.value,e.next=11,"string"==typeof l?r.encode(l):l;case 11:n=!1,e.next=5;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),i=!0,a=e.t0;case 20:if(e.prev=20,e.prev=21,!n||null==o.return){e.next=25;break}return e.next=25,(0,_awaitAsyncGenerator2$4.default)(o.return());case 25:if(e.prev=25,!i){e.next=28;break}throw a;case 28:return e.finish(25);case 29:return e.finish(20);case 30:case"end":return e.stop()}}),e,null,[[3,16,20,30],[21,,25,29]])})))).apply(this,arguments)}function makeLineIterator(e){return _makeLineIterator.apply(this,arguments)}function _makeLineIterator(){return(_makeLineIterator=(0,_wrapAsyncGenerator2$4.default)(_regenerator$l.default.mark((function e(t){var r,n,i,a,o,s,l,u;return _regenerator$l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",n=!1,i=!1,e.prev=3,o=_asyncIterator$5(t);case 5:return e.next=7,(0,_awaitAsyncGenerator2$4.default)(o.next());case 7:if(!(n=!(s=e.sent).done)){e.next=21;break}r+=s.value,l=void 0;case 11:if(!((l=r.indexOf("\n"))>=0)){e.next=18;break}return u=r.slice(0,l+1),r=r.slice(l+1),e.next=16,u;case 16:e.next=11;break;case 18:n=!1,e.next=5;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(3),i=!0,a=e.t0;case 27:if(e.prev=27,e.prev=28,!n||null==o.return){e.next=32;break}return e.next=32,(0,_awaitAsyncGenerator2$4.default)(o.return());case 32:if(e.prev=32,!i){e.next=35;break}throw a;case 35:return e.finish(32);case 36:return e.finish(27);case 37:if(!(r.length>0)){e.next=40;break}return e.next=40,r;case 40:case"end":return e.stop()}}),e,null,[[3,23,27,37],[28,,32,36]])})))).apply(this,arguments)}function makeNumberedLineIterator(e){return _makeNumberedLineIterator.apply(this,arguments)}function _makeNumberedLineIterator(){return(_makeNumberedLineIterator=(0,_wrapAsyncGenerator2$4.default)(_regenerator$l.default.mark((function e(t){var r,n,i,a,o,s,l;return _regenerator$l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=1,n=!1,i=!1,e.prev=3,o=_asyncIterator$5(t);case 5:return e.next=7,(0,_awaitAsyncGenerator2$4.default)(o.next());case 7:if(!(n=!(s=e.sent).done)){e.next=15;break}return l=s.value,e.next=11,{counter:r,line:l};case 11:r++;case 12:n=!1,e.next=5;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),i=!0,a=e.t0;case 21:if(e.prev=21,e.prev=22,!n||null==o.return){e.next=26;break}return e.next=26,(0,_awaitAsyncGenerator2$4.default)(o.return());case 26:if(e.prev=26,!i){e.next=29;break}throw a;case 29:return e.finish(26);case 30:return e.finish(21);case 31:case"end":return e.stop()}}),e,null,[[3,17,21,31],[22,,26,30]])})))).apply(this,arguments)}var asyncIteration={},_interopRequireDefault$I=interopRequireDefaultExports;Object.defineProperty(asyncIteration,"__esModule",{value:!0}),asyncIteration.concatenateArrayBuffersAsync=concatenateArrayBuffersAsync,asyncIteration.concatenateStringsAsync=concatenateStringsAsync,asyncIteration.forEach=forEach;var _regenerator$k=_interopRequireDefault$I(requireRegenerator()),_asyncToGenerator2$g=_interopRequireDefault$I(requireAsyncToGenerator()),_arrayBufferUtils=arrayBufferUtils;function _asyncIterator$4(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator$4(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator$4(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator$4=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator$4.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator$4(e)}function forEach(e,t){return _forEach.apply(this,arguments)}function _forEach(){return(_forEach=(0,_asyncToGenerator2$g.default)(_regenerator$k.default.mark((function e(t,r){var n,i;return _regenerator$k.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,t.next();case 3:if(i=(n=e.sent).value,!n.done){e.next=9;break}return t.return(),e.abrupt("return");case 9:if(!r(i)){e.next=12;break}return e.abrupt("return");case 12:e.next=0;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function concatenateArrayBuffersAsync(e){return _concatenateArrayBuffersAsync.apply(this,arguments)}function _concatenateArrayBuffersAsync(){return _concatenateArrayBuffersAsync=(0,_asyncToGenerator2$g.default)(_regenerator$k.default.mark((function e(t){var r,n,i,a,o,s;return _regenerator$k.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=!1,i=!1,e.prev=3,o=_asyncIterator$4(t);case 5:return e.next=7,o.next();case 7:if(!(n=!(s=e.sent).done)){e.next=13;break}r.push(s.value);case 10:n=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),i=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!n||null==o.return){e.next=24;break}return e.next=24,o.return();case 24:if(e.prev=24,!i){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",_arrayBufferUtils.concatenateArrayBuffers.apply(void 0,r));case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])}))),_concatenateArrayBuffersAsync.apply(this,arguments)}function concatenateStringsAsync(e){return _concatenateStringsAsync.apply(this,arguments)}function _concatenateStringsAsync(){return _concatenateStringsAsync=(0,_asyncToGenerator2$g.default)(_regenerator$k.default.mark((function e(t){var r,n,i,a,o,s;return _regenerator$k.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=!1,i=!1,e.prev=3,o=_asyncIterator$4(t);case 5:return e.next=7,o.next();case 7:if(!(n=!(s=e.sent).done)){e.next=13;break}r.push(s.value);case 10:n=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),i=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!n||null==o.return){e.next=24;break}return e.next=24,o.return();case 24:if(e.prev=24,!i){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",r.join(""));case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])}))),_concatenateStringsAsync.apply(this,arguments)}var requestScheduler={},dist$3,hasRequiredDist$3,hasRequiredRequestScheduler;function requireDist$3(){if(hasRequiredDist$3)return dist$3;hasRequiredDist$3=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};function o(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(a,{Stat:()=>s,Stats:()=>l,_getHiResTimestamp:()=>o}),e=a,dist$3=((e,a,o,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let o of n(a))i.call(e,o)||void 0===o||t(e,o,{get:()=>a[o],enumerable:!(s=r(a,o))||s.enumerable});return e})(t({},"__esModule",{value:!0}),e);var s=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=o(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(o()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},l=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(n=e instanceof s?e:new s(t,r),this.stats[t]=n),n}};return dist$3}function requireRequestScheduler(){if(hasRequiredRequestScheduler)return requestScheduler;hasRequiredRequestScheduler=1;var e=interopRequireDefaultExports;Object.defineProperty(requestScheduler,"__esModule",{value:!0}),requestScheduler.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireDist$3();function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s={id:"request-scheduler",throttleRequests:!0,maxRequests:6},l=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"props",void 0),(0,n.default)(this,"stats",void 0),(0,n.default)(this,"activeRequestCount",0),(0,n.default)(this,"requestQueue",[]),(0,n.default)(this,"requestMap",new Map),(0,n.default)(this,"deferredUpdate",null),this.props=o(o({},s),r),this.stats=new i.Stats({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}return(0,r.default)(e,[{key:"scheduleRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(e))return this.requestMap.get(e);var r={handle:e,priority:0,getPriority:t},n=new Promise((function(e){return r.resolve=e,r}));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}},{key:"_issueRequest",value:function(e){var t=this,r=e.handle,n=e.resolve,i=!1,a=function(){i||(i=!0,t.requestMap.delete(r),t.activeRequestCount--,t._issueNewRequests())};return this.activeRequestCount++,n?n({done:a}):Promise.resolve({done:a})}},{key:"_issueNewRequests",value:function(){var e=this;this.deferredUpdate||(this.deferredUpdate=setTimeout((function(){return e._issueNewRequestsAsync()}),0))}},{key:"_issueNewRequestsAsync",value:function(){this.deferredUpdate=null;var e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(var t=0;t<e;++t){var r=this.requestQueue.shift();r&&this._issueRequest(r)}}}},{key:"_updateAllRequests",value:function(){for(var e=this.requestQueue,t=0;t<e.length;++t){var r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((function(e,t){return e.priority-t.priority}))}},{key:"_updateRequest",value:function(e){return e.priority=e.getPriority(e.handle),!(e.priority<0&&(e.resolve(null),1))}}]),e}();return requestScheduler.default=l,requestScheduler}var fileAliases={},hasRequiredFileAliases;function requireFileAliases(){if(hasRequiredFileAliases)return fileAliases;hasRequiredFileAliases=1,Object.defineProperty(fileAliases,"__esModule",{value:!0}),fileAliases.addAliases=function(e){Object.assign(t,e)},fileAliases.getPathPrefix=function(){return e},fileAliases.resolvePath=function(r){for(var n in t)r.startsWith(n)&&(r=r.replace(n,t[n]));return r.startsWith("http://")||r.startsWith("https://")||(r="".concat(e).concat(r)),r},fileAliases.setPathPrefix=function(t){e=t};var e="",t={};return fileAliases}var jsonLoader$1={},hasRequiredJsonLoader$1;function requireJsonLoader$1(){if(hasRequiredJsonLoader$1)return jsonLoader$1;hasRequiredJsonLoader$1=1;var e=interopRequireDefaultExports;Object.defineProperty(jsonLoader$1,"__esModule",{value:!0}),jsonLoader$1._typecheckJSONLoader=jsonLoader$1.JSONLoader=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n={name:"JSON",id:"json",module:"json",version:"3.4.14",extensions:["json","geojson"],mimeTypes:["application/json"],category:"json",text:!0,parseTextSync:i,parse:function(){var e=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i((new TextDecoder).decode(r)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),options:{}};function i(e){return JSON.parse(e)}return jsonLoader$1.JSONLoader=n,jsonLoader$1._typecheckJSONLoader=n,jsonLoader$1}var memoryConversionUtils={},buffer_browser={},hasRequiredBuffer_browser,hasRequiredMemoryConversionUtils;function requireBuffer_browser(){return hasRequiredBuffer_browser||(hasRequiredBuffer_browser=1,Object.defineProperty(buffer_browser,"__esModule",{value:!0}),buffer_browser.toArrayBuffer=function(e){return e},buffer_browser.toBuffer=function(e){throw new Error("Buffer not supported in browser")}),buffer_browser}function requireMemoryConversionUtils(){if(hasRequiredMemoryConversionUtils)return memoryConversionUtils;hasRequiredMemoryConversionUtils=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(memoryConversionUtils,"__esModule",{value:!0}),memoryConversionUtils.isBuffer=a,memoryConversionUtils.toArrayBuffer=function(e){if(a(e))return n.toArrayBuffer(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"===(0,r.default)(e)&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")},memoryConversionUtils.toBuffer=function(e){return n.toBuffer?n.toBuffer(e):e};var r=e(_typeofExports),n=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i(void 0);if(n&&n.has(e))return n.get(e);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=e[s]}return a.default=e,n&&n.set(e,a),a}(requireBuffer_browser());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function a(e){return e&&"object"===(0,r.default)(e)&&e.isBuffer}return memoryConversionUtils}var promisify={},hasRequiredPromisify;function requirePromisify(){return hasRequiredPromisify||(hasRequiredPromisify=1,Object.defineProperty(promisify,"__esModule",{value:!0}),promisify.promisify1=function(e){return function(t){return new Promise((function(r,n){return e(t,(function(e,t){return e?n(e):r(t)}))}))}},promisify.promisify2=function(e){return function(t,r){return new Promise((function(n,i){return e(t,r,(function(e,t){return e?i(e):n(t)}))}))}},promisify.promisify3=function(e){return function(t,r,n){return new Promise((function(i,a){return e(t,r,n,(function(e,t){return e?a(e):i(t)}))}))}}),promisify}var path$1={},getCwd={},hasRequiredGetCwd,hasRequiredPath$1;function requireGetCwd(){return hasRequiredGetCwd||(hasRequiredGetCwd=1,Object.defineProperty(getCwd,"__esModule",{value:!0}),getCwd.getCWD=function(){var e;if("undefined"!=typeof process&&void 0!==process.cwd)return process.cwd();var t=null===(e=window.location)||void 0===e?void 0:e.pathname;return(null==t?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}),getCwd}function requirePath$1(){if(hasRequiredPath$1)return path$1;hasRequiredPath$1=1,Object.defineProperty(path$1,"__esModule",{value:!0}),path$1.dirname=function(e){var t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""},path$1.filename=function(e){var t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""},path$1.join=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(t=t.map((function(e,r){return r&&(e=e.replace(new RegExp("^".concat("/")),"")),r!==t.length-1&&(e=e.replace(new RegExp("".concat("/","$")),"")),e}))).join("/")},path$1.resolve=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=i<0||arguments.length<=i?void 0:arguments[i];for(var a,o="",s=!1,l=n.length-1;l>=-1&&!s;l--){var u=void 0;l>=0?u=n[l]:(void 0===a&&(a=(0,e.getCWD)()),u=a),0!==u.length&&(o="".concat(u,"/").concat(o),s=u.charCodeAt(0)===t)}return o=function(e,n){for(var i,a="",o=-1,s=0,l=!1,u=0;u<=e.length;++u){if(u<e.length)i=e.charCodeAt(u);else{if(i===t)break;i=t}if(i===t){if(o===u-1||1===s);else if(o!==u-1&&2===s){if(a.length<2||!l||a.charCodeAt(a.length-1)!==r||a.charCodeAt(a.length-2)!==r)if(a.length>2){for(var c=a.length-1,d=c;d>=0&&a.charCodeAt(d)!==t;--d);if(d!==c){a=-1===d?"":a.slice(0,d),o=u,s=0,l=!1;continue}}else if(2===a.length||1===a.length){a="",o=u,s=0,l=!1;continue}n&&(a.length>0?a+="/..":a="..",l=!0)}else{var h=e.slice(o+1,u);a.length>0?a+="/".concat(h):a=h,l=!1}o=u,s=0}else i===r&&-1!==s?++s:s=-1}return a}(o,!s),s?"/".concat(o):o.length>0?o:"."};var e=requireGetCwd(),t=47,r=46;return path$1}var fs_browser={},hasRequiredFs_browser;function requireFs_browser(){return hasRequiredFs_browser||(hasRequiredFs_browser=1,Object.defineProperty(fs_browser,"__esModule",{value:!0}),fs_browser.writeFileSync=fs_browser.writeFile=fs_browser.stat=fs_browser.readdir=fs_browser.readFileSync=fs_browser.readFile=fs_browser.read=fs_browser.open=fs_browser.isSupported=fs_browser.fstat=fs_browser.createWriteStream=fs_browser.close=fs_browser._readToArrayBuffer=void 0,fs_browser.readdir=null,fs_browser.stat=null,fs_browser.readFile=null,fs_browser.readFileSync=null,fs_browser.writeFile=null,fs_browser.writeFileSync=null,fs_browser.open=null,fs_browser.close=null,fs_browser.read=null,fs_browser.fstat=null,fs_browser.createWriteStream=null,fs_browser._readToArrayBuffer=null,fs_browser.isSupported=!1),fs_browser}var stream_browser={},hasRequiredStream_browser;function requireStream_browser(){return hasRequiredStream_browser||(hasRequiredStream_browser=1,Object.defineProperty(stream_browser,"__esModule",{value:!0}),stream_browser.isSupported=stream_browser.Transform=void 0,stream_browser.Transform=null,stream_browser.isSupported=!1),stream_browser}var readableFile={},hasRequiredReadableFile;function requireReadableFile(){if(hasRequiredReadableFile)return readableFile;hasRequiredReadableFile=1;var e=interopRequireDefaultExports;Object.defineProperty(readableFile,"__esModule",{value:!0}),readableFile.makeReadableFile=function(e){if(e instanceof ArrayBuffer){var n=e;return{read:(a=(0,r.default)(t.default.mark((function r(n,i){return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Buffer.from(e,n,i));case 1:case"end":return t.stop()}}),r)}))),function(e,t){return a.apply(this,arguments)}),close:(i=(0,r.default)(t.default.mark((function e(){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),size:n.byteLength}}var i,a,o,s,l=e;return{read:(s=(0,r.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.slice(r,r+n).arrayBuffer();case 2:return e.abrupt("return",Buffer.from(e.sent));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)}),close:(o=(0,r.default)(t.default.mark((function e(){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),size:l.size}};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator());return readableFile}var writableFile={},hasRequiredWritableFile;function requireWritableFile(){if(hasRequiredWritableFile)return writableFile;hasRequiredWritableFile=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(writableFile,"__esModule",{value:!0}),writableFile.makeWritableFile=function(e,t){if(i.isBrowser)return{write:(s=(0,n.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)}),close:(o=(0,n.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})};var o,s,l,u="string"==typeof e?a.createWriteStream(e,t):e;return{write:(l=(0,n.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){u.write(t,(function(t){return t?r(t):e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)}),close:function(){return new Promise((function(e,t){u.close((function(r){return r?t(r):e()}))}))}}};var r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=globals$5,a=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=o(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=a?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(requireFs_browser());function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}return writableFile}var nodeFilesystem={},hasRequiredNodeFilesystem;function requireNodeFilesystem(){if(hasRequiredNodeFilesystem)return nodeFilesystem;hasRequiredNodeFilesystem=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(nodeFilesystem,"__esModule",{value:!0}),nodeFilesystem.default=void 0;var r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=s(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireFs_browser());function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}var l=function(){function e(t){(0,i.default)(this,e),this.fetch=t._fetch}var t,s,l,u,c,d,h;return(0,a.default)(e,[{key:"readdir",value:(h=(0,n.default)(r.default.mark((function e(){var t,n,i=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:".",n=i.length>1?i[1]:void 0,e.next=4,o.readdir(t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"stat",value:(d=(0,n.default)(r.default.mark((function e(t,n){var i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.stat(t,n);case 2:return i=e.sent,e.abrupt("return",{size:Number(i.size),isDirectory:function(){return!1},info:i});case 4:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"fetch",value:(c=(0,n.default)(r.default.mark((function e(t,n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n.fetch||this.fetch)(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"open",value:(u=(0,n.default)(r.default.mark((function e(t,n,i){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.open(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"close",value:(l=(0,n.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.close(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"fstat",value:(s=(0,n.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.fstat(t);case 2:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"read",value:(t=(0,n.default)(r.default.mark((function e(t,n){var i,a,s,l,u,c,d,h,f;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=void 0===(i=n.buffer)?null:i,l=void 0===(s=n.offset)?0:s,c=void 0===(u=n.length)?a.byteLength:u,h=void 0===(d=n.position)?null:d,f=0;case 2:if(!(f<c)){e.next=10;break}return e.next=5,o.read(t,a,l+f,c-f,h+f);case 5:f+=e.sent.bytesRead,e.next=2;break;case 10:return e.abrupt("return",{bytesRead:f,buffer:a});case 11:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}();return nodeFilesystem.default=l,nodeFilesystem}!function(e){var t=interopRequireDefaultExports,r=_typeofExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"JSONLoader",{enumerable:!0,get:function(){return y.JSONLoader}}),Object.defineProperty(e,"RequestScheduler",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"_NodeFileSystem",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(e,"_addAliases",{enumerable:!0,get:function(){return _.addAliases}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return n.assert}}),Object.defineProperty(e,"canEncodeWithWorker",{enumerable:!0,get:function(){return l.canEncodeWithWorker}}),Object.defineProperty(e,"canParseWithWorker",{enumerable:!0,get:function(){return s.canParseWithWorker}}),Object.defineProperty(e,"compareArrayBuffers",{enumerable:!0,get:function(){return c.compareArrayBuffers}}),Object.defineProperty(e,"concatenateArrayBuffers",{enumerable:!0,get:function(){return c.concatenateArrayBuffers}}),Object.defineProperty(e,"concatenateArrayBuffersAsync",{enumerable:!0,get:function(){return m.concatenateArrayBuffersAsync}}),Object.defineProperty(e,"concatenateTypedArrays",{enumerable:!0,get:function(){return c.concatenateTypedArrays}}),Object.defineProperty(e,"copyArrayBuffer",{enumerable:!0,get:function(){return d.copyArrayBuffer}}),Object.defineProperty(e,"copyBinaryToDataView",{enumerable:!0,get:function(){return h.copyBinaryToDataView}}),Object.defineProperty(e,"copyPaddedArrayBufferToDataView",{enumerable:!0,get:function(){return h.copyPaddedArrayBufferToDataView}}),Object.defineProperty(e,"copyPaddedStringToDataView",{enumerable:!0,get:function(){return h.copyPaddedStringToDataView}}),Object.defineProperty(e,"copyStringToDataView",{enumerable:!0,get:function(){return h.copyStringToDataView}}),Object.defineProperty(e,"copyToArray",{enumerable:!0,get:function(){return d.copyToArray}}),Object.defineProperty(e,"createLoaderWorker",{enumerable:!0,get:function(){return o.createLoaderWorker}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return i.document}}),Object.defineProperty(e,"forEach",{enumerable:!0,get:function(){return m.forEach}}),e.fs=void 0,Object.defineProperty(e,"getFirstCharacters",{enumerable:!0,get:function(){return f.getFirstCharacters}}),Object.defineProperty(e,"getMagicString",{enumerable:!0,get:function(){return f.getMagicString}}),Object.defineProperty(e,"getPathPrefix",{enumerable:!0,get:function(){return _.getPathPrefix}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return i.global}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return i.isBrowser}}),Object.defineProperty(e,"isBuffer",{enumerable:!0,get:function(){return v.isBuffer}}),Object.defineProperty(e,"isWorker",{enumerable:!0,get:function(){return i.isWorker}}),Object.defineProperty(e,"makeLineIterator",{enumerable:!0,get:function(){return p.makeLineIterator}}),Object.defineProperty(e,"makeNumberedLineIterator",{enumerable:!0,get:function(){return p.makeNumberedLineIterator}}),Object.defineProperty(e,"makeReadableFile",{enumerable:!0,get:function(){return E.makeReadableFile}}),Object.defineProperty(e,"makeTextDecoderIterator",{enumerable:!0,get:function(){return p.makeTextDecoderIterator}}),Object.defineProperty(e,"makeTextEncoderIterator",{enumerable:!0,get:function(){return p.makeTextEncoderIterator}}),Object.defineProperty(e,"makeWritableFile",{enumerable:!0,get:function(){return A.makeWritableFile}}),Object.defineProperty(e,"mergeLoaderOptions",{enumerable:!0,get:function(){return a.mergeLoaderOptions}}),Object.defineProperty(e,"nodeVersion",{enumerable:!0,get:function(){return i.nodeVersion}}),Object.defineProperty(e,"padStringToByteAlignment",{enumerable:!0,get:function(){return h.padStringToByteAlignment}}),Object.defineProperty(e,"padToNBytes",{enumerable:!0,get:function(){return d.padToNBytes}}),Object.defineProperty(e,"parseJSON",{enumerable:!0,get:function(){return u.parseJSON}}),Object.defineProperty(e,"parseWithWorker",{enumerable:!0,get:function(){return s.parseWithWorker}}),e.path=void 0,Object.defineProperty(e,"promisify1",{enumerable:!0,get:function(){return b.promisify1}}),Object.defineProperty(e,"promisify2",{enumerable:!0,get:function(){return b.promisify2}}),Object.defineProperty(e,"resolvePath",{enumerable:!0,get:function(){return _.resolvePath}}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return i.self}}),Object.defineProperty(e,"setPathPrefix",{enumerable:!0,get:function(){return _.setPathPrefix}}),Object.defineProperty(e,"sliceArrayBuffer",{enumerable:!0,get:function(){return c.sliceArrayBuffer}}),e.stream=void 0,Object.defineProperty(e,"toArrayBuffer",{enumerable:!0,get:function(){return v.toArrayBuffer}}),Object.defineProperty(e,"toBuffer",{enumerable:!0,get:function(){return v.toBuffer}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return i.window}});var n=assert$f,i=globals$5,a=mergeLoaderOptions$1,o=createLoaderWorker$1,s=parseWithWorker$1,l=encodeWithWorker,u=parseJson,c=arrayBufferUtils,d=memoryCopyUtils,h=dataviewCopyUtils,f=getFirstCharacters$2,p=textIterators,m=asyncIteration,g=t(requireRequestScheduler()),_=requireFileAliases(),y=requireJsonLoader$1(),v=requireMemoryConversionUtils(),b=requirePromisify(),x=M(requirePath$1());e.path=x;var T=M(requireFs_browser());e.fs=T;var w=M(requireStream_browser());e.stream=w;var E=requireReadableFile(),A=requireWritableFile(),S=t(requireNodeFilesystem());function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(P=function(e){return e?r:t})(e)}function M(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}}(es5$t);var es5$r={},tileset3d={},es5$q={},vector2={},inherits={exports:{}},setPrototypeOf={exports:{}},hasRequiredSetPrototypeOf,hasRequiredInherits;function requireSetPrototypeOf(){return hasRequiredSetPrototypeOf||(hasRequiredSetPrototypeOf=1,function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(setPrototypeOf)),setPrototypeOf.exports}function requireInherits(){return hasRequiredInherits||(hasRequiredInherits=1,function(e){var t=requireSetPrototypeOf();e.exports=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&t(e,r)},e.exports.__esModule=!0,e.exports.default=e.exports}(inherits)),inherits.exports}var possibleConstructorReturn={exports:{}},assertThisInitialized={exports:{}},hasRequiredAssertThisInitialized,hasRequiredPossibleConstructorReturn;function requireAssertThisInitialized(){return hasRequiredAssertThisInitialized||(hasRequiredAssertThisInitialized=1,function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}(assertThisInitialized)),assertThisInitialized.exports}function requirePossibleConstructorReturn(){return hasRequiredPossibleConstructorReturn||(hasRequiredPossibleConstructorReturn=1,function(e){var t=_typeofExports.default,r=requireAssertThisInitialized();e.exports=function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(possibleConstructorReturn)),possibleConstructorReturn.exports}var getPrototypeOf={exports:{}},hasRequiredGetPrototypeOf;function requireGetPrototypeOf(){return hasRequiredGetPrototypeOf||(hasRequiredGetPrototypeOf=1,function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(getPrototypeOf)),getPrototypeOf.exports}var vector={},mathArray={},common$2={},assert$c={},hasRequiredAssert$9,hasRequiredCommon$1,hasRequiredMathArray;function requireAssert$9(){return hasRequiredAssert$9||(hasRequiredAssert$9=1,Object.defineProperty(assert$c,"__esModule",{value:!0}),assert$c.default=function(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}),assert$c}function requireCommon$1(){if(hasRequiredCommon$1)return common$2;hasRequiredCommon$1=1;var e=interopRequireDefaultExports;Object.defineProperty(common$2,"__esModule",{value:!0}),common$2.configure=function(e){for(var t in e)(0,r.default)(t in a),a[t]=e[t];return a},common$2.formatValue=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===t?a.precision:t;return e=function(e){return Math.round(e/a.EPSILON)*a.EPSILON}(e),"".concat(parseFloat(e.toPrecision(r)))},common$2.isArray=o,common$2.clone=function(e){return"clone"in e?e.clone():e.slice()},common$2.toRadians=function(e){return s(e)},common$2.toDegrees=function(e){return l(e)},common$2.radians=s,common$2.degrees=l,common$2.sin=function(e,t){return u(e,(function(e){return Math.sin(e)}),t)},common$2.cos=function(e,t){return u(e,(function(e){return Math.cos(e)}),t)},common$2.tan=function(e,t){return u(e,(function(e){return Math.tan(e)}),t)},common$2.asin=function(e,t){return u(e,(function(e){return Math.asin(e)}),t)},common$2.acos=function(e,t){return u(e,(function(e){return Math.acos(e)}),t)},common$2.atan=function(e,t){return u(e,(function(e){return Math.atan(e)}),t)},common$2.clamp=function(e,t,r){return u(e,(function(e){return Math.max(t,Math.min(r,e))}))},common$2.lerp=function e(t,r,n){return o(t)?t.map((function(t,i){return e(t,r[i],n)})):n*r+(1-n)*t},common$2.equals=function e(t,r,n){var i=a.EPSILON;n&&(a.EPSILON=n);try{if(t===r)return!0;if(o(t)&&o(r)){if(t.length!==r.length)return!1;for(var s=0;s<t.length;++s)if(!e(t[s],r[s]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):"number"==typeof t&&"number"==typeof r&&Math.abs(t-r)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(r))}finally{a.EPSILON=i}},common$2.exactEquals=function e(r,n){if(r===n)return!0;if(r&&"object"===(0,t.default)(r)&&n&&"object"===(0,t.default)(n)){if(r.constructor!==n.constructor)return!1;if(r.exactEquals)return r.exactEquals(n)}if(o(r)&&o(n)){if(r.length!==n.length)return!1;for(var i=0;i<r.length;++i)if(!e(r[i],n[i]))return!1;return!0}return!1},common$2.withEpsilon=function(e,t){var r,n=a.EPSILON;a.EPSILON=e;try{r=t()}finally{a.EPSILON=n}return r},common$2.config=void 0;var t=e(_typeofExports),r=e(requireAssert$9()),n=1/Math.PI*180,i=1/180*Math.PI,a={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function o(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function s(e,t){return u(e,(function(e){return e*i}),t)}function l(e,t){return u(e,(function(e){return e*n}),t)}function u(e,t,r){if(o(e)){var n=e;r=r||function(e){return e.clone?e.clone():new Array(e.length)}(n);for(var i=0;i<r.length&&i<n.length;++i)r[i]=t(e[i],i,r);return r}return t(e)}return common$2.config=a,common$2}function requireMathArray(){if(hasRequiredMathArray)return mathArray;hasRequiredMathArray=1;var e=interopRequireDefaultExports;Object.defineProperty(mathArray,"__esModule",{value:!0}),mathArray.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=requireCommon$1(),s=function(e){(0,n.default)(c,e);var s,l,u=(s=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(s);if(l){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function c(){return(0,t.default)(this,c),u.apply(this,arguments)}return(0,r.default)(c,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}},{key:"from",value:function(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}},{key:"to",value:function(e){return e===this?this:(0,o.isArray)(e)?this.toArray(e):this.toObject(e)}},{key:"toTarget",value:function(e){return e?this.to(e):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(o.config)}},{key:"formatString",value:function(e){for(var t="",r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+(0,o.formatValue)(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!(0,o.equals)(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"lerp",value:function(e,t,r){if(void 0===r)return this.lerp(this,e,t);for(var n=0;n<this.ELEMENTS;++n){var i=e[n];this[n]=i+r*(t[n]-i)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(e){if("number"==typeof e)for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(var r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}},{key:"multiplyByScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"check",value:function(){if(o.config.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var e=this.length===this.ELEMENTS,t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"divideScalar",value:function(e){return this.multiplyByScalar(1/e)}},{key:"clampScalar",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}},{key:"elements",get:function(){return this}}]),c}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));return mathArray.default=s,mathArray}var validators={},hasRequiredValidators,hasRequiredVector;function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1,Object.defineProperty(validators,"__esModule",{value:!0}),validators.validateVector=t,validators.checkNumber=function(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e},validators.checkVector=function(r,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e.config.debug&&!t(r,n))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return r},validators.deprecated=function(e,t){r[e]||(r[e]=!0,console.warn("".concat(e," has been removed in version ").concat(t,", see upgrade guide for more information")))};var e=requireCommon$1();function t(e,t){if(e.length!==t)return!1;for(var r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}var r={};return validators}function requireVector(){if(hasRequiredVector)return vector;hasRequiredVector=1;var e=interopRequireDefaultExports;Object.defineProperty(vector,"__esModule",{value:!0}),vector.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireMathArray()),s=requireValidators(),l=e(requireAssert$9()),u=function(e){(0,n.default)(d,e);var o,u,c=(o=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(u){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"x",get:function(){return this[0]},set:function(e){this[0]=(0,s.checkNumber)(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=(0,s.checkNumber)(e)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-e[r];t+=n*n}return(0,s.checkNumber)(t)}},{key:"dot",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return(0,s.checkNumber)(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return(0,l.default)(e>=0&&e<this.ELEMENTS,"index is out of range"),(0,s.checkNumber)(this[e])}},{key:"setComponent",value:function(e,t){return(0,l.default)(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}]),d}(o.default);return vector.default=u,vector}var vec2={},common$1={},hasRequiredCommon,hasRequiredVec2;function requireCommon(){if(hasRequiredCommon)return common$1;hasRequiredCommon=1,Object.defineProperty(common$1,"__esModule",{value:!0}),common$1.setMatrixArrayType=function(e){common$1.ARRAY_TYPE=t=e},common$1.toRadian=function(e){return e*n},common$1.equals=function(t,r){return Math.abs(t-r)<=e*Math.max(1,Math.abs(t),Math.abs(r))},common$1.RANDOM=common$1.ARRAY_TYPE=common$1.EPSILON=void 0;var e=1e-6;common$1.EPSILON=e;var t="undefined"!=typeof Float32Array?Float32Array:Array;common$1.ARRAY_TYPE=t;var r=Math.random;common$1.RANDOM=r;var n=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),common$1}function requireVec2(){if(hasRequiredVec2)return vec2;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredVec2=1,Object.defineProperty(vec2,"__esModule",{value:!0}),vec2.create=n,vec2.clone=function(e){var r=new t.ARRAY_TYPE(2);return r[0]=e[0],r[1]=e[1],r},vec2.fromValues=function(e,r){var n=new t.ARRAY_TYPE(2);return n[0]=e,n[1]=r,n},vec2.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},vec2.set=function(e,t,r){return e[0]=t,e[1]=r,e},vec2.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},vec2.subtract=i,vec2.multiply=a,vec2.divide=o,vec2.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},vec2.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},vec2.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},vec2.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},vec2.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},vec2.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},vec2.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},vec2.distance=s,vec2.squaredDistance=l,vec2.length=u,vec2.squaredLength=c,vec2.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},vec2.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},vec2.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},vec2.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},vec2.lerp=function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},vec2.random=function(e,r){r=r||1;var n=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e},vec2.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},vec2.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},vec2.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},vec2.transformMat4=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},vec2.rotate=function(e,t,r,n){var i=t[0]-r[0],a=t[1]-r[1],o=Math.sin(n),s=Math.cos(n);return e[0]=i*s-a*o+r[0],e[1]=i*o+a*s+r[1],e},vec2.angle=function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],o=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+a*a);return Math.acos(Math.min(Math.max(o&&(r*i+n*a)/o,-1),1))},vec2.zero=function(e){return e[0]=0,e[1]=0,e},vec2.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},vec2.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},vec2.equals=function(e,r){var n=e[0],i=e[1],a=r[0],o=r[1];return Math.abs(n-a)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=t.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},vec2.forEach=vec2.sqrLen=vec2.sqrDist=vec2.dist=vec2.div=vec2.mul=vec2.sub=vec2.len=void 0;var t=function(t,n){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var i=r(void 0);if(i&&i.has(t))return i.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,i&&i.set(t,a),a}(requireCommon());function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(){var e=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function s(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function l(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function u(e){return Math.hypot(e[0],e[1])}function c(e){var t=e[0],r=e[1];return t*t+r*r}vec2.len=u,vec2.sub=i,vec2.mul=a,vec2.div=o,vec2.dist=s,vec2.sqrDist=l,vec2.sqrLen=c;var d,h=(d=n(),function(e,t,r,n,i,a){var o,s;for(t||(t=2),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)d[0]=e[o],d[1]=e[o+1],i(d,d,a),e[o]=d[0],e[o+1]=d[1];return e});return vec2.forEach=h,vec2}var glMatrixExtras={},hasRequiredGlMatrixExtras,hasRequiredVector2;function requireGlMatrixExtras(){return hasRequiredGlMatrixExtras||(hasRequiredGlMatrixExtras=1,Object.defineProperty(glMatrixExtras,"__esModule",{value:!0}),glMatrixExtras.vec2_transformMat4AsVector=function(e,t,r){var n=t[0],i=t[1],a=r[3]*n+r[7]*i||1;return e[0]=(r[0]*n+r[4]*i)/a,e[1]=(r[1]*n+r[5]*i)/a,e},glMatrixExtras.vec3_transformMat4AsVector=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a||1;return e[0]=(r[0]*n+r[4]*i+r[8]*a)/o,e[1]=(r[1]*n+r[5]*i+r[9]*a)/o,e[2]=(r[2]*n+r[6]*i+r[10]*a)/o,e},glMatrixExtras.vec3_transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2],e},glMatrixExtras.vec4_transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2],e[3]=t[3],e},glMatrixExtras.vec4_transformMat3=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n+r[3]*i+r[6]*a,e[1]=r[1]*n+r[4]*i+r[7]*a,e[2]=r[2]*n+r[5]*i+r[8]*a,e[3]=t[3],e}),glMatrixExtras}function requireVector2(){if(hasRequiredVector2)return vector2;hasRequiredVector2=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(vector2,"__esModule",{value:!0}),vector2.default=void 0;var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireVector()),l=requireCommon$1(),u=requireValidators(),c=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec2()),d=requireGlMatrixExtras();function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}var f=function(e){(0,i.default)(f,e);var t,s,h=(t=f,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function f(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,r.default)(this,f),e=h.call(this,2),(0,l.isArray)(t)&&1===arguments.length?e.copy(t):(l.config.debug&&((0,u.checkNumber)(t),(0,u.checkNumber)(n)),e[0]=t,e[1]=n),e}return(0,n.default)(f,[{key:"set",value:function(e,t){return this[0]=e,this[1]=t,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this.check()}},{key:"fromObject",value:function(e){return l.config.debug&&((0,u.checkNumber)(e.x),(0,u.checkNumber)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return c.transformMat4(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return(0,d.vec2_transformMat4AsVector)(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return c.transformMat3(this,this,e),this.check()}},{key:"transformByMatrix2x3",value:function(e){return c.transformMat2d(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return c.transformMat2(this,this,e),this.check()}}]),f}(s.default);return vector2.default=f,vector2}var vector3={},vec3={},hasRequiredVec3,hasRequiredVector3;function requireVec3(){if(hasRequiredVec3)return vec3;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredVec3=1,Object.defineProperty(vec3,"__esModule",{value:!0}),vec3.create=n,vec3.clone=function(e){var r=new t.ARRAY_TYPE(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},vec3.length=i,vec3.fromValues=function(e,r,n){var i=new t.ARRAY_TYPE(3);return i[0]=e,i[1]=r,i[2]=n,i},vec3.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},vec3.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},vec3.subtract=a,vec3.multiply=o,vec3.divide=s,vec3.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},vec3.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},vec3.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},vec3.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},vec3.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},vec3.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},vec3.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},vec3.distance=l,vec3.squaredDistance=u,vec3.squaredLength=c,vec3.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},vec3.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},vec3.dot=d,vec3.cross=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=i*l-a*s,e[1]=a*o-n*l,e[2]=n*s-i*o,e},vec3.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e},vec3.hermite=function(e,t,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*l+n[0]*u+i[0]*c,e[1]=t[1]*s+r[1]*l+n[1]*u+i[1]*c,e[2]=t[2]*s+r[2]*l+n[2]*u+i[2]*c,e},vec3.bezier=function(e,t,r,n,i,a){var o=1-a,s=o*o,l=a*a,u=s*o,c=3*a*s,d=3*l*o,h=l*a;return e[0]=t[0]*u+r[0]*c+n[0]*d+i[0]*h,e[1]=t[1]*u+r[1]*c+n[1]*d+i[1]*h,e[2]=t[2]*u+r[2]*c+n[2]*d+i[2]*h,e},vec3.random=function(e,r){r=r||1;var n=2*t.RANDOM()*Math.PI,i=2*t.RANDOM()-1,a=Math.sqrt(1-i*i)*r;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=i*r,e},vec3.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e},vec3.transformMat3=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},vec3.transformQuat=function(e,t,r){var n=r[0],i=r[1],a=r[2],o=t[0],s=t[1],l=t[2],u=i*l-a*s,c=a*o-n*l,d=n*s-i*o,h=i*d-a*c,f=a*u-n*d,p=n*c-i*u,m=2*r[3];return c*=m,d*=m,f*=2,p*=2,e[0]=o+(u*=m)+(h*=2),e[1]=s+c+f,e[2]=l+d+p,e},vec3.rotateX=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},vec3.rotateY=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},vec3.rotateZ=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},vec3.angle=function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],l=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(a*a+o*o+s*s),u=l&&d(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))},vec3.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},vec3.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},vec3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},vec3.equals=function(e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],l=r[2];return Math.abs(n-o)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=t.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-l)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))},vec3.forEach=vec3.sqrLen=vec3.len=vec3.sqrDist=vec3.dist=vec3.div=vec3.mul=vec3.sub=void 0;var t=function(t,n){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var i=r(void 0);if(i&&i.has(t))return i.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,i&&i.set(t,a),a}(requireCommon());function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(){var e=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e){return Math.hypot(e[0],e[1],e[2])}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function l(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function c(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}vec3.sub=a,vec3.mul=o,vec3.div=s,vec3.dist=l,vec3.sqrDist=u,vec3.len=i,vec3.sqrLen=c;var h,f=(h=n(),function(e,t,r,n,i,a){var o,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)h[0]=e[o],h[1]=e[o+1],h[2]=e[o+2],i(h,h,a),e[o]=h[0],e[o+1]=h[1],e[o+2]=h[2];return e});return vec3.forEach=f,vec3}function requireVector3(){if(hasRequiredVector3)return vector3;hasRequiredVector3=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(vector3,"__esModule",{value:!0}),vector3.default=void 0;var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireVector()),l=requireCommon$1(),u=requireValidators(),c=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec3()),d=requireGlMatrixExtras();function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}var f,p=[0,0,0],m=function(e){(0,i.default)(m,e);var t,s,h=(t=m,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function m(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,r.default)(this,m),e=h.call(this,-0,-0,-0),1===arguments.length&&(0,l.isArray)(t)?e.copy(t):(l.config.debug&&((0,u.checkNumber)(t),(0,u.checkNumber)(n),(0,u.checkNumber)(i)),e[0]=t,e[1]=n,e[2]=i),e}return(0,n.default)(m,[{key:"set",value:function(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}},{key:"fromObject",value:function(e){return l.config.debug&&((0,u.checkNumber)(e.x),(0,u.checkNumber)(e.y),(0,u.checkNumber)(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=(0,u.checkNumber)(e)}},{key:"angle",value:function(e){return c.angle(this,e)}},{key:"cross",value:function(e){return c.cross(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.origin;return c.rotateX(this,this,void 0===t?p:t,e.radians),this.check()}},{key:"rotateY",value:function(e){var t=e.origin;return c.rotateY(this,this,void 0===t?p:t,e.radians),this.check()}},{key:"rotateZ",value:function(e){var t=e.origin;return c.rotateZ(this,this,void 0===t?p:t,e.radians),this.check()}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return c.transformMat4(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return(0,d.vec3_transformMat4AsVector)(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return c.transformMat3(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return(0,d.vec3_transformMat2)(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return c.transformQuat(this,this,e),this.check()}}],[{key:"ZERO",get:function(){return f||(f=new m(0,0,0),Object.freeze(f)),f}}]),m}(s.default);return vector3.default=m,vector3}var vector4={},hasRequiredVector4;function requireVector4(){if(hasRequiredVector4)return vector4;hasRequiredVector4=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(vector4,"__esModule",{value:!0}),vector4.default=void 0;var r,n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireVector()),u=requireCommon$1(),c=requireValidators(),d=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=f(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec3()),h=requireGlMatrixExtras();function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}var p=function(e){(0,a.default)(p,e);var t,l,f=(t=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);if(l){var n=(0,s.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,o.default)(this,e)});function p(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.default)(this,p),e=f.call(this,-0,-0,-0,-0),(0,u.isArray)(t)&&1===arguments.length?e.copy(t):(u.config.debug&&((0,c.checkNumber)(t),(0,c.checkNumber)(r),(0,c.checkNumber)(i),(0,c.checkNumber)(a)),e[0]=t,e[1]=r,e[2]=i,e[3]=a),e}return(0,i.default)(p,[{key:"set",value:function(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}},{key:"fromObject",value:function(e){return u.config.debug&&((0,c.checkNumber)(e.x),(0,c.checkNumber)(e.y),(0,c.checkNumber)(e.z),(0,c.checkNumber)(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=(0,c.checkNumber)(e)}},{key:"w",get:function(){return this[3]},set:function(e){this[3]=(0,c.checkNumber)(e)}},{key:"transform",value:function(e){return d.transformMat4(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return(0,h.vec4_transformMat3)(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return(0,h.vec4_transformMat2)(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return d.transformQuat(this,this,e),this.check()}},{key:"applyMatrix4",value:function(e){return e.transform(this,this),this}}],[{key:"ZERO",get:function(){return r||(r=new p(0,0,0,0),Object.freeze(r)),r}}]),p}(l.default);return vector4.default=p,vector4}var matrix3={},matrix$1={},hasRequiredMatrix$1;function requireMatrix$1(){if(hasRequiredMatrix$1)return matrix$1;hasRequiredMatrix$1=1;var e=interopRequireDefaultExports;Object.defineProperty(matrix$1,"__esModule",{value:!0}),matrix$1.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireMathArray()),s=requireValidators(),l=requireCommon$1(),u=function(e){(0,n.default)(d,e);var o,u,c=(o=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(u){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"toString",value:function(){var e="[";if(l.config.printRowMajor){e+="row-major:";for(var t=0;t<this.RANK;++t)for(var r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(var n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+"]"}},{key:"getElementIndex",value:function(e,t){return t*this.RANK+e}},{key:"getElement",value:function(e,t){return this[t*this.RANK+e]}},{key:"setElement",value:function(e,t,r){return this[t*this.RANK+e]=(0,s.checkNumber)(r),this}},{key:"getColumn",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=e*this.RANK,n=0;n<this.RANK;++n)t[n]=this[r+n];return t}},{key:"setColumn",value:function(e,t){for(var r=e*this.RANK,n=0;n<this.RANK;++n)this[r+n]=t[n];return this}}]),d}(o.default);return matrix$1.default=u,matrix$1}var mat3={},hasRequiredMat3,hasRequiredMatrix3;function requireMat3(){if(hasRequiredMat3)return mat3;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredMat3=1,Object.defineProperty(mat3,"__esModule",{value:!0}),mat3.create=function(){var e=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},mat3.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat3.clone=function(e){var r=new t.ARRAY_TYPE(9);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r},mat3.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.fromValues=function(e,r,n,i,a,o,s,l,u){var c=new t.ARRAY_TYPE(9);return c[0]=e,c[1]=r,c[2]=n,c[3]=i,c[4]=a,c[5]=o,c[6]=s,c[7]=l,c[8]=u,c},mat3.set=function(e,t,r,n,i,a,o,s,l,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e},mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},mat3.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=c*o-s*u,h=-c*a+s*l,f=u*a-o*l,p=r*d+n*h+i*f;return p?(e[0]=d*(p=1/p),e[1]=(-c*n+i*u)*p,e[2]=(s*n-i*o)*p,e[3]=h*p,e[4]=(c*r-i*l)*p,e[5]=(-s*r+i*a)*p,e[6]=f*p,e[7]=(-u*r+n*l)*p,e[8]=(o*r-n*a)*p,e):null},mat3.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=i*u-n*c,e[2]=n*s-i*o,e[3]=s*l-a*c,e[4]=r*c-i*l,e[5]=i*a-r*s,e[6]=a*u-o*l,e[7]=n*l-r*u,e[8]=r*o-n*a,e},mat3.determinant=function(e){var t=e[3],r=e[4],n=e[5],i=e[6],a=e[7],o=e[8];return e[0]*(o*r-n*a)+e[1]*(-o*t+n*i)+e[2]*(a*t-r*i)},mat3.multiply=n,mat3.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=r[0],f=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=h*n+f*o+u,e[7]=h*i+f*s+c,e[8]=h*a+f*l+d,e},mat3.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=Math.sin(r),f=Math.cos(r);return e[0]=f*n+h*o,e[1]=f*i+h*s,e[2]=f*a+h*l,e[3]=f*o-h*n,e[4]=f*s-h*i,e[5]=f*l-h*a,e[6]=u,e[7]=c,e[8]=d,e},mat3.scale=function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},mat3.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},mat3.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,l=i+i,u=r*o,c=n*o,d=n*s,h=i*o,f=i*s,p=i*l,m=a*o,g=a*s,_=a*l;return e[0]=1-d-p,e[3]=c-_,e[6]=h+g,e[1]=c+_,e[4]=1-u-p,e[7]=f-m,e[2]=h-g,e[5]=f+m,e[8]=1-u-d,e},mat3.normalFromMat4=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*s-n*o,v=r*l-i*o,b=r*u-a*o,x=n*l-i*s,T=n*u-a*s,w=i*u-a*l,E=c*m-d*p,A=c*g-h*p,S=c*_-f*p,P=d*g-h*m,M=d*_-f*m,R=h*_-f*g,C=y*R-v*M+b*P+x*S-T*A+w*E;return C?(e[0]=(s*R-l*M+u*P)*(C=1/C),e[1]=(l*S-o*R-u*A)*C,e[2]=(o*M-s*S+u*E)*C,e[3]=(i*M-n*R-a*P)*C,e[4]=(r*R-i*S+a*A)*C,e[5]=(n*S-r*M-a*E)*C,e[6]=(m*w-g*T+_*x)*C,e[7]=(g*b-p*w-_*v)*C,e[8]=(p*T-m*b+_*y)*C,e):null},mat3.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},mat3.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},mat3.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},mat3.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},mat3.subtract=i,mat3.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},mat3.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},mat3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},mat3.equals=function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=r[0],f=r[1],p=r[2],m=r[3],g=r[4],_=r[5],y=r[6],v=r[7],b=r[8];return Math.abs(n-h)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-f)<=t.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-p)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-g)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-y)<=t.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-v)<=t.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(d-b)<=t.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},mat3.sub=mat3.mul=void 0;var t=function(t,n){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var i=r(void 0);if(i&&i.has(t))return i.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,i&&i.set(t,a),a}(requireCommon());function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=r[0],f=r[1],p=r[2],m=r[3],g=r[4],_=r[5],y=r[6],v=r[7],b=r[8];return e[0]=h*n+f*o+p*u,e[1]=h*i+f*s+p*c,e[2]=h*a+f*l+p*d,e[3]=m*n+g*o+_*u,e[4]=m*i+g*s+_*c,e[5]=m*a+g*l+_*d,e[6]=y*n+v*o+b*u,e[7]=y*i+v*s+b*c,e[8]=y*a+v*l+b*d,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}return mat3.mul=n,mat3.sub=i,mat3}function requireMatrix3(){if(hasRequiredMatrix3)return matrix3;hasRequiredMatrix3=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(matrix3,"__esModule",{value:!0}),matrix3.default=void 0;var r,n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireMatrix$1()),u=requireValidators(),c=requireGlMatrixExtras(),d=m(requireMat3()),h=m(requireVec2()),f=m(requireVec3());function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function m(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=p(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(r||(r={}));var g,_,y=Object.freeze([1,0,0,0,1,0,0,0,1]),v=function(e){(0,a.default)(m,e);var t,l,p=(t=m,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);if(l){var n=(0,s.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,o.default)(this,e)});function m(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(0,n.default)(this,m),t=p.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?t.copy(e):i.length>0?t.copy([e].concat(i)):t.identity(),t}return(0,i.default)(m,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return r}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}},{key:"identity",value:function(){return this.copy(y)}},{key:"fromObject",value:function(e){return this.check()}},{key:"fromQuaternion",value:function(e){return d.fromQuat(this,e),this.check()}},{key:"set",value:function(e,t,r,n,i,a,o,s,l){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=l,this.check()}},{key:"setRowMajor",value:function(e,t,r,n,i,a,o,s,l){return this[0]=e,this[1]=n,this[2]=o,this[3]=t,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=l,this.check()}},{key:"determinant",value:function(){return d.determinant(this)}},{key:"transpose",value:function(){return d.transpose(this,this),this.check()}},{key:"invert",value:function(){return d.invert(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return d.multiply(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return d.multiply(this,this,e),this.check()}},{key:"rotate",value:function(e){return d.rotate(this,this,e),this.check()}},{key:"scale",value:function(e){return Array.isArray(e)?d.scale(this,this,e):d.scale(this,this,[e,e]),this.check()}},{key:"translate",value:function(e){return d.translate(this,this,e),this.check()}},{key:"transform",value:function(e,t){var r;switch(e.length){case 2:r=h.transformMat3(t||[-0,-0],e,this);break;case 3:r=f.transformMat3(t||[-0,-0,-0],e,this);break;case 4:r=(0,c.vec4_transformMat3)(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return(0,u.checkVector)(r,e.length),r}},{key:"transformVector",value:function(e,t){return this.transform(e,t)}},{key:"transformVector2",value:function(e,t){return this.transform(e,t)}},{key:"transformVector3",value:function(e,t){return this.transform(e,t)}}],[{key:"IDENTITY",get:function(){return x()}},{key:"ZERO",get:function(){return b()}}]),m}(l.default);function b(){return g||(g=new v([0,0,0,0,0,0,0,0,0]),Object.freeze(g)),g}function x(){return _||(_=new v,Object.freeze(_)),_}return matrix3.default=v,matrix3}var matrix4={},mat4={},hasRequiredMat4;function requireMat4(){if(hasRequiredMat4)return mat4;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredMat4=1,Object.defineProperty(mat4,"__esModule",{value:!0}),mat4.create=function(){var e=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},mat4.clone=function(e){var r=new t.ARRAY_TYPE(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},mat4.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.fromValues=function(e,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g){var _=new t.ARRAY_TYPE(16);return _[0]=e,_[1]=r,_[2]=n,_[3]=i,_[4]=a,_[5]=o,_[6]=s,_[7]=l,_[8]=u,_[9]=c,_[10]=d,_[11]=h,_[12]=f,_[13]=p,_[14]=m,_[15]=g,_},mat4.set=function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=f,e[13]=p,e[14]=m,e[15]=g,e},mat4.identity=n,mat4.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},mat4.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15],y=r*s-n*o,v=r*l-i*o,b=r*u-a*o,x=n*l-i*s,T=n*u-a*s,w=i*u-a*l,E=c*m-d*p,A=c*g-h*p,S=c*_-f*p,P=d*g-h*m,M=d*_-f*m,R=h*_-f*g,C=y*R-v*M+b*P+x*S-T*A+w*E;return C?(e[0]=(s*R-l*M+u*P)*(C=1/C),e[1]=(i*M-n*R-a*P)*C,e[2]=(m*w-g*T+_*x)*C,e[3]=(h*T-d*w-f*x)*C,e[4]=(l*S-o*R-u*A)*C,e[5]=(r*R-i*S+a*A)*C,e[6]=(g*b-p*w-_*v)*C,e[7]=(c*w-h*b+f*v)*C,e[8]=(o*M-s*S+u*E)*C,e[9]=(n*S-r*M-a*E)*C,e[10]=(p*T-m*b+_*y)*C,e[11]=(d*b-c*T-f*y)*C,e[12]=(s*A-o*P-l*E)*C,e[13]=(r*P-n*A+i*E)*C,e[14]=(m*v-p*x-g*y)*C,e[15]=(c*x-d*v+h*y)*C,e):null},mat4.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(h*_-f*g)-d*(l*_-u*g)+m*(l*f-u*h),e[1]=-(n*(h*_-f*g)-d*(i*_-a*g)+m*(i*f-a*h)),e[2]=n*(l*_-u*g)-s*(i*_-a*g)+m*(i*u-a*l),e[3]=-(n*(l*f-u*h)-s*(i*f-a*h)+d*(i*u-a*l)),e[4]=-(o*(h*_-f*g)-c*(l*_-u*g)+p*(l*f-u*h)),e[5]=r*(h*_-f*g)-c*(i*_-a*g)+p*(i*f-a*h),e[6]=-(r*(l*_-u*g)-o*(i*_-a*g)+p*(i*u-a*l)),e[7]=r*(l*f-u*h)-o*(i*f-a*h)+c*(i*u-a*l),e[8]=o*(d*_-f*m)-c*(s*_-u*m)+p*(s*f-u*d),e[9]=-(r*(d*_-f*m)-c*(n*_-a*m)+p*(n*f-a*d)),e[10]=r*(s*_-u*m)-o*(n*_-a*m)+p*(n*u-a*s),e[11]=-(r*(s*f-u*d)-o*(n*f-a*d)+c*(n*u-a*s)),e[12]=-(o*(d*g-h*m)-c*(s*g-l*m)+p*(s*h-l*d)),e[13]=r*(d*g-h*m)-c*(n*g-i*m)+p*(n*h-i*d),e[14]=-(r*(s*g-l*m)-o*(n*g-i*m)+p*(n*l-i*s)),e[15]=r*(s*h-l*d)-o*(n*h-i*d)+c*(n*l-i*s),e},mat4.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*o-r*a)*(d*g-h*m)-(t*s-n*a)*(c*g-h*p)+(t*l-i*a)*(c*m-d*p)+(r*s-n*o)*(u*g-h*f)-(r*l-i*o)*(u*m-d*f)+(n*l-i*s)*(u*p-c*f)},mat4.multiply=i,mat4.translate=function(e,t,r){var n,i,a,o,s,l,u,c,d,h,f,p,m=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],e[0]=n=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=h,e[10]=f,e[11]=p,e[12]=n*m+s*g+d*_+t[12],e[13]=i*m+l*g+h*_+t[13],e[14]=a*m+u*g+f*_+t[14],e[15]=o*m+c*g+p*_+t[15]),e},mat4.scale=function(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.rotate=function(e,r,n,i){var a,o,s,l,u,c,d,h,f,p,m,g,_,y,v,b,x,T,w,E,A,S,P,M,R=i[0],C=i[1],O=i[2],L=Math.hypot(R,C,O);return L<t.EPSILON?null:(R*=L=1/L,C*=L,O*=L,a=Math.sin(n),o=Math.cos(n),u=r[1],c=r[2],d=r[3],f=r[5],p=r[6],m=r[7],_=r[9],y=r[10],v=r[11],w=R*C*(s=1-o)-O*a,E=C*C*s+o,A=O*C*s+R*a,S=R*O*s+C*a,P=C*O*s-R*a,M=O*O*s+o,e[0]=(l=r[0])*(b=R*R*s+o)+(h=r[4])*(x=C*R*s+O*a)+(g=r[8])*(T=O*R*s-C*a),e[1]=u*b+f*x+_*T,e[2]=c*b+p*x+y*T,e[3]=d*b+m*x+v*T,e[4]=l*w+h*E+g*A,e[5]=u*w+f*E+_*A,e[6]=c*w+p*E+y*A,e[7]=d*w+m*E+v*A,e[8]=l*S+h*P+g*M,e[9]=u*S+f*P+_*M,e[10]=c*S+p*P+y*M,e[11]=d*S+m*P+v*M,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},mat4.rotateX=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+u*n,e[5]=o*i+c*n,e[6]=s*i+d*n,e[7]=l*i+h*n,e[8]=u*i-a*n,e[9]=c*i-o*n,e[10]=d*i-s*n,e[11]=h*i-l*n,e},mat4.rotateY=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-u*n,e[1]=o*i-c*n,e[2]=s*i-d*n,e[3]=l*i-h*n,e[8]=a*n+u*i,e[9]=o*n+c*i,e[10]=s*n+d*i,e[11]=l*n+h*i,e},mat4.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+u*n,e[1]=o*i+c*n,e[2]=s*i+d*n,e[3]=l*i+h*n,e[4]=u*i-a*n,e[5]=c*i-o*n,e[6]=d*i-s*n,e[7]=h*i-l*n,e},mat4.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},mat4.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotation=function(e,r,n){var i,a,o,s=n[0],l=n[1],u=n[2],c=Math.hypot(s,l,u);return c<t.EPSILON?null:(s*=c=1/c,l*=c,u*=c,i=Math.sin(r),a=Math.cos(r),e[0]=s*s*(o=1-a)+a,e[1]=l*s*o+u*i,e[2]=u*s*o-l*i,e[3]=0,e[4]=s*l*o-u*i,e[5]=l*l*o+a,e[6]=u*l*o+s*i,e[7]=0,e[8]=s*u*o+l*i,e[9]=l*u*o-s*i,e[10]=u*u*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},mat4.fromXRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromYRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromZRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotationTranslation=a,mat4.fromQuat2=function(e,r){var n=new t.ARRAY_TYPE(3),i=-r[0],o=-r[1],s=-r[2],l=r[3],u=r[4],c=r[5],d=r[6],h=r[7],f=i*i+o*o+s*s+l*l;return f>0?(n[0]=2*(u*l+h*i+c*s-d*o)/f,n[1]=2*(c*l+h*o+d*i-u*s)/f,n[2]=2*(d*l+h*s+u*o-c*i)/f):(n[0]=2*(u*l+h*i+c*s-d*o),n[1]=2*(c*l+h*o+d*i-u*s),n[2]=2*(d*l+h*s+u*o-c*i)),a(e,r,n),e},mat4.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},mat4.getScaling=o,mat4.getRotation=function(e,r){var n=new t.ARRAY_TYPE(3);o(n,r);var i=1/n[0],a=1/n[1],s=1/n[2],l=r[0]*i,u=r[1]*a,c=r[2]*s,d=r[4]*i,h=r[5]*a,f=r[6]*s,p=r[8]*i,m=r[9]*a,g=r[10]*s,_=l+h+g,y=0;return _>0?(y=2*Math.sqrt(_+1),e[3]=.25*y,e[0]=(f-m)/y,e[1]=(p-c)/y,e[2]=(u-d)/y):l>h&&l>g?(y=2*Math.sqrt(1+l-h-g),e[3]=(f-m)/y,e[0]=.25*y,e[1]=(u+d)/y,e[2]=(p+c)/y):h>g?(y=2*Math.sqrt(1+h-l-g),e[3]=(p-c)/y,e[0]=(u+d)/y,e[1]=.25*y,e[2]=(f+m)/y):(y=2*Math.sqrt(1+g-l-h),e[3]=(u-d)/y,e[0]=(p+c)/y,e[1]=(f+m)/y,e[2]=.25*y),e},mat4.fromRotationTranslationScale=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],l=i+i,u=a+a,c=o+o,d=i*l,h=i*u,f=i*c,p=a*u,m=a*c,g=o*c,_=s*l,y=s*u,v=s*c,b=n[0],x=n[1],T=n[2];return e[0]=(1-(p+g))*b,e[1]=(h+v)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(h-v)*x,e[5]=(1-(d+g))*x,e[6]=(m+_)*x,e[7]=0,e[8]=(f+y)*T,e[9]=(m-_)*T,e[10]=(1-(d+p))*T,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},mat4.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){var a=t[0],o=t[1],s=t[2],l=t[3],u=a+a,c=o+o,d=s+s,h=a*u,f=a*c,p=a*d,m=o*c,g=o*d,_=s*d,y=l*u,v=l*c,b=l*d,x=n[0],T=n[1],w=n[2],E=i[0],A=i[1],S=i[2],P=(1-(m+_))*x,M=(f+b)*x,R=(p-v)*x,C=(f-b)*T,O=(1-(h+_))*T,L=(g+y)*T,I=(p+v)*w,D=(g-y)*w,k=(1-(h+m))*w;return e[0]=P,e[1]=M,e[2]=R,e[3]=0,e[4]=C,e[5]=O,e[6]=L,e[7]=0,e[8]=I,e[9]=D,e[10]=k,e[11]=0,e[12]=r[0]+E-(P*E+C*A+I*S),e[13]=r[1]+A-(M*E+O*A+D*S),e[14]=r[2]+S-(R*E+L*A+k*S),e[15]=1,e},mat4.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,l=i+i,u=r*o,c=n*o,d=n*s,h=i*o,f=i*s,p=i*l,m=a*o,g=a*s,_=a*l;return e[0]=1-d-p,e[1]=c+_,e[2]=h-g,e[3]=0,e[4]=c-_,e[5]=1-u-p,e[6]=f+m,e[7]=0,e[8]=h+g,e[9]=f-m,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.frustum=function(e,t,r,n,i,a,o){var s=1/(r-t),l=1/(i-n),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e},mat4.perspectiveNO=s,mat4.perspectiveZO=function(e,t,r,n,i){var a,o=1/Math.tan(t/2);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=i*(a=1/(n-i)),e[14]=i*n*a):(e[10]=-1,e[14]=-n),e},mat4.perspectiveFromFieldOfView=function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(i+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(i-a)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},mat4.orthoNO=l,mat4.orthoZO=function(e,t,r,n,i,a,o){var s=1/(t-r),l=1/(n-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=a*u,e[15]=1,e},mat4.lookAt=function(e,r,i,a){var o,s,l,u,c,d,h,f,p,m,g=r[0],_=r[1],y=r[2],v=a[0],b=a[1],x=a[2],T=i[0],w=i[1],E=i[2];return Math.abs(g-T)<t.EPSILON&&Math.abs(_-w)<t.EPSILON&&Math.abs(y-E)<t.EPSILON?n(e):(h=g-T,f=_-w,p=y-E,o=b*(p*=m=1/Math.hypot(h,f,p))-x*(f*=m),s=x*(h*=m)-v*p,l=v*f-b*h,(m=Math.hypot(o,s,l))?(o*=m=1/m,s*=m,l*=m):(o=0,s=0,l=0),u=f*l-p*s,c=p*o-h*l,d=h*s-f*o,(m=Math.hypot(u,c,d))?(u*=m=1/m,c*=m,d*=m):(u=0,c=0,d=0),e[0]=o,e[1]=u,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=f,e[7]=0,e[8]=l,e[9]=d,e[10]=p,e[11]=0,e[12]=-(o*g+s*_+l*y),e[13]=-(u*g+c*_+d*y),e[14]=-(h*g+f*_+p*y),e[15]=1,e)},mat4.targetTo=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=n[0],l=n[1],u=n[2],c=i-r[0],d=a-r[1],h=o-r[2],f=c*c+d*d+h*h;f>0&&(c*=f=1/Math.sqrt(f),d*=f,h*=f);var p=l*h-u*d,m=u*c-s*h,g=s*d-l*c;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=d*g-h*m,e[5]=h*p-c*g,e[6]=c*m-d*p,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},mat4.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},mat4.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},mat4.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},mat4.subtract=u,mat4.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},mat4.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},mat4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},mat4.equals=function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],f=e[10],p=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=r[0],b=r[1],x=r[2],T=r[3],w=r[4],E=r[5],A=r[6],S=r[7],P=r[8],M=r[9],R=r[10],C=r[11],O=r[12],L=r[13],I=r[14],D=r[15];return Math.abs(n-v)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-b)<=t.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-T)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-w)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-E)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-A)<=t.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-S)<=t.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-P)<=t.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(h-M)<=t.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-R)<=t.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(p-C)<=t.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(m-O)<=t.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-L)<=t.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(_-I)<=t.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))&&Math.abs(y-D)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},mat4.sub=mat4.mul=mat4.ortho=mat4.perspective=void 0;var t=function(t,n){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var i=r(void 0);if(i&&i.has(t))return i.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,i&&i.set(t,a),a}(requireCommon());function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=r[0],b=r[1],x=r[2],T=r[3];return e[0]=v*n+b*s+x*d+T*m,e[1]=v*i+b*l+x*h+T*g,e[2]=v*a+b*u+x*f+T*_,e[3]=v*o+b*c+x*p+T*y,e[4]=(v=r[4])*n+(b=r[5])*s+(x=r[6])*d+(T=r[7])*m,e[5]=v*i+b*l+x*h+T*g,e[6]=v*a+b*u+x*f+T*_,e[7]=v*o+b*c+x*p+T*y,e[8]=(v=r[8])*n+(b=r[9])*s+(x=r[10])*d+(T=r[11])*m,e[9]=v*i+b*l+x*h+T*g,e[10]=v*a+b*u+x*f+T*_,e[11]=v*o+b*c+x*p+T*y,e[12]=(v=r[12])*n+(b=r[13])*s+(x=r[14])*d+(T=r[15])*m,e[13]=v*i+b*l+x*h+T*g,e[14]=v*a+b*u+x*f+T*_,e[15]=v*o+b*c+x*p+T*y,e}function a(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,l=i+i,u=a+a,c=n*s,d=n*l,h=n*u,f=i*l,p=i*u,m=a*u,g=o*s,_=o*l,y=o*u;return e[0]=1-(f+m),e[1]=d+y,e[2]=h-_,e[3]=0,e[4]=d-y,e[5]=1-(c+m),e[6]=p+g,e[7]=0,e[8]=h+_,e[9]=p-g,e[10]=1-(c+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function o(e,t){var r=t[4],n=t[5],i=t[6],a=t[8],o=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,n,i),e[2]=Math.hypot(a,o,s),e}function s(e,t,r,n,i){var a,o=1/Math.tan(t/2);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(a=1/(n-i)),e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}function l(e,t,r,n,i,a,o){var s=1/(t-r),l=1/(n-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(o+a)*u,e[15]=1,e}function u(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}return mat4.perspective=s,mat4.ortho=l,mat4.mul=i,mat4.sub=u,mat4}var vec4={},hasRequiredVec4,hasRequiredMatrix4;function requireVec4(){if(hasRequiredVec4)return vec4;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredVec4=1,Object.defineProperty(vec4,"__esModule",{value:!0}),vec4.create=n,vec4.clone=function(e){var r=new t.ARRAY_TYPE(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r},vec4.fromValues=function(e,r,n,i){var a=new t.ARRAY_TYPE(4);return a[0]=e,a[1]=r,a[2]=n,a[3]=i,a},vec4.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},vec4.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},vec4.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},vec4.subtract=i,vec4.multiply=a,vec4.divide=o,vec4.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},vec4.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},vec4.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},vec4.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},vec4.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},vec4.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},vec4.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},vec4.distance=s,vec4.squaredDistance=l,vec4.length=u,vec4.squaredLength=c,vec4.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},vec4.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},vec4.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e},vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},vec4.cross=function(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],c=t[0],d=t[1],h=t[2],f=t[3];return e[0]=d*u-h*l+f*s,e[1]=-c*u+h*o-f*a,e[2]=c*l-d*o+f*i,e[3]=-c*s+d*a-h*i,e},vec4.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e},vec4.random=function(e,r){var n,i,a,o,s,l;r=r||1;do{s=(n=2*t.RANDOM()-1)*n+(i=2*t.RANDOM()-1)*i}while(s>=1);do{l=(a=2*t.RANDOM()-1)*a+(o=2*t.RANDOM()-1)*o}while(l>=1);var u=Math.sqrt((1-s)/l);return e[0]=r*n,e[1]=r*i,e[2]=r*a*u,e[3]=r*o*u,e},vec4.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e},vec4.transformQuat=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*n+s*a-l*i,d=u*i+l*n-o*a,h=u*a+o*i-s*n,f=-o*n-s*i-l*a;return e[0]=c*u+f*-o+d*-l-h*-s,e[1]=d*u+f*-s+h*-o-c*-l,e[2]=h*u+f*-l+c*-s-d*-o,e[3]=t[3],e},vec4.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},vec4.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},vec4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},vec4.equals=function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],l=r[1],u=r[2],c=r[3];return Math.abs(n-s)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=t.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-u)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-c)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},vec4.forEach=vec4.sqrLen=vec4.len=vec4.sqrDist=vec4.dist=vec4.div=vec4.mul=vec4.sub=void 0;var t=function(t,n){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var i=r(void 0);if(i&&i.has(t))return i.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,i&&i.set(t,a),a}(requireCommon());function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function s(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function l(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function u(e){return Math.hypot(e[0],e[1],e[2],e[3])}function c(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}vec4.sub=i,vec4.mul=a,vec4.div=o,vec4.dist=s,vec4.sqrDist=l,vec4.len=u,vec4.sqrLen=c;var d,h=(d=n(),function(e,t,r,n,i,a){var o,s;for(t||(t=4),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)d[0]=e[o],d[1]=e[o+1],d[2]=e[o+2],d[3]=e[o+3],i(d,d,a),e[o]=d[0],e[o+1]=d[1],e[o+2]=d[2],e[o+3]=d[3];return e});return vec4.forEach=h,vec4}function requireMatrix4(){if(hasRequiredMatrix4)return matrix4;hasRequiredMatrix4=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(matrix4,"__esModule",{value:!0}),matrix4.default=void 0;var r,n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireMatrix$1()),u=requireValidators(),c=requireGlMatrixExtras(),d=g(requireMat4()),h=g(requireVec2()),f=g(requireVec3()),p=g(requireVec4());function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function g(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=m(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(r||(r={}));var _,y,v=45*Math.PI/180,b=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x=function(e){(0,a.default)(g,e);var t,l,m=(t=g,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);if(l){var n=(0,s.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,o.default)(this,e)});function g(e){var t;return(0,n.default)(this,g),t=m.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?t.copy(e):t.identity(),t}return(0,i.default)(g,[{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"INDICES",get:function(){return r}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}},{key:"set",value:function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=l,this[9]=u,this[10]=c,this[11]=d,this[12]=h,this[13]=f,this[14]=p,this[15]=m,this.check()}},{key:"setRowMajor",value:function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,m){return this[0]=e,this[1]=i,this[2]=l,this[3]=h,this[4]=t,this[5]=a,this[6]=u,this[7]=f,this[8]=r,this[9]=o,this[10]=c,this[11]=p,this[12]=n,this[13]=s,this[14]=d,this[15]=m,this.check()}},{key:"toRowMajor",value:function(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}},{key:"identity",value:function(){return this.copy(b)}},{key:"fromObject",value:function(e){return this.check()}},{key:"fromQuaternion",value:function(e){return d.fromQuat(this,e),this.check()}},{key:"frustum",value:function(e){var t=e.left,r=e.right,n=e.bottom,i=e.top,a=e.near,o=void 0===a?.1:a,s=e.far,l=void 0===s?500:s;return l===1/0?function(e,t,r,n,i,a){var o=2*a/(i-n),s=(r+t)/(r-t),l=(i+n)/(i-n),u=-2*a;e[0]=2*a/(r-t),e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=s,e[9]=l,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0}(this,t,r,n,i,o):d.frustum(this,t,r,n,i,o,l),this.check()}},{key:"lookAt",value:function(e){var t=e.center,r=e.up;return d.lookAt(this,e.eye,void 0===t?[0,0,0]:t,void 0===r?[0,1,0]:r),this.check()}},{key:"ortho",value:function(e){var t=e.near,r=e.far;return d.ortho(this,e.left,e.right,e.bottom,e.top,void 0===t?.1:t,void 0===r?500:r),this.check()}},{key:"orthographic",value:function(e){var t=e.fovy,r=void 0===t?v:t,n=e.aspect,i=void 0===n?1:n,a=e.focalDistance,o=void 0===a?1:a,s=e.near,l=void 0===s?.1:s,u=e.far,c=void 0===u?500:u;E(r);var d=o*Math.tan(r/2),h=d*i;return this.ortho({left:-h,right:h,bottom:-d,top:d,near:l,far:c})}},{key:"perspective",value:function(e){var t=e.fovy,r=void 0===t?45*Math.PI/180:t,n=e.aspect,i=void 0===n?1:n,a=e.near,o=void 0===a?.1:a,s=e.far,l=void 0===s?500:s;return E(r),d.perspective(this,r,i,o,l),this.check()}},{key:"determinant",value:function(){return d.determinant(this)}},{key:"getScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}},{key:"getTranslation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}},{key:"getRotation",value:function(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0];var r=this.getScale(t=t||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*i,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*i,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*i,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{key:"getRotationMatrix3",value:function(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0];var r=this.getScale(t=t||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*i,e[2]=this[2]*a,e[3]=this[4]*n,e[4]=this[5]*i,e[5]=this[6]*a,e[6]=this[8]*n,e[7]=this[9]*i,e[8]=this[10]*a,e}},{key:"transpose",value:function(){return d.transpose(this,this),this.check()}},{key:"invert",value:function(){return d.invert(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return d.multiply(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return d.multiply(this,this,e),this.check()}},{key:"rotateX",value:function(e){return d.rotateX(this,this,e),this.check()}},{key:"rotateY",value:function(e){return d.rotateY(this,this,e),this.check()}},{key:"rotateZ",value:function(e){return d.rotateZ(this,this,e),this.check()}},{key:"rotateXYZ",value:function(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}},{key:"rotateAxis",value:function(e,t){return d.rotate(this,this,e,t),this.check()}},{key:"scale",value:function(e){return d.scale(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}},{key:"translate",value:function(e){return d.translate(this,this,e),this.check()}},{key:"transform",value:function(e,t){return 4===e.length?(t=p.transformMat4(t||[-0,-0,-0,-0],e,this),(0,u.checkVector)(t,4),t):this.transformAsPoint(e,t)}},{key:"transformAsPoint",value:function(e,t){var r;switch(e.length){case 2:r=h.transformMat4(t||[-0,-0],e,this);break;case 3:r=f.transformMat4(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return(0,u.checkVector)(r,e.length),r}},{key:"transformAsVector",value:function(e,t){var r;switch(e.length){case 2:r=(0,c.vec2_transformMat4AsVector)(t||[-0,-0],e,this);break;case 3:r=(0,c.vec3_transformMat4AsVector)(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return(0,u.checkVector)(r,e.length),r}},{key:"transformPoint",value:function(e,t){return this.transformAsPoint(e,t)}},{key:"transformVector",value:function(e,t){return this.transformAsPoint(e,t)}},{key:"transformDirection",value:function(e,t){return this.transformAsVector(e,t)}},{key:"makeRotationX",value:function(e){return this.identity().rotateX(e)}},{key:"makeTranslation",value:function(e,t,r){return this.identity().translate([e,t,r])}}],[{key:"IDENTITY",get:function(){return w()}},{key:"ZERO",get:function(){return T()}}]),g}(l.default);function T(){return _||(_=new x([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(_)),_}function w(){return y||(y=new x,Object.freeze(y)),y}function E(e){if(e>2*Math.PI)throw Error("expected radians")}return matrix4.default=x,matrix4}var quaternion={},quat={},hasRequiredQuat,hasRequiredQuaternion;function requireQuat(){if(hasRequiredQuat)return quat;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}hasRequiredQuat=1,Object.defineProperty(quat,"__esModule",{value:!0}),quat.create=s,quat.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},quat.setAxisAngle=l,quat.getAxisAngle=function(e,r){var n=2*Math.acos(r[3]),i=Math.sin(n/2);return i>t.EPSILON?(e[0]=r[0]/i,e[1]=r[1]/i,e[2]=r[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},quat.getAngle=function(e,t){var r=m(e,t);return Math.acos(2*r*r-1)},quat.multiply=u,quat.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=a*l-i*s,e[3]=o*l-n*s,e},quat.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-a*s,e[1]=i*l+o*s,e[2]=a*l+n*s,e[3]=o*l-i*s,e},quat.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},quat.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},quat.exp=c,quat.ln=d,quat.pow=function(e,t,r){return d(e,t),p(e,e,r),c(e,e),e},quat.slerp=h,quat.random=function(e){var r=t.RANDOM(),n=t.RANDOM(),i=t.RANDOM(),a=Math.sqrt(1-r),o=Math.sqrt(r);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},quat.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},quat.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},quat.fromMat3=f,quat.fromEuler=function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),l=Math.cos(r),u=Math.sin(n),c=Math.cos(n);return e[0]=a*l*c-o*s*u,e[1]=o*s*c+a*l*u,e[2]=o*l*u-a*s*c,e[3]=o*l*c+a*s*u,e},quat.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},quat.setAxes=quat.sqlerp=quat.rotationTo=quat.equals=quat.exactEquals=quat.normalize=quat.sqrLen=quat.squaredLength=quat.len=quat.length=quat.lerp=quat.dot=quat.scale=quat.mul=quat.add=quat.set=quat.copy=quat.fromValues=quat.clone=void 0;var t=o(requireCommon()),r=o(requireMat3()),n=o(requireVec3()),i=o(requireVec4());function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}function o(t,r){if(!r&&t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=a(r);if(n&&n.has(t))return n.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=t[s]}return i.default=t,n&&n.set(t,i),i}function s(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function l(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function u(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+o*s+i*u-a*l,e[1]=i*c+o*l+a*s-n*u,e[2]=a*c+o*u+n*l-i*s,e[3]=o*c-n*s-i*l-a*u,e}function c(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=Math.sqrt(r*r+n*n+i*i),s=Math.exp(a),l=o>0?s*Math.sin(o)/o:0;return e[0]=r*l,e[1]=n*l,e[2]=i*l,e[3]=s*Math.cos(o),e}function d(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=Math.sqrt(r*r+n*n+i*i),s=o>0?Math.atan2(o,a)/o:0;return e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=.5*Math.log(r*r+n*n+i*i+a*a),e}function h(e,r,n,i){var a,o,s,l,u,c=r[0],d=r[1],h=r[2],f=r[3],p=n[0],m=n[1],g=n[2],_=n[3];return(o=c*p+d*m+h*g+f*_)<0&&(o=-o,p=-p,m=-m,g=-g,_=-_),1-o>t.EPSILON?(a=Math.acos(o),s=Math.sin(a),l=Math.sin((1-i)*a)/s,u=Math.sin(i*a)/s):(l=1-i,u=i),e[0]=l*c+u*p,e[1]=l*d+u*m,e[2]=l*h+u*g,e[3]=l*f+u*_,e}function f(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,e[3]=(t[3*a+o]-t[3*o+a])*(r=.5/r),e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}quat.clone=i.clone,quat.fromValues=i.fromValues,quat.copy=i.copy,quat.set=i.set,quat.add=i.add,quat.mul=u;var p=i.scale;quat.scale=p;var m=i.dot;quat.dot=m,quat.lerp=i.lerp;var g=i.length;quat.length=g,quat.len=g;var _=i.squaredLength;quat.squaredLength=_,quat.sqrLen=_;var y=i.normalize;quat.normalize=y,quat.exactEquals=i.exactEquals,quat.equals=i.equals;var v,b,x,T=(v=n.create(),b=n.fromValues(1,0,0),x=n.fromValues(0,1,0),function(e,t,r){var i=n.dot(t,r);return i<-.999999?(n.cross(v,b,t),n.len(v)<1e-6&&n.cross(v,x,t),n.normalize(v,v),l(e,v,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(n.cross(v,t,r),e[0]=v[0],e[1]=v[1],e[2]=v[2],e[3]=1+i,y(e,e))});quat.rotationTo=T;var w,E,A=(w=s(),E=s(),function(e,t,r,n,i,a){return h(w,t,i,a),h(E,r,n,a),h(e,w,E,2*a*(1-a)),e});quat.sqlerp=A;var S,P=(S=r.create(),function(e,t,r,n){return S[0]=r[0],S[3]=r[1],S[6]=r[2],S[1]=n[0],S[4]=n[1],S[7]=n[2],S[2]=-t[0],S[5]=-t[1],S[8]=-t[2],y(e,f(e,S))});return quat.setAxes=P,quat}function requireQuaternion(){if(hasRequiredQuaternion)return quaternion;hasRequiredQuaternion=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(quaternion,"__esModule",{value:!0}),quaternion.default=void 0;var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireMathArray()),l=requireValidators(),u=e(requireVector4()),c=f(requireQuat()),d=f(requireVec4());function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function f(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}var p=[0,0,0,1],m=function(e){(0,i.default)(f,e);var t,s,h=(t=f,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function f(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(0,r.default)(this,f),e=h.call(this,-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?e.copy(t):e.set(t,n,i,a),e}return(0,n.default)(f,[{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}},{key:"set",value:function(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}},{key:"fromObject",value:function(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}},{key:"fromMatrix3",value:function(e){return c.fromMat3(this,e),this.check()}},{key:"fromAxisRotation",value:function(e,t){return c.setAxisAngle(this,e,t),this.check()}},{key:"identity",value:function(){return c.identity(this),this.check()}},{key:"setAxisAngle",value:function(e,t){return this.fromAxisRotation(e,t)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(e){this[0]=(0,l.checkNumber)(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=(0,l.checkNumber)(e)}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=(0,l.checkNumber)(e)}},{key:"w",get:function(){return this[3]},set:function(e){this[3]=(0,l.checkNumber)(e)}},{key:"len",value:function(){return c.length(this)}},{key:"lengthSquared",value:function(){return c.squaredLength(this)}},{key:"dot",value:function(e){return c.dot(this,e)}},{key:"rotationTo",value:function(e,t){return c.rotationTo(this,e,t),this.check()}},{key:"add",value:function(e){return c.add(this,this,e),this.check()}},{key:"calculateW",value:function(){return c.calculateW(this,this),this.check()}},{key:"conjugate",value:function(){return c.conjugate(this,this),this.check()}},{key:"invert",value:function(){return c.invert(this,this),this.check()}},{key:"lerp",value:function(e,t,r){return void 0===r?this.lerp(this,e,t):(c.lerp(this,e,t,r),this.check())}},{key:"multiplyRight",value:function(e){return c.multiply(this,this,e),this.check()}},{key:"multiplyLeft",value:function(e){return c.multiply(this,e,this),this.check()}},{key:"normalize",value:function(){var e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}},{key:"rotateX",value:function(e){return c.rotateX(this,this,e),this.check()}},{key:"rotateY",value:function(e){return c.rotateY(this,this,e),this.check()}},{key:"rotateZ",value:function(e){return c.rotateZ(this,this,e),this.check()}},{key:"scale",value:function(e){return c.scale(this,this,e),this.check()}},{key:"slerp",value:function(e,t,r){var n,i,a;switch(arguments.length){case 1:var o=e.start;n=void 0===o?p:o,i=e.target,a=e.ratio;break;case 2:n=this,i=e,a=t;break;default:n=e,i=t,a=r}return c.slerp(this,n,i,a),this.check()}},{key:"transformVector4",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.default;return d.transformQuat(t,e,this),(0,l.checkVector)(t,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(e,t){return this.setAxisAngle(e,t)}},{key:"premultiply",value:function(e){return this.multiplyLeft(e)}},{key:"multiply",value:function(e){return this.multiplyRight(e)}}]),f}(s.default);return quaternion.default=m,quaternion}var sphericalCoordinates={},hasRequiredSphericalCoordinates;function requireSphericalCoordinates(){if(hasRequiredSphericalCoordinates)return sphericalCoordinates;hasRequiredSphericalCoordinates=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(sphericalCoordinates,"__esModule",{value:!0}),sphericalCoordinates.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=e(requireVector3()),s=requireCommon$1(),l=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=u(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec3());function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}var c=1e-6,d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.phi,i=void 0===r?0:r,o=t.theta,s=void 0===o?0:o,l=t.radius,u=void 0===l?1:l,c=t.bearing,d=t.pitch,h=t.altitude,f=t.radiusScale,p=void 0===f?6371e3:f;(0,n.default)(this,e),(0,a.default)(this,"phi",void 0),(0,a.default)(this,"theta",void 0),(0,a.default)(this,"radius",void 0),(0,a.default)(this,"radiusScale",void 0),this.phi=i,this.theta=s,this.radius=u||h||1,this.radiusScale=p||1,void 0!==c&&(this.bearing=c),void 0!==d&&(this.pitch=d),this.check()}return(0,i.default)(e,[{key:"toString",value:function(){return this.formatString(s.config)}},{key:"formatString",value:function(e){var t=e.printTypes,r=s.formatValue;return"".concat(void 0!==t&&t?"Spherical":"","[rho:").concat(r(this.radius),",theta:").concat(r(this.theta),",phi:").concat(r(this.phi),"]")}},{key:"equals",value:function(e){return(0,s.equals)(this.radius,e.radius)&&(0,s.equals)(this.theta,e.theta)&&(0,s.equals)(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"bearing",get:function(){return 180-(0,s.degrees)(this.phi)},set:function(e){this.phi=Math.PI-(0,s.radians)(e)}},{key:"pitch",get:function(){return(0,s.degrees)(this.theta)},set:function(e){this.theta=(0,s.radians)(e)}},{key:"longitude",get:function(){return(0,s.degrees)(this.phi)}},{key:"latitude",get:function(){return(0,s.degrees)(this.theta)}},{key:"lng",get:function(){return(0,s.degrees)(this.phi)}},{key:"lat",get:function(){return(0,s.degrees)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this.check()}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var t=(0,r.default)(e,3),n=t[0],i=t[1];return this.radius=1+t[2]/this.radiusScale,this.phi=(0,s.radians)(i),this.theta=(0,s.radians)(n),this.check()}},{key:"fromVector3",value:function(e){return this.radius=l.length(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos((0,s.clamp)(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new o.default(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(c,Math.min(Math.PI-c,this.phi)),this}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),e}();return sphericalCoordinates.default=d,sphericalCoordinates}var pose={},euler={},hasRequiredEuler,hasRequiredPose;function requireEuler(){if(hasRequiredEuler)return euler;hasRequiredEuler=1;var e=interopRequireDefaultExports;Object.defineProperty(euler,"__esModule",{value:!0}),euler.default=void 0;var t,r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireMathArray()),u=e(requireQuaternion()),c=requireCommon$1(),d=requireValidators(),h="Unknown Euler angle order",f=.99999;!function(e){e[e.ZYX=0]="ZYX",e[e.YXZ=1]="YXZ",e[e.XZY=2]="XZY",e[e.ZXY=3]="ZXY",e[e.YZX=4]="YZX",e[e.XYZ=5]="XYZ"}(t||(t={}));var p=function(e){(0,a.default)(g,e);var l,p,m=(l=g,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(l);if(p){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function g(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.DefaultOrder;return(0,n.default)(this,g),e=m.call(this,-0,-0,-0,-0),arguments.length>0&&Array.isArray(arguments[0])?(t=e).fromVector3.apply(t,arguments):e.set(r,i,a,o),e}return(0,i.default)(g,[{key:"ELEMENTS",get:function(){return 4}},{key:"fromQuaternion",value:function(e){var t=(0,r.default)(e,4),n=t[0],i=t[1],a=t[2],o=t[3],s=i*i,l=-2*(s+a*a)+1,u=2*(n*i+o*a),c=-2*(n*a-o*i);c=(c=c>1?1:c)<-1?-1:c;var d=Math.atan2(2*(i*a+o*n),-2*(n*n+s)+1),h=Math.asin(c),f=Math.atan2(u,l);return this.set(d,h,f,g.RollPitchYaw)}},{key:"fromObject",value:function(e){throw new Error("not implemented")}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=Number.isFinite(e[3])||this.order,this.check()}},{key:"set",value:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return this[0]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this[1]=e,this[2]=t,this[3]=Number.isFinite(r)?r:this[3],this.check()}},{key:"validate",value:function(){return(e=this[3])>=0&&e<6&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2]);var e}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}},{key:"toArray4",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}},{key:"toVector3",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[0],e[1]=this[1],e[2]=this[2],e}},{key:"x",get:function(){return this[0]},set:function(e){this[0]=(0,d.checkNumber)(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=(0,d.checkNumber)(e)}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=(0,d.checkNumber)(e)}},{key:"alpha",get:function(){return this[0]},set:function(e){this[0]=(0,d.checkNumber)(e)}},{key:"beta",get:function(){return this[1]},set:function(e){this[1]=(0,d.checkNumber)(e)}},{key:"gamma",get:function(){return this[2]},set:function(e){this[2]=(0,d.checkNumber)(e)}},{key:"phi",get:function(){return this[0]},set:function(e){this[0]=(0,d.checkNumber)(e)}},{key:"theta",get:function(){return this[1]},set:function(e){this[1]=(0,d.checkNumber)(e)}},{key:"psi",get:function(){return this[2]},set:function(e){this[2]=(0,d.checkNumber)(e)}},{key:"roll",get:function(){return this[0]},set:function(e){this[0]=(0,d.checkNumber)(e)}},{key:"pitch",get:function(){return this[1]},set:function(e){this[1]=(0,d.checkNumber)(e)}},{key:"yaw",get:function(){return this[2]},set:function(e){this[2]=(0,d.checkNumber)(e)}},{key:"order",get:function(){return this[3]},set:function(e){this[3]=function(e){if(e<0&&e>=6)throw new Error(h);return e}(e)}},{key:"fromVector3",value:function(e,t){return this.set(e[0],e[1],e[2],Number.isFinite(t)?t:this[3])}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=e[0+t],this[1]=e[1+t],this[2]=e[2+t],void 0!==e[3]&&(this[3]=e[3]),this.check()}},{key:"fromRollPitchYaw",value:function(e,r,n){return this.set(e,r,n,t.ZYX)}},{key:"fromRotationMatrix",value:function(e){return this._fromRotationMatrix(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.DefaultOrder),this.check()}},{key:"getRotationMatrix",value:function(e){return this._getRotationMatrix(e)}},{key:"getQuaternion",value:function(){var e=new u.default;switch(this[4]){case t.XYZ:return e.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case t.YXZ:return e.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case t.ZXY:return e.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case t.ZYX:return e.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case t.YZX:return e.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case t.XZY:return e.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(h)}}},{key:"_fromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.DefaultOrder,r=e[0],n=e[4],i=e[8],a=e[1],o=e[5],s=e[9],l=e[2],u=e[6],d=e[10];switch(t=t||this[3]){case g.XYZ:this[1]=Math.asin((0,c.clamp)(i,-1,1)),Math.abs(i)<f?(this[0]=Math.atan2(-s,d),this[2]=Math.atan2(-n,r)):(this[0]=Math.atan2(u,o),this[2]=0);break;case g.YXZ:this[0]=Math.asin(-(0,c.clamp)(s,-1,1)),Math.abs(s)<f?(this[1]=Math.atan2(i,d),this[2]=Math.atan2(a,o)):(this[1]=Math.atan2(-l,r),this[2]=0);break;case g.ZXY:this[0]=Math.asin((0,c.clamp)(u,-1,1)),Math.abs(u)<f?(this[1]=Math.atan2(-l,d),this[2]=Math.atan2(-n,o)):(this[1]=0,this[2]=Math.atan2(a,r));break;case g.ZYX:this[1]=Math.asin(-(0,c.clamp)(l,-1,1)),Math.abs(l)<f?(this[0]=Math.atan2(u,d),this[2]=Math.atan2(a,r)):(this[0]=0,this[2]=Math.atan2(-n,o));break;case g.YZX:this[2]=Math.asin((0,c.clamp)(a,-1,1)),Math.abs(a)<f?(this[0]=Math.atan2(-s,o),this[1]=Math.atan2(-l,r)):(this[0]=0,this[1]=Math.atan2(i,d));break;case g.XZY:this[2]=Math.asin(-(0,c.clamp)(n,-1,1)),Math.abs(n)<f?(this[0]=Math.atan2(u,o),this[1]=Math.atan2(i,r)):(this[0]=Math.atan2(-s,d),this[1]=0);break;default:throw new Error(h)}return this[3]=t,this}},{key:"_getRotationMatrix",value:function(e){var t=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=this.x,n=this.y,i=this.z,a=Math.cos(r),o=Math.cos(n),s=Math.cos(i),l=Math.sin(r),u=Math.sin(n),c=Math.sin(i);switch(this[3]){case g.XYZ:var d=a*s,f=a*c,p=l*s,m=l*c;t[0]=o*s,t[4]=-o*c,t[8]=u,t[1]=f+p*u,t[5]=d-m*u,t[9]=-l*o,t[2]=m-d*u,t[6]=p+f*u,t[10]=a*o;break;case g.YXZ:var _=o*s,y=o*c,v=u*s,b=u*c;t[0]=_+b*l,t[4]=v*l-y,t[8]=a*u,t[1]=a*c,t[5]=a*s,t[9]=-l,t[2]=y*l-v,t[6]=b+_*l,t[10]=a*o;break;case g.ZXY:var x=o*s,T=o*c,w=u*s,E=u*c;t[0]=x-E*l,t[4]=-a*c,t[8]=w+T*l,t[1]=T+w*l,t[5]=a*s,t[9]=E-x*l,t[2]=-a*u,t[6]=l,t[10]=a*o;break;case g.ZYX:var A=a*s,S=a*c,P=l*s,M=l*c;t[0]=o*s,t[4]=P*u-S,t[8]=A*u+M,t[1]=o*c,t[5]=M*u+A,t[9]=S*u-P,t[2]=-u,t[6]=l*o,t[10]=a*o;break;case g.YZX:var R=a*o,C=a*u,O=l*o,L=l*u;t[0]=o*s,t[4]=L-R*c,t[8]=O*c+C,t[1]=c,t[5]=a*s,t[9]=-l*s,t[2]=-u*s,t[6]=C*c+O,t[10]=R-L*c;break;case g.XZY:var I=a*o,D=a*u,k=l*o,B=l*u;t[0]=o*s,t[4]=-c,t[8]=u*s,t[1]=I*c+B,t[5]=a*s,t[9]=D*c-k,t[2]=k*c-D,t[6]=l*s,t[10]=B*c+I;break;default:throw new Error(h)}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"toQuaternion",value:function(){var e=Math.cos(.5*this.yaw),t=Math.sin(.5*this.yaw),r=Math.cos(.5*this.roll),n=Math.sin(.5*this.roll),i=Math.cos(.5*this.pitch),a=Math.sin(.5*this.pitch);return new u.default(e*n*i-t*r*a,e*r*a+t*n*i,t*r*i-e*n*a,e*r*i+t*n*a)}}],[{key:"ZYX",get:function(){return t.ZYX}},{key:"YXZ",get:function(){return t.YXZ}},{key:"XZY",get:function(){return t.XZY}},{key:"ZXY",get:function(){return t.ZXY}},{key:"YZX",get:function(){return t.YZX}},{key:"XYZ",get:function(){return t.XYZ}},{key:"RollPitchYaw",get:function(){return t.ZYX}},{key:"DefaultOrder",get:function(){return t.ZYX}},{key:"RotationOrders",get:function(){return t}},{key:"rotationOrder",value:function(e){return t[e]}}]),g}(l.default);return euler.default=p,euler}function requirePose(){if(hasRequiredPose)return pose;hasRequiredPose=1;var e=interopRequireDefaultExports;Object.defineProperty(pose,"__esModule",{value:!0}),pose.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireMatrix4()),a=e(requireVector3()),o=e(requireEuler()),s=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.x,s=void 0===i?0:i,l=r.y,u=void 0===l?0:l,c=r.z,d=void 0===c?0:c,h=r.roll,f=void 0===h?0:h,p=r.pitch,m=void 0===p?0:p,g=r.yaw,_=void 0===g?0:g,y=r.position,v=r.orientation;(0,t.default)(this,e),(0,n.default)(this,"position",void 0),(0,n.default)(this,"orientation",void 0),this.position=Array.isArray(y)&&3===y.length?new a.default(y):new a.default(s,u,d),this.orientation=Array.isArray(v)&&4===v.length?new o.default(v,v[3]):new o.default(f,m,_,o.default.RollPitchYaw)}return(0,r.default)(e,[{key:"x",get:function(){return this.position.x},set:function(e){this.position.x=e}},{key:"y",get:function(){return this.position.y},set:function(e){this.position.y=e}},{key:"z",get:function(){return this.position.z},set:function(e){this.position.z=e}},{key:"roll",get:function(){return this.orientation.roll},set:function(e){this.orientation.roll=e}},{key:"pitch",get:function(){return this.orientation.pitch},set:function(e){this.orientation.pitch=e}},{key:"yaw",get:function(){return this.orientation.yaw},set:function(e){this.orientation.yaw=e}},{key:"getPosition",value:function(){return this.position}},{key:"getOrientation",value:function(){return this.orientation}},{key:"equals",value:function(e){return!!e&&this.position.equals(e.position)&&this.orientation.equals(e.orientation)}},{key:"exactEquals",value:function(e){return!!e&&this.position.exactEquals(e.position)&&this.orientation.exactEquals(e.orientation)}},{key:"getTransformationMatrix",value:function(){var e=Math.sin(this.roll),t=Math.sin(this.pitch),r=Math.sin(this.yaw),n=Math.cos(this.roll),a=Math.cos(this.pitch),o=Math.cos(this.yaw);return(new i.default).setRowMajor(o*a,-r*n+o*t*e,r*e+o*t*n,this.x,r*a,o*n+r*t*e,-o*e+r*t*n,this.y,-t,a*e,a*n,this.z,0,0,0,1)}},{key:"getTransformationMatrixFromPose",value:function(e){return(new i.default).multiplyRight(this.getTransformationMatrix()).multiplyRight(e.getTransformationMatrix().invert())}},{key:"getTransformationMatrixToPose",value:function(e){return(new i.default).multiplyRight(e.getTransformationMatrix()).multiplyRight(this.getTransformationMatrix().invert())}}]),e}();return pose.default=s,pose}var mathUtils$2={},hasRequiredMathUtils$2;function requireMathUtils$2(){if(hasRequiredMathUtils$2)return mathUtils$2;hasRequiredMathUtils$2=1,Object.defineProperty(mathUtils$2,"__esModule",{value:!0}),mathUtils$2.default=void 0;var e={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI};return mathUtils$2.default=e,mathUtils$2}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Vector2",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"Vector3",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"Vector4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"Matrix3",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"Matrix4",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"Quaternion",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"SphericalCoordinates",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"_SphericalCoordinates",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"Pose",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"_Pose",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"Euler",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"_Euler",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"_MathUtils",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"config",{enumerable:!0,get:function(){return f.config}}),Object.defineProperty(e,"configure",{enumerable:!0,get:function(){return f.configure}}),Object.defineProperty(e,"formatValue",{enumerable:!0,get:function(){return f.formatValue}}),Object.defineProperty(e,"isArray",{enumerable:!0,get:function(){return f.isArray}}),Object.defineProperty(e,"clone",{enumerable:!0,get:function(){return f.clone}}),Object.defineProperty(e,"equals",{enumerable:!0,get:function(){return f.equals}}),Object.defineProperty(e,"exactEquals",{enumerable:!0,get:function(){return f.exactEquals}}),Object.defineProperty(e,"toRadians",{enumerable:!0,get:function(){return f.toRadians}}),Object.defineProperty(e,"toDegrees",{enumerable:!0,get:function(){return f.toDegrees}}),Object.defineProperty(e,"radians",{enumerable:!0,get:function(){return f.radians}}),Object.defineProperty(e,"degrees",{enumerable:!0,get:function(){return f.degrees}}),Object.defineProperty(e,"sin",{enumerable:!0,get:function(){return f.sin}}),Object.defineProperty(e,"cos",{enumerable:!0,get:function(){return f.cos}}),Object.defineProperty(e,"tan",{enumerable:!0,get:function(){return f.tan}}),Object.defineProperty(e,"asin",{enumerable:!0,get:function(){return f.asin}}),Object.defineProperty(e,"acos",{enumerable:!0,get:function(){return f.acos}}),Object.defineProperty(e,"atan",{enumerable:!0,get:function(){return f.atan}}),Object.defineProperty(e,"clamp",{enumerable:!0,get:function(){return f.clamp}}),Object.defineProperty(e,"lerp",{enumerable:!0,get:function(){return f.lerp}}),Object.defineProperty(e,"withEpsilon",{enumerable:!0,get:function(){return f.withEpsilon}});var r=t(requireVector2()),n=t(requireVector3()),i=t(requireVector4()),a=t(requireMatrix3()),o=t(requireMatrix4()),s=t(requireQuaternion()),l=t(requireSphericalCoordinates()),u=t(requirePose()),c=t(requireEuler()),d=t(requireMathUtils$2()),h=t(requireAssert$9()),f=requireCommon$1()}(es5$q);var es5$p={},ellipsoid={},constants$8={},hasRequiredConstants$5;function requireConstants$5(){if(hasRequiredConstants$5)return constants$8;hasRequiredConstants$5=1,Object.defineProperty(constants$8,"__esModule",{value:!0}),constants$8.WGS84_CONSTANTS=constants$8.WGS84_RADIUS_Z=constants$8.WGS84_RADIUS_Y=constants$8.WGS84_RADIUS_X=void 0;var e=6378137;constants$8.WGS84_RADIUS_X=e;var t=6378137;constants$8.WGS84_RADIUS_Y=t;var r=6356752.314245179;constants$8.WGS84_RADIUS_Z=r;var n={radii:[e,t,r],radiiSquared:[40680631590769,40680631590769,40408299984661.445],oneOverRadii:[1/e,1/t,1/r],oneOverRadiiSquared:[1/40680631590769,1/40680631590769,1/40408299984661.445],maximumRadius:Math.max(e,t,r),centerToleranceSquared:.1};return constants$8.WGS84_CONSTANTS=n,constants$8}var typeUtils={},hasRequiredTypeUtils;function requireTypeUtils(){if(hasRequiredTypeUtils)return typeUtils;hasRequiredTypeUtils=1,Object.defineProperty(typeUtils,"__esModule",{value:!0}),typeUtils.fromCartographic=i,typeUtils.fromCartographicToRadians=function(t){return i(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e.config._cartographicRadians?r:e.toRadians)},typeUtils.fromCartographicToDegrees=function(t){return i(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e.config._cartographicRadians?e.toDegrees:r)},typeUtils.toCartographic=a,typeUtils.toCartographicFromRadians=function(t,n){return a(t,n,e.config._cartographicRadians?r:e.toDegrees)},typeUtils.toCartographicFromDegrees=function(t,n){return a(t,n,e.config._cartographicRadians?e.toRadians:r)},typeUtils.isWGS84=function(e){if(!e)return!1;n.from(e);var r=t.WGS84_CONSTANTS.oneOverRadiiSquared,i=t.WGS84_CONSTANTS.centerToleranceSquared;return Math.abs(e[0]*e[0]*r[0]+e[1]*e[1]*r[1]+e[2]*e[2]*r[2]-1)<i};var e=es5$q,t=requireConstants$5();function r(e){return e}var n=new e.Vector3;function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}return typeUtils}var scaleToGeodeticSurface={},hasRequiredScaleToGeodeticSurface;function requireScaleToGeodeticSurface(){if(hasRequiredScaleToGeodeticSurface)return scaleToGeodeticSurface;hasRequiredScaleToGeodeticSurface=1,Object.defineProperty(scaleToGeodeticSurface,"__esModule",{value:!0}),scaleToGeodeticSurface.default=function(i,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=a.oneOverRadii,l=a.oneOverRadiiSquared,u=a.centerToleranceSquared;t.from(i);var c=t.x,d=t.y,h=t.z,f=s.x,p=s.y,m=s.z,g=c*c*f*f,_=d*d*p*p,y=h*h*m*m,v=g+_+y,b=Math.sqrt(1/v);if(Number.isFinite(b)){var x=r;if(x.copy(i).scale(b),v<u)return x.to(o);var T=l.x,w=l.y,E=l.z,A=n;A.set(x.x*T*2,x.y*w*2,x.z*E*2);var S,P,M,R,C=(1-b)*t.len()/(.5*A.len()),O=0;do{var L=(S=1/(1+(C-=O)*T))*S,I=(P=1/(1+C*w))*P,D=(M=1/(1+C*E))*M;O=(R=g*L+_*I+y*D-1)/(-2*(g*(L*S)*T+_*(I*P)*w+y*(D*M)*E))}while(Math.abs(R)>e._MathUtils.EPSILON12);return t.scale([S,P,M]).to(o)}};var e=es5$q,t=new e.Vector3,r=new e.Vector3,n=new e.Vector3;return scaleToGeodeticSurface}var ellipsoidTransform={},hasRequiredEllipsoidTransform,hasRequiredEllipsoid,dist$2,hasRequiredDist$2;function requireEllipsoidTransform(){if(hasRequiredEllipsoidTransform)return ellipsoidTransform;hasRequiredEllipsoidTransform=1,Object.defineProperty(ellipsoidTransform,"__esModule",{value:!0}),ellipsoidTransform.default=function(u,c,d,h,f,p){var m,g,_,y=n[c]&&n[c][d];(0,e.assert)(y&&(!h||h===y));var v=r.copy(f);if((0,e.equals)(v.x,0,t)&&(0,e.equals)(v.y,0,t)){var b=Math.sign(v.z);m=o.fromArray(i[c]),"east"!==c&&"west"!==c&&m.scale(b),g=s.fromArray(i[d]),"east"!==d&&"west"!==d&&g.scale(b),_=l.fromArray(i[h]),"east"!==h&&"west"!==h&&_.scale(b)}else{var x=a.up,T=a.east,w=a.north;T.set(-v.y,v.x,0).normalize(),u.geodeticSurfaceNormal(v,x),w.copy(x).cross(T);var E=a.west,A=a.south;a.down.copy(x).scale(-1),E.copy(T).scale(-1),A.copy(w).scale(-1),m=a[c],g=a[d],_=a[h]}return p[0]=m.x,p[1]=m.y,p[2]=m.z,p[3]=0,p[4]=g.x,p[5]=g.y,p[6]=g.z,p[7]=0,p[8]=_.x,p[9]=_.y,p[10]=_.z,p[11]=0,p[12]=v.x,p[13]=v.y,p[14]=v.z,p[15]=1,p};var e=es5$q,t=1e-14,r=new e.Vector3,n={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},i={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},a={east:new e.Vector3,north:new e.Vector3,up:new e.Vector3,west:new e.Vector3,south:new e.Vector3,down:new e.Vector3},o=new e.Vector3,s=new e.Vector3,l=new e.Vector3;return ellipsoidTransform}function requireEllipsoid(){if(hasRequiredEllipsoid)return ellipsoid;hasRequiredEllipsoid=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(ellipsoid,"__esModule",{value:!0}),ellipsoid.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=es5$q,s=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec3()),l=requireConstants$5(),u=requireTypeUtils(),c=e(requireScaleToGeodeticSurface()),d=e(requireEllipsoidTransform());function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}var f=new o.Vector3,p=new o.Vector3,m=new o.Vector3,g=new o.Vector3,_=new o.Vector3,y=new o.Vector3,v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,n.default)(this,e),(0,a.default)(this,"radii",void 0),(0,a.default)(this,"radiiSquared",void 0),(0,a.default)(this,"radiiToTheFourth",void 0),(0,a.default)(this,"oneOverRadii",void 0),(0,a.default)(this,"oneOverRadiiSquared",void 0),(0,a.default)(this,"minimumRadius",void 0),(0,a.default)(this,"maximumRadius",void 0),(0,a.default)(this,"centerToleranceSquared",o._MathUtils.EPSILON1),(0,a.default)(this,"squaredXOverSquaredZ",void 0),(0,o.assert)(t>=0),(0,o.assert)(r>=0),(0,o.assert)(i>=0),this.radii=new o.Vector3(t,r,i),this.radiiSquared=new o.Vector3(t*t,r*r,i*i),this.radiiToTheFourth=new o.Vector3(t*t*t*t,r*r*r*r,i*i*i*i),this.oneOverRadii=new o.Vector3(0===t?0:1/t,0===r?0:1/r,0===i?0:1/i),this.oneOverRadiiSquared=new o.Vector3(0===t?0:1/(t*t),0===r?0:1/(r*r),0===i?0:1/(i*i)),this.minimumRadius=Math.min(t,r,i),this.maximumRadius=Math.max(t,r,i),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return(0,i.default)(e,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=p,i=m,a=(0,r.default)(e,3)[2];this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);var o=Math.sqrt(n.dot(i));return i.scale(1/o),n.scale(a),i.add(n),i.to(t)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];y.from(e);var r=this.scaleToGeodeticSurface(y,g);if(r){var n=this.geodeticSurfaceNormal(r,p),i=_;i.copy(y).subtract(r);var a=Math.atan2(n.y,n.x),o=Math.asin(n.z),l=Math.sign(s.dot(i,y))*s.length(i);return(0,u.toCartographicFromRadians)([a,o,l],t)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.Matrix4;return(0,d.default)(this,"east","north","up",e,t)}},{key:"localFrameToFixedFrame",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.Matrix4;return(0,d.default)(this,e,t,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return f.from(e).normalize().to(t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=(0,u.fromCartographicToRadians)(e),n=r[0],i=r[1],a=Math.cos(i);return f.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),f.to(t)}},{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return f.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}},{key:"scaleToGeodeticSurface",value:function(e,t){return(0,c.default)(e,this,t)}},{key:"scaleToGeocentricSurface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];g.from(e);var r=g.x,n=g.y,i=g.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return g.multiplyScalar(o).to(t)}},{key:"transformPositionToScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return g.from(e).scale(this.oneOverRadii).to(t)}},{key:"transformPositionFromScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return g.from(e).scale(this.radii).to(t)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];(0,o.assert)((0,o.equals)(this.radii.x,this.radii.y,o._MathUtils.EPSILON15)),(0,o.assert)(this.radii.z>0),g.from(e);var n=g.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return g.set(0,0,n).to(r)}}]),e}();return ellipsoid.default=v,(0,a.default)(v,"WGS84",new v(l.WGS84_RADIUS_X,l.WGS84_RADIUS_Y,l.WGS84_RADIUS_Z)),ellipsoid}function requireDist$2(){if(hasRequiredDist$2)return dist$2;hasRequiredDist$2=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};function o(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(a,{Stat:()=>s,Stats:()=>l,_getHiResTimestamp:()=>o}),e=a,dist$2=((e,a,o,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let o of n(a))i.call(e,o)||void 0===o||t(e,o,{get:()=>a[o],enumerable:!(s=r(a,o))||s.enumerable});return e})(t({},"__esModule",{value:!0}),e);var s=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=o(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(o()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},l=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(n=e instanceof s?e:new s(t,r),this.stats[t]=n),n}};return dist$2}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Ellipsoid",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"isWGS84",{enumerable:!0,get:function(){return n.isWGS84}});var r=t(requireEllipsoid()),n=requireTypeUtils()}(es5$p);var tilesetCache={},doublyLinkedList={},doublyLinkedListNode={},hasRequiredDoublyLinkedListNode,hasRequiredDoublyLinkedList;function requireDoublyLinkedListNode(){if(hasRequiredDoublyLinkedListNode)return doublyLinkedListNode;hasRequiredDoublyLinkedListNode=1;var e=interopRequireDefaultExports;Object.defineProperty(doublyLinkedListNode,"__esModule",{value:!0}),doublyLinkedListNode.DoublyLinkedListNode=void 0;var t=e(requireCreateClass()),r=e(requireClassCallCheck()),n=e(requireDefineProperty()),i=(0,t.default)((function e(t,i,a){(0,r.default)(this,e),(0,n.default)(this,"item",void 0),(0,n.default)(this,"previous",void 0),(0,n.default)(this,"next",void 0),this.item=t,this.previous=i,this.next=a}));return doublyLinkedListNode.DoublyLinkedListNode=i,doublyLinkedListNode}function requireDoublyLinkedList(){if(hasRequiredDoublyLinkedList)return doublyLinkedList;hasRequiredDoublyLinkedList=1;var e=interopRequireDefaultExports;Object.defineProperty(doublyLinkedList,"__esModule",{value:!0}),doublyLinkedList.DoublyLinkedList=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireDoublyLinkedListNode(),a=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"head",null),(0,n.default)(this,"tail",null),(0,n.default)(this,"_length",0)}return(0,r.default)(e,[{key:"length",get:function(){return this._length}},{key:"add",value:function(e){var t=new i.DoublyLinkedListNode(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,t){e!==t&&(this.remove(t),this._insert(e,t))}},{key:"_insert",value:function(e,t){var r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}]),e}();return doublyLinkedList.DoublyLinkedList=a,doublyLinkedList}var _interopRequireDefault$H=interopRequireDefaultExports;Object.defineProperty(tilesetCache,"__esModule",{value:!0}),tilesetCache.TilesetCache=void 0;var _classCallCheck2$5=_interopRequireDefault$H(requireClassCallCheck()),_createClass2$5=_interopRequireDefault$H(requireCreateClass()),_defineProperty2$i=_interopRequireDefault$H(requireDefineProperty()),_doublyLinkedList=requireDoublyLinkedList(),TilesetCache=function(){function e(){(0,_classCallCheck2$5.default)(this,e),(0,_defineProperty2$i.default)(this,"_list",void 0),(0,_defineProperty2$i.default)(this,"_sentinel",void 0),(0,_defineProperty2$i.default)(this,"_trimTiles",void 0),this._list=new _doublyLinkedList.DoublyLinkedList,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return(0,_createClass2$5.default)(e,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}},{key:"add",value:function(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}},{key:"unloadTile",value:function(e,t,r){var n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}},{key:"unloadTiles",value:function(e,t){var r=this._trimTiles;this._trimTiles=!1;for(var n=1024*e.maximumMemoryUsage*1024,i=this._sentinel,a=this._list.head;a!==i&&(e.gpuMemoryUsageInBytes>n||r);){var o=a.item;a=a.next,this.unloadTile(e,o,t)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),e}();tilesetCache.TilesetCache=TilesetCache;var transformUtils={};Object.defineProperty(transformUtils,"__esModule",{value:!0}),transformUtils.calculateTransformProps=calculateTransformProps;var _geospatial$4=es5$p,_core$7=es5$q,_loaderUtils$e=es5$t;function calculateTransformProps(e,t){(0,_loaderUtils$e.assert)(e),(0,_loaderUtils$e.assert)(t);var r=t.rtcCenter,n=t.gltfUpAxis,i=e.boundingVolume.center,a=new _core$7.Matrix4(e.computedTransform);switch(r&&a.translate(r),n){case"Z":break;case"Y":var o=(new _core$7.Matrix4).rotateX(Math.PI/2);a=a.multiplyRight(o);break;case"X":var s=(new _core$7.Matrix4).rotateY(-Math.PI/2);a=a.multiplyRight(s)}t.isQuantized&&a.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var l=new _core$7.Vector3(i);t.cartesianModelMatrix=a,t.cartesianOrigin=l;var u=_geospatial$4.Ellipsoid.WGS84.cartesianToCartographic(l,new _core$7.Vector3),c=_geospatial$4.Ellipsoid.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=c.multiplyRight(a),t.cartographicOrigin=u,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}var frameState={},es5$o={},constants$7={},hasRequiredConstants$4;function requireConstants$4(){return hasRequiredConstants$4||(hasRequiredConstants$4=1,Object.defineProperty(constants$7,"__esModule",{value:!0}),constants$7.INTERSECTION=void 0,constants$7.INTERSECTION={OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),constants$7}var axisAlignedBoundingBox={},hasRequiredAxisAlignedBoundingBox;function requireAxisAlignedBoundingBox(){if(hasRequiredAxisAlignedBoundingBox)return axisAlignedBoundingBox;hasRequiredAxisAlignedBoundingBox=1;var e=interopRequireDefaultExports;Object.defineProperty(axisAlignedBoundingBox,"__esModule",{value:!0}),axisAlignedBoundingBox.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=requireConstants$4(),o=new i.Vector3,s=new i.Vector3,l=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],s=arguments.length>2?arguments[2]:void 0;(0,t.default)(this,e),(0,n.default)(this,"center",void 0),(0,n.default)(this,"halfDiagonal",void 0),(0,n.default)(this,"minimum",void 0),(0,n.default)(this,"maximum",void 0),s=s||o.copy(r).add(a).scale(.5),this.center=new i.Vector3(s),this.halfDiagonal=new i.Vector3(a).subtract(this.center),this.minimum=new i.Vector3(r),this.maximum=new i.Vector3(a)}return(0,r.default)(e,[{key:"clone",value:function(){return new e(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}},{key:"transform",value:function(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}},{key:"intersectPlane",value:function(e){var t=this.halfDiagonal,r=s.from(e.normal),n=t.x*Math.abs(r.x)+t.y*Math.abs(r.y)+t.z*Math.abs(r.z),i=this.center.dot(r)+e.distance;return i-n>0?a.INTERSECTION.INSIDE:i+n<0?a.INTERSECTION.OUTSIDE:a.INTERSECTION.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var t,r=o.from(e).subtract(this.center),n=this.halfDiagonal,i=0;return(t=Math.abs(r.x)-n.x)>0&&(i+=t*t),(t=Math.abs(r.y)-n.y)>0&&(i+=t*t),(t=Math.abs(r.z)-n.z)>0&&(i+=t*t),i}}]),e}();return axisAlignedBoundingBox.default=l,axisAlignedBoundingBox}var boundingSphere={},hasRequiredBoundingSphere;function requireBoundingSphere(){if(hasRequiredBoundingSphere)return boundingSphere;hasRequiredBoundingSphere=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(boundingSphere,"__esModule",{value:!0}),boundingSphere.default=void 0;var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=es5$q,o=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=l(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireMat4()),s=requireConstants$4();function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}var u=new a.Vector3,c=new a.Vector3,d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,r.default)(this,e),(0,i.default)(this,"center",void 0),(0,i.default)(this,"radius",void 0),this.radius=-0,this.center=new a.Vector3,this.fromCenterRadius(t,n)}return(0,n.default)(e,[{key:"fromCenterRadius",value:function(e,t){return this.center.from(e),this.radius=t,this}},{key:"fromCornerPoints",value:function(e,t){return t=u.from(t),this.center=(new a.Vector3).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}},{key:"clone",value:function(){return new e(this.center,this.radius)}},{key:"union",value:function(e){var t=this.center,r=this.radius,n=e.radius,i=u.copy(e.center).subtract(t),a=i.magnitude();if(r>=a+n)return this.clone();if(n>=a+r)return e.clone();var o=.5*(r+a+n);return c.copy(i).scale((-r+o)/a).add(t),this.center.copy(c),this.radius=o,this}},{key:"expand",value:function(e){var t=u.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}},{key:"transform",value:function(e){this.center.transform(e);var t=o.getScaling(u,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(e){var t=this.distanceTo(e);return t*t}},{key:"distanceTo",value:function(e){var t=u.from(e).subtract(this.center);return Math.max(0,t.len()-this.radius)}},{key:"intersectPlane",value:function(e){var t=this.radius,r=e.normal.dot(this.center)+e.distance;return r<-t?s.INTERSECTION.OUTSIDE:r<t?s.INTERSECTION.INTERSECTING:s.INTERSECTION.INSIDE}}]),e}();return boundingSphere.default=d,boundingSphere}var orientedBoundingBox={},toConsumableArray={exports:{}},arrayWithoutHoles={exports:{}},hasRequiredArrayWithoutHoles;function requireArrayWithoutHoles(){return hasRequiredArrayWithoutHoles||(hasRequiredArrayWithoutHoles=1,function(e){var t=requireArrayLikeToArray();e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(arrayWithoutHoles)),arrayWithoutHoles.exports}var iterableToArray={exports:{}},hasRequiredIterableToArray;function requireIterableToArray(){return hasRequiredIterableToArray||(hasRequiredIterableToArray=1,function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(iterableToArray)),iterableToArray.exports}var nonIterableSpread={exports:{}},hasRequiredNonIterableSpread,hasRequiredToConsumableArray,hasRequiredOrientedBoundingBox;function requireNonIterableSpread(){return hasRequiredNonIterableSpread||(hasRequiredNonIterableSpread=1,function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(nonIterableSpread)),nonIterableSpread.exports}function requireToConsumableArray(){return hasRequiredToConsumableArray||(hasRequiredToConsumableArray=1,function(e){var t=requireArrayWithoutHoles(),r=requireIterableToArray(),n=requireUnsupportedIterableToArray(),i=requireNonIterableSpread();e.exports=function(e){return t(e)||r(e)||n(e)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(toConsumableArray)),toConsumableArray.exports}function requireOrientedBoundingBox(){if(hasRequiredOrientedBoundingBox)return orientedBoundingBox;hasRequiredOrientedBoundingBox=1;var e=interopRequireDefaultExports;Object.defineProperty(orientedBoundingBox,"__esModule",{value:!0}),orientedBoundingBox.default=void 0;var t=e(requireToConsumableArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=es5$q,o=e(requireBoundingSphere()),s=requireConstants$4(),l=new a.Vector3,u=new a.Vector3,c=new a.Vector3,d=new a.Vector3,h=new a.Vector3,f=new a.Vector3,p=new a.Vector3,m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];(0,r.default)(this,e),(0,i.default)(this,"center",void 0),(0,i.default)(this,"halfAxes",void 0),this.center=(new a.Vector3).from(t),this.halfAxes=new a.Matrix3(n)}return(0,n.default)(e,[{key:"halfSize",get:function(){var e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new a.Vector3(e).len(),new a.Vector3(t).len(),new a.Vector3(r).len()]}},{key:"quaternion",get:function(){var e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new a.Vector3(e).normalize(),o=new a.Vector3(r).normalize(),s=new a.Vector3(n).normalize();return(new a.Quaternion).fromMatrix3(new a.Matrix3([].concat((0,t.default)(i),(0,t.default)(o),(0,t.default)(s))))}},{key:"fromCenterHalfSizeQuaternion",value:function(e,t,r){var n=new a.Quaternion(r),i=(new a.Matrix3).fromQuaternion(n);return i[0]=i[0]*t[0],i[1]=i[1]*t[0],i[2]=i[2]*t[0],i[3]=i[3]*t[1],i[4]=i[4]*t[1],i[5]=i[5]*t[1],i[6]=i[6]*t[2],i[7]=i[7]*t[2],i[8]=i[8]*t[2],this.center=(new a.Vector3).from(e),this.halfAxes=i,this}},{key:"clone",value:function(){return new e(this.center,this.halfAxes)}},{key:"equals",value:function(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}},{key:"getBoundingSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.default,t=this.halfAxes,r=t.getColumn(0,c),n=t.getColumn(1,d),i=t.getColumn(2,h),a=l.copy(r).add(n).add(i);return e.center.copy(this.center),e.radius=a.magnitude(),e}},{key:"intersectPlane",value:function(e){var t=this.center,r=e.normal,n=this.halfAxes,i=r.x,a=r.y,o=r.z,l=Math.abs(i*n[0]+a*n[1]+o*n[2])+Math.abs(i*n[3]+a*n[4]+o*n[5])+Math.abs(i*n[6]+a*n[7]+o*n[8]),u=r.dot(t)+e.distance;return u<=-l?s.INTERSECTION.OUTSIDE:u>=l?s.INTERSECTION.INSIDE:s.INTERSECTION.INTERSECTING}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceSquaredTo(e))}},{key:"distanceSquaredTo",value:function(e){var t=u.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,c),i=r.getColumn(1,d),a=r.getColumn(2,h),o=n.magnitude(),s=i.magnitude(),l=a.magnitude();n.normalize(),i.normalize(),a.normalize();var f,p=0;return(f=Math.abs(t.dot(n))-o)>0&&(p+=f*f),(f=Math.abs(t.dot(i))-s)>0&&(p+=f*f),(f=Math.abs(t.dot(a))-l)>0&&(p+=f*f),p}},{key:"computePlaneDistances",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,c),l=o.getColumn(1,d),u=o.getColumn(2,h),m=f.copy(s).add(l).add(u).add(a),g=p.copy(m).subtract(e),_=t.dot(g);return n=Math.min(_,n),i=Math.max(_,i),m.copy(a).add(s).add(l).subtract(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),m.copy(a).add(s).subtract(l).add(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),m.copy(a).add(s).subtract(l).subtract(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),a.copy(m).subtract(s).add(l).add(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),a.copy(m).subtract(s).add(l).subtract(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),a.copy(m).subtract(s).subtract(l).add(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),a.copy(m).subtract(s).subtract(l).subtract(u),g.copy(m).subtract(e),_=t.dot(g),n=Math.min(_,n),i=Math.max(_,i),r[0]=n,r[1]=i,r}},{key:"transform",value:function(e){this.center.transformAsPoint(e);var r=this.halfAxes.getColumn(0,c);r.transformAsPoint(e);var n=this.halfAxes.getColumn(1,d);n.transformAsPoint(e);var i=this.halfAxes.getColumn(2,h);return i.transformAsPoint(e),this.halfAxes=new a.Matrix3([].concat((0,t.default)(r),(0,t.default)(n),(0,t.default)(i))),this}},{key:"getTransform",value:function(){throw new Error("not implemented")}}]),e}();return orientedBoundingBox.default=m,orientedBoundingBox}var cullingVolume$1={},plane={},hasRequiredPlane,hasRequiredCullingVolume;function requirePlane(){if(hasRequiredPlane)return plane;hasRequiredPlane=1;var e=interopRequireDefaultExports;Object.defineProperty(plane,"__esModule",{value:!0}),plane.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=new i.Vector3,o=new i.Vector3,s=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,t.default)(this,e),(0,n.default)(this,"normal",void 0),(0,n.default)(this,"distance",void 0),this.normal=new i.Vector3,this.distance=-0,this.fromNormalDistance(r,a)}return(0,r.default)(e,[{key:"fromNormalDistance",value:function(e,t){return(0,i.assert)(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}},{key:"fromPointNormal",value:function(e,t){e=a.from(e),this.normal.from(t).normalize();var r=-this.normal.dot(e);return this.distance=r,this}},{key:"fromCoefficients",value:function(e,t,r,n){return this.normal.set(e,t,r),(0,i.assert)((0,i.equals)(this.normal.len(),1)),this.distance=n,this}},{key:"clone",value:function(){return new e(this.normal,this.distance)}},{key:"equals",value:function(e){return(0,i.equals)(this.distance,e.distance)&&(0,i.equals)(this.normal,e.normal)}},{key:"getPointDistance",value:function(e){return this.normal.dot(e)+this.distance}},{key:"transform",value:function(e){var t=o.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}},{key:"projectPointOntoPlane",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];e=a.from(e);var r=this.getPointDistance(e),n=o.copy(this.normal).scale(r);return e.subtract(n).to(t)}}]),e}();return plane.default=s,plane}function requireCullingVolume(){if(hasRequiredCullingVolume)return cullingVolume$1;hasRequiredCullingVolume=1;var e=interopRequireDefaultExports;Object.defineProperty(cullingVolume$1,"__esModule",{value:!0}),cullingVolume$1.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=requireConstants$4(),o=e(requirePlane());function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var u=[new i.Vector3([1,0,0]),new i.Vector3([0,1,0]),new i.Vector3([0,0,1])],c=new i.Vector3,d=new i.Vector3;new o.default(new i.Vector3(1,0,0),0);var h=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,t.default)(this,e),(0,n.default)(this,"planes",void 0),this.planes=r}return(0,r.default)(e,[{key:"fromBoundingSphere",value:function(e){this.planes.length=2*u.length;var t,r=e.center,n=e.radius,i=0,a=s(u);try{for(a.s();!(t=a.n()).done;){var l=t.value,h=this.planes[i],f=this.planes[i+1];h||(h=this.planes[i]=new o.default),f||(f=this.planes[i+1]=new o.default);var p=c.copy(l).scale(-n).add(r);l.dot(p),h.fromPointNormal(p,l);var m=c.copy(l).scale(n).add(r),g=d.copy(l).negate();g.dot(m),f.fromPointNormal(m,g),i+=2}}catch(e){a.e(e)}finally{a.f()}return this}},{key:"computeVisibility",value:function(e){var t,r=a.INTERSECTION.INSIDE,n=s(this.planes);try{for(n.s();!(t=n.n()).done;)switch(e.intersectPlane(t.value)){case a.INTERSECTION.OUTSIDE:return a.INTERSECTION.OUTSIDE;case a.INTERSECTION.INTERSECTING:r=a.INTERSECTION.INTERSECTING}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"computeVisibilityWithPlaneMask",value:function(t,r){if((0,i.assert)(Number.isFinite(r),"parentPlaneMask is required."),r===e.MASK_OUTSIDE||r===e.MASK_INSIDE)return r;for(var n=e.MASK_INSIDE,o=this.planes,s=0;s<this.planes.length;++s){var l=s<31?1<<s:0;if(!(s<31&&0==(r&l))){var u=t.intersectPlane(o[s]);if(u===a.INTERSECTION.OUTSIDE)return e.MASK_OUTSIDE;u===a.INTERSECTION.INTERSECTING&&(n|=l)}}return n}}]),e}();return cullingVolume$1.default=h,(0,n.default)(h,"MASK_OUTSIDE",4294967295),(0,n.default)(h,"MASK_INSIDE",0),(0,n.default)(h,"MASK_INDETERMINATE",2147483647),cullingVolume$1}var perspectiveOffCenterFrustum={},hasRequiredPerspectiveOffCenterFrustum;function requirePerspectiveOffCenterFrustum(){if(hasRequiredPerspectiveOffCenterFrustum)return perspectiveOffCenterFrustum;hasRequiredPerspectiveOffCenterFrustum=1;var e=interopRequireDefaultExports;Object.defineProperty(perspectiveOffCenterFrustum,"__esModule",{value:!0}),perspectiveOffCenterFrustum.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=e(requireCullingVolume()),o=e(requirePlane()),s=new i.Vector3,l=new i.Vector3,u=new i.Vector3,c=new i.Vector3,d=new i.Vector3,h=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"left",void 0),(0,n.default)(this,"_left",void 0),(0,n.default)(this,"right",void 0),(0,n.default)(this,"_right",void 0),(0,n.default)(this,"top",void 0),(0,n.default)(this,"_top",void 0),(0,n.default)(this,"bottom",void 0),(0,n.default)(this,"_bottom",void 0),(0,n.default)(this,"near",void 0),(0,n.default)(this,"_near",void 0),(0,n.default)(this,"far",void 0),(0,n.default)(this,"_far",void 0),(0,n.default)(this,"_cullingVolume",new a.default([new o.default,new o.default,new o.default,new o.default,new o.default,new o.default])),(0,n.default)(this,"_perspectiveMatrix",new i.Matrix4),(0,n.default)(this,"_infinitePerspective",new i.Matrix4);var s=r.near,l=void 0===s?1:s,u=r.far,c=void 0===u?5e8:u;this.left=r.left,this._left=void 0,this.right=r.right,this._right=void 0,this.top=r.top,this._top=void 0,this.bottom=r.bottom,this._bottom=void 0,this.near=l,this._near=l,this.far=c,this._far=c}return(0,r.default)(e,[{key:"clone",value:function(){return new e({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(t){return t&&t instanceof e&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}},{key:"projectionMatrix",get:function(){return this._update(),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._infinitePerspective}},{key:"computeCullingVolume",value:function(e,t,r){(0,i.assert)(e,"position is required."),(0,i.assert)(t,"direction is required."),(0,i.assert)(r,"up is required.");var n=this._cullingVolume.planes;r=s.copy(r).normalize();var a=l.copy(t).cross(r).normalize(),o=u.copy(t).multiplyByScalar(this.near).add(e),h=c.copy(t).multiplyByScalar(this.far).add(e),f=d;return f.copy(a).multiplyByScalar(this.left).add(o).subtract(e).cross(r),n[0].fromPointNormal(e,f),f.copy(a).multiplyByScalar(this.right).add(o).subtract(e).cross(r).negate(),n[1].fromPointNormal(e,f),f.copy(r).multiplyByScalar(this.bottom).add(o).subtract(e).cross(a).negate(),n[2].fromPointNormal(e,f),f.copy(r).multiplyByScalar(this.top).add(o).subtract(e).cross(a),n[3].fromPointNormal(e,f),f=(new i.Vector3).copy(t),n[4].fromPointNormal(o,f),f.negate(),n[5].fromPointNormal(h,f),this._cullingVolume}},{key:"getPixelDimensions",value:function(e,t,r,n){this._update(),(0,i.assert)(Number.isFinite(e)&&Number.isFinite(t)),(0,i.assert)(e>0),(0,i.assert)(t>0),(0,i.assert)(r>0),(0,i.assert)(n);var a=1/this.near,o=this.top*a,s=2*r*o/t;return n.x=2*r*(o=this.right*a)/e,n.y=s,n}},{key:"_update",value:function(){(0,i.assert)(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this.top,t=this.bottom,r=this.right,n=this.left,a=this.near,o=this.far;e===this._top&&t===this._bottom&&n===this._left&&r===this._right&&a===this._near&&o===this._far||((0,i.assert)(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=n,this._right=r,this._top=e,this._bottom=t,this._near=a,this._far=o,this._perspectiveMatrix=(new i.Matrix4).frustum({left:n,right:r,bottom:t,top:e,near:a,far:o}),this._infinitePerspective=(new i.Matrix4).frustum({left:n,right:r,bottom:t,top:e,near:a,far:1/0}))}}]),e}();return perspectiveOffCenterFrustum.default=h,perspectiveOffCenterFrustum}var perspectiveFrustum={},hasRequiredPerspectiveFrustum;function requirePerspectiveFrustum(){if(hasRequiredPerspectiveFrustum)return perspectiveFrustum;hasRequiredPerspectiveFrustum=1;var e=interopRequireDefaultExports;Object.defineProperty(perspectiveFrustum,"__esModule",{value:!0}),perspectiveFrustum.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=e(requirePerspectiveOffCenterFrustum()),o=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"_offCenterFrustum",new a.default),(0,n.default)(this,"fov",void 0),(0,n.default)(this,"_fov",void 0),(0,n.default)(this,"_fovy",void 0),(0,n.default)(this,"_sseDenominator",void 0),(0,n.default)(this,"aspectRatio",void 0),(0,n.default)(this,"_aspectRatio",void 0),(0,n.default)(this,"near",void 0),(0,n.default)(this,"_near",void 0),(0,n.default)(this,"far",void 0),(0,n.default)(this,"_far",void 0),(0,n.default)(this,"xOffset",void 0),(0,n.default)(this,"_xOffset",void 0),(0,n.default)(this,"yOffset",void 0),(0,n.default)(this,"_yOffset",void 0);var i=r.aspectRatio,o=r.near,s=void 0===o?1:o,l=r.far,u=void 0===l?5e8:l,c=r.xOffset,d=void 0===c?0:c,h=r.yOffset,f=void 0===h?0:h;this.fov=r.fov,this.aspectRatio=i,this.near=s,this.far=u,this.xOffset=d,this.yOffset=f}return(0,r.default)(e,[{key:"clone",value:function(){return new e({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(t){return null!=t&&t instanceof e&&(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}},{key:"projectionMatrix",get:function(){return this._update(),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return this._update(),this._fovy}},{key:"sseDenominator",get:function(){return this._update(),this._sseDenominator}},{key:"computeCullingVolume",value:function(e,t,r){return this._update(),this._offCenterFrustum.computeCullingVolume(e,t,r)}},{key:"getPixelDimensions",value:function(e,t,r,n){return this._update(),this._offCenterFrustum.getPixelDimensions(e,t,r,n||new i.Vector2)}},{key:"_update",value:function(){(0,i.assert)(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));var e=this._offCenterFrustum;this.fov===this._fov&&this.aspectRatio===this._aspectRatio&&this.near===this._near&&this.far===this._far&&this.xOffset===this._xOffset&&this.yOffset===this._yOffset||((0,i.assert)(this.fov>=0&&this.fov<Math.PI),(0,i.assert)(this.aspectRatio>0),(0,i.assert)(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:2*Math.atan(Math.tan(.5*this.fov)/this.aspectRatio),this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,e.top=this.near*Math.tan(.5*this._fovy),e.bottom=-e.top,e.right=this.aspectRatio*e.top,e.left=-e.right,e.near=this.near,e.far=this.far,e.right+=this.xOffset,e.left+=this.xOffset,e.top+=this.yOffset,e.bottom+=this.yOffset)}}]),e}();return perspectiveFrustum.default=o,perspectiveFrustum}var boundingSphereFromPoints={},hasRequiredBoundingSphereFromPoints;function requireBoundingSphereFromPoints(){if(hasRequiredBoundingSphereFromPoints)return boundingSphereFromPoints;hasRequiredBoundingSphereFromPoints=1;var e=interopRequireDefaultExports;Object.defineProperty(boundingSphereFromPoints,"__esModule",{value:!0}),boundingSphereFromPoints.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.default;if(!e||0===e.length)return t.fromCenterRadius([0,0,0],0);var i,_=d.copy(e[0]),y=a.copy(_),v=o.copy(_),b=s.copy(_),x=l.copy(_),T=u.copy(_),w=c.copy(_),E=n(e);try{for(E.s();!(i=E.n()).done;){_.copy(i.value);var A=_.x,S=_.y,P=_.z;A<y.x&&y.copy(_),A>x.x&&x.copy(_),S<v.y&&v.copy(_),S>T.y&&T.copy(_),P<b.z&&b.copy(_),P>w.z&&w.copy(_)}}catch(e){E.e(e)}finally{E.f()}var M=h.copy(x).subtract(y).magnitudeSquared(),R=h.copy(T).subtract(v).magnitudeSquared(),C=h.copy(w).subtract(b).magnitudeSquared(),O=y,L=x,I=M;R>I&&(I=R,O=v,L=T),C>I&&(I=C,O=b,L=w);var D=f;D.x=.5*(O.x+L.x),D.y=.5*(O.y+L.y),D.z=.5*(O.z+L.z);var k=h.copy(L).subtract(D).magnitudeSquared(),B=Math.sqrt(k),F=p;F.x=y.x,F.y=v.y,F.z=b.z;var N=m;N.x=x.x,N.y=T.y,N.z=w.z;var q,U=g.copy(F).add(N).multiplyByScalar(.5),j=0,G=n(e);try{for(G.s();!(q=G.n()).done;){_.copy(q.value);var z=h.copy(_).subtract(U).magnitude();z>j&&(j=z);var V=h.copy(_).subtract(D).magnitudeSquared();if(V>k){var $=Math.sqrt(V);k=(B=.5*(B+$))*B;var H=$-B;D.x=(B*D.x+H*_.x)/$,D.y=(B*D.y+H*_.y)/$,D.z=(B*D.z+H*_.z)/$}}}catch(e){G.e(e)}finally{G.f()}return B<j?(D.to(t.center),t.radius=B):(U.to(t.center),t.radius=j),t};var t=es5$q,r=e(requireBoundingSphere());function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a=new t.Vector3,o=new t.Vector3,s=new t.Vector3,l=new t.Vector3,u=new t.Vector3,c=new t.Vector3,d=new t.Vector3,h=new t.Vector3,f=new t.Vector3,p=new t.Vector3,m=new t.Vector3,g=new t.Vector3;return boundingSphereFromPoints}var boundingBoxFromPoints={},computeEigenDecomposition={},hasRequiredComputeEigenDecomposition,hasRequiredBoundingBoxFromPoints,hasRequiredEs5$a;function requireComputeEigenDecomposition(){if(hasRequiredComputeEigenDecomposition)return computeEigenDecomposition;hasRequiredComputeEigenDecomposition=1,Object.defineProperty(computeEigenDecomposition,"__esModule",{value:!0}),computeEigenDecomposition.default=function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e._MathUtils.EPSILON20,c=0,d=0,h=r,f=n;h.identity(),f.copy(t);for(var p=s*function(e){for(var t=0,r=0;r<9;++r){var n=e[r];t+=n*n}return Math.sqrt(t)}(f);d<10&&l(f)>p;)u(f,i),a.copy(i).transpose(),f.multiplyRight(i),f.multiplyLeft(a),h.multiplyRight(i),++c>2&&(++d,c=0);return o.unitary=h.toTarget(o.unitary),o.diagonal=f.toTarget(o.diagonal),o};var e=es5$q,t=new e.Matrix3,r=new e.Matrix3,n=new e.Matrix3,i=new e.Matrix3,a=new e.Matrix3,o=[1,0,0],s=[2,2,1];function l(e){for(var r=0,n=0;n<3;++n){var i=e[t.getElementIndex(s[n],o[n])];r+=2*i*i}return Math.sqrt(r)}function u(r,n){for(var i=e._MathUtils.EPSILON15,a=0,l=1,u=0;u<3;++u){var c=Math.abs(r[t.getElementIndex(s[u],o[u])]);c>a&&(l=u,a=c)}var d=o[l],h=s[l],f=1,p=0;if(Math.abs(r[t.getElementIndex(h,d)])>i){var m,g=(r[t.getElementIndex(h,h)]-r[t.getElementIndex(d,d)])/2/r[t.getElementIndex(h,d)];p=(m=g<0?-1/(-g+Math.sqrt(1+g*g)):1/(g+Math.sqrt(1+g*g)))*(f=1/Math.sqrt(1+m*m))}return e.Matrix3.IDENTITY.to(n),n[t.getElementIndex(d,d)]=n[t.getElementIndex(h,h)]=f,n[t.getElementIndex(h,d)]=p,n[t.getElementIndex(d,h)]=-p,n}return computeEigenDecomposition}function requireBoundingBoxFromPoints(){if(hasRequiredBoundingBoxFromPoints)return boundingBoxFromPoints;hasRequiredBoundingBoxFromPoints=1;var e=interopRequireDefaultExports;Object.defineProperty(boundingBoxFromPoints,"__esModule",{value:!0}),boundingBoxFromPoints.makeOrientedBoundingBoxFromPoints=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.default;if(!e||0===e.length)return i.halfAxes=new t.Matrix3([0,0,0,0,0,0,0,0,0]),i.center=new t.Vector3,i;var o,p=e.length,m=new t.Vector3(0,0,0),g=a(e);try{for(g.s();!(o=g.n()).done;)m.add(o.value)}catch(e){g.e(e)}finally{g.f()}var _=1/p;m.multiplyByScalar(_);var y,v=0,b=0,x=0,T=0,w=0,E=0,A=a(e);try{for(A.s();!(y=A.n()).done;){var S=s.copy(y.value).subtract(m);v+=S.x*S.x,b+=S.x*S.y,x+=S.x*S.z,T+=S.y*S.y,w+=S.y*S.z,E+=S.z*S.z}}catch(e){A.e(e)}finally{A.f()}b*=_,x*=_,T*=_,w*=_,E*=_;var P=h;P[0]=v*=_,P[1]=b,P[2]=x,P[3]=b,P[4]=T,P[5]=w,P[6]=x,P[7]=w,P[8]=E;var M,R=(0,r.default)(P,f),C=i.halfAxes.copy(R.unitary),O=C.getColumn(0,u),L=C.getColumn(1,c),I=C.getColumn(2,d),D=-Number.MAX_VALUE,k=-Number.MAX_VALUE,B=-Number.MAX_VALUE,F=Number.MAX_VALUE,N=Number.MAX_VALUE,q=Number.MAX_VALUE,U=a(e);try{for(U.s();!(M=U.n()).done;)s.copy(M.value),D=Math.max(s.dot(O),D),k=Math.max(s.dot(L),k),B=Math.max(s.dot(I),B),F=Math.min(s.dot(O),F),N=Math.min(s.dot(L),N),q=Math.min(s.dot(I),q)}catch(e){U.e(e)}finally{U.f()}O=O.multiplyByScalar(.5*(F+D)),L=L.multiplyByScalar(.5*(N+k)),I=I.multiplyByScalar(.5*(q+B)),i.center.copy(O).add(L).add(I);var j=l.set(D-F,k-N,B-q).multiplyByScalar(.5),G=new t.Matrix3([j[0],0,0,0,j[1],0,0,0,j[2]]);return i.halfAxes.multiplyRight(G),i},boundingBoxFromPoints.makeAxisAlignedBoundingBoxFromPoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.default;if(!e||0===e.length)return t.minimum.set(0,0,0),t.maximum.set(0,0,0),t.center.set(0,0,0),t.halfDiagonal.set(0,0,0),t;var r,n=e[0][0],o=e[0][1],s=e[0][2],l=e[0][0],u=e[0][1],c=e[0][2],d=a(e);try{for(d.s();!(r=d.n()).done;){var h=r.value,f=h[0],p=h[1],m=h[2];n=Math.min(f,n),l=Math.max(f,l),o=Math.min(p,o),u=Math.max(p,u),s=Math.min(m,s),c=Math.max(m,c)}}catch(e){d.e(e)}finally{d.f()}return t.minimum.set(n,o,s),t.maximum.set(l,u,c),t.center.copy(t.minimum).add(t.maximum).scale(.5),t.halfDiagonal.copy(t.maximum).subtract(t.center),t};var t=es5$q,r=e(requireComputeEigenDecomposition()),n=e(requireOrientedBoundingBox()),i=e(requireAxisAlignedBoundingBox());function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=new t.Vector3,l=new t.Vector3,u=new t.Vector3,c=new t.Vector3,d=new t.Vector3,h=new t.Matrix3,f={diagonal:new t.Matrix3,unitary:new t.Matrix3};return boundingBoxFromPoints}function requireEs5$a(){return hasRequiredEs5$a||(hasRequiredEs5$a=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"INTERSECTION",{enumerable:!0,get:function(){return r.INTERSECTION}}),Object.defineProperty(e,"AxisAlignedBoundingBox",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"BoundingSphere",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"OrientedBoundingBox",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"CullingVolume",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"Plane",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"_PerspectiveOffCenterFrustum",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"_PerspectiveFrustum",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"makeBoundingSphereFromPoints",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"makeAxisAlignedBoundingBoxFromPoints",{enumerable:!0,get:function(){return d.makeAxisAlignedBoundingBoxFromPoints}}),Object.defineProperty(e,"makeOrientedBoundingBoxFromPoints",{enumerable:!0,get:function(){return d.makeOrientedBoundingBoxFromPoints}}),Object.defineProperty(e,"computeEigenDecomposition",{enumerable:!0,get:function(){return h.default}});var r=requireConstants$4(),n=t(requireAxisAlignedBoundingBox()),i=t(requireBoundingSphere()),a=t(requireOrientedBoundingBox()),o=t(requireCullingVolume()),s=t(requirePlane()),l=t(requirePerspectiveOffCenterFrustum()),u=t(requirePerspectiveFrustum()),c=t(requireBoundingSphereFromPoints()),d=requireBoundingBoxFromPoints(),h=t(requireComputeEigenDecomposition())}(es5$o)),es5$o}var _interopRequireDefault$G=interopRequireDefaultExports;Object.defineProperty(frameState,"__esModule",{value:!0}),frameState.getFrameState=getFrameState,frameState.limitSelectedTiles=limitSelectedTiles;var _slicedToArray2$5=_interopRequireDefault$G(requireSlicedToArray()),_core$6=es5$q,_culling$2=requireEs5$a(),_geospatial$3=es5$p;function _createForOfIteratorHelper$8(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$8(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$8(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$8(e,t):void 0}}function _arrayLikeToArray$8(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var scratchVector$1=new _core$6.Vector3,scratchPosition=new _core$6.Vector3,cullingVolume=new _culling$2.CullingVolume([new _culling$2.Plane,new _culling$2.Plane,new _culling$2.Plane,new _culling$2.Plane,new _culling$2.Plane,new _culling$2.Plane]);function getFrameState(e,t){var r=e.cameraDirection,n=e.cameraUp,i=e.height,a=e.distanceScales.metersPerUnit,o=worldToCartesian(e,e.center),s=_geospatial$3.Ellipsoid.WGS84.eastNorthUpToFixedFrame(o),l=e.unprojectPosition(e.cameraPosition),u=_geospatial$3.Ellipsoid.WGS84.cartographicToCartesian(l,new _core$6.Vector3),c=new _core$6.Vector3(s.transformAsVector(new _core$6.Vector3(r).scale(a))).normalize(),d=new _core$6.Vector3(s.transformAsVector(new _core$6.Vector3(n).scale(a))).normalize();return commonSpacePlanesToWGS84(e),{camera:{position:u,direction:c,up:d},viewport:e,topDownViewport:new(0,e.constructor)({longitude:e.longitude,latitude:e.latitude,height:i,width:e.width,bearing:e.bearing,zoom:e.zoom,pitch:0}),height:i,cullingVolume:cullingVolume,frameNumber:t,sseDenominator:1.15}}function limitSelectedTiles(e,t,r){if(0===r||e.length<=r)return[e,[]];var n,i=[],a=t.viewport,o=a.longitude,s=a.latitude,l=_createForOfIteratorHelper$8(e.entries());try{for(l.s();!(n=l.n()).done;){var u=(0,_slicedToArray2$5.default)(n.value,2),c=u[0],d=(0,_slicedToArray2$5.default)(u[1].header.mbs,2),h=d[1],f=Math.abs(o-d[0]),p=Math.abs(s-h),m=Math.sqrt(p*p+f*f);i.push([c,m])}}catch(e){l.e(e)}finally{l.f()}for(var g=i.sort((function(e,t){return e[1]-t[1]})),_=[],y=0;y<r;y++)_.push(e[g[y][0]]);for(var v=[],b=r;b<g.length;b++)v.push(e[g[b][0]]);return[_,v]}function commonSpacePlanesToWGS84(e){var t=e.getFrustumPlanes(),r=closestPointOnPlane(t.near,e.cameraPosition),n=worldToCartesian(e,r),i=worldToCartesian(e,e.cameraPosition,scratchPosition),a=0;for(var o in cullingVolume.planes[a++].fromPointNormal(n,scratchVector$1.copy(n).subtract(i)),t)if("near"!==o){var s=worldToCartesian(e,closestPointOnPlane(t[o],r,scratchPosition),scratchPosition);cullingVolume.planes[a++].fromPointNormal(s,scratchVector$1.copy(n).subtract(s))}}function closestPointOnPlane(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _core$6.Vector3,n=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-n).add(t),r}function worldToCartesian(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _core$6.Vector3,n=e.unprojectPosition(t);return _geospatial$3.Ellipsoid.WGS84.cartographicToCartesian(n,r)}var zoom={},hasRequiredZoom;function requireZoom(){if(hasRequiredZoom)return zoom;hasRequiredZoom=1;var e=interopRequireDefaultExports;Object.defineProperty(zoom,"__esModule",{value:!0}),zoom.getZoomFromBoundingVolume=function(e,t){if(e instanceof n.OrientedBoundingBox){var r=function(e){e.getColumn(0,l);var t=e.getColumn(1),r=e.getColumn(2);return l.add(t).add(r).len()}(e.halfAxes);return Math.log2(s/(r+t[2]))}if(e instanceof n.BoundingSphere)return Math.log2(s/(e.radius+t[2]));if(e.width&&e.height){var i=e.height;return(Math.log2(a/e.width)+Math.log2(o/i))/2}return 1},zoom.getZoomFromExtent=function(e,r,n){var i=(0,t.default)(e,4);return u({xmin:i[0],xmax:i[2],ymin:i[1],ymax:i[3],zmin:0,zmax:0},r,n)},zoom.getZoomFromFullExtent=u;var t=e(requireSlicedToArray()),r=es5$q,n=requireEs5$a(),i=es5$p,a=6378137,o=6378137,s=6356752.314245179,l=new r.Vector3;function u(e,t,n){var a=i.Ellipsoid.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],new r.Vector3),o=Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2)+Math.pow(a[2]-n[2],2));return Math.log2(s/(o+t[2]))}return zoom}var tile3d={},es5$n={},fetchFile$1={},responseUtils={},isType={},hasRequiredIsType;function requireIsType(){if(hasRequiredIsType)return isType;hasRequiredIsType=1;var e=interopRequireDefaultExports;Object.defineProperty(isType,"__esModule",{value:!0}),isType.isWritableStream=isType.isWritableNodeStream=isType.isWritableDOMStream=isType.isResponse=isType.isReadableStream=isType.isReadableNodeStream=isType.isReadableDOMStream=isType.isPureObject=isType.isPromise=isType.isObject=isType.isIterator=isType.isIterable=isType.isFile=isType.isBuffer=isType.isBlob=isType.isAsyncIterable=void 0;var t=e(_typeofExports),r=function(e){return"boolean"==typeof e},n=function(e){return"function"==typeof e},i=function(e){return null!==e&&"object"===(0,t.default)(e)};isType.isObject=i,isType.isPureObject=function(e){return i(e)&&e.constructor==={}.constructor},isType.isPromise=function(e){return i(e)&&n(e.then)},isType.isIterable=function(e){return e&&"function"==typeof e[Symbol.iterator]},isType.isAsyncIterable=function(e){return e&&"function"==typeof e[Symbol.asyncIterator]},isType.isIterator=function(e){return e&&n(e.next)},isType.isResponse=function(e){return"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json},isType.isFile=function(e){return"undefined"!=typeof File&&e instanceof File},isType.isBlob=function(e){return"undefined"!=typeof Blob&&e instanceof Blob},isType.isBuffer=function(e){return e&&"object"===(0,t.default)(e)&&e.isBuffer};var a=function(e){return i(e)&&n(e.abort)&&n(e.getWriter)};isType.isWritableDOMStream=a;var o=function(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||i(e)&&n(e.tee)&&n(e.cancel)&&n(e.getReader)};isType.isReadableDOMStream=o;var s=function(e){return i(e)&&n(e.end)&&n(e.write)&&r(e.writable)};isType.isWritableNodeStream=s;var l=function(e){return i(e)&&n(e.read)&&n(e.pipe)&&r(e.readable)};return isType.isReadableNodeStream=l,isType.isReadableStream=function(e){return o(e)||l(e)},isType.isWritableStream=function(e){return a(e)||s(e)},isType}var resourceUtils={},mimeTypeUtils={},hasRequiredMimeTypeUtils;function requireMimeTypeUtils(){if(hasRequiredMimeTypeUtils)return mimeTypeUtils;hasRequiredMimeTypeUtils=1,Object.defineProperty(mimeTypeUtils,"__esModule",{value:!0}),mimeTypeUtils.parseMIMEType=function(e){var r=t.exec(e);return r?r[1]:e},mimeTypeUtils.parseMIMETypeFromURL=function(t){var r=e.exec(t);return r?r[1]:""};var e=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,t=/^([-\w.]+\/[-\w.+]+)/;return mimeTypeUtils}var urlUtils={},hasRequiredUrlUtils,hasRequiredResourceUtils,hasRequiredResponseUtils;function requireUrlUtils(){if(hasRequiredUrlUtils)return urlUtils;hasRequiredUrlUtils=1,Object.defineProperty(urlUtils,"__esModule",{value:!0}),urlUtils.extractQueryString=function(t){var r=t.match(e);return r&&r[0]},urlUtils.stripQueryString=function(t){return t.replace(e,"")};var e=/\?.*/;return urlUtils}function requireResourceUtils(){if(hasRequiredResourceUtils)return resourceUtils;hasRequiredResourceUtils=1,Object.defineProperty(resourceUtils,"__esModule",{value:!0}),resourceUtils.getResourceContentLength=function(t){return(0,e.isResponse)(t)?t.headers["content-length"]||-1:(0,e.isBlob)(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1},resourceUtils.getResourceMIMEType=function(n){if((0,e.isResponse)(n)){var i=n,a=i.headers.get("content-type")||"",o=(0,r.stripQueryString)(i.url);return(0,t.parseMIMEType)(a)||(0,t.parseMIMETypeFromURL)(o)}return(0,e.isBlob)(n)?n.type||"":"string"==typeof n?(0,t.parseMIMETypeFromURL)(n):""},resourceUtils.getResourceUrl=function(t){return(0,e.isResponse)(t)?t.url:(0,e.isBlob)(t)?t.name||"":"string"==typeof t?t:""};var e=requireIsType(),t=requireMimeTypeUtils(),r=requireUrlUtils();return resourceUtils}function requireResponseUtils(){if(hasRequiredResponseUtils)return responseUtils;hasRequiredResponseUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(responseUtils,"__esModule",{value:!0}),responseUtils.checkResponse=function(e){return o.apply(this,arguments)},responseUtils.checkResponseSync=function(e){if(!e.ok){var t="".concat(e.status," ").concat(e.statusText);throw t=t.length>60?"".concat(t.slice(0,60),"..."):t,new Error(t)}},responseUtils.makeResponse=function(e){return a.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireIsType(),i=requireResourceUtils();function a(){return a=(0,r.default)(t.default.mark((function e(r){var a,o,s,l,c,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,n.isResponse)(r)){e.next=2;break}return e.abrupt("return",r);case 2:return a={},(o=(0,i.getResourceContentLength)(r))>=0&&(a["content-length"]=String(o)),s=(0,i.getResourceUrl)(r),(l=(0,i.getResourceMIMEType)(r))&&(a["content-type"]=l),e.next=10,u(r);case 10:return(c=e.sent)&&(a["x-first-bytes"]=c),"string"==typeof r&&(r=(new TextEncoder).encode(r)),d=new Response(r,{headers:a}),Object.defineProperty(d,"url",{value:s}),e.abrupt("return",d);case 16:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function o(){return(o=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ok){e.next=5;break}return e.next=3,s(r);case 3:throw new Error(e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(e){return l.apply(this,arguments)}function l(){return(l=(0,r.default)(t.default.mark((function e(r){var n,i,a;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),e.prev=1,i=r.headers.get("Content-Type"),a=r.statusText,!i.includes("application/json")){e.next=11;break}return e.t0=a,e.t1=" ",e.next=9,r.text();case 9:e.t2=e.sent,a=e.t0+=e.t1.concat.call(e.t1,e.t2);case 11:n=(n+=a).length>60?"".concat(n.slice(0,60),"..."):n,e.next=17;break;case 15:e.prev=15,e.t3=e.catch(1);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=(0,r.default)(t.default.mark((function e(r){var n,i,a,o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=5,"string"!=typeof r){e.next=3;break}return e.abrupt("return","data:,".concat(r.slice(0,n)));case 3:if(!(r instanceof Blob)){e.next=8;break}return i=r.slice(0,5),e.next=7,new Promise((function(e){var t=new FileReader;t.onload=function(t){var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},t.readAsDataURL(i)}));case 7:return e.abrupt("return",e.sent);case 8:if(!(r instanceof ArrayBuffer)){e.next=12;break}return a=r.slice(0,n),o=d(a),e.abrupt("return","data:base64,".concat(o));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e){for(var t="",r=new Uint8Array(e),n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}return responseUtils}var _interopRequireDefault$F=interopRequireDefaultExports;Object.defineProperty(fetchFile$1,"__esModule",{value:!0}),fetchFile$1.fetchFile=fetchFile;var _regenerator$j=_interopRequireDefault$F(requireRegenerator()),_asyncToGenerator2$f=_interopRequireDefault$F(requireAsyncToGenerator()),_loaderUtils$d=es5$t,_responseUtils=requireResponseUtils();function fetchFile(e,t){return _fetchFile$1.apply(this,arguments)}function _fetchFile$1(){return(_fetchFile$1=(0,_asyncToGenerator2$f.default)(_regenerator$j.default.mark((function e(t,r){var n;return _regenerator$j.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}return t=(0,_loaderUtils$d.resolvePath)(t),n=r,null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(n=r.fetch),e.next=6,fetch(t,n);case 6:case 9:return e.abrupt("return",e.sent);case 7:return e.next=9,(0,_responseUtils.makeResponse)(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var readArrayBuffer$1={},_interopRequireDefault$E=interopRequireDefaultExports;Object.defineProperty(readArrayBuffer$1,"__esModule",{value:!0}),readArrayBuffer$1.readArrayBuffer=readArrayBuffer,readArrayBuffer$1.readBlob=readBlob;var _regenerator$i=_interopRequireDefault$E(requireRegenerator()),_asyncToGenerator2$e=_interopRequireDefault$E(requireAsyncToGenerator()),_loaderUtils$c=es5$t;function readArrayBuffer(e,t,r){return _readArrayBuffer.apply(this,arguments)}function _readArrayBuffer(){return(_readArrayBuffer=(0,_asyncToGenerator2$e.default)(_regenerator$i.default.mark((function e(t,r,n){var i;return _regenerator$i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof t){e.next=4;break}return e.next=3,_loaderUtils$c.fs._readToArrayBuffer(t,r,n);case 3:case 8:return e.abrupt("return",e.sent);case 4:return t instanceof Blob||(t=new Blob([t])),i=t.slice(r,r+n),e.next=8,readBlob(i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function readBlob(e){return _readBlob.apply(this,arguments)}function _readBlob(){return _readBlob=(0,_asyncToGenerator2$e.default)(_regenerator$i.default.mark((function e(t){return _regenerator$i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,r){var n=new FileReader;n.onload=function(t){var r;return e(null==t||null===(r=t.target)||void 0===r?void 0:r.result)},n.onerror=function(e){return r(e)},n.readAsArrayBuffer(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),_readBlob.apply(this,arguments)}var readFile={};Object.defineProperty(readFile,"__esModule",{value:!0}),readFile.readFileSync=readFileSync;var _loaderUtils$b=es5$t;function readFileSync(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e=(0,_loaderUtils$b.resolvePath)(e),!_loaderUtils$b.isBrowser){var r=_loaderUtils$b.fs.readFileSync(e,t);return"string"!=typeof r?(0,_loaderUtils$b.toArrayBuffer)(r):r}return t.nothrow||(0,_loaderUtils$b.assert)(!1),null}var writeFile$1={},_interopRequireDefault$D=interopRequireDefaultExports;Object.defineProperty(writeFile$1,"__esModule",{value:!0}),writeFile$1.writeFile=writeFile,writeFile$1.writeFileSync=writeFileSync;var _regenerator$h=_interopRequireDefault$D(requireRegenerator()),_asyncToGenerator2$d=_interopRequireDefault$D(requireAsyncToGenerator()),_loaderUtils$a=es5$t;function writeFile(e,t,r){return _writeFile$2.apply(this,arguments)}function _writeFile$2(){return(_writeFile$2=(0,_asyncToGenerator2$d.default)(_regenerator$h.default.mark((function e(t,r,n){return _regenerator$h.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,_loaderUtils$a.resolvePath)(t),_loaderUtils$a.isBrowser){e.next=4;break}return e.next=4,_loaderUtils$a.fs.writeFile(t,(0,_loaderUtils$a.toBuffer)(r),{flag:"w"});case 4:(0,_loaderUtils$a.assert)(!1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function writeFileSync(e,t,r){e=(0,_loaderUtils$a.resolvePath)(e),_loaderUtils$a.isBrowser||_loaderUtils$a.fs.writeFileSync(e,(0,_loaderUtils$a.toBuffer)(t),{flag:"w"}),(0,_loaderUtils$a.assert)(!1)}var loaderOptions={},optionUtils={},loggers$1={},dist$1,hasRequiredDist$1,dist,hasRequiredDist,hasRequiredLoggers$1;function requireDist$1(){if(hasRequiredDist$1)return dist$1;hasRequiredDist$1=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};function o(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function s(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||o()}function l(){return s()&&"undefined"!=typeof document}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(a,{VERSION:()=>g,assert:()=>b,console:()=>p,document:()=>h,getBrowser:()=>v,global:()=>u,isBrowser:()=>s,isBrowserMainThread:()=>l,isElectron:()=>o,isMobile:()=>y,process:()=>f,self:()=>c,window:()=>d}),e=a,dist$1=((e,a,o,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let o of n(a))i.call(e,o)||void 0===o||t(e,o,{get:()=>a[o],enumerable:!(s=r(a,o))||s.enumerable});return e})(t({},"__esModule",{value:!0}),e);var u=globalThis,c=globalThis.self||globalThis.window||globalThis.global,d=globalThis.window||globalThis.self||globalThis.global,h=globalThis.document||{},f=globalThis.process||{},p=globalThis.console,m=globalThis.navigator||{},g="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";s();var _=globalThis;function y(){return void 0!==_.orientation}function v(e){if(!e&&!s())return"Node";if(o(e))return"Electron";const t=e||m.userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=-1!==t.indexOf("MSIE "),n=-1!==t.indexOf("Trident/");return r||n?"IE":_.chrome?"Chrome":_.safari?"Safari":_.mozInnerScreenX?"Firefox":"Unknown"}function b(e,t){if(!e)throw new Error(t||"Assertion failed")}return dist$1}function requireDist(){if(hasRequiredDist)return dist;hasRequiredDist=1;var e,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,a={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(a,{COLOR:()=>h,LocalStorage:()=>s,Log:()=>A,addColor:()=>m,autobind:()=>g,default:()=>R,getHiResTimestamp:()=>v,leftPad:()=>l,rightPad:()=>u}),e=a,dist=((e,a,o,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let o of n(a))i.call(e,o)||void 0===o||t(e,o,{get:()=>a[o],enumerable:!(s=r(a,o))||s.enumerable});return e})(t({},"__esModule",{value:!0}),e);var o=requireDist$1(),s=class{constructor(e,t,r="sessionStorage"){this.storage=function(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function l(e,t=8){const r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}function u(e,t=8){const r=Math.max(t-e.length,0);return`${e}${" ".repeat(r)}`}function c(e,t,r,n=600){const i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));const a=e.width*r,o=e.height*r;return[`${t} %c+`,["font-size:1px;",`padding:${Math.floor(o/2)}px ${Math.floor(a/2)}px;`,`line-height:${o}px;`,`background:url(${i});`,`background-size:${a}px ${o}px;`,"color:transparent;"].join("")]}var d=requireDist$1(),h=(e=>(e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE",e))(h||{}),f=10;function p(e){return"string"!=typeof e?e:(e=e.toUpperCase(),h[e]||37)}function m(e,t,r){return d.isBrowser||"string"!=typeof e||(t&&(e=`[${p(t)}m${e}[39m`),r&&(e=`[${p(r)+f}m${e}[49m`)),e}function g(e,t=["constructor"]){const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),i=e;for(const r of n){const n=i[r];"function"==typeof n&&(t.find((e=>r===e))||(i[r]=n.bind(e)))}}function _(e,t){if(!e)throw new Error(t||"Assertion failed")}var y=requireDist$1();function v(){var e,t,r,n,i;let a;if((0,y.isBrowser)()&&y.window.performance)a=null==(r=null==(t=null==(e=y.window)?void 0:e.performance)?void 0:t.now)?void 0:r.call(t);else if("hrtime"in y.process){const e=null==(i=null==(n=y.process)?void 0:n.hrtime)?void 0:i.call(n);a=1e3*e[0]+e[1]/1e6}else a=Date.now();return a}var b={debug:(0,o.isBrowser)()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},x={enabled:!0,level:0};function T(){}var w={},E={once:!0},A=class{constructor({id:e}={id:""}){this.VERSION=o.VERSION,this._startTs=v(),this._deltaTs=v(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new s(`__probe-${this.id}__`,x),this.timeStamp(`${this.id} started`),g(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((v()-this._startTs).toPrecision(10))}getDelta(){return Number((v()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){_(e,t)}warn(e){return this._getLogFunction(0,e,b.warn,arguments,E)}error(e){return this._getLogFunction(0,e,b.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,b.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,b.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,b.debug||b.info,arguments,E)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||T,r&&[r],{tag:M(t)}):T}image({logLevel:e,priority:t,image:r,message:n="",scale:i=1}){return this._shouldLog(e||t)?(0,o.isBrowser)()?function({image:e,message:t="",scale:r=1}){if("string"==typeof e){const n=new Image;return n.onload=()=>{const e=c(n,t,r);console.log(...e)},n.src=e,T}const n=e.nodeName||"";if("img"===n.toLowerCase())return console.log(...c(e,t,r)),T;if("canvas"===n.toLowerCase()){const n=new Image;return n.onload=()=>console.log(...c(n,t,r)),n.src=e.toDataURL(),T}return T}({image:r,message:n,scale:i}):function({message:e="",scale:t=1}){return console.warn("removed"),T}({image:r,message:n,scale:i}):T}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||T)}group(e,t,r={collapsed:!1}){const n=P({logLevel:e,message:t,opts:r}),{collapsed:i}=r;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||T)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=S(e)}_getLogFunction(e,t,r,n,i){if(this._shouldLog(e)){i=P({logLevel:e,message:t,args:n,opts:i}),_(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=v();const a=i.tag||i.message;if(i.once&&a){if(w[a])return T;w[a]=v()}return t=function(e,t,r){if("string"==typeof t){const n=r.time?l(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(r.total)):"";t=m(t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,r.color,r.background)}return t}(this.id,i.message,i),r.bind(console,t,...i.args)}return T}};function S(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return _(Number.isFinite(t)&&t>=0),t}function P(e){const{logLevel:t,message:r}=e;e.logLevel=S(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const i=typeof e.message;return _("string"===i||"object"===i),Object.assign(e,{args:n},e.opts)}function M(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}A.VERSION=o.VERSION,globalThis.probe={};var R=new A({id:"@probe.gl/log"});return dist}function requireLoggers$1(){if(hasRequiredLoggers$1)return loggers$1;hasRequiredLoggers$1=1;var e=interopRequireDefaultExports;Object.defineProperty(loggers$1,"__esModule",{value:!0}),loggers$1.probeLog=loggers$1.NullLog=loggers$1.ConsoleLog=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=new(requireDist().Log)({id:"loaders.gl"});loggers$1.probeLog=i;var a=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),e}();loggers$1.NullLog=a;var o=function(){function e(){(0,r.default)(this,e),(0,t.default)(this,"console",void 0),this.console=console}return(0,n.default)(e,[{key:"log",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.console.log).bind.apply(e,[this.console].concat(r))}},{key:"info",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.console.info).bind.apply(e,[this.console].concat(r))}},{key:"warn",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.console.warn).bind.apply(e,[this.console].concat(r))}},{key:"error",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=this.console.error).bind.apply(e,[this.console].concat(r))}}]),e}();return loggers$1.ConsoleLog=o,loggers$1}var optionDefaults={},hasRequiredOptionDefaults;function requireOptionDefaults(){if(hasRequiredOptionDefaults)return optionDefaults;hasRequiredOptionDefaults=1,Object.defineProperty(optionDefaults,"__esModule",{value:!0}),optionDefaults.REMOVED_LOADER_OPTIONS=optionDefaults.DEFAULT_LOADER_OPTIONS=void 0;var e=es5$t,t={fetch:null,mimeType:void 0,nothrow:!1,log:new(requireLoggers$1().ConsoleLog),CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:e.isBrowser,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]};return optionDefaults.DEFAULT_LOADER_OPTIONS=t,optionDefaults.REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},optionDefaults}var _interopRequireDefault$C=interopRequireDefaultExports;Object.defineProperty(optionUtils,"__esModule",{value:!0}),optionUtils.getGlobalLoaderOptions=void 0,optionUtils.getGlobalLoaderState=getGlobalLoaderState,optionUtils.normalizeOptions=normalizeOptions,optionUtils.setGlobalOptions=setGlobalOptions;var _defineProperty2$h=_interopRequireDefault$C(requireDefineProperty()),_isType$4=requireIsType(),_loggers=requireLoggers$1(),_optionDefaults=requireOptionDefaults();function _createForOfIteratorHelper$7(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$7(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$7(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$7(e,t):void 0}}function _arrayLikeToArray$7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys$b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$b(Object(r),!0).forEach((function(t){(0,_defineProperty2$h.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};var e=globalThis.loaders;return e._state=e._state||{},e._state}var getGlobalLoaderOptions=function(){var e=getGlobalLoaderState();return e.globalOptions=e.globalOptions||_objectSpread$b({},_optionDefaults.DEFAULT_LOADER_OPTIONS),e.globalOptions};function setGlobalOptions(e){var t=getGlobalLoaderState(),r=getGlobalLoaderOptions();t.globalOptions=normalizeOptionsInternal(r,e)}function normalizeOptions(e,t,r,n){return r=r||[],validateOptions(e,r=Array.isArray(r)?r:[r]),normalizeOptionsInternal(t,e,n)}function validateOptions(e,t){validateOptionsObject(e,null,_optionDefaults.DEFAULT_LOADER_OPTIONS,_optionDefaults.REMOVED_LOADER_OPTIONS,t);var r,n=_createForOfIteratorHelper$7(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;validateOptionsObject(e&&e[i.id]||{},i.id,i.options&&i.options[i.id]||{},i.deprecatedOptions&&i.deprecatedOptions[i.id]||{},t)}}catch(e){n.e(e)}finally{n.f()}}function validateOptionsObject(e,t,r,n,i){var a=t||"Top level",o=t?"".concat(t,"."):"";for(var s in e){var l=!t&&(0,_isType$4.isObject)(e[s]);if(!(s in r)&&("baseUri"!==s||t)&&("workerUrl"!==s||!t))if(s in n)_loggers.probeLog.warn("".concat(a," loader option '").concat(o).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!l){var u=findSimilarOption(s,i);_loggers.probeLog.warn("".concat(a," loader option '").concat(o).concat(s,"' not recognized. ").concat(u))()}}}function findSimilarOption(e,t){var r,n=e.toLowerCase(),i="",a=_createForOfIteratorHelper$7(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;for(var s in o.options){if(e===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var l=s.toLowerCase();(n.startsWith(l)||l.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(e){a.e(e)}finally{a.f()}return i}function normalizeOptionsInternal(e,t,r){var n=_objectSpread$b({},e.options||{});return addUrlOptions(n,r),null===n.log&&(n.log=new _loggers.NullLog),mergeNestedFields(n,getGlobalLoaderOptions()),mergeNestedFields(n,t),n}function mergeNestedFields(e,t){for(var r in t)r in t&&(e[r]=(0,_isType$4.isPureObject)(t[r])&&(0,_isType$4.isPureObject)(e[r])?_objectSpread$b(_objectSpread$b({},e[r]),t[r]):t[r])}function addUrlOptions(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}optionUtils.getGlobalLoaderOptions=getGlobalLoaderOptions,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getLoaderOptions",{enumerable:!0,get:function(){return t.getGlobalLoaderOptions}}),Object.defineProperty(e,"setLoaderOptions",{enumerable:!0,get:function(){return t.setGlobalOptions}});var t=optionUtils}(loaderOptions);var registerLoaders$1={},normalizeLoader$1={},_interopRequireDefault$B=interopRequireDefaultExports;Object.defineProperty(normalizeLoader$1,"__esModule",{value:!0}),normalizeLoader$1.isLoaderObject=isLoaderObject,normalizeLoader$1.normalizeLoader=normalizeLoader;var _defineProperty2$g=_interopRequireDefault$B(requireDefineProperty()),_loaderUtils$9=es5$t;function ownKeys$a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$a(Object(r),!0).forEach((function(t){(0,_defineProperty2$g.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function isLoaderObject(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function normalizeLoader(e){var t,r,n;return(0,_loaderUtils$9.assert)(e,"null loader"),(0,_loaderUtils$9.assert)(isLoaderObject(e),"invalid loader"),Array.isArray(e)&&(n=e[1],e=_objectSpread$a(_objectSpread$a({},e=e[0]),{},{options:_objectSpread$a(_objectSpread$a({},e.options),n)})),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(r=e)&&void 0!==r&&r.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}Object.defineProperty(registerLoaders$1,"__esModule",{value:!0}),registerLoaders$1._unregisterLoaders=_unregisterLoaders,registerLoaders$1.getRegisteredLoaders=getRegisteredLoaders,registerLoaders$1.registerLoaders=registerLoaders;var _normalizeLoader$6=normalizeLoader$1,_optionUtils$3=optionUtils;function _createForOfIteratorHelper$6(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$6(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$6(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$6(e,t):void 0}}function _arrayLikeToArray$6(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var getGlobalLoaderRegistry=function(){var e=(0,_optionUtils$3.getGlobalLoaderState)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function registerLoaders(e){var t,r=getGlobalLoaderRegistry(),n=_createForOfIteratorHelper$6(e=Array.isArray(e)?e:[e]);try{var i=function(){var e=(0,_normalizeLoader$6.normalizeLoader)(t.value);r.find((function(t){return e===t}))||r.unshift(e)};for(n.s();!(t=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}function _unregisterLoaders(){(0,_optionUtils$3.getGlobalLoaderState)().loaderRegistry=[]}var selectLoader$1={},log$5={},hasRequiredLog$2;function requireLog$2(){if(hasRequiredLog$2)return log$5;hasRequiredLog$2=1,Object.defineProperty(log$5,"__esModule",{value:!0}),log$5.log=void 0;var e=new(requireDist().Log)({id:"loaders.gl"});return log$5.log=e,log$5}var _interopRequireDefault$A=interopRequireDefaultExports;Object.defineProperty(selectLoader$1,"__esModule",{value:!0}),selectLoader$1.selectLoader=selectLoader,selectLoader$1.selectLoaderSync=selectLoaderSync;var _regenerator$g=_interopRequireDefault$A(requireRegenerator()),_defineProperty2$f=_interopRequireDefault$A(requireDefineProperty()),_typeof2$3=_interopRequireDefault$A(_typeofExports),_toConsumableArray2$3=_interopRequireDefault$A(requireToConsumableArray()),_asyncToGenerator2$c=_interopRequireDefault$A(requireAsyncToGenerator()),_loaderUtils$8=es5$t,_normalizeLoader$5=normalizeLoader$1,_log$3=requireLog$2(),_resourceUtils$3=requireResourceUtils(),_registerLoaders=registerLoaders$1,_isType$3=requireIsType(),_urlUtils=requireUrlUtils();function ownKeys$9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$9(Object(r),!0).forEach((function(t){(0,_defineProperty2$f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$9(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createForOfIteratorHelper$5(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$5(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$5(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$5(e,t):void 0}}function _arrayLikeToArray$5(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var EXT_PATTERN=/\.([^.]+)$/;function selectLoader(e){return _selectLoader$3.apply(this,arguments)}function _selectLoader$3(){return _selectLoader$3=(0,_asyncToGenerator2$c.default)(_regenerator$g.default.mark((function e(t){var r,n,i,a,o=arguments;return _regenerator$g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,validHTTPResponse(t)){e.next=5;break}return e.abrupt("return",null);case 5:if(!(a=selectLoaderSync(t,r,_objectSpread$9(_objectSpread$9({},n),{},{nothrow:!0}),i))){e.next=8;break}return e.abrupt("return",a);case 8:if(!(0,_isType$3.isBlob)(t)){e.next=13;break}return e.next=11,t.slice(0,10).arrayBuffer();case 11:a=selectLoaderSync(t=e.sent,r,n,i);case 13:if(a||null!=n&&n.nothrow){e.next=15;break}throw new Error(getNoValidLoaderMessage(t));case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),_selectLoader$3.apply(this,arguments)}function selectLoaderSync(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!validHTTPResponse(e))return null;if(t&&!Array.isArray(t))return(0,_normalizeLoader$5.normalizeLoader)(t);var i,a=[];t&&(a=a.concat(t)),null!=r&&r.ignoreRegisteredLoaders||(i=a).push.apply(i,(0,_toConsumableArray2$3.default)((0,_registerLoaders.getRegisteredLoaders)())),normalizeLoaders(a);var o=selectLoaderInternal(e,a,r,n);if(!(o||null!=r&&r.nothrow))throw new Error(getNoValidLoaderMessage(e));return o}function selectLoaderInternal(e,t,r,n){var i,a=(0,_resourceUtils$3.getResourceUrl)(e),o=(0,_resourceUtils$3.getResourceMIMEType)(e),s=(0,_urlUtils.stripQueryString)(a)||(null==n?void 0:n.url),l=null,u="";return null!=r&&r.mimeType&&(l=findLoaderByMIMEType(t,null==r?void 0:r.mimeType),u="match forced by supplied MIME type ".concat(null==r?void 0:r.mimeType)),l=l||findLoaderByUrl(t,s),u=u||(l?"matched url ".concat(s):""),l=l||findLoaderByMIMEType(t,o),u=u||(l?"matched MIME type ".concat(o):""),l=l||findLoaderByInitialBytes(t,e),u=u||(l?"matched initial data ".concat(getFirstCharacters(e)):""),l=l||findLoaderByMIMEType(t,null==r?void 0:r.fallbackMimeType),(u=u||(l?"matched fallback MIME type ".concat(o):""))&&_log$3.log.log(1,"selectLoader selected ".concat(null===(i=l)||void 0===i?void 0:i.name,": ").concat(u,".")),l}function validHTTPResponse(e){return!(e instanceof Response&&204===e.status)}function getNoValidLoaderMessage(e){var t=(0,_resourceUtils$3.getResourceUrl)(e),r=(0,_resourceUtils$3.getResourceMIMEType)(e),n="No valid loader found (";n+=t?"".concat(_loaderUtils$8.path.filename(t),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");var i=e?getFirstCharacters(e):"";return(n+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available")+")"}function normalizeLoaders(e){var t,r=_createForOfIteratorHelper$5(e);try{for(r.s();!(t=r.n()).done;)(0,_normalizeLoader$5.normalizeLoader)(t.value)}catch(e){r.e(e)}finally{r.f()}}function findLoaderByUrl(e,t){var r=t&&EXT_PATTERN.exec(t),n=r&&r[1];return n?findLoaderByExtension(e,n):null}function findLoaderByExtension(e,t){t=t.toLowerCase();var r,n=_createForOfIteratorHelper$5(e);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,o=_createForOfIteratorHelper$5(a.extensions);try{for(o.s();!(i=o.n()).done;)if(i.value.toLowerCase()===t)return a}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}return null}function findLoaderByMIMEType(e,t){var r,n=_createForOfIteratorHelper$5(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.mimeTypes&&i.mimeTypes.includes(t))return i;if(t==="application/x.".concat(i.id))return i}}catch(e){n.e(e)}finally{n.f()}return null}function findLoaderByInitialBytes(e,t){if(!t)return null;var r,n=_createForOfIteratorHelper$5(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("string"==typeof t){if(testDataAgainstText(t,i))return i}else if(ArrayBuffer.isView(t)){if(testDataAgainstBinary(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&testDataAgainstBinary(t,0,i))return i}}catch(e){n.e(e)}finally{n.f()}return null}function testDataAgainstText(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((function(t){return e.startsWith(t)}))}function testDataAgainstBinary(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((function(n){return testBinary(e,t,r,n)}))}function testBinary(e,t,r,n){if(n instanceof ArrayBuffer)return(0,_loaderUtils$8.compareArrayBuffers)(n,e,n.byteLength);switch((0,_typeof2$3.default)(n)){case"function":return n(e,r);case"string":return n===getMagicString$1(e,t,n.length);default:return!1}}function getFirstCharacters(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?getMagicString$1(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?getMagicString$1(e,0,t):""}function getMagicString$1(e,t,r){if(e.byteLength<t+r)return"";for(var n=new DataView(e),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(t+a));return i}var parse$3={},getData={},makeIterator$1={},makeStringIterator$1={},_interopRequireDefault$z=interopRequireDefaultExports;Object.defineProperty(makeStringIterator$1,"__esModule",{value:!0}),makeStringIterator$1.makeStringIterator=makeStringIterator;var _regenerator$f=_interopRequireDefault$z(requireRegenerator()),_marked=_regenerator$f.default.mark(makeStringIterator),DEFAULT_CHUNK_SIZE$2=262144;function makeStringIterator(e,t){var r,n,i,a,o;return _regenerator$f.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=(null==t?void 0:t.chunkSize)||DEFAULT_CHUNK_SIZE$2,n=0,i=new TextEncoder;case 3:if(!(n<e.length)){s.next=11;break}return a=Math.min(e.length-n,r),o=e.slice(n,n+a),n+=a,s.next=9,i.encode(o);case 9:s.next=3;break;case 11:case"end":return s.stop()}}),_marked)}var makeArrayBufferIterator$1={},_interopRequireDefault$y=interopRequireDefaultExports;Object.defineProperty(makeArrayBufferIterator$1,"__esModule",{value:!0}),makeArrayBufferIterator$1.makeArrayBufferIterator=makeArrayBufferIterator;var _regenerator$e=_interopRequireDefault$y(requireRegenerator()),DEFAULT_CHUNK_SIZE$1=262144;function makeArrayBufferIterator(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _regenerator$e.default.mark((function r(){var n,i,a,o,s,l;return _regenerator$e.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=void 0===(n=t.chunkSize)?DEFAULT_CHUNK_SIZE$1:n,a=0;case 2:if(!(a<e.byteLength)){r.next=13;break}return o=Math.min(e.byteLength-a,i),s=new ArrayBuffer(o),l=new Uint8Array(e,a,o),new Uint8Array(s).set(l),a+=o,r.next=11,s;case 11:r.next=2;break;case 13:case"end":return r.stop()}}),r)}))()}var makeBlobIterator$1={},_interopRequireDefault$x=interopRequireDefaultExports;Object.defineProperty(makeBlobIterator$1,"__esModule",{value:!0}),makeBlobIterator$1.makeBlobIterator=makeBlobIterator;var _regenerator$d=_interopRequireDefault$x(requireRegenerator()),_awaitAsyncGenerator2$3=_interopRequireDefault$x(requireAwaitAsyncGenerator()),_wrapAsyncGenerator2$3=_interopRequireDefault$x(requireWrapAsyncGenerator()),DEFAULT_CHUNK_SIZE=1048576;function makeBlobIterator(e,t){return _makeBlobIterator$1.apply(this,arguments)}function _makeBlobIterator$1(){return(_makeBlobIterator$1=(0,_wrapAsyncGenerator2$3.default)(_regenerator$d.default.mark((function e(t,r){var n,i,a,o;return _regenerator$d.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(null==r?void 0:r.chunkSize)||DEFAULT_CHUNK_SIZE,i=0;case 2:if(!(i<t.size)){e.next=12;break}return a=i+n,e.next=6,(0,_awaitAsyncGenerator2$3.default)(t.slice(i,a).arrayBuffer());case 6:return o=e.sent,i=a,e.next=10,o;case 10:e.next=2;break;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var makeStreamIterator$1={},_interopRequireDefault$w=interopRequireDefaultExports;Object.defineProperty(makeStreamIterator$1,"__esModule",{value:!0}),makeStreamIterator$1.makeStreamIterator=makeStreamIterator;var _regenerator$c=_interopRequireDefault$w(requireRegenerator()),_awaitAsyncGenerator2$2=_interopRequireDefault$w(requireAwaitAsyncGenerator()),_wrapAsyncGenerator2$2=_interopRequireDefault$w(requireWrapAsyncGenerator()),_loaderUtils$7=es5$t;function _asyncIterator$3(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator$3(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator$3(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator$3=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator$3.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator$3(e)}function makeStreamIterator(e,t){return _loaderUtils$7.isBrowser?makeBrowserStreamIterator(e,t):makeNodeStreamIterator(e,t)}function makeBrowserStreamIterator(e,t){return _makeBrowserStreamIterator.apply(this,arguments)}function _makeBrowserStreamIterator(){return(_makeBrowserStreamIterator=(0,_wrapAsyncGenerator2$2.default)(_regenerator$c.default.mark((function e(t,r){var n,i,a,o,s;return _regenerator$c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getReader(),e.prev=1;case 2:return a=i||n.read(),null!=r&&r._streamReadAhead&&(i=n.read()),e.next=7,(0,_awaitAsyncGenerator2$2.default)(a);case 7:if(s=(o=e.sent).value,!o.done){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,(0,_loaderUtils$7.toArrayBuffer)(s);case 14:e.next=2;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),n.releaseLock();case 21:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function makeNodeStreamIterator(e,t){return _makeNodeStreamIterator.apply(this,arguments)}function _makeNodeStreamIterator(){return(_makeNodeStreamIterator=(0,_wrapAsyncGenerator2$2.default)(_regenerator$c.default.mark((function e(t,r){var n,i,a,o,s,l;return _regenerator$c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,i=!1,e.prev=2,o=_asyncIterator$3(t);case 4:return e.next=6,(0,_awaitAsyncGenerator2$2.default)(o.next());case 6:if(!(n=!(s=e.sent).done)){e.next=13;break}return l=s.value,e.next=10,(0,_loaderUtils$7.toArrayBuffer)(l);case 10:n=!1,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),i=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!n||null==o.return){e.next=24;break}return e.next=24,(0,_awaitAsyncGenerator2$2.default)(o.return());case 24:if(e.prev=24,!i){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:case"end":return e.stop()}}),e,null,[[2,15,19,29],[20,,24,28]])})))).apply(this,arguments)}Object.defineProperty(makeIterator$1,"__esModule",{value:!0}),makeIterator$1.makeIterator=makeIterator;var _makeStringIterator=makeStringIterator$1,_makeArrayBufferIterator=makeArrayBufferIterator$1,_makeBlobIterator=makeBlobIterator$1,_makeStreamIterator=makeStreamIterator$1,_isType$2=requireIsType(),hasRequiredGetData;function makeIterator(e,t){if("string"==typeof e)return(0,_makeStringIterator.makeStringIterator)(e,t);if(e instanceof ArrayBuffer)return(0,_makeArrayBufferIterator.makeArrayBufferIterator)(e,t);if((0,_isType$2.isBlob)(e))return(0,_makeBlobIterator.makeBlobIterator)(e,t);if((0,_isType$2.isReadableStream)(e))return(0,_makeStreamIterator.makeStreamIterator)(e,t);if((0,_isType$2.isResponse)(e))return(0,_makeStreamIterator.makeStreamIterator)(e.body,t);throw new Error("makeIterator")}function requireGetData(){if(hasRequiredGetData)return getData;hasRequiredGetData=1;var e=interopRequireDefaultExports;Object.defineProperty(getData,"__esModule",{value:!0}),getData.getArrayBufferOrStringFromData=function(e,t,r){return u.apply(this,arguments)},getData.getArrayBufferOrStringFromDataSync=l,getData.getAsyncIterableFromData=function(e,t){return c.apply(this,arguments)},getData.getReadableStream=function(e){return d.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$t,i=requireIsType(),a=makeIterator$1,o=requireResponseUtils(),s="Cannot convert supplied data type";function l(e,t,r){if(t.text&&"string"==typeof e)return e;if((0,i.isBuffer)(e)&&(e=e.buffer),e instanceof ArrayBuffer){var n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);var a=e.buffer,o=e.byteLength||e.length;return 0===e.byteOffset&&o===a.byteLength||(a=a.slice(e.byteOffset,e.byteOffset+o)),a}throw new Error(s)}function u(){return(u=(0,r.default)(t.default.mark((function e(r,u,c){var d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=r instanceof ArrayBuffer||ArrayBuffer.isView(r),"string"!=typeof r&&!d){e.next=3;break}return e.abrupt("return",l(r,u));case 3:if(!(0,i.isBlob)(r)){e.next=7;break}return e.next=6,(0,o.makeResponse)(r);case 6:r=e.sent;case 7:if(!(0,i.isResponse)(r)){e.next=21;break}return h=r,e.next=11,(0,o.checkResponse)(h);case 11:if(!u.binary){e.next=17;break}return e.next=14,h.arrayBuffer();case 14:e.t0=e.sent,e.next=20;break;case 17:return e.next=19,h.text();case 19:e.t0=e.sent;case 20:return e.abrupt("return",e.t0);case 21:if((0,i.isReadableStream)(r)&&(r=(0,a.makeIterator)(r,c)),!(0,i.isIterable)(r)&&!(0,i.isAsyncIterable)(r)){e.next=24;break}return e.abrupt("return",(0,n.concatenateArrayBuffersAsync)(r));case 24:throw new Error(s);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(){return(c=(0,r.default)(t.default.mark((function e(r,n){var s;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,i.isIterator)(r)){e.next=2;break}return e.abrupt("return",r);case 2:if(!(0,i.isResponse)(r)){e.next=10;break}return s=r,e.next=6,(0,o.checkResponse)(s);case 6:return e.next=8,s.body;case 8:return e.abrupt("return",(0,a.makeIterator)(e.sent,n));case 10:if(!(0,i.isBlob)(r)&&!(0,i.isReadableStream)(r)){e.next=12;break}return e.abrupt("return",(0,a.makeIterator)(r,n));case 12:if(!(0,i.isAsyncIterable)(r)){e.next=14;break}return e.abrupt("return",r[Symbol.asyncIterator]());case 14:return e.abrupt("return",h(r));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return(d=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,i.isReadableStream)(r)){e.next=2;break}return e.abrupt("return",r);case 2:if(!(0,i.isResponse)(r)){e.next=4;break}return e.abrupt("return",r.body);case 4:return e.next=6,(0,o.makeResponse)(r);case 6:return e.abrupt("return",e.sent.body);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){if(ArrayBuffer.isView(e))return t.default.mark((function r(){return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.buffer;case 2:case"end":return t.stop()}}),r)}))();if(e instanceof ArrayBuffer)return t.default.mark((function r(){return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:case"end":return t.stop()}}),r)}))();if((0,i.isIterator)(e))return e;if((0,i.isIterable)(e))return e[Symbol.iterator]();throw new Error(s)}return getData}var loaderContext={},getFetchFunction={},hasRequiredGetFetchFunction,hasRequiredLoaderContext;function requireGetFetchFunction(){if(hasRequiredGetFetchFunction)return getFetchFunction;hasRequiredGetFetchFunction=1,Object.defineProperty(getFetchFunction,"__esModule",{value:!0}),getFetchFunction.getFetchFunction=function(n,i){var a=(0,r.getGlobalLoaderOptions)(),o=n||a;return"function"==typeof o.fetch?o.fetch:(0,e.isObject)(o.fetch)?function(e){return(0,t.fetchFile)(e,o)}:null!=i&&i.fetch?null==i?void 0:i.fetch:t.fetchFile};var e=requireIsType(),t=fetchFile$1,r=optionUtils;return getFetchFunction}function requireLoaderContext(){if(hasRequiredLoaderContext)return loaderContext;hasRequiredLoaderContext=1;var e=interopRequireDefaultExports;Object.defineProperty(loaderContext,"__esModule",{value:!0}),loaderContext.getLoaderContext=function(e,t,s){if(s)return s;var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({fetch:(0,n.getFetchFunction)(t,e)},e);if(l.url){var u=(0,i.stripQueryString)(l.url);l.baseUrl=u,l.queryString=(0,i.extractQueryString)(l.url),l.filename=a.path.filename(u),l.baseUrl=a.path.dirname(u)}return Array.isArray(l.loaders)||(l.loaders=null),l},loaderContext.getLoadersFromContext=function(e,r){if(!r&&e&&!Array.isArray(e))return e;var n;if(e&&(n=Array.isArray(e)?e:[e]),r&&r.loaders){var i=Array.isArray(r.loaders)?r.loaders:[r.loaders];n=n?[].concat((0,t.default)(n),(0,t.default)(i)):i}return n&&n.length?n:null};var t=e(requireToConsumableArray()),r=e(requireDefineProperty()),n=requireGetFetchFunction(),i=requireUrlUtils(),a=es5$t;function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}return loaderContext}var _interopRequireDefault$v=interopRequireDefaultExports;Object.defineProperty(parse$3,"__esModule",{value:!0}),parse$3.parse=parse$2;var _regenerator$b=_interopRequireDefault$v(requireRegenerator()),_typeof2$2=_interopRequireDefault$v(_typeofExports),_asyncToGenerator2$b=_interopRequireDefault$v(requireAsyncToGenerator()),_workerUtils$1=requireEs5$b(),_loaderUtils$6=es5$t,_normalizeLoader$4=normalizeLoader$1,_isType$1=requireIsType(),_optionUtils$2=optionUtils,_getData$2=requireGetData(),_loaderContext$2=requireLoaderContext(),_resourceUtils$2=requireResourceUtils(),_selectLoader$2=selectLoader$1;function parse$2(e,t,r,n){return _parse$3.apply(this,arguments)}function _parse$3(){return _parse$3=(0,_asyncToGenerator2$b.default)(_regenerator$b.default.mark((function e(t,r,n,i){var a,o,s;return _regenerator$b.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_workerUtils$1.assert)(!i||"object"===(0,_typeof2$2.default)(i)),!r||Array.isArray(r)||(0,_normalizeLoader$4.isLoaderObject)(r)||(i=void 0,n=r,r=void 0),e.next=4,t;case 4:return n=n||{},a=(0,_resourceUtils$2.getResourceUrl)(t=e.sent),o=(0,_loaderContext$2.getLoadersFromContext)(r,i),e.next=11,(0,_selectLoader$2.selectLoader)(t,o,n);case 11:if(s=e.sent){e.next=14;break}return e.abrupt("return",null);case 14:return n=(0,_optionUtils$2.normalizeOptions)(n,s,o,a),i=(0,_loaderContext$2.getLoaderContext)({url:a,parse:parse$2,loaders:o},n,i||null),e.next=18,parseWithLoader(s,t,n,i);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)}))),_parse$3.apply(this,arguments)}function parseWithLoader(e,t,r,n){return _parseWithLoader.apply(this,arguments)}function _parseWithLoader(){return _parseWithLoader=(0,_asyncToGenerator2$b.default)(_regenerator$b.default.mark((function e(t,r,n,i){var a,o,s,l,u,c,d,h;return _regenerator$b.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_workerUtils$1.validateWorkerVersion)(t),(0,_isType$1.isResponse)(r)&&(o=(a=r).ok,s=a.redirected,l=a.status,u=a.statusText,c=a.type,d=a.url,h=Object.fromEntries(a.headers.entries()),i.response={headers:h,ok:o,redirected:s,status:l,statusText:u,type:c,url:d}),e.next=4,(0,_getData$2.getArrayBufferOrStringFromData)(r,t,n);case 4:if(r=e.sent,!t.parseTextSync||"string"!=typeof r){e.next=8;break}return n.dataType="text",e.abrupt("return",t.parseTextSync(r,n,i,t));case 8:if(!(0,_loaderUtils$6.canParseWithWorker)(t,n)){e.next=12;break}return e.next=11,(0,_loaderUtils$6.parseWithWorker)(t,r,n,i,parse$2);case 11:case 15:case 19:return e.abrupt("return",e.sent);case 12:if(!t.parseText||"string"!=typeof r){e.next=16;break}return e.next=15,t.parseText(r,n,i,t);case 16:if(!t.parse){e.next=20;break}return e.next=19,t.parse(r,n,i,t);case 20:throw(0,_workerUtils$1.assert)(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"));case 22:case"end":return e.stop()}}),e)}))),_parseWithLoader.apply(this,arguments)}var parseSync$2={},_interopRequireDefault$u=interopRequireDefaultExports;Object.defineProperty(parseSync$2,"__esModule",{value:!0}),parseSync$2.parseSync=parseSync$1;var _typeof2$1=_interopRequireDefault$u(_typeofExports),_loaderUtils$5=es5$t,_selectLoader$1=selectLoader$1,_normalizeLoader$3=normalizeLoader$1,_optionUtils$1=optionUtils,_getData$1=requireGetData(),_loaderContext$1=requireLoaderContext(),_resourceUtils$1=requireResourceUtils();function parseSync$1(e,t,r,n){(0,_loaderUtils$5.assert)(!n||"object"===(0,_typeof2$1.default)(n)),Array.isArray(t)||(0,_normalizeLoader$3.isLoaderObject)(t)||(n=void 0,r=t,t=void 0),r=r||{};var i=(0,_loaderContext$1.getLoadersFromContext)(t,n),a=(0,_selectLoader$1.selectLoaderSync)(e,i,r);if(!a)return null;r=(0,_optionUtils$1.normalizeOptions)(r,a,i);var o=(0,_resourceUtils$1.getResourceUrl)(e);return parseWithLoaderSync(a,e,r,n=(0,_loaderContext$1.getLoaderContext)({url:o,parseSync:parseSync$1,parse:function(){throw new Error("parseSync called parse (which is async")},loaders:t},r,n||null))}function parseWithLoaderSync(e,t,r,n){if(t=(0,_getData$1.getArrayBufferOrStringFromDataSync)(t,e,r),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,r);if(e.parseSync&&t instanceof ArrayBuffer)return e.parseSync(t,r,n);throw new Error("".concat(e.name," loader: 'parseSync' not supported by this loader, use 'parse' instead. ").concat(n.url||""))}var parseInBatches$1={},asyncGeneratorDelegate={exports:{}},hasRequiredAsyncGeneratorDelegate;function requireAsyncGeneratorDelegate(){return hasRequiredAsyncGeneratorDelegate||(hasRequiredAsyncGeneratorDelegate=1,function(e){var t=requireOverloadYield();e.exports=function(e){var r={},n=!1;function i(r,i){return n=!0,i=new Promise((function(t){t(e[r](i))})),{done:!1,value:new t(i,1)}}return r["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},r.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(r.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(r.return=function(e){return n?(n=!1,e):i("return",e)}),r},e.exports.__esModule=!0,e.exports.default=e.exports}(asyncGeneratorDelegate)),asyncGeneratorDelegate.exports}var _interopRequireDefault$t=interopRequireDefaultExports;Object.defineProperty(parseInBatches$1,"__esModule",{value:!0}),parseInBatches$1.parseInBatches=parseInBatches;var _regenerator$a=_interopRequireDefault$t(requireRegenerator()),_defineProperty2$e=_interopRequireDefault$t(requireDefineProperty()),_typeof2=_interopRequireDefault$t(_typeofExports),_asyncToGenerator2$a=_interopRequireDefault$t(requireAsyncToGenerator()),_wrapAsyncGenerator2$1=_interopRequireDefault$t(requireWrapAsyncGenerator()),_awaitAsyncGenerator2$1=_interopRequireDefault$t(requireAwaitAsyncGenerator()),_asyncGeneratorDelegate2=_interopRequireDefault$t(requireAsyncGeneratorDelegate()),_loaderUtils$4=es5$t,_normalizeLoader$2=normalizeLoader$1,_optionUtils=optionUtils,_loaderContext=requireLoaderContext(),_getData=requireGetData(),_resourceUtils=requireResourceUtils(),_selectLoader=selectLoader$1,_parse$2=parse$3;function ownKeys$8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$8(Object(r),!0).forEach((function(t){(0,_defineProperty2$e.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$8(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _asyncIterator$2(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator$2(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator$2(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator$2=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator$2.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator$2(e)}function parseInBatches(e,t,r,n){return _parseInBatches$1.apply(this,arguments)}function _parseInBatches$1(){return _parseInBatches$1=(0,_asyncToGenerator2$a.default)(_regenerator$a.default.mark((function e(t,r,n,i){var a,o,s;return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_loaderUtils$4.assert)(!i||"object"===(0,_typeof2.default)(i)),a=Array.isArray(r)?r:void 0,Array.isArray(r)||(0,_normalizeLoader$2.isLoaderObject)(r)||(i=void 0,n=r,r=void 0),e.next=5,t;case 5:return n=n||{},o=(0,_resourceUtils.getResourceUrl)(t=e.sent),e.next=10,(0,_selectLoader.selectLoader)(t,r,n);case 10:if(s=e.sent){e.next=13;break}return e.abrupt("return",null);case 13:return n=(0,_optionUtils.normalizeOptions)(n,s,a,o),i=(0,_loaderContext.getLoaderContext)({url:o,parseInBatches:parseInBatches,parse:_parse$2.parse,loaders:a},n,i||null),e.next=17,parseWithLoaderInBatches(s,t,n,i);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e)}))),_parseInBatches$1.apply(this,arguments)}function parseWithLoaderInBatches(e,t,r,n){return _parseWithLoaderInBatches.apply(this,arguments)}function _parseWithLoaderInBatches(){return _parseWithLoaderInBatches=(0,_asyncToGenerator2$a.default)(_regenerator$a.default.mark((function e(t,r,n,i){var a,o,s,l;return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){return(l=(0,_wrapAsyncGenerator2$1.default)(_regenerator$a.default.mark((function e(t){return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o;case 2:return e.delegateYield((0,_asyncGeneratorDelegate2.default)(_asyncIterator$2(t),_awaitAsyncGenerator2$1.default),"t0",3);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},s=function(e){return l.apply(this,arguments)},e.next=4,parseToOutputIterator(t,r,n,i);case 4:if(a=e.sent,n.metadata){e.next=7;break}return e.abrupt("return",a);case 7:return o={batchType:"metadata",metadata:{_loader:t,_context:i},data:[],bytesUsed:0},e.abrupt("return",s(a));case 9:case"end":return e.stop()}}),e)}))),_parseWithLoaderInBatches.apply(this,arguments)}function parseToOutputIterator(e,t,r,n){return _parseToOutputIterator.apply(this,arguments)}function _parseToOutputIterator(){return _parseToOutputIterator=(0,_asyncToGenerator2$a.default)(_regenerator$a.default.mark((function e(t,r,n,i){var a,o,s,l;return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){return(l=(0,_wrapAsyncGenerator2$1.default)(_regenerator$a.default.mark((function e(){var r,a,s;return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_awaitAsyncGenerator2$1.default)((0,_loaderUtils$4.concatenateArrayBuffersAsync)(o));case 2:return r=e.sent,e.next=5,(0,_awaitAsyncGenerator2$1.default)((0,_parse$2.parse)(r,t,_objectSpread$8(_objectSpread$8({},n),{},{mimeType:t.mimeTypes[0]}),i));case 5:return a=e.sent,s={mimeType:t.mimeTypes[0],shape:Array.isArray(a)?"row-table":"unknown",batchType:"data",data:a,length:Array.isArray(a)?a.length:1},e.next=9,s;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)},s=function(){return l.apply(this,arguments)},e.next=4,(0,_getData.getAsyncIterableFromData)(r,n);case 4:return a=e.sent,e.next=7,applyInputTransforms(a,(null==n?void 0:n.transforms)||[]);case 7:if(o=e.sent,!t.parseInBatches){e.next=10;break}return e.abrupt("return",t.parseInBatches(o,n,i));case 10:return e.abrupt("return",s());case 11:case"end":return e.stop()}}),e)}))),_parseToOutputIterator.apply(this,arguments)}function applyInputTransforms(e){return _applyInputTransforms.apply(this,arguments)}function _applyInputTransforms(){return _applyInputTransforms=(0,_asyncToGenerator2$a.default)(_regenerator$a.default.mark((function e(t){var r,n,i,a,o,s,l,u=arguments;return _regenerator$a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>1&&void 0!==u[1]?u[1]:[],n=t,i=!1,a=!1,e.prev=4,s=_asyncIterator$2(r);case 6:return e.next=8,s.next();case 8:if(!(i=!(l=e.sent).done)){e.next=14;break}n=(0,l.value)(n);case 11:i=!1,e.next=6;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),a=!0,o=e.t0;case 20:if(e.prev=20,e.prev=21,!i||null==s.return){e.next=25;break}return e.next=25,s.return();case 25:if(e.prev=25,!a){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(20);case 30:return e.abrupt("return",n);case 31:case"end":return e.stop()}}),e,null,[[4,16,20,30],[21,,25,29]])}))),_applyInputTransforms.apply(this,arguments)}var load$1={},_interopRequireDefault$s=interopRequireDefaultExports;Object.defineProperty(load$1,"__esModule",{value:!0}),load$1.load=load;var _regenerator$9=_interopRequireDefault$s(requireRegenerator()),_asyncToGenerator2$9=_interopRequireDefault$s(requireAsyncToGenerator()),_isType=requireIsType(),_normalizeLoader$1=normalizeLoader$1,_getFetchFunction$1=requireGetFetchFunction(),_parse$1=parse$3;function load(e,t,r,n){return _load.apply(this,arguments)}function _load(){return(_load=(0,_asyncToGenerator2$9.default)(_regenerator$9.default.mark((function e(t,r,n,i){var a,o;return _regenerator$9.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(r)||(0,_normalizeLoader$1.isLoaderObject)(r)||(n=r,r=void 0),a=(0,_getFetchFunction$1.getFetchFunction)(n),o=t,"string"!=typeof t){e.next=7;break}return e.next=6,a(t);case 6:o=e.sent;case 7:if(!(0,_isType.isBlob)(t)){e.next=11;break}return e.next=10,a(t);case 10:o=e.sent;case 11:return e.next=13,(0,_parse$1.parse)(o,r,n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var loadInBatches$1={},_interopRequireDefault$r=interopRequireDefaultExports;Object.defineProperty(loadInBatches$1,"__esModule",{value:!0}),loadInBatches$1.loadInBatches=loadInBatches;var _regenerator$8=_interopRequireDefault$r(requireRegenerator()),_asyncToGenerator2$8=_interopRequireDefault$r(requireAsyncToGenerator()),_normalizeLoader=normalizeLoader$1,_getFetchFunction=requireGetFetchFunction(),_parseInBatches=parseInBatches$1;function loadInBatches(e,t,r,n){Array.isArray(t)||(0,_normalizeLoader.isLoaderObject)(t)||(r=t,t=null);var i=(0,_getFetchFunction.getFetchFunction)(r||{});return Array.isArray(e)?e.map((function(e){return loadOneFileInBatches(e,t,r,i)})):loadOneFileInBatches(e,t,r,i)}function loadOneFileInBatches(e,t,r,n){return _loadOneFileInBatches.apply(this,arguments)}function _loadOneFileInBatches(){return(_loadOneFileInBatches=(0,_asyncToGenerator2$8.default)(_regenerator$8.default.mark((function e(t,r,n,i){var a,o;return _regenerator$8.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}return a=t,e.next=4,i(a);case 4:return o=e.sent,e.next=7,(0,_parseInBatches.parseInBatches)(o,r,n);case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,(0,_parseInBatches.parseInBatches)(t,r,n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var encode$1={},_interopRequireDefault$q=interopRequireDefaultExports;Object.defineProperty(encode$1,"__esModule",{value:!0}),encode$1.encode=encode,encode$1.encodeInBatches=encodeInBatches,encode$1.encodeSync=encodeSync$1,encode$1.encodeText=encodeText,encode$1.encodeURLtoURL=encodeURLtoURL;var _regenerator$7=_interopRequireDefault$q(requireRegenerator()),_defineProperty2$d=_interopRequireDefault$q(requireDefineProperty()),_asyncToGenerator2$7=_interopRequireDefault$q(requireAsyncToGenerator()),_loaderUtils$3=es5$t,_workerUtils=requireEs5$b(),_writeFile$1=writeFile$1,_fetchFile=fetchFile$1,_loaderOptions=loaderOptions;function ownKeys$7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$7(Object(r),!0).forEach((function(t){(0,_defineProperty2$d.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$7(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _asyncIterator$1(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator$1(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator$1(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator$1=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator$1.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator$1(e)}function encode(e,t,r){return _encode$1.apply(this,arguments)}function _encode$1(){return(_encode$1=(0,_asyncToGenerator2$7.default)(_regenerator$7.default.mark((function e(t,r,n){var i,a,o,s,l,u,c,d,h,f,p;return _regenerator$7.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(0,_loaderOptions.getLoaderOptions)(),n=_objectSpread$7(_objectSpread$7({},i),n),!(0,_loaderUtils$3.canEncodeWithWorker)(r,n)){e.next=6;break}return e.next=5,(0,_workerUtils.processOnWorker)(r,t,n);case 5:return e.abrupt("return",e.sent);case 6:if(!r.encode){e.next=10;break}return e.next=9,r.encode(t,n);case 9:return e.abrupt("return",e.sent);case 10:if(!r.encodeSync){e.next=12;break}return e.abrupt("return",r.encodeSync(t,n));case 12:if(!r.encodeText){e.next=18;break}return e.t0=new TextEncoder,e.next=16,r.encodeText(t,n);case 16:return e.t1=e.sent,e.abrupt("return",e.t0.encode.call(e.t0,e.t1));case 18:if(!r.encodeInBatches){e.next=50;break}a=encodeInBatches(t,r,n),o=[],s=!1,l=!1,e.prev=23,c=_asyncIterator$1(a);case 25:return e.next=27,c.next();case 27:if(!(s=!(d=e.sent).done)){e.next=33;break}o.push(d.value);case 30:s=!1,e.next=25;break;case 33:e.next=39;break;case 35:e.prev=35,e.t2=e.catch(23),l=!0,u=e.t2;case 39:if(e.prev=39,e.prev=40,!s||null==c.return){e.next=44;break}return e.next=44,c.return();case 44:if(e.prev=44,!l){e.next=47;break}throw u;case 47:return e.finish(44);case 48:return e.finish(39);case 49:return e.abrupt("return",_loaderUtils$3.concatenateArrayBuffers.apply(void 0,o));case 50:if(_loaderUtils$3.isBrowser||!r.encodeURLtoURL){e.next=62;break}return h=getTemporaryFilename("input"),e.next=54,(0,_writeFile$1.writeFile)(h,t);case 54:return f=getTemporaryFilename("output"),e.next=57,encodeURLtoURL(h,f,r,n);case 57:return p=e.sent,e.next=60,(0,_fetchFile.fetchFile)(p);case 60:return e.abrupt("return",e.sent.arrayBuffer());case 62:throw new Error("Writer could not encode data");case 63:case"end":return e.stop()}}),e,null,[[23,35,39,49],[40,,44,48]])})))).apply(this,arguments)}function encodeSync$1(e,t,r){if(t.encodeSync)return t.encodeSync(e,r);throw new Error("Writer could not synchronously encode data")}function encodeText(e,t,r){return _encodeText.apply(this,arguments)}function _encodeText(){return(_encodeText=(0,_asyncToGenerator2$7.default)(_regenerator$7.default.mark((function e(t,r,n){var i;return _regenerator$7.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.text||!r.encodeText){e.next=4;break}return e.next=3,r.encodeText(t,n);case 3:return e.abrupt("return",e.sent);case 4:if(!r.text||!r.encode&&!r.encodeInBatches){e.next=9;break}return e.next=7,encode(t,r,n);case 7:return i=e.sent,e.abrupt("return",(new TextDecoder).decode(i));case 9:throw new Error("Writer could not encode data as text");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function encodeInBatches(e,t,r){if(t.encodeInBatches){var n=getIterator(e);return t.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}function encodeURLtoURL(e,t,r,n){return _encodeURLtoURL.apply(this,arguments)}function _encodeURLtoURL(){return(_encodeURLtoURL=(0,_asyncToGenerator2$7.default)(_regenerator$7.default.mark((function e(t,r,n,i){return _regenerator$7.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,_loaderUtils$3.resolvePath)(t),r=(0,_loaderUtils$3.resolvePath)(r),!_loaderUtils$3.isBrowser&&n.encodeURLtoURL){e.next=4;break}throw new Error;case 4:return e.next=6,n.encodeURLtoURL(t,r,i);case 6:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function getIterator(e){return[{table:e,start:0,end:e.length}]}function getTemporaryFilename(e){return"/tmp/".concat(e)}var save$1={},_interopRequireDefault$p=interopRequireDefaultExports;Object.defineProperty(save$1,"__esModule",{value:!0}),save$1.save=save,save$1.saveSync=saveSync;var _regenerator$6=_interopRequireDefault$p(requireRegenerator()),_asyncToGenerator2$6=_interopRequireDefault$p(requireAsyncToGenerator()),_encode=encode$1,_writeFile=writeFile$1;function save(e,t,r,n){return _save.apply(this,arguments)}function _save(){return(_save=(0,_asyncToGenerator2$6.default)(_regenerator$6.default.mark((function e(t,r,n,i){var a;return _regenerator$6.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_encode.encode)(t,n,i);case 2:return a=e.sent,e.next=5,(0,_writeFile.writeFile)(r,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function saveSync(e,t,r,n){var i=(0,_encode.encodeSync)(e,r,n);return(0,_writeFile.writeFileSync)(t,i)}var makeDomStream={},_interopRequireDefault$o=interopRequireDefaultExports;Object.defineProperty(makeDomStream,"__esModule",{value:!0}),makeDomStream.makeStream=makeStream;var _regenerator$5=_interopRequireDefault$o(requireRegenerator()),_defineProperty2$c=_interopRequireDefault$o(requireDefineProperty()),_asyncToGenerator2$5=_interopRequireDefault$o(requireAsyncToGenerator());function ownKeys$6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$6(Object(r),!0).forEach((function(t){(0,_defineProperty2$c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$6(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function makeStream(e,t){var r=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e[Symbol.iterator]();return new ReadableStream({type:"bytes",pull:function(e){return(0,_asyncToGenerator2$5.default)(_regenerator$5.default.mark((function t(){var n,i;return _regenerator$5.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.next();case 3:i=(n=t.sent).value,n.done?e.close():e.enqueue(new Uint8Array(i)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},cancel:function(){return(0,_asyncToGenerator2$5.default)(_regenerator$5.default.mark((function e(){var t;return _regenerator$5.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==r||null===(t=r.return)||void 0===t?void 0:t.call(r);case 2:case"end":return e.stop()}}),e)})))()}},_objectSpread$6({highWaterMark:Math.pow(2,24)},t))}var nullLoader={},_interopRequireDefault$n=interopRequireDefaultExports;Object.defineProperty(nullLoader,"__esModule",{value:!0}),nullLoader.NullWorkerLoader=nullLoader.NullLoader=void 0;var _regenerator$4=_interopRequireDefault$n(requireRegenerator()),_asyncToGenerator2$4=_interopRequireDefault$n(requireAsyncToGenerator()),_awaitAsyncGenerator2=_interopRequireDefault$n(requireAwaitAsyncGenerator()),_wrapAsyncGenerator2=_interopRequireDefault$n(requireWrapAsyncGenerator());function _asyncIterator(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return AsyncFromSyncIterator=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}var VERSION$3="3.4.14",NullWorkerLoader={name:"Null loader",id:"null",module:"core",version:VERSION$3,worker:!0,mimeTypes:["application/x.empty"],extensions:["null"],tests:[function(){return!1}],options:{null:{}}};function parseSync(e,t,r){return t.null.echoParameters?{arrayBuffer:e,options:t,context:r=r&&JSON.parse(JSON.stringify(r))}:null}nullLoader.NullWorkerLoader=NullWorkerLoader;var NullLoader={name:"Null loader",id:"null",module:"core",version:VERSION$3,mimeTypes:["application/x.empty"],extensions:["null"],parse:function(){var e=(0,_asyncToGenerator2$4.default)(_regenerator$4.default.mark((function e(t,r,n){return _regenerator$4.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",parseSync(t,r,n));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),parseSync:parseSync,parseInBatches:(_generator=(0,_wrapAsyncGenerator2.default)(_regenerator$4.default.mark((function e(t,r,n){var i,a,o,s,l,u;return _regenerator$4.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=!1,a=!1,e.prev=2,s=_asyncIterator(t);case 4:return e.next=6,(0,_awaitAsyncGenerator2.default)(s.next());case 6:if(!(i=!(l=e.sent).done)){e.next=13;break}return u=l.value,e.next=10,parseSync(u,r,n);case 10:i=!1,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),a=!0,o=e.t0;case 19:if(e.prev=19,e.prev=20,!i||null==s.return){e.next=24;break}return e.next=24,(0,_awaitAsyncGenerator2.default)(s.return());case 24:if(e.prev=24,!a){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(19);case 29:case"end":return e.stop()}}),e,null,[[2,15,19,29],[20,,24,28]])}))),function(e,t,r){return _generator.apply(this,arguments)}),tests:[function(){return!1}],options:{null:{echoParameters:!1}}},_generator;nullLoader.NullLoader=NullLoader;var fetchProgress={},hasRequiredFetchProgress;function requireFetchProgress(){if(hasRequiredFetchProgress)return fetchProgress;hasRequiredFetchProgress=1;var e=interopRequireDefaultExports;Object.defineProperty(fetchProgress,"__esModule",{value:!0}),fetchProgress.default=function(e,t){return n.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator());function n(){return n=(0,r.default)(t.default.mark((function e(n,a){var o,s,l,u,c,d,h=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=h.length>2&&void 0!==h[2]?h[2]:function(){},s=h.length>3&&void 0!==h[3]?h[3]:function(){},e.next=4,n;case 4:if((n=e.sent).ok){e.next=7;break}return e.abrupt("return",n);case 7:if(l=n.body){e.next=10;break}return e.abrupt("return",n);case 10:if(u=n.headers.get("content-length")||0,(c=u?parseInt(u):0)>0){e.next=14;break}return e.abrupt("return",n);case 14:if("undefined"!=typeof ReadableStream&&l.getReader){e.next=16;break}return e.abrupt("return",n);case 16:return d=new ReadableStream({start:function(e){return(0,r.default)(t.default.mark((function r(){var n;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=l.getReader(),t.next=3,i(e,n,0,c,a,o,s);case 3:case"end":return t.stop()}}),r)})))()}}),e.abrupt("return",new Response(d));case 18:case"end":return e.stop()}}),e)}))),n.apply(this,arguments)}function i(e,t,r,n,i,o,s){return a.apply(this,arguments)}function a(){return a=(0,r.default)(t.default.mark((function e(r,n,a,o,s,l,u){var c,d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.read();case 3:if(d=(c=e.sent).value,!c.done){e.next=10;break}return l(),r.close(),e.abrupt("return");case 10:return a+=d.byteLength,h=Math.round(a/o*100),s(h,{loadedBytes:a,totalBytes:o}),r.enqueue(d),e.next=16,i(r,n,a,o,s,l,u);case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),r.error(e.t0),u(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,18]])}))),a.apply(this,arguments)}return fetchProgress}var browserFilesystem={},hasRequiredBrowserFilesystem;function requireBrowserFilesystem(){if(hasRequiredBrowserFilesystem)return browserFilesystem;hasRequiredBrowserFilesystem=1;var e=interopRequireDefaultExports;Object.defineProperty(browserFilesystem,"__esModule",{value:!0}),browserFilesystem.default=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=function(){function e(t,r){(0,n.default)(this,e),(0,a.default)(this,"_fetch",void 0),(0,a.default)(this,"files",{}),(0,a.default)(this,"lowerCaseFiles",{}),(0,a.default)(this,"usedFiles",{}),this._fetch=(null==r?void 0:r.fetch)||fetch;for(var i=0;i<t.length;++i){var o=t[i];this.files[o.name]=o,this.lowerCaseFiles[o.name.toLowerCase()]=o,this.usedFiles[o.name]=!1}this.fetch=this.fetch.bind(this)}var o,s,l,u,c,d,h;return(0,i.default)(e,[{key:"fetch",value:(h=(0,r.default)(t.default.mark((function e(r,n){var i,a,o,s,l,u,c,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.includes("://")){e.next=2;break}return e.abrupt("return",this._fetch(r,n));case 2:if(i=this.files[r]){e.next=5;break}return e.abrupt("return",new Response(r,{status:400,statusText:"NOT FOUND"}));case 5:if(a=new Headers(null==n?void 0:n.headers),o=a.get("Range"),!(s=o&&/bytes=($1)-($2)/.exec(o))){e.next=17;break}return l=parseInt(s[1]),u=parseInt(s[2]),e.next=13,i.slice(l,u).arrayBuffer();case 13:return c=new Response(e.sent),Object.defineProperty(c,"url",{value:r}),e.abrupt("return",c);case 17:return d=new Response(i),Object.defineProperty(d,"url",{value:r}),e.abrupt("return",d);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"readdir",value:(d=(0,r.default)(t.default.mark((function e(r){var n,i;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in n=[],this.files)n.push(i);return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"stat",value:(c=(0,r.default)(t.default.mark((function e(r,n){var i;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.files[r]){e.next=3;break}throw new Error(r);case 3:return e.abrupt("return",{size:i.size});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"unlink",value:(u=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this.files[r],delete this.lowerCaseFiles[r],this.usedFiles[r]=!0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"open",value:(l=(0,r.default)(t.default.mark((function e(r,n,i){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.files[r]);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"read",value:(s=(0,r.default)(t.default.mark((function e(r,n){var i,a,o=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:n.byteLength,a=r,e.next=7,a.slice(0,0+i).arrayBuffer();case 7:return e.abrupt("return",{bytesRead:i,buffer:e.sent});case 9:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"close",value:(o=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"_getFile",value:function(e,t){var r=this.files[e]||this.lowerCaseFiles[e];return r&&t&&(this.usedFiles[e]=!0),r}}]),e}();return browserFilesystem.default=o,browserFilesystem}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"JSONLoader",{enumerable:!0,get:function(){return g.JSONLoader}}),Object.defineProperty(e,"NullLoader",{enumerable:!0,get:function(){return v.NullLoader}}),Object.defineProperty(e,"NullWorkerLoader",{enumerable:!0,get:function(){return v.NullWorkerLoader}}),Object.defineProperty(e,"RequestScheduler",{enumerable:!0,get:function(){return g.RequestScheduler}}),Object.defineProperty(e,"_BrowserFileSystem",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(e,"_fetchProgress",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(e,"_unregisterLoaders",{enumerable:!0,get:function(){return s._unregisterLoaders}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return g.assert}}),Object.defineProperty(e,"concatenateArrayBuffersAsync",{enumerable:!0,get:function(){return g.concatenateArrayBuffersAsync}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return g.document}}),Object.defineProperty(e,"encode",{enumerable:!0,get:function(){return p.encode}}),Object.defineProperty(e,"encodeInBatches",{enumerable:!0,get:function(){return p.encodeInBatches}}),Object.defineProperty(e,"encodeSync",{enumerable:!0,get:function(){return p.encodeSync}}),Object.defineProperty(e,"encodeText",{enumerable:!0,get:function(){return p.encodeText}}),Object.defineProperty(e,"encodeURLtoURL",{enumerable:!0,get:function(){return p.encodeURLtoURL}}),Object.defineProperty(e,"fetchFile",{enumerable:!0,get:function(){return r.fetchFile}}),Object.defineProperty(e,"forEach",{enumerable:!0,get:function(){return g.forEach}}),Object.defineProperty(e,"getLoaderOptions",{enumerable:!0,get:function(){return o.getLoaderOptions}}),Object.defineProperty(e,"getPathPrefix",{enumerable:!0,get:function(){return g.getPathPrefix}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return g.global}}),Object.defineProperty(e,"isAsyncIterable",{enumerable:!0,get:function(){return T.isAsyncIterable}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return g.isBrowser}}),Object.defineProperty(e,"isIterable",{enumerable:!0,get:function(){return T.isIterable}}),Object.defineProperty(e,"isIterator",{enumerable:!0,get:function(){return T.isIterator}}),Object.defineProperty(e,"isPromise",{enumerable:!0,get:function(){return T.isPromise}}),Object.defineProperty(e,"isPureObject",{enumerable:!0,get:function(){return T.isPureObject}}),Object.defineProperty(e,"isReadableStream",{enumerable:!0,get:function(){return T.isReadableStream}}),Object.defineProperty(e,"isResponse",{enumerable:!0,get:function(){return T.isResponse}}),Object.defineProperty(e,"isWorker",{enumerable:!0,get:function(){return g.isWorker}}),Object.defineProperty(e,"isWritableStream",{enumerable:!0,get:function(){return T.isWritableStream}}),Object.defineProperty(e,"load",{enumerable:!0,get:function(){return h.load}}),Object.defineProperty(e,"loadInBatches",{enumerable:!0,get:function(){return f.loadInBatches}}),Object.defineProperty(e,"makeIterator",{enumerable:!0,get:function(){return _.makeIterator}}),Object.defineProperty(e,"makeLineIterator",{enumerable:!0,get:function(){return g.makeLineIterator}}),Object.defineProperty(e,"makeNumberedLineIterator",{enumerable:!0,get:function(){return g.makeNumberedLineIterator}}),Object.defineProperty(e,"makeStream",{enumerable:!0,get:function(){return y.makeStream}}),Object.defineProperty(e,"makeTextDecoderIterator",{enumerable:!0,get:function(){return g.makeTextDecoderIterator}}),Object.defineProperty(e,"makeTextEncoderIterator",{enumerable:!0,get:function(){return g.makeTextEncoderIterator}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return u.parse}}),Object.defineProperty(e,"parseInBatches",{enumerable:!0,get:function(){return d.parseInBatches}}),Object.defineProperty(e,"parseSync",{enumerable:!0,get:function(){return c.parseSync}}),Object.defineProperty(e,"readArrayBuffer",{enumerable:!0,get:function(){return n.readArrayBuffer}}),Object.defineProperty(e,"readFileSync",{enumerable:!0,get:function(){return i.readFileSync}}),Object.defineProperty(e,"registerLoaders",{enumerable:!0,get:function(){return s.registerLoaders}}),Object.defineProperty(e,"resolvePath",{enumerable:!0,get:function(){return g.resolvePath}}),Object.defineProperty(e,"save",{enumerable:!0,get:function(){return m.save}}),Object.defineProperty(e,"saveSync",{enumerable:!0,get:function(){return m.saveSync}}),Object.defineProperty(e,"selectLoader",{enumerable:!0,get:function(){return l.selectLoader}}),Object.defineProperty(e,"selectLoaderSync",{enumerable:!0,get:function(){return l.selectLoaderSync}}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return g.self}}),Object.defineProperty(e,"setLoaderOptions",{enumerable:!0,get:function(){return o.setLoaderOptions}}),Object.defineProperty(e,"setPathPrefix",{enumerable:!0,get:function(){return g.setPathPrefix}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return g.window}}),Object.defineProperty(e,"writeFile",{enumerable:!0,get:function(){return a.writeFile}}),Object.defineProperty(e,"writeFileSync",{enumerable:!0,get:function(){return a.writeFileSync}});var r=fetchFile$1,n=readArrayBuffer$1,i=readFile,a=writeFile$1,o=loaderOptions,s=registerLoaders$1,l=selectLoader$1,u=parse$3,c=parseSync$2,d=parseInBatches$1,h=load$1,f=loadInBatches$1,p=encode$1,m=save$1,g=es5$t,_=makeIterator$1,y=makeDomStream,v=nullLoader,b=t(requireFetchProgress()),x=t(requireBrowserFilesystem()),T=requireIsType()}(es5$n);var constants$6={};Object.defineProperty(constants$6,"__esModule",{value:!0}),constants$6.TILE_TYPE=constants$6.TILE_REFINEMENT=constants$6.TILE_CONTENT_STATE=constants$6.TILESET_TYPE=constants$6.TILE3D_OPTIMIZATION_HINT=constants$6.LOD_METRIC_TYPE=void 0;var TILE_CONTENT_STATE={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};constants$6.TILE_CONTENT_STATE=TILE_CONTENT_STATE;var TILE_REFINEMENT={ADD:1,REPLACE:2};constants$6.TILE_REFINEMENT=TILE_REFINEMENT;var TILE_TYPE={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"};constants$6.TILE_TYPE=TILE_TYPE;var TILESET_TYPE={I3S:"I3S",TILES3D:"TILES3D"};constants$6.TILESET_TYPE=TILESET_TYPE;var LOD_METRIC_TYPE={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"};constants$6.LOD_METRIC_TYPE=LOD_METRIC_TYPE;var TILE3D_OPTIMIZATION_HINT={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};constants$6.TILE3D_OPTIMIZATION_HINT=TILE3D_OPTIMIZATION_HINT;var boundingVolume={},_interopRequireDefault$m=interopRequireDefaultExports;Object.defineProperty(boundingVolume,"__esModule",{value:!0}),boundingVolume.createBoundingVolume=createBoundingVolume,boundingVolume.getCartographicBounds=getCartographicBounds;var _toConsumableArray2$2=_interopRequireDefault$m(requireToConsumableArray()),_slicedToArray2$4=_interopRequireDefault$m(requireSlicedToArray()),_core$5=es5$q,_culling$1=requireEs5$a(),_geospatial$2=es5$p,_loaderUtils$2=es5$t;function defined$3(e){return null!=e}var scratchPoint=new _core$5.Vector3,scratchScale=new _core$5.Vector3,scratchNorthWest=new _core$5.Vector3,scratchSouthEast=new _core$5.Vector3;function createBoundingVolume(e,t,r){if((0,_loaderUtils$2.assert)(e,"3D Tile: boundingVolume must be defined"),e.box)return createBox(e.box,t,r);if(e.region){var n=(0,_slicedToArray2$4.default)(e.region,6),i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=_geospatial$2.Ellipsoid.WGS84.cartographicToCartesian([(0,_core$5.degrees)(n[0]),(0,_core$5.degrees)(o),s],scratchNorthWest),c=_geospatial$2.Ellipsoid.WGS84.cartographicToCartesian([(0,_core$5.degrees)(a),(0,_core$5.degrees)(i),l],scratchSouthEast),d=(new _core$5.Vector3).addVectors(u,c).multiplyScalar(.5),h=(new _core$5.Vector3).subVectors(u,c).len()/2;return createSphere([d[0],d[1],d[2],h],new _core$5.Matrix4)}if(e.sphere)return createSphere(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function getCartographicBounds(e,t){if(e.box)return orientedBoundingBoxToCartographicBounds(t);if(e.region){var r=(0,_slicedToArray2$4.default)(e.region,6),n=r[1],i=r[2],a=r[3],o=r[4],s=r[5];return[[(0,_core$5.degrees)(r[0]),(0,_core$5.degrees)(n),o],[(0,_core$5.degrees)(i),(0,_core$5.degrees)(a),s]]}if(e.sphere)return boundingSphereToCartographicBounds(t);throw new Error("Unkown boundingVolume type")}function createBox(e,t,r){var n=new _core$5.Vector3(e[0],e[1],e[2]);t.transform(n,n);var i=[];if(10===e.length){var a=e.slice(3,6),o=new _core$5.Quaternion;o.fromArray(e,6);var s=new _core$5.Vector3([1,0,0]),l=new _core$5.Vector3([0,1,0]),u=new _core$5.Vector3([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),l.transformByQuaternion(o),l.scale(a[1]),u.transformByQuaternion(o),u.scale(a[2]),i=[].concat((0,_toConsumableArray2$2.default)(s.toArray()),(0,_toConsumableArray2$2.default)(l.toArray()),(0,_toConsumableArray2$2.default)(u.toArray()))}else i=[].concat((0,_toConsumableArray2$2.default)(e.slice(3,6)),(0,_toConsumableArray2$2.default)(e.slice(6,9)),(0,_toConsumableArray2$2.default)(e.slice(9,12)));var c=t.transformAsVector(i.slice(0,3)),d=t.transformAsVector(i.slice(3,6)),h=t.transformAsVector(i.slice(6,9)),f=new _core$5.Matrix3([c[0],c[1],c[2],d[0],d[1],d[2],h[0],h[1],h[2]]);return defined$3(r)?(r.center=n,r.halfAxes=f,r):new _culling$1.OrientedBoundingBox(n,f)}function createSphere(e,t,r){var n=new _core$5.Vector3(e[0],e[1],e[2]);t.transform(n,n);var i=t.getScale(scratchScale),a=Math.max(Math.max(i[0],i[1]),i[2]),o=e[3]*a;return defined$3(r)?(r.center=n,r.radius=o,r):new _culling$1.BoundingSphere(n,o)}function orientedBoundingBoxToCartographicBounds(e){for(var t=emptyCartographicBounds(),r=e.halfAxes,n=new _core$5.Vector3(r.getColumn(0)),i=new _core$5.Vector3(r.getColumn(1)),a=new _core$5.Vector3(r.getColumn(2)),o=0;o<2;o++){for(var s=0;s<2;s++){for(var l=0;l<2;l++)scratchPoint.copy(e.center),scratchPoint.add(n),scratchPoint.add(i),scratchPoint.add(a),addToCartographicBounds(t,scratchPoint),a.negate();i.negate()}n.negate()}return t}function boundingSphereToCartographicBounds(e){var t,r=emptyCartographicBounds(),n=e.center,i=e.radius,a=_geospatial$2.Ellipsoid.WGS84.scaleToGeodeticSurface(n,scratchPoint);t=a?_geospatial$2.Ellipsoid.WGS84.geodeticSurfaceNormal(a):new _core$5.Vector3(0,0,1);var o=new _core$5.Vector3(t[2],-t[1],0);o.len()>0?o.normalize():o=new _core$5.Vector3(0,1,0);for(var s=o.clone().cross(t),l=0,u=[o,s,t];l<u.length;l++){scratchScale.copy(u[l]).scale(i);for(var c=0;c<2;c++)scratchPoint.copy(n),scratchPoint.add(scratchScale),addToCartographicBounds(r,scratchPoint),scratchScale.negate()}return r}function emptyCartographicBounds(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function addToCartographicBounds(e,t){_geospatial$2.Ellipsoid.WGS84.cartesianToCartographic(t,scratchPoint),e[0][0]=Math.min(e[0][0],scratchPoint[0]),e[0][1]=Math.min(e[0][1],scratchPoint[1]),e[0][2]=Math.min(e[0][2],scratchPoint[2]),e[1][0]=Math.max(e[1][0],scratchPoint[0]),e[1][1]=Math.max(e[1][1],scratchPoint[1]),e[1][2]=Math.max(e[1][2],scratchPoint[2])}var tiles3dLod={},hasRequiredTiles3dLod;function requireTiles3dLod(){if(hasRequiredTiles3dLod)return tiles3dLod;hasRequiredTiles3dLod=1,Object.defineProperty(tiles3dLod,"__esModule",{value:!0}),tiles3dLod.calculateDynamicScreenSpaceError=function(s,l){var u,c,d,h,f,p=l.camera,m=l.mapProjection,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},_=g.dynamicScreenSpaceErrorHeightFalloff,y=void 0===_?.25:_,v=g.dynamicScreenSpaceErrorDensity,b=void 0===v?.00278:v,x=s.contentBoundingVolume;if(x instanceof TileBoundingRegion)u=Cartesian3.normalize(p.positionWC,t),c=p.directionWC,d=p.positionCartographic.height,h=x.minimumHeight,f=x.maximumHeight;else{var T=e.Matrix4.inverseTransformation(s.computedTransform,n),w=m.ellipsoid,E=x.boundingVolume,A=e.Matrix4.multiplyByPoint(T,E.center,i);if(Cartesian3.magnitude(A)>w.minimumRadius){var S=Cartographic.fromCartesian(A,w,r);u=Cartesian3.normalize(p.positionWC,t),c=p.directionWC,d=p.positionCartographic.height,h=0,f=2*S.height}else{var P=e.Matrix4.multiplyByPoint(T,p.positionWC,a);if(u=Cartesian3.UNIT_Z,c=e.Matrix4.multiplyByPointAsVector(T,p.directionWC,o),c=Cartesian3.normalize(c,c),d=P.z,x instanceof TileOrientedBoundingBox){var M=s._header.boundingVolume.box[11];h=A.z-M,f=A.z+M}else if(x instanceof TileBoundingSphere){var R=E.radius;h=A.z-R,f=A.z+R}}}var C=h+(f-h)*y,O=(0,e.clamp)((d-C)/(f-C),0,1);return b*((1-Math.abs(Cartesian3.dot(c,u)))*(1-O))},tiles3dLod.fog=s,tiles3dLod.getDynamicScreenSpaceError=l,tiles3dLod.getTiles3DScreenSpaceError=function(e,t,r){var n=e.tileset,i=r&&e.parent&&e.parent.lodMetricValue||e.lodMetricValue;if(0===i)return 0;var a=Math.max(e._distanceToCamera,1e-7);return i*t.height*(n.options.viewDistanceScale||1)/(a*t.sseDenominator)-l(n,a)};var e=es5$q,t=new e.Vector3,r=new e.Vector3,n=new e.Matrix4,i=new e.Vector3,a=new e.Vector3,o=new e.Vector3;function s(e,t){var r=e*t;return 1-Math.exp(-r*r)}function l(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){var r=e.dynamicScreenSpaceErrorFactor;return s(t,e.dynamicScreenSpaceErrorComputedDensity)*r}return 0}return tiles3dLod}var i3sLod={},_interopRequireDefault$l=interopRequireDefaultExports;Object.defineProperty(i3sLod,"__esModule",{value:!0}),i3sLod.getLodStatus=getLodStatus,i3sLod.getProjectedRadius=getProjectedRadius;var _toConsumableArray2$1=_interopRequireDefault$l(requireToConsumableArray()),_core$4=es5$q,_geospatial$1=es5$p,cameraPositionCartesian=new _core$4.Vector3,toEye=new _core$4.Vector3,cameraPositionEnu=new _core$4.Vector3,extraVertexEnu=new _core$4.Vector3,projectedOriginVector=new _core$4.Vector3,enuToCartesianMatrix=new _core$4.Matrix4,cartesianToEnuMatrix=new _core$4.Matrix4;function getLodStatus(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";var r=2*getProjectedRadius(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function getProjectedRadius(e,t){var r=t.topDownViewport,n=e.header.mbs[1],i=e.header.mbs[0],a=e.header.mbs[2],o=e.header.mbs[3],s=(0,_toConsumableArray2$1.default)(e.boundingVolume.center),l=r.unprojectPosition(r.cameraPosition);_geospatial$1.Ellipsoid.WGS84.cartographicToCartesian(l,cameraPositionCartesian),toEye.copy(cameraPositionCartesian).subtract(s).normalize(),_geospatial$1.Ellipsoid.WGS84.eastNorthUpToFixedFrame(s,enuToCartesianMatrix),cartesianToEnuMatrix.copy(enuToCartesianMatrix).invert(),cameraPositionEnu.copy(cameraPositionCartesian).transform(cartesianToEnuMatrix);var u=Math.sqrt(cameraPositionEnu[0]*cameraPositionEnu[0]+cameraPositionEnu[1]*cameraPositionEnu[1]);extraVertexEnu.copy([cameraPositionEnu[0],cameraPositionEnu[1],u*u/cameraPositionEnu[2]]);var c=extraVertexEnu.transform(enuToCartesianMatrix).subtract(s).normalize(),d=toEye.cross(c).normalize().scale(o).add(s),h=_geospatial$1.Ellipsoid.WGS84.cartesianToCartographic(d),f=r.project([i,n,a]),p=r.project(h);return projectedOriginVector.copy(f).subtract(p).magnitude()}var _3dTilesOptions={},hasRequired_3dTilesOptions;function require_3dTilesOptions(){return hasRequired_3dTilesOptions||(hasRequired_3dTilesOptions=1,Object.defineProperty(_3dTilesOptions,"__esModule",{value:!0}),_3dTilesOptions.get3dTilesOptions=function(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}),_3dTilesOptions}var tilesetTraverser={},managedArray={},hasRequiredManagedArray;function requireManagedArray(){if(hasRequiredManagedArray)return managedArray;hasRequiredManagedArray=1;var e=interopRequireDefaultExports;Object.defineProperty(managedArray,"__esModule",{value:!0}),managedArray.ManagedArray=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$t,a=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,t.default)(this,e),(0,n.default)(this,"_map",new Map),(0,n.default)(this,"_array",void 0),(0,n.default)(this,"_length",void 0),this._array=new Array(r),this._length=r}return(0,r.default)(e,[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}},{key:"get",value:function(e){return(0,i.assert)(e<this._array.length),this._array[e]}},{key:"set",value:function(e,t){(0,i.assert)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}},{key:"delete",value:function(e){var t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var t=this.length++;this._array[t]=e,this._map.set(e,t)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){(0,i.assert)(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){(0,i.assert)(e>=0),this.length=e}},{key:"trim",value:function(e){null==e&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}}]),e}();return managedArray.ManagedArray=a,managedArray}var _interopRequireDefault$k=interopRequireDefaultExports;Object.defineProperty(tilesetTraverser,"__esModule",{value:!0}),tilesetTraverser.TilesetTraverser=tilesetTraverser.DEFAULT_PROPS=void 0;var _classCallCheck2$4=_interopRequireDefault$k(requireClassCallCheck()),_createClass2$4=_interopRequireDefault$k(requireCreateClass()),_defineProperty2$b=_interopRequireDefault$k(requireDefineProperty()),_managedArray=requireManagedArray(),_constants$4=constants$6;function _createForOfIteratorHelper$4(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$4(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys$5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$5(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$5(Object(r),!0).forEach((function(t){(0,_defineProperty2$b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$5(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var DEFAULT_PROPS$1={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""};tilesetTraverser.DEFAULT_PROPS=DEFAULT_PROPS$1;var TilesetTraverser=function(){function e(t){(0,_classCallCheck2$4.default)(this,e),(0,_defineProperty2$b.default)(this,"options",void 0),(0,_defineProperty2$b.default)(this,"root",null),(0,_defineProperty2$b.default)(this,"selectedTiles",{}),(0,_defineProperty2$b.default)(this,"requestedTiles",{}),(0,_defineProperty2$b.default)(this,"emptyTiles",{}),(0,_defineProperty2$b.default)(this,"lastUpdate",(new Date).getTime()),(0,_defineProperty2$b.default)(this,"updateDebounceTime",1e3),(0,_defineProperty2$b.default)(this,"_traversalStack",new _managedArray.ManagedArray),(0,_defineProperty2$b.default)(this,"_emptyTraversalStack",new _managedArray.ManagedArray),(0,_defineProperty2$b.default)(this,"_frameNumber",null),this.options=_objectSpread$5(_objectSpread$5({},DEFAULT_PROPS$1),t)}return(0,_createClass2$4.default)(e,[{key:"traversalFinished",value:function(e){return!0}},{key:"traverse",value:function(e,t,r){this.root=e,this.options=_objectSpread$5(_objectSpread$5({},this.options),r),this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,t){var r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,t)&&(this.updateChildTiles(n,t),i=this.updateAndPushChildren(n,t,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));var a=n.parent,o=Boolean(!a||a._shouldRefine),s=!i;n.hasRenderContent?n.refine===_constants$4.TILE_REFINEMENT.ADD?(this.loadTile(n,t),this.selectTile(n,t)):n.refine===_constants$4.TILE_REFINEMENT.REPLACE&&(this.loadTile(n,t),s&&this.selectTile(n,t)):(this.emptyTiles[n.id]=n,this.loadTile(n,t),s&&this.selectTile(n,t)),this.touchTile(n,t),n._shouldRefine=i&&o}var l=(new Date).getTime();(this.traversalFinished(t)||l-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=l,this.options.onTraversalEnd(t))}},{key:"updateChildTiles",value:function(e,t){var r,n=_createForOfIteratorHelper$4(e.children);try{for(n.s();!(r=n.n()).done;)this.updateTile(r.value,t)}catch(e){n.e(e)}finally{n.f()}}},{key:"updateAndPushChildren",value:function(e,t,r,n){var i=this.options,a=i.loadSiblings,o=i.skipLevelOfDetail,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));var l,u=e.refine===_constants$4.TILE_REFINEMENT.REPLACE&&e.hasRenderContent&&!o,c=!1,d=!0,h=_createForOfIteratorHelper$4(s);try{for(h.s();!(l=h.n()).done;){var f,p=l.value;if(p._selectionDepth=n,p.isVisibleAndInRequestVolume?(r.find(p)&&r.delete(p),r.push(p),c=!0):(u||a)&&(this.loadTile(p,t),this.touchTile(p,t)),u)if(f=!!p._inRequestVolume&&(p.hasRenderContent?p.contentAvailable:this.executeEmptyTraversal(p,t)),!(d=d&&f))return!1}}catch(e){h.e(e)}finally{h.f()}return c||(d=!1),d}},{key:"updateTile",value:function(e,t){this.updateTileVisibility(e,t)}},{key:"selectTile",value:function(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}},{key:"canTraverse",value:function(e,t){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]))}},{key:"shouldLoadTile",value:function(e){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,t){var r=e._screenSpaceError;return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(r=e.getScreenSpaceError(t,!0)),r>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,t){var r=[];if(this.options.viewportTraversersMap)for(var n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n);else r.push(t.viewport.id);e.updateVisibility(t,r)}},{key:"compareDistanceToCamera",value:function(e,t){return e._distanceToCamera-t._distanceToCamera}},{key:"anyChildrenVisible",value:function(e,t){var r,n=!1,i=_createForOfIteratorHelper$4(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.updateVisibility(t),n=n||a.isVisibleAndInRequestVolume}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"executeEmptyTraversal",value:function(e,t){var r=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){var i=n.pop();if(this.updateTile(i,t),i.isVisibleAndInRequestVolume||this.loadTile(i,t),this.touchTile(i,t),!i.hasRenderContent&&this.canTraverse(i,t,!1,!0)){var a,o=_createForOfIteratorHelper$4(i.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;n.find(s)&&n.delete(s),n.push(s)}}catch(e){o.e(e)}finally{o.f()}}else i.contentAvailable||i.hasEmptyContent||(r=!1)}return r}}]),e}();tilesetTraverser.TilesetTraverser=TilesetTraverser;var _interopRequireDefault$j=interopRequireDefaultExports;Object.defineProperty(tile3d,"__esModule",{value:!0}),tile3d.Tile3D=void 0;var _regenerator$3=_interopRequireDefault$j(requireRegenerator()),_asyncToGenerator2$3=_interopRequireDefault$j(requireAsyncToGenerator()),_classCallCheck2$3=_interopRequireDefault$j(requireClassCallCheck()),_createClass2$3=_interopRequireDefault$j(requireCreateClass()),_defineProperty2$a=_interopRequireDefault$j(requireDefineProperty()),_core$3=es5$q,_culling=requireEs5$a(),_core2=es5$n,_constants$3=constants$6,_boundingVolume=boundingVolume,_tiles3dLod=requireTiles3dLod(),_i3sLod=i3sLod,_dTilesOptions=require_3dTilesOptions(),_tilesetTraverser$1=tilesetTraverser;function ownKeys$4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(Object(r),!0).forEach((function(t){(0,_defineProperty2$a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$4(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var scratchVector=new _core$3.Vector3;function defined$2(e){return null!=e}var Tile3D=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";(0,_classCallCheck2$3.default)(this,e),(0,_defineProperty2$a.default)(this,"tileset",void 0),(0,_defineProperty2$a.default)(this,"header",void 0),(0,_defineProperty2$a.default)(this,"id",void 0),(0,_defineProperty2$a.default)(this,"url",void 0),(0,_defineProperty2$a.default)(this,"parent",void 0),(0,_defineProperty2$a.default)(this,"refine",void 0),(0,_defineProperty2$a.default)(this,"type",void 0),(0,_defineProperty2$a.default)(this,"contentUrl",void 0),(0,_defineProperty2$a.default)(this,"lodMetricType","geometricError"),(0,_defineProperty2$a.default)(this,"lodMetricValue",0),(0,_defineProperty2$a.default)(this,"boundingVolume",null),(0,_defineProperty2$a.default)(this,"content",null),(0,_defineProperty2$a.default)(this,"contentState",_constants$3.TILE_CONTENT_STATE.UNLOADED),(0,_defineProperty2$a.default)(this,"gpuMemoryUsageInBytes",0),(0,_defineProperty2$a.default)(this,"children",[]),(0,_defineProperty2$a.default)(this,"depth",0),(0,_defineProperty2$a.default)(this,"viewportIds",[]),(0,_defineProperty2$a.default)(this,"transform",new _core$3.Matrix4),(0,_defineProperty2$a.default)(this,"extensions",null),(0,_defineProperty2$a.default)(this,"implicitTiling",null),(0,_defineProperty2$a.default)(this,"userData",{}),(0,_defineProperty2$a.default)(this,"computedTransform",void 0),(0,_defineProperty2$a.default)(this,"hasEmptyContent",!1),(0,_defineProperty2$a.default)(this,"hasTilesetContent",!1),(0,_defineProperty2$a.default)(this,"traverser",new _tilesetTraverser$1.TilesetTraverser({})),(0,_defineProperty2$a.default)(this,"_cacheNode",null),(0,_defineProperty2$a.default)(this,"_frameNumber",null),(0,_defineProperty2$a.default)(this,"_expireDate",null),(0,_defineProperty2$a.default)(this,"_expiredContent",null),(0,_defineProperty2$a.default)(this,"_boundingBox",void 0),(0,_defineProperty2$a.default)(this,"_distanceToCamera",0),(0,_defineProperty2$a.default)(this,"_screenSpaceError",0),(0,_defineProperty2$a.default)(this,"_visibilityPlaneMask",void 0),(0,_defineProperty2$a.default)(this,"_visible",void 0),(0,_defineProperty2$a.default)(this,"_contentBoundingVolume",void 0),(0,_defineProperty2$a.default)(this,"_viewerRequestVolume",void 0),(0,_defineProperty2$a.default)(this,"_initialTransform",new _core$3.Matrix4),(0,_defineProperty2$a.default)(this,"_priority",0),(0,_defineProperty2$a.default)(this,"_selectedFrame",0),(0,_defineProperty2$a.default)(this,"_requestedFrame",0),(0,_defineProperty2$a.default)(this,"_selectionDepth",0),(0,_defineProperty2$a.default)(this,"_touchedFrame",0),(0,_defineProperty2$a.default)(this,"_centerZDepth",0),(0,_defineProperty2$a.default)(this,"_shouldRefine",!1),(0,_defineProperty2$a.default)(this,"_stackLength",0),(0,_defineProperty2$a.default)(this,"_visitedFrame",0),(0,_defineProperty2$a.default)(this,"_inRequestVolume",!1),(0,_defineProperty2$a.default)(this,"_lodJudge",null),this.header=r,this.tileset=t,this.id=i||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}var t;return(0,_createClass2$3.default)(e,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===_constants$3.TILE_CONTENT_STATE.READY||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===_constants$3.TILE_CONTENT_STATE.UNLOADED}},{key:"contentExpired",get:function(){return this.contentState===_constants$3.TILE_CONTENT_STATE.EXPIRED}},{key:"contentFailed",get:function(){return this.contentState===_constants$3.TILE_CONTENT_STATE.FAILED}},{key:"distanceToCamera",get:function(){return this._distanceToCamera}},{key:"screenSpaceError",get:function(){return this._screenSpaceError}},{key:"boundingBox",get:function(){return this._boundingBox||(this._boundingBox=(0,_boundingVolume.getCartographicBounds)(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}},{key:"getScreenSpaceError",value:function(e,t){switch(this.tileset.type){case _constants$3.TILESET_TYPE.I3S:return(0,_i3sLod.getProjectedRadius)(this,e);case _constants$3.TILESET_TYPE.TILES3D:return(0,_tiles3dLod.getTiles3DScreenSpaceError)(this,e,t);default:throw new Error("Unsupported tileset type")}}},{key:"unselect",value:function(){this._selectedFrame=0}},{key:"_getGpuMemoryUsageInBytes",value:function(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}},{key:"_getPriority",value:function(){var e=this.tileset._traverser,t=this.refine===_constants$3.TILE_REFINEMENT.ADD||e.options.skipLevelOfDetail;if(t&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===_constants$3.TILE_CONTENT_STATE.UNLOADED)return-1;var r=this.parent;return Math.max((e.root?e.root._screenSpaceError:0)-(!r||t&&0!==this._screenSpaceError&&!r.hasTilesetContent?this._screenSpaceError:r._screenSpaceError),0)}},{key:"loadContent",value:(t=(0,_asyncToGenerator2$3.default)(_regenerator$3.default.mark((function e(){var t,r,n,i;return _regenerator$3.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasEmptyContent){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.content){e.next=4;break}return e.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=_constants$3.TILE_CONTENT_STATE.LOADING,e.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(t=e.sent){e.next=13;break}return this.contentState=_constants$3.TILE_CONTENT_STATE.UNLOADED,e.abrupt("return",!1);case 13:return e.prev=13,r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,i=_objectSpread$4(_objectSpread$4({},this.tileset.loadOptions),{},(0,_defineProperty2$a.default)({},n.id,_objectSpread$4(_objectSpread$4({},this.tileset.loadOptions[n.id]),{},{isTileset:"json"===this.type},this._getLoaderSpecificOptions(n.id)))),e.next=19,(0,_core2.load)(r,n,i);case 19:if(this.content=e.sent,!this.tileset.options.contentLoader){e.next=23;break}return e.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=_constants$3.TILE_CONTENT_STATE.READY,this._onContentLoaded(),e.abrupt("return",!0);case 29:throw e.prev=29,e.t0=e.catch(13),this.contentState=_constants$3.TILE_CONTENT_STATE.FAILED,e.t0;case 33:return e.prev=33,t.done(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[13,29,33,36]])}))),function(){return t.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=_constants$3.TILE_CONTENT_STATE.UNLOADED,!0}},{key:"updateVisibility",value:function(e,t){if(this._frameNumber!==e.frameNumber){var r=this.parent,n=r?r._visibilityPlaneMask:_culling.CullingVolume.MASK_INDETERMINATE;this.tileset._traverser.options.updateTransforms&&this._updateTransform(r?r.computedTransform:this.tileset.modelMatrix),this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==_culling.CullingVolume.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}}},{key:"visibility",value:function(e,t){return e.cullingVolume.computeVisibilityWithPlaneMask(this.boundingVolume,t)}},{key:"contentVisibility",value:function(){return!0}},{key:"distanceToTile",value:function(e){return Math.sqrt(Math.max(this.boundingVolume.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var t=e.camera;return scratchVector.subVectors(this.boundingVolume.center,t.position),t.direction.dot(scratchVector)}},{key:"insideViewerRequestVolume",value:function(e){var t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}},{key:"updateExpiration",value:function(){if(defined$2(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=_constants$3.TILE_CONTENT_STATE.EXPIRED,this._expiredContent=this.content)}}},{key:"extras",get:function(){return this.header.extras}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new _core$3.Matrix4(e.transform):new _core$3.Matrix4;var t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new _core$3.Matrix4(n).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new _core$3.Matrix4;this._initialTransform=new _core$3.Matrix4(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=_constants$3.TILE_CONTENT_STATE.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=_culling.CullingVolume.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||_constants$3.TILE_REFINEMENT.REPLACE}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=(0,_boundingVolume.createBoundingVolume)(e.boundingVolume,this.computedTransform,this.boundingVolume);var t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=(0,_boundingVolume.createBoundingVolume)(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=(0,_boundingVolume.createBoundingVolume)(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _core$3.Matrix4).clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}},{key:"_getLoaderSpecificOptions",value:function(e){return"i3s"===e?_objectSpread$4(_objectSpread$4({},this.tileset.options.i3s),{},{_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}):(0,_dTilesOptions.get3dTilesOptions)(this.tileset.tileset)}}]),e}();tile3d.Tile3D=Tile3D;var tileset3dTraverser={},get={exports:{}},superPropBase={exports:{}},hasRequiredSuperPropBase,hasRequiredGet,hasRequiredTileset3dTraverser;function requireSuperPropBase(){return hasRequiredSuperPropBase||(hasRequiredSuperPropBase=1,function(e){var t=requireGetPrototypeOf();e.exports=function(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&null!==(e=t(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports}(superPropBase)),superPropBase.exports}function requireGet(){return hasRequiredGet||(hasRequiredGet=1,function(e){var t=requireSuperPropBase();function r(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=r=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=r=function(e,r,n){var i=t(e,r);if(i){var a=Object.getOwnPropertyDescriptor(i,r);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),r.apply(this,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(get)),get.exports}function requireTileset3dTraverser(){if(hasRequiredTileset3dTraverser)return tileset3dTraverser;hasRequiredTileset3dTraverser=1;var e=interopRequireDefaultExports;Object.defineProperty(tileset3dTraverser,"__esModule",{value:!0}),tileset3dTraverser.Tileset3DTraverser=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=constants$6,l=function(e){(0,i.default)(d,e);var l,u,c=(l=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(l);if(u){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"compareDistanceToCamera",value:function(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}},{key:"updateTileVisibility",value:function(e,t){if((0,n.default)((0,o.default)(d.prototype),"updateTileVisibility",this).call(this,e,t),e.isVisibleAndInRequestVolume){var r=e.children.length>0;if(e.hasTilesetContent&&r){var i=e.children[0];return this.updateTileVisibility(i,t),void(e._visible=i._visible)}(this.meetsScreenSpaceErrorEarly(e,t)||e.refine===s.TILE_REFINEMENT.REPLACE&&e._optimChildrenWithinParent===s.TILE3D_OPTIMIZATION_HINT.USE_OPTIMIZATION&&r&&!this.anyChildrenVisible(e,t))&&(e._visible=!1)}}},{key:"meetsScreenSpaceErrorEarly",value:function(e,t){var r=e.parent;return!(!r||r.hasTilesetContent||r.refine!==s.TILE_REFINEMENT.ADD||this.shouldRefine(e,t,!0))}}]),d}(tilesetTraverser.TilesetTraverser);return tileset3dTraverser.Tileset3DTraverser=l,tileset3dTraverser}var i3sTilesetTraverser={},i3sTileManager={},i3sPendingTilesRegister={},hasRequiredI3sPendingTilesRegister,hasRequiredI3sTileManager,hasRequiredI3sTilesetTraverser;function requireI3sPendingTilesRegister(){if(hasRequiredI3sPendingTilesRegister)return i3sPendingTilesRegister;hasRequiredI3sPendingTilesRegister=1;var e=interopRequireDefaultExports;Object.defineProperty(i3sPendingTilesRegister,"__esModule",{value:!0}),i3sPendingTilesRegister.I3SPendingTilesRegister=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"frameNumberMap",new Map)}return(0,r.default)(e,[{key:"register",value:function(e,t){var r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}},{key:"deregister",value:function(e,t){var r=this.frameNumberMap.get(e);if(r){var n=r.get(t)||1;r.set(t,n-1)}}},{key:"isZero",value:function(e,t){var r;return 0===((null===(r=this.frameNumberMap.get(e))||void 0===r?void 0:r.get(t))||0)}}]),e}();return i3sPendingTilesRegister.I3SPendingTilesRegister=i,i3sPendingTilesRegister}function requireI3sTileManager(){if(hasRequiredI3sTileManager)return i3sTileManager;hasRequiredI3sTileManager=1;var e=interopRequireDefaultExports;Object.defineProperty(i3sTileManager,"__esModule",{value:!0}),i3sTileManager.I3STileManager=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireI3sPendingTilesRegister(),a=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"_statusMap",void 0),(0,n.default)(this,"pendingTilesRegister",new i.I3SPendingTilesRegister),this._statusMap={}}return(0,r.default)(e,[{key:"add",value:function(e,t,r,n){var i=this;if(!this._statusMap[t]){var a=n.frameNumber,o=n.viewport.id;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:"REQUESTED"},this.pendingTilesRegister.register(o,a),e().then((function(e){i._statusMap[t].status="COMPLETED";var r=i._statusMap[t].frameState;i.pendingTilesRegister.deregister(r.viewport.id,r.frameNumber),i._statusMap[t].callback(e,n)})).catch((function(e){i._statusMap[t].status="ERROR";var n=i._statusMap[t].frameState;i.pendingTilesRegister.deregister(n.viewport.id,n.frameNumber),r(e)}))}}},{key:"update",value:function(e,t){if(this._statusMap[e]){var r=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r.viewport.id,r.frameNumber),this.pendingTilesRegister.register(t.viewport.id,t.frameNumber),this._statusMap[e].frameState=t}}},{key:"find",value:function(e){return this._statusMap[e]}},{key:"hasPendingTiles",value:function(e,t){return!this.pendingTilesRegister.isZero(e,t)}}]),e}();return i3sTileManager.I3STileManager=a,i3sTileManager}function requireI3sTilesetTraverser(){if(hasRequiredI3sTilesetTraverser)return i3sTilesetTraverser;hasRequiredI3sTilesetTraverser=1;var e=interopRequireDefaultExports;Object.defineProperty(i3sTilesetTraverser,"__esModule",{value:!0}),i3sTilesetTraverser.I3STilesetTraverser=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=e(requireDefineProperty()),c=es5$n,d=tilesetTraverser,h=i3sLod,f=tile3d,p=requireI3sTileManager();function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var y=function(e){(0,o.default)(b,e);var d,m,y,v=(m=b,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(m);if(y){var r=(0,l.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,s.default)(this,e)});function b(e){var t;return(0,n.default)(this,b),t=v.call(this,e),(0,u.default)((0,a.default)(t),"_tileManager",void 0),t._tileManager=new p.I3STileManager,t}return(0,i.default)(b,[{key:"traversalFinished",value:function(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}},{key:"shouldRefine",value:function(e,t){return e._lodJudge=(0,h.getLodStatus)(e,t),"DIG"===e._lodJudge}},{key:"updateChildTiles",value:function(e,t){var r,n=this,i=e.children,a=e.tileset,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(e.header.children||[]);try{var s=function(){var o=r.value,s="".concat(o.id,"-").concat(t.viewport.id),l=i&&i.find((function(e){return e.id===s}));if(l)l&&n.updateTile(l,t);else{var u=function(){return n._loadTile(o.id,a)};n._tileManager.find(s)?n._tileManager.update(s,t):(a.tileset.nodePages&&(u=function(){return a.tileset.nodePagesTile.formTileFromNodePages(o.id)}),n._tileManager.add(u,s,(function(t){return n._onTileLoad(t,e,s)}),t))}};for(o.s();!(r=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return!1}},{key:"_loadTile",value:(d=(0,r.default)(t.default.mark((function e(r,n){var i,a,o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.loader,a=n.getTileUrl("".concat(n.url,"/nodes/").concat(r)),o=g(g({},n.loadOptions),{},{i3s:g(g({},n.loadOptions.i3s),{},{isTileHeader:!0})}),e.next=5,(0,c.load)(a,i,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"_onTileLoad",value:function(e,t,r){var n=new f.Tile3D(t.tileset,e,t,r);t.children.push(n);var i=this._tileManager.find(n.id).frameState;this.updateTile(n,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,i)}}]),b}(d.TilesetTraverser);return i3sTilesetTraverser.I3STilesetTraverser=y,i3sTilesetTraverser}var _interopRequireDefault$i=interopRequireDefaultExports;Object.defineProperty(tileset3d,"__esModule",{value:!0}),tileset3d.Tileset3D=void 0;var _regenerator$2=_interopRequireDefault$i(requireRegenerator()),_slicedToArray2$3=_interopRequireDefault$i(requireSlicedToArray()),_asyncToGenerator2$2=_interopRequireDefault$i(requireAsyncToGenerator()),_classCallCheck2$2=_interopRequireDefault$i(requireClassCallCheck()),_createClass2$2=_interopRequireDefault$i(requireCreateClass()),_defineProperty2$9=_interopRequireDefault$i(requireDefineProperty()),_core$2=es5$q,_geospatial=es5$p,_stats$1=requireDist$2(),_loaderUtils$1=es5$t,_tilesetCache=tilesetCache,_transformUtils=transformUtils,_frameState=frameState,_zoom=requireZoom(),_tile3d=tile3d,_constants$2=constants$6,_tilesetTraverser=tilesetTraverser,_tileset3dTraverser=requireTileset3dTraverser(),_i3sTilesetTraverser=requireI3sTilesetTraverser();function _createForOfIteratorHelper$3(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$3(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys$3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(r),!0).forEach((function(t){(0,_defineProperty2$9.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var DEFAULT_PROPS={description:"",ellipsoid:_geospatial.Ellipsoid.WGS84,modelMatrix:new _core$2.Matrix4,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(e){return e},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},TILES_TOTAL="Tiles In Tileset(s)",TILES_IN_MEMORY="Tiles In Memory",TILES_IN_VIEW="Tiles In View",TILES_RENDERABLE="Tiles To Render",TILES_LOADED="Tiles Loaded",TILES_LOADING="Tiles Loading",TILES_UNLOADED="Tiles Unloaded",TILES_LOAD_FAILED="Failed Tile Loads",POINTS_COUNT="Points/Vertices",TILES_GPU_MEMORY="Tile Memory Use",Tileset3D=function(){function e(t,r){(0,_classCallCheck2$2.default)(this,e),(0,_defineProperty2$9.default)(this,"options",void 0),(0,_defineProperty2$9.default)(this,"loadOptions",void 0),(0,_defineProperty2$9.default)(this,"type",void 0),(0,_defineProperty2$9.default)(this,"tileset",void 0),(0,_defineProperty2$9.default)(this,"loader",void 0),(0,_defineProperty2$9.default)(this,"url",void 0),(0,_defineProperty2$9.default)(this,"basePath",void 0),(0,_defineProperty2$9.default)(this,"modelMatrix",void 0),(0,_defineProperty2$9.default)(this,"ellipsoid",void 0),(0,_defineProperty2$9.default)(this,"lodMetricType",void 0),(0,_defineProperty2$9.default)(this,"lodMetricValue",void 0),(0,_defineProperty2$9.default)(this,"refine",void 0),(0,_defineProperty2$9.default)(this,"root",null),(0,_defineProperty2$9.default)(this,"roots",{}),(0,_defineProperty2$9.default)(this,"asset",{}),(0,_defineProperty2$9.default)(this,"description",""),(0,_defineProperty2$9.default)(this,"properties",void 0),(0,_defineProperty2$9.default)(this,"extras",null),(0,_defineProperty2$9.default)(this,"attributions",{}),(0,_defineProperty2$9.default)(this,"credits",{}),(0,_defineProperty2$9.default)(this,"stats",void 0),(0,_defineProperty2$9.default)(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),(0,_defineProperty2$9.default)(this,"cartographicCenter",null),(0,_defineProperty2$9.default)(this,"cartesianCenter",null),(0,_defineProperty2$9.default)(this,"zoom",1),(0,_defineProperty2$9.default)(this,"boundingVolume",null),(0,_defineProperty2$9.default)(this,"dynamicScreenSpaceErrorComputedDensity",0),(0,_defineProperty2$9.default)(this,"maximumMemoryUsage",32),(0,_defineProperty2$9.default)(this,"gpuMemoryUsageInBytes",0),(0,_defineProperty2$9.default)(this,"_frameNumber",0),(0,_defineProperty2$9.default)(this,"_queryParams",{}),(0,_defineProperty2$9.default)(this,"_extensionsUsed",[]),(0,_defineProperty2$9.default)(this,"_tiles",{}),(0,_defineProperty2$9.default)(this,"_pendingCount",0),(0,_defineProperty2$9.default)(this,"selectedTiles",[]),(0,_defineProperty2$9.default)(this,"traverseCounter",0),(0,_defineProperty2$9.default)(this,"geometricError",0),(0,_defineProperty2$9.default)(this,"lastUpdatedVieports",null),(0,_defineProperty2$9.default)(this,"_requestedTiles",[]),(0,_defineProperty2$9.default)(this,"_emptyTiles",[]),(0,_defineProperty2$9.default)(this,"frameStateData",{}),(0,_defineProperty2$9.default)(this,"_traverser",void 0),(0,_defineProperty2$9.default)(this,"_cache",new _tilesetCache.TilesetCache),(0,_defineProperty2$9.default)(this,"_requestScheduler",void 0),(0,_defineProperty2$9.default)(this,"updatePromise",null),(0,_defineProperty2$9.default)(this,"tilesetInitializationPromise",void 0),this.options=_objectSpread$3(_objectSpread$3({},DEFAULT_PROPS),r),this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||_loaderUtils$1.path.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new _loaderUtils$1.RequestScheduler({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new _stats$1.Stats({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}var t,r,n;return(0,_createClass2$2.default)(e,[{key:"destroy",value:function(){this._destroy()}},{key:"isLoaded",value:function(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return new URLSearchParams(this._queryParams).toString()}},{key:"setProps",value:function(e){this.options=_objectSpread$3(_objectSpread$3({},this.options),e)}},{key:"setOptions",value:function(e){this.options=_objectSpread$3(_objectSpread$3({},this.options),e)}},{key:"getTileUrl",value:function(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tilesetInitializationPromise.then((function(){!t&&e.lastUpdatedVieports?t=e.lastUpdatedVieports:e.lastUpdatedVieports=t,t&&e.doUpdate(t)}))}},{key:"selectTiles",value:(n=(0,_asyncToGenerator2$2.default)(_regenerator$2.default.mark((function e(){var t,r=this,n=arguments;return _regenerator$2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,e.next=3,this.tilesetInitializationPromise;case 3:return t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise((function(e){setTimeout((function(){r.lastUpdatedVieports&&r.doUpdate(r.lastUpdatedVieports),e(r._frameNumber),r.updatePromise=null}),r.options.debounceTime)}))),e.abrupt("return",this.updatePromise);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"doUpdate",value:function(e){if((!("loadTiles"in this.options)||this.options.loadTiles)&&!(this.traverseCounter>0)){var t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;var r,n=[],i=_createForOfIteratorHelper$3(t);try{for(i.s();!(r=i.n()).done;){var a=r.value.id;this._needTraverse(a)?n.push(a):this.traverseCounter--}}catch(e){i.e(e)}finally{i.f()}var o,s=_createForOfIteratorHelper$3(t);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.id;if(this.roots[u]||(this.roots[u]=this._initializeTileHeaders(this.tileset,null)),n.includes(u)){var c=(0,_frameState.getFrameState)(l,this._frameNumber);this._traverser.traverse(this.roots[u],c,this.options)}}}catch(e){s.e(e)}finally{s.f()}}}},{key:"_needTraverse",value:function(e){var t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}},{key:"_onTraversalEnd",value:function(e){var t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),i=(0,_frameState.limitSelectedTiles)(n,e,this.options.maximumTilesSelected),a=(0,_slicedToArray2$3.default)(i,2),o=a[1];r.selectedTiles=a[0];var s,l=_createForOfIteratorHelper$3(o);try{for(l.s();!(s=l.n()).done;)s.value.unselect()}catch(e){l.e(e)}finally{l.f()}r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}},{key:"_updateTiles",value:function(){for(var e in this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[],this.frameStateData){var t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);var r,n=_createForOfIteratorHelper$3(this.selectedTiles);try{for(n.s();!(r=n.n()).done;){var i=r.value;this._tiles[i.id]=i}}catch(e){n.e(e)}finally{n.f()}this._loadTiles(),this._unloadTiles(),this._updateStats()}},{key:"_tilesChanged",value:function(e,t){if(e.length!==t.length)return!0;var r=new Set(e.map((function(e){return e.id}))),n=new Set(t.map((function(e){return e.id})));return e.filter((function(e){return!n.has(e.id)})).length>0||t.filter((function(e){return!r.has(e.id)})).length>0}},{key:"_loadTiles",value:function(){var e,t=_createForOfIteratorHelper$3(this._requestedTiles);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.contentUnloaded&&this._loadTile(r)}}catch(e){t.e(e)}finally{t.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(e,t){return e._unloadTile(t)}))}},{key:"_updateStats",value:function(){var e,t=0,r=0,n=_createForOfIteratorHelper$3(this.selectedTiles);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.contentAvailable&&i.content&&(t++,r+=i.content.pointCount?i.content.pointCount:i.content.vertexCount)}}catch(e){n.e(e)}finally{n.f()}this.stats.get(TILES_IN_VIEW).count=this.selectedTiles.length,this.stats.get(TILES_RENDERABLE).count=t,this.stats.get(POINTS_COUNT).count=r}},{key:"_initializeTileSet",value:(r=(0,_asyncToGenerator2$2.default)(_regenerator$2.default.mark((function e(t){return _regenerator$2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.type!==_constants$2.TILESET_TYPE.I3S){e.next=5;break}return this.calculateViewPropsI3S(),e.next=4,t.root;case 4:t.root=e.sent;case 5:this.root=this._initializeTileHeaders(t,null),this.type===_constants$2.TILESET_TYPE.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===_constants$2.TILESET_TYPE.I3S&&this._initializeI3STileset();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"calculateViewPropsI3S",value:function(){var e,t=this.tileset.fullExtent;if(t){var r=t.xmin,n=t.ymin,i=t.zmin;return this.cartographicCenter=new _core$2.Vector3(r+(t.xmax-r)/2,n+(t.ymax-n)/2,i+(t.zmax-i)/2),this.cartesianCenter=_geospatial.Ellipsoid.WGS84.cartographicToCartesian(this.cartographicCenter,new _core$2.Vector3),void(this.zoom=(0,_zoom.getZoomFromFullExtent)(t,this.cartographicCenter,this.cartesianCenter))}var a=null===(e=this.tileset.store)||void 0===e?void 0:e.extent;if(a){var o=(0,_slicedToArray2$3.default)(a,4),s=o[0],l=o[1];return this.cartographicCenter=new _core$2.Vector3(s+(o[2]-s)/2,l+(o[3]-l)/2,0),this.cartesianCenter=_geospatial.Ellipsoid.WGS84.cartographicToCartesian(this.cartographicCenter,new _core$2.Vector3),void(this.zoom=(0,_zoom.getZoomFromExtent)(a,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new _core$2.Vector3,this.zoom=1}},{key:"calculateViewPropsTiles3D",value:function(){var e=this.root,t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new _core$2.Vector3,void(this.zoom=1);this.cartographicCenter=0!==t[0]||0!==t[1]||0!==t[2]?_geospatial.Ellipsoid.WGS84.cartesianToCartographic(t,new _core$2.Vector3):new _core$2.Vector3(0,0,-_geospatial.Ellipsoid.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=(0,_zoom.getZoomFromBoundingVolume)(e.boundingVolume,this.cartographicCenter)}},{key:"_initializeStats",value:function(){this.stats.get(TILES_TOTAL),this.stats.get(TILES_LOADING),this.stats.get(TILES_IN_MEMORY),this.stats.get(TILES_IN_VIEW),this.stats.get(TILES_RENDERABLE),this.stats.get(TILES_LOADED),this.stats.get(TILES_UNLOADED),this.stats.get(TILES_LOAD_FAILED),this.stats.get(POINTS_COUNT),this.stats.get(TILES_GPU_MEMORY,"memory")}},{key:"_initializeTileHeaders",value:function(e,t){var r=new _tile3d.Tile3D(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===_constants$2.TILESET_TYPE.TILES3D){var n=[];for(n.push(r);n.length>0;){var i=n.pop();this.stats.get(TILES_TOTAL).incrementCount();var a,o=_createForOfIteratorHelper$3(i.header.children||[]);try{for(o.s();!(a=o.n()).done;){var s,l=new _tile3d.Tile3D(this,a.value,i);if(null!==(s=l.contentUrl)&&void 0!==s&&s.includes("?session=")){var u=new URL(l.contentUrl).searchParams.get("session");u&&(this._queryParams.session=u)}i.children.push(l),l.depth=i.depth+1,n.push(l)}}catch(e){o.e(e)}finally{o.f()}}}return r}},{key:"_initializeTraverser",value:function(){var e;switch(this.type){case _constants$2.TILESET_TYPE.TILES3D:e=_tileset3dTraverser.Tileset3DTraverser;break;case _constants$2.TILESET_TYPE.I3S:e=_i3sTilesetTraverser.I3STilesetTraverser;break;default:e=_tilesetTraverser.TilesetTraverser}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:(t=(0,_asyncToGenerator2$2.default)(_regenerator$2.default.mark((function e(t){var r;return _regenerator$2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._onStartTileLoading(),e.next=4,t.loadContent();case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this._onTileLoadError(t,e.t0 instanceof Error?e.t0:new Error("load failed"));case 10:return e.prev=10,this._onEndTileLoading(),this._onTileLoad(t,r),e.finish(10);case 14:case"end":return e.stop()}}),e,this,[[0,7,10,14]])}))),function(e){return t.apply(this,arguments)})},{key:"_onTileLoadError",value:function(e,t){this.stats.get(TILES_LOAD_FAILED).incrementCount();var r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}},{key:"_onTileLoad",value:function(e,t){if(t){if(this.type===_constants$2.TILESET_TYPE.I3S){var r,n,i=(null===(r=this.tileset)||void 0===r||null===(n=r.nodePagesTile)||void 0===n?void 0:n.nodesInNodePages)||0;this.stats.get(TILES_TOTAL).reset(),this.stats.get(TILES_TOTAL).addCount(i)}e&&e.content&&(0,_transformUtils.calculateTransformProps)(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}},{key:"updateContentTypes",value:function(e){if(this.type===_constants$2.TILESET_TYPE.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===_constants$2.TILESET_TYPE.TILES3D){var t,r=((null===(t=e.content)||void 0===t?void 0:t.gltf)||{}).extensionsRemoved,n=void 0===r?[]:r;n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get(TILES_LOADING).incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get(TILES_LOADING).decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,(function(t){return t._updateCacheStats(e)}))}},{key:"_updateCacheStats",value:function(e){this.stats.get(TILES_LOADED).incrementCount(),this.stats.get(TILES_IN_MEMORY).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(TILES_GPU_MEMORY).count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(TILES_IN_MEMORY).decrementCount(),this.stats.get(TILES_UNLOADED).incrementCount(),this.stats.get(TILES_GPU_MEMORY).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var t,r=e.pop(),n=_createForOfIteratorHelper$3(r.children);try{for(n.s();!(t=n.n()).done;)e.push(t.value)}catch(e){n.e(e)}finally{n.f()}this._destroyTile(r)}this.root=null}},{key:"_destroySubtree",value:function(e){var t=e,r=[];for(r.push(t);r.length>0;){var n,i=_createForOfIteratorHelper$3((e=r.pop()).children);try{for(i.s();!(n=i.n()).done;)r.push(n.value)}catch(e){i.e(e)}finally{i.f()}e!==t&&this._destroyTile(e)}t.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeTiles3DTileset",value:function(e){if(e.queryString){var t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams=_objectSpread$3(_objectSpread$3({},this._queryParams),r)}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}},{key:"_initializeI3STileset",value:function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}]),e}();tileset3d.Tileset3D=Tileset3D,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"LOD_METRIC_TYPE",{enumerable:!0,get:function(){return u.LOD_METRIC_TYPE}}),Object.defineProperty(e,"TILESET_TYPE",{enumerable:!0,get:function(){return u.TILESET_TYPE}}),Object.defineProperty(e,"TILE_CONTENT_STATE",{enumerable:!0,get:function(){return u.TILE_CONTENT_STATE}}),Object.defineProperty(e,"TILE_REFINEMENT",{enumerable:!0,get:function(){return u.TILE_REFINEMENT}}),Object.defineProperty(e,"TILE_TYPE",{enumerable:!0,get:function(){return u.TILE_TYPE}}),Object.defineProperty(e,"Tile3D",{enumerable:!0,get:function(){return r.Tile3D}}),Object.defineProperty(e,"Tileset3D",{enumerable:!0,get:function(){return t.Tileset3D}}),Object.defineProperty(e,"TilesetCache",{enumerable:!0,get:function(){return i.TilesetCache}}),Object.defineProperty(e,"TilesetTraverser",{enumerable:!0,get:function(){return n.TilesetTraverser}}),Object.defineProperty(e,"calculateTransformProps",{enumerable:!0,get:function(){return o.calculateTransformProps}}),Object.defineProperty(e,"createBoundingVolume",{enumerable:!0,get:function(){return a.createBoundingVolume}}),Object.defineProperty(e,"getFrameState",{enumerable:!0,get:function(){return s.getFrameState}}),Object.defineProperty(e,"getLodStatus",{enumerable:!0,get:function(){return l.getLodStatus}});var t=tileset3d,r=tile3d,n=tilesetTraverser,i=tilesetCache,a=boundingVolume,o=transformUtils,s=frameState,l=i3sLod,u=constants$6}(es5$r);const VERSION$2="3.4.14",TILE3D_TYPE={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function getStringFromArrayBuffer(e,t,r){es5$t.assert(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(e,t,r);return n.decode(i)}function getMagicString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}var es5$m={},dracoLoader={},version$4={},hasRequiredVersion$4,hasRequiredDracoLoader;function requireVersion$4(){return hasRequiredVersion$4||(hasRequiredVersion$4=1,Object.defineProperty(version$4,"__esModule",{value:!0}),version$4.VERSION=void 0,version$4.VERSION="3.4.14"),version$4}function requireDracoLoader(){if(hasRequiredDracoLoader)return dracoLoader;hasRequiredDracoLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(dracoLoader,"__esModule",{value:!0}),dracoLoader._TypecheckDracoLoader=dracoLoader.DracoLoader=void 0;var t=e(_typeofExports),r=requireEs5$b(),n=requireVersion$4(),i={draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":(0,t.default)(WebAssembly))?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},a={name:"Draco",id:r.isBrowser?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:n.VERSION,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:i};return dracoLoader.DracoLoader=a,dracoLoader._TypecheckDracoLoader=a,dracoLoader}var dracoParser={},es5$l={},tableBatchBuilder={},baseTableBatchAggregator={},hasRequiredBaseTableBatchAggregator;function requireBaseTableBatchAggregator(){if(hasRequiredBaseTableBatchAggregator)return baseTableBatchAggregator;hasRequiredBaseTableBatchAggregator=1;var e=interopRequireDefaultExports;Object.defineProperty(baseTableBatchAggregator,"__esModule",{value:!0}),baseTableBatchAggregator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(r,i){if((0,t.default)(this,e),(0,n.default)(this,"schema",void 0),(0,n.default)(this,"options",void 0),(0,n.default)(this,"length",0),(0,n.default)(this,"rows",null),(0,n.default)(this,"cursor",0),(0,n.default)(this,"_headers",[]),this.options=i,this.schema=r,!Array.isArray(r))for(var a in this._headers=[],r)this._headers[r[a].index]=r[a].name}return(0,r.default)(e,[{key:"rowCount",value:function(){return this.length}},{key:"addArrayRow",value:function(e,t){Number.isFinite(t)&&(this.cursor=t),this.rows=this.rows||new Array(100),this.rows[this.length]=e,this.length++}},{key:"addObjectRow",value:function(e,t){Number.isFinite(t)&&(this.cursor=t),this.rows=this.rows||new Array(100),this.rows[this.length]=e,this.length++}},{key:"getBatch",value:function(){var e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}]),e}();return baseTableBatchAggregator.default=i,baseTableBatchAggregator}var rowTableBatchAggregator={},rowUtils={},hasRequiredRowUtils,hasRequiredRowTableBatchAggregator;function requireRowUtils(){return hasRequiredRowUtils||(hasRequiredRowUtils=1,Object.defineProperty(rowUtils,"__esModule",{value:!0}),rowUtils.convertToArrayRow=function(e,t){if(!e)throw new Error("null row");if(!t)throw new Error("no headers");for(var r=new Array(t.length),n=0;n<t.length;n++)r[n]=e[t[n]];return r},rowUtils.convertToObjectRow=function(e,t){if(!e)throw new Error("null row");if(!t)throw new Error("no headers");for(var r={},n=0;n<t.length;n++)r[t[n]]=e[n];return r}),rowUtils}function requireRowTableBatchAggregator(){if(hasRequiredRowTableBatchAggregator)return rowTableBatchAggregator;hasRequiredRowTableBatchAggregator=1;var e=interopRequireDefaultExports;Object.defineProperty(rowTableBatchAggregator,"__esModule",{value:!0}),rowTableBatchAggregator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireRowUtils(),a=function(){function e(r,i){if((0,t.default)(this,e),(0,n.default)(this,"schema",void 0),(0,n.default)(this,"options",void 0),(0,n.default)(this,"length",0),(0,n.default)(this,"objectRows",null),(0,n.default)(this,"arrayRows",null),(0,n.default)(this,"cursor",0),(0,n.default)(this,"_headers",[]),this.options=i,this.schema=r,!Array.isArray(r))for(var a in this._headers=[],r)this._headers[r[a].index]=r[a].name}return(0,r.default)(e,[{key:"rowCount",value:function(){return this.length}},{key:"addArrayRow",value:function(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this.options.shape){case"object-row-table":var r=(0,i.convertToObjectRow)(e,this._headers);this.addObjectRow(r,t);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(100),this.arrayRows[this.length]=e,this.length++}}},{key:"addObjectRow",value:function(e,t){switch(Number.isFinite(t)&&(this.cursor=t),this.options.shape){case"array-row-table":var r=(0,i.convertToArrayRow)(e,this._headers);this.addArrayRow(r,t);break;case"object-row-table":this.objectRows=this.objectRows||new Array(100),this.objectRows[this.length]=e,this.length++}}},{key:"getBatch",value:function(){var e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}]),e}();return rowTableBatchAggregator.default=a,rowTableBatchAggregator}var columnarTableBatchAggregator={},hasRequiredColumnarTableBatchAggregator,hasRequiredTableBatchBuilder;function requireColumnarTableBatchAggregator(){if(hasRequiredColumnarTableBatchAggregator)return columnarTableBatchAggregator;hasRequiredColumnarTableBatchAggregator=1;var e=interopRequireDefaultExports;Object.defineProperty(columnarTableBatchAggregator,"__esModule",{value:!0}),columnarTableBatchAggregator.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=function(){function e(t,n){(0,r.default)(this,e),(0,i.default)(this,"schema",void 0),(0,i.default)(this,"length",0),(0,i.default)(this,"allocated",0),(0,i.default)(this,"columns",{}),this.schema=t,this._reallocateColumns()}return(0,n.default)(e,[{key:"rowCount",value:function(){return this.length}},{key:"addArrayRow",value:function(e){this._reallocateColumns();var t=0;for(var r in this.columns)this.columns[r][this.length]=e[t++];this.length++}},{key:"addObjectRow",value:function(e){for(var t in this._reallocateColumns(),e)this.columns[t][this.length]=e[t];this.length++}},{key:"getBatch",value:function(){this._pruneColumns();var e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(var t in this.schema){var r=this.schema[t];e[r.name]=this.columns[r.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}},{key:"_reallocateColumns",value:function(){if(!(this.length<this.allocated))for(var e in this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={},this.schema){var t=this.schema[e],r=t.type||Float32Array,n=this.columns[t.index];if(n&&ArrayBuffer.isView(n)){var i=new r(this.allocated);i.set(n),this.columns[t.index]=i}else n?(n.length=this.allocated,this.columns[t.index]=n):this.columns[t.index]=new r(this.allocated)}}},{key:"_pruneColumns",value:function(){for(var e=0,r=Object.entries(this.columns);e<r.length;e++){var n=(0,t.default)(r[e],2);this.columns[n[0]]=n[1].slice(0,this.length)}}}]),e}();return columnarTableBatchAggregator.default=a,columnarTableBatchAggregator}function requireTableBatchBuilder(){if(hasRequiredTableBatchBuilder)return tableBatchBuilder;hasRequiredTableBatchBuilder=1;var e=interopRequireDefaultExports;Object.defineProperty(tableBatchBuilder,"__esModule",{value:!0}),tableBatchBuilder.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireBaseTableBatchAggregator()),a=e(requireRowTableBatchAggregator()),o=e(requireColumnarTableBatchAggregator());function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={shape:"array-row-table",batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},c="TableBatchBuilder",d=function(){function e(r,i){(0,t.default)(this,e),(0,n.default)(this,"schema",void 0),(0,n.default)(this,"options",void 0),(0,n.default)(this,"aggregator",null),(0,n.default)(this,"batchCount",0),(0,n.default)(this,"bytesUsed",0),(0,n.default)(this,"isChunkComplete",!1),(0,n.default)(this,"lastBatchEmittedMs",Date.now()),(0,n.default)(this,"totalLength",0),(0,n.default)(this,"totalBytes",0),(0,n.default)(this,"rowBytes",0),this.schema=r,this.options=l(l({},u),i)}return(0,r.default)(e,[{key:"limitReached",value:function(){var e,t;return!!(Boolean(null===(e=this.options)||void 0===e?void 0:e.limit)&&this.totalLength>=this.options.limit)||!!(Boolean(null===(t=this.options)||void 0===t?void 0:t._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}},{key:"addRow",value:function(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}},{key:"addArrayRow",value:function(e){if(!this.aggregator){var t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(e)}},{key:"addObjectRow",value:function(e){if(!this.aggregator){var t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(e)}},{key:"chunkComplete",value:function(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),"string"==typeof e&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}},{key:"getFullBatch",value:function(e){return this._isFull()?this._getBatch(e):null}},{key:"getFinalBatch",value:function(e){return this._getBatch(e)}},{key:"_estimateRowMB",value:function(e){return Array.isArray(e)?8*e.length:8*Object.keys(e).length}},{key:"_isFull",value:function(){if(!this.aggregator||0===this.aggregator.rowCount())return!1;if("auto"===this.options.batchSize){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return!(this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs||(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),0))}},{key:"_getBatch",value:function(e){if(!this.aggregator)return null;null!=e&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);var t=this.aggregator.getBatch();return t.count=this.batchCount,t.bytesUsed=this.bytesUsed,Object.assign(t,e),this.batchCount++,this.aggregator=null,t}},{key:"_getTableBatchType",value:function(){switch(this.options.shape){case"row-table":return i.default;case"array-row-table":case"object-row-table":return a.default;case"columnar-table":return o.default;case"arrow-table":if(!e.ArrowBatch)throw new Error(c);return e.ArrowBatch;default:throw new Error(c)}}}]),e}();return tableBatchBuilder.default=d,(0,n.default)(d,"ArrowBatch",void 0),tableBatchBuilder}var meshUtils={},hasRequiredMeshUtils;function requireMeshUtils(){return hasRequiredMeshUtils||(hasRequiredMeshUtils=1,Object.defineProperty(meshUtils,"__esModule",{value:!0}),meshUtils.getMeshBoundingBox=function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=e.POSITION?e.POSITION.value:[],l=s&&s.length,u=0;u<l;u+=3){var c=s[u],d=s[u+1],h=s[u+2];t=c<t?c:t,r=d<r?d:r,n=h<n?h:n,i=c>i?c:i,a=d>a?d:a,o=h>o?h:o}return[[t,r,n],[i,a,o]]},meshUtils.getMeshSize=function(e){var t=0;for(var r in e){var n=e[r];ArrayBuffer.isView(n)&&(t+=n.byteLength*n.BYTES_PER_ELEMENT)}return t}),meshUtils}var deduceMeshSchema={},schema$1={},schema={},assert$b={},hasRequiredAssert$8,hasRequiredSchema$1;function requireAssert$8(){return hasRequiredAssert$8||(hasRequiredAssert$8=1,Object.defineProperty(assert$b,"__esModule",{value:!0}),assert$b.assert=function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}),assert$b}function requireSchema$1(){if(hasRequiredSchema$1)return schema;hasRequiredSchema$1=1;var e=interopRequireDefaultExports;Object.defineProperty(schema,"__esModule",{value:!0}),schema.default=void 0;var t=e(requireToConsumableArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=requireAssert$8();function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=function(){function e(t,n){(0,r.default)(this,e),(0,i.default)(this,"fields",void 0),(0,i.default)(this,"metadata",void 0),(0,a.assert)(Array.isArray(t)),function(e){var t,r={},n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]&&console.warn("Schema: duplicated field name",i.name,i),r[i.name]=!0}}catch(e){n.e(e)}finally{n.f()}}(t),this.fields=t,this.metadata=n||new Map}return(0,n.default)(e,[{key:"compareTo",value:function(e){if(this.metadata!==e.metadata)return!1;if(this.fields.length!==e.fields.length)return!1;for(var t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}},{key:"select",value:function(){for(var t=Object.create(null),r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++)t[o[a]]=!0;var s=this.fields.filter((function(e){return t[e.name]}));return new e(s,this.metadata)}},{key:"selectAt",value:function(){for(var t=this,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return new e(n.map((function(e){return t.fields[e]})).filter(Boolean),this.metadata)}},{key:"assign",value:function(t){var r,n=this.metadata;if(t instanceof e){var i=t;r=i.fields,n=u(u(new Map,this.metadata),i.metadata)}else r=t;var a,s=Object.create(null),l=o(this.fields);try{for(l.s();!(a=l.n()).done;){var c=a.value;s[c.name]=c}}catch(e){l.e(e)}finally{l.f()}var d,h=o(r);try{for(h.s();!(d=h.n()).done;){var f=d.value;s[f.name]=f}}catch(e){h.e(e)}finally{h.f()}return new e(Object.values(s),n)}}]),e}();function u(e,r){return new Map([].concat((0,t.default)(e||new Map),(0,t.default)(r||new Map)))}return schema.default=l,schema}var field={},hasRequiredField;function requireField(){if(hasRequiredField)return field;hasRequiredField=1;var e=interopRequireDefaultExports;Object.defineProperty(field,"__esModule",{value:!0}),field.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(r,i){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;(0,t.default)(this,e),(0,n.default)(this,"name",void 0),(0,n.default)(this,"type",void 0),(0,n.default)(this,"nullable",void 0),(0,n.default)(this,"metadata",void 0),this.name=r,this.type=i,this.nullable=a,this.metadata=o}return(0,r.default)(e,[{key:"typeId",get:function(){return this.type&&this.type.typeId}},{key:"clone",value:function(){return new e(this.name,this.type,this.nullable,this.metadata)}},{key:"compareTo",value:function(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}},{key:"toString",value:function(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}]),e}();return field.default=i,field}var type={},_enum={},hasRequired_enum,hasRequiredType,hasRequiredSchema;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,Object.defineProperty(_enum,"__esModule",{value:!0}),_enum.Type=void 0;var e=function(e){return e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e}({});return _enum.Type=e,_enum}function requireType(){return hasRequiredType||(hasRequiredType=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),e.TimestampSecond=e.TimestampNanosecond=e.TimestampMillisecond=e.TimestampMicrosecond=e.Timestamp=e.TimeSecond=e.TimeMillisecond=e.Time=e.Struct=e.Null=e.IntervalYearMonth=e.IntervalDayTime=e.Interval=e.Int8=e.Int64=e.Int32=e.Int16=e.Int=e.Float64=e.Float32=e.Float16=e.Float=e.FixedSizeList=e.DateMillisecond=e.DateDay=e.Date=e.DataType=e.Bool=e.Binary=void 0,Object.defineProperty(e,"Type",{enumerable:!0,get:function(){return _.Type}}),e.Utf8=e.Uint8=e.Uint64=e.Uint32=e.Uint16=void 0;var r,n,i,a,o,s,l,u,c=t(requireAssertThisInitialized()),d=t(requireDefineProperty()),h=t(requireInherits()),f=t(requirePossibleConstructorReturn()),p=t(requireGetPrototypeOf()),m=t(requireClassCallCheck()),g=t(requireCreateClass()),_=require_enum();function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var v=function(){function e(){(0,m.default)(this,e)}return(0,g.default)(e,[{key:"typeId",get:function(){return _.Type.NONE}},{key:"compareTo",value:function(e){return this===e}}],[{key:"isNull",value:function(e){return e&&e.typeId===_.Type.Null}},{key:"isInt",value:function(e){return e&&e.typeId===_.Type.Int}},{key:"isFloat",value:function(e){return e&&e.typeId===_.Type.Float}},{key:"isBinary",value:function(e){return e&&e.typeId===_.Type.Binary}},{key:"isUtf8",value:function(e){return e&&e.typeId===_.Type.Utf8}},{key:"isBool",value:function(e){return e&&e.typeId===_.Type.Bool}},{key:"isDecimal",value:function(e){return e&&e.typeId===_.Type.Decimal}},{key:"isDate",value:function(e){return e&&e.typeId===_.Type.Date}},{key:"isTime",value:function(e){return e&&e.typeId===_.Type.Time}},{key:"isTimestamp",value:function(e){return e&&e.typeId===_.Type.Timestamp}},{key:"isInterval",value:function(e){return e&&e.typeId===_.Type.Interval}},{key:"isList",value:function(e){return e&&e.typeId===_.Type.List}},{key:"isStruct",value:function(e){return e&&e.typeId===_.Type.Struct}},{key:"isUnion",value:function(e){return e&&e.typeId===_.Type.Union}},{key:"isFixedSizeBinary",value:function(e){return e&&e.typeId===_.Type.FixedSizeBinary}},{key:"isFixedSizeList",value:function(e){return e&&e.typeId===_.Type.FixedSizeList}},{key:"isMap",value:function(e){return e&&e.typeId===_.Type.Map}},{key:"isDictionary",value:function(e){return e&&e.typeId===_.Type.Dictionary}}]),e}();e.DataType=v;var b=function(e,t){(0,h.default)(n,e);var r=y(n);function n(){return(0,m.default)(this,n),r.apply(this,arguments)}return(0,g.default)(n,[{key:"typeId",get:function(){return _.Type.Null}},{key:t,get:function(){return"Null"}},{key:"toString",value:function(){return"Null"}}]),n}(v,Symbol.toStringTag);e.Null=b;var x=function(e,t){(0,h.default)(n,e);var r=y(n);function n(){return(0,m.default)(this,n),r.apply(this,arguments)}return(0,g.default)(n,[{key:"typeId",get:function(){return _.Type.Bool}},{key:t,get:function(){return"Bool"}},{key:"toString",value:function(){return"Bool"}}]),n}(v,Symbol.toStringTag);e.Bool=x,r=Symbol.toStringTag;var T=function(e){(0,h.default)(n,e);var t=y(n);function n(e,r){var i;return(0,m.default)(this,n),i=t.call(this),(0,d.default)((0,c.default)(i),"isSigned",void 0),(0,d.default)((0,c.default)(i),"bitWidth",void 0),i.isSigned=e,i.bitWidth=r,i}return(0,g.default)(n,[{key:"typeId",get:function(){return _.Type.Int}},{key:r,get:function(){return"Int"}},{key:"toString",value:function(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}]),n}(v);e.Int=T;var w=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!0,8)}return(0,g.default)(r)}(T);e.Int8=w;var E=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!0,16)}return(0,g.default)(r)}(T);e.Int16=E;var A=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!0,32)}return(0,g.default)(r)}(T);e.Int32=A;var S=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!0,64)}return(0,g.default)(r)}(T);e.Int64=S;var P=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!1,8)}return(0,g.default)(r)}(T);e.Uint8=P;var M=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!1,16)}return(0,g.default)(r)}(T);e.Uint16=M;var R=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!1,32)}return(0,g.default)(r)}(T);e.Uint32=R;var C=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,!1,64)}return(0,g.default)(r)}(T);e.Uint64=C,n=Symbol.toStringTag;var O=function(e){(0,h.default)(r,e);var t=y(r);function r(e){var n;return(0,m.default)(this,r),n=t.call(this),(0,d.default)((0,c.default)(n),"precision",void 0),n.precision=e,n}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Float}},{key:n,get:function(){return"Float"}},{key:"toString",value:function(){return"Float".concat(this.precision)}}]),r}(v);e.Float=O;var L=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,16)}return(0,g.default)(r)}(O);e.Float16=L;var I=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,32)}return(0,g.default)(r)}(O);e.Float32=I;var D=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,64)}return(0,g.default)(r)}(O);e.Float64=D;var k=function(e,t){(0,h.default)(n,e);var r=y(n);function n(){return(0,m.default)(this,n),r.call(this)}return(0,g.default)(n,[{key:"typeId",get:function(){return _.Type.Binary}},{key:"toString",value:function(){return"Binary"}},{key:t,get:function(){return"Binary"}}]),n}(v,Symbol.toStringTag);e.Binary=k;var B=function(e,t){(0,h.default)(n,e);var r=y(n);function n(){return(0,m.default)(this,n),r.apply(this,arguments)}return(0,g.default)(n,[{key:"typeId",get:function(){return _.Type.Utf8}},{key:t,get:function(){return"Utf8"}},{key:"toString",value:function(){return"Utf8"}}]),n}(v,Symbol.toStringTag);e.Utf8=B;var F={DAY:0,MILLISECOND:1};i=Symbol.toStringTag;var N=function(e){(0,h.default)(r,e);var t=y(r);function r(e){var n;return(0,m.default)(this,r),n=t.call(this),(0,d.default)((0,c.default)(n),"unit",void 0),n.unit=e,n}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Date}},{key:i,get:function(){return"Date"}},{key:"toString",value:function(){return"Date".concat(32*(this.unit+1),"<").concat(F[this.unit],">")}}]),r}(v);e.Date=N;var q=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,F.DAY)}return(0,g.default)(r)}(N);e.DateDay=q;var U=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,F.MILLISECOND)}return(0,g.default)(r)}(N);e.DateMillisecond=U;var j={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9};a=Symbol.toStringTag;var G=function(e){(0,h.default)(r,e);var t=y(r);function r(e,n){var i;return(0,m.default)(this,r),i=t.call(this),(0,d.default)((0,c.default)(i),"unit",void 0),(0,d.default)((0,c.default)(i),"bitWidth",void 0),i.unit=e,i.bitWidth=n,i}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Time}},{key:"toString",value:function(){return"Time".concat(this.bitWidth,"<").concat(j[this.unit],">")}},{key:a,get:function(){return"Time"}}]),r}(v);e.Time=G;var z=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,j.SECOND,32)}return(0,g.default)(r)}(G);e.TimeSecond=z;var V=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,j.MILLISECOND,32)}return(0,g.default)(r)}(G);e.TimeMillisecond=V,o=Symbol.toStringTag;var $=function(e){(0,h.default)(r,e);var t=y(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,m.default)(this,r),n=t.call(this),(0,d.default)((0,c.default)(n),"unit",void 0),(0,d.default)((0,c.default)(n),"timezone",void 0),n.unit=e,n.timezone=i,n}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Timestamp}},{key:o,get:function(){return"Timestamp"}},{key:"toString",value:function(){return"Timestamp<".concat(j[this.unit]).concat(this.timezone?", ".concat(this.timezone):"",">")}}]),r}(v);e.Timestamp=$;var H=function(e){(0,h.default)(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,m.default)(this,r),t.call(this,j.SECOND,e)}return(0,g.default)(r)}($);e.TimestampSecond=H;var W=function(e){(0,h.default)(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,m.default)(this,r),t.call(this,j.MILLISECOND,e)}return(0,g.default)(r)}($);e.TimestampMillisecond=W;var X=function(e){(0,h.default)(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,m.default)(this,r),t.call(this,j.MICROSECOND,e)}return(0,g.default)(r)}($);e.TimestampMicrosecond=X;var Y=function(e){(0,h.default)(r,e);var t=y(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,m.default)(this,r),t.call(this,j.NANOSECOND,e)}return(0,g.default)(r)}($);e.TimestampNanosecond=Y;var Z={DAY_TIME:0,YEAR_MONTH:1};s=Symbol.toStringTag;var K=function(e){(0,h.default)(r,e);var t=y(r);function r(e){var n;return(0,m.default)(this,r),n=t.call(this),(0,d.default)((0,c.default)(n),"unit",void 0),n.unit=e,n}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Interval}},{key:s,get:function(){return"Interval"}},{key:"toString",value:function(){return"Interval<".concat(Z[this.unit],">")}}]),r}(v);e.Interval=K;var J=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,Z.DAY_TIME)}return(0,g.default)(r)}(K);e.IntervalDayTime=J;var Q=function(e){(0,h.default)(r,e);var t=y(r);function r(){return(0,m.default)(this,r),t.call(this,Z.YEAR_MONTH)}return(0,g.default)(r)}(K);e.IntervalYearMonth=Q,l=Symbol.toStringTag;var ee=function(e){(0,h.default)(r,e);var t=y(r);function r(e,n){var i;return(0,m.default)(this,r),i=t.call(this),(0,d.default)((0,c.default)(i),"listSize",void 0),(0,d.default)((0,c.default)(i),"children",void 0),i.listSize=e,i.children=[n],i}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.FixedSizeList}},{key:"valueType",get:function(){return this.children[0].type}},{key:"valueField",get:function(){return this.children[0]}},{key:l,get:function(){return"FixedSizeList"}},{key:"toString",value:function(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}]),r}(v);e.FixedSizeList=ee,u=Symbol.toStringTag;var te=function(e){(0,h.default)(r,e);var t=y(r);function r(e){var n;return(0,m.default)(this,r),n=t.call(this),(0,d.default)((0,c.default)(n),"children",void 0),n.children=e,n}return(0,g.default)(r,[{key:"typeId",get:function(){return _.Type.Struct}},{key:"toString",value:function(){return"Struct<{".concat(this.children.map((function(e){return"".concat(e.name,":").concat(e.type)})).join(", "),"}>")}},{key:u,get:function(){return"Struct"}}]),r}(v);e.Struct=te}(type)),type}function requireSchema(){return hasRequiredSchema||(hasRequiredSchema=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Binary",{enumerable:!0,get:function(){return i.Binary}}),Object.defineProperty(e,"Bool",{enumerable:!0,get:function(){return i.Bool}}),Object.defineProperty(e,"DataType",{enumerable:!0,get:function(){return i.DataType}}),Object.defineProperty(e,"Date",{enumerable:!0,get:function(){return i.Date}}),Object.defineProperty(e,"DateDay",{enumerable:!0,get:function(){return i.DateDay}}),Object.defineProperty(e,"DateMillisecond",{enumerable:!0,get:function(){return i.DateMillisecond}}),Object.defineProperty(e,"Field",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"FixedSizeList",{enumerable:!0,get:function(){return i.FixedSizeList}}),Object.defineProperty(e,"Float",{enumerable:!0,get:function(){return i.Float}}),Object.defineProperty(e,"Float16",{enumerable:!0,get:function(){return i.Float16}}),Object.defineProperty(e,"Float32",{enumerable:!0,get:function(){return i.Float32}}),Object.defineProperty(e,"Float64",{enumerable:!0,get:function(){return i.Float64}}),Object.defineProperty(e,"Int",{enumerable:!0,get:function(){return i.Int}}),Object.defineProperty(e,"Int16",{enumerable:!0,get:function(){return i.Int16}}),Object.defineProperty(e,"Int32",{enumerable:!0,get:function(){return i.Int32}}),Object.defineProperty(e,"Int64",{enumerable:!0,get:function(){return i.Int64}}),Object.defineProperty(e,"Int8",{enumerable:!0,get:function(){return i.Int8}}),Object.defineProperty(e,"Interval",{enumerable:!0,get:function(){return i.Interval}}),Object.defineProperty(e,"IntervalDayTime",{enumerable:!0,get:function(){return i.IntervalDayTime}}),Object.defineProperty(e,"IntervalYearMonth",{enumerable:!0,get:function(){return i.IntervalYearMonth}}),Object.defineProperty(e,"Null",{enumerable:!0,get:function(){return i.Null}}),Object.defineProperty(e,"Schema",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"Struct",{enumerable:!0,get:function(){return i.Struct}}),Object.defineProperty(e,"Time",{enumerable:!0,get:function(){return i.Time}}),Object.defineProperty(e,"TimeMillisecond",{enumerable:!0,get:function(){return i.TimeMillisecond}}),Object.defineProperty(e,"TimeSecond",{enumerable:!0,get:function(){return i.TimeSecond}}),Object.defineProperty(e,"Timestamp",{enumerable:!0,get:function(){return i.Timestamp}}),Object.defineProperty(e,"TimestampMicrosecond",{enumerable:!0,get:function(){return i.TimestampMicrosecond}}),Object.defineProperty(e,"TimestampMillisecond",{enumerable:!0,get:function(){return i.TimestampMillisecond}}),Object.defineProperty(e,"TimestampNanosecond",{enumerable:!0,get:function(){return i.TimestampNanosecond}}),Object.defineProperty(e,"TimestampSecond",{enumerable:!0,get:function(){return i.TimestampSecond}}),Object.defineProperty(e,"Type",{enumerable:!0,get:function(){return i.Type}}),Object.defineProperty(e,"Uint16",{enumerable:!0,get:function(){return i.Uint16}}),Object.defineProperty(e,"Uint32",{enumerable:!0,get:function(){return i.Uint32}}),Object.defineProperty(e,"Uint64",{enumerable:!0,get:function(){return i.Uint64}}),Object.defineProperty(e,"Uint8",{enumerable:!0,get:function(){return i.Uint8}}),Object.defineProperty(e,"Utf8",{enumerable:!0,get:function(){return i.Utf8}});var r=t(requireSchema$1()),n=t(requireField()),i=requireType()}(schema$1)),schema$1}var arrowLikeTypeUtils={},hasRequiredArrowLikeTypeUtils,hasRequiredDeduceMeshSchema;function requireArrowLikeTypeUtils(){if(hasRequiredArrowLikeTypeUtils)return arrowLikeTypeUtils;hasRequiredArrowLikeTypeUtils=1,Object.defineProperty(arrowLikeTypeUtils,"__esModule",{value:!0}),arrowLikeTypeUtils.getArrowTypeFromTypedArray=function(t){switch(t.constructor){case Int8Array:return new e.Int8;case Uint8Array:return new e.Uint8;case Int16Array:return new e.Int16;case Uint16Array:return new e.Uint16;case Int32Array:return new e.Int32;case Uint32Array:return new e.Uint32;case Float32Array:return new e.Float32;case Float64Array:return new e.Float64;default:throw new Error("array type not supported")}};var e=requireSchema();return arrowLikeTypeUtils}function requireDeduceMeshSchema(){if(hasRequiredDeduceMeshSchema)return deduceMeshSchema;hasRequiredDeduceMeshSchema=1,Object.defineProperty(deduceMeshSchema,"__esModule",{value:!0}),deduceMeshSchema.deduceMeshField=r,deduceMeshSchema.deduceMeshSchema=function(t,n){var i=function(e){var t=[];for(var n in e)t.push(r(n,e[n]));return t}(t);return new e.Schema(i,n)},deduceMeshSchema.makeMeshAttributeMetadata=n;var e=requireSchema(),t=requireArrowLikeTypeUtils();function r(r,i,a){var o=(0,t.getArrowTypeFromTypedArray)(i.value),s=a||n(i);return new e.Field(r,new e.FixedSizeList(i.size,new e.Field("value",o)),!1,s)}function n(e){var t=new Map;return"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10)),"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10)),"normalized"in e&&t.set("normalized",e.normalized.toString()),t}return deduceMeshSchema}var deduceColumnType={},hasRequiredDeduceColumnType;function requireDeduceColumnType(){return hasRequiredDeduceColumnType||(hasRequiredDeduceColumnType=1,Object.defineProperty(deduceColumnType,"__esModule",{value:!0}),deduceColumnType.deduceTypeFromColumn=function(e){return e instanceof Date?Date:e instanceof Number?Float32Array:"string"==typeof e?String:null},deduceColumnType.deduceTypeFromValue=function(e){return e instanceof Date?Date:e instanceof Number?Float32Array:"string"==typeof e?String:null}),deduceColumnType}var getTypeInfo={},hasRequiredGetTypeInfo;function requireGetTypeInfo(){if(hasRequiredGetTypeInfo)return getTypeInfo;hasRequiredGetTypeInfo=1,Object.defineProperty(getTypeInfo,"__esModule",{value:!0}),getTypeInfo.getTypeInfo=function(e){return{typeId:e.typeId,ArrayType:e.ArrayType,typeName:e.toString(),typeEnumName:r(e.typeId),precision:e.precision}};var e=requireSchema(),t=null;function r(r){if(!t)for(var n in t={},e.Type)t[e.Type[n]]=n;return t[r]}return getTypeInfo}var asyncQueue={},wrapNativeSuper={exports:{}},isNativeFunction={exports:{}},hasRequiredIsNativeFunction;function requireIsNativeFunction(){return hasRequiredIsNativeFunction||(hasRequiredIsNativeFunction=1,function(e){e.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},e.exports.__esModule=!0,e.exports.default=e.exports}(isNativeFunction)),isNativeFunction.exports}var construct={exports:{}},isNativeReflectConstruct={exports:{}},hasRequiredIsNativeReflectConstruct,hasRequiredConstruct,hasRequiredWrapNativeSuper,hasRequiredAsyncQueue,hasRequiredEs5$9;function requireIsNativeReflectConstruct(){return hasRequiredIsNativeReflectConstruct||(hasRequiredIsNativeReflectConstruct=1,function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports}(isNativeReflectConstruct)),isNativeReflectConstruct.exports}function requireConstruct(){return hasRequiredConstruct||(hasRequiredConstruct=1,function(e){var t=requireSetPrototypeOf(),r=requireIsNativeReflectConstruct();function n(i,a,o){return r()?(e.exports=n=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=n=function(e,r,n){var i=[null];i.push.apply(i,r);var a=new(Function.bind.apply(e,i));return n&&t(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}(construct)),construct.exports}function requireWrapNativeSuper(){return hasRequiredWrapNativeSuper||(hasRequiredWrapNativeSuper=1,function(e){var t=requireGetPrototypeOf(),r=requireSetPrototypeOf(),n=requireIsNativeFunction(),i=requireConstruct();function a(o){var s="function"==typeof Map?new Map:void 0;return e.exports=a=function(e){if(null===e||!n(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(e))return s.get(e);s.set(e,a)}function a(){return i(e,arguments,t(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),r(a,e)},e.exports.__esModule=!0,e.exports.default=e.exports,a(o)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}(wrapNativeSuper)),wrapNativeSuper.exports}function requireAsyncQueue(){if(hasRequiredAsyncQueue)return asyncQueue;hasRequiredAsyncQueue=1;var e=interopRequireDefaultExports;Object.defineProperty(asyncQueue,"__esModule",{value:!0}),asyncQueue.default=void 0,asyncQueue.takeAsync=function(e){return h.apply(this,arguments)};var t,r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=e(requireDefineProperty()),a=e(requireClassCallCheck()),o=e(requireCreateClass()),s=e(requireInherits()),l=e(requirePossibleConstructorReturn()),u=e(requireGetPrototypeOf()),c=function(e){(0,s.default)(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,u.default)(t);if(r){var i=(0,u.default)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,l.default)(this,e)});function i(){return(0,a.default)(this,i),n.apply(this,arguments)}return(0,o.default)(i,[{key:"enqueue",value:function(e){return this.push(e)}},{key:"dequeue",value:function(){return this.shift()}}]),i}((0,e(requireWrapNativeSuper()).default)(Array));t=Symbol.asyncIterator;var d=function(){function e(){(0,a.default)(this,e),(0,i.default)(this,"_values",void 0),(0,i.default)(this,"_settlers",void 0),(0,i.default)(this,"_closed",void 0),this._values=new c,this._settlers=new c,this._closed=!1}return(0,o.default)(e,[{key:"close",value:function(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}},{key:t,value:function(){return this}},{key:"enqueue",value:function(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.dequeue();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.enqueue(e)}},{key:"next",value:function(){var e=this;if(this._values.length>0){var t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((function(t,r){e._settlers.enqueue({resolve:t,reject:r})}))}}]),e}();function h(){return h=(0,n.default)(r.default.mark((function e(t){var n,i,a,o,s,l=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=l.length>1&&void 0!==l[1]?l[1]:1/0,i=[],a=t[Symbol.asyncIterator]();case 3:if(!(i.length<n)){e.next=14;break}return e.next=6,a.next();case 6:if(s=(o=e.sent).value,!o.done){e.next=11;break}return e.abrupt("break",14);case 11:i.push(s),e.next=3;break;case 14:return e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}return asyncQueue.default=d,asyncQueue}function requireEs5$9(){return hasRequiredEs5$9||(hasRequiredEs5$9=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AsyncQueue",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"Binary",{enumerable:!0,get:function(){return l.Binary}}),Object.defineProperty(e,"Bool",{enumerable:!0,get:function(){return l.Bool}}),Object.defineProperty(e,"ColumnarTableBatchAggregator",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"DataType",{enumerable:!0,get:function(){return l.DataType}}),Object.defineProperty(e,"Date",{enumerable:!0,get:function(){return l.Date}}),Object.defineProperty(e,"DateDay",{enumerable:!0,get:function(){return l.DateDay}}),Object.defineProperty(e,"DateMillisecond",{enumerable:!0,get:function(){return l.DateMillisecond}}),Object.defineProperty(e,"Field",{enumerable:!0,get:function(){return l.Field}}),Object.defineProperty(e,"FixedSizeList",{enumerable:!0,get:function(){return l.FixedSizeList}}),Object.defineProperty(e,"Float",{enumerable:!0,get:function(){return l.Float}}),Object.defineProperty(e,"Float16",{enumerable:!0,get:function(){return l.Float16}}),Object.defineProperty(e,"Float32",{enumerable:!0,get:function(){return l.Float32}}),Object.defineProperty(e,"Float64",{enumerable:!0,get:function(){return l.Float64}}),Object.defineProperty(e,"Int",{enumerable:!0,get:function(){return l.Int}}),Object.defineProperty(e,"Int16",{enumerable:!0,get:function(){return l.Int16}}),Object.defineProperty(e,"Int32",{enumerable:!0,get:function(){return l.Int32}}),Object.defineProperty(e,"Int64",{enumerable:!0,get:function(){return l.Int64}}),Object.defineProperty(e,"Int8",{enumerable:!0,get:function(){return l.Int8}}),Object.defineProperty(e,"Interval",{enumerable:!0,get:function(){return l.Interval}}),Object.defineProperty(e,"IntervalDayTime",{enumerable:!0,get:function(){return l.IntervalDayTime}}),Object.defineProperty(e,"IntervalYearMonth",{enumerable:!0,get:function(){return l.IntervalYearMonth}}),Object.defineProperty(e,"Null",{enumerable:!0,get:function(){return l.Null}}),Object.defineProperty(e,"RowTableBatchAggregator",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"Schema",{enumerable:!0,get:function(){return l.Schema}}),Object.defineProperty(e,"Struct",{enumerable:!0,get:function(){return l.Struct}}),Object.defineProperty(e,"TableBatchBuilder",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"Time",{enumerable:!0,get:function(){return l.Time}}),Object.defineProperty(e,"TimeMillisecond",{enumerable:!0,get:function(){return l.TimeMillisecond}}),Object.defineProperty(e,"TimeSecond",{enumerable:!0,get:function(){return l.TimeSecond}}),Object.defineProperty(e,"Timestamp",{enumerable:!0,get:function(){return l.Timestamp}}),Object.defineProperty(e,"TimestampMicrosecond",{enumerable:!0,get:function(){return l.TimestampMicrosecond}}),Object.defineProperty(e,"TimestampMillisecond",{enumerable:!0,get:function(){return l.TimestampMillisecond}}),Object.defineProperty(e,"TimestampNanosecond",{enumerable:!0,get:function(){return l.TimestampNanosecond}}),Object.defineProperty(e,"TimestampSecond",{enumerable:!0,get:function(){return l.TimestampSecond}}),Object.defineProperty(e,"Uint16",{enumerable:!0,get:function(){return l.Uint16}}),Object.defineProperty(e,"Uint32",{enumerable:!0,get:function(){return l.Uint32}}),Object.defineProperty(e,"Uint64",{enumerable:!0,get:function(){return l.Uint64}}),Object.defineProperty(e,"Uint8",{enumerable:!0,get:function(){return l.Uint8}}),Object.defineProperty(e,"Utf8",{enumerable:!0,get:function(){return l.Utf8}}),Object.defineProperty(e,"convertToArrayRow",{enumerable:!0,get:function(){return a.convertToArrayRow}}),Object.defineProperty(e,"convertToObjectRow",{enumerable:!0,get:function(){return a.convertToObjectRow}}),Object.defineProperty(e,"deduceMeshField",{enumerable:!0,get:function(){return s.deduceMeshField}}),Object.defineProperty(e,"deduceMeshSchema",{enumerable:!0,get:function(){return s.deduceMeshSchema}}),Object.defineProperty(e,"deduceTypeFromColumn",{enumerable:!0,get:function(){return u.deduceTypeFromColumn}}),Object.defineProperty(e,"deduceTypeFromValue",{enumerable:!0,get:function(){return u.deduceTypeFromValue}}),Object.defineProperty(e,"getArrowTypeFromTypedArray",{enumerable:!0,get:function(){return d.getArrowTypeFromTypedArray}}),Object.defineProperty(e,"getMeshBoundingBox",{enumerable:!0,get:function(){return o.getMeshBoundingBox}}),Object.defineProperty(e,"getMeshSize",{enumerable:!0,get:function(){return o.getMeshSize}}),Object.defineProperty(e,"getTypeInfo",{enumerable:!0,get:function(){return c.getTypeInfo}}),Object.defineProperty(e,"makeMeshAttributeMetadata",{enumerable:!0,get:function(){return s.makeMeshAttributeMetadata}});var r=t(requireTableBatchBuilder()),n=t(requireRowTableBatchAggregator()),i=t(requireColumnarTableBatchAggregator()),a=requireRowUtils(),o=requireMeshUtils(),s=requireDeduceMeshSchema(),l=requireSchema(),u=requireDeduceColumnType(),c=requireGetTypeInfo(),d=requireArrowLikeTypeUtils(),h=t(requireAsyncQueue())}(es5$l)),es5$l}var getDracoSchema={},hasRequiredGetDracoSchema,hasRequiredDracoParser;function requireGetDracoSchema(){if(hasRequiredGetDracoSchema)return getDracoSchema;hasRequiredGetDracoSchema=1,Object.defineProperty(getDracoSchema,"__esModule",{value:!0}),getDracoSchema.getDracoSchema=function(n,i,a){var o=r(i.metadata),s=[],l=function(e){var t={};for(var r in e){var n=e[r];t[n.name||"undefined"]=n}return t}(i.attributes);for(var u in n){var c=t(u,n[u],l[u]);s.push(c)}if(a){var d=t("indices",a);s.push(d)}return new e.Schema(s,o)};var e=requireEs5$9();function t(t,n,i){var a=i?r(i.metadata):void 0;return(0,e.deduceMeshField)(t,n,a)}function r(e){var t=new Map;for(var r in e)t.set("".concat(r,".string"),JSON.stringify(e[r]));return t}return getDracoSchema}function requireDracoParser(){if(hasRequiredDracoParser)return dracoParser;hasRequiredDracoParser=1;var e=interopRequireDefaultExports;Object.defineProperty(dracoParser,"__esModule",{value:!0}),dracoParser.default=void 0;var t=e(requireToConsumableArray()),r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=requireEs5$9(),s=requireGetDracoSchema();function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},h={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},f=function(){function e(t){(0,n.default)(this,e),(0,a.default)(this,"draco",void 0),(0,a.default)(this,"decoder",void 0),(0,a.default)(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return(0,i.default)(e,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);var n=this.decoder.GetEncodedGeometryType(r),i=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!i.ptr){var l="DRACO decompression failed: ".concat(a.error_msg());throw new Error(l)}var u=this._getDracoLoaderData(i,n,t),d=this._getMeshData(i,u,t),h=(0,o.getMeshBoundingBox)(d.attributes),f=(0,s.getDracoSchema)(d.attributes,u,d.indices);return c(c({loader:"draco",loaderData:u,header:{vertexCount:i.num_points(),boundingBox:h}},d),{},{schema:f})}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}},{key:"_getDracoLoaderData",value:function(e,t,r){var n=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:i}}},{key:"_getDracoAttributes",value:function(e,t){for(var r={},n=0;n<e.num_attributes();n++){var i=this.decoder.GetAttribute(e,n),a=this._getAttributeMetadata(e,n);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:n,metadata:a};var o=this._getQuantizationTransform(i,t);o&&(r[i.unique_id()].quantization_transform=o);var s=this._getOctahedronTransform(i,t);s&&(r[i.unique_id()].octahedron_transform=s)}return r}},{key:"_getMeshData",value:function(e,t,r){var n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:n}}},{key:"_getMeshAttributes",value:function(e,t,r){for(var n={},i=0,a=Object.values(e.attributes);i<a.length;i++){var o=a[i],s=this._deduceAttributeName(o,r);o.name=s;var l=this._getAttributeValues(t,o);n[s]={value:l.value,size:l.size,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}},{key:"_getTriangleListIndices",value:function(e){var t=3*e.num_faces(),r=4*t,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}},{key:"_getTriangleStripIndices",value:function(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){for(var t=e.size(),r=new Int32Array(t),n=0;n<t;n++)r[n]=e.GetValue(n);return r}(t)}finally{this.draco.destroy(t)}}},{key:"_getAttributeValues",value:function(e,t){var r,n=h[t.data_type],i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,s=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,n),l=this.draco._malloc(o);try{var u=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,u,s,o,l),r=new n(this.draco.HEAPF32.buffer,l,a).slice()}finally{this.draco._free(l)}return{value:r,size:i}}},{key:"_deduceAttributeName",value:function(e,t){for(var n=e.unique_id,i=0,a=Object.entries(t.extraAttributes||{});i<a.length;i++){var o=(0,r.default)(a[i],2);if(o[1]===n)return o[0]}var s=e.attribute_type;for(var l in d)if(this.draco[l]===s)return d[l];var u=t.attributeNameEntry||"name";return e.metadata[u]?e.metadata[u].string:"CUSTOM_ATTRIBUTE_".concat(n)}},{key:"_getTopLevelMetadata",value:function(e){var t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}},{key:"_getAttributeMetadata",value:function(e,t){var r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}},{key:"_getDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var t={},r=this.metadataQuerier.NumEntries(e),n=0;n<r;n++){var i=this.metadataQuerier.GetEntryName(e,n);t[i]=this._getDracoMetadataField(e,i)}return t}},{key:"_getDracoMetadataField",value:function(e,t){var r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);var n=function(e){for(var t=e.size(),r=new Int32Array(t),n=0;n<t;n++)r[n]=e.GetValue(n);return r}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}},{key:"_disableAttributeTransforms",value:function(e){var r,n=e.quantizedAttributes,i=e.octahedronAttributes,a=void 0===i?[]:i,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}([].concat((0,t.default)(void 0===n?[]:n),(0,t.default)(a)));try{for(o.s();!(r=o.n()).done;)this.decoder.SkipAttributeTransform(this.draco[r.value])}catch(e){o.e(e)}finally{o.f()}}},{key:"_getQuantizationTransform",value:function(e,t){var r=this,n=t.quantizedAttributes,i=void 0===n?[]:n,a=e.attribute_type(),o=i.map((function(e){return r.decoder[e]})).includes(a);if(o){var s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map((function(e){return s.min_value(e)}))}}finally{this.draco.destroy(s)}}return null}},{key:"_getOctahedronTransform",value:function(e,t){var r=this,n=t.octahedronAttributes,i=void 0===n?[]:n,a=e.attribute_type(),o=i.map((function(e){return r.decoder[e]})).includes(a);if(o){var s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}]),e}();return dracoParser.default=f,dracoParser}var dracoModuleLoader={},hasRequiredDracoModuleLoader;function requireDracoModuleLoader(){if(hasRequiredDracoModuleLoader)return dracoModuleLoader;hasRequiredDracoModuleLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(dracoModuleLoader,"__esModule",{value:!0}),dracoModuleLoader.loadDracoDecoderModule=function(e){return m.apply(this,arguments)},dracoModuleLoader.loadDracoEncoderModule=function(e){return g.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireSlicedToArray()),n=e(requireDefineProperty()),i=e(requireAsyncToGenerator()),a=requireEs5$b();function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l,u,c="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),d="".concat(c,"/draco_decoder.js"),h="".concat(c,"/draco_wasm_wrapper.js"),f="".concat(c,"/draco_decoder.wasm"),p="https://raw.githubusercontent.com/google/draco/".concat("1.4.1","/javascript/draco_encoder.js");function m(){return m=(0,i.default)(t.default.mark((function e(r){var n;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=(n=r.modules||{}).draco3d?l||n.draco3d.createDecoderModule({}).then((function(e){return{draco:e}})):l||_(r),e.next=4,l;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function g(){return g=(0,i.default)(t.default.mark((function e(r){var n;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(n=r.modules||{}).draco3d?u||n.draco3d.createEncoderModule({}).then((function(e){return{draco:e}})):u||b(r),e.next=4,u;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function _(e){return y.apply(this,arguments)}function y(){return(y=(0,i.default)(t.default.mark((function e(n){var i,o,s;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n.draco&&n.draco.decoderType,e.next="js"===e.t0?3:7;break;case 3:return e.next=5,(0,a.loadLibrary)(d,"draco",n);case 5:return i=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,(0,a.loadLibrary)(h,"draco",n);case 10:return e.t2=e.sent,e.next=13,(0,a.loadLibrary)(f,"draco",n);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:s=(0,r.default)(e.sent,2),i=s[0],o=s[1];case 21:return i=i||globalThis.DracoDecoderModule,e.next=24,v(i,o);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){var r={};return t&&(r.wasmBinary=t),new Promise((function(t){e(s(s({},r),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}function b(e){return x.apply(this,arguments)}function x(){return(x=(0,i.default)(t.default.mark((function e(r){var n;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.loadLibrary)(p,"draco",r);case 2:return n=(n=e.sent)||globalThis.DracoEncoderModule,e.abrupt("return",new Promise((function(e){n({onModuleLoaded:function(t){return e({draco:t})}})})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return dracoModuleLoader}var dracoWriter={},dracoBuilder={},hasRequiredDracoBuilder,hasRequiredDracoWriter;function requireDracoBuilder(){if(hasRequiredDracoBuilder)return dracoBuilder;hasRequiredDracoBuilder=1;var e=interopRequireDefaultExports;Object.defineProperty(dracoBuilder,"__esModule",{value:!0}),dracoBuilder.default=void 0;var t=e(_typeofExports),r=e(requireSlicedToArray()),n=e(requireToConsumableArray()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=e(requireDefineProperty());function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={POSITION:"POSITION",NORMAL:"NORMAL",COLOR_0:"COLOR",TEXCOORD_0:"TEX_COORD"},d=function(){},h=function(){function e(t){(0,i.default)(this,e),(0,o.default)(this,"draco",void 0),(0,o.default)(this,"dracoEncoder",void 0),(0,o.default)(this,"dracoMeshBuilder",void 0),(0,o.default)(this,"dracoMetadataBuilder",void 0),(0,o.default)(this,"log",void 0),this.draco=t,this.dracoEncoder=new this.draco.Encoder,this.dracoMeshBuilder=new this.draco.MeshBuilder,this.dracoMetadataBuilder=new this.draco.MetadataBuilder}return(0,a.default)(e,[{key:"destroy",value:function(){this.destroyEncodedObject(this.dracoMeshBuilder),this.destroyEncodedObject(this.dracoEncoder),this.destroyEncodedObject(this.dracoMetadataBuilder),this.dracoMeshBuilder=null,this.dracoEncoder=null,this.draco=null}},{key:"destroyEncodedObject",value:function(e){e&&this.draco.destroy(e)}},{key:"encodeSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.log=d,this._setOptions(t),t.pointcloud?this._encodePointCloud(e,t):this._encodeMesh(e,t)}},{key:"_getAttributesFromMesh",value:function(e){var t=u(u({},e),e.attributes);return e.indices&&(t.indices=e.indices),t}},{key:"_encodePointCloud",value:function(e,t){var r=new this.draco.PointCloud;t.metadata&&this._addGeometryMetadata(r,t.metadata);var n=this._getAttributesFromMesh(e);this._createDracoPointCloud(r,n,t);var i=new this.draco.DracoInt8Array;try{var a=this.dracoEncoder.EncodePointCloudToDracoBuffer(r,!1,i);if(!(a>0))throw new Error("Draco encoding failed.");return this.log("DRACO encoded ".concat(r.num_points()," points\n        with ").concat(r.num_attributes()," attributes into ").concat(a," bytes")),f(i)}finally{this.destroyEncodedObject(i),this.destroyEncodedObject(r)}}},{key:"_encodeMesh",value:function(e,t){var r=new this.draco.Mesh;t.metadata&&this._addGeometryMetadata(r,t.metadata);var n=this._getAttributesFromMesh(e);this._createDracoMesh(r,n,t);var i=new this.draco.DracoInt8Array;try{var a=this.dracoEncoder.EncodeMeshToDracoBuffer(r,i);if(a<=0)throw new Error("Draco encoding failed.");return this.log("DRACO encoded ".concat(r.num_points()," points\n        with ").concat(r.num_attributes()," attributes into ").concat(a," bytes")),f(i)}finally{this.destroyEncodedObject(i),this.destroyEncodedObject(r)}}},{key:"_setOptions",value:function(e){var t;if("speed"in e&&(t=this.dracoEncoder).SetSpeedOptions.apply(t,(0,n.default)(e.speed)),"method"in e&&this.dracoEncoder.SetEncodingMethod(this.draco[e.method||"MESH_SEQUENTIAL_ENCODING"]),"quantization"in e)for(var r in e.quantization)this.dracoEncoder.SetAttributeQuantization(this.draco[r],e.quantization[r])}},{key:"_createDracoMesh",value:function(e,t,r){var n=r.attributesMetadata||{};try{var i=this._getPositionAttribute(t);if(!i)throw new Error("positions");var a=i.length/3;for(var o in t){var s=t[o],l=this._addAttributeToMesh(e,o=c[o]||o,s,a);-1!==l&&this._addAttributeMetadata(e,l,u({name:o},n[o]||{}))}}catch(t){throw this.destroyEncodedObject(e),t}return e}},{key:"_createDracoPointCloud",value:function(e,t,r){var n=r.attributesMetadata||{};try{var i=this._getPositionAttribute(t);if(!i)throw new Error("positions");var a=i.length/3;for(var o in t){var s=t[o],l=this._addAttributeToMesh(e,o=c[o]||o,s,a);-1!==l&&this._addAttributeMetadata(e,l,u({name:o},n[o]||{}))}}catch(t){throw this.destroyEncodedObject(e),t}return e}},{key:"_addAttributeToMesh",value:function(e,t,r,n){if(!ArrayBuffer.isView(r))return-1;var i=this._getDracoAttributeType(t),a=r.length/n;if("indices"===i){var o=r.length/3;return this.log("Adding attribute ".concat(t,", size ").concat(o)),this.dracoMeshBuilder.AddFacesToMesh(e,o,r),-1}this.log("Adding attribute ".concat(t,", size ").concat(a));var s=this.dracoMeshBuilder,l=r.buffer;switch(r.constructor){case Int8Array:return s.AddInt8Attribute(e,i,n,a,new Int8Array(l));case Int16Array:return s.AddInt16Attribute(e,i,n,a,new Int16Array(l));case Int32Array:return s.AddInt32Attribute(e,i,n,a,new Int32Array(l));case Uint8Array:case Uint8ClampedArray:return s.AddUInt8Attribute(e,i,n,a,new Uint8Array(l));case Uint16Array:return s.AddUInt16Attribute(e,i,n,a,new Uint16Array(l));case Uint32Array:return s.AddUInt32Attribute(e,i,n,a,new Uint32Array(l));case Float32Array:default:return s.AddFloatAttribute(e,i,n,a,new Float32Array(l))}}},{key:"_getDracoAttributeType",value:function(e){switch(e.toLowerCase()){case"indices":return"indices";case"position":case"positions":case"vertices":return this.draco.POSITION;case"normal":case"normals":return this.draco.NORMAL;case"color":case"colors":return this.draco.COLOR;case"texcoord":case"texcoords":return this.draco.TEX_COORD;default:return this.draco.GENERIC}}},{key:"_getPositionAttribute",value:function(e){for(var t in e){var r=e[t];if(this._getDracoAttributeType(t)===this.draco.POSITION)return r}return null}},{key:"_addGeometryMetadata",value:function(e,t){var r=new this.draco.Metadata;this._populateDracoMetadata(r,t),this.dracoMeshBuilder.AddMetadata(e,r)}},{key:"_addAttributeMetadata",value:function(e,t,r){var n=new this.draco.Metadata;this._populateDracoMetadata(n,r),this.dracoMeshBuilder.SetMetadataForAttribute(e,t,n)}},{key:"_populateDracoMetadata",value:function(e,n){var i,a,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}((a=n).entries&&!a.hasOwnProperty("entries")?a.entries():Object.entries(a));try{for(o.s();!(i=o.n()).done;){var l=(0,r.default)(i.value,2),u=l[0],c=l[1];switch((0,t.default)(c)){case"number":Math.trunc(c)===c?this.dracoMetadataBuilder.AddIntEntry(e,u,c):this.dracoMetadataBuilder.AddDoubleEntry(e,u,c);break;case"object":c instanceof Int32Array&&this.dracoMetadataBuilder.AddIntEntryArray(e,u,c,c.length);break;default:this.dracoMetadataBuilder.AddStringEntry(e,u,c)}}}catch(e){o.e(e)}finally{o.f()}}}]),e}();function f(e){for(var t=e.size(),r=new ArrayBuffer(t),n=new Int8Array(r),i=0;i<t;++i)n[i]=e.GetValue(i);return r}return dracoBuilder.default=h,dracoBuilder}function requireDracoWriter(){if(hasRequiredDracoWriter)return dracoWriter;hasRequiredDracoWriter=1;var e=interopRequireDefaultExports;Object.defineProperty(dracoWriter,"__esModule",{value:!0}),dracoWriter.DracoWriter=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireDracoBuilder()),i=requireDracoModuleLoader(),a={name:"DRACO",id:"draco",module:"draco",version:requireVersion$4().VERSION,extensions:["drc"],encode:function(e){return o.apply(this,arguments)},options:{draco:{pointcloud:!1,attributeNameEntry:"name"}}};function o(){return o=(0,r.default)(t.default.mark((function e(r){var a,o,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,(0,i.loadDracoEncoderModule)(a);case 3:return o=new n.default(e.sent.draco),e.prev=6,e.abrupt("return",o.encodeSync(r,a.draco));case 8:return e.prev=8,o.destroy(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[6,,8,11]])}))),o.apply(this,arguments)}return dracoWriter.DracoWriter=a,dracoWriter}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),e.DracoLoader=void 0,Object.defineProperty(e,"DracoWorkerLoader",{enumerable:!0,get:function(){return a.DracoLoader}}),Object.defineProperty(e,"DracoWriter",{enumerable:!0,get:function(){return c.DracoWriter}}),e._TypecheckDracoLoader=e.DracoWriterWorker=void 0;var r=t(requireRegenerator()),n=t(requireAsyncToGenerator()),i=t(requireDefineProperty()),a=requireDracoLoader(),o=t(requireDracoParser()),s=requireDracoModuleLoader(),l=requireVersion$4(),u=requireEs5$b(),c=requireDracoWriter();function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}e.DracoWriterWorker={id:u.isBrowser?"draco-writer":"draco-writer-nodejs",name:"Draco compressed geometry writer",module:"draco",version:l.VERSION,worker:!0,options:{draco:{},source:null}};var f=h(h({},a.DracoLoader),{},{parse:function(e,t){return p.apply(this,arguments)}});function p(){return p=(0,n.default)(r.default.mark((function e(t,n){var i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.loadDracoDecoderModule)(n);case 2:return i=new o.default(e.sent.draco),e.prev=5,e.abrupt("return",i.parseSync(t,null==n?void 0:n.draco));case 7:return e.prev=7,i.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])}))),p.apply(this,arguments)}e.DracoLoader=f,e._TypecheckDracoLoader=f}(es5$m);var es5$k={},constants$5={},_interopRequireDefault$h=interopRequireDefaultExports;Object.defineProperty(constants$5,"__esModule",{value:!0}),constants$5.GL_TYPE=constants$5.GL_PRIMITIVE_MODE=constants$5.GL_PRIMITIVE=constants$5.GL=void 0;var _defineProperty2$8=_interopRequireDefault$h(requireDefineProperty());function ownKeys$2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(r),!0).forEach((function(t){(0,_defineProperty2$8.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var GL_PRIMITIVE={POINTS:0,LINES:1,TRIANGLES:4};constants$5.GL_PRIMITIVE=GL_PRIMITIVE;var GL_PRIMITIVE_MODE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};constants$5.GL_PRIMITIVE_MODE=GL_PRIMITIVE_MODE;var GL_TYPE={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130};constants$5.GL_TYPE=GL_TYPE;var GL$1=_objectSpread$2(_objectSpread$2({},GL_PRIMITIVE_MODE),GL_TYPE);constants$5.GL=GL$1;var glType={},hasRequiredGlType;function requireGlType(){if(hasRequiredGlType)return glType;hasRequiredGlType=1;var e=interopRequireDefaultExports;Object.defineProperty(glType,"__esModule",{value:!0}),glType.default=void 0;var t,r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=constants$5,o=((0,i.default)(t={},a.GL_TYPE.DOUBLE,Float64Array),(0,i.default)(t,a.GL_TYPE.FLOAT,Float32Array),(0,i.default)(t,a.GL_TYPE.UNSIGNED_SHORT,Uint16Array),(0,i.default)(t,a.GL_TYPE.UNSIGNED_INT,Uint32Array),(0,i.default)(t,a.GL_TYPE.UNSIGNED_BYTE,Uint8Array),(0,i.default)(t,a.GL_TYPE.BYTE,Int8Array),(0,i.default)(t,a.GL_TYPE.SHORT,Int16Array),(0,i.default)(t,a.GL_TYPE.INT,Int32Array),t),s={DOUBLE:a.GL_TYPE.DOUBLE,FLOAT:a.GL_TYPE.FLOAT,UNSIGNED_SHORT:a.GL_TYPE.UNSIGNED_SHORT,UNSIGNED_INT:a.GL_TYPE.UNSIGNED_INT,UNSIGNED_BYTE:a.GL_TYPE.UNSIGNED_BYTE,BYTE:a.GL_TYPE.BYTE,SHORT:a.GL_TYPE.SHORT,INT:a.GL_TYPE.INT},l="Failed to convert GL type",u=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,null,[{key:"fromTypedArray",value:function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,o)if(o[t]===e)return t;throw new Error(l)}},{key:"fromName",value:function(e){var t=s[e];if(!t)throw new Error(l);return t}},{key:"getArrayType",value:function(e){switch(e){case a.GL_TYPE.UNSIGNED_SHORT_5_6_5:case a.GL_TYPE.UNSIGNED_SHORT_4_4_4_4:case a.GL_TYPE.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=o[e];if(!t)throw new Error(l);return t}}},{key:"getByteSize",value:function(t){return e.getArrayType(t).BYTES_PER_ELEMENT}},{key:"validate",value:function(t){return Boolean(e.getArrayType(t))}},{key:"createTypedArray",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return void 0===i&&(i=(r.byteLength-n)/e.getByteSize(t)),new(e.getArrayType(t))(r,n,i)}}]),e}();return glType.default=u,glType}var isGeometry={},hasRequiredIsGeometry;function requireIsGeometry(){if(hasRequiredIsGeometry)return isGeometry;hasRequiredIsGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(isGeometry,"__esModule",{value:!0}),isGeometry.default=function(e){return e&&"object"===(0,t.default)(e)&&e.mode&&e.attributes&&"object"===(0,t.default)(e.attributes)};var t=e(_typeofExports);return isGeometry}var attributeIterator={},hasRequiredAttributeIterator;function requireAttributeIterator(){if(hasRequiredAttributeIterator)return attributeIterator;hasRequiredAttributeIterator=1;var e=interopRequireDefaultExports;Object.defineProperty(attributeIterator,"__esModule",{value:!0}),attributeIterator.makeAttributeIterator=n;var t=e(requireRegenerator()),r=t.default.mark(n);function n(e,n){var i,a,o;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=new(0,e.constructor)(n),a=0;case 3:if(!(a<e.length)){t.next=10;break}for(o=0;o<n;o++)i[o]=i[a+o];return t.next=7,i;case 7:a+=n,t.next=3;break;case 10:case"end":return t.stop()}}),r)}return attributeIterator}var primitiveIterator={},modes={},hasRequiredModes,hasRequiredPrimitiveIterator;function requireModes(){if(hasRequiredModes)return modes;hasRequiredModes=1,Object.defineProperty(modes,"__esModule",{value:!0}),modes.getPrimitiveModeExpandedLength=function(t,r){switch(t){case e.GL.POINTS:case e.GL.LINES:case e.GL.LINE_STRIP:return r;case e.GL.LINE_LOOP:return r+1;case e.GL.TRIANGLES:return r;case e.GL.TRIANGLE_STRIP:case e.GL.TRIANGLE_FAN:return 3*(r-2);default:throw new Error("Unknown length")}},modes.getPrimitiveModeType=function(t){switch(t){case e.GL.POINTS:return e.GL.POINTS;case e.GL.LINES:case e.GL.LINE_STRIP:case e.GL.LINE_LOOP:return e.GL.LINES;case e.GL.TRIANGLES:case e.GL.TRIANGLE_STRIP:case e.GL.TRIANGLE_FAN:return e.GL.TRIANGLES;default:throw new Error("Unknown primitive mode")}},modes.isPrimitiveModeExpandable=function(t){switch(t){case e.GL.LINE_STRIP:case e.GL.LINE_LOOP:case e.GL.TRIANGLE_STRIP:case e.GL.TRIANGLE_FAN:return!0;default:return!1}};var e=constants$5;return modes}function requirePrimitiveIterator(){if(hasRequiredPrimitiveIterator)return primitiveIterator;hasRequiredPrimitiveIterator=1;var e=interopRequireDefaultExports;Object.defineProperty(primitiveIterator,"__esModule",{value:!0}),primitiveIterator.makePrimitiveIterator=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4?arguments[4]:void 0;return t.default.mark((function u(){var c,d;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&(e=e.values||e.value||e),void 0===l&&(l=e?e.length:s),c={attributes:a,type:(0,n.getPrimitiveModeType)(o),i1:0,i2:0,i3:0},d=s;case 4:if(!(d<l)){t.next=43;break}t.t0=o,t.next=t.t0===r.GL.POINTS?8:t.t0===r.GL.LINES?11:t.t0===r.GL.LINE_STRIP?15:t.t0===r.GL.LINE_LOOP?19:t.t0===r.GL.TRIANGLES?23:t.t0===r.GL.TRIANGLE_STRIP?28:t.t0===r.GL.TRIANGLE_FAN?32:37;break;case 8:return c.i1=d,d+=1,t.abrupt("break",38);case 11:return c.i1=d,c.i2=d+1,d+=2,t.abrupt("break",38);case 15:case 19:return c.i1=d,c.i2=d+1,d+=1,t.abrupt("break",38);case 23:return c.i1=d,c.i2=d+1,c.i3=d+2,d+=3,t.abrupt("break",38);case 28:return c.i1=d,c.i2=d+1,d+=1,t.abrupt("break",38);case 32:return c.i1=1,c.i2=d,c.i3=d+1,d+=1,t.abrupt("break",38);case 37:(0,i.assert)(!1);case 38:return e&&"i1"in c&&(c.i1=e[c.i1],c.i2=e[c.i2],c.i3=e[c.i3]),t.next=41,c;case 41:t.next=4;break;case 43:case"end":return t.stop()}}),u)}))()};var t=e(requireRegenerator()),r=constants$5,n=requireModes(),i=es5$t;return primitiveIterator}var computeVertexNormals={},assert$a={},hasRequiredAssert$7;function requireAssert$7(){return hasRequiredAssert$7||(hasRequiredAssert$7=1,Object.defineProperty(assert$a,"__esModule",{value:!0}),assert$a.assert=function(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}),assert$a}var getAttributeFromGeometry={},hasRequiredGetAttributeFromGeometry,hasRequiredComputeVertexNormals;function requireGetAttributeFromGeometry(){if(hasRequiredGetAttributeFromGeometry)return getAttributeFromGeometry;hasRequiredGetAttributeFromGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(getAttributeFromGeometry,"__esModule",{value:!0}),getAttributeFromGeometry.getPositions=function(e){if((0,t.default)(e)){var n=e.attributes,i=n.POSITION||n.positions;return(0,r.assert)(i),i}return ArrayBuffer.isView(e)?{values:e,size:3}:e?((0,r.assert)(e.values),e):(0,r.assert)(!1)};var t=e(requireIsGeometry()),r=requireAssert$7();return getAttributeFromGeometry}function requireComputeVertexNormals(){if(hasRequiredComputeVertexNormals)return computeVertexNormals;hasRequiredComputeVertexNormals=1,Object.defineProperty(computeVertexNormals,"__esModule",{value:!0}),computeVertexNormals.computeVertexNormals=function(s){(0,r.assert)((0,i.getPrimitiveModeType)(s.mode)===t.GL.TRIANGLES,"TRIANGLES required");var l,u=(0,a.getPositions)(s).values,c=new Float32Array(u.length),d=new e.Vector3,h=new e.Vector3,f=new e.Vector3,p=new e.Vector3,m=new e.Vector3,g=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}((0,n.makePrimitiveIterator)(s));try{for(g.s();!(l=g.n()).done;){var _=l.value;d.fromArray(u,3*_.i1),h.fromArray(u,3*_.i2+3),f.fromArray(u,3*_.i3+6),p.subVectors(f,h),m.subVectors(d,h);var y=p.cross(m);y.normalize();var v=_.primitiveIndex;c[9*v+0]=y.x,c[9*v+1]=y.y,c[9*v+2]=y.z,c[9*v+3]=y.x,c[9*v+4]=y.y,c[9*v+5]=y.z,c[9*v+6]=y.x,c[9*v+7]=y.y,c[9*v+8]=y.z}}catch(e){g.e(e)}finally{g.f()}return c};var e=es5$q,t=constants$5,r=requireAssert$7(),n=requirePrimitiveIterator(),i=requireModes(),a=requireGetAttributeFromGeometry();function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}return computeVertexNormals}var rgb565={},hasRequiredRgb565;function requireRgb565(){return hasRequiredRgb565||(hasRequiredRgb565=1,Object.defineProperty(rgb565,"__esModule",{value:!0}),rgb565.decodeRGB565=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=e>>5&63,n=31&e;return t[0]=(e>>11&31)<<3,t[1]=r<<2,t[2]=n<<3,t},rgb565.encodeRGB565=function(e){return Math.floor(e[0]/8)+4+(Math.floor(e[1]/4)+2<<5)+(Math.floor(e[2]/8)+4<<11)}),rgb565}var typedArrayUtils$1={},hasRequiredTypedArrayUtils$1;function requireTypedArrayUtils$1(){return hasRequiredTypedArrayUtils$1||(hasRequiredTypedArrayUtils$1=1,Object.defineProperty(typedArrayUtils$1,"__esModule",{value:!0}),typedArrayUtils$1.concatTypedArrays=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,r=0;r<e.length;++r)t+=e[r].byteLength;for(var n=new Uint8Array(t),i=0,a=0;a<e.length;++a){var o=new Uint8Array(e[a].buffer);t=o.length;for(var s=0;s<t;++s)n[i++]=o[s]}return n}),typedArrayUtils$1}var attributeCompression={},hasRequiredAttributeCompression;function requireAttributeCompression(){if(hasRequiredAttributeCompression)return attributeCompression;hasRequiredAttributeCompression=1,Object.defineProperty(attributeCompression,"__esModule",{value:!0}),attributeCompression.compressTextureCoordinates=function(e){return 4096*(4095*e.x|0)+(4095*e.y|0)},attributeCompression.decompressTextureCoordinates=function(e,t){var r=Math.floor(e/4096);return t.x=r/4095,t.y=(e-4096*r)/4095,t},attributeCompression.octDecode=g,attributeCompression.octDecodeFloat=v,attributeCompression.octDecodeFromVector4=function(e,r){(0,t.assert)(e),(0,t.assert)(r);var i=e.x,a=e.y,o=e.z,s=e.w;if(i<0||i>255||a<0||a>255||o<0||o>255||s<0||s>255)throw new Error("x, y, z, and w must be unsigned normalized integers between 0 and 255");return m(i*n+a,o*n+s,65535,r)},attributeCompression.octDecodeInRange=m,attributeCompression.octEncode=p,attributeCompression.octEncodeFloat=y,attributeCompression.octEncodeInRange=f,attributeCompression.octEncodeToVector4=function(e,t){return f(e,65535,s),t.x=u(s.x*r),t.y=u(s.x),t.z=u(s.y*r),t.w=u(s.y),t},attributeCompression.octPack=function(e,r,n,i){(0,t.assert)(e),(0,t.assert)(r),(0,t.assert)(n),(0,t.assert)(i);var a=y(e),s=y(r),l=p(n,o);return i.x=65536*l.x+a,i.y=65536*l.y+s,i},attributeCompression.octPackFloat=_,attributeCompression.octUnpack=function(e,t,r,n){var i=e.x/65536,a=Math.floor(i),o=65536*(i-a);i=e.y/65536;var s=Math.floor(i),l=65536*(i-s);v(o,t),v(l,r),g(a,s,n)},attributeCompression.zigZagDeltaDecode=function(e,r,n){function i(e){return e>>1^-(1&e)}(0,t.assert)(e),(0,t.assert)(r),(0,t.assert)(e.length===r.length),n&&(0,t.assert)(e.length===n.length);for(var a=0,o=0,s=0,l=0;l<e.length;++l)a+=i(e[l]),o+=i(r[l]),e[l]=a,r[l]=o,n&&(s+=i(n[l]),n[l]=s)};var e=es5$q,t=requireAssert$7(),r=1/256,n=256,i=new e.Vector2,a=new e.Vector3,o=new e.Vector2,s=new e.Vector2,l=new Uint8Array(1);function u(e){return l[0]=e,l[0]}function c(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return(0,e.clamp)(t,0,r)/r*2-1}function d(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Math.round((.5*(0,e.clamp)(t,-1,1)+.5)*r)}function h(e){return e<0?-1:1}function f(r,n,i){(0,t.assert)(r),(0,t.assert)(i);var o=a.from(r);if((0,t.assert)(Math.abs(o.magnitudeSquared()-1)<=e._MathUtils.EPSILON6),i.x=r.x/(Math.abs(r.x)+Math.abs(r.y)+Math.abs(r.z)),i.y=r.y/(Math.abs(r.x)+Math.abs(r.y)+Math.abs(r.z)),r.z<0){var s=i.x,l=i.y;i.x=(1-Math.abs(l))*h(s),i.y=(1-Math.abs(s))*h(l)}return i.x=d(i.x,n),i.y=d(i.y,n),i}function p(e,t){return f(e,255,t)}function m(e,r,n,i){if((0,t.assert)(i),e<0||e>n||r<0||r>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=c(e,n),i.y=c(r,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){var a=i.x;i.x=(1-Math.abs(i.y))*h(a),i.y=(1-Math.abs(a))*h(i.y)}return i.normalize()}function g(e,t,r){return m(e,t,255,r)}function _(e){var t=i.from(e);return 256*t.x+t.y}function y(e){return p(e,o),_(o)}function v(e,r){(0,t.assert)(Number.isFinite(e));var n=e/256,i=Math.floor(n);return g(i,256*(n-i),r)}return attributeCompression}function _typeof$1(e){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(e)}function _toPrimitive(e,t){if("object"!==_typeof$1(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof$1(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof$1(t)?t:String(t)}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"GL",{enumerable:!0,get:function(){return r.GL}}),Object.defineProperty(e,"GLType",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"GL_TYPE",{enumerable:!0,get:function(){return r.GL_TYPE}}),Object.defineProperty(e,"compressTextureCoordinates",{enumerable:!0,get:function(){return c.compressTextureCoordinates}}),Object.defineProperty(e,"computeVertexNormals",{enumerable:!0,get:function(){return s.computeVertexNormals}}),Object.defineProperty(e,"concatTypedArrays",{enumerable:!0,get:function(){return u.concatTypedArrays}}),Object.defineProperty(e,"decodeRGB565",{enumerable:!0,get:function(){return l.decodeRGB565}}),Object.defineProperty(e,"decompressTextureCoordinates",{enumerable:!0,get:function(){return c.decompressTextureCoordinates}}),Object.defineProperty(e,"encodeRGB565",{enumerable:!0,get:function(){return l.encodeRGB565}}),Object.defineProperty(e,"isGeometry",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"makeAttributeIterator",{enumerable:!0,get:function(){return a.makeAttributeIterator}}),Object.defineProperty(e,"makePrimitiveIterator",{enumerable:!0,get:function(){return o.makePrimitiveIterator}}),Object.defineProperty(e,"octDecode",{enumerable:!0,get:function(){return c.octDecode}}),Object.defineProperty(e,"octDecodeFloat",{enumerable:!0,get:function(){return c.octDecodeFloat}}),Object.defineProperty(e,"octDecodeFromVector4",{enumerable:!0,get:function(){return c.octDecodeFromVector4}}),Object.defineProperty(e,"octDecodeInRange",{enumerable:!0,get:function(){return c.octDecodeInRange}}),Object.defineProperty(e,"octEncode",{enumerable:!0,get:function(){return c.octEncode}}),Object.defineProperty(e,"octEncodeFloat",{enumerable:!0,get:function(){return c.octEncodeFloat}}),Object.defineProperty(e,"octEncodeInRange",{enumerable:!0,get:function(){return c.octEncodeInRange}}),Object.defineProperty(e,"octEncodeToVector4",{enumerable:!0,get:function(){return c.octEncodeToVector4}}),Object.defineProperty(e,"octPack",{enumerable:!0,get:function(){return c.octPack}}),Object.defineProperty(e,"octPackFloat",{enumerable:!0,get:function(){return c.octPackFloat}}),Object.defineProperty(e,"octUnpack",{enumerable:!0,get:function(){return c.octUnpack}}),Object.defineProperty(e,"zigZagDeltaDecode",{enumerable:!0,get:function(){return c.zigZagDeltaDecode}});var r=constants$5,n=t(requireGlType()),i=t(requireIsGeometry()),a=requireAttributeIterator(),o=requirePrimitiveIterator(),s=requireComputeVertexNormals(),l=requireRgb565(),u=requireTypedArrayUtils$1(),c=requireAttributeCompression()}(es5$k);class Tile3DFeatureTable{constructor(e,t){_defineProperty(this,"json",void 0),_defineProperty(this,"buffer",void 0),_defineProperty(this,"featuresLength",0),_defineProperty(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:es5$k.GL.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=es5$k.GLType.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,i){const a=this.json[e];if(!a)return a;const o=this.getPropertyArray(e,t,r);if(1===r)return o[n];for(let e=0;e<r;++e)i[e]=o[r*n+e];return i}_getTypedArrayFromBinary(e,t,r,n,i){const a=this._cachedTypedArrays;let o=a[e];return o||(o=es5$k.GLType.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[e]=o),o}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let i=n[e];return i||(i=es5$k.GLType.createTypedArray(t,r),n[e]=i),i}}const COMPONENTS_PER_ATTRIBUTE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},UNPACKER={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},PACKER={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};function createTypedArrayFromAccessor(e,t,r,n){const{componentType:i}=e;es5$t.assert(e.componentType);const a="string"==typeof i?es5$k.GLType.fromName(i):i,o=COMPONENTS_PER_ATTRIBUTE[e.type],s=UNPACKER[e.type],l=PACKER[e.type];return{values:es5$k.GLType.createTypedArray(a,t,r+=e.byteOffset,o*n),type:a,size:o,unpacker:s,packer:l}}const defined$1=e=>void 0!==e;function initializeHierarchy(e,t,r){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?initializeHierarchyValues(n,r):null}function initializeHierarchyValues(e,t){let r,n,i;const a=e.instancesLength,o=e.classes;let s,l=e.classIds,u=e.parentCounts,c=e.parentIds,d=a;if(defined$1(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,a)),defined$1(u))for(defined$1(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,a)),s=new Uint16Array(a),d=0,r=0;r<a;++r)s[r]=d,d+=u[r];defined$1(c)&&defined$1(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,d));const h=o.length;for(r=0;r<h;++r){const e=o[r].instances,n=getBinaryProperties(o[r].length,e,t);o[r].instances=combine(n,e)}const f=new Array(h).fill(0),p=new Uint16Array(a);for(r=0;r<a;++r)n=l[r],p[r]=f[n],++f[n];const m={classes:o,classIds:l,classIndexes:p,parentCounts:u,parentIndexes:s,parentIds:c};return validateHierarchy(m),m}function traverseHierarchy(e,t,r){if(!e)return;const n=e.parentCounts;return e.parentIds?r(e,t):n>0?traverseHierarchyMultipleParents(e,t,r):traverseHierarchySingleParent(e,t,r)}function traverseHierarchyMultipleParents(e,t,r){const n=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=scratchVisited;o.length=Math.max(o.length,e.classIds.length);const s=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(o[t=l.pop()]===s)continue;o[t]=s;const u=r(e,t);if(defined$1(u))return u;const c=n[t],d=a[t];for(let e=0;e<c;++e){const r=i[d+e];r!==t&&l.push(r)}}return null}function traverseHierarchySingleParent(e,t,r){let n=!0;for(;n;){const i=r(e,t);if(defined$1(i))return i;const a=e.parentIds[t];n=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}function validateHierarchy(e){const t=e.classIds.length;for(let r=0;r<t;++r)validateInstance(e,r,stack)}function validateInstance(e,t,r){const n=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=e.classIds.length;if(!defined$1(i))return;assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);const s=defined$1(n)?n[t]:1,l=defined$1(n)?a[t]:t;for(let n=0;n<s;++n){const a=i[l+n];a!==t&&validateInstance(e,a,r)}r.pop(t)}function defined(e){return null!=e}const clone=(e,t)=>e,IGNORED_PROPERTY_FIELDS={HIERARCHY:!0,extensions:!0,extras:!0};class Tile3DBatchTableParser{constructor(e,t,r){var n;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_defineProperty(this,"json",void 0),_defineProperty(this,"binary",void 0),_defineProperty(this,"featureCount",void 0),_defineProperty(this,"_extensions",void 0),_defineProperty(this,"_properties",void 0),_defineProperty(this,"_binaryProperties",void 0),_defineProperty(this,"_hierarchy",void 0),es5$t.assert(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=(null===(n=this.json)||void 0===n?void 0:n.extensions)||{},this._properties={};for(const e in this.json)IGNORED_PROPERTY_FIELDS[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=initializeHierarchy(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),es5$t.assert("string"==typeof t,t),!!this._hierarchy&&defined(traverseHierarchy(this._hierarchy,e,((e,r)=>e.classes[e.classIds[r]].name===t)))}isExactClass(e,t){return es5$t.assert("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[e]].name}hasProperty(e,t){return this._checkBatchId(e),es5$t.assert("string"==typeof t,t),defined(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=defined(t)?t:[]).length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),es5$t.assert("string"==typeof t,t),this._binaryProperties){const r=this._binaryProperties[t];if(defined(r))return this._getBinaryProperty(r,e)}const r=this._properties[t];if(defined(r))return clone(r[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(defined(r))return r}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),es5$t.assert("string"==typeof t,t),this._binaryProperties){const n=this._binaryProperties[t];if(n)return void this._setBinaryProperty(n,e,r)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let i=this._properties[t];defined(i)||(this._properties[t]=new Array(n),i=this._properties[t]),i[e]=clone(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._initializeBinaryProperty(t,this._properties[t]);r&&(e=e||{},e[t]=r)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;es5$t.assert(this.binary,"Property ".concat(e," requires a batch table binary.")),es5$t.assert(r.type,"Property ".concat(e," requires a type."));const n=createTypedArrayFromAccessor(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=traverseHierarchy(this._hierarchy,e,((e,r)=>defined(e.classes[e.classIds[r]].instances[t])));return defined(r)}_getPropertyNamesInHierarchy(e,t){traverseHierarchy(this._hierarchy,e,((e,r)=>{const n=e.classes[e.classIds[r]].instances;for(const e in n)n.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e)}))}_getHierarchyProperty(e,t){return traverseHierarchy(this._hierarchy,e,((e,r)=>{const n=e.classIndexes[r],i=e.classes[e.classIds[r]].instances[t];return defined(i)?defined(i.typedArray)?this._getBinaryProperty(i,n):clone(i[n]):null}))}_setHierarchyProperty(e,t,r,n){const i=traverseHierarchy(this._hierarchy,t,((e,i)=>{const a=e.classIndexes[i],o=e.classes[e.classIds[i]].instances[r];return!!defined(o)&&(es5$t.assert(i===t,'Inherited property "'.concat(r,'" is read-only.')),defined(o.typedArray)?this._setBinaryProperty(o,a,n):o[a]=clone(n),!0)}));return defined(i)}}const SIZEOF_UINT32$1=4;function parse3DTileHeaderSync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,e.version=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,e.byteLength=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}const SIZEOF_UINT32=4,DEPRECATION_WARNING="b3dm tile in legacy format.";function parse3DTileTablesHeaderSync(e,t,r){const n=new DataView(t);let i;e.header=e.header||{};let a=n.getUint32(r,!0),o=n.getUint32(r+=SIZEOF_UINT32,!0),s=n.getUint32(r+=SIZEOF_UINT32,!0),l=n.getUint32(r+=SIZEOF_UINT32,!0);return r+=SIZEOF_UINT32,s>=570425344?(r-=2*SIZEOF_UINT32,i=a,s=o,l=0,a=0,o=0,console.warn(DEPRECATION_WARNING)):l>=570425344&&(r-=SIZEOF_UINT32,i=s,s=a,l=o,a=0,o=0,console.warn(DEPRECATION_WARNING)),e.header.featureTableJsonByteLength=a,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=s,e.header.batchTableBinaryByteLength=l,e.header.batchLength=i,r}function parse3DTileTablesSync(e,t,r,n){return parse3DTileBatchTable(e,t,r=parse3DTileFeatureTable(e,t,r))}function parse3DTileFeatureTable(e,t,r,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:a,batchLength:o}=e.header;if(e.featureTableJson={BATCH_LENGTH:o||0},i>0){const n=getStringFromArrayBuffer(t,r,i);e.featureTableJson=JSON.parse(n)}return r+=i,e.featureTableBinary=new Uint8Array(t,r,a),r+a}function parse3DTileBatchTable(e,t,r,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:a}=e.header;if(i>0){const n=getStringFromArrayBuffer(t,r,i);e.batchTableJson=JSON.parse(n),r+=i,a>0&&(e.batchTableBinary=new Uint8Array(t,r,a),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=a)}return r}function normalize3DTileColorAttribute(e,t,r){if(!(t||e&&e.batchIds&&r))return null;const{batchIds:n,isRGB565:i,pointCount:a}=e;if(n&&r){const e=new Uint8ClampedArray(3*a);for(let t=0;t<a;t++){const i=r.getProperty(n[t],"dimensions").map((e=>255*e));e[3*t]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]}return{type:es5$k.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(i){const e=new Uint8ClampedArray(3*a);for(let r=0;r<a;r++){const n=es5$k.decodeRGB565(t[r]);e[3*r]=n[0],e[3*r+1]=n[1],e[3*r+2]=n[2]}return{type:es5$k.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*a?{type:es5$k.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:es5$k.GL.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const scratchNormal=new es5$q.Vector3;function normalize3DTileNormalAttribute(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(3*e.pointsLength);for(let n=0;n<e.pointsLength;n++)es5$k.octDecode(t[2*n],t[2*n+1],scratchNormal),scratchNormal.toArray(r,3*n);return{type:es5$k.GL.FLOAT,size:2,value:r}}return{type:es5$k.GL.FLOAT,size:2,value:t}}function normalize3DTilePositionAttribute(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,decodeQuantizedPositions(e,t)):{type:es5$k.GL.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function decodeQuantizedPositions(e,t){const r=new es5$q.Vector3,n=new Float32Array(3*e.pointCount);for(let i=0;i<e.pointCount;i++)r.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*i);return n}async function parsePointCloud3DTile(e,t,r,n,i){r=parse3DTileTablesSync(e,t,r=parse3DTileTablesHeaderSync(e,t,r=parse3DTileHeaderSync(e,t,r))),initializeTile(e);const{featureTable:a,batchTable:o}=parsePointCloudTables(e);return await parseDraco(e,a,o,n,i),parsePositions(e,a,n),parseColors(e,a,o),parseNormals(e,a),r}function initializeTile(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function parsePointCloudTables(e){const t=new Tile3DFeatureTable(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");return t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",es5$k.GL.FLOAT,3),{featureTable:t,batchTable:parseBatchIds(e,t)}}function parsePositions(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",es5$k.GL.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",es5$k.GL.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",es5$k.GL.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",es5$k.GL.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=normalize3DTilePositionAttribute(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function parseColors(e,t,r){if(!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",es5$k.GL.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",es5$k.GL.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",es5$k.GL.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=normalize3DTileColorAttribute(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",es5$k.GL.UNSIGNED_BYTE,4))}function parseNormals(e,t){if(!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",es5$k.GL.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",es5$k.GL.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=normalize3DTileNormalAttribute(e,r)}}function parseBatchIds(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",es5$k.GL.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:a}=e;r=new Tile3DBatchTableParser(i,a,n)}return r}async function parseDraco(e,t,r,n,i){let a,o,s;const l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(s=l.properties);const u=t.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;const t=u.byteOffset,r=u.byteLength;if(!o||!Number.isFinite(t)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");a=e.featureTableBinary.slice(t,t+r),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!a)return!0;const c={buffer:a,properties:{...o,...s},featureTableProperties:o,batchTableProperties:s,dequantizeInShader:!1};return await loadDraco(e,c,n,i)}async function loadDraco(e,t,r,n){const{parse:i}=n,a={...r,draco:{...r.draco,extraAttributes:t.batchTableProperties||{}}};delete a["3d-tiles"];const o=await i(t.buffer,es5$m.DracoLoader,a),s=o.attributes.POSITION&&o.attributes.POSITION.value,l=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,u=o.attributes.NORMAL&&o.attributes.NORMAL.value,c=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,d=u&&o.attributes.NORMAL.value.quantization;if(s&&o.attributes.POSITION.value.quantization){const t=o.POSITION.data.quantization,r=t.range;e.quantizedVolumeScale=new es5$q.Vector3(r,r,r),e.quantizedVolumeOffset=new es5$q.Vector3(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}d&&(e.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const h={};if(t.batchTableProperties)for(const e of Object.keys(t.batchTableProperties))o.attributes[e]&&o.attributes[e].value&&(h[e.toLowerCase()]=o.attributes[e].value);e.attributes={positions:s,colors:normalize3DTileColorAttribute(e,l,void 0),normals:u,batchIds:c,...h}}var es5$j={},gltfLoader={},version$3={},hasRequiredVersion$3;function requireVersion$3(){return hasRequiredVersion$3||(hasRequiredVersion$3=1,Object.defineProperty(version$3,"__esModule",{value:!0}),version$3.VERSION=void 0,version$3.VERSION="3.4.14"),version$3}var parseGltf={},es5$i={},version$2={},hasRequiredVersion$2;function requireVersion$2(){return hasRequiredVersion$2||(hasRequiredVersion$2=1,Object.defineProperty(version$2,"__esModule",{value:!0}),version$2.VERSION=void 0,version$2.VERSION="3.4.14"),version$2}var basisLoader={},parseBasis={},basisModuleLoader={},hasRequiredBasisModuleLoader;function requireBasisModuleLoader(){if(hasRequiredBasisModuleLoader)return basisModuleLoader;hasRequiredBasisModuleLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(basisModuleLoader,"__esModule",{value:!0}),basisModuleLoader.loadBasisEncoderModule=function(e){return p.apply(this,arguments)},basisModuleLoader.loadBasisTrascoderModule=function(e){return c.apply(this,arguments)};var t,r,n=e(requireRegenerator()),i=e(requireSlicedToArray()),a=e(requireAsyncToGenerator()),o=requireEs5$b(),s="3.4.14",l="https://unpkg.com/@loaders.gl/textures@".concat(s,"/dist/libs/basis_encoder.wasm"),u="https://unpkg.com/@loaders.gl/textures@".concat(s,"/dist/libs/basis_encoder.js");function c(){return c=(0,a.default)(n.default.mark((function e(r){var i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=r.modules||{}).basis){e.next=3;break}return e.abrupt("return",i.basis);case 3:return t=t||d(r),e.next=6,t;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e){return h.apply(this,arguments)}function h(){return(h=(0,a.default)(n.default.mark((function e(t){var r,a,s;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,a=null,e.t0=Promise,e.next=5,(0,o.loadLibrary)("basis_transcoder.js","textures",t);case 5:return e.t1=e.sent,e.next=8,(0,o.loadLibrary)("basis_transcoder.wasm","textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return s=(0,i.default)(e.sent,2),a=s[1],r=(r=s[0])||globalThis.BASIS,e.next=19,f(r,a);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){var r={};return t&&(r.wasmBinary=t),new Promise((function(t){e(r).then((function(e){var r=e.BasisFile;(0,e.initializeBasis)(),t({BasisFile:r})}))}))}function p(){return p=(0,a.default)(n.default.mark((function e(t){var i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t.modules||{}).basisEncoder){e.next=3;break}return e.abrupt("return",i.basisEncoder);case 3:return r=r||m(t),e.next=6,r;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=(0,a.default)(n.default.mark((function e(t){var r,a,s;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,a=null,e.t0=Promise,e.next=5,(0,o.loadLibrary)(u,"textures",t);case 5:return e.t1=e.sent,e.next=8,(0,o.loadLibrary)(l,"textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return s=(0,i.default)(e.sent,2),a=s[1],r=(r=s[0])||globalThis.BASIS,e.next=19,_(r,a);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){var r={};return t&&(r.wasmBinary=t),new Promise((function(t){e(r).then((function(e){var r=e.BasisFile,n=e.KTX2File,i=e.BasisEncoder;(0,e.initializeBasis)(),t({BasisFile:r,KTX2File:n,BasisEncoder:i})}))}))}return basisModuleLoader}var glExtensions={},hasRequiredGlExtensions;function requireGlExtensions(){return hasRequiredGlExtensions||(hasRequiredGlExtensions=1,Object.defineProperty(glExtensions,"__esModule",{value:!0}),glExtensions.GL_EXTENSIONS_CONSTANTS=void 0,glExtensions.GL_EXTENSIONS_CONSTANTS={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919}),glExtensions}var textureFormats$1={},hasRequiredTextureFormats$1;function requireTextureFormats$1(){if(hasRequiredTextureFormats$1)return textureFormats$1;function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}hasRequiredTextureFormats$1=1,Object.defineProperty(textureFormats$1,"__esModule",{value:!0}),textureFormats$1.getSupportedGPUTextureFormats=function(i){if(!n){i=i||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,n=new Set;var a,o=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;for(var l in r)i&&i.getExtension("".concat(s).concat(l))&&n.add(r[l])}}catch(e){o.e(e)}finally{o.f()}}return n};var t=["","WEBKIT_","MOZ_"],r={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},n=null;return textureFormats$1}var parseKtx={},ktxParse={},hasRequiredKtxParse;function requireKtxParse(){if(hasRequiredKtxParse)return ktxParse;hasRequiredKtxParse=1;var e,t,r,n,i,a,o,s,l=new Uint8Array([0]),u=[171,75,84,88,32,50,48,187,13,10,26,10];!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(e||(e={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(t||(t={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(r||(r={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(n||(n={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(i||(i={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(a||(a={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(o||(o={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(s||(s={}));var c=function(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=e.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:t.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:r.UNSPECIFIED,colorPrimaries:n.SRGB,transferFunction:n.SRGB,flags:a.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null},d=function(){function e(e,t,r,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}var t=e.prototype;return t._nextUint8=function(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e},t._nextUint16=function(){var e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e},t._nextUint32=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e},t._nextUint64=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),r=e+Math.pow(2,32)*t;return this._offset+=8,r},t._skip=function(e){return this._offset+=e,this},t._scan=function(e,t){void 0===t&&(t=0);for(var r=this._offset,n=0;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)},e}();function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function m(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}function g(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function _(e){for(var t,r=0,n=p(e);!(t=n()).done;)r+=t.value.byteLength;for(var i,a=new Uint8Array(r),o=0,s=p(e);!(i=s()).done;){var l=i.value;a.set(new Uint8Array(l),o),o+=l.byteLength}return a}var y={keepWriter:!1};return ktxParse.KTX2Container=c,ktxParse.read=function(e){var t=new Uint8Array(e.buffer,e.byteOffset,u.length);if(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||t[4]!==u[4]||t[5]!==u[5]||t[6]!==u[6]||t[7]!==u[7]||t[8]!==u[8]||t[9]!==u[9]||t[10]!==u[10]||t[11]!==u[11])throw new Error("Missing KTX 2.0 identifier.");var r=new c,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new d(e,u.length,n,!0);r.vkFormat=i._nextUint32(),r.typeSize=i._nextUint32(),r.pixelWidth=i._nextUint32(),r.pixelHeight=i._nextUint32(),r.pixelDepth=i._nextUint32(),r.layerCount=i._nextUint32(),r.faceCount=i._nextUint32();var a=i._nextUint32();r.supercompressionScheme=i._nextUint32();for(var o=i._nextUint32(),s=i._nextUint32(),l=i._nextUint32(),h=i._nextUint32(),f=i._nextUint64(),p=i._nextUint64(),m=new d(e,u.length+n,3*a*8,!0),_=0;_<a;_++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});for(var y=new d(e,o,s,!0),v={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:{x:y._nextUint8()+1,y:y._nextUint8()+1,z:y._nextUint8()+1,w:y._nextUint8()+1},bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},b=(v.descriptorBlockSize/4-6)/4,x=0;x<b;x++)v.samples[x]={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelID:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:y._nextUint32(),sampleUpper:y._nextUint32()};r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(v);for(var T=new d(e,l,h,!0);T._offset<h;){var w=T._nextUint32(),E=T._scan(w),A=g(E),S=T._scan(w-E.byteLength);r.keyValue[A]=A.match(/^ktx/i)?g(S):S,w%4&&T._skip(4-w%4)}if(p<=0)return r;for(var P=new d(e,f,p,!0),M=P._nextUint16(),R=P._nextUint16(),C=P._nextUint32(),O=P._nextUint32(),L=P._nextUint32(),I=P._nextUint32(),D=[],k=0;k<a;k++)D.push({imageFlags:P._nextUint32(),rgbSliceByteOffset:P._nextUint32(),rgbSliceByteLength:P._nextUint32(),alphaSliceByteOffset:P._nextUint32(),alphaSliceByteLength:P._nextUint32()});var B=f+P._offset,F=B+C,N=F+O,q=N+L,U=new Uint8Array(e.buffer,e.byteOffset+B,C),j=new Uint8Array(e.buffer,e.byteOffset+F,O),G=new Uint8Array(e.buffer,e.byteOffset+N,L),z=new Uint8Array(e.buffer,e.byteOffset+q,I);return r.globalData={endpointCount:M,selectorCount:R,imageDescs:D,endpointsData:U,selectorsData:j,tablesData:G,extendedData:z},r},ktxParse.write=function(e,r){void 0===r&&(r={}),r=h({},y,r);var n=new ArrayBuffer(0);if(e.globalData){var i=new ArrayBuffer(20+5*e.globalData.imageDescs.length*4),a=new DataView(i);a.setUint16(0,e.globalData.endpointCount,!0),a.setUint16(2,e.globalData.selectorCount,!0),a.setUint32(4,e.globalData.endpointsData.byteLength,!0),a.setUint32(8,e.globalData.selectorsData.byteLength,!0),a.setUint32(12,e.globalData.tablesData.byteLength,!0),a.setUint32(16,e.globalData.extendedData.byteLength,!0);for(var o=0;o<e.globalData.imageDescs.length;o++){var s=e.globalData.imageDescs[o];a.setUint32(20+5*o*4+0,s.imageFlags,!0),a.setUint32(20+5*o*4+4,s.rgbSliceByteOffset,!0),a.setUint32(20+5*o*4+8,s.rgbSliceByteLength,!0),a.setUint32(20+5*o*4+12,s.alphaSliceByteOffset,!0),a.setUint32(20+5*o*4+16,s.alphaSliceByteLength,!0)}n=_([i,e.globalData.endpointsData,e.globalData.selectorsData,e.globalData.tablesData,e.globalData.extendedData])}var c=[],d=e.keyValue;for(var f in r.keepWriter||(d=h({},e.keyValue,{KTXwriter:"KTX-Parse v0.0.4"})),d){var p=d[f],g=m(f),v="string"==typeof p?m(p):p,b=g.byteLength+1+v.byteLength+1,x=b%4?4-b%4:0;c.push(_([new Uint32Array([b]),g,l,v,l,new Uint8Array(x).fill(0)]))}var T=_(c),w=new ArrayBuffer(44),E=new DataView(w);if(1!==e.dataFormatDescriptor.length||e.dataFormatDescriptor[0].descriptorType!==t.BASICFORMAT)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");var A=e.dataFormatDescriptor[0];E.setUint32(0,44,!0),E.setUint16(4,A.vendorId,!0),E.setUint16(6,A.descriptorType,!0),E.setUint16(8,A.versionNumber,!0),E.setUint16(10,A.descriptorBlockSize,!0),E.setUint8(12,A.colorModel),E.setUint8(13,A.colorPrimaries),E.setUint8(14,A.transferFunction),E.setUint8(15,A.flags),E.setUint8(16,A.texelBlockDimension.x-1),E.setUint8(17,A.texelBlockDimension.y-1),E.setUint8(18,A.texelBlockDimension.z-1),E.setUint8(19,A.texelBlockDimension.w-1);for(var S=0;S<8;S++)E.setUint8(20+S,A.bytesPlane[S]);for(var P=0;P<A.samples.length;P++){var M=A.samples[P],R=28+16*P;E.setUint16(R+0,M.bitOffset,!0),E.setUint8(R+2,M.bitLength),E.setUint8(R+3,M.channelID),E.setUint8(R+4,M.samplePosition[0]),E.setUint8(R+5,M.samplePosition[1]),E.setUint8(R+6,M.samplePosition[2]),E.setUint8(R+7,M.samplePosition[3]),E.setUint32(R+8,M.sampleLower,!0),E.setUint32(R+12,M.sampleUpper,!0)}var C=u.length+68+3*e.levels.length*8,O=C+w.byteLength,L=O+T.byteLength;L%8&&(L+=8-L%8);for(var I=[],D=new DataView(new ArrayBuffer(3*e.levels.length*8)),k=L+n.byteLength,B=0;B<e.levels.length;B++){var F=e.levels[B];I.push(F.levelData),D.setBigUint64(24*B+0,BigInt(k),!0),D.setBigUint64(24*B+8,BigInt(F.levelData.byteLength),!0),D.setBigUint64(24*B+16,BigInt(F.uncompressedByteLength),!0),k+=F.levelData.byteLength}var N=new ArrayBuffer(68),q=new DataView(N);return q.setUint32(0,e.vkFormat,!0),q.setUint32(4,e.typeSize,!0),q.setUint32(8,e.pixelWidth,!0),q.setUint32(12,e.pixelHeight,!0),q.setUint32(16,e.pixelDepth,!0),q.setUint32(20,e.layerCount,!0),q.setUint32(24,e.faceCount,!0),q.setUint32(28,e.levels.length,!0),q.setUint32(32,e.supercompressionScheme,!0),q.setUint32(36,C,!0),q.setUint32(40,w.byteLength,!0),q.setUint32(44,O,!0),q.setUint32(48,T.byteLength,!0),q.setBigUint64(52,BigInt(L),!0),q.setBigUint64(60,BigInt(n.byteLength),!0),new Uint8Array(_([new Uint8Array(u).buffer,N,D.buffer,w,T,new ArrayBuffer(L-(O+T.byteLength)),n].concat(I)))},ktxParse}var extractMipmapImages={},hasRequiredExtractMipmapImages;function requireExtractMipmapImages(){if(hasRequiredExtractMipmapImages)return extractMipmapImages;function e(e,t,r,n){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer,e.byteOffset+r,n)}function t(e,t,r,n,i){return Array.isArray(n)?e.sizeFunction(n[i]):e.sizeFunction(t,r)}return hasRequiredExtractMipmapImages=1,Object.defineProperty(extractMipmapImages,"__esModule",{value:!0}),extractMipmapImages.extractMipmapImages=function(r,n){for(var i=new Array(n.mipMapLevels),a=n.width,o=n.height,s=0,l=0;l<n.mipMapLevels;++l){var u=t(n,a,o,r,l),c=e(r,l,s,u);i[l]={compressed:!0,format:n.internalFormat,data:c,width:a,height:o,levelSize:u},a=Math.max(1,a>>1),o=Math.max(1,o>>1),s+=u}return i},extractMipmapImages}var ktxFormatHelper={},hasRequiredKtxFormatHelper,hasRequiredParseKtx,hasRequiredParseBasis,hasRequiredBasisLoader;function requireKtxFormatHelper(){if(hasRequiredKtxFormatHelper)return ktxFormatHelper;hasRequiredKtxFormatHelper=1,Object.defineProperty(ktxFormatHelper,"__esModule",{value:!0}),ktxFormatHelper.mapVkFormatToWebGL=function(e){return t[e]};var e=requireGlExtensions(),t={131:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT,132:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RED_RGTC1_EXT,140:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RED_GREEN_RGTC2_EXT,142:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB8_ETC2,148:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ETC2,149:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA8_ETC2_EAC,152:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_R11_EAC,154:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SIGNED_R11_EAC,155:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RG11_EAC,156:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SIGNED_RG11_EAC,157:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4x4_KHR,158:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5x4_KHR,160:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5x5_KHR,162:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6x5_KHR,164:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6x6_KHR,166:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x5_KHR,168:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x6_KHR,170:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x8_KHR,172:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x5_KHR,174:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x6_KHR,176:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x8_KHR,178:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x10_KHR,180:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12x10_KHR,182:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12x12_KHR,184:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12x12_KHR};return ktxFormatHelper}function requireParseKtx(){if(hasRequiredParseKtx)return parseKtx;hasRequiredParseKtx=1,Object.defineProperty(parseKtx,"__esModule",{value:!0}),parseKtx.isKTX=function(e){var t=new Uint8Array(e);return!(t.byteLength<n.length||t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||t[4]!==n[4]||t[5]!==n[5]||t[6]!==n[6]||t[7]!==n[7]||t[8]!==n[8]||t[9]!==n[9]||t[10]!==n[10]||t[11]!==n[11])},parseKtx.parseKTX=function(n){var i=new Uint8Array(n),a=(0,e.read)(i),o=Math.max(1,a.levels.length),s=a.pixelWidth,l=a.pixelHeight,u=(0,r.mapVkFormatToWebGL)(a.vkFormat);return(0,t.extractMipmapImages)(a.levels,{mipMapLevels:o,width:s,height:l,sizeFunction:function(e){return e.uncompressedByteLength},internalFormat:u})};var e=requireKtxParse(),t=requireExtractMipmapImages(),r=requireKtxFormatHelper(),n=[171,75,84,88,32,50,48,187,13,10,26,10];return parseKtx}function requireParseBasis(){if(hasRequiredParseBasis)return parseBasis;hasRequiredParseBasis=1;var e=interopRequireDefaultExports;Object.defineProperty(parseBasis,"__esModule",{value:!0}),parseBasis.default=function(e,t){return u.apply(this,arguments)},parseBasis.selectSupportedBasisFormat=m;var t=e(requireRegenerator()),r=e(_typeofExports),n=e(requireAsyncToGenerator()),i=requireBasisModuleLoader(),a=requireGlExtensions(),o=requireTextureFormats$1(),s=requireParseKtx(),l={etc1:{basisFormat:0,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:a.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function u(){return(u=(0,n.default)(t.default.mark((function e(r,n){var a;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("auto"!==n.basis.containerFormat){e.next=11;break}if(!(0,s.isKTX)(r)){e.next=6;break}return e.next=4,(0,i.loadBasisEncoderModule)(n);case 4:return e.abrupt("return",h(e.sent.KTX2File,r,n));case 6:return e.next=8,(0,i.loadBasisTrascoderModule)(n);case 8:case 24:return e.abrupt("return",c(e.sent.BasisFile,r,n));case 11:e.t0=n.basis.module,e.next="encoder"===e.t0?14:22;break;case 14:return e.next=16,(0,i.loadBasisEncoderModule)(n);case 16:a=e.sent,e.t1=n.basis.containerFormat,e.next="ktx2"===e.t1?20:21;break;case 20:return e.abrupt("return",h(a.KTX2File,r,n));case 21:return e.abrupt("return",c(a.BasisFile,r,n));case 22:return e.next=24,(0,i.loadBasisTrascoderModule)(n);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t,r){var n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");for(var i=n.getNumImages(),a=[],o=0;o<i;o++){for(var s=n.getNumLevels(o),l=[],u=0;u<s;u++)l.push(d(n,o,u,r));a.push(l)}return a}finally{n.close(),n.delete()}}function d(e,t,r,n){var i=e.getImageWidth(t,r),a=e.getImageHeight(t,r),o=e.getHasAlpha(),s=p(n,o),l=s.compressed,u=s.format,c=s.basisFormat,d=e.getImageTranscodedSizeInBytes(t,r,c),h=new Uint8Array(d);if(!e.transcodeImage(h,t,r,c,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:a,data:h,compressed:l,format:u,hasAlpha:o}}function h(e,t,r){var n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");for(var i=n.getLevels(),a=[],o=0;o<i;o++){a.push(f(n,o,r));break}return[a]}finally{n.close(),n.delete()}}function f(e,t,r){var n=e.getImageLevelInfo(t,0,0),i=n.alphaFlag,a=n.height,o=n.width,s=p(r,i),l=s.compressed,u=s.format,c=s.basisFormat,d=e.getImageTranscodedSizeInBytes(t,0,0,c),h=new Uint8Array(d);if(!e.transcodeImage(h,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:a,data:h,compressed:l,levelSize:d,hasAlpha:i,format:u}}function p(e,t){var n=e&&e.basis&&e.basis.format;return"auto"===n&&(n=m()),"object"===(0,r.default)(n)&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),l[n]}function m(){var e=(0,o.getSupportedGPUTextureFormats)();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}return parseBasis}function requireBasisLoader(){if(hasRequiredBasisLoader)return basisLoader;hasRequiredBasisLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(basisLoader,"__esModule",{value:!0}),basisLoader._TypecheckBasisWorkerLoader=basisLoader._TypecheckBasisLoader=basisLoader.BasisWorkerLoader=basisLoader.BasisLoader=void 0;var t=e(requireDefineProperty()),r=requireEs5$b(),n=requireVersion$2(),i=e(requireParseBasis());function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s={name:"Basis",id:r.isBrowser?"basis":"basis-nodejs",module:"textures",version:n.VERSION,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}};basisLoader.BasisWorkerLoader=s;var l=o(o({},s),{},{parse:i.default});return basisLoader.BasisLoader=l,basisLoader._TypecheckBasisWorkerLoader=s,basisLoader._TypecheckBasisLoader=l,basisLoader}var compressedTextureLoader={},parseCompressedTexture={},parseDds={},hasRequiredParseDds;function requireParseDds(){if(hasRequiredParseDds)return parseDds;hasRequiredParseDds=1,Object.defineProperty(parseDds,"__esModule",{value:!0}),parseDds.getDxt1LevelSize=o,parseDds.getDxtXLevelSize=s,parseDds.isDDS=function(e){return new Uint32Array(e,0,n.HEADER_LENGTH)[n.MAGIC_NUMBER_INDEX]===n.MAGIC_NUMBER},parseDds.parseDDS=function(t){var o=new Int32Array(t,0,n.HEADER_LENGTH),s=o[n.HEADER_PF_FOURCC_INDEX];(0,e.assert)(Boolean(o[n.HEADER_PF_FLAGS_INDEX]&n.DDPF_FOURCC),"DDS: Unsupported format, must contain a FourCC code");var l,u=(l=s,String.fromCharCode(255&l,l>>8&255,l>>16&255,l>>24&255)),c=i[u],d=a[u];(0,e.assert)(c&&d,"DDS: Unknown pixel format ".concat(s));var h=1;o[n.HEADER_FLAGS_INDEX]&n.DDSD_MIPMAPCOUNT&&(h=Math.max(1,o[n.MIPMAPCOUNT_INDEX]));var f=o[n.HEADER_WIDTH_INDEX],p=o[n.HEADER_HEIGHT_INDEX],m=new Uint8Array(t,o[n.HEADER_SIZE_INDEX]+4);return(0,r.extractMipmapImages)(m,{mipMapLevels:h,width:f,height:p,sizeFunction:d,internalFormat:c})};var e=es5$t,t=requireGlExtensions(),r=requireExtractMipmapImages(),n={MAGIC_NUMBER:542327876,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,HEADER_SIZE_INDEX:1,HEADER_FLAGS_INDEX:2,HEADER_HEIGHT_INDEX:3,HEADER_WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,HEADER_PF_FLAGS_INDEX:20,HEADER_PF_FOURCC_INDEX:21,DDSD_MIPMAPCOUNT:131072,DDPF_FOURCC:4},i={DXT1:t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ATC_WEBGL,ATCA:t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:t.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},a={DXT1:o,DXT3:s,DXT5:s,"ATC ":o,ATCA:s,ATCI:s};function o(e,t){return(e+3>>2)*(t+3>>2)*8}function s(e,t){return(e+3>>2)*(t+3>>2)*16}return parseDds}var parsePvr={},hasRequiredParsePvr,hasRequiredParseCompressedTexture,hasRequiredCompressedTextureLoader;function requireParsePvr(){if(hasRequiredParsePvr)return parsePvr;hasRequiredParsePvr=1,Object.defineProperty(parsePvr,"__esModule",{value:!0}),parsePvr.isPVR=function(e){var t=new Uint32Array(e,0,r.HEADER_LENGTH)[r.MAGIC_NUMBER_INDEX];return t===r.MAGIC_NUMBER||t===r.MAGIC_NUMBER_EXTRA},parsePvr.parsePVR=function(e){var a=new Uint32Array(e,0,r.HEADER_LENGTH),o=a[r.PIXEL_FORMAT_INDEX],s=n[o]||[],l=s.length>1&&a[r.COLOUR_SPACE_INDEX]?s[1]:s[0],u=i[o],c=a[r.MIPMAPCOUNT_INDEX],d=a[r.WIDTH_INDEX],h=a[r.HEIGHT_INDEX],f=new Uint8Array(e,r.HEADER_SIZE+a[r.METADATA_SIZE_INDEX]);return(0,t.extractMipmapImages)(f,{mipMapLevels:c,width:d,height:h,sizeFunction:u,internalFormat:l})};var e=requireGlExtensions(),t=requireExtractMipmapImages(),r={MAGIC_NUMBER:55727696,MAGIC_NUMBER_EXTRA:1347834371,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,COLOUR_SPACE_INDEX:4,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12},n={0:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ETC1_WEBGL],7:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB8_ETC2],23:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA8_ETC2_EAC],24:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_R11_EAC],26:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RG11_EAC],27:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4X4_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5X4_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_5X5_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6X5_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_6X6_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8X5_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8X6_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_8X8_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10X5_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10X6_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10X8_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_10X10_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12X10_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_12X12_KHR,e.GL_EXTENSIONS_CONSTANTS.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},i={0:a,1:a,2:o,3:o,6:s,7:s,9:l,11:l,22:s,23:l,24:s,25:s,26:l,27:l,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function a(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function o(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function s(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function l(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}return parsePvr}function requireParseCompressedTexture(){if(hasRequiredParseCompressedTexture)return parseCompressedTexture;hasRequiredParseCompressedTexture=1,Object.defineProperty(parseCompressedTexture,"__esModule",{value:!0}),parseCompressedTexture.parseCompressedTexture=function(n){if((0,e.isKTX)(n))return(0,e.parseKTX)(n);if((0,t.isDDS)(n))return(0,t.parseDDS)(n);if((0,r.isPVR)(n))return(0,r.parsePVR)(n);throw new Error("Texture container format not recognized")};var e=requireParseKtx(),t=requireParseDds(),r=requireParsePvr();return parseCompressedTexture}function requireCompressedTextureLoader(){if(hasRequiredCompressedTextureLoader)return compressedTextureLoader;hasRequiredCompressedTextureLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(compressedTextureLoader,"__esModule",{value:!0}),compressedTextureLoader._TypecheckCompressedTextureWorkerLoader=compressedTextureLoader._TypecheckCompressedTextureLoader=compressedTextureLoader.CompressedTextureWorkerLoader=compressedTextureLoader.CompressedTextureLoader=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireDefineProperty()),i=requireVersion$2(),a=requireParseCompressedTexture(),o=e(requireParseBasis());function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={name:"Texture Containers",id:"compressed-texture",module:"textures",version:i.VERSION,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["image/ktx2","image/ktx","image/vnd-ms.dds","image/x-dds","application/octet-stream"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/",useBasis:!1}}};compressedTextureLoader.CompressedTextureWorkerLoader=u;var c=l(l({},u),{},{parse:function(){var e=(0,r.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n["compressed-texture"].useBasis){e.next=5;break}return n.basis=l(l({format:{alpha:"BC3",noAlpha:"BC1"}},n.basis),{},{containerFormat:"ktx2",module:"encoder"}),e.next=4,(0,o.default)(r,n);case 4:return e.abrupt("return",e.sent[0]);case 5:return e.abrupt("return",(0,a.parseCompressedTexture)(r));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()});return compressedTextureLoader.CompressedTextureLoader=c,compressedTextureLoader._TypecheckCompressedTextureWorkerLoader=u,compressedTextureLoader._TypecheckCompressedTextureLoader=c,compressedTextureLoader}var crunchLoader={},hasRequiredCrunchLoader;function requireCrunchLoader(){if(hasRequiredCrunchLoader)return crunchLoader;hasRequiredCrunchLoader=1,Object.defineProperty(crunchLoader,"__esModule",{value:!0}),crunchLoader._TypecheckCrunchLoader=crunchLoader.CrunchLoader=void 0;var e={id:"crunch",name:"Crunch",module:"textures",version:requireVersion$2().VERSION,worker:!0,extensions:["crn"],mimeTypes:["image/crn","image/x-crn","application/octet-stream"],binary:!0,options:{crunch:{libraryPath:"libs/"}}};return crunchLoader.CrunchLoader=e,crunchLoader._TypecheckCrunchLoader=e,crunchLoader}var npyLoader={},parseNpy={},hasRequiredParseNpy,hasRequiredNpyLoader;function requireParseNpy(){if(hasRequiredParseNpy)return parseNpy;hasRequiredParseNpy=1,Object.defineProperty(parseNpy,"__esModule",{value:!0}),parseNpy.parseNPY=function(e,n){var i;if(!e)return null;var a=function(e){var t,r=e.getUint8(6),n=8;r>=2?(t=e.getUint32(n,!0),n+=4):(t=e.getUint16(n,!0),n+=2);var i=new TextDecoder(r<=2?"latin1":"utf-8"),a=new Uint8Array(e.buffer,n,t),o=i.decode(a);return n+=t,{header:JSON.parse(o.replace(/'/g,'"').replace("False","false").replace("(","[").replace(/,*\),*/g,"]")),headerEndOffset:n}}(new DataView(e)),o=a.header,s=a.headerEndOffset,l=o.descr,u=r[l.slice(1,3)];if(!u)throw new Error("Unimplemented type ".concat(l));var c=(null===(i=o.shape)||void 0===i?void 0:i.reduce((function(e,t){return e*t})))*u.BYTES_PER_ELEMENT;if(e.byteLength<s+c)throw new Error("Buffer overflow");var d=new u(e.slice(s,s+c));if(">"===l[0]&&t||"<"===l[0]&&!t)throw new Error("Incorrect endianness");return{data:d,header:o}};var e,t=(e=new Uint32Array([305419896]),!(18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0])),r={u1:Uint8Array,i1:Int8Array,u2:Uint16Array,i2:Int16Array,u4:Uint32Array,i4:Int32Array,f4:Float32Array,f8:Float64Array};return parseNpy}function requireNpyLoader(){if(hasRequiredNpyLoader)return npyLoader;hasRequiredNpyLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(npyLoader,"__esModule",{value:!0}),npyLoader._TypecheckNPYWorkerLoader=npyLoader._TypecheckNPYLoader=npyLoader.NPYWorkerLoader=npyLoader.NPYLoader=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireDefineProperty()),i=requireVersion$2(),a=requireParseNpy();function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=new Uint8Array([147,78,85,77,80,89]),u={name:"NPY",id:"npy",module:"textures",version:i.VERSION,worker:!0,extensions:["npy"],mimeTypes:[],tests:[l.buffer],options:{npy:{}}};npyLoader.NPYWorkerLoader=u;var c=s(s({},u),{},{parseSync:a.parseNPY,parse:function(){var e=(0,r.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.parseNPY)(r,n));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()});return npyLoader.NPYLoader=c,npyLoader._TypecheckNPYWorkerLoader=u,npyLoader._TypecheckNPYLoader=c,npyLoader}var compressedTextureWriter={},encodeTexture={},hasRequiredEncodeTexture,hasRequiredCompressedTextureWriter;function requireEncodeTexture(){if(hasRequiredEncodeTexture)return encodeTexture;hasRequiredEncodeTexture=1;var e=interopRequireDefaultExports;Object.defineProperty(encodeTexture,"__esModule",{value:!0}),encodeTexture.encodeImageURLToCompressedTextureURL=function(e,t,r){return i.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireEs5$b();function i(){return(i=(0,r.default)(t.default.mark((function e(r,i,a){var o,s;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=["texture-compressor","--type","s3tc","--compression","DXT1","--quality","normal","--input",r,"--output",i],s=new n.ChildProcessProxy,e.next=4,s.start({command:"npx",arguments:o,spawn:a});case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return encodeTexture}function requireCompressedTextureWriter(){if(hasRequiredCompressedTextureWriter)return compressedTextureWriter;hasRequiredCompressedTextureWriter=1,Object.defineProperty(compressedTextureWriter,"__esModule",{value:!0}),compressedTextureWriter._TypecheckCompressedTextureWriter=compressedTextureWriter.CompressedTextureWriter=void 0;var e=requireVersion$2(),t=requireEncodeTexture(),r={name:"DDS Texture Container",id:"dds",module:"textures",version:e.VERSION,extensions:["dds"],options:{texture:{format:"auto",compression:"auto",quality:"auto",mipmap:!1,flipY:!1,toolFlags:""}},encodeURLtoURL:t.encodeImageURLToCompressedTextureURL};return compressedTextureWriter.CompressedTextureWriter=r,compressedTextureWriter._TypecheckCompressedTextureWriter=r,compressedTextureWriter}var ktx2BasisWriter={},encodeKtx2BasisTexture={},hasRequiredEncodeKtx2BasisTexture,hasRequiredKtx2BasisWriter;function requireEncodeKtx2BasisTexture(){if(hasRequiredEncodeKtx2BasisTexture)return encodeKtx2BasisTexture;hasRequiredEncodeKtx2BasisTexture=1;var e=interopRequireDefaultExports;Object.defineProperty(encodeKtx2BasisTexture,"__esModule",{value:!0}),encodeKtx2BasisTexture.encodeKTX2BasisTexture=function(e){return i.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireBasisModuleLoader();function i(){return i=(0,r.default)(t.default.mark((function e(r){var i,a,o,s,l,u,c,d,h,f,p,m,g,_=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0!==(a=(i=_.length>1&&void 0!==_[1]?_[1]:{}).useSRGB)&&a,l=void 0===(s=i.qualityLevel)?10:s,c=void 0!==(u=i.encodeUASTC)&&u,h=void 0!==(d=i.mipmaps)&&d,e.next=4,(0,n.loadBasisEncoderModule)(i);case 4:return f=new(0,e.sent.BasisEncoder),e.prev=7,p=new Uint8Array(r.width*r.height*4),f.setCreateKTX2File(!0),f.setKTX2UASTCSupercompression(!0),f.setKTX2SRGBTransferFunc(!0),f.setSliceSourceImage(0,r.data,r.width,r.height,!1),f.setPerceptual(o),f.setMipSRGB(o),f.setQualityLevel(l),f.setUASTC(c),f.setMipGen(h),m=f.encode(p),g=p.subarray(0,m).buffer,e.abrupt("return",g);case 23:throw e.prev=23,e.t0=e.catch(7),console.error("Basis Universal Supercompressed GPU Texture encoder Error: ",e.t0),e.t0;case 27:return e.prev=27,f.delete(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[7,23,27,30]])}))),i.apply(this,arguments)}return encodeKtx2BasisTexture}function requireKtx2BasisWriter(){if(hasRequiredKtx2BasisWriter)return ktx2BasisWriter;hasRequiredKtx2BasisWriter=1,Object.defineProperty(ktx2BasisWriter,"__esModule",{value:!0}),ktx2BasisWriter._TypecheckKTX2TextureWriter=ktx2BasisWriter.KTX2BasisWriter=void 0;var e=requireVersion$2(),t=requireEncodeKtx2BasisTexture(),r={name:"Basis Universal Supercompressed GPU Texture",id:"ktx2-basis-writer",module:"textures",version:e.VERSION,extensions:["ktx2"],options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1},encode:t.encodeKTX2BasisTexture};return ktx2BasisWriter.KTX2BasisWriter=r,ktx2BasisWriter._TypecheckKTX2TextureWriter=r,ktx2BasisWriter}var loadImage$1={},es5$h={},imageLoader={},version$1={},hasRequiredVersion$1;function requireVersion$1(){return hasRequiredVersion$1||(hasRequiredVersion$1=1,Object.defineProperty(version$1,"__esModule",{value:!0}),version$1.VERSION=void 0,version$1.VERSION="3.4.14"),version$1}var parseImage={},imageType={},hasRequiredImageType;function requireImageType(){if(hasRequiredImageType)return imageType;hasRequiredImageType=1,Object.defineProperty(imageType,"__esModule",{value:!0}),imageType.getDefaultImageType=function(){if(n)return"imagebitmap";if(r)return"image";if(a)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")},imageType.isImageTypeSupported=function(e){switch(e){case"auto":return n||r||a;case"imagebitmap":return n;case"image":return r;case"data":return a;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}};var e=es5$t,t=globalThis._parseImageNode,r="undefined"!=typeof Image,n="undefined"!=typeof ImageBitmap,i=Boolean(t),a=!!e.isBrowser||i;return imageType}var parsedImageApi={},hasRequiredParsedImageApi;function requireParsedImageApi(){if(hasRequiredParsedImageApi)return parsedImageApi;hasRequiredParsedImageApi=1;var e=interopRequireDefaultExports;Object.defineProperty(parsedImageApi,"__esModule",{value:!0}),parsedImageApi.deleteImage=function(e){"imagebitmap"===r(e)&&e.close()},parsedImageApi.getImageData=n,parsedImageApi.getImageSize=function(e){return n(e)},parsedImageApi.getImageType=r,parsedImageApi.isImage=function(e){return Boolean(i(e))};var t=e(_typeofExports);function r(e){var t=i(e);if(!t)throw new Error("Not an image");return t}function n(e){switch(r(e)){case"data":return e;case"image":case"imagebitmap":var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function i(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"===(0,t.default)(e)&&e.data&&e.width&&e.height?"data":null}return parsedImageApi}var parseToImage={},svgUtils={},hasRequiredSvgUtils,hasRequiredParseToImage;function requireSvgUtils(){if(hasRequiredSvgUtils)return svgUtils;hasRequiredSvgUtils=1,Object.defineProperty(svgUtils,"__esModule",{value:!0}),svgUtils.getBlob=n,svgUtils.getBlobOrSVGDataUrl=function(e,t){if(r(t)){var i=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(i=unescape(encodeURIComponent(i)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return n(e,t)},svgUtils.isSVG=r;var e=/^data:image\/svg\+xml/,t=/\.svg((\?|#).*)?$/;function r(r){return r&&(e.test(r)||t.test(r))}function n(e,t){if(r(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}return svgUtils}function requireParseToImage(){if(hasRequiredParseToImage)return parseToImage;hasRequiredParseToImage=1;var e=interopRequireDefaultExports;Object.defineProperty(parseToImage,"__esModule",{value:!0}),parseToImage.loadToImage=a,parseToImage.parseToImage=function(e,t,r){return i.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireSvgUtils();function i(){return(i=(0,r.default)(t.default.mark((function e(r,i,o){var s,l,u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.getBlobOrSVGDataUrl)(r,o),l=self.URL||self.webkitURL,u="string"!=typeof s&&l.createObjectURL(s),e.prev=3,e.next=6,a(u||s,i);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,u&&l.revokeObjectURL(u),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[3,,7,10]])})))).apply(this,arguments)}function a(e,t){return o.apply(this,arguments)}function o(){return o=(0,r.default)(t.default.mark((function e(r,n){var i;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=new Image).src=r,!(n.image&&n.image.decode&&i.decode)){e.next=6;break}return e.next=5,i.decode();case 5:return e.abrupt("return",i);case 6:return e.next=8,new Promise((function(e,t){try{i.onload=function(){return e(i)},i.onerror=function(e){return t(new Error("Could not load image ".concat(r,": ").concat(e)))}}catch(e){t(e)}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}return parseToImage}var parseToImageBitmap={},hasRequiredParseToImageBitmap;function requireParseToImageBitmap(){if(hasRequiredParseToImageBitmap)return parseToImageBitmap;hasRequiredParseToImageBitmap=1;var e=interopRequireDefaultExports;Object.defineProperty(parseToImageBitmap,"__esModule",{value:!0}),parseToImageBitmap.parseToImageBitmap=function(e,t,r){return s.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireSvgUtils(),i=requireParseToImage(),a={},o=!0;function s(){return(s=(0,r.default)(t.default.mark((function e(r,a,o){var s,u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,n.isSVG)(o)){e.next=7;break}return e.next=3,(0,i.parseToImage)(r,a,o);case 3:s=e.sent,e.next=8;break;case 7:s=(0,n.getBlob)(r,o);case 8:return u=a&&a.imagebitmap,e.next=11,l(s,u);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return u=(0,r.default)(t.default.mark((function e(r){var n,i=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c(n=i.length>1&&void 0!==i[1]?i[1]:null)&&o||(n=null),!n){e.next=13;break}return e.prev=3,e.next=6,createImageBitmap(r,n);case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),console.warn(e.t0),o=!1;case 13:return e.next=15,createImageBitmap(r);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),u.apply(this,arguments)}function c(e){for(var t in e||a)return!1;return!0}return parseToImageBitmap}var parseToNodeImage={},binaryImageApi={},parseIsobmffBinary={},hasRequiredParseIsobmffBinary,hasRequiredBinaryImageApi,hasRequiredParseToNodeImage,hasRequiredParseImage,hasRequiredImageLoader;function requireParseIsobmffBinary(){if(hasRequiredParseIsobmffBinary)return parseIsobmffBinary;hasRequiredParseIsobmffBinary=1;var e=interopRequireDefaultExports;Object.defineProperty(parseIsobmffBinary,"__esModule",{value:!0}),parseIsobmffBinary.decodeMajorBrand=r,parseIsobmffBinary.getISOBMFFMediaType=function(e){return function(e,r){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,t.default)(r).map((function(e){return e.charCodeAt(0)})),a=0;a<i.length;++a)if(i[a]!==e[a+n])return!1;return!0}(e,"ftyp",4)?0==(96&e[8])?null:r(e):null};var t=e(requireToConsumableArray());function r(e){var r;switch((r=e,String.fromCharCode.apply(String,(0,t.default)(r.slice(8,12)))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}return parseIsobmffBinary}function requireBinaryImageApi(){if(hasRequiredBinaryImageApi)return binaryImageApi;hasRequiredBinaryImageApi=1,Object.defineProperty(binaryImageApi,"__esModule",{value:!0}),binaryImageApi.getBinaryImageMetadata=function(a){var o=i(a);return function(e){var r=i(e);return r.byteLength>=24&&2303741511===r.getUint32(0,t)?{mimeType:"image/png",width:r.getUint32(16,t),height:r.getUint32(20,t)}:null}(o)||function(e){var r=i(e);if(!(r.byteLength>=3&&65496===r.getUint16(0,t)&&255===r.getUint8(2)))return null;for(var n=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),a=n.tableMarkers,o=n.sofMarkers,s=2;s+9<r.byteLength;){var l=r.getUint16(s,t);if(o.has(l))return{mimeType:"image/jpeg",height:r.getUint16(s+5,t),width:r.getUint16(s+7,t)};if(!a.has(l))return null;s+=2,s+=r.getUint16(s,t)}return null}(o)||function(e){var n=i(e);return n.byteLength>=10&&1195984440===n.getUint32(0,t)?{mimeType:"image/gif",width:n.getUint16(6,r),height:n.getUint16(8,r)}:null}(o)||n(o)||function(t){var r=new Uint8Array(t instanceof DataView?t.buffer:t),n=(0,e.getISOBMFFMediaType)(r);return n?{mimeType:n.mimeType,width:0,height:0}:null}(o)},binaryImageApi.getBmpMetadata=n;var e=requireParseIsobmffBinary(),t=!1,r=!0;function n(e){var n=i(e);return n.byteLength>=14&&16973===n.getUint16(0,t)&&n.getUint32(2,r)===n.byteLength?{mimeType:"image/bmp",width:n.getUint32(18,r),height:n.getUint32(22,r)}:null}function i(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}return binaryImageApi}function requireParseToNodeImage(){if(hasRequiredParseToNodeImage)return parseToNodeImage;hasRequiredParseToNodeImage=1;var e=interopRequireDefaultExports;Object.defineProperty(parseToNodeImage,"__esModule",{value:!0}),parseToNodeImage.parseToNodeImage=function(e,t){return a.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$t,i=requireBinaryImageApi();function a(){return(a=(0,r.default)(t.default.mark((function e(r,a){var o,s,l;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,i.getBinaryImageMetadata)(r)||{},s=o.mimeType,l=globalThis._parseImageNode,(0,n.assert)(l),e.next=5,l(r,s);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return parseToNodeImage}function requireParseImage(){if(hasRequiredParseImage)return parseImage;hasRequiredParseImage=1;var e=interopRequireDefaultExports;Object.defineProperty(parseImage,"__esModule",{value:!0}),parseImage.parseImage=function(e,t,r){return u.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$t,i=requireImageType(),a=requireParsedImageApi(),o=requireParseToImage(),s=requireParseToImageBitmap(),l=requireParseToNodeImage();function u(){return u=(0,r.default)(t.default.mark((function e(r,i,u){var d,h,f,p;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h=(u||{}).url,f=c(d=((i=i||{}).image||{}).type||"auto"),e.t0=f,e.next="imagebitmap"===e.t0?8:"image"===e.t0?12:"data"===e.t0?16:20;break;case 8:return e.next=10,(0,s.parseToImageBitmap)(r,i,h);case 10:return p=e.sent,e.abrupt("break",21);case 12:return e.next=14,(0,o.parseToImage)(r,i,h);case 14:return p=e.sent,e.abrupt("break",21);case 16:return e.next=18,(0,l.parseToNodeImage)(r,i);case 18:return p=e.sent,e.abrupt("break",21);case 20:(0,n.assert)(!1);case 21:return"data"===d&&(p=(0,a.getImageData)(p)),e.abrupt("return",p);case 23:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function c(e){switch(e){case"auto":case"data":return(0,i.getDefaultImageType)();default:return(0,i.isImageTypeSupported)(e),e}}return parseImage}function requireImageLoader(){if(hasRequiredImageLoader)return imageLoader;hasRequiredImageLoader=1,Object.defineProperty(imageLoader,"__esModule",{value:!0}),imageLoader._typecheckImageLoader=imageLoader.ImageLoader=void 0;var e=requireVersion$1(),t=requireParseImage(),r=requireBinaryImageApi(),n={id:"image",module:"images",name:"Images",version:e.VERSION,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:t.parseImage,tests:[function(e){return Boolean((0,r.getBinaryImageMetadata)(new DataView(e)))}],options:{image:{type:"auto",decode:!0}}};return imageLoader.ImageLoader=n,imageLoader._typecheckImageLoader=n,imageLoader}var imageWriter={},encodeImage={},hasRequiredEncodeImage,hasRequiredImageWriter;function requireEncodeImage(){if(hasRequiredEncodeImage)return encodeImage;hasRequiredEncodeImage=1;var e=interopRequireDefaultExports;Object.defineProperty(encodeImage,"__esModule",{value:!0}),encodeImage.encodeImage=function(e,t){return a.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireParsedImageApi(),i=globalThis._encodeImageNode;function a(){return(a=(0,r.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=n||{}).image=n.image||{},e.abrupt("return",i?i(r,{type:n.image.mimeType}):s(r,n));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var o=!0;function s(e,t){return l.apply(this,arguments)}function l(){return(l=(0,r.default)(t.default.mark((function e(r,i){var a,s,l,c,d,h,f,p;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(a=i.image).mimeType,l=a.jpegQuality,c=(0,n.getImageSize)(r),d=c.width,h=c.height,(f=document.createElement("canvas")).width=d,f.height=h,u(r,f),e.next=8,new Promise((function(e){if(l&&o)try{return void f.toBlob(e,s,l)}catch(e){o=!1}f.toBlob(e,s)}));case 8:if(p=e.sent){e.next=11;break}throw new Error("image encoding failed");case 11:return e.next=13,p.arrayBuffer();case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e,t){if(0===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)&&0===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)&&"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var r=t.getContext("bitmaprenderer");if(r)return r.transferFromImageBitmap(e),t}var n=t.getContext("2d");if(e.data){var i=new Uint8ClampedArray(e.data),a=new ImageData(i,e.width,e.height);return n.putImageData(a,0,0),t}return n.drawImage(e,0,0),t}return encodeImage}function requireImageWriter(){if(hasRequiredImageWriter)return imageWriter;hasRequiredImageWriter=1,Object.defineProperty(imageWriter,"__esModule",{value:!0}),imageWriter.ImageWriter=void 0;var e=requireVersion$1(),t=requireEncodeImage();return imageWriter.ImageWriter={name:"Images",id:"image",module:"images",version:e.VERSION,extensions:["jpeg"],options:{image:{mimeType:"image/png",jpegQuality:null}},encode:t.encodeImage},imageWriter}var imageFormat={},hasRequiredImageFormat;function requireImageFormat(){if(hasRequiredImageFormat)return imageFormat;hasRequiredImageFormat=1;var e=interopRequireDefaultExports;Object.defineProperty(imageFormat,"__esModule",{value:!0}),imageFormat.getSupportedImageFormats=function(){return s.apply(this,arguments)},imageFormat.isImageFormatSupported=function(e){if(void 0===l[e]){var t=n.isBrowser?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{return 0===document.createElement("canvas").toDataURL(e).indexOf("data:".concat(e))}catch(e){return!1}}(e);default:return!0}}(e):u(e);l[e]=t}return l[e]};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$t;function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/tiff","image/svg","image/svg+xml","image/bmp","image/vnd.microsoft.icon"];function s(){return(s=(0,r.default)(t.default.mark((function e(){var r,a,s,l;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=4;break;case 3:return e.abrupt("return",e.sent);case 4:r=new Set,a=i(o),e.prev=6,a.s();case 8:if((s=a.n()).done){e.next=21;break}if(l=s.value,!n.isBrowser){e.next=16;break}return e.next=13,d(l);case 13:e.t0=e.sent,e.next=17;break;case 16:e.t0=u(l);case 17:e.t0&&r.add(l);case 19:e.next=8;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(6),a.e(e.t1);case 26:return e.prev=26,a.f(),e.finish(26);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}}),e,null,[[6,23,26,29]])})))).apply(this,arguments)}var l={};function u(e){var t=globalThis._parseImageNode,r=globalThis._imageFormatsNode,n=void 0===r?["image/png","image/jpeg","image/gif"]:r;return Boolean(t)&&n.includes(e)}var c={"image/avif":"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=","image/webp":"data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"};function d(e){return h.apply(this,arguments)}function h(){return(h=(0,r.default)(t.default.mark((function e(r){var n;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=c[r])){e.next=7;break}return e.next=4,f(n);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=!0;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=new Image;t.src=r,t.onload=function(){return e(t.height>0)},t.onerror=function(){return e(!1)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return imageFormat}var loadImage={},generateUrl$1={},hasRequiredGenerateUrl$1;function requireGenerateUrl$1(){if(hasRequiredGenerateUrl$1)return generateUrl$1;hasRequiredGenerateUrl$1=1;var e=interopRequireDefaultExports;Object.defineProperty(generateUrl$1,"__esModule",{value:!0}),generateUrl$1.generateUrl=function(e,t,n){var a=e;"function"==typeof e&&(a=e(i(i({},t),n))),(0,r.assert)("string"==typeof a);var o=t.baseUrl;return o&&(a="/"===o[o.length-1]?"".concat(o).concat(a):"".concat(o,"/").concat(a)),(0,r.resolvePath)(a)};var t=e(requireDefineProperty()),r=es5$t;function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}return generateUrl$1}var deepLoad$1={},asyncDeepMap$1={},hasRequiredAsyncDeepMap$1,hasRequiredDeepLoad$1,hasRequiredLoadImage$1,hasRequiredEs5$8;function requireAsyncDeepMap$1(){if(hasRequiredAsyncDeepMap$1)return asyncDeepMap$1;hasRequiredAsyncDeepMap$1=1;var e=interopRequireDefaultExports;Object.defineProperty(asyncDeepMap$1,"__esModule",{value:!0}),asyncDeepMap$1.asyncDeepMap=function(e,t){return a.apply(this,arguments)},asyncDeepMap$1.mapSubtree=o;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(_typeofExports),i=function(e){return e&&"object"===(0,n.default)(e)};function a(){return a=(0,r.default)(t.default.mark((function e(r,n){var i,a=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,o(r,n,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function o(e,t,r){return s.apply(this,arguments)}function s(){return(s=(0,r.default)(t.default.mark((function e(r,n,a){var o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(r)){e.next=4;break}return e.next=3,c(r,n,a);case 3:case 7:case 11:return e.abrupt("return",e.sent);case 4:if(!i(r)){e.next=8;break}return e.next=7,l(r,n,a);case 8:return o=r,e.next=11,n(o,a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t,r){return u.apply(this,arguments)}function u(){return(u=(0,r.default)(t.default.mark((function e(r,n,i){var a,s,l;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],s={},l=t.default.mark((function e(l){var u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=o(r[l],n,i).then((function(e){s[l]=e})),a.push(u);case 3:case"end":return e.stop()}}),e)})),e.t0=t.default.keys(r);case 4:if((e.t1=e.t0()).done){e.next=9;break}return e.delegateYield(l(e.t1.value),"t2",7);case 7:e.next=4;break;case 9:return e.next=11,Promise.all(a);case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t){return d.apply(this,arguments)}function d(){return d=(0,r.default)(t.default.mark((function e(r,n){var i,a,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:{},a=r.map((function(e){return o(e,n,i)})),e.next=4,Promise.all(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}return asyncDeepMap$1}function requireDeepLoad$1(){if(hasRequiredDeepLoad$1)return deepLoad$1;hasRequiredDeepLoad$1=1;var e=interopRequireDefaultExports;Object.defineProperty(deepLoad$1,"__esModule",{value:!0}),deepLoad$1.deepLoad=function(e,t,r){return i.apply(this,arguments)},deepLoad$1.shallowLoad=a;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireAsyncDeepMap$1();function i(){return i=(0,r.default)(t.default.mark((function e(r,i,o){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.asyncDeepMap)(r,(function(e){return a(e,i,o)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}function a(e,t,r){return o.apply(this,arguments)}function o(){return o=(0,r.default)(t.default.mark((function e(r,n,i){var a,o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(r,i.fetch);case 2:return a=e.sent,e.next=5,a.arrayBuffer();case 5:return o=e.sent,e.next=8,n(o,i);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}return deepLoad$1}function requireLoadImage$1(){if(hasRequiredLoadImage$1)return loadImage;hasRequiredLoadImage$1=1;var e=interopRequireDefaultExports;Object.defineProperty(loadImage,"__esModule",{value:!0}),loadImage.getImageUrls=h,loadImage.getMipLevels=g,loadImage.loadImage=function(e){return d.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=es5$t,a=requireParseImage(),o=requireParsedImageApi(),s=requireGenerateUrl$1(),l=requireDeepLoad$1();function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(){return d=(0,n.default)(t.default.mark((function e(r){var n,i,o=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,h(r,n);case 3:return i=e.sent,e.next=6,(0,l.deepLoad)(i,a.parseImage,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function h(e,t){return f.apply(this,arguments)}function f(){return f=(0,n.default)(t.default.mark((function e(r,n){var i,a,o=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>2&&void 0!==o[2]?o[2]:{},0===(a=n&&n.image&&n.image.mipLevels||0)){e.next=8;break}return e.next=5,p(r,a,n,i);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=(0,s.generateUrl)(r,n,i);case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(e,t,r,n){return m.apply(this,arguments)}function m(){return(m=(0,n.default)(t.default.mark((function e(r,n,u,d){var h,f,p,m,_;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=[],"auto"!==n){e.next=9;break}return f=(0,s.generateUrl)(r,u,c(c({},d),{},{lod:0})),e.next=5,(0,l.shallowLoad)(f,a.parseImage,u);case 5:p=(0,o.getImageSize)(e.sent),n=g({width:p.width,height:p.height}),h.push(f);case 9:for((0,i.assert)(n>0),m=h.length;m<n;++m)_=(0,s.generateUrl)(r,u,c(c({},d),{},{lod:m})),h.push(_);return e.abrupt("return",h);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return 1+Math.floor(Math.log2(Math.max(e.width,e.height)))}return loadImage}function requireEs5$8(){return hasRequiredEs5$8||(hasRequiredEs5$8=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"ImageLoader",{enumerable:!0,get:function(){return t.ImageLoader}}),Object.defineProperty(e,"ImageWriter",{enumerable:!0,get:function(){return r.ImageWriter}}),Object.defineProperty(e,"getBinaryImageMetadata",{enumerable:!0,get:function(){return n.getBinaryImageMetadata}}),Object.defineProperty(e,"getDefaultImageType",{enumerable:!0,get:function(){return i.getDefaultImageType}}),Object.defineProperty(e,"getImageData",{enumerable:!0,get:function(){return a.getImageData}}),Object.defineProperty(e,"getImageSize",{enumerable:!0,get:function(){return a.getImageSize}}),Object.defineProperty(e,"getImageType",{enumerable:!0,get:function(){return a.getImageType}}),Object.defineProperty(e,"getSupportedImageFormats",{enumerable:!0,get:function(){return o.getSupportedImageFormats}}),Object.defineProperty(e,"isImage",{enumerable:!0,get:function(){return a.isImage}}),Object.defineProperty(e,"isImageFormatSupported",{enumerable:!0,get:function(){return o.isImageFormatSupported}}),Object.defineProperty(e,"isImageTypeSupported",{enumerable:!0,get:function(){return i.isImageTypeSupported}}),Object.defineProperty(e,"loadImage",{enumerable:!0,get:function(){return s.loadImage}});var t=requireImageLoader(),r=requireImageWriter(),n=requireBinaryImageApi(),i=requireImageType(),a=requireParsedImageApi(),o=requireImageFormat(),s=requireLoadImage$1()}(es5$h)),es5$h}var generateUrl={},hasRequiredGenerateUrl;function requireGenerateUrl(){if(hasRequiredGenerateUrl)return generateUrl;hasRequiredGenerateUrl=1;var e=interopRequireDefaultExports;Object.defineProperty(generateUrl,"__esModule",{value:!0}),generateUrl.generateUrl=function(e,t,n){var a="function"==typeof e?e(i(i({},t),n)):e,o=t.baseUrl;return o&&(a="/"===o[o.length-1]?"".concat(o).concat(a):"".concat(o,"/").concat(a)),(0,r.resolvePath)(a)};var t=e(requireDefineProperty()),r=es5$t;function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}return generateUrl}var deepLoad={},asyncDeepMap={},hasRequiredAsyncDeepMap,hasRequiredDeepLoad,hasRequiredLoadImage;function requireAsyncDeepMap(){if(hasRequiredAsyncDeepMap)return asyncDeepMap;hasRequiredAsyncDeepMap=1;var e=interopRequireDefaultExports;Object.defineProperty(asyncDeepMap,"__esModule",{value:!0}),asyncDeepMap.asyncDeepMap=function(e,t){return a.apply(this,arguments)},asyncDeepMap.mapSubtree=o;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(_typeofExports),i=function(e){return e&&"object"===(0,n.default)(e)};function a(){return a=(0,r.default)(t.default.mark((function e(r,n){var i,a=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,o(r,n,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function o(e,t,r){return s.apply(this,arguments)}function s(){return(s=(0,r.default)(t.default.mark((function e(r,n,a){var o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(r)){e.next=4;break}return e.next=3,c(r,n,a);case 3:case 7:case 11:return e.abrupt("return",e.sent);case 4:if(!i(r)){e.next=8;break}return e.next=7,l(r,n,a);case 8:return o=r,e.next=11,n(o,a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t,r){return u.apply(this,arguments)}function u(){return(u=(0,r.default)(t.default.mark((function e(r,n,i){var a,s,l;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],s={},l=t.default.mark((function e(l){var u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=o(r[l],n,i).then((function(e){s[l]=e})),a.push(u);case 3:case"end":return e.stop()}}),e)})),e.t0=t.default.keys(r);case 4:if((e.t1=e.t0()).done){e.next=9;break}return e.delegateYield(l(e.t1.value),"t2",7);case 7:e.next=4;break;case 9:return e.next=11,Promise.all(a);case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t){return d.apply(this,arguments)}function d(){return d=(0,r.default)(t.default.mark((function e(r,n){var i,a,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:{},a=r.map((function(e){return o(e,n,i)})),e.next=4,Promise.all(a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}return asyncDeepMap}function requireDeepLoad(){if(hasRequiredDeepLoad)return deepLoad;hasRequiredDeepLoad=1;var e=interopRequireDefaultExports;Object.defineProperty(deepLoad,"__esModule",{value:!0}),deepLoad.deepLoad=function(e,t,r){return i.apply(this,arguments)},deepLoad.shallowLoad=a;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireAsyncDeepMap();function i(){return i=(0,r.default)(t.default.mark((function e(r,i,o){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.asyncDeepMap)(r,(function(e){return a(e,i,o)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}function a(e,t,r){return o.apply(this,arguments)}function o(){return o=(0,r.default)(t.default.mark((function e(r,n,i){var a,o;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(r,i.fetch);case 2:return a=e.sent,e.next=5,a.arrayBuffer();case 5:return o=e.sent,e.next=8,n(o,i);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}return deepLoad}function requireLoadImage(){if(hasRequiredLoadImage)return loadImage$1;hasRequiredLoadImage=1;var e=interopRequireDefaultExports;Object.defineProperty(loadImage$1,"__esModule",{value:!0}),loadImage$1.getImageUrls=d,loadImage$1.getMipLevels=m,loadImage$1.loadImageTexture=function(e){return c.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=es5$t,a=requireEs5$8(),o=requireGenerateUrl(),s=requireDeepLoad();function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(){return c=(0,n.default)(t.default.mark((function e(r){var n,i,o=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,d(r,n);case 3:return i=e.sent,e.next=6,(0,s.deepLoad)(i,a.ImageLoader.parse,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e,t){return h.apply(this,arguments)}function h(){return h=(0,n.default)(t.default.mark((function e(r,n){var i,a,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]?s[2]:{},0===(a=n&&n.image&&n.image.mipLevels||0)){e.next=8;break}return e.next=5,f(r,a,n,i);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=(0,o.generateUrl)(r,n,i);case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(e,t,r,n){return p.apply(this,arguments)}function p(){return(p=(0,n.default)(t.default.mark((function e(r,n,l,c){var d,h,f,p,g;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=[],"auto"!==n){e.next=9;break}return h=(0,o.generateUrl)(r,l,u(u({},c),{},{lod:0})),e.next=5,(0,s.shallowLoad)(h,a.ImageLoader.parse,l);case 5:f=(0,a.getImageSize)(e.sent),n=m({width:f.width,height:f.height}),d.push(h);case 9:for((0,i.assert)(n>0),p=d.length;p<n;++p)g=(0,o.generateUrl)(r,l,u(u({},c),{},{lod:p})),d.push(g);return e.abrupt("return",d);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return 1+Math.floor(Math.log2(Math.max(e.width,e.height)))}return loadImage$1}var loadImageArray={},hasRequiredLoadImageArray;function requireLoadImageArray(){if(hasRequiredLoadImageArray)return loadImageArray;hasRequiredLoadImageArray=1;var e=interopRequireDefaultExports;Object.defineProperty(loadImageArray,"__esModule",{value:!0}),loadImageArray.getImageArrayUrls=s,loadImageArray.loadImageTextureArray=function(e,t){return o.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireEs5$8(),i=requireLoadImage(),a=requireDeepLoad();function o(){return o=(0,r.default)(t.default.mark((function e(r,i){var o,l,u=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>2&&void 0!==u[2]?u[2]:{},e.next=3,s(r,i,o);case 3:return l=e.sent,e.next=6,(0,a.deepLoad)(l,n.ImageLoader.parse,o);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(e,t){return l.apply(this,arguments)}function l(){return l=(0,r.default)(t.default.mark((function e(r,n){var a,o,s,l,u=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=u.length>2&&void 0!==u[2]?u[2]:{},o=[],s=0;s<r;s++)l=(0,i.getImageUrls)(n,a,{index:s}),o.push(l);return e.next=5,Promise.all(o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}return loadImageArray}var loadImageCube={},hasRequiredLoadImageCube,hasRequiredEs5$7;function requireLoadImageCube(){if(hasRequiredLoadImageCube)return loadImageCube;hasRequiredLoadImageCube=1;var e=interopRequireDefaultExports;Object.defineProperty(loadImageCube,"__esModule",{value:!0}),loadImageCube.getImageCubeUrls=c,loadImageCube.loadImageTextureCube=function(e){return h.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=requireEs5$8(),a=requireLoadImage(),o=requireDeepLoad();function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=[{face:34069,direction:"right",axis:"x",sign:"positive"},{face:34070,direction:"left",axis:"x",sign:"negative"},{face:34071,direction:"top",axis:"y",sign:"positive"},{face:34072,direction:"bottom",axis:"y",sign:"negative"},{face:34073,direction:"front",axis:"z",sign:"positive"},{face:34074,direction:"back",axis:"z",sign:"negative"}];function c(e,t){return d.apply(this,arguments)}function d(){return(d=(0,n.default)(t.default.mark((function e(r,n){var i,o,s,c,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},o=[],s=0,c=t.default.mark((function e(){var c,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d=(0,a.getImageUrls)(r,n,l(l({},c=u[s]),{},{index:s++})).then((function(e){i[c.face]=e})),o.push(d);case 3:case"end":return e.stop()}}),e)})),d=0;case 5:if(!(d<u.length)){e.next=10;break}return e.delegateYield(c(),"t0",7);case 7:++d,e.next=5;break;case 10:return e.next=12,Promise.all(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return h=(0,n.default)(t.default.mark((function e(r){var n,a,s=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,c(r,n);case 3:return a=e.sent,e.next=6,(0,o.deepLoad)(a,i.ImageLoader.parse,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}return loadImageCube}function requireEs5$7(){return hasRequiredEs5$7||(hasRequiredEs5$7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"BasisLoader",{enumerable:!0,get:function(){return n.BasisLoader}}),Object.defineProperty(e,"BasisWorkerLoader",{enumerable:!0,get:function(){return n.BasisWorkerLoader}}),Object.defineProperty(e,"CompressedTextureLoader",{enumerable:!0,get:function(){return i.CompressedTextureLoader}}),Object.defineProperty(e,"CompressedTextureWorkerLoader",{enumerable:!0,get:function(){return i.CompressedTextureWorkerLoader}}),Object.defineProperty(e,"CompressedTextureWriter",{enumerable:!0,get:function(){return s.CompressedTextureWriter}}),Object.defineProperty(e,"CrunchLoader",{enumerable:!0,get:function(){return a.CrunchLoader}}),Object.defineProperty(e,"CrunchWorkerLoader",{enumerable:!0,get:function(){return a.CrunchLoader}}),Object.defineProperty(e,"GL_EXTENSIONS_CONSTANTS",{enumerable:!0,get:function(){return h.GL_EXTENSIONS_CONSTANTS}}),Object.defineProperty(e,"KTX2BasisWriter",{enumerable:!0,get:function(){return l.KTX2BasisWriter}}),e.KTX2BasisWriterWorker=void 0,Object.defineProperty(e,"NPYLoader",{enumerable:!0,get:function(){return o.NPYLoader}}),Object.defineProperty(e,"NPYWorkerLoader",{enumerable:!0,get:function(){return o.NPYWorkerLoader}}),Object.defineProperty(e,"getSupportedGPUTextureFormats",{enumerable:!0,get:function(){return p.getSupportedGPUTextureFormats}}),Object.defineProperty(e,"loadImageTexture",{enumerable:!0,get:function(){return u.loadImageTexture}}),Object.defineProperty(e,"loadImageTextureArray",{enumerable:!0,get:function(){return c.loadImageTextureArray}}),Object.defineProperty(e,"loadImageTextureCube",{enumerable:!0,get:function(){return d.loadImageTextureCube}}),Object.defineProperty(e,"selectSupportedBasisFormat",{enumerable:!0,get:function(){return f.selectSupportedBasisFormat}});var t=es5$t,r=requireVersion$2(),n=requireBasisLoader(),i=requireCompressedTextureLoader(),a=requireCrunchLoader(),o=requireNpyLoader(),s=requireCompressedTextureWriter(),l=requireKtx2BasisWriter(),u=requireLoadImage(),c=requireLoadImageArray(),d=requireLoadImageCube(),h=requireGlExtensions(),f=requireParseBasis(),p=requireTextureFormats$1();e.KTX2BasisWriterWorker={name:"Basis Universal Supercompressed GPU Texture",id:t.isBrowser?"ktx2-basis-writer":"ktx2-basis-writer-nodejs",module:"textures",version:r.VERSION,extensions:["ktx2"],worker:!0,options:{useSRGB:!1,qualityLevel:10,encodeUASTC:!1,mipmaps:!1}}}(es5$i)),es5$i}var assert$9={},hasRequiredAssert$6;function requireAssert$6(){return hasRequiredAssert$6||(hasRequiredAssert$6=1,Object.defineProperty(assert$9,"__esModule",{value:!0}),assert$9.assert=function(e,t){if(!e)throw new Error(t||"assert failed: gltf")}),assert$9}var resolveUrl={},hasRequiredResolveUrl;function requireResolveUrl(){return hasRequiredResolveUrl||(hasRequiredResolveUrl=1,Object.defineProperty(resolveUrl,"__esModule",{value:!0}),resolveUrl.resolveUrl=function(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return r.substr(0,r.lastIndexOf("/")+1)+e}),resolveUrl}var getTypedArray={},hasRequiredGetTypedArray;function requireGetTypedArray(){if(hasRequiredGetTypedArray)return getTypedArray;hasRequiredGetTypedArray=1,Object.defineProperty(getTypedArray,"__esModule",{value:!0}),getTypedArray.getTypedArrayForBufferView=t,getTypedArray.getTypedArrayForImageData=function(e,r,n){return t(e,r,e.bufferViews[e.images[n].bufferView])};var e=requireAssert$6();function t(t,r,n){var i=t.bufferViews[n];(0,e.assert)(i);var a=r[i.buffer];return(0,e.assert)(a),new Uint8Array(a.arrayBuffer,(i.byteOffset||0)+a.byteOffset,i.byteLength)}return getTypedArray}var gltfExtensions={},EXT_meshopt_compression={},gltfScenegraph={},gltfUtils$1={},hasRequiredGltfUtils$1,hasRequiredGltfScenegraph;function requireGltfUtils$1(){if(hasRequiredGltfUtils$1)return gltfUtils$1;hasRequiredGltfUtils$1=1,Object.defineProperty(gltfUtils$1,"__esModule",{value:!0}),gltfUtils$1.getAccessorArrayTypeAndLength=function(t,r){var n=o[t.componentType],s=i[t.type],l=t.count*s,u=t.count*s*a[t.componentType];return(0,e.assert)(u>=0&&u<=r.byteLength),{ArrayType:n,length:l,byteLength:u}},gltfUtils$1.getAccessorTypeFromSize=function(e){return t[e-1]||t[0]},gltfUtils$1.getComponentTypeFromArray=function(e){var t=n.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t},gltfUtils$1.getMemoryUsageGLTF=function(e){var t=e.images,r=e.bufferViews;r=r||[];var n=(t=t||[]).map((function(e){return e.bufferView}));r=r.filter((function(e){return!n.includes(e)}));var i=r.reduce((function(e,t){return e+t.byteLength}),0),a=t.reduce((function(e,t){var r=t.image;return e+r.width*r.height}),0);return i+Math.ceil(4*a*1.33)};var e=requireAssert$6(),t=["SCALAR","VEC2","VEC3","VEC4"],r=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],n=new Map(r),i={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},a={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},o={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};return gltfUtils$1}function requireGltfScenegraph(){if(hasRequiredGltfScenegraph)return gltfScenegraph;hasRequiredGltfScenegraph=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfScenegraph,"__esModule",{value:!0}),gltfScenegraph.default=void 0;var t=e(_typeofExports),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=requireEs5$8(),o=es5$t,s=requireAssert$6(),l=requireGltfUtils$1();function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},p=function(){function e(t){(0,r.default)(this,e),(0,i.default)(this,"gltf",void 0),(0,i.default)(this,"sourceBuffers",void 0),(0,i.default)(this,"byteLength",void 0),this.gltf=t||{json:h({},f),buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return(0,n.default)(e,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"getExtension",value:function(e){return this.getUsedExtensions().find((function(t){return t===e}))?(this.json.extensions||{})[e]||!0:null}},{key:"getRequiredExtension",value:function(e){return this.getRequiredExtensions().find((function(t){return t===e}))?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getRemovedExtensions",value:function(){return this.json.extensionsRemoved||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,r){if("object"===(0,t.default)(r))return r;var n=this.json[e]&&this.json[e][r];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(r,"]"));return n}},{key:"getTypedArrayForBufferView",value:function(e){e=this.getBufferView(e);var t=this.gltf.buffers[e.buffer];return(0,s.assert)(t),new Uint8Array(t.arrayBuffer,(e.byteOffset||0)+t.byteOffset,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=(0,l.getAccessorArrayTypeAndLength)(e,t);return new(0,n.ArrayType)(r,t.byteOffset+e.byteOffset,n.length)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer);return new Uint8Array(r.data,t.byteOffset||0,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}},{key:"setObjectExtension",value:function(e,t,r){(e.extensions||{})[t]=r}},{key:"removeObjectExtension",value:function(e,t){var r=e.extensions||{},n=r[t];return delete r[t],n}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.assert)(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.assert)(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){if(this.getExtension(e)){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);var t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}}},{key:"setDefaultScene",value:function(e){this.json.scene=e}},{key:"addScene",value:function(e){var t=e.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}},{key:"addNode",value:function(e){var t=e.meshIndex,r=e.matrix;this.json.nodes=this.json.nodes||[];var n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}},{key:"addMesh",value:function(e){var t=e.indices,r=e.material,n=e.mode,i=void 0===n?4:n,a={primitives:[{attributes:this._addAttributes(e.attributes),mode:i}]};if(t){var o=this._addIndices(t);a.primitives[0].indices=o}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){var r=(0,a.getBinaryImageMetadata)(e),n=t||(null==r?void 0:r.mimeType),i={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=e.byteLength;(0,s.assert)(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=(0,o.padToNBytes)(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var r={bufferView:e,type:(0,l.getAccessorTypeFromSize)(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},r=this.addBufferView(e),n={min:t.min,max:t.max};n.min&&n.max||(n=this._getAccessorMinMax(e,t.size));var i={size:t.size,componentType:(0,l.getComponentTypeFromArray)(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(i,t))}},{key:"addTexture",value:function(e){var t={source:e.imageIndex};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}},{key:"addMaterial",value:function(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var e,t;this.gltf.buffers=[];var r,n=this.byteLength,i=new ArrayBuffer(n),a=new Uint8Array(i),s=0,l=u(this.sourceBuffers||[]);try{for(l.s();!(r=l.n()).done;)s=(0,o.copyToArray)(r.value,a,s)}catch(e){l.e(e)}finally{l.f()}null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}},{key:"_removeStringFromArray",value:function(e,t){for(var r=!0;r;){var n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}},{key:"_addAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};for(var r in e){var n=e[r],i=this._getGltfAttributeName(r),a=this.addBinaryBuffer(n.value,n);t[i]=a}return t}},{key:"_addIndices",value:function(e){return this.addBinaryBuffer(e,{size:1})}},{key:"_getGltfAttributeName",value:function(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}},{key:"_getAccessorMinMax",value:function(e,t){var r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];var n,i=u(e.subarray(0,t));try{for(i.s();!(n=i.n()).done;){var a=n.value;r.min.push(a),r.max.push(a)}}catch(e){i.e(e)}finally{i.f()}for(var o=t;o<e.length;o+=t)for(var s=0;s<t;s++)r.min[0+s]=Math.min(r.min[0+s],e[o+s]),r.max[0+s]=Math.max(r.max[0+s],e[o+s]);return r}}]),e}();return gltfScenegraph.default=p,gltfScenegraph}var meshoptDecoder={},hasRequiredMeshoptDecoder,hasRequiredEXT_meshopt_compression;function requireMeshoptDecoder(){if(hasRequiredMeshoptDecoder)return meshoptDecoder;hasRequiredMeshoptDecoder=1;var e=interopRequireDefaultExports;Object.defineProperty(meshoptDecoder,"__esModule",{value:!0}),meshoptDecoder.isMeshoptSupported=function(){return a},meshoptDecoder.meshoptDecodeGltfBuffer=function(e,t,r,n,i){return m.apply(this,arguments)},meshoptDecoder.meshoptDecodeIndexBuffer=function(e,t,r,n){return f.apply(this,arguments)},meshoptDecoder.meshoptDecodeIndexSequence=function(e,t,r,n){return p.apply(this,arguments)},meshoptDecoder.meshoptDecodeVertexBuffer=function(e,t,r,n){return h.apply(this,arguments)};var t,r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=e(_typeofExports),a="object"!==("undefined"==typeof WebAssembly?"undefined":(0,i.default)(WebAssembly)),o="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",s="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),u=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},d={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function h(){return h=(0,n.default)(r.default.mark((function e(t,n,i,a){var o,s,l=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l.length>4&&void 0!==l[4]?l[4]:"NONE",e.next=3,g();case 3:x(s=e.sent,s.exports.meshopt_decodeVertexBuffer,t,n,i,a,s.exports[c[o]]);case 5:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(){return f=(0,n.default)(r.default.mark((function e(t,n,i,a){var o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:x(o=e.sent,o.exports.meshopt_decodeIndexBuffer,t,n,i,a);case 4:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(){return p=(0,n.default)(r.default.mark((function e(t,n,i,a){var o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:x(o=e.sent,o.exports.meshopt_decodeIndexSequence,t,n,i,a);case 4:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function m(){return m=(0,n.default)(r.default.mark((function e(t,n,i,a,o){var s,l,u=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=u.length>5&&void 0!==u[5]?u[5]:"NONE",e.next=3,g();case 3:x(l=e.sent,l.exports[d[o]],t,n,i,a,l.exports[c[s||"NONE"]]);case 5:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function g(){return _.apply(this,arguments)}function _(){return(_=(0,n.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(t=y()),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return v.apply(this,arguments)}function v(){return v=(0,n.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o,WebAssembly.validate(l)&&(t=s,console.log("Warning: meshopt_decoder is using experimental SIMD support")),e.next=4,WebAssembly.instantiate(b(t),{});case 4:return n=e.sent,e.next=7,n.instance.exports.__wasm_call_ctors();case 7:return e.abrupt("return",n.instance);case 8:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function b(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;++r){var n=e.charCodeAt(r);t[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}for(var i=0,a=0;a<e.length;++a)t[i++]=t[a]<60?u[t[a]]:64*(t[a]-60)+t[++a];return t.buffer.slice(0,i)}function x(e,t,r,n,i,a,o){var s=e.exports.sbrk,l=n+3&-4,u=s(l*i),c=s(a.length),d=new Uint8Array(e.exports.memory.buffer);d.set(a,c);var h=t(u,n,i,c,a.length);if(0===h&&o&&o(u,l,i),r.set(d.subarray(u,u+n*i)),s(u-s(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}return meshoptDecoder}function requireEXT_meshopt_compression(){if(hasRequiredEXT_meshopt_compression)return EXT_meshopt_compression;hasRequiredEXT_meshopt_compression=1;var e=interopRequireDefaultExports;Object.defineProperty(EXT_meshopt_compression,"__esModule",{value:!0}),EXT_meshopt_compression.decode=function(e,t){return l.apply(this,arguments)},EXT_meshopt_compression.name=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireGltfScenegraph()),i=requireMeshoptDecoder();function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s="EXT_meshopt_compression";function l(){return(l=(0,r.default)(t.default.mark((function e(r,i){var o,l,c,d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=new n.default(r),null!=i&&null!==(o=i.gltf)&&void 0!==o&&o.decompressMeshes){e.next=3;break}return e.abrupt("return");case 3:c=[],d=a(r.json.bufferViews||[]);try{for(d.s();!(h=d.n()).done;)c.push(u(l,h.value))}catch(e){d.e(e)}finally{d.f()}return e.next=8,Promise.all(c);case 8:l.removeExtension(s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=(0,r.default)(t.default.mark((function e(r,n){var a,o,l,u,c,d,h,f,p,m,g;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=r.getObjectExtension(n,s))){e.next=9;break}return o=a.byteOffset,l=a.byteLength,u=a.byteStride,c=a.count,d=a.mode,f=void 0===(h=a.filter)?"NONE":h,p=r.gltf.buffers[a.buffer],m=new Uint8Array(p.arrayBuffer,p.byteOffset+(void 0===o?0:o),void 0===l?0:l),g=new Uint8Array(r.gltf.buffers[n.buffer].arrayBuffer,n.byteOffset,n.byteLength),e.next=8,(0,i.meshoptDecodeGltfBuffer)(g,c,u,m,d,f);case 8:return e.abrupt("return",g);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}return EXT_meshopt_compression.name=s,EXT_meshopt_compression}var EXT_texture_webp={},hasRequiredEXT_texture_webp;function requireEXT_texture_webp(){if(hasRequiredEXT_texture_webp)return EXT_texture_webp;hasRequiredEXT_texture_webp=1;var e=interopRequireDefaultExports;Object.defineProperty(EXT_texture_webp,"__esModule",{value:!0}),EXT_texture_webp.name=void 0,EXT_texture_webp.preprocess=function(e,a){var o=new r.default(e);if((0,t.isImageFormatSupported)("image/webp")){var s,l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(o.json.textures||[]);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=o.getObjectExtension(u,i);c&&(u.source=c.source),o.removeObjectExtension(u,i)}}catch(e){l.e(e)}finally{l.f()}o.removeExtension(i)}else if(o.getRequiredExtensions().includes(i))throw new Error("gltf: Required extension ".concat(i," not supported by browser"))};var t=requireEs5$8(),r=e(requireGltfScenegraph());function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i="EXT_texture_webp";return EXT_texture_webp.name=i,EXT_texture_webp}var KHR_texture_basisu={},hasRequiredKHR_texture_basisu;function requireKHR_texture_basisu(){if(hasRequiredKHR_texture_basisu)return KHR_texture_basisu;hasRequiredKHR_texture_basisu=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_texture_basisu,"__esModule",{value:!0}),KHR_texture_basisu.name=void 0,KHR_texture_basisu.preprocess=function(e,i){var a,o=new t.default(e),s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(o.json.textures||[]);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=o.getObjectExtension(l,n);u&&(l.source=u.source),o.removeObjectExtension(l,n)}}catch(e){s.e(e)}finally{s.f()}o.removeExtension(n)};var t=e(requireGltfScenegraph());function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var n="KHR_texture_basisu";return KHR_texture_basisu.name=n,KHR_texture_basisu}var KHR_draco_mesh_compression={},gltfAttributeUtils={},hasRequiredGltfAttributeUtils,hasRequiredKHR_draco_mesh_compression;function requireGltfAttributeUtils(){if(hasRequiredGltfAttributeUtils)return gltfAttributeUtils;hasRequiredGltfAttributeUtils=1,Object.defineProperty(gltfAttributeUtils,"__esModule",{value:!0}),gltfAttributeUtils.getGLTFAccessor=t,gltfAttributeUtils.getGLTFAccessors=function(e){var r={};for(var n in e)if("indices"!==n){var i=t(e[n]);r[n]=i}return r};var e=requireGltfUtils$1();function t(t){var r=function(e){var t=e,r=1,n=0;return e&&e.value&&(t=e.value,r=e.size||1),t&&(ArrayBuffer.isView(t)||(t=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e?Array.isArray(e)?new t(e):!r||e instanceof t?e:new t(e):null}(t,Float32Array)),n=t.length/r),{buffer:t,size:r,count:n}}(t),n=r.buffer,i=r.size;return{value:n,size:i,byteOffset:0,count:r.count,type:(0,e.getAccessorTypeFromSize)(i),componentType:(0,e.getComponentTypeFromArray)(n)}}return gltfAttributeUtils}function requireKHR_draco_mesh_compression(){if(hasRequiredKHR_draco_mesh_compression)return KHR_draco_mesh_compression;hasRequiredKHR_draco_mesh_compression=1;var e=requireRegenerator(),t=interopRequireDefaultExports;Object.defineProperty(KHR_draco_mesh_compression,"__esModule",{value:!0}),KHR_draco_mesh_compression.decode=function(e,t,r){return g.apply(this,arguments)},KHR_draco_mesh_compression.encode=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new l.default(e),i=f(n.json.meshes||[]);try{for(i.s();!(t=i.n()).done;)v(t.value,r),n.addRequiredExtension(m)}catch(e){i.e(e)}finally{i.f()}},KHR_draco_mesh_compression.name=void 0,KHR_draco_mesh_compression.preprocess=function(e,t,r){var n,i=new l.default(e),a=f(x(i));try{for(a.s();!(n=a.n()).done;)i.getObjectExtension(n.value,m)}catch(e){a.e(e)}finally{a.f()}};var r=t(requireRegenerator()),n=t(requireSlicedToArray()),i=t(requireDefineProperty()),a=t(requireAsyncToGenerator()),o=es5$m,s=es5$t,l=t(requireGltfScenegraph()),u=requireGltfAttributeUtils();function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=e.mark(x);function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m="KHR_draco_mesh_compression";function g(){return g=(0,a.default)(r.default.mark((function e(t,n,i){var a,o,s,u,c,d;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&null!==(a=n.gltf)&&void 0!==a&&a.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:o=new l.default(t),s=[],u=f(x(o));try{for(u.s();!(c=u.n()).done;)o.getObjectExtension(d=c.value,m)&&s.push(_(o,d,n,i))}catch(e){u.e(e)}finally{u.f()}return e.next=8,Promise.all(s);case 8:o.removeExtension(m);case 9:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function _(e,t,r,n){return y.apply(this,arguments)}function y(){return y=(0,a.default)(r.default.mark((function e(t,i,a,l){var c,h,f,p,g,_,y,v,x,T,w,E,A;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.getObjectExtension(i,m)){e.next=3;break}return e.abrupt("return");case 3:return h=t.getTypedArrayForBufferView(c.bufferView),f=(0,s.sliceArrayBuffer)(h.buffer,h.byteOffset),p=l.parse,delete(g=d({},a))["3d-tiles"],e.next=10,p(f,o.DracoLoader,g,l);case 10:for(y=(0,u.getGLTFAccessors)((_=e.sent).attributes),v=0,x=Object.entries(y);v<x.length;v++)T=(0,n.default)(x[v],2),E=T[1],(w=T[0])in i.attributes&&null!=(A=t.getAccessor(i.attributes[w]))&&A.min&&null!=A&&A.max&&(E.min=A.min,E.max=A.max);i.attributes=y,_.indices&&(i.indices=(0,u.getGLTFAccessor)(_.indices)),b(i);case 16:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function v(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!a.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var s=a.DracoWriter.encodeSync({attributes:e}),l=null==o||null===(r=o.parseSync)||void 0===r?void 0:r.call(o,{attributes:e}),u=a._addFauxAttributes(l.attributes),c=a.addBufferView(s);return{primitives:[{attributes:u,mode:n,extensions:(0,i.default)({},m,{bufferView:c,attributes:u})}]}}function b(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function x(e){var t,n,i,a,o;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=f(e.json.meshes||[]),r.prev=1,t.s();case 3:if((n=t.n()).done){r.next=24;break}i=f(n.value.primitives),r.prev=6,i.s();case 8:if((a=i.n()).done){r.next=14;break}return o=a.value,r.next=12,o;case 12:r.next=8;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(6),i.e(r.t0);case 19:return r.prev=19,i.f(),r.finish(19);case 22:r.next=3;break;case 24:r.next=29;break;case 26:r.prev=26,r.t1=r.catch(1),t.e(r.t1);case 29:return r.prev=29,t.f(),r.finish(29);case 32:case"end":return r.stop()}}),h,null,[[1,26,29,32],[6,16,19,22]])}return KHR_draco_mesh_compression.name=m,KHR_draco_mesh_compression}var KHR_texture_transform={},gltfConstants={},hasRequiredGltfConstants,hasRequiredKHR_texture_transform;function requireGltfConstants(){if(hasRequiredGltfConstants)return gltfConstants;hasRequiredGltfConstants=1,Object.defineProperty(gltfConstants,"__esModule",{value:!0}),gltfConstants.COMPONENTS=gltfConstants.BYTES=void 0,gltfConstants.getBytesFromComponentType=function(e){return t[e]},gltfConstants.getGLEnumFromSamplerParameter=function(e){return{magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243}[e]},gltfConstants.getSizeFromAccessorType=function(t){return e[t]};var e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};gltfConstants.COMPONENTS=e;var t={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};return gltfConstants.BYTES=t,gltfConstants}function requireKHR_texture_transform(){if(hasRequiredKHR_texture_transform)return KHR_texture_transform;hasRequiredKHR_texture_transform=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_texture_transform,"__esModule",{value:!0}),KHR_texture_transform.decode=function(e,t){return p.apply(this,arguments)},KHR_texture_transform.name=void 0;var t=e(requireRegenerator()),r=e(requireSlicedToArray()),n=e(requireAsyncToGenerator()),i=es5$q,a=requireGltfUtils$1(),o=requireGltfConstants(),s=e(requireGltfScenegraph());function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c="KHR_texture_transform";KHR_texture_transform.name=c;var d=new i.Vector3,h=new i.Matrix3,f=new i.Matrix3;function p(){return(p=(0,n.default)(t.default.mark((function e(r,n){var i,a;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(new s.default(r).getExtension(c)){e.next=4;break}return e.abrupt("return");case 4:for(i=r.json.materials||[],a=0;a<i.length;a++)m(a,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){var r,n,i,a=[],o=null===(r=t.json.materials)||void 0===r?void 0:r[e],s=null==o||null===(n=o.pbrMetallicRoughness)||void 0===n?void 0:n.baseColorTexture;s&&g(t,e,s,a);var l=null==o?void 0:o.emissiveTexture;l&&g(t,e,l,a);var u=null==o?void 0:o.normalTexture;u&&g(t,e,u,a);var c=null==o?void 0:o.occlusionTexture;c&&g(t,e,c,a);var d=null==o||null===(i=o.pbrMetallicRoughness)||void 0===i?void 0:i.metallicRoughnessTexture;d&&g(t,e,d,a)}function g(e,t,n,a){var o=function(e,t){var n,a,o,s,l,u,d,p,m,g,_,y=null===(n=e.extensions)||void 0===n?void 0:n[c],v=e.texCoord,b=void 0===v?0:v,x=y.texCoord,T=void 0===x?b:x;if(-1===t.findIndex((function(e){var t=(0,r.default)(e,2);return t[0]===b&&t[1]===T}))){var w=(s=void 0===(o=(a=y).offset)?[0,0]:o,u=void 0===(l=a.rotation)?0:l,p=void 0===(d=a.scale)?[1,1]:d,m=(new i.Matrix3).set(1,0,0,0,1,0,s[0],s[1],1),g=h.set(Math.cos(u),Math.sin(u),0,-Math.sin(u),Math.cos(u),0,0,0,1),_=f.set(p[0],0,0,0,p[1],0,0,0,1),m.multiplyRight(g).multiplyRight(_));return b!==T&&(e.texCoord=T),t.push([b,T]),{originalTexCoord:b,texCoord:T,matrix:w}}return null}(n,a);if(o){var s,u=l(e.json.meshes||[]);try{for(u.s();!(s=u.n()).done;){var d,p=l(s.value.primitives);try{for(p.s();!(d=p.n()).done;){var m=d.value,g=m.material;Number.isFinite(g)&&t===g&&_(e,m,o)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){u.e(e)}finally{u.f()}}}function _(e,t,r){var n=r.originalTexCoord,i=r.texCoord,s=r.matrix,l=t.attributes["TEXCOORD_".concat(n)];if(Number.isFinite(l)){var u,c=null===(u=e.json.accessors)||void 0===u?void 0:u[l];if(c&&c.bufferView){var h,f=null===(h=e.json.bufferViews)||void 0===h?void 0:h[c.bufferView];if(f){for(var p=e.buffers[f.buffer],m=p.arrayBuffer,g=(p.byteOffset||0)+(c.byteOffset||0)+(f.byteOffset||0),_=(0,a.getAccessorArrayTypeAndLength)(c,f),y=_.ArrayType,v=o.COMPONENTS[c.type],b=f.byteStride||o.BYTES[c.componentType]*v,x=new Float32Array(_.length),T=0;T<c.count;T++){var w=new y(m,g+T*b,2);d.set(w[0],w[1],1),d.transformByMatrix3(s),x.set([d[0],d[1]],T*v)}n===i?function(e,t,r,n){e.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(c,f,e.buffers,x):function(e,t,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});var a=n.json.bufferViews;if(a){a.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});var o=n.json.accessors;o&&(o.push({bufferView:(null==a?void 0:a.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes["TEXCOORD_".concat(e)]=o.length-1)}}(i,c,t,e,x)}}}}return KHR_texture_transform}var KHR_lights_punctual={},hasRequiredKHR_lights_punctual;function requireKHR_lights_punctual(){if(hasRequiredKHR_lights_punctual)return KHR_lights_punctual;hasRequiredKHR_lights_punctual=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_lights_punctual,"__esModule",{value:!0}),KHR_lights_punctual.decode=function(e){return l.apply(this,arguments)},KHR_lights_punctual.encode=function(e){return u.apply(this,arguments)},KHR_lights_punctual.name=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireAssert$6(),i=e(requireGltfScenegraph());function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s="KHR_lights_punctual";function l(){return l=(0,r.default)(t.default.mark((function e(r){var n,o,l,u,c,d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new i.default(r),o=n.json,(l=n.getExtension(s))&&(n.json.lights=l.lights,n.removeExtension(s)),u=a(o.nodes||[]);try{for(u.s();!(c=u.n()).done;)(h=n.getObjectExtension(d=c.value,s))&&(d.light=h.light),n.removeObjectExtension(d,s)}catch(e){u.e(e)}finally{u.f()}case 6:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function u(){return u=(0,r.default)(t.default.mark((function e(r){var o,l,u,c,d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new i.default(r),(l=o.json).lights&&(u=o.addExtension(s),(0,n.assert)(!u.lights),u.lights=l.lights,delete l.lights),o.json.lights){c=a(o.json.lights);try{for(c.s();!(d=c.n()).done;)o.addObjectExtension((h=d.value).node,s,h)}catch(e){c.e(e)}finally{c.f()}delete o.json.lights}case 4:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}return KHR_lights_punctual.name=s,KHR_lights_punctual}var KHR_materials_unlit={},hasRequiredKHR_materials_unlit;function requireKHR_materials_unlit(){if(hasRequiredKHR_materials_unlit)return KHR_materials_unlit;hasRequiredKHR_materials_unlit=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_materials_unlit,"__esModule",{value:!0}),KHR_materials_unlit.decode=function(e){return s.apply(this,arguments)},KHR_materials_unlit.encode=function(e){var t=new n.default(e);if(t.materials){var r,a=i(t.json.materials||[]);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.unlit&&(delete s.unlit,t.addObjectExtension(s,o,{}),t.addExtension(o))}}catch(e){a.e(e)}finally{a.f()}}},KHR_materials_unlit.name=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireGltfScenegraph());function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o="KHR_materials_unlit";function s(){return s=(0,r.default)(t.default.mark((function e(r){var a,s,l,u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new n.default(r),s=i(a.json.materials||[]);try{for(s.s();!(l=s.n()).done;)(u=l.value).extensions&&u.extensions.KHR_materials_unlit&&(u.unlit=!0),a.removeObjectExtension(u,o)}catch(e){s.e(e)}finally{s.f()}a.removeExtension(o);case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}return KHR_materials_unlit.name=o,KHR_materials_unlit}var KHR_techniques_webgl={},hasRequiredKHR_techniques_webgl;function requireKHR_techniques_webgl(){if(hasRequiredKHR_techniques_webgl)return KHR_techniques_webgl;hasRequiredKHR_techniques_webgl=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_techniques_webgl,"__esModule",{value:!0}),KHR_techniques_webgl.decode=function(e){return l.apply(this,arguments)},KHR_techniques_webgl.encode=function(e,t){return u.apply(this,arguments)},KHR_techniques_webgl.name=void 0;var t=e(requireRegenerator()),r=e(_typeofExports),n=e(requireAsyncToGenerator()),i=e(requireGltfScenegraph());function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s="KHR_techniques_webgl";function l(){return l=(0,n.default)(t.default.mark((function e(r){var n,o,l,u,h,f,p,m;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new i.default(r),o=n.json,l=n.getExtension(s)){u=c(l,n),h=a(o.materials||[]);try{for(h.s();!(f=h.n()).done;)(m=n.getObjectExtension(p=f.value,s))&&(p.technique=Object.assign({},m,u[m.technique]),p.technique.values=d(p.technique,n)),n.removeObjectExtension(p,s)}catch(e){h.e(e)}finally{h.f()}n.removeExtension(s)}case 4:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function u(){return(u=(0,n.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t){var r=e.programs,n=void 0===r?[]:r,i=e.shaders,a=void 0===i?[]:i,o=e.techniques,s=void 0===o?[]:o,l=new TextDecoder;return a.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=l.decode(t.getTypedArrayForBufferView(e.bufferView))})),n.forEach((function(e){e.fragmentShader=a[e.fragmentShader],e.vertexShader=a[e.vertexShader]})),s.forEach((function(e){e.program=n[e.program]})),s}function d(e,t){var n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)})),Object.keys(n).forEach((function(e){"object"===(0,r.default)(n[e])&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))})),n}return KHR_techniques_webgl.name=s,KHR_techniques_webgl}var EXT_feature_metadata={},hasRequiredEXT_feature_metadata,hasRequiredGltfExtensions;function requireEXT_feature_metadata(){if(hasRequiredEXT_feature_metadata)return EXT_feature_metadata;hasRequiredEXT_feature_metadata=1;var e=interopRequireDefaultExports;Object.defineProperty(EXT_feature_metadata,"__esModule",{value:!0}),EXT_feature_metadata.decode=function(e){return a.apply(this,arguments)},EXT_feature_metadata.name=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireGltfScenegraph()),i="EXT_feature_metadata";function a(){return(a=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(new n.default(r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(e){var t,r=e.getExtension(i),n=null==r||null===(t=r.schema)||void 0===t?void 0:t.classes,a=null==r?void 0:r.featureTables;if((null==r?void 0:r.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),n&&a)for(var o in n){var l=n[o],c=u(a,o);c&&s(e,c,l)}}function s(e,t,r){for(var n in r.properties){var i,a=null==t||null===(i=t.properties)||void 0===i?void 0:i[n];if(a){var o=l(e,r.properties[n],t.count,a);a.data=o}}}function l(e,t,r,n){var i=e.getTypedArrayForBufferView(n.bufferView);return"STRING"===t.type&&(i=function(e,t,r){for(var n=[],i=new TextDecoder("utf8"),a=0,o=0;o<r;o++){var s=t[4*(o+1)]-t[4*o],l=e.subarray(a,s+a),u=i.decode(l);n.push(u),a+=s}return n}(i,e.getTypedArrayForBufferView(n.stringOffsetBufferView),r)),i}function u(e,t){for(var r in e){var n=e[r];if(n.class===t)return n}return null}return EXT_feature_metadata.name=i,EXT_feature_metadata}function requireGltfExtensions(){if(hasRequiredGltfExtensions)return gltfExtensions;hasRequiredGltfExtensions=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(gltfExtensions,"__esModule",{value:!0}),gltfExtensions.EXTENSIONS=void 0,gltfExtensions.decodeExtensions=function(e){return p.apply(this,arguments)},gltfExtensions.preprocessExtensions=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=d(f.filter((function(e){return m(e.name,r)})));try{for(i.s();!(t=i.n()).done;){var a,o=t.value;null===(a=o.preprocess)||void 0===a||a.call(o,e,r,n)}}catch(e){i.e(e)}finally{i.f()}};var r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=c(requireEXT_meshopt_compression()),a=c(requireEXT_texture_webp()),o=c(requireKHR_texture_basisu()),s=c(requireKHR_draco_mesh_compression()),l=c(requireKHR_texture_transform());function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function c(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=u(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f=[i,a,o,s,c(requireKHR_lights_punctual()),c(requireKHR_materials_unlit()),c(requireKHR_techniques_webgl()),l,c(requireEXT_feature_metadata())];function p(){return p=(0,n.default)(r.default.mark((function e(t){var n,i,a,o,s,l,u,c=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c.length>1&&void 0!==c[1]?c[1]:{},i=c.length>2?c[2]:void 0,a=f.filter((function(e){return m(e.name,n)})),o=d(a),e.prev=4,o.s();case 6:if((s=o.n()).done){e.next=12;break}return u=s.value,e.next=10,null===(l=u.decode)||void 0===l?void 0:l.call(u,t,n,i);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),o.e(e.t0);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])}))),p.apply(this,arguments)}function m(e,t){var r,n=(null==t||null===(r=t.gltf)||void 0===r?void 0:r.excludeExtensions)||{};return!(e in n&&!n[e])}return gltfExtensions.EXTENSIONS=f,gltfExtensions}var normalizeGltfV1={},KHR_binary_gltf={},hasRequiredKHR_binary_gltf,hasRequiredNormalizeGltfV1;function requireKHR_binary_gltf(){if(hasRequiredKHR_binary_gltf)return KHR_binary_gltf;hasRequiredKHR_binary_gltf=1;var e=interopRequireDefaultExports;Object.defineProperty(KHR_binary_gltf,"__esModule",{value:!0}),KHR_binary_gltf.name=void 0,KHR_binary_gltf.preprocess=function(e){var i,a=new t.default(e),o=a.json,s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(o.images||[]);try{for(s.s();!(i=s.n()).done;){var l=i.value,u=a.getObjectExtension(l,n);u&&Object.assign(l,u),a.removeObjectExtension(l,n)}}catch(e){s.e(e)}finally{s.f()}o.buffers&&o.buffers[0]&&delete o.buffers[0].uri,a.removeExtension(n)};var t=e(requireGltfScenegraph());function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var n="KHR_binary_glTF";return KHR_binary_gltf.name=n,KHR_binary_gltf}function requireNormalizeGltfV1(){if(hasRequiredNormalizeGltfV1)return normalizeGltfV1;hasRequiredNormalizeGltfV1=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(normalizeGltfV1,"__esModule",{value:!0}),normalizeGltfV1.normalizeGLTFV1=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new d).normalize(e,t)};var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=o(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=a?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(requireKHR_binary_gltf());function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var u={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},c={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},d=function(){function e(){(0,r.default)(this,e),(0,i.default)(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),(0,i.default)(this,"json",void 0)}return(0,n.default)(e,[{key:"normalize",value:function(e,t){this.json=e.json;var r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(r.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),a.preprocess(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var t in u)this._convertTopLevelObjectToArray(e,t)}},{key:"_convertTopLevelObjectToArray",value:function(e,t){var r=e[t];if(r&&!Array.isArray(r))for(var n in e[t]=[],r){var i=r[n];i.id=i.id||n;var a=e[t].length;e[t].push(i),this.idToIndexMap[t][n]=a}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var t in u)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var r,n=s(e.textures);try{for(n.s();!(r=n.n()).done;)this._convertTextureIds(r.value)}catch(e){n.e(e)}finally{n.f()}var i,a=s(e.meshes);try{for(a.s();!(i=a.n()).done;)this._convertMeshIds(i.value)}catch(e){a.e(e)}finally{a.f()}var o,l=s(e.nodes);try{for(l.s();!(o=l.n()).done;)this._convertNodeIds(o.value)}catch(e){l.e(e)}finally{l.f()}var c,d=s(e.scenes);try{for(d.s();!(c=d.n()).done;)this._convertSceneIds(c.value)}catch(e){d.e(e)}finally{d.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var t,r=s(e.primitives);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.attributes,a=n.indices,o=n.material;for(var l in i)i[l]=this._convertIdToIndex(i[l],"accessor");a&&(n.indices=this._convertIdToIndex(a,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}catch(e){r.e(e)}finally{r.f()}}},{key:"_convertNodeIds",value:function(e){var t=this;e.children&&(e.children=e.children.map((function(e){return t._convertIdToIndex(e,"node")}))),e.meshes&&(e.meshes=e.meshes.map((function(e){return t._convertIdToIndex(e,"mesh")})))}},{key:"_convertSceneIds",value:function(e){var t=this;e.nodes&&(e.nodes=e.nodes.map((function(e){return t._convertIdToIndex(e,"node")})))}},{key:"_convertIdsToIndices",value:function(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);var r,n=s(e[t]);try{for(n.s();!(r=n.n()).done;){var i=r.value;for(var a in i){var o=this._convertIdToIndex(i[a],a);i[a]=o}}}catch(e){n.e(e)}finally{n.f()}}},{key:"_convertIdToIndex",value:function(e,t){var r=c[t];if(r in this.idToIndexMap){var n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}},{key:"_updateObjects",value:function(e){var t,r=s(this.json.buffers);try{for(r.s();!(t=r.n()).done;)delete t.value.type}catch(e){r.e(e)}finally{r.f()}}},{key:"_updateMaterial",value:function(e){var t,r=s(e.materials);try{var n=function(){var r,n,i,a=t.value;a.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var o=(null===(r=a.values)||void 0===r?void 0:r.tex)||(null===(n=a.values)||void 0===n?void 0:n.texture2d_0)||(null===(i=a.values)||void 0===i?void 0:i.diffuseTex),s=e.textures.findIndex((function(e){return e.id===o}));-1!==s&&(a.pbrMetallicRoughness.baseColorTexture={index:s})};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}}]),e}();return normalizeGltfV1}var postProcessGltf={},hasRequiredPostProcessGltf;function requirePostProcessGltf(){if(hasRequiredPostProcessGltf)return postProcessGltf;hasRequiredPostProcessGltf=1;var e=interopRequireDefaultExports;Object.defineProperty(postProcessGltf,"__esModule",{value:!0}),postProcessGltf.postProcessGLTF=function(e,t){return(new p).postProcess(e,t)};var t,r=e(_typeofExports),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=requireAssert$6(),s=requireGltfUtils$1();function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},h={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},f=((0,a.default)(t={},10240,9729),(0,a.default)(t,10241,9986),(0,a.default)(t,10242,10497),(0,a.default)(t,10243,10497),t),p=function(){function e(){(0,n.default)(this,e),(0,a.default)(this,"baseUri",""),(0,a.default)(this,"json",{}),(0,a.default)(this,"buffers",[]),(0,a.default)(this,"images",[])}return(0,i.default)(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.json,n=e.buffers,i=void 0===n?[]:n,a=e.images,s=void 0===a?[]:a,l=e.baseUri,u=void 0===l?"":l;return(0,o.assert)(r),this.baseUri=u,this.json=r,this.buffers=i,this.images=s,this._resolveTree(this.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this;e.bufferViews&&(e.bufferViews=e.bufferViews.map((function(e,r){return t._resolveBufferView(e,r)}))),e.images&&(e.images=e.images.map((function(e,r){return t._resolveImage(e,r)}))),e.samplers&&(e.samplers=e.samplers.map((function(e,r){return t._resolveSampler(e,r)}))),e.textures&&(e.textures=e.textures.map((function(e,r){return t._resolveTexture(e,r)}))),e.accessors&&(e.accessors=e.accessors.map((function(e,r){return t._resolveAccessor(e,r)}))),e.materials&&(e.materials=e.materials.map((function(e,r){return t._resolveMaterial(e,r)}))),e.meshes&&(e.meshes=e.meshes.map((function(e,r){return t._resolveMesh(e,r)}))),e.nodes&&(e.nodes=e.nodes.map((function(e,r){return t._resolveNode(e,r)}))),e.skins&&(e.skins=e.skins.map((function(e,r){return t._resolveSkin(e,r)}))),e.scenes&&(e.scenes=e.scenes.map((function(e,r){return t._resolveScene(e,r)}))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,t){if("object"===(0,r.default)(t))return t;var n=this.json[e]&&this.json[e][t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}},{key:"_resolveScene",value:function(e,t){var r=this;return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((function(e){return r.getNode(e)})),e}},{key:"_resolveNode",value:function(e,t){var r=this;return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((function(e){return r.getNode(e)}))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce((function(e,t){var n=r.getMesh(t);return e.id=n.id,e.primitives=e.primitives.concat(n.primitives),e}),{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,t){var r=this;return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((function(e){var t=(e=u({},e)).attributes;for(var n in e.attributes={},t)e.attributes[n]=r.getAccessor(t[n]);return void 0!==e.indices&&(e.indices=r.getAccessor(e.indices)),void 0!==e.material&&(e.material=r.getMaterial(e.material)),e}))),e}},{key:"_resolveMaterial",value:function(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture=u({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=u({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=u({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness=u({},e.pbrMetallicRoughness);var r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture=u({},r.baseColorTexture),r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture=u({},r.metallicRoughnessTexture),r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,t){if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=d[e.componentType],e.components=function(e){return c[e]}(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var r=e.bufferView.buffer,n=(0,s.getAccessorArrayTypeAndLength)(e,e.bufferView),i=n.ArrayType,a=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset,o=r.arrayBuffer.slice(a,a+n.byteLength);e.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(r,a,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(o)}return e}},{key:"_getValueFromInterleavedBuffer",value:function(e,t,r,n,i){for(var a=new Uint8Array(i*n),o=0;o<i;o++){var s=t+o*r;a.set(new Uint8Array(e.arrayBuffer.slice(s,s+n)),o*n)}return a.buffer}},{key:"_resolveTexture",value:function(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):f,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,t){for(var r in e.id=e.id||"sampler-".concat(t),e.parameters={},e){var n=this._enumSamplerParameter(r);void 0!==n&&(e.parameters[n]=e[r])}return e}},{key:"_enumSamplerParameter",value:function(e){return h[e]}},{key:"_resolveImage",value:function(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));var r=this.images[t];return r&&(e.image=r),e}},{key:"_resolveBufferView",value:function(e,t){var r=e.buffer,n=u(u({id:"bufferView-".concat(t)},e),{},{buffer:this.buffers[r]}),i=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(i+=e.byteOffset),n.data=new Uint8Array(this.buffers[r].arrayBuffer,i,e.byteLength),n}},{key:"_resolveCamera",value:function(e,t){return e.id=e.id||"camera-".concat(t),e}}]),e}();return postProcessGltf}var parseGlb={},hasRequiredParseGlb,hasRequiredParseGltf,hasRequiredGltfLoader;function requireParseGlb(){if(hasRequiredParseGlb)return parseGlb;hasRequiredParseGlb=1,Object.defineProperty(parseGlb,"__esModule",{value:!0}),parseGlb.default=function(t,h){var f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=new DataView(h),m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}(p,f+0),g=p.getUint32(f+4,u),_=p.getUint32(f+8,u);switch(Object.assign(t,{header:{byteOffset:f,byteLength:_,hasBinChunk:!1},type:m,version:g,json:{},binChunks:[]}),f+=r,t.version){case 1:return function(t,i,a){(0,e.assert)(t.header.byteLength>r+n);var o=i.getUint32(a+0,u),s=i.getUint32(a+4,u);return a+=n,(0,e.assert)(s===l),c(t,i,a,o),(a+=o)+d(t,i,a,t.header.byteLength)}(t,p,f);case 2:return function(t,l,h,f){return(0,e.assert)(t.header.byteLength>r+n),function(t,r,l,h){for(;l+8<=t.header.byteLength;){var f=r.getUint32(l+0,u),p=r.getUint32(l+4,u);switch(l+=n,p){case i:c(t,r,l,f);break;case a:d(t,r,l,f);break;case o:h.strict||c(t,r,l,f);break;case s:h.strict||d(t,r,l,f)}l+=(0,e.padToNBytes)(f,4)}}(t,l,h,{}),h+t.header.byteLength}(t,p,f);default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}},parseGlb.isGLB=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=new DataView(e),a=n.magic,o=void 0===a?t:a,s=i.getUint32(r,!1);return s===o||s===t};var e=es5$t,t=1735152710,r=12,n=8,i=1313821514,a=5130562,o=0,s=1,l=0,u=!0;function c(t,r,n,i){var a=new Uint8Array(r.buffer,n,i),o=new TextDecoder("utf8").decode(a);return t.json=JSON.parse(o),(0,e.padToNBytes)(i,4)}function d(t,r,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:r.buffer}),(0,e.padToNBytes)(i,4)}return parseGlb}function requireParseGltf(){if(hasRequiredParseGltf)return parseGltf;hasRequiredParseGltf=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(parseGltf,"__esModule",{value:!0}),parseGltf.isGLTF=function(e,t){return(0,f.isGLB)(e,0,t)},parseGltf.parseGLTF=function(e,t){return _.apply(this,arguments)};var r=e(requireRegenerator()),n=e(requireAsyncToGenerator()),i=requireEs5$7(),a=requireEs5$8(),o=es5$t,s=requireAssert$6(),l=requireResolveUrl(),u=requireGetTypedArray(),c=requireGltfExtensions(),d=requireNormalizeGltfV1(),h=requirePostProcessGltf(),f=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=p(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireParseGlb());function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(){return _=(0,n.default)(r.default.mark((function e(t,n){var i,a,o,s,l,u,f,p,m,g=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=g.length>4?g[4]:void 0,y(t,n,g.length>2&&void 0!==g[2]?g[2]:0,l=g.length>3?g[3]:void 0),(0,d.normalizeGLTFV1)(t,{normalize:null==l||null===(i=l.gltf)||void 0===i?void 0:i.normalize}),(0,c.preprocessExtensions)(t,l,u),f=[],null==l||null===(a=l.gltf)||void 0===a||!a.loadBuffers||!t.json.buffers){e.next=10;break}return e.next=10,v(t,l,u);case 10:return null!=l&&null!==(o=l.gltf)&&void 0!==o&&o.loadImages&&(p=x(t,l,u),f.push(p)),m=(0,c.decodeExtensions)(t,l,u),f.push(m),e.next=15,Promise.all(f);case 15:return e.abrupt("return",null!=l&&null!==(s=l.gltf)&&void 0!==s&&s.postProcess?(0,h.postProcessGLTF)(t,l):t);case 16:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function y(e,t,r,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!(0,f.isGLB)(t,r,n)&&(t=(new TextDecoder).decode(t)),"string"==typeof t)e.json=(0,o.parseJSON)(t);else if(t instanceof ArrayBuffer){var i={};r=(0,f.default)(i,t,r,n.glb),(0,s.assert)("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else(0,s.assert)(!1,"GLTF: must be ArrayBuffer or string");if(e.buffers=new Array((e.json.buffers||[]).length).fill(null),e._glb&&e._glb.header.hasBinChunk){var a=e._glb.binChunks;e.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}e.images=new Array((e.json.images||[]).length).fill({})}function v(e,t,r){return b.apply(this,arguments)}function b(){return b=(0,n.default)(r.default.mark((function e(t,n,i){var a,o,u,c,d,h,f,p;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.json.buffers||[],o=0;case 2:if(!(o<a.length)){e.next=22;break}if(!(u=a[o]).uri){e.next=18;break}return(0,s.assert)(i.fetch),h=(0,l.resolveUrl)(u.uri,n),e.next=10,null==i||null===(c=i.fetch)||void 0===c?void 0:c.call(i,h);case 10:return f=e.sent,e.next=13,null==f||null===(d=f.arrayBuffer)||void 0===d?void 0:d.call(f);case 13:t.buffers[o]={arrayBuffer:p=e.sent,byteOffset:0,byteLength:p.byteLength},delete u.uri,e.next=19;break;case 18:null===t.buffers[o]&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(u.byteLength),byteOffset:0,byteLength:u.byteLength});case 19:++o,e.next=2;break;case 22:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function x(e,t,r){return T.apply(this,arguments)}function T(){return T=(0,n.default)(r.default.mark((function e(t,n,i){var a,o,s,l,u,c;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=w(t),o=t.json.images||[],s=[],l=m(a);try{for(l.s();!(u=l.n()).done;)s.push(E(t,o[c=u.value],c,n,i))}catch(e){l.e(e)}finally{l.f()}return e.next=7,Promise.all(s);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}function w(e){var t,r=new Set,n=m(e.json.textures||[]);try{for(n.s();!(t=n.n()).done;){var i=t.value;void 0!==i.source&&r.add(i.source)}}catch(e){n.e(e)}finally{n.f()}return Array.from(r).sort()}function E(e,t,r,n,i){return A.apply(this,arguments)}function A(){return A=(0,n.default)(r.default.mark((function e(t,n,c,d,h){var f,p,m,g,_,y,v;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=h.fetch,p=h.parse,!n.uri||n.hasOwnProperty("bufferView")){e.next=10;break}return g=(0,l.resolveUrl)(n.uri,d),e.next=5,f(g);case 5:return _=e.sent,e.next=8,_.arrayBuffer();case 8:n.bufferView={data:m=e.sent};case 10:return Number.isFinite(n.bufferView)&&(y=(0,u.getTypedArrayForBufferView)(t.json,t.buffers,n.bufferView),m=(0,o.sliceArrayBuffer)(y.buffer,y.byteOffset,y.byteLength)),(0,s.assert)(m,"glTF image has no data"),e.next=14,p(m,[a.ImageLoader,i.BasisLoader],{mimeType:n.mimeType,basis:d.basis||{format:(0,i.selectSupportedBasisFormat)()}},h);case 14:(v=e.sent)&&v[0]&&(v={compressed:!0,mipmaps:!1,width:v[0].width,height:v[0].height,data:v[0]}),t.images=t.images||[],t.images[c]=v;case 18:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}return parseGltf}function requireGltfLoader(){if(hasRequiredGltfLoader)return gltfLoader;hasRequiredGltfLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfLoader,"__esModule",{value:!0}),gltfLoader.GLTFLoader=void 0,gltfLoader.parse=u;var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=requireVersion$3(),a=requireParseGltf();function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={name:"glTF",id:"gltf",module:"gltf",version:i.VERSION,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:u,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function u(e){return c.apply(this,arguments)}function c(){return c=(0,n.default)(t.default.mark((function e(r){var n,i,o,u,c,d=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:{},i=d.length>2?d[2]:void 0,(n=s(s({},l.options),n)).gltf=s(s({},l.options.gltf),n.gltf),u=void 0===(o=n.byteOffset)?0:o,c={},e.next=8,(0,a.parseGLTF)(c,r,u,n,i);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}return gltfLoader.GLTFLoader=l,gltfLoader}var gltfWriter={},encodeGltf={},encodeGlb={},hasRequiredEncodeGlb,hasRequiredEncodeGltf,hasRequiredGltfWriter;function requireEncodeGlb(){if(hasRequiredEncodeGlb)return encodeGlb;hasRequiredEncodeGlb=1,Object.defineProperty(encodeGlb,"__esModule",{value:!0}),encodeGlb.default=function(a,o){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=a.magic,u=a.version,c=void 0===u?2:u,d=a.json,h=void 0===d?{}:d,f=a.binary,p=s;o&&(o.setUint32(s+0,void 0===l?t:l,i),o.setUint32(s+4,c,i),o.setUint32(s+8,0,i));var m=s+8,g=s+=12;o&&(o.setUint32(s+0,0,i),o.setUint32(s+4,r,i)),s+=8;var _=JSON.stringify(h);if(s=(0,e.copyPaddedStringToDataView)(o,s,_,4),o&&o.setUint32(g+0,s-g-8,i),f){var y=s;o&&(o.setUint32(s+0,0,i),o.setUint32(s+4,n,i)),s=(0,e.copyPaddedArrayBufferToDataView)(o,s+=8,f,4),o&&o.setUint32(y+0,s-y-8,i)}return o&&o.setUint32(m,s-p,i),s};var e=es5$t,t=1179937895,r=1313821514,n=5130562,i=!0;return encodeGlb}function requireEncodeGltf(){if(hasRequiredEncodeGltf)return encodeGltf;hasRequiredEncodeGltf=1;var e=interopRequireDefaultExports;Object.defineProperty(encodeGltf,"__esModule",{value:!0}),encodeGltf.encodeGLTFSync=function(e,r,n,i){return function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).firstBuffer;if(e.buffers&&e.buffers.length>(void 0===t?0:t))throw new Error("encodeGLTF: multiple buffers not yet implemented")}(e),(0,t.default)(e,r,n,i)};var t=e(requireEncodeGlb());return encodeGltf}function requireGltfWriter(){if(hasRequiredGltfWriter)return gltfWriter;hasRequiredGltfWriter=1,Object.defineProperty(gltfWriter,"__esModule",{value:!0}),gltfWriter._TypecheckGLBLoader=gltfWriter.GLTFWriter=void 0;var e=requireVersion$3(),t=requireEncodeGltf(),r={name:"glTF",id:"gltf",module:"gltf",version:e.VERSION,extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,encodeSync:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.byteOffset,i=void 0===n?0:n,a=(0,t.encodeGLTFSync)(e,null,i,r),o=new ArrayBuffer(a),s=new DataView(o);return(0,t.encodeGLTFSync)(e,s,i,r),o},options:{gltf:{}}};return gltfWriter.GLTFWriter=r,gltfWriter._TypecheckGLBLoader=r,gltfWriter}var glbLoader={},hasRequiredGlbLoader;function requireGlbLoader(){if(hasRequiredGlbLoader)return glbLoader;hasRequiredGlbLoader=1;var e=interopRequireDefaultExports;Object.defineProperty(glbLoader,"__esModule",{value:!0}),glbLoader._TypecheckGLBLoader=glbLoader.GLBLoader=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireVersion$3(),i=e(requireParseGlb()),a={name:"GLB",id:"glb",module:"gltf",version:n.VERSION,extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,parse:function(e,t){return o.apply(this,arguments)},parseSync:s,options:{glb:{strict:!1}}};function o(){return(o=(0,r.default)(t.default.mark((function e(r,n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s(r,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(e,t){var r=(t||{}).byteOffset,n={};return(0,i.default)(n,e,void 0===r?0:r,null==t?void 0:t.glb),n}return glbLoader.GLBLoader=a,glbLoader._TypecheckGLBLoader=a,glbLoader}var glbWriter={},hasRequiredGlbWriter,hasRequiredEs5$6;function requireGlbWriter(){if(hasRequiredGlbWriter)return glbWriter;hasRequiredGlbWriter=1;var e=interopRequireDefaultExports;Object.defineProperty(glbWriter,"__esModule",{value:!0}),glbWriter._TypecheckGLBLoader=glbWriter.GLBWriter=void 0;var t=requireVersion$3(),r=e(requireEncodeGlb()),n={name:"GLB",id:"glb",module:"gltf",version:t.VERSION,extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,encodeSync:function(e,t){var n=t.byteOffset,i=void 0===n?0:n,a=(0,r.default)(e,null,i,t),o=new ArrayBuffer(a),s=new DataView(o);return(0,r.default)(e,s,i,t),o},options:{glb:{}}};return glbWriter.GLBWriter=n,glbWriter._TypecheckGLBLoader=n,glbWriter}function requireEs5$6(){return hasRequiredEs5$6||(hasRequiredEs5$6=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"GLBLoader",{enumerable:!0,get:function(){return i.GLBLoader}}),Object.defineProperty(e,"GLBWriter",{enumerable:!0,get:function(){return a.GLBWriter}}),Object.defineProperty(e,"GLTFLoader",{enumerable:!0,get:function(){return r.GLTFLoader}}),Object.defineProperty(e,"GLTFScenegraph",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"GLTFWriter",{enumerable:!0,get:function(){return n.GLTFWriter}}),Object.defineProperty(e,"_getMemoryUsageGLTF",{enumerable:!0,get:function(){return l.getMemoryUsageGLTF}}),Object.defineProperty(e,"postProcessGLTF",{enumerable:!0,get:function(){return s.postProcessGLTF}});var r=requireGltfLoader(),n=requireGltfWriter(),i=requireGlbLoader(),a=requireGlbWriter(),o=t(requireGltfScenegraph()),s=requirePostProcessGltf(),l=requireGltfUtils$1()}(es5$j)),es5$j}var es5Exports$1=requireEs5$6();const GLTF_FORMAT={URI:0,EMBEDDED:1};function parse3DTileGLTFViewSync(e,t,r,n){e.rotateYtoZ=!0;const i=e.byteOffset+e.byteLength-r;if(0===i)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=es5$t.sliceArrayBuffer(t,r,i),e.gltfByteOffset=0,e.gltfByteLength=i,r%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}async function extractGLTF(e,t,r,n){const i=r["3d-tiles"]||{};if(extractGLTFBufferOrURL(e,t),i.loadGLTF){const{parse:t,fetch:i}=n;e.gltfUrl&&(e.gltfArrayBuffer=await i(e.gltfUrl,r),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.gltf=await t(e.gltfArrayBuffer,es5Exports$1.GLTFLoader,r,n),e.gpuMemoryUsageInBytes=es5Exports$1._getMemoryUsageGLTF(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength)}}function extractGLTFBufferOrURL(e,t,r){switch(t){case GLTF_FORMAT.URI:const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=(new TextDecoder).decode(t);e.gltfUrl=r.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case GLTF_FORMAT.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function parseBatchedModel3DTile(e,t,r,n,i){var a;r=parseBatchedModel(e,t,r,n),await extractGLTF(e,GLTF_FORMAT.EMBEDDED,n,i);const o=null==e||null===(a=e.gltf)||void 0===a?void 0:a.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),r}function parseBatchedModel(e,t,r,n,i){r=parse3DTileGLTFViewSync(e,t,r=parse3DTileTablesSync(e,t,r=parse3DTileTablesHeaderSync(e,t,r=parse3DTileHeaderSync(e,t,r))),n);const a=new Tile3DFeatureTable(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",es5$k.GL.FLOAT,3),r}async function parseInstancedModel3DTile(e,t,r,n,i){return r=parseInstancedModel(e,t,r,n),await extractGLTF(e,e.gltfFormat,n,i),r}function parseInstancedModel(e,t,r,n,i){if(r=parse3DTileHeaderSync(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=parse3DTileTablesHeaderSync(e,t,r);const a=new DataView(t);if(e.gltfFormat=a.getUint32(r,!0),r=parse3DTileGLTFViewSync(e,t,r=parse3DTileTablesSync(e,t,r+=4),n),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Tile3DFeatureTable(e.featureTableJson,e.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",es5$k.GL.FLOAT,3),extractInstancedAttributes(e,o,new Tile3DBatchTableParser(e.batchTableJson,e.batchTableBinary,s),s),r}function extractInstancedAttributes(e,t,r,n){const i=new Array(n),a=new es5$q.Vector3;new es5$q.Vector3,new es5$q.Vector3,new es5$q.Vector3;const o=new es5$q.Matrix3,s=new es5$q.Quaternion,l=new es5$q.Vector3,u={},c=new es5$q.Matrix4,d=[],h=[],f=new es5$q.Vector3,p=new es5$q.Vector3;for(let r=0;r<n;r++){let n;if(t.hasProperty("POSITION"))n=t.getProperty("POSITION",es5$k.GL.FLOAT,3,r,a);else if(t.hasProperty("POSITION_QUANTIZED")){n=t.getProperty("POSITION_QUANTIZED",es5$k.GL.UNSIGNED_SHORT,3,r,a);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",es5$k.GL.FLOAT,3,f);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",es5$k.GL.FLOAT,3,p);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let t=0;t<3;t++)n[t]=n[t]/o*i[t]+e[t]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(n),u.translation=a,e.normalUp=t.getProperty("NORMAL_UP",es5$k.GL.FLOAT,3,r,d),e.normalRight=t.getProperty("NORMAL_RIGHT",es5$k.GL.FLOAT,3,r,h),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",es5$k.GL.UNSIGNED_SHORT,2,d),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",es5$k.GL.UNSIGNED_SHORT,2,h),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(es5$p.Ellipsoid.WGS84.eastNorthUpToFixedFrame(a,c),c.getRotationMatrix3(o)):o.identity()}s.fromMatrix3(o),u.rotation=s,l.set(1,1,1);const m=t.getProperty("SCALE",es5$k.GL.FLOAT,1,r);Number.isFinite(m)&&l.multiplyByScalar(m);const g=t.getProperty("SCALE_NON_UNIFORM",es5$k.GL.FLOAT,3,r,d);g&&l.scale(g),u.scale=l;let _=t.getProperty("BATCH_ID",es5$k.GL.UNSIGNED_SHORT,1,r);void 0===_&&(_=r);const y=(new es5$q.Matrix4).fromQuaternion(u.rotation);c.identity(),c.translate(u.translation),c.multiplyRight(y),c.scale(u.scale);const v=c.clone();i[r]={modelMatrix:v,batchId:_}}e.instances=i}async function parseComposite3DTile(e,t,r,n,i,a){r=parse3DTileHeaderSync(e,t,r);const o=new DataView(t);for(e.tilesLength=o.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&e.byteLength-r>12;){const o={};e.tiles.push(o),r=await a(t,r,n,i,o)}return r}async function parseGltf3DTile(e,t,r,n){e.rotateYtoZ=!0,e.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=n;e.gltf=await i(t,es5Exports$1.GLTFLoader,r,n),e.gpuMemoryUsageInBytes=es5Exports$1._getMemoryUsageGLTF(e.gltf)}async function parse3DTile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};switch(i.byteOffset=t,i.type=getMagicString(e,t),i.type){case TILE3D_TYPE.COMPOSITE:return await parseComposite3DTile(i,e,t,r,n,parse3DTile);case TILE3D_TYPE.BATCHED_3D_MODEL:return await parseBatchedModel3DTile(i,e,t,r,n);case TILE3D_TYPE.GLTF:return await parseGltf3DTile(i,e,r,n);case TILE3D_TYPE.INSTANCED_3D_MODEL:return await parseInstancedModel3DTile(i,e,t,r,n);case TILE3D_TYPE.POINT_CLOUD:return await parsePointCloud3DTile(i,e,t,r,n);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const SUBTREE_FILE_MAGIC=1952609651,SUBTREE_FILE_VERSION=1;async function parse3DTilesSubtree(e,t,r){if(new Uint32Array(e.slice(0,4))[0]!==SUBTREE_FILE_MAGIC)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==SUBTREE_FILE_VERSION)throw new Error("Wrong subtree file verson, must be 1");const n=parseUint64Value(e.slice(8,16)),i=new Uint8Array(e,24,n),a=new TextDecoder("utf8").decode(i),o=JSON.parse(a),s=parseUint64Value(e.slice(16,24));let l=new ArrayBuffer(0);return s&&(l=e.slice(24+n)),"bufferView"in o.tileAvailability&&(o.tileAvailability.explicitBitstream=await getExplicitBitstream(o,"tileAvailability",l,r)),"bufferView"in o.contentAvailability&&(o.contentAvailability.explicitBitstream=await getExplicitBitstream(o,"contentAvailability",l,r)),"bufferView"in o.childSubtreeAvailability&&(o.childSubtreeAvailability.explicitBitstream=await getExplicitBitstream(o,"childSubtreeAvailability",l,r)),o}function resolveBufferUri(e,t){if(t.startsWith("http")){const r=new URL(e,t);return decodeURI(r.toString())}const r="http://".concat(t),n=new URL(e,r);return"/".concat(n.host).concat(n.pathname)}async function getExplicitBitstream(e,t,r,n){const i=e.bufferViews[e[t].bufferView],a=e.buffers[i.buffer];if(null==n||!n.url||!n.fetch)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const e=resolveBufferUri(a.uri,null==n?void 0:n.url),t=await n.fetch(e),r=await t.arrayBuffer();return new Uint8Array(r,i.byteOffset,i.byteLength)}return new Uint8Array(r,i.byteOffset,i.byteLength)}function parseUint64Value(e){const t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}const Tile3DSubtreeLoader$1={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:VERSION$2,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:parse3DTilesSubtree,options:{}};
/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function isLong(e){return!0===(e&&e.__isLong__)}function ctz32(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=UINT_CACHE[e])?n:(r=fromBits(e,0,!0),i&&(UINT_CACHE[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=INT_CACHE[e])?n:(r=fromBits(e,e<0?-1:0,!1),i&&(INT_CACHE[e]=r),r)}function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}function fromBits(e,t,r){return new Long(e,t,r)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?UZERO:ZERO;if((r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return fromString(e.substring(1),t,r).neg();for(var i=fromNumber(pow_dbl(r,8)),a=ZERO,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),l=parseInt(e.substring(o,o+s),r);if(s<8){var u=fromNumber(pow_dbl(r,s));a=a.mul(u).add(fromNumber(l))}else a=(a=a.mul(i)).add(fromNumber(l))}return a.unsigned=t,a}function fromValue(e,t){return"number"==typeof e?fromNumber(e,t):"string"==typeof e?fromString(e,t):fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var t=fromNumber(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=fromNumber(pow_dbl(e,6),this.unsigned),a=this,o="";;){var s=a.div(i),l=(a.sub(s.mul(i)).toInt()>>>0).toString(e);if((a=s).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return 1==(1&this.low)},LongPrototype.isEven=function(){return 0==(1&this.low)},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return this.comp(e)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=0,r=0,n=0,i=0;return n+=(i+=(65535&this.low)+(65535&e.low))>>>16,r+=(n+=(this.low>>>16)+(e.low>>>16))>>>16,t+=(r+=(65535&this.high)+(65535&e.high))>>>16,t+=(this.high>>>16)+(e.high>>>16),fromBits((n&=65535)<<16|(i&=65535),(t&=65535)<<16|(r&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return this;if(isLong(e)||(e=fromValue(e)),wasm)return fromBits(wasm.mul(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned);if(e.isZero())return this.unsigned?UZERO:ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=65535&this.high,r=this.low>>>16,n=65535&this.low,i=65535&e.high,a=e.low>>>16,o=65535&e.low,s=0,l=0,u=0,c=0;return u+=(c+=n*o)>>>16,l+=(u+=r*o)>>>16,u&=65535,l+=(u+=n*a)>>>16,s+=(l+=t*o)>>>16,l&=65535,s+=(l+=r*a)>>>16,l&=65535,s+=(l+=n*i)>>>16,s+=(this.high>>>16)*o+t*a+r*i+n*(e.high>>>16),fromBits((u&=65535)<<16|(c&=65535),(s&=65535)<<16|(l&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var t,r,n;if(wasm)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;n=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(t=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(r=this.sub(e.mul(t)),n=t.add(r.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=ZERO}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var i=Math.ceil(Math.log(t)/Math.LN2),a=i<=48?1:pow_dbl(2,i-48),o=fromNumber(t),s=o.mul(e);s.isNegative()||s.gt(r);)s=(o=fromNumber(t-=a,this.unsigned)).mul(e);o.isZero()&&(o=ONE),n=n.add(o),r=r.sub(s)}return n},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},LongPrototype.clz=LongPrototype.countLeadingZeros,LongPrototype.countTrailingZeros=function(){return this.low?ctz32(this.low):ctz32(this.high)+32},LongPrototype.ctz=LongPrototype.countTrailingZeros,LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):fromBits(32===e?this.high:this.high>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.rotateLeft=function(e){var t;return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?fromBits(this.high,this.low,this.unsigned):e<32?fromBits(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):fromBits(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},LongPrototype.rotl=LongPrototype.rotateLeft,LongPrototype.rotateRight=function(e){var t;return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?fromBits(this.high,this.low,this.unsigned):e<32?fromBits(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):fromBits(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},LongPrototype.rotr=LongPrototype.rotateRight,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long.fromBytes=function(e,t,r){return r?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)},Long.fromBytesLE=function(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long.fromBytesBE=function(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const MAXIMUM_TOKEN_LENGTH=16;function getS2CellIdFromToken(e){"X"===e&&(e="");const t=e.padEnd(MAXIMUM_TOKEN_LENGTH,"0");return Long.fromString(t,!0,16)}function getS2TokenFromCellId(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;const r=t;t*=4;const n=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-n.length).join("0")+n}function getS2ChildCellId(e,t){const r=lsb(e).shiftRightUnsigned(2);return e.add(Long.fromNumber(2*t+1-4).multiply(r))}function lsb(e){return e.and(e.not().add(1))}const FACE_BITS=3,MAX_LEVEL=30,POS_BITS=2*MAX_LEVEL+1,RADIAN_TO_DEGREE=180/Math.PI;function getS2CellFromQuadKey(e){if(0===e.length)throw new Error("Invalid Hilbert quad key ".concat(e));const t=e.split("/"),r=parseInt(t[0],10),n=t[1],i=n.length;let a=0;const o=[0,0];for(let e=i-1;e>=0;e--){a=i-e;const t=n[e];let r=0,s=0;"1"===t?s=1:"2"===t?(r=1,s=1):"3"===t&&(r=1);const l=Math.pow(2,a-1);rotateAndFlipQuadrant(l,o,r,s),o[0]+=l*r,o[1]+=l*s}if(r%2==1){const e=o[0];o[0]=o[1],o[1]=e}return{face:r,ij:o,level:a}}function getS2QuadkeyFromCellId(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<FACE_BITS+POS_BITS;)t="0"+t;const r=t.lastIndexOf("1"),n=t.substring(0,3),i=t.substring(3,r),a=i.length/2,o=Long.fromString(n,!0,2).toString(10);let s="";if(0!==a)for(s=Long.fromString(i,!0,2).toString(4);s.length<a;)s="0"+s;return"".concat(o,"/").concat(s)}function IJToST(e,t,r){const n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function singleSTtoUV(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function STToUV(e){return[singleSTtoUV(e[0]),singleSTtoUV(e[1])]}function FaceUVToXYZ(e,t){let[r,n]=t;switch(e){case 0:return[1,r,n];case 1:return[-r,1,n];case 2:return[-r,-n,1];case 3:return[-1,-n,-r];case 4:return[n,-1,-r];case 5:return[n,r,-1];default:throw new Error("Invalid face")}}function XYZToLngLat(e){let[t,r,n]=e;const i=Math.atan2(n,Math.sqrt(t*t+r*r));return[Math.atan2(r,t)*RADIAN_TO_DEGREE,i*RADIAN_TO_DEGREE]}function rotateAndFlipQuadrant(e,t,r,n){if(0===n){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function getS2LngLatFromS2Cell(e){const t=STToUV(IJToST(e.ij,e.level,[.5,.5]));return XYZToLngLat(FaceUVToXYZ(e.face,t))}const MAX_RESOLUTION=100;function getS2BoundaryFlatFromS2Cell(e){const{face:t,ij:r,level:n}=e,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(MAX_RESOLUTION*Math.pow(2,-n))),o=new Float64Array(4*a*2+2);let s=0,l=0;for(let e=0;e<4;e++){const u=i[e].slice(0),c=i[e+1],d=(c[0]-u[0])/a,h=(c[1]-u[1])/a;for(let e=0;e<a;e++){u[0]+=d,u[1]+=h;const e=XYZToLngLat(FaceUVToXYZ(t,STToUV(IJToST(r,n,u))));Math.abs(e[1])>89.999&&(e[0]=l);const i=e[0]-l;e[0]+=i>180?-360:i<-180?360:0,o[s++]=e[0],o[s++]=e[1],l=e[0]}}return o[s++]=o[0],o[s++]=o[1],o}function getS2Cell(e){return getS2CellFromQuadKey(getS2QuadKey(e))}function getS2QuadKey(e){return e.indexOf("/")>0?e:getS2QuadkeyFromCellId(getS2CellIdFromToken(e))}function getS2LngLat(e){return getS2LngLatFromS2Cell(getS2Cell(e))}function getS2Region(e){let t;if(2===e.face||5===e.face){let r=null,n=0;for(let t=0;t<4;t++){const i=getS2BoundaryFlatFromS2Cell(getS2Cell("".concat(e.face,"/").concat(t)));null==r&&(r=new Float64Array(4*i.length)),r.set(i,n),n+=i.length}t=get2DRegionFromS2Corners(r)}else t=get2DRegionFromS2Corners(getS2BoundaryFlatFromS2Cell(e));return t}function get2DRegionFromS2Corners(e){if(e.length%2!=0)throw new Error("Invalid corners");const t=[],r=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),r.push(e[n+1]);return t.sort(((e,t)=>e-t)),r.sort(((e,t)=>e-t)),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function getS2OrientedBoundingBoxCornerPoints(e,t){const r=(null==t?void 0:t.minimumHeight)||0,n=(null==t?void 0:t.maximumHeight)||0,i=getS2Region(getS2Cell(e)),a=i.west,o=i.south,s=i.east,l=i.north,u=[];return u.push(new es5$q.Vector3(a,l,r)),u.push(new es5$q.Vector3(s,l,r)),u.push(new es5$q.Vector3(s,o,r)),u.push(new es5$q.Vector3(a,o,r)),u.push(new es5$q.Vector3(a,l,n)),u.push(new es5$q.Vector3(s,l,n)),u.push(new es5$q.Vector3(s,o,n)),u.push(new es5$q.Vector3(a,o,n)),u}var es5Exports=requireEs5$a();function convertS2BoundingVolumetoOBB(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=getS2OrientedBoundingBoxCornerPoints(t,r),i=getS2LngLat(t),a=es5$p.Ellipsoid.WGS84.cartographicToCartesian([i[0],i[1],r.maximumHeight]),o=new es5$q.Vector3(a[0],a[1],a[2]);n.push(o);const s=es5Exports.makeOrientedBoundingBoxFromPoints(n);return[...s.center,...s.halfAxes]}const QUADTREE_DEVISION_COUNT=4,OCTREE_DEVISION_COUNT=8,SUBDIVISION_COUNT_MAP={QUADTREE:QUADTREE_DEVISION_COUNT,OCTREE:OCTREE_DEVISION_COUNT};function getChildS2VolumeBox(e,t,r){if(null!=e&&e.box){const n=getS2TokenFromCellId(getS2ChildCellId(getS2CellIdFromToken(e.s2VolumeInfo.token),t)),i={...e.s2VolumeInfo};if(i.token=n,"OCTREE"===r){const t=e.s2VolumeInfo,r=t.maximumHeight-t.minimumHeight,n=r/2,i=t.minimumHeight+r/2;t.minimumHeight=i-n,t.maximumHeight=i+n}return{box:convertS2BoundingVolumetoOBB(i),s2VolumeInfo:i}}}async function parseImplicitTiles(e){const{options:t,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:a}=e;let{subtree:o,level:s=0}=e;const{subdivisionScheme:l,subtreeLevels:u,maximumLevel:c,contentUrlTemplate:d,subtreesUriTemplate:h,basePath:f}=t,p={children:[],lodMetricValue:0,contentUrl:""},m=SUBDIVISION_COUNT_MAP[l],g=1&n,_=n>>1&1,y=n>>2&1,v=(m**s-1)/(m-1);let b=concatBits(r.mortonIndex,n),x=v+b,T=concatBits(r.x,g),w=concatBits(r.y,_),E=concatBits(r.z,y),A=!1;s+1>u&&(A=getAvailabilityResult(o.childSubtreeAvailability,b));const S=concatBits(i.x,T),P=concatBits(i.y,w),M=concatBits(i.z,E),R=s+i.level;if(A){const e=replaceContentUrlTemplate("".concat(f,"/").concat(h),R,S,P,M);o=await es5$n.load(e,Tile3DSubtreeLoader$1),i.mortonIndex=b,i.x=T,i.y=w,i.z=E,i.level=s,b=0,x=0,T=0,w=0,E=0,s=0}if(!getAvailabilityResult(o.tileAvailability,x)||s>c)return p;getAvailabilityResult(o.contentAvailability,x)&&(p.contentUrl=replaceContentUrlTemplate(d,R,S,P,M));const C=s+1,O={mortonIndex:b,x:T,y:w,z:E};for(let e=0;e<m;e++){const r=getChildS2VolumeBox(a,e,l),n=await parseImplicitTiles({subtree:o,options:t,parentData:O,childIndex:e,level:C,globalData:i,s2VolumeBox:r});if(n.contentUrl||n.children.length){const e=formatTileData(n,R+1,{childTileX:T,childTileY:w,childTileZ:E},t,a);p.children.push(e)}}return p}function getAvailabilityResult(e,t){return"constant"in e?Boolean(e.constant):!!e.explicitBitstream&&getBooleanValueFromBitstream(t,e.explicitBitstream)}function formatTileData(e,t,r,n,i){const{basePath:a,refine:o,getRefine:s,lodMetricType:l,getTileType:u,rootLodMetricValue:c,rootBoundingVolume:d}=n,h=e.contentUrl&&e.contentUrl.replace("".concat(a,"/"),""),f=c/2**t,p=calculateBoundingVolumeForChildTile(t,null!=i&&i.box?{box:i.box}:d,r);return{children:e.children,contentUrl:e.contentUrl,content:{uri:h},id:e.contentUrl,refine:s(o),type:u(e),lodMetricType:l,lodMetricValue:f,geometricError:f,transform:e.transform,boundingVolume:p}}function calculateBoundingVolumeForChildTile(e,t,r){if(t.region){const{childTileX:n,childTileY:i,childTileZ:a}=r,[o,s,l,u,c,d]=t.region,h=2**e,f=(l-o)/h,p=(u-s)/h,m=(d-c)/h,[g,_]=[o+f*n,o+f*(n+1)],[y,v]=[s+p*i,s+p*(i+1)],[b,x]=[c+m*a,c+m*(a+1)];return{region:[g,y,_,v,b,x]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function concatBits(e,t){return parseInt(e.toString(2)+t.toString(2),2)}function replaceContentUrlTemplate(e,t,r,n,i){const a=generateMapUrl({level:t,x:r,y:n,z:i});return e.replace(/{level}|{x}|{y}|{z}/gi,(e=>a[e]))}function generateMapUrl(e){const t={};for(const r in e)t["{".concat(r,"}")]=e[r];return t}function getBooleanValueFromBitstream(e,t){return 1==(t[Math.floor(e/8)]>>e%8&1)}function getTileType(e){if(!e.contentUrl)return es5$r.TILE_TYPE.EMPTY;const t=e.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return es5$r.TILE_TYPE.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return es5$r.TILE_TYPE.SCENEGRAPH;default:return t}}function getRefine(e){switch(e){case"REPLACE":case"replace":return es5$r.TILE_REFINEMENT.REPLACE;case"ADD":case"add":return es5$r.TILE_REFINEMENT.ADD;default:return e}}function resolveUri(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const r=new URL(e,"".concat(t,"/"));return decodeURI(r.toString())}return e.startsWith("/")?e:"".concat(t,"/").concat(e)}function normalizeTileData(e,t){return e?(e.content&&(e.contentUrl=resolveUri(e.content.uri||e.content.url,t.basePath)),e.id=e.contentUrl,e.lodMetricType=es5$r.LOD_METRIC_TYPE.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=getTileType(e),e.refine=getRefine(e.refine),e):null}async function normalizeTileHeaders(e,t){const r=e.basePath;let n;const i=getImplicitTilingExtensionData(null==e?void 0:e.root);n=i&&e.root?await normalizeImplicitTileHeaders(e.root,e,i,t):normalizeTileData(e.root,e);const a=[];for(a.push(n);a.length>0;){const n=(a.pop()||{}).children||[];for(let i of n){const n=getImplicitTilingExtensionData(i);n?i=await normalizeImplicitTileHeaders(i,e,n,t):normalizeTileData(i,{basePath:r}),a.push(i)}}return n}async function normalizeImplicitTileHeaders(e,t,r,n){var i,a;const o=t.basePath,{subdivisionScheme:s,maximumLevel:l,subtreeLevels:u,subtrees:{uri:c}}=r,d=resolveUri(replaceContentUrlTemplate(c,0,0,0,0),o),h=await es5$n.load(d,Tile3DSubtreeLoader$1,n),f=resolveUri(e.content.uri,o),p=null==t||null===(i=t.root)||void 0===i?void 0:i.refine,m=e.geometricError,g=null===(a=e.boundingVolume.extensions)||void 0===a?void 0:a["3DTILES_bounding_volume_S2"];if(g){const t=convertS2BoundingVolumetoOBB(g);e.boundingVolume={box:t,s2VolumeInfo:g}}const _={contentUrlTemplate:f,subtreesUriTemplate:c,subdivisionScheme:s,subtreeLevels:u,maximumLevel:l,refine:p,basePath:o,lodMetricType:es5$r.LOD_METRIC_TYPE.GEOMETRIC_ERROR,rootLodMetricValue:m,rootBoundingVolume:e.boundingVolume,getTileType:getTileType,getRefine:getRefine};return await normalizeImplicitTileData(e,h,_)}async function normalizeImplicitTileData(e,t,r){if(!e)return null;e.lodMetricType=es5$r.LOD_METRIC_TYPE.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform;const{children:n,contentUrl:i}=await parseImplicitTiles({subtree:t,options:r,s2VolumeBox:e});return i&&(e.contentUrl=i,e.content={uri:i.replace("".concat(r.basePath,"/"),"")}),e.refine=getRefine(e.refine),e.type=getTileType(e),e.children=n,e.id=e.contentUrl,e}function getImplicitTilingExtensionData(e){var t;return(null==e||null===(t=e.extensions)||void 0===t?void 0:t["3DTILES_implicit_tiling"])||(null==e?void 0:e.implicitTiling)}const Tiles3DLoader$1={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:VERSION$2,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:parse$1,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function getBaseUri$1(e){return es5$t.path.dirname(e.url)}async function parseTile$1(e,t,r){const n={featureIds:null};return await parse3DTile(e,0,t,r,n),n}async function parseTileset$1(e,t,r){var n;const i=JSON.parse((new TextDecoder).decode(e));return i.loader=t.loader||Tiles3DLoader$1,i.url=r.url,i.queryString=r.queryString,i.basePath=getBaseUri$1(i),i.root=await normalizeTileHeaders(i,t),i.type=es5$r.TILESET_TYPE.TILES3D,i.lodMetricType=es5$r.LOD_METRIC_TYPE.GEOMETRIC_ERROR,i.lodMetricValue=(null===(n=i.root)||void 0===n?void 0:n.lodMetricValue)||0,i}async function parse$1(e,t,r){const n=t["3d-tiles"]||{};let i;return i="auto"===n.isTileset?r.url&&-1!==r.url.indexOf(".json"):n.isTileset,i?await parseTileset$1(e,t,r):await parseTile$1(e,t,r)}var es5$g={},init$2={},log$4={},es5$f={},log$3={},es5$e={},globals$2={},isBrowser$1={},isElectron={},hasRequiredIsElectron,hasRequiredIsBrowser;function requireIsElectron(){if(hasRequiredIsElectron)return isElectron;hasRequiredIsElectron=1;var e=interopRequireDefaultExports;Object.defineProperty(isElectron,"__esModule",{value:!0}),isElectron.default=function(e){if("undefined"!=typeof window&&"object"===(0,t.default)(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===(0,t.default)(process.versions)&&Boolean(process.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":(0,t.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||r;return!!(n&&n.indexOf("Electron")>=0)};var t=e(_typeofExports);return isElectron}function requireIsBrowser(){if(hasRequiredIsBrowser)return isBrowser$1;hasRequiredIsBrowser=1;var e=interopRequireDefaultExports;Object.defineProperty(isBrowser$1,"__esModule",{value:!0}),isBrowser$1.default=n,isBrowser$1.isBrowserMainThread=function(){return n()&&"undefined"!=typeof document};var t=e(_typeofExports),r=e(requireIsElectron());function n(){return!("object"===("undefined"==typeof process?"undefined":(0,t.default)(process))&&"[object process]"===String(process)&&!process.browser)||(0,r.default)()}return isBrowser$1}var globals$1={},hasRequiredGlobals$2,hasRequiredGlobals$1;function requireGlobals$2(){if(hasRequiredGlobals$2)return globals$1;hasRequiredGlobals$2=1;var e=interopRequireDefaultExports;Object.defineProperty(globals$1,"__esModule",{value:!0}),globals$1.window=globals$1.self=globals$1.process=globals$1.global=globals$1.document=globals$1.console=void 0;var t=e(_typeofExports),r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":(0,t.default)(process))&&process},n=globalThis;globals$1.global=n,globals$1.self=r.self||r.window||r.global,globals$1.window=r.window||r.self||r.global,globals$1.document=r.document||{},globals$1.process=r.process||{};var i=console;return globals$1.console=i,globals$1}function requireGlobals$1(){return hasRequiredGlobals$1||(hasRequiredGlobals$1=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION=void 0,Object.defineProperty(e,"console",{enumerable:!0,get:function(){return n.console}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return n.document}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return n.global}}),e.isBrowser=void 0,Object.defineProperty(e,"process",{enumerable:!0,get:function(){return n.process}}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return n.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return n.window}});var r=t(requireIsBrowser()),n=requireGlobals$2(),i="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";e.VERSION=i;var a=(0,r.default)();e.isBrowser=a}(globals$2)),globals$2}var getBrowser={},hasRequiredGetBrowser;function requireGetBrowser(){if(hasRequiredGetBrowser)return getBrowser;hasRequiredGetBrowser=1;var e=interopRequireDefaultExports;Object.defineProperty(getBrowser,"__esModule",{value:!0}),getBrowser.default=function(e){if(!e&&!(0,t.default)())return"Node";if((0,r.default)(e))return"Electron";var i="undefined"!=typeof navigator?navigator:{},a=e||i.userAgent||"";if(a.indexOf("Edge")>-1)return"Edge";var o=-1!==a.indexOf("MSIE "),s=-1!==a.indexOf("Trident/");return o||s?"IE":n.chrome?"Chrome":n.safari?"Safari":n.mozInnerScreenX?"Firefox":"Unknown"},getBrowser.isMobile=function(){return void 0!==n.orientation};var t=e(requireIsBrowser()),r=e(requireIsElectron()),n=globalThis;return getBrowser}var assert$8={},hasRequiredAssert$5,hasRequiredEs5$5;function requireAssert$5(){return hasRequiredAssert$5||(hasRequiredAssert$5=1,Object.defineProperty(assert$8,"__esModule",{value:!0}),assert$8.default=function(e,t){if(!e)throw new Error(t||"Assertion failed")}),assert$8}function requireEs5$5(){return hasRequiredEs5$5||(hasRequiredEs5$5=1,function(e){var t=interopRequireDefaultExports,r=_typeofExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"VERSION",{enumerable:!0,get:function(){return n.VERSION}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"console",{enumerable:!0,get:function(){return i.console}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return i.document}}),Object.defineProperty(e,"getBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return i.global}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"isBrowserMainThread",{enumerable:!0,get:function(){return a.isBrowserMainThread}}),Object.defineProperty(e,"isElectron",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return o.isMobile}}),Object.defineProperty(e,"process",{enumerable:!0,get:function(){return i.process}}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return i.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return i.window}});var n=requireGlobals$1(),i=requireGlobals$2(),a=c(requireIsBrowser()),o=c(requireGetBrowser()),s=t(requireIsElectron()),l=t(requireAssert$5());function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}}(es5$e)),es5$e}var localStorage={},hasRequiredLocalStorage;function requireLocalStorage(){if(hasRequiredLocalStorage)return localStorage;hasRequiredLocalStorage=1;var e=interopRequireDefaultExports;Object.defineProperty(localStorage,"__esModule",{value:!0}),localStorage.LocalStorage=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(r,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";(0,t.default)(this,e),(0,n.default)(this,"storage",void 0),(0,n.default)(this,"id",void 0),(0,n.default)(this,"config",void 0),this.storage=function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(a),this.id=r,this.config=i,this._loadConfiguration()}return(0,r.default)(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();return localStorage.LocalStorage=i,localStorage}var formatters={},hasRequiredFormatters;function requireFormatters(){return hasRequiredFormatters||(hasRequiredFormatters=1,Object.defineProperty(formatters,"__esModule",{value:!0}),formatters.formatImage=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));var a=e.width*r,o=e.height*r,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),s]},formatters.formatTime=function(e){return e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s")},formatters.formatValue=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.isInteger,i=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,r){for(var n=r.maxElts,i=void 0===n?16:n,a=r.size,o=void 0===a?1:a,s="[",l=0;l<t.length&&l<i;++l)l>0&&(s+=",".concat(l%o==0?" ":"")),s+=e(t[l],r);var u=t.length>i?"...":"]";return"".concat(s).concat(u)}(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a},formatters.leftPad=function(e){var t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(" ".repeat(t)).concat(e)},formatters.rightPad=function(e){var t=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-e.length,0);return"".concat(e).concat(" ".repeat(t))}),formatters}var color={},hasRequiredColor;function requireColor(){if(hasRequiredColor)return color;hasRequiredColor=1,Object.defineProperty(color,"__esModule",{value:!0}),color.COLOR=void 0,color.addColor=function(e,n,i){return t.isBrowser||"string"!=typeof e||(n&&(n=r(n),e="[".concat(n,"m").concat(e,"[39m")),i&&(n=r(i),e="[".concat(i+10,"m").concat(e,"[49m"))),e};var e,t=requireEs5$5();function r(t){return"string"==typeof t?e[t.toUpperCase()]||e.WHITE:t}return color.COLOR=e,function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(e||(color.COLOR=e={})),color}var autobind={},hasRequiredAutobind;function requireAutobind(){if(hasRequiredAutobind)return autobind;function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}return hasRequiredAutobind=1,Object.defineProperty(autobind,"__esModule",{value:!0}),autobind.autobind=function(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],i=Object.getPrototypeOf(t),a=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(Object.getOwnPropertyNames(i));try{var o=function(){var e=r.value;"function"==typeof t[e]&&(n.find((function(t){return e===t}))||(t[e]=t[e].bind(t)))};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}},autobind}var assert$7={},hasRequiredAssert$4;function requireAssert$4(){return hasRequiredAssert$4||(hasRequiredAssert$4=1,Object.defineProperty(assert$7,"__esModule",{value:!0}),assert$7.default=function(e,t){if(!e)throw new Error(t||"Assertion failed")}),assert$7}var hiResTimestamp$1={},hasRequiredHiResTimestamp$1,hasRequiredLog$1;function requireHiResTimestamp$1(){if(hasRequiredHiResTimestamp$1)return hiResTimestamp$1;hasRequiredHiResTimestamp$1=1,Object.defineProperty(hiResTimestamp$1,"__esModule",{value:!0}),hiResTimestamp$1.getHiResTimestamp=function(){var t,r,n;if(e.isBrowser&&"performance"in e.window)t=null==e.window||null===(r=e.window.performance)||void 0===r||null===(n=r.now)||void 0===n?void 0:n.call(r);else if("hrtime"in e.process){var i,a=null==e.process||null===(i=e.process.hrtime)||void 0===i?void 0:i.call(e.process);t=1e3*a[0]+a[1]/1e6}else t=Date.now();return t};var e=requireEs5$5();return hiResTimestamp$1}function requireLog$1(){if(hasRequiredLog$1)return log$3;hasRequiredLog$1=1;var e=interopRequireDefaultExports;Object.defineProperty(log$3,"__esModule",{value:!0}),log$3.Log=void 0,log$3.normalizeArguments=b;var t=e(_typeofExports),r=e(requireToConsumableArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=requireEs5$5(),s=requireLocalStorage(),l=requireFormatters(),u=requireColor(),c=requireAutobind(),d=e(requireAssert$4()),h=requireHiResTimestamp$1(),f={debug:o.isBrowser&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},p={enabled:!0,level:0};function m(){}var g={},_={once:!0},y=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""}).id;(0,n.default)(this,e),(0,a.default)(this,"id",void 0),(0,a.default)(this,"VERSION",o.VERSION),(0,a.default)(this,"_startTs",(0,h.getHiResTimestamp)()),(0,a.default)(this,"_deltaTs",(0,h.getHiResTimestamp)()),(0,a.default)(this,"_storage",void 0),(0,a.default)(this,"userData",{}),(0,a.default)(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new s.LocalStorage("__probe-".concat(this.id,"__"),p),this.timeStamp("".concat(this.id," started")),(0,c.autobind)(this),Object.seal(this)}return(0,i.default)(e,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number(((0,h.getHiResTimestamp)()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number(((0,h.getHiResTimestamp)()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){return this._storage.setConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}},{key:"setLevel",value:function(e){return this._storage.setConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.setConfiguration((0,a.default)({},e,t))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,t){(0,d.default)(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,f.warn,arguments,_)}},{key:"error",value:function(e){return this._getLogFunction(0,e,f.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,f.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,f.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return this._getLogFunction(e,t,f.debug||f.info,arguments,_)}},{key:"table",value:function(e,t,r){return t?this._getLogFunction(e,t,console.table||m,r&&[r],{tag:x(t)}):m}},{key:"image",value:function(e){var t=e.image,n=e.message,i=void 0===n?"":n,a=e.scale,s=void 0===a?1:a;return this._shouldLog(e.logLevel||e.priority)?o.isBrowser?function(e){var t=e.image,n=e.message,i=void 0===n?"":n,a=e.scale,o=void 0===a?1:a;if("string"==typeof t){var s=new Image;return s.onload=function(){var e,t=(0,l.formatImage)(s,i,o);(e=console).log.apply(e,(0,r.default)(t))},s.src=t,m}var u,c=t.nodeName||"";if("img"===c.toLowerCase())return(u=console).log.apply(u,(0,r.default)((0,l.formatImage)(t,i,o))),m;if("canvas"===c.toLowerCase()){var d=new Image;return d.onload=function(){var e;return(e=console).log.apply(e,(0,r.default)((0,l.formatImage)(d,i,o)))},d.src=t.toDataURL(),m}return m}({image:t,message:i,scale:s}):(console.warn("removed"),m):m}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||m)}},{key:"group",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=b({logLevel:e,message:t,opts:r});return n.method=(r.collapsed?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}},{key:"groupCollapsed",value:function(e,t){return this.group(e,t,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||m)}},{key:"withGroup",value:function(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=v(e)}},{key:"_getLogFunction",value:function(e,t,n,i,a){if(this._shouldLog(e)){var o;a=b({logLevel:e,message:t,args:i,opts:a}),(0,d.default)(n=n||a.method),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=(0,h.getHiResTimestamp)();var s=a.tag||a.message;if(a.once){if(g[s])return m;g[s]=(0,h.getHiResTimestamp)()}return t=function(e,t,r){if("string"==typeof t){var n=r.time?(0,l.leftPad)((0,l.formatTime)(r.total)):"";t=r.time?"".concat(e,": ").concat(n,"  ").concat(t):"".concat(e,": ").concat(t),t=(0,u.addColor)(t,r.color,r.background)}return t}(this.id,a.message,a),(o=n).bind.apply(o,[console,t].concat((0,r.default)(a.args)))}return m}}]),e}();function v(e){if(!e)return 0;var r;switch((0,t.default)(e)){case"number":r=e;break;case"object":r=e.logLevel||e.priority||0;break;default:return 0}return(0,d.default)(Number.isFinite(r)&&r>=0),r}function b(e){var r=e.logLevel,n=e.message;e.logLevel=v(r);for(var i=e.args?Array.from(e.args):[];i.length&&i.shift()!==n;);switch((0,t.default)(r)){case"string":case"function":void 0!==n&&i.unshift(n),e.message=r;break;case"object":Object.assign(e,r)}"function"==typeof e.message&&(e.message=e.message());var a=(0,t.default)(e.message);return(0,d.default)("string"===a||"object"===a),Object.assign(e,{args:i},e.opts)}function x(e){for(var t in e)for(var r in e[t])return r||"untitled";return"empty"}return log$3.Log=y,(0,a.default)(y,"VERSION",o.VERSION),log$3}var init$1={},hasRequiredInit,hasRequiredEs5$4,hasRequiredLog;function requireInit(){return hasRequiredInit||(hasRequiredInit=1,globalThis.probe={}),init$1}function requireEs5$4(){return hasRequiredEs5$4||(hasRequiredEs5$4=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"COLOR",{enumerable:!0,get:function(){return r.COLOR}}),Object.defineProperty(e,"LocalStorage",{enumerable:!0,get:function(){return a.LocalStorage}}),Object.defineProperty(e,"Log",{enumerable:!0,get:function(){return t.Log}}),Object.defineProperty(e,"addColor",{enumerable:!0,get:function(){return r.addColor}}),Object.defineProperty(e,"autobind",{enumerable:!0,get:function(){return i.autobind}}),e.default=void 0,Object.defineProperty(e,"getHiResTimestamp",{enumerable:!0,get:function(){return o.getHiResTimestamp}}),Object.defineProperty(e,"leftPad",{enumerable:!0,get:function(){return n.leftPad}}),Object.defineProperty(e,"rightPad",{enumerable:!0,get:function(){return n.rightPad}});var t=requireLog$1(),r=requireColor(),n=requireFormatters(),i=requireAutobind(),a=requireLocalStorage(),o=requireHiResTimestamp$1();requireInit();var s=new t.Log({id:"@probe.gl/log"});e.default=s}(es5$f)),es5$f}function requireLog(){if(hasRequiredLog)return log$4;hasRequiredLog=1,Object.defineProperty(log$4,"__esModule",{value:!0}),log$4.default=void 0;var e=new(requireEs5$4().Log)({id:"deck"});return log$4.default=e,log$4}var debug={},loggers={},hasRequiredLoggers,hasRequiredDebug;function requireLoggers(){if(hasRequiredLoggers)return loggers;function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}hasRequiredLoggers=1,Object.defineProperty(loggers,"__esModule",{value:!0}),loggers.getLoggers=void 0;var r={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]};return loggers.getLoggers=function(t){return{"layer.changeFlag":function(e,r,n){t.log(3,"".concat(e.id," ").concat(r,": "),n[r])()},"layer.initialize":function(e){t.log(1,"Initializing ".concat(e))()},"layer.update":function(e,r){if(r){var n=e.getChangeFlags();t.log(2,"Updating ".concat(e," because: ").concat(Object.keys(n).filter((function(e){return n[e]})).join(", ")))()}else t.log(4,"".concat(e," does not need update"))()},"layer.matched":function(e,r){r&&t.log(4,"Matched ".concat(e,", state transfered"))()},"layer.finalize":function(e){t.log(1,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":function(e,r,n){r?t.log(2,"Composite layer rendered new subLayers ".concat(e),n)():t.log(4,"Composite layer reused subLayers ".concat(e),n)()},"layerManager.setLayers":function(e,r,n){r&&t.log(2,"Updating ".concat(n.length," deck layers"))()},"layerManager.activateViewport":function(e,r){t.log(3,"Viewport changed",r)()},"attributeManager.invalidate":function(e,r,n){t.log(1,n?"invalidated attributes ".concat(n," (").concat(r,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":function(e){r.attributeUpdateMessages.length=0,r.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":function(n,i){var a=Math.round(Date.now()-r.attributeManagerUpdateStart);t.groupCollapsed(2,"Updated attributes for ".concat(i," instances in ").concat(n.id," in ").concat(a,"ms"))();var o,s=e(r.attributeUpdateMessages);try{for(s.s();!(o=s.n()).done;)t.log(3,o.value)()}catch(e){s.e(e)}finally{s.f()}t.groupEnd(2)()},"attribute.updateStart":function(e){r.attributeUpdateStart=Date.now()},"attribute.allocate":function(e,t){var n="".concat(e.id," allocated ").concat(t);r.attributeUpdateMessages.push(n)},"attribute.updateEnd":function(e,t){var n=Math.round(Date.now()-r.attributeUpdateStart),i="".concat(e.id," updated ").concat(t," in ").concat(n,"ms");r.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":function(r,n,i){var a,o=i.pass,s=i.redrawReason,l=i.stats,u=e(n);try{for(u.s();!(a=u.n()).done;){var c=a.value,d=c.totalCount,h=c.visibleCount,f=c.compositeCount,p=c.pickableCount,m=d-f-h;t.log(2,"RENDER #".concat(r.renderCount,"   ").concat(h," (of ").concat(d," layers) to ").concat(o," because ").concat(s,"   (").concat(m," hidden, ").concat(f," composite ").concat(p," pickable)"))(),l&&l.get("Redraw Layers").add(h)}}catch(e){u.e(e)}finally{u.f()}}}},loggers}function requireDebug(){if(hasRequiredDebug)return debug;hasRequiredDebug=1;var e=interopRequireDefaultExports;Object.defineProperty(debug,"__esModule",{value:!0}),debug.register=function(e){n=e},debug.default=function(e,r,i,a){t.default.level>0&&n[e]&&n[e].call(null,r,i,a)};var t=e(requireLog()),r=requireLoggers(),n={};return"production"!==process.env.NODE_ENV&&(n=(0,r.getLoggers)(t.default)),debug}var jsonLoader={},hasRequiredJsonLoader;function requireJsonLoader(){if(hasRequiredJsonLoader)return jsonLoader;hasRequiredJsonLoader=1,Object.defineProperty(jsonLoader,"__esModule",{value:!0}),jsonLoader.default=void 0;var e={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){var t=e[0],r=e[e.length-1];return"{"===t&&"}"===r||"["===t&&"]"===r},parseTextSync:JSON.parse};return jsonLoader.default=e,jsonLoader}var _interopRequireDefault$g=interopRequireDefaultExports;Object.defineProperty(init$2,"__esModule",{value:!0}),init$2.VERSION=void 0;var _defineProperty2$7=_interopRequireDefault$g(requireDefineProperty()),_core$1=es5$n,_images=requireEs5$8(),_log$2=_interopRequireDefault$g(requireLog()),_debug=requireDebug(),_jsonLoader=_interopRequireDefault$g(requireJsonLoader());function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){(0,_defineProperty2$7.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function checkVersion(){var e="8.9.33",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(e));return t||(_log$2.default.log(1,"deck.gl ".concat(e))(),globalThis.deck=_objectSpread$1(_objectSpread$1({},globalThis.deck),{},{VERSION:e,version:e,log:_log$2.default,_registerLoggers:_debug.register}),(0,_core$1.registerLoaders)([_jsonLoader.default,[_images.ImageLoader,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var VERSION$1=checkVersion();init$2.VERSION=VERSION$1;var constants$4={},_interopRequireDefault$f=interopRequireDefaultExports;Object.defineProperty(constants$4,"__esModule",{value:!0}),constants$4.OPERATION=constants$4.EVENTS=constants$4.UNIT=constants$4.PROJECTION_MODE=constants$4.COORDINATE_SYSTEM=void 0;var _log$1=_interopRequireDefault$f(requireLog()),COORDINATE_SYSTEM={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};constants$4.COORDINATE_SYSTEM=COORDINATE_SYSTEM,Object.defineProperty(COORDINATE_SYSTEM,"IDENTITY",{get:function(){return _log$1.default.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0}});var PROJECTION_MODE={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0};constants$4.PROJECTION_MODE=PROJECTION_MODE;var UNIT={common:0,meters:1,pixels:2};constants$4.UNIT=UNIT;var EVENTS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};constants$4.EVENTS=EVENTS;var OPERATION={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};constants$4.OPERATION=OPERATION;var lightingEffect={},es5$d={},es5$c={},log$2={};Object.defineProperty(log$2,"__esModule",{value:!0}),log$2.log=void 0;var _log=requireEs5$4(),log$1=new _log.Log({id:"luma.gl"});log$2.log=log$1;var webglChecks={},assert$6={};function assert$5(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}Object.defineProperty(assert$6,"__esModule",{value:!0}),assert$6.assert=assert$5,Object.defineProperty(webglChecks,"__esModule",{value:!0}),webglChecks.ERR_WEBGL2=webglChecks.ERR_WEBGL=void 0,webglChecks.assertWebGL2Context=assertWebGL2Context,webglChecks.assertWebGLContext=assertWebGLContext,webglChecks.getWebGL2Context=getWebGL2Context,webglChecks.isWebGL=isWebGL,webglChecks.isWebGL2=isWebGL2;var _assert$4=assert$6,ERR_CONTEXT="Invalid WebGLRenderingContext",ERR_WEBGL=ERR_CONTEXT;webglChecks.ERR_WEBGL=ERR_WEBGL;var ERR_WEBGL2="Requires WebGL2";function isWebGL(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}function isWebGL2(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function getWebGL2Context(e){return isWebGL2(e)?e:null}function assertWebGLContext(e){return(0,_assert$4.assert)(isWebGL(e),ERR_CONTEXT),e}function assertWebGL2Context(e){return(0,_assert$4.assert)(isWebGL2(e),ERR_WEBGL2),e}webglChecks.ERR_WEBGL2=ERR_WEBGL2;var polyfillContext$1={},polyfillVertexArrayObject$1={};Object.defineProperty(polyfillVertexArrayObject$1,"__esModule",{value:!0}),polyfillVertexArrayObject$1.polyfillVertexArrayObject=polyfillVertexArrayObject;var glErrorShadow={};function error(e){globalThis.console&&globalThis.console.error&&globalThis.console.error(e)}function log(e){globalThis.console&&globalThis.console.log&&globalThis.console.log(e)}function synthesizeGLError(e,t){glErrorShadow[e]=!0,void 0!==t&&error(t)}function wrapGLError(e){var t=e.getError;e.getError=function(){var r;do{0!==(r=t.apply(e))&&(glErrorShadow[r]=!0)}while(0!==r);for(r in glErrorShadow)if(glErrorShadow[r])return delete glErrorShadow[r],parseInt(r,10);return 0}}var WebGLVertexArrayObjectOES=function e(t){var r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new e.VertexAttrib(r);this.attribs[n]=i}this.maxAttrib=0};WebGLVertexArrayObjectOES.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},WebGLVertexArrayObjectOES.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var OESVertexArrayObject=function(e){var t=this;this.gl=e,wrapGLError(e);var r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){var n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){var n=t.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,e),n.attribs[e].enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(e,n){switch(e){case 34962:t.currentArrayBuffer=n;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=n}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(e,n){var i=t.currentVertexArrayObject.attribs[e];switch(n){case 34975:return i.buffer;case 34338:return i.enabled;case 34339:return i.size;case 34340:return i.stride;case 34341:return i.type;case 34922:return i.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,n,i,a,o,s){var l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,e);var u=l.attribs[e];return u.buffer=t.currentArrayBuffer,u.size=n,u.type=i,u.normalized=a,u.stride=o,u.offset=s,u.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",(function(){log("OESVertexArrayObject emulation library context restored"),t.reset_()}),!0),this.reset_()};function polyfillVertexArrayObject(e){if("function"!=typeof e.createVertexArray){var t=e.getSupportedExtensions;e.getSupportedExtensions=function(){var e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};var r=e.getExtension;e.getExtension=function(t){return r.call(this,t)||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new OESVertexArrayObject(this)),this.__OESVertexArrayObject))}}}OESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES=34229,OESVertexArrayObject.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;this.maxVertexAttribs=this.gl.getParameter(34921),this.defaultVertexArrayObject=new WebGLVertexArrayObjectOES(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},OESVertexArrayObject.prototype.createVertexArrayOES=function(){var e=new WebGLVertexArrayObjectOES(this);return this.vertexArrayObjects.push(e),e},OESVertexArrayObject.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},OESVertexArrayObject.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof WebGLVertexArrayObjectOES&&e.hasBeenBound&&e.ext===this)},OESVertexArrayObject.prototype.bindVertexArrayOES=function(e){var t=this.gl;if(!e||e.isAlive){var r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var i=this.currentVertexArrayObject;if(n!==i){n&&i.elementArrayBuffer===n.elementArrayBuffer||r.bindBuffer.call(t,34963,i.elementArrayBuffer);for(var a=this.currentArrayBuffer,o=Math.max(n?n.maxAttrib:0,i.maxAttrib),s=0;s<=o;s++){var l=i.attribs[s],u=n?n.attribs[s]:null;if(n&&l.enabled===u.enabled||(l.enabled?r.enableVertexAttribArray.call(t,s):r.disableVertexAttribArray.call(t,s)),l.enabled){var c=!1;n&&l.buffer===u.buffer||(a!==l.buffer&&(r.bindBuffer.call(t,34962,l.buffer),a=l.buffer),c=!0),(c||l.cached!==u.cached)&&r.vertexAttribPointer.call(t,s,l.size,l.type,l.normalized,l.stride,l.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)}}else synthesizeGLError(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject")};var polyfillTable={},getParameterPolyfill={},hasRequiredGetParameterPolyfill;function requireGetParameterPolyfill(){if(hasRequiredGetParameterPolyfill)return getParameterPolyfill;hasRequiredGetParameterPolyfill=1;var e=interopRequireDefaultExports;Object.defineProperty(getParameterPolyfill,"__esModule",{value:!0}),getParameterPolyfill.getParameterPolyfill=function(e,t,r){var n=l[r],i="function"==typeof n?n(e,t,r):n;return void 0!==i?i:t(r)};var t,r=e(requireDefineProperty()),n=webglChecks,i="OES_element_index",a="WEBGL_draw_buffers",o="WEBGL_debug_renderer_info",s=function(e){return(0,n.isWebGL2)(e)?void 0:0},l=((0,r.default)(t={},3074,(function(e){return(0,n.isWebGL2)(e)?void 0:36064})),(0,r.default)(t,35723,(function(e){return(0,n.isWebGL2)(e)?void 0:4352})),(0,r.default)(t,35977,s),(0,r.default)(t,32937,s),(0,r.default)(t,36795,(function(e,t){var r=(0,n.isWebGL2)(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0})),(0,r.default)(t,37445,(function(e,t){var r=e.getExtension(o);return t(r&&r.UNMASKED_VENDOR_WEBGL||7936)})),(0,r.default)(t,37446,(function(e,t){var r=e.getExtension(o);return t(r&&r.UNMASKED_RENDERER_WEBGL||7937)})),(0,r.default)(t,34047,(function(e,t){var r=e.luma.extensions.EXT_texture_filter_anisotropic;return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1})),(0,r.default)(t,32883,s),(0,r.default)(t,35071,s),(0,r.default)(t,37447,s),(0,r.default)(t,36063,(function(e,t){if(!(0,n.isWebGL2)(e)){var r=e.getExtension(a);return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}})),(0,r.default)(t,35379,s),(0,r.default)(t,35374,s),(0,r.default)(t,35377,s),(0,r.default)(t,34852,(function(e){if(!(0,n.isWebGL2)(e)){var t=e.getExtension(a);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}})),(0,r.default)(t,36203,(function(e){return e.getExtension(i)?2147483647:65535})),(0,r.default)(t,33001,(function(e){return e.getExtension(i)?16777216:65535})),(0,r.default)(t,33e3,(function(e){return 16777216})),(0,r.default)(t,37157,s),(0,r.default)(t,35373,s),(0,r.default)(t,35657,s),(0,r.default)(t,36183,s),(0,r.default)(t,37137,s),(0,r.default)(t,34045,s),(0,r.default)(t,35978,s),(0,r.default)(t,35979,s),(0,r.default)(t,35968,s),(0,r.default)(t,35376,s),(0,r.default)(t,35375,s),(0,r.default)(t,35659,s),(0,r.default)(t,37154,s),(0,r.default)(t,35371,s),(0,r.default)(t,35658,s),(0,r.default)(t,35076,s),(0,r.default)(t,35077,s),(0,r.default)(t,35380,s),t);return getParameterPolyfill}var _interopRequireDefault$e=interopRequireDefaultExports;Object.defineProperty(polyfillTable,"__esModule",{value:!0}),polyfillTable.WEBGL2_CONTEXT_POLYFILLS=polyfillTable.WEBGL2_CONTEXT_OVERRIDES=void 0;var _defineProperty2$6=_interopRequireDefault$e(requireDefineProperty()),_assert$3=assert$6,_webglChecks$2=webglChecks,_getParameterPolyfill=requireGetParameterPolyfill(),_WEBGL2_CONTEXT_POLYF,OES_vertex_array_object="OES_vertex_array_object",ANGLE_instanced_arrays="ANGLE_instanced_arrays",WEBGL_draw_buffers="WEBGL_draw_buffers",EXT_disjoint_timer_query="EXT_disjoint_timer_query",EXT_texture_filter_anisotropic="EXT_texture_filter_anisotropic",ERR_VAO_NOT_SUPPORTED="VertexArray requires WebGL2 or OES_vertex_array_object extension";function getExtensionData(e,t){return{webgl2:(0,_webglChecks$2.isWebGL2)(e),ext:e.getExtension(t)}}var WEBGL2_CONTEXT_POLYFILLS=(_WEBGL2_CONTEXT_POLYF={},(0,_defineProperty2$6.default)(_WEBGL2_CONTEXT_POLYF,OES_vertex_array_object,{meta:{suffix:"OES"},createVertexArray:function(){(0,_assert$3.assert)(!1,ERR_VAO_NOT_SUPPORTED)},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),(0,_defineProperty2$6.default)(_WEBGL2_CONTEXT_POLYF,ANGLE_instanced_arrays,{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(e,t){(0,_assert$3.assert)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),(0,_defineProperty2$6.default)(_WEBGL2_CONTEXT_POLYF,WEBGL_draw_buffers,{meta:{suffix:"WEBGL"},drawBuffers:function(){(0,_assert$3.assert)(!1)}}),(0,_defineProperty2$6.default)(_WEBGL2_CONTEXT_POLYF,EXT_disjoint_timer_query,{meta:{suffix:"EXT"},createQuery:function(){(0,_assert$3.assert)(!1)},deleteQuery:function(){(0,_assert$3.assert)(!1)},beginQuery:function(){(0,_assert$3.assert)(!1)},endQuery:function(){},getQuery:function(e,t){return this.getQueryObject(e,t)},getQueryParameter:function(e,t){return this.getQueryObject(e,t)},getQueryObject:function(){}}),_WEBGL2_CONTEXT_POLYF);polyfillTable.WEBGL2_CONTEXT_POLYFILLS=WEBGL2_CONTEXT_POLYFILLS;var WEBGL2_CONTEXT_OVERRIDES={readBuffer:function(e,t,r){(0,_webglChecks$2.isWebGL2)(e)&&t(r)},getVertexAttrib:function(e,t,r,n){var i,a=getExtensionData(e,ANGLE_instanced_arrays),o=a.webgl2,s=a.ext;switch(n){case 35069:i=!!o&&void 0;break;case 35070:i=o||s?void 0:0}return void 0!==i?i:t(r,n)},getProgramParameter:function(e,t,r,n){if(!(0,_webglChecks$2.isWebGL2)(e))switch(n){case 35967:return 35981;case 35971:case 35382:return 0}return t(r,n)},getInternalformatParameter:function(e,t,r,n,i){return(0,_webglChecks$2.isWebGL2)(e)||32937!==i?e.getInternalformatParameter(r,n,i):new Int32Array([0])},getTexParameter:function(e,t,r,n){if(34046===n){var i=e.luma.extensions[EXT_texture_filter_anisotropic];n=i&&i.TEXTURE_MAX_ANISOTROPY_EXT||34046}return t(r,n)},getParameter:_getParameterPolyfill.getParameterPolyfill,hint:function(e,t,r,n){return t(r,n)}};polyfillTable.WEBGL2_CONTEXT_OVERRIDES=WEBGL2_CONTEXT_OVERRIDES,Object.defineProperty(polyfillContext$1,"__esModule",{value:!0}),polyfillContext$1.polyfillContext=polyfillContext;var _polyfillVertexArrayObject=polyfillVertexArrayObject$1,_assert$2=assert$6,_polyfillTable=polyfillTable;function _createForOfIteratorHelper$2(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function polyfillContext(e){e.luma=e.luma||{};var t=e.luma;return t.polyfilled||((0,_polyfillVertexArrayObject.polyfillVertexArrayObject)(e),initializeExtensions(e),installPolyfills(e,_polyfillTable.WEBGL2_CONTEXT_POLYFILLS),installOverrides(e,{target:t,target2:e}),t.polyfilled=!0),e}function initializeExtensions(e){e.luma.extensions={};var t,r=_createForOfIteratorHelper$2(e.getSupportedExtensions()||[]);try{for(r.s();!(t=r.n()).done;){var n=t.value;e.luma[n]=e.getExtension(n)}}catch(e){r.e(e)}finally{r.f()}}function installOverrides(e,t){var r=t.target,n=t.target2;Object.keys(_polyfillTable.WEBGL2_CONTEXT_OVERRIDES).forEach((function(t){if("function"==typeof _polyfillTable.WEBGL2_CONTEXT_OVERRIDES[t]){var i=e[t]?e[t].bind(e):function(){},a=_polyfillTable.WEBGL2_CONTEXT_OVERRIDES[t].bind(null,e,i);r[t]=a,n[t]=a}}))}function installPolyfills(e,t){var r,n=_createForOfIteratorHelper$2(Object.getOwnPropertyNames(t));try{for(n.s();!(r=n.n()).done;){var i=r.value;"overrides"!==i&&polyfillExtension(e,{extension:i,target:e.luma,target2:e})}}catch(e){n.e(e)}finally{n.f()}}function polyfillExtension(e,t){var r=t.extension,n=t.target,i=t.target2,a=_polyfillTable.WEBGL2_CONTEXT_POLYFILLS[r];(0,_assert$2.assert)(a);for(var o=a.meta,s=(void 0===o?{}:o).suffix,l=void 0===s?"":s,u=e.getExtension(r),c=function(){var t=h[d],r="".concat(t).concat(l),o=null;"meta"===t||"function"==typeof e[t]||(u&&"function"==typeof u[r]?o=function(){return u[r].apply(u,arguments)}:"function"==typeof a[t]&&(o=a[t].bind(n))),o&&(n[t]=o,i[t]=o)},d=0,h=Object.keys(a);d<h.length;d++)c()}globalThis.polyfillContext=polyfillContext;var unifiedParameterApi={},webglParameterTables={},_interopRequireDefault$d=interopRequireDefaultExports;Object.defineProperty(webglParameterTables,"__esModule",{value:!0}),webglParameterTables.GL_PARAMETER_SETTERS=webglParameterTables.GL_PARAMETER_GETTERS=webglParameterTables.GL_PARAMETER_DEFAULTS=webglParameterTables.GL_HOOKED_SETTERS=webglParameterTables.GL_COMPOSITE_PARAMETER_SETTERS=void 0;var _slicedToArray2$2=_interopRequireDefault$d(requireSlicedToArray()),_toConsumableArray2=_interopRequireDefault$d(requireToConsumableArray()),_defineProperty2$5=_interopRequireDefault$d(requireDefineProperty()),_webglChecks$1=webglChecks,_GL_PARAMETER_DEFAULT,_GL_PARAMETER_SETTERS,_GL_PARAMETER_GETTERS,GL_PARAMETER_DEFAULTS=(_GL_PARAMETER_DEFAULT={},(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3042,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32773,new Float32Array([0,0,0,0])),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32777,32774),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,34877,32774),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32969,1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32968,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32971,1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32970,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3106,new Float32Array([0,0,0,0])),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3107,[!0,!0,!0,!0]),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2884,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2885,1029),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2929,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2931,1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2932,513),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2928,new Float32Array([0,1])),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2930,!0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3024,!0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,36006,null),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2886,2305),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,33170,4352),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2849,1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32823,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32824,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,10752,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32938,1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32939,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3089,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3088,new Int32Array([0,0,1024,1024])),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2960,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2961,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2968,4294967295),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,36005,4294967295),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2962,519),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2967,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2963,4294967295),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,34816,519),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,36003,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,36004,4294967295),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2964,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2965,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2966,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,34817,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,34818,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,34819,7680),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,2978,[0,0,1024,1024]),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3333,4),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3317,4),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,37440,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,37441,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,37443,37444),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,35723,4352),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,36010,null),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,35977,!1),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3330,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3332,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3331,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3314,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32878,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3316,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,3315,0),(0,_defineProperty2$5.default)(_GL_PARAMETER_DEFAULT,32877,0),_GL_PARAMETER_DEFAULT);webglParameterTables.GL_PARAMETER_DEFAULTS=GL_PARAMETER_DEFAULTS;var enable=function(e,t,r){return t?e.enable(r):e.disable(r)},hint=function(e,t,r){return e.hint(r,t)},pixelStorei=function(e,t,r){return e.pixelStorei(r,t)},drawFramebuffer=function(e,t){var r=(0,_webglChecks$1.isWebGL2)(e)?36009:36160;return e.bindFramebuffer(r,t)},readFramebuffer=function(e,t){return e.bindFramebuffer(36008,t)};function isArray(e){return Array.isArray(e)||ArrayBuffer.isView(e)}var GL_PARAMETER_SETTERS=(_GL_PARAMETER_SETTERS={},(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3042,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32773,(function(e,t){return e.blendColor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32777,"blendEquation"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,34877,"blendEquation"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32969,"blendFunc"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32968,"blendFunc"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32971,"blendFunc"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32970,"blendFunc"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3106,(function(e,t){return e.clearColor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3107,(function(e,t){return e.colorMask.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2884,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2885,(function(e,t){return e.cullFace(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2929,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2931,(function(e,t){return e.clearDepth(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2932,(function(e,t){return e.depthFunc(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2928,(function(e,t){return e.depthRange.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2930,(function(e,t){return e.depthMask(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3024,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,35723,hint),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,36006,drawFramebuffer),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2886,(function(e,t){return e.frontFace(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,33170,hint),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2849,(function(e,t){return e.lineWidth(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32823,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32824,"polygonOffset"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,10752,"polygonOffset"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,35977,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32938,"sampleCoverage"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32939,"sampleCoverage"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3089,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3088,(function(e,t){return e.scissor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2960,enable),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2961,(function(e,t){return e.clearStencil(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2968,(function(e,t){return e.stencilMaskSeparate(1028,t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,36005,(function(e,t){return e.stencilMaskSeparate(1029,t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2962,"stencilFuncFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2967,"stencilFuncFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2963,"stencilFuncFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,34816,"stencilFuncBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,36003,"stencilFuncBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,36004,"stencilFuncBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2964,"stencilOpFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2965,"stencilOpFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2966,"stencilOpFront"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,34817,"stencilOpBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,34818,"stencilOpBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,34819,"stencilOpBack"),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,2978,(function(e,t){return e.viewport.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3333,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3317,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,37440,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,37441,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,37443,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3330,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3332,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3331,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,36010,readFramebuffer),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3314,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32878,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3316,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,3315,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,32877,pixelStorei),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"framebuffer",(function(e,t){return e.bindFramebuffer(36160,t&&"handle"in t?t.handle:t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"blend",(function(e,t){return t?e.enable(3042):e.disable(3042)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"blendColor",(function(e,t){return e.blendColor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"blendEquation",(function(e,t){t=isArray(t)?t:[t,t],e.blendEquationSeparate.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"blendFunc",(function(e,t){t=isArray(t)&&2===t.length?[].concat((0,_toConsumableArray2.default)(t),(0,_toConsumableArray2.default)(t)):t,e.blendFuncSeparate.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"clearColor",(function(e,t){return e.clearColor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"clearDepth",(function(e,t){return e.clearDepth(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"clearStencil",(function(e,t){return e.clearStencil(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"colorMask",(function(e,t){return e.colorMask.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"cull",(function(e,t){return t?e.enable(2884):e.disable(2884)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"cullFace",(function(e,t){return e.cullFace(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"depthTest",(function(e,t){return t?e.enable(2929):e.disable(2929)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"depthFunc",(function(e,t){return e.depthFunc(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"depthMask",(function(e,t){return e.depthMask(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"depthRange",(function(e,t){return e.depthRange.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"dither",(function(e,t){return t?e.enable(3024):e.disable(3024)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"derivativeHint",(function(e,t){e.hint(35723,t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"frontFace",(function(e,t){return e.frontFace(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"mipmapHint",(function(e,t){return e.hint(33170,t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"lineWidth",(function(e,t){return e.lineWidth(t)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"polygonOffsetFill",(function(e,t){return t?e.enable(32823):e.disable(32823)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"polygonOffset",(function(e,t){return e.polygonOffset.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"sampleCoverage",(function(e,t){return e.sampleCoverage.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"scissorTest",(function(e,t){return t?e.enable(3089):e.disable(3089)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"scissor",(function(e,t){return e.scissor.apply(e,(0,_toConsumableArray2.default)(t))})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"stencilTest",(function(e,t){return t?e.enable(2960):e.disable(2960)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"stencilMask",(function(e,t){t=isArray(t)?t:[t,t];var r=(0,_slicedToArray2$2.default)(t,2),n=r[1];e.stencilMaskSeparate(1028,r[0]),e.stencilMaskSeparate(1029,n)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"stencilFunc",(function(e,t){t=isArray(t)&&3===t.length?[].concat((0,_toConsumableArray2.default)(t),(0,_toConsumableArray2.default)(t)):t;var r=(0,_slicedToArray2$2.default)(t,6),n=r[3],i=r[4],a=r[5];e.stencilFuncSeparate(1028,r[0],r[1],r[2]),e.stencilFuncSeparate(1029,n,i,a)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"stencilOp",(function(e,t){t=isArray(t)&&3===t.length?[].concat((0,_toConsumableArray2.default)(t),(0,_toConsumableArray2.default)(t)):t;var r=(0,_slicedToArray2$2.default)(t,6),n=r[3],i=r[4],a=r[5];e.stencilOpSeparate(1028,r[0],r[1],r[2]),e.stencilOpSeparate(1029,n,i,a)})),(0,_defineProperty2$5.default)(_GL_PARAMETER_SETTERS,"viewport",(function(e,t){return e.viewport.apply(e,(0,_toConsumableArray2.default)(t))})),_GL_PARAMETER_SETTERS);function getValue(e,t,r){return void 0!==t[e]?t[e]:r[e]}webglParameterTables.GL_PARAMETER_SETTERS=GL_PARAMETER_SETTERS;var GL_COMPOSITE_PARAMETER_SETTERS={blendEquation:function(e,t,r){return e.blendEquationSeparate(getValue(32777,t,r),getValue(34877,t,r))},blendFunc:function(e,t,r){return e.blendFuncSeparate(getValue(32969,t,r),getValue(32968,t,r),getValue(32971,t,r),getValue(32970,t,r))},polygonOffset:function(e,t,r){return e.polygonOffset(getValue(32824,t,r),getValue(10752,t,r))},sampleCoverage:function(e,t,r){return e.sampleCoverage(getValue(32938,t,r),getValue(32939,t,r))},stencilFuncFront:function(e,t,r){return e.stencilFuncSeparate(1028,getValue(2962,t,r),getValue(2967,t,r),getValue(2963,t,r))},stencilFuncBack:function(e,t,r){return e.stencilFuncSeparate(1029,getValue(34816,t,r),getValue(36003,t,r),getValue(36004,t,r))},stencilOpFront:function(e,t,r){return e.stencilOpSeparate(1028,getValue(2964,t,r),getValue(2965,t,r),getValue(2966,t,r))},stencilOpBack:function(e,t,r){return e.stencilOpSeparate(1029,getValue(34817,t,r),getValue(34818,t,r),getValue(34819,t,r))}};webglParameterTables.GL_COMPOSITE_PARAMETER_SETTERS=GL_COMPOSITE_PARAMETER_SETTERS;var GL_HOOKED_SETTERS={enable:function(e,t){return e((0,_defineProperty2$5.default)({},t,!0))},disable:function(e,t){return e((0,_defineProperty2$5.default)({},t,!1))},pixelStorei:function(e,t,r){return e((0,_defineProperty2$5.default)({},t,r))},hint:function(e,t,r){return e((0,_defineProperty2$5.default)({},t,r))},bindFramebuffer:function(e,t,r){var n;switch(t){case 36160:return e(((0,_defineProperty2$5.default)(n={},36006,r),(0,_defineProperty2$5.default)(n,36010,r),n));case 36009:return e((0,_defineProperty2$5.default)({},36006,r));case 36008:return e((0,_defineProperty2$5.default)({},36010,r));default:return null}},blendColor:function(e,t,r,n,i){return e((0,_defineProperty2$5.default)({},32773,new Float32Array([t,r,n,i])))},blendEquation:function(e,t){var r;return e(((0,_defineProperty2$5.default)(r={},32777,t),(0,_defineProperty2$5.default)(r,34877,t),r))},blendEquationSeparate:function(e,t,r){var n;return e(((0,_defineProperty2$5.default)(n={},32777,t),(0,_defineProperty2$5.default)(n,34877,r),n))},blendFunc:function(e,t,r){var n;return e(((0,_defineProperty2$5.default)(n={},32969,t),(0,_defineProperty2$5.default)(n,32968,r),(0,_defineProperty2$5.default)(n,32971,t),(0,_defineProperty2$5.default)(n,32970,r),n))},blendFuncSeparate:function(e,t,r,n,i){var a;return e(((0,_defineProperty2$5.default)(a={},32969,t),(0,_defineProperty2$5.default)(a,32968,r),(0,_defineProperty2$5.default)(a,32971,n),(0,_defineProperty2$5.default)(a,32970,i),a))},clearColor:function(e,t,r,n,i){return e((0,_defineProperty2$5.default)({},3106,new Float32Array([t,r,n,i])))},clearDepth:function(e,t){return e((0,_defineProperty2$5.default)({},2931,t))},clearStencil:function(e,t){return e((0,_defineProperty2$5.default)({},2961,t))},colorMask:function(e,t,r,n,i){return e((0,_defineProperty2$5.default)({},3107,[t,r,n,i]))},cullFace:function(e,t){return e((0,_defineProperty2$5.default)({},2885,t))},depthFunc:function(e,t){return e((0,_defineProperty2$5.default)({},2932,t))},depthRange:function(e,t,r){return e((0,_defineProperty2$5.default)({},2928,new Float32Array([t,r])))},depthMask:function(e,t){return e((0,_defineProperty2$5.default)({},2930,t))},frontFace:function(e,t){return e((0,_defineProperty2$5.default)({},2886,t))},lineWidth:function(e,t){return e((0,_defineProperty2$5.default)({},2849,t))},polygonOffset:function(e,t,r){var n;return e(((0,_defineProperty2$5.default)(n={},32824,t),(0,_defineProperty2$5.default)(n,10752,r),n))},sampleCoverage:function(e,t,r){var n;return e(((0,_defineProperty2$5.default)(n={},32938,t),(0,_defineProperty2$5.default)(n,32939,r),n))},scissor:function(e,t,r,n,i){return e((0,_defineProperty2$5.default)({},3088,new Int32Array([t,r,n,i])))},stencilMask:function(e,t){var r;return e(((0,_defineProperty2$5.default)(r={},2968,t),(0,_defineProperty2$5.default)(r,36005,t),r))},stencilMaskSeparate:function(e,t,r){return e((0,_defineProperty2$5.default)({},1028===t?2968:36005,r))},stencilFunc:function(e,t,r,n){var i;return e(((0,_defineProperty2$5.default)(i={},2962,t),(0,_defineProperty2$5.default)(i,2967,r),(0,_defineProperty2$5.default)(i,2963,n),(0,_defineProperty2$5.default)(i,34816,t),(0,_defineProperty2$5.default)(i,36003,r),(0,_defineProperty2$5.default)(i,36004,n),i))},stencilFuncSeparate:function(e,t,r,n,i){var a;return e(((0,_defineProperty2$5.default)(a={},1028===t?2962:34816,r),(0,_defineProperty2$5.default)(a,1028===t?2967:36003,n),(0,_defineProperty2$5.default)(a,1028===t?2963:36004,i),a))},stencilOp:function(e,t,r,n){var i;return e(((0,_defineProperty2$5.default)(i={},2964,t),(0,_defineProperty2$5.default)(i,2965,r),(0,_defineProperty2$5.default)(i,2966,n),(0,_defineProperty2$5.default)(i,34817,t),(0,_defineProperty2$5.default)(i,34818,r),(0,_defineProperty2$5.default)(i,34819,n),i))},stencilOpSeparate:function(e,t,r,n,i){var a;return e(((0,_defineProperty2$5.default)(a={},1028===t?2964:34817,r),(0,_defineProperty2$5.default)(a,1028===t?2965:34818,n),(0,_defineProperty2$5.default)(a,1028===t?2966:34819,i),a))},viewport:function(e,t,r,n,i){return e((0,_defineProperty2$5.default)({},2978,[t,r,n,i]))}};webglParameterTables.GL_HOOKED_SETTERS=GL_HOOKED_SETTERS;var isEnabled=function(e,t){return e.isEnabled(t)},GL_PARAMETER_GETTERS=(_GL_PARAMETER_GETTERS={},(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,3042,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,2884,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,2929,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,3024,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,32823,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,32926,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,32928,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,3089,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,2960,isEnabled),(0,_defineProperty2$5.default)(_GL_PARAMETER_GETTERS,35977,isEnabled),_GL_PARAMETER_GETTERS);webglParameterTables.GL_PARAMETER_GETTERS=GL_PARAMETER_GETTERS;var trackContextState={},utils$5={},hasRequiredTrackContextState,hasRequiredUnifiedParameterApi;function isObjectEmpty(e){for(var t in e)return!1;return!0}function deepArrayEqual(e,t){if(e===t)return!0;var r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}return!1}function requireTrackContextState(){if(hasRequiredTrackContextState)return trackContextState;hasRequiredTrackContextState=1;var e=interopRequireDefaultExports;Object.defineProperty(trackContextState,"__esModule",{value:!0}),trackContextState.popContextState=function(e){(0,a.assert)(e.state),e.state.pop()},trackContextState.pushContextState=function(e){e.state||c(e,{copyState:!1}),e.state.push()},trackContextState.trackContextState=c;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=webglParameterTables,i=requireUnifiedParameterApi(),a=assert$6,o=utils$5;function s(e,t){var r=e[t].bind(e);e[t]=function(){var t=arguments.length<=0?void 0:arguments[0];return t in e.state.cache&&e.state.enable?e.state.cache[t]:r.apply(void 0,arguments)},Object.defineProperty(e[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function l(e,t,r){var n=e[t].bind(e);e[t]=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var o=r.apply(void 0,[e.state._updateCache].concat(i)),s=o.oldValue;return o.valueChanged&&n.apply(void 0,i),s},Object.defineProperty(e[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}var u=function(){function e(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=a.copyState,s=void 0!==o&&o,l=a.log,u=void 0===l?function(){}:l;(0,t.default)(this,e),this.gl=r,this.program=null,this.stateStack=[],this.enable=!0,this.cache=s?(0,i.getParameters)(r):Object.assign({},n.GL_PARAMETER_DEFAULTS),this.log=u,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return(0,r.default)(e,[{key:"push",value:function(){this.stateStack.push({})}},{key:"pop",value:function(){(0,a.assert)(this.stateStack.length>0),(0,i.setParameters)(this.gl,this.stateStack[this.stateStack.length-1]),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var t,r=!1,n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var i in e){(0,a.assert)(void 0!==i);var s=e[i],l=this.cache[i];(0,o.deepArrayEqual)(s,l)||(r=!0,t=l,n&&!(i in n)&&(n[i]=l),this.cache[i]=s)}return{valueChanged:r,oldValue:t}}}]),e}();function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.enable,i=void 0===r||r,o=t.copyState;if((0,a.assert)(void 0!==o),!e.state){var c=globalThis.polyfillContext;for(var d in c&&c(e),e.state=new u(e,{copyState:o}),function(e){var t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}(e),n.GL_HOOKED_SETTERS)l(e,d,n.GL_HOOKED_SETTERS[d]);s(e,"getParameter"),s(e,"isEnabled")}return e.state.enable=i,e}return trackContextState}function requireUnifiedParameterApi(){if(hasRequiredUnifiedParameterApi)return unifiedParameterApi;hasRequiredUnifiedParameterApi=1,Object.defineProperty(unifiedParameterApi,"__esModule",{value:!0}),unifiedParameterApi.getParameters=function(t,r){if("number"==typeof(r=r||e.GL_PARAMETER_DEFAULTS)){var n=r,i=e.GL_PARAMETER_GETTERS[n];return i?i(t,n):t.getParameter(n)}var o,s={},l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(Array.isArray(r)?r:Object.keys(r));try{for(l.s();!(o=l.n()).done;){var u=o.value,c=e.GL_PARAMETER_GETTERS[u];s[u]=c?c(t,Number(u)):t.getParameter(Number(u))}}catch(e){l.e(e)}finally{l.f()}return s},unifiedParameterApi.resetParameters=function(t){o(t,e.GL_PARAMETER_DEFAULTS)},unifiedParameterApi.setParameters=o,unifiedParameterApi.withParameters=function(e,r,n){if((0,i.isObjectEmpty)(r))return n(e);var a,s=r.nocatch,l=void 0===s||s;if((0,t.pushContextState)(e),o(e,r),l)a=n(e),(0,t.popContextState)(e);else try{a=n(e)}finally{(0,t.popContextState)(e)}return a};var e=webglParameterTables,t=requireTrackContextState(),r=assert$6,n=webglChecks,i=utils$5;function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(t,a){if((0,r.assert)((0,n.isWebGL)(t),"setParameters requires a WebGL context"),!(0,i.isObjectEmpty)(a)){var o={};for(var s in a){var l=Number(s),u=e.GL_PARAMETER_SETTERS[s];u&&("string"==typeof u?o[u]=!0:u(t,a[s],l))}var c=t.state&&t.state.cache;if(c)for(var d in o)(0,e.GL_COMPOSITE_PARAMETER_SETTERS[d])(t,a,c)}}return unifiedParameterApi}Object.defineProperty(utils$5,"__esModule",{value:!0}),utils$5.deepArrayEqual=deepArrayEqual,utils$5.isObjectEmpty=isObjectEmpty;var context={},devicePixels={};function cssToDeviceRatio(e){var t=e.luma;if(e.canvas&&t){var r=t.canvasSizeInfo,n="clientWidth"in r?r.clientWidth:e.canvas.clientWidth;return n?e.drawingBufferWidth/n:1}return 1}function cssToDevicePixels(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return scalePixels(t,cssToDeviceRatio(e),e.drawingBufferWidth,e.drawingBufferHeight,r)}function getDevicePixelRatio(e){var t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}function scalePixels(e,t,r,n,i){var a,o=scaleX(e[0],t,r),s=scaleY(e[1],t,n,i),l=scaleX(e[0]+1,t,r),u=l===r-1?l:l-1;return l=scaleY(e[1]+1,t,n,i),i?(a=s,s=l=0===l?l:l+1):a=l===n-1?l:l-1,{x:o,y:s,width:Math.max(u-o+1,1),height:Math.max(a-s+1,1)}}function scaleX(e,t,r){return Math.min(Math.round(e*t),r-1)}function scaleY(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}Object.defineProperty(devicePixels,"__esModule",{value:!0}),devicePixels.cssToDevicePixels=cssToDevicePixels,devicePixels.cssToDeviceRatio=cssToDeviceRatio,devicePixels.getDevicePixelRatio=getDevicePixelRatio,Object.defineProperty(context,"__esModule",{value:!0}),context.createGLContext=createGLContext,context.getContextDebugInfo=getContextDebugInfo,context.instrumentGLContext=instrumentGLContext,context.resizeGLContext=resizeGLContext;var _env$1=requireEs5$5(),_trackContextState=requireTrackContextState(),_log2=log$2,_assert$1=assert$6,_devicePixels=devicePixels,_webglChecks=webglChecks,isBrowser=(0,_env$1.isBrowser)(),isPage=isBrowser&&"undefined"!=typeof document,CONTEXT_DEFAULTS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function createGLContext(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,_assert$1.assert)(isBrowser,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils");var t,r=(e=Object.assign({},CONTEXT_DEFAULTS,e)).width,n=e.height;function i(t){if(e.throwOnError)throw new Error(t);return console.error(t),null}return e.onError=i,(t=createBrowserContext(getCanvas({canvas:e.canvas,width:r,height:n,onError:i}),e))?(logInfo(t=instrumentGLContext(t,e)),t):null}function instrumentGLContext(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||e._instrumented)return e;e._version=e._version||getVersion(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};var r=(t=Object.assign({},CONTEXT_DEFAULTS,t)).debug;return t.manageState&&(0,_trackContextState.trackContextState)(e,{copyState:!1,log:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _log2.log.log.apply(_log2.log,[1].concat(t))()}}),isBrowser&&r&&(globalThis.makeDebugContext?(e=globalThis.makeDebugContext(e,t),_log2.log.level=Math.max(_log2.log.level,1)):_log2.log.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function getContextDebugInfo(e){var t=e.getParameter(7936),r=e.getParameter(7937),n=e.getExtension("WEBGL_debug_renderer_info");return{vendor:n&&e.getParameter(n.UNMASKED_VENDOR_WEBGL||7936)||t,renderer:n&&e.getParameter(n.UNMASKED_RENDERER_WEBGL||7937)||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}function resizeGLContext(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.canvas)setDevicePixelRatio(e,(0,_devicePixels.getDevicePixelRatio)(t.useDevicePixels),t);else{var r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}}function createBrowserContext(e,t){var r=t.onError,n=null,i=function(e){return n=e.statusMessage||n};e.addEventListener("webglcontextcreationerror",i,!1);var a=t.webgl1,o=void 0===a||a,s=t.webgl2,l=void 0===s||s,u=null;return l&&(u=(u=u||e.getContext("webgl2",t))||e.getContext("experimental-webgl2",t)),o&&(u=(u=u||e.getContext("webgl",t))||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",i,!1),u?(t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1),u):r("Failed to create ".concat(l&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function getCanvas(e){var t,r=e.canvas,n=e.width,i=void 0===n?800:n,a=e.height,o=void 0===a?600:a;return"string"==typeof r?(isPage&&"complete"===document.readyState||(0,e.onError)("createGLContext called on canvas '".concat(r,"' before page was loaded")),t=document.getElementById(r)):r?t=r:((t=document.createElement("canvas")).id="lumagl-canvas",t.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",t.style.height=Number.isFinite(o)?"".concat(o,"px"):"100%",document.body.insertBefore(t,document.body.firstChild)),t}function logInfo(e){var t=(0,_webglChecks.isWebGL2)(e)?"WebGL2":"WebGL1",r=getContextDebugInfo(e),n=r?"(".concat(r.vendor,",").concat(r.renderer,")"):"",i=e.debug?" debug":"";_log2.log.info(1,"".concat(t).concat(i," context ").concat(n))()}function getVersion(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?2:1}function setDevicePixelRatio(e,t,r){var n="width"in r?r.width:e.canvas.clientWidth,i="height"in r?r.height:e.canvas.clientHeight;n&&i||(_log2.log.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=e.canvas.width||1,i=e.canvas.height||1),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};var a=e.luma.canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==i||a.devicePixelRatio!==t){var o=t,s=Math.floor(n*o),l=Math.floor(i*o);e.canvas.width=s,e.canvas.height=l,e.drawingBufferWidth===s&&e.drawingBufferHeight===l||(_log2.log.warn("Device pixel ratio clamped")(),o=Math.min(e.drawingBufferWidth/n,e.drawingBufferHeight/i),e.canvas.width=Math.floor(n*o),e.canvas.height=Math.floor(i*o)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"assertWebGL2Context",{enumerable:!0,get:function(){return r.assertWebGL2Context}}),Object.defineProperty(e,"assertWebGLContext",{enumerable:!0,get:function(){return r.assertWebGLContext}}),Object.defineProperty(e,"createGLContext",{enumerable:!0,get:function(){return o.createGLContext}}),Object.defineProperty(e,"cssToDevicePixels",{enumerable:!0,get:function(){return s.cssToDevicePixels}}),Object.defineProperty(e,"cssToDeviceRatio",{enumerable:!0,get:function(){return s.cssToDeviceRatio}}),Object.defineProperty(e,"getContextDebugInfo",{enumerable:!0,get:function(){return o.getContextDebugInfo}}),Object.defineProperty(e,"getParameters",{enumerable:!0,get:function(){return i.getParameters}}),Object.defineProperty(e,"getWebGL2Context",{enumerable:!0,get:function(){return r.getWebGL2Context}}),Object.defineProperty(e,"instrumentGLContext",{enumerable:!0,get:function(){return o.instrumentGLContext}}),Object.defineProperty(e,"isWebGL",{enumerable:!0,get:function(){return r.isWebGL}}),Object.defineProperty(e,"isWebGL2",{enumerable:!0,get:function(){return r.isWebGL2}}),Object.defineProperty(e,"log",{enumerable:!0,get:function(){return t.log}}),Object.defineProperty(e,"polyfillContext",{enumerable:!0,get:function(){return n.polyfillContext}}),Object.defineProperty(e,"popContextState",{enumerable:!0,get:function(){return a.popContextState}}),Object.defineProperty(e,"pushContextState",{enumerable:!0,get:function(){return a.pushContextState}}),Object.defineProperty(e,"resetParameters",{enumerable:!0,get:function(){return i.resetParameters}}),Object.defineProperty(e,"resizeGLContext",{enumerable:!0,get:function(){return o.resizeGLContext}}),Object.defineProperty(e,"setParameters",{enumerable:!0,get:function(){return i.setParameters}}),Object.defineProperty(e,"trackContextState",{enumerable:!0,get:function(){return a.trackContextState}}),Object.defineProperty(e,"withParameters",{enumerable:!0,get:function(){return i.withParameters}});var t=log$2,r=webglChecks,n=polyfillContext$1,i=requireUnifiedParameterApi(),a=requireTrackContextState(),o=context,s=devicePixels}(es5$c);var es5$b={},init={},es5$a={},stats={},stat={},hiResTimestamp={},hasRequiredHiResTimestamp,hasRequiredStat,hasRequiredStats,hasRequiredEs5$3;function requireHiResTimestamp(){return hasRequiredHiResTimestamp||(hasRequiredHiResTimestamp=1,Object.defineProperty(hiResTimestamp,"__esModule",{value:!0}),hiResTimestamp.default=function(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){var t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}),hiResTimestamp}function requireStat(){if(hasRequiredStat)return stat;hasRequiredStat=1;var e=interopRequireDefaultExports;Object.defineProperty(stat,"__esModule",{value:!0}),stat.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireHiResTimestamp()),a=function(){function e(r,i){(0,t.default)(this,e),(0,n.default)(this,"name",void 0),(0,n.default)(this,"type",void 0),(0,n.default)(this,"sampleSize",1),(0,n.default)(this,"time",void 0),(0,n.default)(this,"count",void 0),(0,n.default)(this,"samples",void 0),(0,n.default)(this,"lastTiming",void 0),(0,n.default)(this,"lastSampleTime",void 0),(0,n.default)(this,"lastSampleCount",void 0),(0,n.default)(this,"_count",0),(0,n.default)(this,"_time",0),(0,n.default)(this,"_samples",0),(0,n.default)(this,"_startTime",0),(0,n.default)(this,"_timerPending",!1),this.name=r,this.type=i,this.reset()}return(0,r.default)(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=(0,i.default)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime((0,i.default)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}();return stat.default=a,stat}function requireStats(){if(hasRequiredStats)return stats;hasRequiredStats=1;var e=interopRequireDefaultExports;Object.defineProperty(stats,"__esModule",{value:!0}),stats.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireStat()),a=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}return(0,r.default)(e,[{key:"get",value:function(e){return this._getOrCreate({name:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach((function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}},{key:"_initializeStats",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){return e._getOrCreate(t)}))}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name;return this.stats[t]||(this.stats[t]=e instanceof i.default?e:new i.default(t,e.type)),this.stats[t]}}]),e}();return stats.default=a,stats}function requireEs5$3(){return hasRequiredEs5$3||(hasRequiredEs5$3=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Stat",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"Stats",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"_getHiResTimestamp",{enumerable:!0,get:function(){return i.default}});var r=t(requireStats()),n=t(requireStat()),i=t(requireHiResTimestamp())}(es5$a)),es5$a}var _interopRequireDefault$c=interopRequireDefaultExports;Object.defineProperty(init,"__esModule",{value:!0}),init.lumaStats=init.default=init.StatsManager=void 0;var _classCallCheck2$1=_interopRequireDefault$c(requireClassCallCheck()),_createClass2$1=_interopRequireDefault$c(requireCreateClass()),_gltools$1=es5$c,_stats=requireEs5$3(),_env=requireEs5$5(),VERSION="8.5.21",STARTUP_MESSAGE="set luma.log.level=1 (or higher) to trace rendering",StatsManager=function(){function e(){(0,_classCallCheck2$1.default)(this,e),this.stats=new Map}return(0,_createClass2$1.default)(e,[{key:"get",value:function(e){return this.stats.has(e)||this.stats.set(e,new _stats.Stats({id:e})),this.stats.get(e)}}]),e}();init.StatsManager=StatsManager;var lumaStats=new StatsManager;if(init.lumaStats=lumaStats,globalThis.luma&&globalThis.luma.VERSION!==VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(VERSION));globalThis.luma||((0,_env.isBrowser)()&&_gltools$1.log.log(1,"luma.gl ".concat(VERSION," - ").concat(STARTUP_MESSAGE))(),globalThis.luma=globalThis.luma||{VERSION:VERSION,version:VERSION,log:_gltools$1.log,stats:lumaStats,globals:{modules:{},nodeIO:{}}});var _default=globalThis.luma;init.default=_default;var requestAnimationFrame$2={};function requestAnimationFrame$1(e){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function cancelAnimationFrame(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}Object.defineProperty(requestAnimationFrame$2,"__esModule",{value:!0}),requestAnimationFrame$2.cancelAnimationFrame=cancelAnimationFrame,requestAnimationFrame$2.requestAnimationFrame=requestAnimationFrame$1;var textureUtils={},texture2d={},texture$1={},resource$1={},constantsToKeys={},assert$4={},hasRequiredAssert$3;function requireAssert$3(){return hasRequiredAssert$3||(hasRequiredAssert$3=1,Object.defineProperty(assert$4,"__esModule",{value:!0}),assert$4.assert=function(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}),assert$4}Object.defineProperty(constantsToKeys,"__esModule",{value:!0}),constantsToKeys.getKey=getKey,constantsToKeys.getKeyType=getKeyType,constantsToKeys.getKeyValue=getKeyValue;var _assert=requireAssert$3();function getKeyValue(e,t){if("string"!=typeof t)return t;var r=Number(t);if(!isNaN(r))return r;var n=e[t=t.replace(/^.*\./,"")];return(0,_assert.assert)(void 0!==n,"Accessing undefined constant GL.".concat(t)),n}function getKey(e,t){for(var r in t=Number(t),e)if(e[r]===t)return"GL.".concat(r);return String(t)}function getKeyType(e,t){for(var r in(0,_assert.assert)(void 0!==t,"undefined key"),t=Number(t),e)if(e[r]===t)return"GL.".concat(r);return String(t)}var utils$4={},hasRequiredUtils$4;function requireUtils$4(){if(hasRequiredUtils$4)return utils$4;hasRequiredUtils$4=1,Object.defineProperty(utils$4,"__esModule",{value:!0}),utils$4.isObjectEmpty=function(e){var t=!0;for(var r in e){t=!1;break}return t},utils$4.isPowerOfTwo=function(t){return(0,e.assert)("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)},utils$4.uid=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";t[e]=t[e]||1;var r=t[e]++;return"".concat(e,"-").concat(r)};var e=requireAssert$3(),t={};return utils$4}var stubMethods={},hasRequiredStubMethods,hasRequiredResource$1;function requireStubMethods(){if(hasRequiredStubMethods)return stubMethods;hasRequiredStubMethods=1,Object.defineProperty(stubMethods,"__esModule",{value:!0}),stubMethods.stubRemovedMethods=function(t,r,n,i){var a="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(t);i.forEach((function(t){o.methodName||(o[t]=function(){throw e.log.removed("Calling removed method ".concat(r,".").concat(t,": "),a)(),new Error(t)})}))};var e=es5$c;return stubMethods}function requireResource$1(){if(hasRequiredResource$1)return resource$1;hasRequiredResource$1=1;var e=interopRequireDefaultExports;Object.defineProperty(resource$1,"__esModule",{value:!0}),resource$1.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$c,i=init,a=constantsToKeys,o=requireAssert$3(),s=requireUtils$4(),l=requireStubMethods();function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c="Resource subclass must define virtual methods",d=function(e){function d(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,d),(0,n.assertWebGLContext)(e);var i=r.id,a=r.userData,o=void 0===a?{}:a;this.gl=e,this.gl2=e,this.id=i||(0,s.uid)(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=r.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return(0,r.default)(d,[{key:e,get:function(){return"Resource"}},{key:"toString",value:function(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,t=void 0!==e&&e,r=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,r&&t&&r.filter(Boolean).forEach((function(e){return e.delete()})),this}},{key:"bind",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof t?(this._bindHandle(t),this):(this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=(0,a.getKeyValue)(this.gl,e),(0,o.assert)(e);var r=(this.constructor.PARAMETERS||{})[e];if(r){var i=(0,n.isWebGL2)(this.gl);if("webgl2"in r&&!i||"extension"in r&&!this.gl.getExtension(r.extension))return i&&"webgl2"in r?r.webgl2:r.webgl1}return this._getParameter(e,t)}},{key:"getParameters",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.parameters,i=t.keys,o=this.constructor.PARAMETERS||{},s=(0,n.isWebGL2)(this.gl),l={},c=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(r||Object.keys(o));try{for(c.s();!(e=c.n()).done;){var d=e.value,h=o[d];if(h&&(!("webgl2"in h)||s)&&(!("extension"in h)||this.gl.getExtension(h.extension))){var f=i?(0,a.getKey)(this.gl,d):d;l[f]=this.getParameter(d,t),i&&"GLenum"===h.type&&(l[f]=(0,a.getKey)(this.gl,l[f]))}}}catch(e){c.e(e)}finally{c.f()}return l}},{key:"setParameter",value:function(e,t){e=(0,a.getKeyValue)(this.gl,e),(0,o.assert)(e);var r=(this.constructor.PARAMETERS||{})[e];if(r){var i=(0,n.isWebGL2)(this.gl);if("webgl2"in r&&!i||"extension"in r&&!this.gl.getExtension(r.extension))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=(0,a.getKeyValue)(t))}return this._setParameter(e,t),this}},{key:"setParameters",value:function(e){for(var t in e)this.setParameter(t,e[t]);return this}},{key:"stubRemovedMethods",value:function(e,t,r){return(0,l.stubRemovedMethods)(this,e,t,r)}},{key:"initialize",value:function(e){}},{key:"_createHandle",value:function(){throw new Error(c)}},{key:"_deleteHandle",value:function(){throw new Error(c)}},{key:"_bindHandle",value:function(e){throw new Error(c)}},{key:"_getOptsFromHandle",value:function(){throw new Error(c)}},{key:"_getParameter",value:function(e,t){throw new Error(c)}},{key:"_setParameter",value:function(e,t){throw new Error(c)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var e=this[Symbol.toStringTag],t=i.lumaStats.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var e=this[Symbol.toStringTag];i.lumaStats.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}},{key:"_trackAllocatedMemoryForContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],r=i.lumaStats.get("Memory Usage".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:""));r.get("GPU Memory").addCount(e),r.get("".concat(t," Memory")).addCount(e)}},{key:"_trackDeallocatedMemory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}},{key:"_trackDeallocatedMemoryForContext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],t=i.lumaStats.get("Memory Usage".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:""));t.get("GPU Memory").subtractCount(this.byteLength),t.get("".concat(e," Memory")).subtractCount(this.byteLength)}}]),d}(Symbol.toStringTag);return resource$1.default=d,resource$1}var buffer={},accessor={},typedArrayUtils={},hasRequiredTypedArrayUtils;function requireTypedArrayUtils(){if(hasRequiredTypedArrayUtils)return typedArrayUtils;hasRequiredTypedArrayUtils=1,Object.defineProperty(typedArrayUtils,"__esModule",{value:!0}),typedArrayUtils.flipRows=function(e){var t=e.data,r=e.height,n=e.bytesPerPixel,i=e.temp,a=e.width*(void 0===n?4:n);i=i||new Uint8Array(a);for(var o=0;o<r/2;++o){var s=o*a,l=(r-o-1)*a;i.set(t.subarray(s,s+a)),t.copyWithin(s,l,l+a),t.set(i,l)}},typedArrayUtils.getGLTypeFromTypedArray=function(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(e)}},typedArrayUtils.getTypedArrayFromGLType=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,r=void 0===t||t;switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}},typedArrayUtils.scalePixels=function(e){for(var t=e.data,r=e.width,n=e.height,i=Math.round(r/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var l=0;l<i;l++)for(var u=0;u<4;u++)o[4*(s*i+l)+u]=t[4*(2*s*r+2*l)+u];return{data:o,width:i,height:a}};var e="Failed to deduce GL constant from typed array";return typedArrayUtils}var checkProps={},hasRequiredCheckProps,hasRequiredAccessor,hasRequiredBuffer;function requireCheckProps(){if(hasRequiredCheckProps)return checkProps;hasRequiredCheckProps=1,Object.defineProperty(checkProps,"__esModule",{value:!0}),checkProps.checkProps=function(t,r,n){var i=n.removedProps,a=void 0===i?{}:i,o=n.deprecatedProps,s=void 0===o?{}:o,l=n.replacedProps,u=void 0===l?{}:l;for(var c in a)if(c in r){var d=a[c]?"".concat(t,".").concat(a[c]):"N/A";e.log.removed("".concat(t,".").concat(c),d)()}for(var h in s)if(h in r){var f=s[h];e.log.deprecated("".concat(t,".").concat(h),"".concat(t,".").concat(f))()}var p=null;for(var m in u)if(m in r){var g=u[m];e.log.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(g))(),(p=p||Object.assign({},r))[g]=r[m],delete p[m]}return p||r};var e=es5$c;return checkProps}function requireAccessor(){if(hasRequiredAccessor)return accessor;hasRequiredAccessor=1;var e=interopRequireDefaultExports;Object.defineProperty(accessor,"__esModule",{value:!0}),accessor.default=accessor.DEFAULT_ACCESSOR_VALUES=void 0;var t=e(requireConstruct()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=requireTypedArrayUtils(),a=requireAssert$3(),o=requireCheckProps(),s={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1};accessor.DEFAULT_ACCESSOR_VALUES=s;var l={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},u=function(){function e(){var t=this;(0,r.default)(this,e);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];i.forEach((function(e){return t._assign(e)})),Object.freeze(this)}return(0,n.default)(e,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return e.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return e.getBytesPerVertex(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==(e=(0,o.checkProps)("Accessor",e,l)).type&&(this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&(this.index="boolean"==typeof e.index?e.index?1:0:e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(e){return(0,i.getTypedArrayFromGLType)(e.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){return(0,a.assert)(e.size),(0,i.getTypedArrayFromGLType)(e.type||5126).BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(0,t.default)(e,[s].concat(n))}}]),e}();return accessor.default=u,accessor}function requireBuffer(){if(hasRequiredBuffer)return buffer;hasRequiredBuffer=1;var e=interopRequireDefaultExports;Object.defineProperty(buffer,"__esModule",{value:!0}),buffer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireResource$1()),l=e(requireAccessor()),u=requireTypedArrayUtils(),c=es5$c,d=requireAssert$3(),h=requireCheckProps(),f={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},p={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:f},m={removedProps:f},g=function(e,s){(0,i.default)(y,e);var f,g,_=(f=y,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(f);if(g){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function y(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,y),(r=_.call(this,e,i)).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),r.target=i.target||(r.gl.webgl2?36662:34962),r.initialize(i),Object.seal((0,n.default)(r)),r}return(0,r.default)(y,[{key:s,get:function(){return"Buffer"}},{key:"getElementCount",value:function(){return Math.round(this.byteLength/l.default.getBytesPerElement(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}},{key:"getVertexCount",value:function(){return Math.round(this.byteLength/l.default.getBytesPerVertex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=(0,h.checkProps)("Buffer",e,p),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}},{key:"setProps",value:function(e){return"accessor"in(e=(0,h.checkProps)("Buffer",e,m))&&this.setAccessor(e.accessor),this}},{key:"setAccessor",value:function(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new l.default(e),this}},{key:"reallocate",value:function(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}},{key:"setData",value:function(e){return this.initialize(e)}},{key:"subData",value:function(e){ArrayBuffer.isView(e)&&(e={data:e});var t=e.data,r=e.offset,n=void 0===r?0:r,i=e.srcOffset,a=void 0===i?0:i,o=e.byteLength||e.length;(0,d.assert)(t);var s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==a||void 0!==o?((0,c.assertWebGL2Context)(this.gl),this.gl.bufferSubData(this.target,n,t,a,o)):this.gl.bufferSubData(s,n,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}},{key:"copyData",value:function(e){var t=e.sourceBuffer,r=e.readOffset,n=void 0===r?0:r,i=e.writeOffset,a=void 0===i?0:i,o=e.size,s=this.gl;return(0,c.assertWebGL2Context)(s),s.bindBuffer(36662,t.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dstData,r=void 0===t?null:t,n=e.srcByteOffset,i=void 0===n?0:n,a=e.dstOffset,o=void 0===a?0:a,s=e.length,l=void 0===s?0:s;(0,c.assertWebGL2Context)(this.gl);var h,f,p=(0,u.getTypedArrayFromGLType)(this.accessor.type||5126,{clamped:!1}),m=this._getAvailableElementCount(i);r?h=(f=r.length)-o:f=o+(h=Math.min(m,l||m));var g=Math.min(m,h);return(0,d.assert)((l=l||g)<=g),r=r||new p(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,r,o,l),this.gl.bindBuffer(36662,null),r}},{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,r=void 0===t?this.target:t,n=e.index,i=void 0===n?this.accessor&&this.accessor.index:n,a=e.offset,o=void 0===a?0:a,s=e.size;return 35345===r||35982===r?void 0!==s?this.gl.bindBufferRange(r,i,this.handle,o,s):((0,d.assert)(0===o),this.gl.bindBufferBase(r,i,this.handle)):this.gl.bindBuffer(r,this.handle),this}},{key:"unbind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,r=void 0===t?this.target:t,n=e.index;return 35345===r||35982===r?this.gl.bindBufferBase(r,void 0===n?this.accessor&&this.accessor.index:n,null):this.gl.bindBuffer(r,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength+t;(0,d.assert)(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();var n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,10),this.bytesUsed=r,this._trackAllocatedMemory(r);var i=(0,u.getGLTypeFromTypedArray)(e);return(0,d.assert)(i),this.setAccessor(new l.default(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;(0,d.assert)(e>=0),this._trackDeallocatedMemory();var r=e;0===e&&(r=new Float32Array(0));var n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(e){var t=e/(0,u.getTypedArrayFromGLType)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}},{key:"_inferType",value:function(e){this.accessor.type||this.setAccessor(new l.default(this.accessor,{type:(0,u.getGLTypeFromTypedArray)(e)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(e){this.gl.bindBuffer(this.target,this.handle);var t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}},{key:"type",get:function(){return c.log.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return c.log.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(e){return c.log.deprecated("setByteLength","reallocate")(),this.reallocate(e)}},{key:"updateAccessor",value:function(e){return c.log.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new l.default(this.accessor,e),this}}]),y}(s.default,Symbol.toStringTag);return buffer.default=g,buffer}var textureFormats={},hasRequiredTextureFormats,hasRequiredTexture$1;function requireTextureFormats(){if(hasRequiredTextureFormats)return textureFormats;hasRequiredTextureFormats=1;var e=interopRequireDefaultExports;Object.defineProperty(textureFormats,"__esModule",{value:!0}),textureFormats.TYPE_SIZES=textureFormats.TEXTURE_FORMATS=textureFormats.DATA_FORMAT_CHANNELS=void 0,textureFormats.isFormatSupported=function(e,t){var r=o[t];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;var n=(0,a.isWebGL2)(e)&&r.gl2||r.gl1;return"string"==typeof n?e.getExtension(n):n},textureFormats.isLinearFilteringSupported=function(e,t){var r=o[t];switch(r&&r.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}};var t,r,n,i=e(requireDefineProperty()),a=es5$c,o=((0,i.default)(t={},6407,{dataFormat:6407,types:[5121,33635]}),(0,i.default)(t,6408,{dataFormat:6408,types:[5121,32819,32820]}),(0,i.default)(t,6406,{dataFormat:6406,types:[5121]}),(0,i.default)(t,6409,{dataFormat:6409,types:[5121]}),(0,i.default)(t,6410,{dataFormat:6410,types:[5121]}),(0,i.default)(t,33326,{dataFormat:6403,types:[5126],gl2:!0}),(0,i.default)(t,33328,{dataFormat:33319,types:[5126],gl2:!0}),(0,i.default)(t,34837,{dataFormat:6407,types:[5126],gl2:!0}),(0,i.default)(t,34836,{dataFormat:6408,types:[5126],gl2:!0}),t);textureFormats.TEXTURE_FORMATS=o;var s=((0,i.default)(r={},6403,1),(0,i.default)(r,36244,1),(0,i.default)(r,33319,2),(0,i.default)(r,33320,2),(0,i.default)(r,6407,3),(0,i.default)(r,36248,3),(0,i.default)(r,6408,4),(0,i.default)(r,36249,4),(0,i.default)(r,6402,1),(0,i.default)(r,34041,1),(0,i.default)(r,6406,1),(0,i.default)(r,6409,1),(0,i.default)(r,6410,2),r);textureFormats.DATA_FORMAT_CHANNELS=s;var l=((0,i.default)(n={},5126,4),(0,i.default)(n,5125,4),(0,i.default)(n,5124,4),(0,i.default)(n,5123,2),(0,i.default)(n,5122,2),(0,i.default)(n,5131,2),(0,i.default)(n,5120,1),(0,i.default)(n,5121,1),n);return textureFormats.TYPE_SIZES=l,textureFormats}function requireTexture$1(){if(hasRequiredTexture$1)return texture$1;hasRequiredTexture$1=1;var e=interopRequireDefaultExports;Object.defineProperty(texture$1,"__esModule",{value:!0}),texture$1.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$c,l=e(requireResource$1()),u=e(requireBuffer()),c=requireTextureFormats(),d=requireAssert$3(),h=requireUtils$4();function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=[9729,9728],m=globalThis.WebGLBuffer||function(){},g=function(e,l){(0,i.default)(v,e);var g,_,y=(g=v,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(g);if(_){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function v(e,t){var n;(0,r.default)(this,v);var i=t.id,a=void 0===i?(0,h.uid)("texture"):i,o=t.target;return(n=y.call(this,e,{id:a,handle:t.handle})).target=o,n.textureUnit=void 0,n.loaded=!1,n.width=void 0,n.height=void 0,n.depth=void 0,n.format=void 0,n.type=void 0,n.dataFormat=void 0,n.border=void 0,n.textureUnit=void 0,n.mipmaps=void 0,n}return(0,n.default)(v,[{key:l,get:function(){return"Texture"}},{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data;if(r instanceof Promise)return r.then((function(r){return e.initialize(Object.assign({},t,{pixels:r,data:r}))})),this;var n="undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",(function(){return e.initialize(t)})),this;var i=t.pixels,a=t.format,o=void 0===a?6408:a,l=t.border,u=void 0===l?0:l,c=t.recreate,d=void 0!==c&&c,h=t.parameters,f=void 0===h?{}:h,p=t.pixelStore,m=void 0===p?{}:p,g=t.textureUnit,_=void 0===g?void 0:g;r||(r=void 0===i?null:i);var y=t.width,v=t.height,b=t.dataFormat,x=t.type,T=t.compressed,w=void 0!==T&&T,E=t.mipmaps,A=void 0===E||E,S=t.depth,P=void 0===S?0:S,M=this._deduceParameters({format:o,type:x,dataFormat:b,compressed:w,data:r,width:y,height:v});return v=M.height,w=M.compressed,b=M.dataFormat,x=M.type,this.width=y=M.width,this.height=v,this.depth=P,this.format=o,this.type=x,this.dataFormat=b,this.border=u,this.textureUnit=_,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),A&&this._isNPOT()&&(s.log.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),A=!1,this._updateForNPOT(f)),this.mipmaps=A,this.setImageData({data:r,width:y,height:v,depth:P,format:o,type:x,dataFormat:b,border:u,mipmaps:A,parameters:m,compressed:w}),A&&this.generateMipmap(),this.setParameters(f),d&&(this.data=r),n&&(this._video={video:r,parameters:f,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var e=this._video,t=e.video;if(e.lastTime===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e.parameters}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}},{key:"resize",value:function(e){var t=e.height,r=e.width,n=e.mipmaps;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:void 0!==n&&n}):this}},{key:"generateMipmap",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(s.log.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),(0,s.withParameters)(this.gl,t,(function(){e.gl.generateMipmap(e.target)})),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(e){this._trackDeallocatedMemory("Texture");var r=e.target,n=void 0===r?this.target:r,i=e.pixels,a=e.level,o=void 0===a?0:a,l=e.format,u=void 0===l?this.format:l,h=e.border,p=void 0===h?this.border:h,m=e.offset,g=void 0===m?0:m,_=e.parameters,y=void 0===_?{}:_,v=e.data,b=void 0===v?null:v,x=e.type,T=void 0===x?this.type:x,w=e.width,E=void 0===w?this.width:w,A=e.height,S=void 0===A?this.height:A,P=e.dataFormat,M=void 0===P?this.dataFormat:P,R=e.compressed,C=void 0!==R&&R;b||(b=void 0===i?null:i);var O=this._deduceParameters({format:u,type:T,dataFormat:M,compressed:C,data:b,width:E,height:S});T=O.type,M=O.dataFormat,C=O.compressed,E=O.width,S=O.height;var L=this.gl;L.bindTexture(this.target,this.handle);var I,D,k=this._getDataType({data:b,compressed:C});b=k.data,I=k.dataType;var B=0;return(0,s.withParameters)(this.gl,y,(function(){switch(I){case"null":L.texImage2D(n,o,u,E,S,p,M,T,b);break;case"typed-array":L.texImage2D(n,o,u,E,S,p,M,T,b,g);break;case"buffer":(D=(0,s.assertWebGL2Context)(L)).bindBuffer(35052,b.handle||b),D.texImage2D(n,o,u,E,S,p,M,T,g),D.bindBuffer(35052,null);break;case"browser-object":(0,s.isWebGL2)(L)?L.texImage2D(n,o,u,E,S,p,M,T,b):L.texImage2D(n,o,u,M,T,b);break;case"compressed":var e,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(b.entries());try{for(r.s();!(e=r.n()).done;){var i=(0,t.default)(e.value,2),a=i[1];L.compressedTexImage2D(n,i[0],a.format,a.width,a.height,p,a.data),B+=a.levelSize}}catch(e){r.e(e)}finally{r.f()}break;default:(0,d.assert)(!1,"Unknown image data type")}})),this._trackAllocatedMemory("compressed"===I?B:b&&b.byteLength?b.byteLength:this.width*this.height*(c.DATA_FORMAT_CHANNELS[this.dataFormat]||4)*(c.TYPE_SIZES[this.type]||1),"Texture"),this.loaded=!0,this}},{key:"setSubImageData",value:function(e){var t=this,r=e.target,n=void 0===r?this.target:r,i=e.pixels,a=void 0===i?null:i,o=e.data,l=void 0===o?null:o,c=e.x,h=void 0===c?0:c,f=e.y,p=void 0===f?0:f,g=e.width,_=void 0===g?this.width:g,y=e.height,v=void 0===y?this.height:y,b=e.level,x=void 0===b?0:b,T=e.format,w=void 0===T?this.format:T,E=e.type,A=void 0===E?this.type:E,S=e.dataFormat,P=void 0===S?this.dataFormat:S,M=e.compressed,R=void 0!==M&&M,C=e.offset,O=void 0===C?0:C,L=e.parameters,I=void 0===L?{}:L,D=this._deduceParameters({format:w,type:A,dataFormat:P,compressed:R,data:l,width:_,height:v});if(A=D.type,P=D.dataFormat,R=D.compressed,_=D.width,v=D.height,(0,d.assert)(0===this.depth,"texSubImage not supported for 3D textures"),l||(l=a),l&&l.data){var k=l;l=k.data,_=k.shape[0],v=k.shape[1]}l instanceof u.default&&(l=l.handle),this.gl.bindTexture(this.target,this.handle),(0,s.withParameters)(this.gl,I,(function(){if(R)t.gl.compressedTexSubImage2D(n,x,h,p,_,v,w,l);else if(null===l)t.gl.texSubImage2D(n,x,h,p,_,v,P,A,null);else if(ArrayBuffer.isView(l))t.gl.texSubImage2D(n,x,h,p,_,v,P,A,l,O);else if(l instanceof m){var e=(0,s.assertWebGL2Context)(t.gl);e.bindBuffer(35052,l),e.texSubImage2D(n,x,h,p,_,v,P,A,O),e.bindBuffer(35052,null)}else(0,s.isWebGL2)(t.gl)?(0,s.assertWebGL2Context)(t.gl).texSubImage2D(n,x,h,p,_,v,P,A,l):t.gl.texSubImage2D(n,x,h,p,P,A,l)})),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){return s.log.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,t=this.gl;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}},{key:"unbind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,t=this.gl;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}},{key:"_getDataType",value:function(e){var t=e.data,r=e.compressed;return void 0!==r&&r?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof u.default?{data:t.handle,dataType:"buffer"}:t instanceof m?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(e){var t=e.format,r=e.data,n=e.width,i=e.height,a=e.dataFormat,o=e.type,s=e.compressed,l=c.TEXTURE_FORMATS[t];a=a||l&&l.dataFormat,o=o||l&&l.types[0],s=s||l&&l.compressed;var u=this._deduceImageSize(r,n,i);return{dataFormat:a,type:o,compressed:s,width:n=u.width,height:i=u.height,format:t,data:r}}},{key:"_deduceImageSize",value:function(e,t,r){var n;return n="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:r}:{width:t>=0?t:1,height:r>=0?r:1},(0,d.assert)(n,"Could not deduced texture size"),(0,d.assert)(void 0===t||n.width===t,"Deduced texture width does not match supplied width"),(0,d.assert)(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}},{key:"_setParameter",value:function(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:(0,d.assert)(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!((0,s.isWebGL2)(this.gl)||!this.width||!this.height||(0,h.isPowerOfTwo)(this.width)&&(0,h.isPowerOfTwo)(this.height))}},{key:"_updateForNPOT",value:function(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(e,t){if(this._isNPOT())switch(e){case 10241:-1===p.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}],[{key:"isSupported",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.format,n=t.linearFiltering,i=!0;return r&&(i=(i=i&&(0,c.isFormatSupported)(e,r))&&(!n||(0,c.isLinearFilteringSupported)(e,r))),i}}]),v}(l.default,Symbol.toStringTag);return texture$1.default=g,texture$1}var loadFile={},hasRequiredLoadFile,hasRequiredTexture2d;function requireLoadFile(){if(hasRequiredLoadFile)return loadFile;hasRequiredLoadFile=1,Object.defineProperty(loadFile,"__esModule",{value:!0}),loadFile.loadFile=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,e.assert)("string"==typeof r),r=t+r;var i=n.dataType||"text";return fetch(r,n).then((function(e){return e[i]()}))},loadFile.loadImage=function(r,n){return(0,e.assert)("string"==typeof r),r=t+r,new Promise((function(e,t){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return t(new Error("Could not load image ".concat(r,".")))},i.crossOrigin=n&&n.crossOrigin||"anonymous",i.src=r}catch(e){t(e)}}))},loadFile.setPathPrefix=function(e){t=e};var e=requireAssert$3(),t="";return loadFile}function requireTexture2d(){if(hasRequiredTexture2d)return texture2d;hasRequiredTexture2d=1;var e=interopRequireDefaultExports;Object.defineProperty(texture2d,"__esModule",{value:!0}),texture2d.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$c,l=e(requireTexture$1()),u=requireLoadFile(),c=function(e,c){(0,i.default)(p,e);var d,h,f=(d=p,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(d);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,p),(0,s.assertWebGLContext)(e),(i instanceof Promise||"string"==typeof i)&&(i={data:i}),"string"==typeof i.data&&(i=Object.assign({},i,{data:(0,u.loadImage)(i.data)})),(r=f.call(this,e,Object.assign({},i,{target:3553}))).initialize(i),Object.seal((0,n.default)(r)),r}return(0,r.default)(p,[{key:c,get:function(){return"Texture2D"}}],[{key:"isSupported",value:function(e,t){return l.default.isSupported(e,t)}}]),p}(l.default,Symbol.toStringTag);return texture2d.default=c,texture2d}var textureCube={},hasRequiredTextureCube;function requireTextureCube(){if(hasRequiredTextureCube)return textureCube;hasRequiredTextureCube=1;var e=interopRequireDefaultExports;Object.defineProperty(textureCube,"__esModule",{value:!0}),textureCube.default=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=es5$c,c=e(requireTexture$1()),d=[34069,34070,34071,34072,34073,34074],h=function(e,c){(0,o.default)(g,e);var h,f,p,m=(f=g,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(f);if(p){var r=(0,l.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,s.default)(this,e)});function g(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.default)(this,g),(0,u.assertWebGLContext)(e),(t=m.call(this,e,Object.assign({},r,{target:34067}))).initialize(r),Object.seal((0,a.default)(t)),t}return(0,i.default)(g,[{key:c,get:function(){return"TextureCube"}},{key:"initialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.mipmaps,n=void 0===r||r,i=t.parameters,a=void 0===i?{}:i;return this.opts=t,this.setCubeMapImageData(t).then((function(){e.loaded=!0,n&&e.generateMipmap(t),e.setParameters(a)})),this}},{key:"subImage",value:function(e){var t=e.x,r=e.y,n=e.mipmapLevel;return this._subImage({target:e.face,data:e.data,x:void 0===t?0:t,y:void 0===r?0:r,mipmapLevel:void 0===n?0:n})}},{key:"setCubeMapImageData",value:(h=(0,r.default)(t.default.mark((function e(r){var n,i,a,o,s,l,c,h,f,p,m,g,_=this;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.width,i=r.height,a=r.data,s=void 0===(o=r.border)?0:o,c=void 0===(l=r.format)?6408:l,f=void 0===(h=r.type)?5121:h,p=this.gl,m=r.pixels||a,e.next=5,Promise.all(d.map((function(e){var t=m[e];return Promise.all(Array.isArray(t)?t:[t])})));case 5:g=e.sent,this.bind(),d.forEach((function(e,t){g[t].length>1&&!1!==_.opts.mipmaps&&u.log.warn("".concat(_.id," has mipmap and multiple LODs."))(),g[t].forEach((function(t,r){n&&i?p.texImage2D(e,r,c,n,i,s,c,f,t):p.texImage2D(e,r,c,c,f,t)}))})),this.unbind();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"setImageDataForFace",value:function(e){var t=this,r=e.face,n=e.width,i=e.height,a=e.border,o=void 0===a?0:a,s=e.format,l=void 0===s?6408:s,u=e.type,c=void 0===u?5121:u,d=this.gl,h=e.pixels||e.data;return this.bind(),h instanceof Promise?h.then((function(n){return t.setImageDataForFace(Object.assign({},e,{face:r,data:n,pixels:n}))})):this.width||this.height?d.texImage2D(r,0,l,n,i,o,l,c,h):d.texImage2D(r,0,l,l,c,h),this}}]),g}(c.default,Symbol.toStringTag);return textureCube.default=h,h.FACES=d,textureCube}var texture3d={},hasRequiredTexture3d;function requireTexture3d(){if(hasRequiredTexture3d)return texture3d;hasRequiredTexture3d=1;var e=interopRequireDefaultExports;Object.defineProperty(texture3d,"__esModule",{value:!0}),texture3d.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$c,l=e(requireTexture$1()),u=requireTextureFormats(),c=e(requireBuffer()),d=function(e,l){(0,i.default)(p,e);var d,h,f=(d=p,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(d);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,p),(0,s.assertWebGL2Context)(e),i=Object.assign({depth:1},i,{target:32879,unpackFlipY:!1}),(r=f.call(this,e,i)).initialize(i),Object.seal((0,n.default)(r)),r}return(0,r.default)(p,[{key:l,get:function(){return"Texture3D"}},{key:"setImageData",value:function(e){var t=this,r=e.level,n=void 0===r?0:r,i=e.dataFormat,a=void 0===i?6408:i,o=e.width,l=e.height,d=e.depth,h=void 0===d?1:d,f=e.border,p=void 0===f?0:f,m=e.format,g=e.type,_=void 0===g?5121:g,y=e.offset,v=void 0===y?0:y,b=e.data,x=e.parameters,T=void 0===x?{}:x;return this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),(0,s.withParameters)(this.gl,T,(function(){ArrayBuffer.isView(b)&&t.gl.texImage3D(t.target,n,a,o,l,h,p,m,_,b),b instanceof c.default&&(t.gl.bindBuffer(35052,b.handle),t.gl.texImage3D(t.target,n,a,o,l,h,p,m,_,v))})),this._trackAllocatedMemory(b&&b.byteLength?b.byteLength:this.width*this.height*this.depth*(u.DATA_FORMAT_CHANNELS[this.dataFormat]||4)*(u.TYPE_SIZES[this.type]||1),"Texture"),this.loaded=!0,this}}],[{key:"isSupported",value:function(e){return(0,s.isWebGL2)(e)}}]),p}(l.default,Symbol.toStringTag);return texture3d.default=d,texture3d}var framebuffer={},renderbuffer={},renderbufferFormats={},hasRequiredRenderbufferFormats,hasRequiredRenderbuffer;function requireRenderbufferFormats(){if(hasRequiredRenderbufferFormats)return renderbufferFormats;hasRequiredRenderbufferFormats=1;var e=interopRequireDefaultExports;Object.defineProperty(renderbufferFormats,"__esModule",{value:!0}),renderbufferFormats.default=void 0;var t,r=e(requireDefineProperty()),n="EXT_color_buffer_float",i=((0,r.default)(t={},33189,{bpp:2}),(0,r.default)(t,33190,{gl2:!0,bpp:3}),(0,r.default)(t,36012,{gl2:!0,bpp:4}),(0,r.default)(t,36168,{bpp:1}),(0,r.default)(t,34041,{bpp:4}),(0,r.default)(t,35056,{gl2:!0,bpp:4}),(0,r.default)(t,36013,{gl2:!0,bpp:5}),(0,r.default)(t,32854,{bpp:2}),(0,r.default)(t,36194,{bpp:2}),(0,r.default)(t,32855,{bpp:2}),(0,r.default)(t,33321,{gl2:!0,bpp:1}),(0,r.default)(t,33330,{gl2:!0,bpp:1}),(0,r.default)(t,33329,{gl2:!0,bpp:1}),(0,r.default)(t,33332,{gl2:!0,bpp:2}),(0,r.default)(t,33331,{gl2:!0,bpp:2}),(0,r.default)(t,33334,{gl2:!0,bpp:4}),(0,r.default)(t,33333,{gl2:!0,bpp:4}),(0,r.default)(t,33323,{gl2:!0,bpp:2}),(0,r.default)(t,33336,{gl2:!0,bpp:2}),(0,r.default)(t,33335,{gl2:!0,bpp:2}),(0,r.default)(t,33338,{gl2:!0,bpp:4}),(0,r.default)(t,33337,{gl2:!0,bpp:4}),(0,r.default)(t,33340,{gl2:!0,bpp:8}),(0,r.default)(t,33339,{gl2:!0,bpp:8}),(0,r.default)(t,32849,{gl2:!0,bpp:3}),(0,r.default)(t,32856,{gl2:!0,bpp:4}),(0,r.default)(t,32857,{gl2:!0,bpp:4}),(0,r.default)(t,36220,{gl2:!0,bpp:4}),(0,r.default)(t,36238,{gl2:!0,bpp:4}),(0,r.default)(t,36975,{gl2:!0,bpp:4}),(0,r.default)(t,36214,{gl2:!0,bpp:8}),(0,r.default)(t,36232,{gl2:!0,bpp:8}),(0,r.default)(t,36226,{gl2:!0,bpp:16}),(0,r.default)(t,36208,{gl2:!0,bpp:16}),(0,r.default)(t,33325,{gl2:n,bpp:2}),(0,r.default)(t,33327,{gl2:n,bpp:4}),(0,r.default)(t,34842,{gl2:n,bpp:8}),(0,r.default)(t,33326,{gl2:n,bpp:4}),(0,r.default)(t,33328,{gl2:n,bpp:8}),(0,r.default)(t,34836,{gl2:n,bpp:16}),(0,r.default)(t,35898,{gl2:n,bpp:4}),t);return renderbufferFormats.default=i,renderbufferFormats}function requireRenderbuffer(){if(hasRequiredRenderbuffer)return renderbuffer;hasRequiredRenderbuffer=1;var e=interopRequireDefaultExports;Object.defineProperty(renderbuffer,"__esModule",{value:!0}),renderbuffer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireResource$1()),l=e(requireRenderbufferFormats()),u=es5$c,c=requireAssert$3(),d=function(e,s){(0,i.default)(p,e);var d,h,f=(d=p,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(d);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,p),(r=f.call(this,e,i)).initialize(i),Object.seal((0,n.default)(r)),r}return(0,r.default)(p,[{key:s,get:function(){return"Renderbuffer"}},{key:"initialize",value:function(e){var t=e.format,r=e.width,n=void 0===r?1:r,i=e.height,a=void 0===i?1:i,o=e.samples,s=void 0===o?0:o;return(0,c.assert)(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&(0,u.isWebGL2)(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,t,n,a):this.gl.renderbufferStorage(36161,t,n,a),this.format=t,this.width=n,this.height=a,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*l.default[this.format].bpp),this}},{key:"resize",value:function(e){var t=e.width,r=e.height;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(e){this.gl.bindRenderbuffer(36161,e)}},{key:"_syncHandle",value:function(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}],[{key:"isSupported",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null}).format;return!t||function(e,t,r){var n=r[t];if(!n)return!1;var i=(0,u.isWebGL2)(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,t,l.default)}},{key:"getSamplesForFormat",value:function(e,t){return e.getInternalformatParameter(36161,t.format,32937)}}]),p}(s.default,Symbol.toStringTag);return renderbuffer.default=d,renderbuffer}var clear={},hasRequiredClear;function requireClear(){if(hasRequiredClear)return clear;hasRequiredClear=1;var e=interopRequireDefaultExports;Object.defineProperty(clear,"__esModule",{value:!0}),clear.clear=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.framebuffer,l=void 0===s?null:s,u=t.color,c=void 0===u?null:u,h=t.depth,f=void 0===h?null:h,p=t.stencil,m=void 0===p?null:p,g={};l&&(g.framebuffer=l);var _=0;c&&(_|=o,!0!==c&&(g.clearColor=c)),f&&(_|=i,!0!==f&&(g.clearDepth=f)),m&&(_|=a,!0!==f&&(g.clearStencil=f)),(0,n.assert)(0!==_,d),(0,r.withParameters)(e,g,(function(){e.clear(_)}))},clear.clearBuffer=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.framebuffer,o=void 0===a?null:a,h=i.buffer,f=void 0===h?s:h,p=i.drawBuffer,m=void 0===p?0:p,g=i.value,_=void 0===g?[0,0,0,0]:g;(0,r.assertWebGL2Context)(e),(0,r.withParameters)(e,{framebuffer:o},(function(){switch(f){case s:switch(_.constructor){case Int32Array:e.clearBufferiv(f,m,_);break;case Uint32Array:e.clearBufferuiv(f,m,_);break;case Float32Array:default:e.clearBufferfv(f,m,_)}break;case l:e.clearBufferfv(l,0,[_]);break;case u:e.clearBufferiv(u,0,[_]);break;case c:var r=(0,t.default)(_,2);e.clearBufferfi(c,0,r[0],r[1]);break;default:(0,n.assert)(!1,d)}}))};var t=e(requireSlicedToArray()),r=es5$c,n=requireAssert$3(),i=256,a=1024,o=16384,s=6144,l=6145,u=6146,c=34041,d="clear: bad arguments";return clear}var copyAndBlit={},formatUtils={},hasRequiredFormatUtils,hasRequiredCopyAndBlit;function requireFormatUtils(){if(hasRequiredFormatUtils)return formatUtils;hasRequiredFormatUtils=1,Object.defineProperty(formatUtils,"__esModule",{value:!0}),formatUtils.glFormatToComponents=function(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return(0,e.assert)(!1),0}},formatUtils.glTypeToBytes=function(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return(0,e.assert)(!1),0}};var e=requireAssert$3();return formatUtils}function requireCopyAndBlit(){if(hasRequiredCopyAndBlit)return copyAndBlit;hasRequiredCopyAndBlit=1;var e=interopRequireDefaultExports;Object.defineProperty(copyAndBlit,"__esModule",{value:!0}),copyAndBlit.blit=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.sourceX0,a=void 0===n?0:n,o=r.sourceY0,s=void 0===o?0:o,u=r.targetX0,c=void 0===u?0:u,h=r.targetY0,f=void 0===h?0:h,p=r.color,m=void 0===p||p,g=r.depth,_=void 0!==g&&g,y=r.stencil,v=void 0!==y&&y,b=r.filter,x=void 0===b?9728:b,T=r.sourceX1,w=r.sourceY1,E=r.targetX1,A=r.targetY1,S=r.sourceAttachment,P=void 0===S?36064:S,M=r.mask,R=void 0===M?0:M,C=d(e),O=C.framebuffer,L=C.deleteFramebuffer,I=d(t),D=I.framebuffer,k=I.deleteFramebuffer;(0,l.assert)(O),(0,l.assert)(D);var B=D.gl,F=D.handle,N=D.width,q=D.height,U=D.readBuffer,j=(0,i.assertWebGL2Context)(B);O.handle||36064!==P||(P=1028),m&&(R|=16384),_&&(R|=256),v&&(R|=1024),(L||k)&&1280&R&&(R=16384,i.log.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")()),(0,l.assert)(R),T=void 0===T?O.width:T,w=void 0===w?O.height:w,E=void 0===E?N:E,A=void 0===A?q:A;var G=B.bindFramebuffer(36009,F),z=B.bindFramebuffer(36008,O.handle);return j.readBuffer(P),j.blitFramebuffer(a,s,T,w,c,f,E,A,R,x),j.readBuffer(U),j.bindFramebuffer(36008,z||null),j.bindFramebuffer(36009,G||null),L&&O.delete(),k&&D.delete(),D},copyAndBlit.copyToDataUrl=c,copyAndBlit.copyToImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sourceAttachment,n=t.targetImage,i=void 0===n?null:n,a=c(e,{sourceAttachment:void 0===r?36064:r});return(i=i||new Image).src=a,i},copyAndBlit.copyToTexture=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.sourceX,o=void 0===a?0:a,s=r.sourceY,u=void 0===s?0:s,c=r.targetMipmaplevel,h=void 0===c?0:c,f=r.targetInternalFormat,p=void 0===f?6408:f,m=r.targetX,g=r.targetY,_=r.targetZ,y=r.width,v=r.height,b=d(e),x=b.framebuffer,T=b.deleteFramebuffer;(0,l.assert)(x);var w=x.gl,E=void 0!==m||void 0!==g||void 0!==_;m=m||0,g=g||0,_=_||0;var A=w.bindFramebuffer(36160,x.handle);(0,l.assert)(t);var S=null;if(t instanceof n.default&&(S=t,y=Number.isFinite(y)?y:S.width,v=Number.isFinite(v)?v:S.height,S.bind(0),t=S.target),E)switch(t){case 3553:case 34067:w.copyTexSubImage2D(t,h,m,g,o,u,y,v);break;case 35866:case 32879:(0,i.assertWebGL2Context)(w).copyTexSubImage3D(t,h,m,g,_,o,u,y,v)}else w.copyTexImage2D(t,h,p,o,u,y,v,0);return S&&S.unbind(),w.bindFramebuffer(36160,A||null),T&&x.delete(),S},copyAndBlit.readPixelsToArray=u,copyAndBlit.readPixelsToBuffer=function(e,r){var n=r.sourceX,a=void 0===n?0:n,s=r.sourceY,u=void 0===s?0:s,c=r.sourceFormat,h=void 0===c?6408:c,f=r.target,p=void 0===f?null:f,m=r.targetByteOffset,g=void 0===m?0:m,_=r.sourceWidth,y=r.sourceHeight,v=r.sourceType,b=d(e),x=b.framebuffer,T=b.deleteFramebuffer;(0,l.assert)(x),_=_||x.width,y=y||x.height;var w=(0,i.assertWebGL2Context)(x.gl);if(v=v||(p?p.type:5121),!p){var E=(0,o.glFormatToComponents)(h),A=(0,o.glTypeToBytes)(v);p=new t.default(w,{byteLength:g+_*y*E*A,accessor:{type:v,size:E}})}return p.bind({target:35051}),(0,i.withParameters)(w,{framebuffer:x},(function(){w.readPixels(a,u,_,y,h,v,g)})),p.unbind({target:35051}),T&&x.delete(),p};var t=e(requireBuffer()),r=e(requireFramebuffer()),n=e(requireTexture$1()),i=es5$c,a=requireTypedArrayUtils(),o=requireFormatUtils(),s=requireTextureUtils(),l=requireAssert$3();function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sourceX,n=void 0===r?0:r,i=t.sourceY,s=void 0===i?0:i,u=t.sourceFormat,c=void 0===u?6408:u,h=t.sourceAttachment,f=void 0===h?36064:h,p=t.target,m=void 0===p?null:p,g=t.sourceWidth,_=t.sourceHeight,y=t.sourceType,v=d(e),b=v.framebuffer,x=v.deleteFramebuffer;(0,l.assert)(b);var T=b.gl,w=b.handle,E=b.attachments;g=g||b.width,_=_||b.height,36064===f&&null===w&&(f=1028),(0,l.assert)(E[f]),m=function(e,t,r,n,i){return e||new((0,a.getTypedArrayFromGLType)(t=t||5121,{clamped:!1}))(n*i*(0,o.glFormatToComponents)(r))}(m,y=y||E[f].type,c,g,_),y=y||(0,a.getGLTypeFromTypedArray)(m);var A=T.bindFramebuffer(36160,w);return T.readPixels(n,s,g,_,c,y,m),T.bindFramebuffer(36160,A||null),x&&b.delete(),m}function c(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sourceAttachment,n=t.targetMaxHeight,i=void 0===n?Number.MAX_SAFE_INTEGER:n,o=u(e,{sourceAttachment:void 0===r?36064:r}),s=e.width,l=e.height;l>i;){var c=(0,a.scalePixels)({data:o,width:s,height:l});o=c.data,s=c.width,l=c.height}(0,a.flipRows)({data:o,width:s,height:l});var d=document.createElement("canvas");d.width=s,d.height=l;var h=d.getContext("2d"),f=h.createImageData(s,l);return f.data.set(o),h.putImageData(f,0,0),d.toDataURL()}function d(e){return e instanceof r.default?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:(0,s.toFramebuffer)(e),deleteFramebuffer:!0}}return copyAndBlit}var features$1={},limits={},webglLimitsTable={},hasRequiredWebglLimitsTable;function requireWebglLimitsTable(){if(hasRequiredWebglLimitsTable)return webglLimitsTable;hasRequiredWebglLimitsTable=1;var e=interopRequireDefaultExports;Object.defineProperty(webglLimitsTable,"__esModule",{value:!0}),webglLimitsTable.default=void 0;var t,r=e(requireDefineProperty()),n=((0,r.default)(t={},33902,{gl1:new Float32Array([1,1])}),(0,r.default)(t,33901,{gl1:new Float32Array([1,1])}),(0,r.default)(t,3379,{gl1:64,gl2:2048}),(0,r.default)(t,34076,{gl1:16}),(0,r.default)(t,34930,{gl1:8}),(0,r.default)(t,35661,{gl1:8}),(0,r.default)(t,35660,{gl1:0}),(0,r.default)(t,34024,{gl1:1}),(0,r.default)(t,36348,{gl1:8}),(0,r.default)(t,34921,{gl1:8}),(0,r.default)(t,36347,{gl1:128}),(0,r.default)(t,36349,{gl1:16}),(0,r.default)(t,3386,{gl1:new Int32Array([0,0])}),(0,r.default)(t,32883,{gl1:0,gl2:256}),(0,r.default)(t,35071,{gl1:0,gl2:256}),(0,r.default)(t,37447,{gl1:0,gl2:0}),(0,r.default)(t,36063,{gl1:0,gl2:4}),(0,r.default)(t,35379,{gl1:0,gl2:0}),(0,r.default)(t,35374,{gl1:0,gl2:0}),(0,r.default)(t,35377,{gl1:0,gl2:0}),(0,r.default)(t,34852,{gl1:0,gl2:4}),(0,r.default)(t,36203,{gl1:0,gl2:0}),(0,r.default)(t,33001,{gl1:0,gl2:0}),(0,r.default)(t,33e3,{gl1:0,gl2:0}),(0,r.default)(t,37157,{gl1:0,gl2:0}),(0,r.default)(t,35373,{gl1:0,gl2:0}),(0,r.default)(t,35657,{gl1:0,gl2:0}),(0,r.default)(t,36183,{gl1:0,gl2:0}),(0,r.default)(t,37137,{gl1:0,gl2:0}),(0,r.default)(t,34045,{gl1:0,gl2:0}),(0,r.default)(t,35978,{gl1:0,gl2:0}),(0,r.default)(t,35979,{gl1:0,gl2:0}),(0,r.default)(t,35968,{gl1:0,gl2:0}),(0,r.default)(t,35376,{gl1:0,gl2:0}),(0,r.default)(t,35375,{gl1:0,gl2:0}),(0,r.default)(t,35659,{gl1:0,gl2:0}),(0,r.default)(t,37154,{gl1:0,gl2:0}),(0,r.default)(t,35371,{gl1:0,gl2:0}),(0,r.default)(t,35658,{gl1:0,gl2:0}),(0,r.default)(t,35076,{gl1:0,gl2:-8,negative:!0}),(0,r.default)(t,35077,{gl1:0,gl2:7}),(0,r.default)(t,35380,{gl1:0,gl2:0}),t);return webglLimitsTable.default=n,webglLimitsTable}var _interopRequireDefault$b=interopRequireDefaultExports;Object.defineProperty(limits,"__esModule",{value:!0}),limits.getContextInfo=getContextInfo,limits.getContextLimits=getContextLimits,limits.getGLContextInfo=getGLContextInfo;var _defineProperty2$4=_interopRequireDefault$b(requireDefineProperty()),_webglLimitsTable=_interopRequireDefault$b(requireWebglLimitsTable()),_gltools=es5$c;function getContextLimits(e){if(e.luma=e.luma||{},!e.luma.limits){e.luma.limits={},e.luma.webgl1MinLimits={},e.luma.webgl2MinLimits={};var t=(0,_gltools.isWebGL2)(e);for(var r in _webglLimitsTable.default){var n=_webglLimitsTable.default[r],i=n.gl1,a="gl2"in n?n.gl2:n.gl1,o=t?a:i,s="gl2"in n&&!t||"extension"in n&&!e.getExtension(n.extension)?o:e.getParameter(r);e.luma.limits[r]=s,e.luma.webgl1MinLimits[r]=i,e.luma.webgl2MinLimits[r]=a}}return e.luma.limits}function getGLContextInfo(e){e.luma=e.luma||{};var t,r=(0,_gltools.getContextDebugInfo)(e);return e.luma.info||(e.luma.info=((0,_defineProperty2$4.default)(t={},37445,r.vendor),(0,_defineProperty2$4.default)(t,37446,r.renderer),(0,_defineProperty2$4.default)(t,7936,r.vendorMasked),(0,_defineProperty2$4.default)(t,7937,r.rendererMasked),(0,_defineProperty2$4.default)(t,7938,r.version),(0,_defineProperty2$4.default)(t,35724,r.shadingLanguageVersion),t)),e.luma.info}function getContextInfo(e){return Object.assign((0,_gltools.getContextDebugInfo)(e),{limits:getContextLimits(e),info:getGLContextInfo(e),webgl1MinLimits:e.luma.webgl1MinLimits,webgl2MinLimits:e.luma.webgl2MinLimits})}var webglFeaturesTable={},hasRequiredWebglFeaturesTable;function requireWebglFeaturesTable(){if(hasRequiredWebglFeaturesTable)return webglFeaturesTable;hasRequiredWebglFeaturesTable=1;var e=interopRequireDefaultExports;Object.defineProperty(webglFeaturesTable,"__esModule",{value:!0}),webglFeaturesTable.default=webglFeaturesTable.FEATURES=void 0;var t,r=e(requireDefineProperty()),n=e(requireFramebuffer()),i=e(requireTexture2d()),a={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};webglFeaturesTable.FEATURES=a;var o=((0,r.default)(t={},a.WEBGL2,[!1,!0]),(0,r.default)(t,a.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),(0,r.default)(t,a.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),(0,r.default)(t,a.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),(0,r.default)(t,a.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),(0,r.default)(t,a.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),(0,r.default)(t,a.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),(0,r.default)(t,a.FLOAT_BLEND,["EXT_float_blend"]),(0,r.default)(t,a.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),(0,r.default)(t,a.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),(0,r.default)(t,a.TEXTURE_FLOAT,["OES_texture_float",!0]),(0,r.default)(t,a.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),(0,r.default)(t,a.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),(0,r.default)(t,a.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),(0,r.default)(t,a.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),(0,r.default)(t,a.COLOR_ATTACHMENT_RGBA32F,[function(e){var t=new i.default(e,{format:6408,type:5126,dataFormat:6408}),a=new n.default(e,{id:"test-framebuffer",check:!1,attachments:(0,r.default)({},36064,t)}),o=a.getStatus();return t.delete(),a.delete(),36053===o},"EXT_color_buffer_float"]),(0,r.default)(t,a.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),(0,r.default)(t,a.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),(0,r.default)(t,a.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),(0,r.default)(t,a.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),(0,r.default)(t,a.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),(0,r.default)(t,a.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),t);return webglFeaturesTable.default=o,webglFeaturesTable}var features={},hasRequiredFeatures$1;function requireFeatures$1(){if(hasRequiredFeatures$1)return features;hasRequiredFeatures$1=1;var e=interopRequireDefaultExports;Object.defineProperty(features,"__esModule",{value:!0}),features.getFeatures=function(e){for(var r in e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},t.default)void 0===e.luma.caps[r]&&(e.luma.caps[r]=s(e,r));return e.luma.caps},features.hasFeature=function(e,t){return o(e,t)},features.hasFeatures=o;var t=e(requireWebglFeaturesTable()),r=es5$c,n=requireAssert$3();function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a=2;function o(e,t){return(t=Array.isArray(t)?t:[t]).every((function(t){return s(e,t)}))}function s(e,o){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[o]&&(e.luma.caps[o]=function(e,a){var o,s=t.default[a];(0,n.assert)(s,a);var l=(0,r.isWebGL2)(e)&&s[1]||s[0];if("function"==typeof l)o=l(e);else if(Array.isArray(l)){o=!0;var u,c=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(l);try{for(c.s();!(u=c.n()).done;)o=o&&Boolean(e.getExtension(u.value))}catch(e){c.e(e)}finally{c.f()}}else"string"==typeof l?o=Boolean(e.getExtension(l)):"boolean"==typeof l?o=l:(0,n.assert)(!1);return o}(e,o)),e.luma.caps[o]||r.log.log(a,"Feature: ".concat(o," not supported"))(),e.luma.caps[o]}return features}var checkGlslExtension={},checkOldIe={},hasRequiredCheckOldIe,hasRequiredCheckGlslExtension,hasRequiredFeatures,hasRequiredFramebuffer,hasRequiredTextureUtils;function requireCheckOldIe(){return hasRequiredCheckOldIe||(hasRequiredCheckOldIe=1,Object.defineProperty(checkOldIe,"__esModule",{value:!0}),checkOldIe.default=function(){var e="undefined"!=typeof window&&window.navigator||{},t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).userAgent||e.userAgent||"",r=-1!==t.indexOf("MSIE "),n=-1!==t.indexOf("Trident/");return r||n}),checkOldIe}function requireCheckGlslExtension(){if(hasRequiredCheckGlslExtension)return checkGlslExtension;hasRequiredCheckGlslExtension=1;var e=interopRequireDefaultExports;Object.defineProperty(checkGlslExtension,"__esModule",{value:!0}),checkGlslExtension.default=function(e,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.default[a];if((0,n.assert)(s,a),!(0,t.default)(o))return!0;if(a in i)return i[a];var l="#extension GL_".concat(s[0]," : enable\nvoid main(void) {}"),u=e.createShader(35633);e.shaderSource(u,l),e.compileShader(u);var c=e.getShaderParameter(u,35713);return e.deleteShader(u),i[a]=c,c};var t=e(requireCheckOldIe()),r=e(requireWebglFeaturesTable()),n=requireAssert$3(),i={};return checkGlslExtension}function requireFeatures(){return hasRequiredFeatures||(hasRequiredFeatures=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"FEATURES",{enumerable:!0,get:function(){return n.FEATURES}}),Object.defineProperty(e,"canCompileGLGSExtension",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"getContextInfo",{enumerable:!0,get:function(){return r.getContextInfo}}),Object.defineProperty(e,"getContextLimits",{enumerable:!0,get:function(){return r.getContextLimits}}),Object.defineProperty(e,"getFeatures",{enumerable:!0,get:function(){return i.getFeatures}}),Object.defineProperty(e,"getGLContextInfo",{enumerable:!0,get:function(){return r.getGLContextInfo}}),Object.defineProperty(e,"hasFeature",{enumerable:!0,get:function(){return i.hasFeature}}),Object.defineProperty(e,"hasFeatures",{enumerable:!0,get:function(){return i.hasFeatures}});var r=limits,n=requireWebglFeaturesTable(),i=requireFeatures$1(),a=t(requireCheckGlslExtension())}(features$1)),features$1}function requireFramebuffer(){if(hasRequiredFramebuffer)return framebuffer;hasRequiredFramebuffer=1;var e=interopRequireDefaultExports;Object.defineProperty(framebuffer,"__esModule",{value:!0}),framebuffer.default=framebuffer.FRAMEBUFFER_ATTACHMENT_PARAMETERS=void 0;var t=e(requireDefineProperty()),r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireGet()),s=e(requireInherits()),l=e(requirePossibleConstructorReturn()),u=e(requireGetPrototypeOf()),c=es5$c,d=e(requireResource$1()),h=e(requireTexture2d()),f=e(requireRenderbuffer()),p=requireClear(),m=requireCopyAndBlit(),g=requireFeatures(),_=constantsToKeys,y=requireAssert$3();function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var x="Multiple render targets not supported",T=function(e,d){(0,s.default)(A,e);var b,T,E=(b=A,T=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,u.default)(b);if(T){var r=(0,u.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,l.default)(this,e)});function A(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.default)(this,A),(t=E.call(this,e,r)).width=null,t.height=null,t.attachments={},t.readBuffer=36064,t.drawBuffers=[36064],t.ownResources=[],t.initialize(r),Object.seal((0,a.default)(t)),t}return(0,i.default)(A,[{key:d,get:function(){return"Framebuffer"}},{key:"MAX_COLOR_ATTACHMENTS",get:function(){var e=(0,c.assertWebGL2Context)(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var e=(0,c.assertWebGL2Context)(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(e){var t=e.width,r=void 0===t?1:t,n=e.height,i=void 0===n?1:n,a=e.attachments,o=void 0===a?null:a,s=e.color,l=void 0===s||s,u=e.depth,c=void 0===u||u,d=e.stencil,h=void 0!==d&&d,f=e.check,p=void 0===f||f,m=e.readBuffer,g=void 0===m?void 0:m,_=e.drawBuffers,v=void 0===_?void 0:_;if((0,y.assert)(r>=0&&i>=0,"Width and height need to be integers"),this.width=r,this.height=i,o)for(var b in o){var x=o[b];(Array.isArray(x)?x[0]:x).resize({width:r,height:i})}else o=this._createDefaultAttachments(l,c,h,r,i);this.update({clearAttachments:!0,attachments:o,readBuffer:g,drawBuffers:v}),o&&p&&this.checkStatus()}},{key:"delete",value:function(){var e,t=v(this.ownResources);try{for(t.s();!(e=t.n()).done;)e.value.delete()}catch(e){t.e(e)}finally{t.f()}return(0,o.default)((0,u.default)(A.prototype),"delete",this).call(this),this}},{key:"update",value:function(e){var t=e.attachments,r=e.readBuffer,n=e.drawBuffers,i=e.clearAttachments,a=e.resizeAttachments;this.attach(void 0===t?{}:t,{clearAttachments:void 0!==i&&i,resizeAttachments:void 0===a||a});var o=this.gl,s=o.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),o.bindFramebuffer(36160,s||null),this}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,r=e.height;if(null===this.handle)return(0,y.assert)(void 0===t&&void 0===r),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var n in void 0===t&&(t=this.gl.drawingBufferWidth),void 0===r&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&c.log.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))(),this.attachments)this.attachments[n].resize({width:t,height:r});return this.width=t,this.height=r,this}},{key:"attach",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.clearAttachments,a=n.resizeAttachments,o=void 0===a||a,s={};void 0!==i&&i&&Object.keys(this.attachments).forEach((function(e){s[e]=null})),Object.assign(s,e);var l=this.gl.bindFramebuffer(36160,this.handle);for(var u in s){(0,y.assert)(void 0!==u,"Misspelled framebuffer binding point?");var c=Number(u),d=s[c],h=d;if(h)if(h instanceof f.default)this._attachRenderbuffer({attachment:c,renderbuffer:h});else if(Array.isArray(d)){var p=(0,r.default)(d,3),m=p[0],g=p[1],_=p[2];h=m,this._attachTexture({attachment:c,texture:m,layer:void 0===g?0:g,level:void 0===_?0:_})}else this._attachTexture({attachment:c,texture:h,layer:0,level:0});else this._unattach(c);o&&h&&h.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,l||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter((function(e){return!t.attachments[e]})).forEach((function(e){delete t.attachments[e]}))}},{key:"checkStatus",value:function(){var e=this.getStatus();if(36053!==e)throw new Error(w(e));return this}},{key:"getStatus",value:function(){var e=this.gl,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}},{key:"clear",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.color,n=t.depth,i=t.stencil,a=t.drawBuffers,o=void 0===a?[]:a,s=this.gl.bindFramebuffer(36160,this.handle);return(r||n||i)&&(0,p.clear)(this.gl,{color:r,depth:n,stencil:i}),o.forEach((function(t,r){(0,p.clearBuffer)(e.gl,{drawBuffer:r,value:t})})),this.gl.bindFramebuffer(36160,s||null),this}},{key:"readPixels",value:function(){return c.log.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){return c.log.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){return c.log.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){return c.log.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){return c.log.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){return c.log.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(e){var t=e.attachments,r=void 0===t?[]:t,n=e.x,i=void 0===n?0:n,a=e.y,o=void 0===a?0:a,s=e.width,l=e.height,u=(0,c.assertWebGL2Context)(this.gl),d=u.bindFramebuffer(36008,this.handle);return 0===i&&0===o&&void 0===s&&void 0===l?u.invalidateFramebuffer(36008,r):u.invalidateFramebuffer(36008,r,i,o,s,l),u.bindFramebuffer(36008,d),this}},{key:"getAttachmentParameter",value:function(e,t,r){var n=this._getAttachmentParameterFallback(t);return null===n&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=(0,_.getKey)(this.gl,n)),n}},{key:"getAttachmentParameters",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,r=arguments.length>1?arguments[1]:void 0,n={},i=v(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[]);try{for(i.s();!(e=i.n()).done;){var a=e.value;n[r?(0,_.getKey)(this.gl,a):a]=this.getAttachmentParameter(t,a,r)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"getParameters",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={},r=0,n=Object.keys(this.attachments);r<n.length;r++){var i=Number(n[r]);t[e?(0,_.getKey)(this.gl,i):i]=this.getAttachmentParameters(i,e)}return t}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open((0,m.copyToDataUrl)(this),"luma-debug-texture"),this}},{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e>c.log.level||"undefined"==typeof window)return this;t=t||"Framebuffer ".concat(this.id);var r=(0,m.copyToDataUrl)(this,{targetMaxHeight:100});return c.log.image({logLevel:e,message:t,image:r},t)(),this}},{key:"bind",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target;return this.gl.bindFramebuffer(void 0===e?36160:e,this.handle),this}},{key:"unbind",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target;return this.gl.bindFramebuffer(void 0===e?36160:e,null),this}},{key:"_createDefaultAttachments",value:function(e,r,n,i,a){var o,s=null;return e&&((s=s||{})[36064]=new h.default(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:a,mipmaps:!1,parameters:(o={},(0,t.default)(o,10241,9729),(0,t.default)(o,10240,9729),(0,t.default)(o,10242,33071),(0,t.default)(o,10243,33071),o)}),this.ownResources.push(s[36064])),r&&n?((s=s||{})[33306]=new f.default(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(s[33306])):r?((s=s||{})[36096]=new f.default(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:a}),this.ownResources.push(s[36096])):n&&(0,y.assert)(!1),s}},{key:"_unattach",value:function(e){var t=this.attachments[e];t&&(t instanceof f.default?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}},{key:"_attachRenderbuffer",value:function(e){var t=e.attachment,r=void 0===t?36064:t,n=e.renderbuffer;this.gl.framebufferRenderbuffer(36160,r,36161,n.handle),this.attachments[r]=n}},{key:"_attachTexture",value:function(e){var t=e.attachment,r=void 0===t?36064:t,n=e.texture,i=e.layer,a=e.level,o=this.gl;switch(o.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:(0,c.assertWebGL2Context)(o).framebufferTextureLayer(36160,r,n.target,a,i);break;case 34067:var s=function(e){return e<34069?e+34069:e}(i);o.framebufferTexture2D(36160,r,s,n.handle,a);break;case 3553:o.framebufferTexture2D(36160,r,3553,n.handle,a);break;default:(0,y.assert)(!1,"Illegal texture type")}o.bindTexture(n.target,null),this.attachments[r]=n}},{key:"_setReadBuffer",value:function(e){var t=(0,c.getWebGL2Context)(this.gl);t?t.readBuffer(e):(0,y.assert)(36064===e||1029===e,x),this.readBuffer=e}},{key:"_setDrawBuffers",value:function(e){var t=this.gl,r=(0,c.assertWebGL2Context)(t);if(r)r.drawBuffers(e);else{var n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):(0,y.assert)(1===e.length&&(36064===e[0]||1029===e[0]),x)}this.drawBuffers=e}},{key:"_getAttachmentParameterFallback",value:function(e){var t=(0,g.getFeatures)(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return t.WEBGL2||t.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(e){return this.gl.bindFramebuffer(36160,e)}}],[{key:"isSupported",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.colorBufferHalfFloat,n=!0;return t.colorBufferFloat&&(n=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),n}},{key:"getDefaultFramebuffer",value:function(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new A(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}}]),A}(d.default,Symbol.toStringTag);function w(e){return(T.STATUS||{})[e]||"Framebuffer error ".concat(e)}framebuffer.default=T;var E=[36049,36048,33296,33298,33299,33300,33301,33302,33303];return framebuffer.FRAMEBUFFER_ATTACHMENT_PARAMETERS=E,T.ATTACHMENT_PARAMETERS=E,framebuffer}function requireTextureUtils(){if(hasRequiredTextureUtils)return textureUtils;hasRequiredTextureUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(textureUtils,"__esModule",{value:!0}),textureUtils.cloneTextureFrom=function(e,t){return(0,o.assert)(e instanceof r.default||e instanceof n.default||e instanceof i.default),new(0,e.constructor)(e.gl,Object.assign({width:e.width,height:e.height,format:e.format,type:e.type,dataFormat:e.dataFormat,border:e.border,mipmaps:e.mipmaps},t))},textureUtils.toFramebuffer=function(e,r){var n=e.width,i=e.height;return new a.default(e.gl,Object.assign({},r,{id:"framebuffer-for-".concat(e.id),width:n,height:i,attachments:(0,t.default)({},36064,e)}))};var t=e(requireDefineProperty()),r=e(requireTexture2d()),n=e(requireTextureCube()),i=e(requireTexture3d()),a=e(requireFramebuffer()),o=requireAssert$3();return textureUtils}var shader$1={},glslUtils={},formatGlslError={},getShaderName$1={},hasRequiredGetShaderName;function requireGetShaderName(){return hasRequiredGetShaderName||(hasRequiredGetShaderName=1,Object.defineProperty(getShaderName$1,"__esModule",{value:!0}),getShaderName$1.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",r=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:t}),getShaderName$1}var getShaderTypeName={},hasRequiredGetShaderTypeName,hasRequiredFormatGlslError;function requireGetShaderTypeName(){if(hasRequiredGetShaderTypeName)return getShaderTypeName;hasRequiredGetShaderTypeName=1,Object.defineProperty(getShaderTypeName,"__esModule",{value:!0}),getShaderTypeName.default=function(r){switch(r){case e:return"fragment";case t:return"vertex";default:return"unknown type"}};var e=35632,t=35633;return getShaderTypeName}function requireFormatGlslError(){if(hasRequiredFormatGlslError)return formatGlslError;hasRequiredFormatGlslError=1;var e=interopRequireDefaultExports;Object.defineProperty(formatGlslError,"__esModule",{value:!0}),formatGlslError.default=function(e,t,r){var i=n(e,t,r),a=i.errors,o=i.warnings;return"GLSL compilation error in ".concat(i.shaderName,"\n\n").concat(a,"\n").concat(o)},formatGlslError.parseGLSLCompilerError=n;var t=e(requireGetShaderName()),r=e(requireGetShaderTypeName());function n(e,n,o,s){for(var l=e.split(/\r?\n/),u={},c={},d=s||(0,t.default)(n)||"(unnamed)",h="".concat((0,r.default)(o)," shader ").concat(d),f=0;f<l.length;f++){var p=l[f];if(!(p.length<=1)){var m=p.split(":"),g=m[0],_=parseInt(m[2],10);if(isNaN(_))throw new Error("GLSL compilation error in ".concat(h,": ").concat(e));"WARNING"!==g?u[_]=p:c[_]=p}}var y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",n=e.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((function(e,n){var o=String(n+t);return a(o,i-o.length)+r+e}))}(n);return{shaderName:h,errors:i(u,y),warnings:i(c,y)}}function i(e,t){for(var r="",n=0;n<t.length;n++)if((e[n+3]||e[n+2]||e[n+1])&&(r+="".concat(t[n],"\n"),e[n+1])){var i=e[n+1],o=i.split(":",3),s=o[0],l=parseInt(o[1],10)||0,u=i.substring(o.join(":").length+1).trim();r+=a("^^^ ".concat(s,": ").concat(u,"\n\n"),l)}return r}function a(e,t){for(var r="",n=0;n<t;++n)r+=" ";return"".concat(r).concat(e)}return formatGlslError}var getShaderVersion={},hasRequiredGetShaderVersion,hasRequiredGlslUtils,hasRequiredShader$1;function requireGetShaderVersion(){return hasRequiredGetShaderVersion||(hasRequiredGetShaderVersion=1,Object.defineProperty(getShaderVersion,"__esModule",{value:!0}),getShaderVersion.default=function(e){var t=100,r=e.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){var n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}return t}),getShaderVersion}function requireGlslUtils(){return hasRequiredGlslUtils||(hasRequiredGlslUtils=1,function(e){var t=interopRequireDefaultExports,r=_typeofExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"formatGLSLCompilerError",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"getShaderName",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"getShaderTypeName",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"getShaderVersion",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parseGLSLCompilerError",{enumerable:!0,get:function(){return n.parseGLSLCompilerError}});var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=s(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=a?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireFormatGlslError()),i=t(requireGetShaderName()),a=t(requireGetShaderVersion()),o=t(requireGetShaderTypeName());function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}}(glslUtils)),glslUtils}function requireShader$1(){if(hasRequiredShader$1)return shader$1;hasRequiredShader$1=1;var e=interopRequireDefaultExports;Object.defineProperty(shader$1,"__esModule",{value:!0}),shader$1.VertexShader=shader$1.Shader=shader$1.FragmentShader=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=es5$c,s=requireGlslUtils(),l=requireAssert$3(),u=requireUtils$4();function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,a.default)(e);if(t){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var d=function(e,i){(0,n.default)(d,e);var a=c(d);function d(e,r){var n;(0,t.default)(this,d),(0,o.assertWebGLContext)(e),(0,l.assert)("string"==typeof r.source,"Shader: GLSL source code must be a JavaScript string");var i=(0,s.getShaderName)(r.source,null)||r.id||(0,u.uid)("unnamed ".concat(d.getTypeName(r.shaderType)));return(n=a.call(this,e,{id:i})).shaderType=r.shaderType,n.source=r.source,n.initialize(r),n}return(0,r.default)(d,[{key:i,get:function(){return"Shader"}},{key:"initialize",value:function(e){var t=e.source,r=(0,s.getShaderName)(t,null);r&&(this.id=(0,u.uid)(r)),this._compile(t)}},{key:"getParameter",value:function(e){return this.gl.getShaderParameter(this.handle,e)}},{key:"toString",value:function(){return"".concat(d.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return(0,s.getShaderName)(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(e.startsWith("#version ")||(e="#version 100\n".concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var t=this.gl.getShaderInfoLog(this.handle),r=(0,s.parseGLSLCompilerError)(t,this.source,this.shaderType,this.id),n=r.shaderName,i=r.errors,a=r.warnings;throw o.log.error("GLSL compilation errors in ".concat(n,"\n").concat(i))(),o.log.warn("GLSL compilation warnings in ".concat(n,"\n").concat(a))(),new Error("GLSL compilation errors in ".concat(n))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return(0,l.assert)(!1),"unknown"}}}]),d}(e(requireResource$1()).default,Symbol.toStringTag);shader$1.Shader=d;var h=function(e,i){(0,n.default)(o,e);var a=c(o);function o(e,r){return(0,t.default)(this,o),"string"==typeof r&&(r={source:r}),a.call(this,e,Object.assign({},r,{shaderType:35633}))}return(0,r.default)(o,[{key:i,get:function(){return"VertexShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),o}(d,Symbol.toStringTag);shader$1.VertexShader=h;var f=function(e,i){(0,n.default)(o,e);var a=c(o);function o(e,r){return(0,t.default)(this,o),"string"==typeof r&&(r={source:r}),a.call(this,e,Object.assign({},r,{shaderType:35632}))}return(0,r.default)(o,[{key:i,get:function(){return"FragmentShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),o}(d,Symbol.toStringTag);return shader$1.FragmentShader=f,shader$1}var program={},uniforms$i={},hasRequiredUniforms;function requireUniforms(){if(hasRequiredUniforms)return uniforms$i;hasRequiredUniforms=1;var e=interopRequireDefaultExports;Object.defineProperty(uniforms$i,"__esModule",{value:!0}),uniforms$i.checkUniformValues=function(e,t,r){for(var n in e){var i=e[n];if((!r||Boolean(r[n]))&&!_(i))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(n),i),new Error("".concat(t," Bad uniform ").concat(n))}return!0},uniforms$i.copyUniform=function(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t])for(var n=e[t],i=0,a=r.length;i<a;++i)n[i]=r[i];else e[t]=r.slice();else e[t]=r},uniforms$i.getUniformSetter=function(e,t,r){var n=l[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)},uniforms$i.parseUniformName=function(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}};var t,r=e(requireDefineProperty()),n=es5$c,i=e(requireFramebuffer()),a=e(requireRenderbuffer()),o=e(requireTexture$1()),s=requireAssert$3(),l=((0,r.default)(t={},5126,v.bind(null,"uniform1fv",p,1,b)),(0,r.default)(t,35664,v.bind(null,"uniform2fv",p,2,b)),(0,r.default)(t,35665,v.bind(null,"uniform3fv",p,3,b)),(0,r.default)(t,35666,v.bind(null,"uniform4fv",p,4,b)),(0,r.default)(t,5124,v.bind(null,"uniform1iv",m,1,b)),(0,r.default)(t,35667,v.bind(null,"uniform2iv",m,2,b)),(0,r.default)(t,35668,v.bind(null,"uniform3iv",m,3,b)),(0,r.default)(t,35669,v.bind(null,"uniform4iv",m,4,b)),(0,r.default)(t,35670,v.bind(null,"uniform1iv",m,1,b)),(0,r.default)(t,35671,v.bind(null,"uniform2iv",m,2,b)),(0,r.default)(t,35672,v.bind(null,"uniform3iv",m,3,b)),(0,r.default)(t,35673,v.bind(null,"uniform4iv",m,4,b)),(0,r.default)(t,35674,v.bind(null,"uniformMatrix2fv",p,4,x)),(0,r.default)(t,35675,v.bind(null,"uniformMatrix3fv",p,9,x)),(0,r.default)(t,35676,v.bind(null,"uniformMatrix4fv",p,16,x)),(0,r.default)(t,35678,y),(0,r.default)(t,35680,y),(0,r.default)(t,5125,v.bind(null,"uniform1uiv",g,1,b)),(0,r.default)(t,36294,v.bind(null,"uniform2uiv",g,2,b)),(0,r.default)(t,36295,v.bind(null,"uniform3uiv",g,3,b)),(0,r.default)(t,36296,v.bind(null,"uniform4uiv",g,4,b)),(0,r.default)(t,35685,v.bind(null,"uniformMatrix2x3fv",p,6,x)),(0,r.default)(t,35686,v.bind(null,"uniformMatrix2x4fv",p,8,x)),(0,r.default)(t,35687,v.bind(null,"uniformMatrix3x2fv",p,6,x)),(0,r.default)(t,35688,v.bind(null,"uniformMatrix3x4fv",p,12,x)),(0,r.default)(t,35689,v.bind(null,"uniformMatrix4x2fv",p,8,x)),(0,r.default)(t,35690,v.bind(null,"uniformMatrix4x3fv",p,12,x)),(0,r.default)(t,35678,y),(0,r.default)(t,35680,y),(0,r.default)(t,35679,y),(0,r.default)(t,35682,y),(0,r.default)(t,36289,y),(0,r.default)(t,36292,y),(0,r.default)(t,36293,y),(0,r.default)(t,36298,y),(0,r.default)(t,36299,y),(0,r.default)(t,36300,y),(0,r.default)(t,36303,y),(0,r.default)(t,36306,y),(0,r.default)(t,36307,y),(0,r.default)(t,36308,y),(0,r.default)(t,36311,y),t),u={},c={},d={},h=[0];function f(e,t,r,i){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(h[0]=e,e=h);var a=e.length;if(a%t&&n.log.warn("Uniform size should be multiples of ".concat(t),e)(),e instanceof r)return e;var o=i[a];o||(o=new r(a),i[a]=o);for(var s=0;s<a;s++)o[s]=e[s];return o}function p(e,t){return f(e,t,Float32Array,u)}function m(e,t){return f(e,t,Int32Array,c)}function g(e,t){return f(e,t,Uint32Array,d)}function _(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;for(var t=Math.min(e.length,16),r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}(e):!!isFinite(e)||!0===e||!1===e||e instanceof o.default||e instanceof a.default||e instanceof i.default&&Boolean(e.texture)}function y(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function v(e,t,r,n){var i=null,a=null;return function(o,l,u){var c=t(u,r),d=c.length,h=!1;if(null===i)i=new Float32Array(d),a=d,h=!0;else{(0,s.assert)(a===d,"Uniform length cannot change.");for(var f=0;f<d;++f)if(c[f]!==i[f]){h=!0;break}}return h&&(n(o,e,l,c),i.set(c)),h}}function b(e,t,r,n){e[t](r,n)}function x(e,t,r,n){e[t](r,!1,n)}return uniforms$i}var programConfiguration={},attributeUtils={},hasRequiredAttributeUtils,hasRequiredProgramConfiguration,hasRequiredProgram;function requireAttributeUtils(){if(hasRequiredAttributeUtils)return attributeUtils;hasRequiredAttributeUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(attributeUtils,"__esModule",{value:!0}),attributeUtils.decomposeCompositeGLType=function(e){var t=v[e];if(!t)return null;var n=(0,r.default)(t,2);return{type:n[0],components:n[1]}},attributeUtils.getCompositeGLType=function(e,t){switch(e){case a:case o:case s:case l:e=g}for(var n in v){var i=(0,r.default)(v[n],3);if(i[0]===e&&i[1]===t)return{glType:n,name:i[2]}}return null},attributeUtils.getPrimitiveCount=x,attributeUtils.getPrimitiveDrawMode=b,attributeUtils.getVertexCount=function(e){var t=e.drawMode,r=x({drawMode:t,vertexCount:e.vertexCount});switch(b(t)){case u:return r;case c:return 2*r;case f:return 3*r;default:return(0,i.assert)(!1),0}};var t,r=e(requireSlicedToArray()),n=e(requireDefineProperty()),i=requireAssert$3(),a=5120,o=5121,s=5122,l=5123,u=0,c=1,d=2,h=3,f=4,p=5,m=6,g=5126,_=5124,y=5125,v=((0,n.default)(t={},g,[g,1,"float"]),(0,n.default)(t,35664,[g,2,"vec2"]),(0,n.default)(t,35665,[g,3,"vec3"]),(0,n.default)(t,35666,[g,4,"vec4"]),(0,n.default)(t,_,[_,1,"int"]),(0,n.default)(t,35667,[_,2,"ivec2"]),(0,n.default)(t,35668,[_,3,"ivec3"]),(0,n.default)(t,35669,[_,4,"ivec4"]),(0,n.default)(t,y,[y,1,"uint"]),(0,n.default)(t,36294,[y,2,"uvec2"]),(0,n.default)(t,36295,[y,3,"uvec3"]),(0,n.default)(t,36296,[y,4,"uvec4"]),(0,n.default)(t,35670,[g,1,"bool"]),(0,n.default)(t,35671,[g,2,"bvec2"]),(0,n.default)(t,35672,[g,3,"bvec3"]),(0,n.default)(t,35673,[g,4,"bvec4"]),(0,n.default)(t,35674,[g,8,"mat2"]),(0,n.default)(t,35685,[g,8,"mat2x3"]),(0,n.default)(t,35686,[g,8,"mat2x4"]),(0,n.default)(t,35675,[g,12,"mat3"]),(0,n.default)(t,35687,[g,12,"mat3x2"]),(0,n.default)(t,35688,[g,12,"mat3x4"]),(0,n.default)(t,35676,[g,16,"mat4"]),(0,n.default)(t,35689,[g,16,"mat4x2"]),(0,n.default)(t,35690,[g,16,"mat4x3"]),t);function b(e){switch(e){case u:return u;case c:case h:case d:return c;case f:case p:case m:return f;default:return(0,i.assert)(!1),0}}function x(e){var t=e.vertexCount;switch(e.drawMode){case u:case d:return t;case c:return t/2;case h:return t-1;case f:return t/3;case p:case m:return t-2;default:return(0,i.assert)(!1),0}}return attributeUtils}function requireProgramConfiguration(){if(hasRequiredProgramConfiguration)return programConfiguration;hasRequiredProgramConfiguration=1;var e=interopRequireDefaultExports;Object.defineProperty(programConfiguration,"__esModule",{value:!0}),programConfiguration.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAccessor()),i=es5$c,a=requireAttributeUtils(),o=function(){function e(r){(0,t.default)(this,e),this.id=r.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(r),this._readVaryingsFromProgram(r)}return(0,r.default)(e,[{key:"getAttributeInfo",value:function(e){var t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var t=this.getAttributeInfo(e);return t?t.location:-1}},{key:"getAttributeAccessor",value:function(e){var t=this.getAttributeInfo(e);return t?t.accessor:null}},{key:"getVaryingInfo",value:function(e){var t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var t=this.getVaryingInfo();return t?t.location:-1}},{key:"getVaryingAccessor",value:function(e){var t=this.getVaryingInfo();return t?t.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var t=e.gl,r=t.getProgramParameter(e.handle,35721),n=0;n<r;n++){var i=t.getActiveAttrib(e.handle,n),a=i.name,o=i.type,s=i.size,l=t.getAttribLocation(e.handle,a);l>=0&&this._addAttribute(l,a,o,s)}this.attributeInfos.sort((function(e,t){return e.location-t.location}))}},{key:"_readVaryingsFromProgram",value:function(e){var t=e.gl;if((0,i.isWebGL2)(t)){for(var r=t.getProgramParameter(e.handle,35971),n=0;n<r;n++){var a=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,a.name,a.type,a.size)}this.varyingInfos.sort((function(e,t){return e.location-t.location}))}}},{key:"_addAttribute",value:function(e,t,r,i){var o=(0,a.decomposeCompositeGLType)(r),s={type:o.type,size:i*o.components};this._inferProperties(e,t,s);var l={location:e,name:t,accessor:new n.default(s)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}},{key:"_inferProperties",value:function(e,t,r){/instance/i.test(t)&&(r.divisor=1)}},{key:"_addVarying",value:function(e,t,r,i){var o=(0,a.decomposeCompositeGLType)(r),s={location:e,name:t,accessor:new n.default({type:o.type,size:i*o.components})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}]),e}();return programConfiguration.default=o,programConfiguration}function requireProgram(){if(hasRequiredProgram)return program;hasRequiredProgram=1;var e=interopRequireDefaultExports;Object.defineProperty(program,"__esModule",{value:!0}),program.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireResource$1()),u=e(requireTexture$1()),c=e(requireFramebuffer()),d=requireUniforms(),h=requireShader$1(),f=e(requireProgramConfiguration()),p=es5$c,m=constantsToKeys,g=requireAttributeUtils(),_=requireAssert$3(),y=requireUtils$4();function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],x=function(e,l){(0,a.default)(E,e);var x,T,w=(x=E,T=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(x);if(T){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function E(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,E),(r=w.call(this,e,i)).stubRemovedMethods("Program","v6.0",b),r._isCached=!1,r.initialize(i),Object.seal((0,n.default)(r)),r._setId(i.id),r}return(0,r.default)(E,[{key:l,get:function(){return"Program"}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.vs,r=e.fs,n=e.varyings,i=e.bufferMode,a=void 0===i?35981:i;return this.hash=e.hash||"",this.vs="string"==typeof t?new h.VertexShader(this.gl,{id:"".concat(e.id,"-vs"),source:t}):t,this.fs="string"==typeof r?new h.FragmentShader(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,(0,_.assert)(this.vs instanceof h.VertexShader),(0,_.assert)(this.fs instanceof h.FragmentShader),this.uniforms={},this._textureUniforms={},n&&n.length>0&&((0,p.assertWebGL2Context)(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new f.default(this),this.setProps(e)}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:(0,i.default)((0,s.default)(E.prototype),"delete",this).call(this,e)}},{key:"setProps",value:function(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}},{key:"draw",value:function(e){var t=this,r=e.logPriority,n=e.drawMode,i=void 0===n?4:n,a=e.vertexCount,o=e.offset,s=void 0===o?0:o,l=e.start,u=e.end,c=e.isIndexed,d=void 0!==c&&c,h=e.indexType,f=void 0===h?5123:h,y=e.instanceCount,v=void 0===y?0:y,b=e.isInstanced,x=void 0===b?v>0:b,T=e.vertexArray,w=void 0===T?null:T,E=e.transformFeedback,A=e.framebuffer,S=e.parameters,P=void 0===S?{}:S,M=e.uniforms;if((M||e.samplers)&&(p.log.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(M||{})),p.log.priority>=r){var R=A?A.id:"default",C="mode=".concat((0,m.getKey)(this.gl,i)," verts=").concat(a," ")+"instances=".concat(v," indexType=").concat((0,m.getKey)(this.gl,f)," ")+"isInstanced=".concat(x," isIndexed=").concat(d," ")+"Framebuffer=".concat(R);p.log.log(r,C)()}return(0,_.assert)(w),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===a||x&&0===v||(w.bindForDraw(a,v,(function(){if(void 0!==A&&(P=Object.assign({},P,{framebuffer:A})),E){var e=(0,g.getPrimitiveDrawMode)(i);E.begin(e)}t._bindTextures(),(0,p.withParameters)(t.gl,P,(function(){d&&x?t.gl2.drawElementsInstanced(i,a,f,s,v):d&&(0,p.isWebGL2)(t.gl)&&!isNaN(l)&&!isNaN(u)?t.gl2.drawRangeElements(i,l,u,a,f,s):d?t.gl.drawElements(i,a,f,s):x?t.gl2.drawArraysInstanced(i,s,a,v):t.gl.drawArrays(i,s,a)})),E&&E.end()})),0))}},{key:"setUniforms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in p.log.priority>=2&&(0,d.checkUniformValues)(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle),e){var r=e[t],n=this._uniformSetters[t];if(n){var i=r,a=!1;if(i instanceof c.default&&(i=i.texture),i instanceof u.default)if(a=this.uniforms[t]!==r){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);var o=i,s=n.textureIndex;o.bind(s),i=s,this._textureUniforms[t]=o}else i=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(i)||a)&&(0,d.copyUniform)(this.uniforms,t,r)}}return this}},{key:"_areTexturesRenderable",value:function(){var e=!0;for(var t in this._textureUniforms){var r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}},{key:"_bindTextures",value:function(){for(var e in this._textureUniforms)this._textureUniforms[e].bind(this._uniformSetters[e].textureIndex)}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(e){var t,r={},n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.gl.getAttachedShaders(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new h.VertexShader({handle:i});break;case 35632:r.fs=new h.FragmentShader({handle:i})}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"_getParameter",value:function(e){return this.gl.getProgramParameter(this.handle,e)}},{key:"_setId",value:function(e){if(!e){var t=this._getName();this.id=(0,y.uid)(t)}}},{key:"_getName",value:function(){var e=this.vs.getName()||this.fs.getName();return(e=e.replace(/shader/i,""))?"".concat(e,"-program"):"program"}},{key:"_compileAndLink",value:function(){var e=this.gl;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),p.log.time(4,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),p.log.timeEnd(4,"linkProgram for ".concat(this._getName()))(),e.debug||p.log.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var e=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var t=0;t<this._uniformCount;t++){var r=this.gl.getActiveUniform(this.handle,t),n=(0,d.parseUniformName)(r.name).name,i=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=(0,d.getUniformSetter)(e,i,r),r.size>1)for(var a=0;a<r.size;a++)i=e.getUniformLocation(this.handle,"".concat(n,"[").concat(a,"]")),this._uniformSetters["".concat(n,"[").concat(a,"]")]=(0,d.getUniformSetter)(e,i,r)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}},{key:"getUniformBlockIndex",value:function(e){return this.gl2.getUniformBlockIndex(this.handle,e)}},{key:"getActiveUniformBlockParameter",value:function(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}},{key:"uniformBlockBinding",value:function(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}]),E}(l.default,Symbol.toStringTag);return program.default=x,program}var query={},hasRequiredQuery;function requireQuery(){if(hasRequiredQuery)return query;hasRequiredQuery=1;var e=interopRequireDefaultExports;Object.defineProperty(query,"__esModule",{value:!0}),query.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireResource$1()),l=requireFeatures(),u=es5$c,c=requireAssert$3();function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=function(e,s){(0,i.default)(m,e);var h,f,p=(h=m,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(h);if(f){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function m(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,m),(r=p.call(this,e,i)).target=null,r._queryPending=!1,r._pollingPromise=null,Object.seal((0,n.default)(r)),r}return(0,r.default)(m,[{key:s,get:function(){return"Query"}},{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative;return this.begin(void 0!==e&&e?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"begin",value:function(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}},{key:"end",value:function(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var e=this.gl2.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(36795)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,34918)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var r=0;return this._pollingPromise=new Promise((function(n,i){requestAnimationFrame((function a(){e.isResultAvailable()?(n(e.getResult()),e._pollingPromise=null):r++>t?(i("Timed out"),e._pollingPromise=null):requestAnimationFrame(a)}))})),this._pollingPromise}},{key:"_createHandle",value:function(){return m.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(0,u.isWebGL2)(e),i=(0,l.hasFeatures)(e,l.FEATURES.TIMER_QUERY),a=n||i,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(r);try{for(o.s();!(t=o.n()).done;)switch(t.value){case"queries":a=a&&n;break;case"timers":a=a&&i;break;default:(0,c.assert)(!1)}}catch(e){o.e(e)}finally{o.f()}return a}}]),m}(s.default,Symbol.toStringTag);return query.default=h,query}var transformFeedback={},hasRequiredTransformFeedback;function requireTransformFeedback(){if(hasRequiredTransformFeedback)return transformFeedback;hasRequiredTransformFeedback=1;var e=interopRequireDefaultExports;Object.defineProperty(transformFeedback,"__esModule",{value:!0}),transformFeedback.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$c,l=e(requireResource$1()),u=e(requireBuffer()),c=requireUtils$4(),d=function(e,l){(0,i.default)(p,e);var d,h,f=(d=p,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(d);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,p),(0,s.assertWebGL2Context)(e),(r=f.call(this,e,i)).initialize(i),r.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal((0,n.default)(r)),r}return(0,r.default)(p,[{key:l,get:function(){return"TransformFeedback"}},{key:"initialize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,(0,c.isObjectEmpty)(this.buffers)||this.bind((function(){return e._unbindBuffers()})),this.setProps(t),this}},{key:"setProps",value:function(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}},{key:"setBuffers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((function(){for(var r in t)e.setBuffer(r,t[r])})),this}},{key:"setBuffer",value:function(e,t){var r=this._getVaryingIndex(e),n=this._getBufferParams(t),i=n.buffer,a=n.byteSize,o=n.byteOffset;return r<0?(this.unused[e]=i,s.log.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,i,o,a),this)}},{key:"begin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(e){var t,r,n;return e instanceof u.default==0?(n=e.buffer,r=e.byteSize,t=e.byteOffset):n=e,void 0===t&&void 0===r||(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}},{key:"_getVaryingInfo",value:function(e){return this.configuration&&this.configuration.getVaryingInfo(e)}},{key:"_getVaryingIndex",value:function(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;var t=Number(e);return Number.isFinite(t)?t:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var e in this.buffers){var t=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t.buffer,t.byteOffset,t.byteSize)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var e in this.buffers)this._bindBuffer(e,null)}},{key:"_bindBuffer",value:function(e,t){var r=arguments.length>3?arguments[3]:void 0,n=t&&t.handle;return n&&void 0!==r?this.gl.bindBufferRange(35982,e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r):this.gl.bindBufferBase(35982,e,n),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(e){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(e){return(0,s.isWebGL2)(e)}}]),p}(l.default,Symbol.toStringTag);return transformFeedback.default=d,transformFeedback}var vertexArrayObject={},arrayUtilsFlat={},hasRequiredArrayUtilsFlat,hasRequiredVertexArrayObject;function requireArrayUtilsFlat(){if(hasRequiredArrayUtilsFlat)return arrayUtilsFlat;hasRequiredArrayUtilsFlat=1,Object.defineProperty(arrayUtilsFlat,"__esModule",{value:!0}),arrayUtilsFlat.fillArray=function(e){for(var t=e.target,r=e.source,n=e.start,i=void 0===n?0:n,a=e.count,o=r.length,s=(void 0===a?1:a)*o,l=0,u=i;l<o;l++)t[u++]=r[l];for(;l<s;)l<s-l?(t.copyWithin(i+l,i,i+l),l*=2):(t.copyWithin(i+l,i,i+s-l),l=s);return t},arrayUtilsFlat.getScratchArray=function(e,r){return new e(t(e.BYTES_PER_ELEMENT*r),0,r)},arrayUtilsFlat.getScratchArrayBuffer=t;var e=null;function t(t){return(!e||e.byteLength<t)&&(e=new ArrayBuffer(t)),e}return arrayUtilsFlat}function requireVertexArrayObject(){if(hasRequiredVertexArrayObject)return vertexArrayObject;hasRequiredVertexArrayObject=1;var e=interopRequireDefaultExports;Object.defineProperty(vertexArrayObject,"__esModule",{value:!0}),vertexArrayObject.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireResource$1()),u=e(requireBuffer()),c=es5$c,d=requireArrayUtilsFlat(),h=requireAssert$3(),f=requireEs5$5(),p=function(e,l){(0,a.default)(_,e);var p,m,g=(p=_,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(p);if(m){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function _(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,_),(r=g.call(this,e,Object.assign({},i,{id:i.id||i.program&&i.program.id}))).buffer=null,r.bufferValue=null,r.isDefaultArray=i.isDefaultArray||!1,r.gl2=e,r.initialize(i),Object.seal((0,n.default)(r)),r}return(0,r.default)(_,[{key:l,get:function(){return"VertexArrayObject"}},{key:"delete",value:function(){return(0,i.default)((0,s.default)(_.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return _.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){return this.setProps(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"setProps",value:function(e){return this}},{key:"setElementBuffer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,h.assert)(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((function(){e.gl.bindBuffer(34963,t?t.handle:null)})),this}},{key:"setBuffer",value:function(e,t,r){if(34963===t.target)return this.setElementBuffer(t,r);var n=r.size,i=r.type,a=r.stride,o=r.offset,s=r.normalized,l=r.integer,u=r.divisor,d=this.gl,f=this.gl2;return e=Number(e),this.bind((function(){d.bindBuffer(34962,t.handle),l?((0,h.assert)((0,c.isWebGL2)(d)),f.vertexAttribIPointer(e,n,i,a,o)):d.vertexAttribPointer(e,n,i,s,a,o),d.enableVertexAttribArray(e),f.vertexAttribDivisor(e,u||0)})),this}},{key:"enable",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!r&&0===e&&!_.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind((function(){return r?t.gl.enableVertexAttribArray(e):t.gl.disableVertexAttribArray(e)}))),this}},{key:"getConstantBuffer",value:function(e,t){var r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,i=r.length*e,a=!this.buffer;if(this.buffer=this.buffer||new u.default(this.gl,n),a=(a=a||this.buffer.reallocate(n))||!this._compareConstantArrayValues(r,this.bufferValue)){var o=(0,d.getScratchArray)(t.constructor,i);(0,d.fillArray)({target:o,source:r,start:0,count:i}),this.buffer.subData(o),this.bufferValue=t}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(e){return Array.isArray(e)?new Float32Array(e):e}},{key:"_compareConstantArrayValues",value:function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}},{key:"_createHandle",value:function(){return this.gl.createVertexArray()}},{key:"_deleteHandle",value:function(e){return this.gl2.deleteVertexArray(e),[this.elements]}},{key:"_bindHandle",value:function(e){this.gl2.bindVertexArray(e)}},{key:"_getParameter",value:function(e,t){var r=this,n=t.location;return(0,h.assert)(Number.isFinite(n)),this.bind((function(){return 34373===e?r.gl.getVertexAttribOffset(n,e):r.gl.getVertexAttrib(n,e)}))}}],[{key:"isSupported",value:function(e){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||(0,c.isWebGL2)(e)||"Chrome"===(0,f.getBrowser)()}},{key:"getDefaultArray",value:function(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new _(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(e){return _.MAX_ATTRIBUTES=_.MAX_ATTRIBUTES||e.getParameter(34921)}},{key:"setConstant",value:function(e,t,r){switch(r.constructor){case Float32Array:_._setConstantFloatArray(e,t,r);break;case Int32Array:_._setConstantIntArray(e,t,r);break;case Uint32Array:_._setConstantUintArray(e,t,r);break;default:(0,h.assert)(!1)}}},{key:"_setConstantFloatArray",value:function(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:(0,h.assert)(!1)}}},{key:"_setConstantIntArray",value:function(e,t,r){switch((0,h.assert)((0,c.isWebGL2)(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:(0,h.assert)(!1)}}},{key:"_setConstantUintArray",value:function(e,t,r){switch((0,h.assert)((0,c.isWebGL2)(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:(0,h.assert)(!1)}}}]),_}(l.default,Symbol.toStringTag);return vertexArrayObject.default=p,vertexArrayObject}var vertexArray={},hasRequiredVertexArray;function requireVertexArray(){if(hasRequiredVertexArray)return vertexArray;hasRequiredVertexArray=1;var e=interopRequireDefaultExports;Object.defineProperty(vertexArray,"__esModule",{value:!0}),vertexArray.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$c,i=e(requireAccessor()),a=e(requireBuffer()),o=e(requireVertexArrayObject()),s=requireAssert$3(),l=requireStubMethods(),u=/^(.+)__LOCATION_([0-9]+)$/,c=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],d=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),this.id=n.id||n.program&&n.program.id,this.gl=r,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new o.default(r),(0,l.stubRemovedMethods)(this,"VertexArray","v6.0",c),this.initialize(n),Object.seal(this)}return(0,r.default)(e,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(e){var t=this;return Object.assign(this.attributes,e),this.vertexArrayObject.bind((function(){for(var r in e)t._setAttribute(r,e[r]);t.gl.bindBuffer(34962,null)})),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}},{key:"setBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===t.target)return this.setElementBuffer(t,r);var n=this._resolveLocationAndAccessor(e,t,t.accessor,r),i=n.location,a=n.accessor;return i>=0&&(this.values[i]=t,this.accessors[i]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,t,a)),this}},{key:"setConstant",value:function(e,t){var r=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),n=r.location,i=r.accessor;return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind((function(){e.elements&&e.vertexArrayObject.setElementBuffer(null),e.buffer=e.buffer||new a.default(e.gl,{accessor:{size:4}});for(var t=0;t<e.vertexArrayObject.MAX_ATTRIBUTES;t++)e.values[t]instanceof a.default&&(e.gl.disableVertexAttribArray(t),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(t,1,5126,!1,0,0))})),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind((function(){e.elements&&e.setElementBuffer(e.elements);for(var t=0;t<e.vertexArrayObject.MAX_ATTRIBUTES;t++){var r=e.values[t];r instanceof a.default&&e.setBuffer(t,r)}})),this}},{key:"bindForDraw",value:function(e,t,r){var n,i=this;return this.vertexArrayObject.bind((function(){i._setConstantAttributes(e,t),n=r()})),n}},{key:"_resolveLocationAndAccessor",value:function(e,t,r,a){var o=this,l={location:-1,accessor:null},u=this._getAttributeIndex(e),c=u.location,d=u.name;if(!Number.isFinite(c)||c<0)return this.unused[e]=t,n.log.once(3,(function(){return"unused value ".concat(e," in ").concat(o.id)}))(),l;var h=this._getAttributeInfo(d||c);if(!h)return l;var f=i.default.resolve(h.accessor,this.accessors[c]||{},r,a),p=f.type;return(0,s.assert)(Number.isFinite(f.size)&&Number.isFinite(p)),{location:c,accessor:f}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){var t=Number(e);if(Number.isFinite(t))return{location:t};var r=u.exec(e),n=r?r[1]:e,i=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+i,name:n}:{location:-1}}},{key:"_setAttribute",value:function(e,t){if(t instanceof a.default)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof a.default)this.setBuffer(e,t[0],t[1]);else if(ArrayBuffer.isView(t)||Array.isArray(t))this.setConstant(e,t);else{if(!(t.buffer instanceof a.default))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");this.setBuffer(e,t.buffer,t)}}},{key:"_setConstantAttributes",value:function(e,t){var r=Math.max(0|e,0|t),n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(var i=1;i<this.vertexArrayObject.MAX_ATTRIBUTES;i++)n=this.values[i],ArrayBuffer.isView(n)&&this._setConstantAttribute(i,n)}},{key:"_setConstantAttributeZero",value:function(e,t){if(o.default.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,e);else{var r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(e,t){o.default.setConstant(this.gl,e,t)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,t){var r=this.values[t],n=this.accessors[t];if(r){var i=n.divisor>0;if(e.isInstanced=e.isInstanced||i,r instanceof a.default){var o=r;if(i){var s=o.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,s)}else{var l=o.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,l)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.log.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}]),e}();return vertexArray.default=d,vertexArray}var uniformBufferLayout={},hasRequiredUniformBufferLayout;function requireUniformBufferLayout(){if(hasRequiredUniformBufferLayout)return uniformBufferLayout;hasRequiredUniformBufferLayout=1;var e=interopRequireDefaultExports;Object.defineProperty(uniformBufferLayout,"__esModule",{value:!0}),uniformBufferLayout.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=requireAttributeUtils(),a=requireAssert$3(),o=function(){function e(n){var i;for(var a in(0,r.default)(this,e),this.layout={},this.size=0,n)this._addUniform(a,n[a]);this.size+=(4-this.size%4)%4;var o=new Float32Array(this.size);this.typedArray=((0,t.default)(i={},5126,o),(0,t.default)(i,5124,new Int32Array(o.buffer)),(0,t.default)(i,5125,new Uint32Array(o.buffer)),i)}return(0,n.default)(e,[{key:"getBytes",value:function(){return 4*this.size}},{key:"getData",value:function(){return this.typedArray[5126]}},{key:"getSubData",value:function(e){var t,r;if(void 0===e)t=this.data,r=0;else{var n=this.offsets[e];t=this.data.subarray(n,n+this.sizes[e]),r=4*n}return{data:t,offset:r}}},{key:"setUniforms",value:function(e){for(var t in e)this._setValue(t,e[t]);return this}},{key:"_setValue",value:function(e,t){var r=this.layout[e];(0,a.assert)(r,"UniformLayoutStd140 illegal argument");var n=this.typedArray[r.type];1===r.size?n[r.offset]=t:n.set(t,r.offset)}},{key:"_addUniform",value:function(e,t){var r=(0,i.decomposeCompositeGLType)(t);(0,a.assert)(r,"UniformBufferLayout illegal argument");var n=r.type,o=r.components;this.size=this._alignTo(this.size,o);var s=this.size;this.size+=o,this.layout[e]={type:n,size:o,offset:s}}},{key:"_alignTo",value:function(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}}]),e}();return uniformBufferLayout.default=o,uniformBufferLayout}var debugUniforms={},formatValue={},hasRequiredFormatValue,hasRequiredDebugUniforms;function requireFormatValue(){return hasRequiredFormatValue||(hasRequiredFormatValue=1,Object.defineProperty(formatValue,"__esModule",{value:!0}),formatValue.formatValue=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.isInteger,i=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,r){for(var n=r.maxElts,i=void 0===n?16:n,a=r.size,o=void 0===a?1:a,s="[",l=0;l<t.length&&l<i;++l)l>0&&(s+=",".concat(l%o==0?" ":"")),s+=e(t[l],r);var u=t.length>i?"...":"]";return"".concat(s).concat(u)}(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}),formatValue}function requireDebugUniforms(){if(hasRequiredDebugUniforms)return debugUniforms;hasRequiredDebugUniforms=1;var e=interopRequireDefaultExports;Object.defineProperty(debugUniforms,"__esModule",{value:!0}),debugUniforms.getDebugTableForUniforms=function(e){var a=e.header,s=void 0===a?"Uniforms":a,l=e.program,u=e.uniforms,c=e.undefinedOnly,d=void 0!==c&&c;(0,r.assert)(l);var h,f=".*Matrix",p={},m=Object.keys(l._uniformSetters).sort(),g=0,_=i(m);try{for(_.s();!(h=_.n()).done;){var y=h.value;y.match(".*_.*")||y.match(f)||o({table:p,header:s,uniforms:u,uniformName:y,undefinedOnly:d})&&g++}}catch(e){_.e(e)}finally{_.f()}var v,b=i(m);try{for(b.s();!(v=b.n()).done;){var x=v.value;x.match(f)&&o({table:p,header:s,uniforms:u,uniformName:x,undefinedOnly:d})&&g++}}catch(e){b.e(e)}finally{b.f()}var T,w=i(m);try{for(w.s();!(T=w.n()).done;){var E=T.value;p[E]||o({table:p,header:s,uniforms:u,uniformName:E,undefinedOnly:d})&&g++}}catch(e){w.e(e)}finally{w.f()}var A=0,S={};if(!d)for(var P in u){var M=u[P];p[P]||(A++,S[P]=(0,t.default)({Type:"NOT USED: ".concat(M)},s,(0,n.formatValue)(M)))}return{table:p,count:g,unusedTable:S,unusedCount:A}};var t=e(requireDefineProperty()),r=requireAssert$3(),n=requireFormatValue();function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e){var r,i=e.table,a=e.header,o=e.uniformName,s=e.undefinedOnly,l=e.uniforms[o],u=function(e){return null!=e}(l);return!(s&&u||(i[o]=((0,t.default)(r={},a,u?(0,n.formatValue)(l):"N/A"),(0,t.default)(r,"Uniform Type",u?l:"NOT PROVIDED"),r),0))}return debugUniforms}var debugVertexArray={},hasRequiredDebugVertexArray;function requireDebugVertexArray(){if(hasRequiredDebugVertexArray)return debugVertexArray;hasRequiredDebugVertexArray=1;var e=interopRequireDefaultExports;Object.defineProperty(debugVertexArray,"__esModule",{value:!0}),debugVertexArray.getDebugTableForVertexArray=function(e){var t=e.vertexArray,r=e.header,n=void 0===r?"Attributes":r;if(!t.configuration)return{};var i={};t.elements&&(i.ELEMENT_ARRAY_BUFFER=o(t,t.elements,null,n));var a=t.values;for(var l in a){var u=t._getAttributeInfo(l);if(u){var c="".concat(l,": ").concat(u.name),d=t.accessors[u.location];d&&(c="".concat(l,": ").concat(s(u.name,d))),i[c]=o(t,a[l],d,n)}}return i};var t=e(requireDefineProperty()),r=e(requireBuffer()),n=constantsToKeys,i=requireAttributeUtils(),a=requireFormatValue();function o(e,i,o,s){var l,u,c=e.gl;if(!i)return(0,t.default)(u={},s,"null"),(0,t.default)(u,"Format ","N/A"),u;var d,h,f,p="NOT PROVIDED",m=1,g=0,_=0;if(o&&(p=o.type,m=o.size,d=-1!==(p=String(p).replace("Array","")).indexOf("nt")),i instanceof r.default){var y,v,b=i,x=b.getDebugData(),T=x.data;return h=x.changed?"*":"",f=T,g=(_=b.byteLength)/T.BYTES_PER_ELEMENT/m,o?v="".concat(o.divisor>0?"I ":"P "," ").concat(g," (x").concat(m,"=").concat(_," bytes ").concat((0,n.getKey)(c,p),")"):(d=!0,v="".concat(_," bytes")),(0,t.default)(y={},s,"".concat(h).concat((0,a.formatValue)(f,{size:m,isInteger:d}))),(0,t.default)(y,"Format ",v),y}return f=i,m=i.length,d=-1!==(p=String(i.constructor.name).replace("Array","")).indexOf("nt"),(0,t.default)(l={},s,"".concat((0,a.formatValue)(f,{size:m,isInteger:d})," (constant)")),(0,t.default)(l,"Format ","".concat(m,"x").concat(p," (constant)")),l}function s(e,t){var r=(0,i.getCompositeGLType)(t.type,t.size);return r?"".concat(e," (").concat(r.name,")"):e}return debugVertexArray}var debugProgramConfiguration={},hasRequiredDebugProgramConfiguration;function requireDebugProgramConfiguration(){if(hasRequiredDebugProgramConfiguration)return debugProgramConfiguration;hasRequiredDebugProgramConfiguration=1;var e=interopRequireDefaultExports;Object.defineProperty(debugProgramConfiguration,"__esModule",{value:!0}),debugProgramConfiguration.getDebugTableForProgramConfiguration=function(e){var r,i={},o="Accessors for ".concat(e.id),s=n(e.attributeInfos);try{for(s.s();!(r=s.n()).done;){var l=r.value;if(l){var u=a(l);i["in ".concat(u)]=(0,t.default)({},o,JSON.stringify(l.accessor))}}}catch(e){s.e(e)}finally{s.f()}var c,d=n(e.varyingInfos);try{for(d.s();!(c=d.n()).done;){var h=c.value;if(h){var f=a(h);i["out ".concat(f)]=(0,t.default)({},o,JSON.stringify(h.accessor))}}}catch(e){d.e(e)}finally{d.f()}return i};var t=e(requireDefineProperty()),r=requireAttributeUtils();function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e){var t=e.accessor,n=(0,r.getCompositeGLType)(t.type,t.size);return n?"".concat(n.name," ").concat(e.name):e.name}return debugProgramConfiguration}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Accessor",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"Buffer",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"FEATURES",{enumerable:!0,get:function(){return s.FEATURES}}),Object.defineProperty(e,"FragmentShader",{enumerable:!0,get:function(){return h.FragmentShader}}),Object.defineProperty(e,"Framebuffer",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"Program",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"Query",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(e,"Renderbuffer",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(e,"Shader",{enumerable:!0,get:function(){return h.Shader}}),Object.defineProperty(e,"Texture2D",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"Texture3D",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(e,"TextureCube",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(e,"TransformFeedback",{enumerable:!0,get:function(){return T.default}}),Object.defineProperty(e,"UniformBufferLayout",{enumerable:!0,get:function(){return A.default}}),Object.defineProperty(e,"VertexArray",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(e,"VertexArrayObject",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(e,"VertexShader",{enumerable:!0,get:function(){return h.VertexShader}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return C.assert}}),Object.defineProperty(e,"blit",{enumerable:!0,get:function(){return v.blit}}),Object.defineProperty(e,"canCompileGLGSExtension",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"cancelAnimationFrame",{enumerable:!0,get:function(){return n.cancelAnimationFrame}}),Object.defineProperty(e,"clear",{enumerable:!0,get:function(){return y.clear}}),Object.defineProperty(e,"clearBuffer",{enumerable:!0,get:function(){return y.clearBuffer}}),Object.defineProperty(e,"cloneTextureFrom",{enumerable:!0,get:function(){return i.cloneTextureFrom}}),Object.defineProperty(e,"copyToDataUrl",{enumerable:!0,get:function(){return v.copyToDataUrl}}),Object.defineProperty(e,"copyToImage",{enumerable:!0,get:function(){return v.copyToImage}}),Object.defineProperty(e,"copyToTexture",{enumerable:!0,get:function(){return v.copyToTexture}}),Object.defineProperty(e,"getContextInfo",{enumerable:!0,get:function(){return o.getContextInfo}}),Object.defineProperty(e,"getContextLimits",{enumerable:!0,get:function(){return o.getContextLimits}}),Object.defineProperty(e,"getDebugTableForProgramConfiguration",{enumerable:!0,get:function(){return k.getDebugTableForProgramConfiguration}}),Object.defineProperty(e,"getDebugTableForUniforms",{enumerable:!0,get:function(){return I.getDebugTableForUniforms}}),Object.defineProperty(e,"getDebugTableForVertexArray",{enumerable:!0,get:function(){return D.getDebugTableForVertexArray}}),Object.defineProperty(e,"getFeatures",{enumerable:!0,get:function(){return l.getFeatures}}),Object.defineProperty(e,"getGLContextInfo",{enumerable:!0,get:function(){return o.getGLContextInfo}}),Object.defineProperty(e,"getKey",{enumerable:!0,get:function(){return a.getKey}}),Object.defineProperty(e,"getKeyValue",{enumerable:!0,get:function(){return a.getKeyValue}}),Object.defineProperty(e,"getShaderName",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(e,"getShaderVersion",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(e,"getUniformSetter",{enumerable:!0,get:function(){return L.getUniformSetter}}),Object.defineProperty(e,"hasFeature",{enumerable:!0,get:function(){return l.hasFeature}}),Object.defineProperty(e,"hasFeatures",{enumerable:!0,get:function(){return l.hasFeatures}}),Object.defineProperty(e,"isObjectEmpty",{enumerable:!0,get:function(){return O.isObjectEmpty}}),Object.defineProperty(e,"loadFile",{enumerable:!0,get:function(){return S.loadFile}}),Object.defineProperty(e,"loadImage",{enumerable:!0,get:function(){return S.loadImage}}),Object.defineProperty(e,"log",{enumerable:!0,get:function(){return R.log}}),Object.defineProperty(e,"lumaStats",{enumerable:!0,get:function(){return r.lumaStats}}),Object.defineProperty(e,"parseUniformName",{enumerable:!0,get:function(){return L.parseUniformName}}),Object.defineProperty(e,"readPixelsToArray",{enumerable:!0,get:function(){return v.readPixelsToArray}}),Object.defineProperty(e,"readPixelsToBuffer",{enumerable:!0,get:function(){return v.readPixelsToBuffer}}),Object.defineProperty(e,"requestAnimationFrame",{enumerable:!0,get:function(){return n.requestAnimationFrame}}),Object.defineProperty(e,"setPathPrefix",{enumerable:!0,get:function(){return S.setPathPrefix}}),Object.defineProperty(e,"uid",{enumerable:!0,get:function(){return O.uid}});var r=init,n=requestAnimationFrame$2,i=requireTextureUtils(),a=constantsToKeys,o=limits,s=requireWebglFeaturesTable(),l=requireFeatures$1(),u=t(requireCheckGlslExtension()),c=t(requireAccessor()),d=t(requireBuffer()),h=requireShader$1(),f=t(requireProgram()),p=t(requireFramebuffer()),m=t(requireRenderbuffer()),g=t(requireTexture2d()),_=t(requireTextureCube()),y=requireClear(),v=requireCopyAndBlit(),b=t(requireQuery()),x=t(requireTexture3d()),T=t(requireTransformFeedback()),w=t(requireVertexArrayObject()),E=t(requireVertexArray()),A=t(requireUniformBufferLayout()),S=requireLoadFile(),P=t(requireGetShaderName()),M=t(requireGetShaderVersion()),R=es5$c,C=requireAssert$3(),O=requireUtils$4(),L=requireUniforms(),I=requireDebugUniforms(),D=requireDebugVertexArray(),k=requireDebugProgramConfiguration()}(es5$b);var es5$9={},animationLoop={},hasRequiredAnimationLoop;function requireAnimationLoop(){if(hasRequiredAnimationLoop)return animationLoop;hasRequiredAnimationLoop=1;var e=interopRequireDefaultExports;Object.defineProperty(animationLoop,"__esModule",{value:!0}),animationLoop.default=void 0;var t=e(requireRegenerator()),r=e(_typeofExports),n=e(requireAsyncToGenerator()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=es5$c,s=es5$b,l=(0,requireEs5$5().isBrowser)()&&"undefined"!=typeof document,u=0,c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e);var r=t.onCreateContext,n=void 0===r?function(e){return(0,o.createGLContext)(e)}:r,a=t.onAddHTML,l=void 0===a?null:a,c=t.onInitialize,d=void 0===c?function(){}:c,h=t.onRender,f=void 0===h?function(){}:h,p=t.onFinalize,m=void 0===p?function(){}:p,g=t.onError,_=t.gl,y=void 0===_?null:_,v=t.glOptions,b=void 0===v?{}:v,x=t.debug,T=void 0!==x&&x,w=t.createFramebuffer,E=void 0!==w&&w,A=t.autoResizeViewport,S=void 0===A||A,P=t.autoResizeDrawingBuffer,M=void 0===P||P,R=t.stats,C=void 0===R?s.lumaStats.get("animation-loop-".concat(u++)):R,O=t.useDevicePixels,L=void 0===O||O;"useDevicePixelRatio"in t&&(s.log.deprecated("useDevicePixelRatio","useDevicePixels")(),L=t.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:l,onInitialize:d,onRender:f,onFinalize:m,onError:g,gl:y,glOptions:b,debug:T,createFramebuffer:E},this.gl=y,this.needsRedraw=null,this.timeline=null,this.stats=C,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:S,autoResizeDrawingBuffer:M,useDevicePixels:L}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}var c;return(0,a.default)(e,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(e){return(0,s.assert)("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;var r=this._getPageLoadPromise().then((function(){return!e._running||e._initialized?null:(e._createWebGLContext(t),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e._gpuTimeQuery=s.Query.isSupported(e.gl,["timers"])?new s.Query(e.gl):null,e._initialized=!0,e.onInitialize(e.animationProps))})).then((function(t){e._running&&(e._addCallbackData(t||{}),!1!==t&&e._startLoop())}));return this.props.onError&&r.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(e){return this.timeline=e,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var e=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((function(t){e._resolveNextFrame=t}))),this._nextFramePromise}},{key:"toDataURL",value:(c=(0,n.default)(t.default.mark((function e(){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setNeedsRedraw("toDataURL"),e.next=3,this.waitForRender();case 3:return e.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=document.getElementById(e);return r?Number(r.value):t}},{key:"setViewParameters",value:function(){return s.log.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var e=this;this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame((function t(){e._running&&(e.redraw(),e._animationFrameId=e._requestAnimationFrame(t))}))}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=l?new Promise((function(e,t){l&&"complete"===document.readyState?e(document):window.addEventListener("load",(function(){e(document)}))})):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}},{key:"_cancelAnimationFrame",value:function(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):(0,s.cancelAnimationFrame)(e)}},{key:"_requestAnimationFrame",value:function(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):(0,s.requestAnimationFrame)(e)}},{key:"_renderFrame",value:function(){var e;this.display?(e=this.display)._renderFrame.apply(e,arguments):this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),t=e.width,r=e.height,n=e.aspect;t===this.animationProps.width&&r===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){"object"===(0,r.default)(e)&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?(0,o.instrumentGLContext)(this.props.gl,e):this.onCreateContext(e),!(0,o.isWebGL)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");(0,o.resetParameters)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);var r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight,r=1,n=this.gl.canvas;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&(0,o.resizeGLContext)(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new s.Framebuffer(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var e=this.gl.canvas;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),e}();return animationLoop.default=c,animationLoop}var model={},programManager={},es5$8={},assembleShaders$1={},constants$3={},hasRequiredConstants$3;function requireConstants$3(){return hasRequiredConstants$3||(hasRequiredConstants$3=1,Object.defineProperty(constants$3,"__esModule",{value:!0}),constants$3.VERTEX_SHADER=constants$3.FRAGMENT_SHADER=void 0,constants$3.VERTEX_SHADER="vs",constants$3.FRAGMENT_SHADER="fs"),constants$3}var resolveModules={},shaderModule={},utils$3={},assert$3={},hasRequiredAssert$2,hasRequiredUtils$3;function requireAssert$2(){return hasRequiredAssert$2||(hasRequiredAssert$2=1,Object.defineProperty(assert$3,"__esModule",{value:!0}),assert$3.default=function(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}),assert$3}function requireUtils$3(){return hasRequiredUtils$3||(hasRequiredUtils$3=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return r.default}});var r=t(requireAssert$2())}(utils$3)),utils$3}var propTypes$1={},hasRequiredPropTypes$1;function requirePropTypes$1(){if(hasRequiredPropTypes$1)return propTypes$1;hasRequiredPropTypes$1=1;var e=interopRequireDefaultExports;Object.defineProperty(propTypes$1,"__esModule",{value:!0}),propTypes$1.parsePropTypes=function(e){var t={};for(var r in e){var i=n(e[r]);t[r]=i}return t};var t=e(_typeofExports),r={number:{validate:function(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},array:{validate:function(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function n(e){var t=i(e);return"object"===t?e?"type"in e?Object.assign({},e,r[e.type]):"value"in e?(t=i(e.value),Object.assign({type:t},e,r[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},r[t])}function i(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":(0,t.default)(e)}return propTypes$1}var _interopRequireDefault$a=interopRequireDefaultExports;Object.defineProperty(shaderModule,"__esModule",{value:!0}),shaderModule.default=void 0,shaderModule.normalizeShaderModule=normalizeShaderModule;var _classCallCheck2=_interopRequireDefault$a(requireClassCallCheck()),_createClass2=_interopRequireDefault$a(requireCreateClass()),_utils$3=requireUtils$3(),_propTypes=requirePropTypes$1(),VERTEX_SHADER="vs",FRAGMENT_SHADER="fs",ShaderModule=function(){function e(t){var r=t.name,n=t.vs,i=t.fs,a=t.dependencies,o=void 0===a?[]:a,s=t.uniforms,l=t.getUniforms,u=t.deprecations,c=void 0===u?[]:u,d=t.defines,h=void 0===d?{}:d,f=t.inject,p=void 0===f?{}:f,m=t.vertexShader,g=t.fragmentShader;(0,_classCallCheck2.default)(this,e),(0,_utils$3.assert)("string"==typeof r),this.name=r,this.vs=n||m,this.fs=i||g,this.getModuleUniforms=l,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(c),this.defines=h,this.injections=normalizeInjections(p),s&&(this.uniforms=(0,_propTypes.parsePropTypes)(s))}return(0,_createClass2.default)(e,[{key:"getModuleSource",value:function(e){var t;switch(e){case VERTEX_SHADER:t=this.vs||"";break;case FRAGMENT_SHADER:t=this.fs||"";break;default:(0,_utils$3.assert)(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(t,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(e,t){this.deprecations.forEach((function(r){r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())}))}},{key:"_parseDeprecationDefinitions",value:function(e){return e.forEach((function(e){e.regex="function"===e.type?new RegExp("\\b".concat(e.old,"\\(")):new RegExp("".concat(e.type," ").concat(e.old,";"))})),e}},{key:"_defaultGetUniforms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},r=this.uniforms;for(var n in r){var i=r[n];n in e&&!i.private?(i.validate&&(0,_utils$3.assert)(i.validate(e[n],i),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=i.value}return t}}]),e}(),hasRequiredResolveModules;function normalizeShaderModule(e){if(!e.normalized&&(e.normalized=!0,e.uniforms&&!e.getUniforms)){var t=new ShaderModule(e);e.getUniforms=t.getUniforms.bind(t)}return e}function normalizeInjections(e){var t={vs:{},fs:{}};for(var r in e){var n=e[r];"string"==typeof n&&(n={order:0,injection:n}),t[r.slice(0,2)][r]=n}return t}function requireResolveModules(){if(hasRequiredResolveModules)return resolveModules;hasRequiredResolveModules=1;var e=interopRequireDefaultExports;Object.defineProperty(resolveModules,"__esModule",{value:!0}),resolveModules.TEST_EXPORTS=void 0,resolveModules.resolveModules=function(e){return a(s(e))};var t=e(shaderModule),r=requireUtils$3();function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e){var t={},r={};return o({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((function(e,t){return r[t]-r[e]})).map((function(e){return t[e]}))}function o(e){var t=e.modules,r=e.level,i=e.moduleMap,a=e.moduleDepth;if(r>=5)throw new Error("Possible loop in shader dependency graph");var s,l=n(t);try{for(l.s();!(s=l.n()).done;){var u=s.value;i[u.name]=u,(void 0===a[u.name]||a[u.name]<r)&&(a[u.name]=r)}}catch(e){l.e(e)}finally{l.f()}var c,d=n(t);try{for(d.s();!(c=d.n()).done;){var h=c.value;h.dependencies&&o({modules:h.dependencies,level:r+1,moduleMap:i,moduleDepth:a})}}catch(e){d.e(e)}finally{d.f()}}function s(e,n){return e.map((function(e){return e instanceof t.default||((0,r.assert)("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),(0,r.assert)(e.name,"shader module has no name"),(e=new t.default(e)).dependencies=s(e.dependencies)),e}))}return resolveModules.TEST_EXPORTS={getShaderDependencies:a,getDependencyGraph:o},resolveModules}shaderModule.default=ShaderModule;var platformDefines={},webglInfo={},isOldIe={},hasRequiredIsOldIe,hasRequiredWebglInfo,hasRequiredPlatformDefines;function requireIsOldIe(){return hasRequiredIsOldIe||(hasRequiredIsOldIe=1,Object.defineProperty(isOldIe,"__esModule",{value:!0}),isOldIe.default=function(){var e="undefined"!=typeof window&&window.navigator||{},t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).userAgent||e.userAgent||"",r=-1!==t.indexOf("MSIE "),n=-1!==t.indexOf("Trident/");return r||n}),isOldIe}function requireWebglInfo(){if(hasRequiredWebglInfo)return webglInfo;hasRequiredWebglInfo=1;var e=interopRequireDefaultExports;Object.defineProperty(webglInfo,"__esModule",{value:!0}),webglInfo.FEATURES=void 0,webglInfo.canCompileGLGSExtension=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s[n];if((0,r.default)(a,n),!(0,t.default)(i))return!0;if(n in c)return c[n];var o=i.behavior||"enable",l="#extension GL_".concat(a[0]," : ").concat(o,"\nvoid main(void) {}"),u=e.createShader(35633);e.shaderSource(u,l),e.compileShader(u);var d=e.getShaderParameter(u,35713);return e.deleteShader(u),c[n]=d,d},webglInfo.getContextInfo=function(e){var t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||n),s=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||i);return{gpuVendor:u(r,s),vendor:r,renderer:s,version:e.getParameter(a),shadingLanguageVersion:e.getParameter(o)}},webglInfo.hasFeatures=function(e,t){return(t=Array.isArray(t)?t:[t]).every((function(t){return function(e,t){var n=s[t];(0,r.default)(n,t);var i=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}(e)&&n[1]||n[0],a="string"==typeof i?Boolean(e.getExtension(i)):i;return(0,r.default)(!1===a||!0===a),a}(e,t)}))};var t=e(requireIsOldIe()),r=e(requireAssert$2()),n=7936,i=7937,a=7938,o=35724,s={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},l={};function u(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}webglInfo.FEATURES=l,Object.keys(s).forEach((function(e){l[e]=e}));var c={};return webglInfo}function requirePlatformDefines(){if(hasRequiredPlatformDefines)return platformDefines;hasRequiredPlatformDefines=1,Object.defineProperty(platformDefines,"__esModule",{value:!0}),platformDefines.getPlatformShaderDefines=function(t){switch((0,e.getContextInfo)(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}},platformDefines.getVersionDefines=function(t,r,n){var i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return(0,e.hasFeatures)(t,e.FEATURES.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),(0,e.hasFeatures)(t,e.FEATURES.GLSL_DERIVATIVES)&&(0,e.canCompileGLGSExtension)(t,e.FEATURES.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),(0,e.hasFeatures)(t,e.FEATURES.GLSL_FRAG_DATA)&&(0,e.canCompileGLGSExtension)(t,e.FEATURES.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),(0,e.hasFeatures)(t,e.FEATURES.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i};var e=requireWebglInfo();return platformDefines}var injectShader$1={},moduleInjectors={},hasRequiredModuleInjectors;function requireModuleInjectors(){return hasRequiredModuleInjectors||(hasRequiredModuleInjectors=1,Object.defineProperty(moduleInjectors,"__esModule",{value:!0}),moduleInjectors.MODULE_INJECTORS_VS=moduleInjectors.MODULE_INJECTORS_FS=void 0,moduleInjectors.MODULE_INJECTORS_VS="#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",moduleInjectors.MODULE_INJECTORS_FS="#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),moduleInjectors}var _interopRequireDefault$9=interopRequireDefaultExports;Object.defineProperty(injectShader$1,"__esModule",{value:!0}),injectShader$1.DECLARATION_INJECT_MARKER=void 0,injectShader$1.combineInjects=combineInjects,injectShader$1.default=injectShader;var _defineProperty2$3=_interopRequireDefault$9(requireDefineProperty()),_moduleInjectors=requireModuleInjectors(),_constants$1=requireConstants$3(),_utils$2=requireUtils$3(),_MODULE_INJECTORS,MODULE_INJECTORS=(_MODULE_INJECTORS={},(0,_defineProperty2$3.default)(_MODULE_INJECTORS,_constants$1.VERTEX_SHADER,_moduleInjectors.MODULE_INJECTORS_VS),(0,_defineProperty2$3.default)(_MODULE_INJECTORS,_constants$1.FRAGMENT_SHADER,_moduleInjectors.MODULE_INJECTORS_FS),_MODULE_INJECTORS),DECLARATION_INJECT_MARKER="__LUMA_INJECT_DECLARATIONS__";injectShader$1.DECLARATION_INJECT_MARKER=DECLARATION_INJECT_MARKER;var REGEX_START_OF_MAIN=/void\s+main\s*\([^)]*\)\s*\{\n?/,REGEX_END_OF_MAIN=/}\n?[^{}]*$/,fragments=[];function injectShader(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t===_constants$1.VERTEX_SHADER,a=function(t){var n=r[t];n.sort((function(e,t){return e.order-t.order})),fragments.length=n.length;for(var a=0,o=n.length;a<o;++a)fragments[a]=n[a].injection;var s="".concat(fragments.join("\n"),"\n");switch(t){case"vs:#decl":i&&(e=e.replace(DECLARATION_INJECT_MARKER,s));break;case"vs:#main-start":i&&(e=e.replace(REGEX_START_OF_MAIN,(function(e){return e+s})));break;case"vs:#main-end":i&&(e=e.replace(REGEX_END_OF_MAIN,(function(e){return s+e})));break;case"fs:#decl":i||(e=e.replace(DECLARATION_INJECT_MARKER,s));break;case"fs:#main-start":i||(e=e.replace(REGEX_START_OF_MAIN,(function(e){return e+s})));break;case"fs:#main-end":i||(e=e.replace(REGEX_END_OF_MAIN,(function(e){return s+e})));break;default:e=e.replace(t,(function(e){return e+s}))}};for(var o in r)a(o);return e=e.replace(DECLARATION_INJECT_MARKER,""),n&&(e=e.replace(/\}\s*$/,(function(e){return e+MODULE_INJECTORS[t]}))),e}function combineInjects(e){var t={};return(0,_utils$2.assert)(Array.isArray(e)&&e.length>1),e.forEach((function(e){for(var r in e)t[r]=t[r]?"".concat(t[r],"\n").concat(e[r]):e[r]})),t}var transpileShader={},hasRequiredTranspileShader;function requireTranspileShader(){if(hasRequiredTranspileShader)return transpileShader;hasRequiredTranspileShader=1;var e=interopRequireDefaultExports;Object.defineProperty(transpileShader,"__esModule",{value:!0}),transpileShader.default=function(e,t,r){switch(t){case 300:return r?f(e,a):function(e){var t=(e=f(e,o)).match(d);if(t){var r=t[1];e=e.replace(new RegExp("\\b".concat(c,"\\b"),"g"),r)}else{var n="fragmentColor";e=e.replace(h,(function(e){return"out vec4 ".concat(n,";\n").concat(e)})).replace(new RegExp("\\b".concat(c,"\\b"),"g"),n)}return e}(e);case 100:return r?f(e,l):function(e){var t=(e=f(e,u)).match(d);if(t){var r=t[1];e=e.replace(d,"").replace(new RegExp("\\b".concat(r,"\\b"),"g"),c)}return e}(e);default:throw new Error("unknown GLSL version ".concat(t))}};var t=e(requireSlicedToArray());function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n(e){return new RegExp("\\b".concat(e,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var i=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],a=[].concat(i,[[n("attribute"),"in $1"],[n("varying"),"out $1"]]),o=[].concat(i,[[n("varying"),"in $1"]]),s=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],l=[].concat(s,[[n("in"),"attribute $1"],[n("out"),"varying $1"]]),u=[].concat(s,[[n("in"),"varying $1"]]),c="gl_FragColor",d=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,h=/void\s+main\s*\([^)]*\)\s*\{\n?/;function f(e,n){var i,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(n);try{for(a.s();!(i=a.n()).done;){var o=(0,t.default)(i.value,2);e=e.replace(o[0],o[1])}}catch(e){a.e(e)}finally{a.f()}return e}return transpileShader}var _interopRequireDefault$8=interopRequireDefaultExports,_typeof=_typeofExports;Object.defineProperty(assembleShaders$1,"__esModule",{value:!0}),assembleShaders$1.assembleShaders=assembleShaders;var _slicedToArray2$1=_interopRequireDefault$8(requireSlicedToArray()),_defineProperty2$2=_interopRequireDefault$8(requireDefineProperty()),_constants=requireConstants$3(),_resolveModules=requireResolveModules(),_platformDefines=requirePlatformDefines(),_injectShader=_interopRequireWildcard(injectShader$1),_transpileShader=_interopRequireDefault$8(requireTranspileShader()),_utils$1=requireUtils$3(),_SHADER_TYPE;function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function _createForOfIteratorHelper$1(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var INJECT_SHADER_DECLARATIONS="\n\n".concat(_injectShader.DECLARATION_INJECT_MARKER,"\n\n"),SHADER_TYPE=(_SHADER_TYPE={},(0,_defineProperty2$2.default)(_SHADER_TYPE,_constants.VERTEX_SHADER,"vertex"),(0,_defineProperty2$2.default)(_SHADER_TYPE,_constants.FRAGMENT_SHADER,"fragment"),_SHADER_TYPE),FRAGMENT_SHADER_PROLOGUE="precision highp float;\n\n";function assembleShaders(e,t){var r=t.vs,n=t.fs,i=(0,_resolveModules.resolveModules)(t.modules||[]);return{gl:e,vs:assembleShader(e,Object.assign({},t,{source:r,type:_constants.VERTEX_SHADER,modules:i})),fs:assembleShader(e,Object.assign({},t,{source:n,type:_constants.FRAGMENT_SHADER,modules:i})),getUniforms:assembleGetUniforms(i)}}function assembleShader(e,t){var r=t.id,n=t.source,i=t.type,a=t.modules,o=t.defines,s=void 0===o?{}:o,l=t.hookFunctions,u=void 0===l?[]:l,c=t.inject,d=void 0===c?{}:c,h=t.transpileToGLSL100,f=void 0!==h&&h,p=t.prologue,m=void 0===p||p,g=t.log;(0,_utils$1.assert)("string"==typeof n,"shader source must be a string");var _=i===_constants.VERTEX_SHADER,y=n.split("\n"),v=100,b="",x=n;0===y[0].indexOf("#version ")?(v=300,b=y[0],x=y.slice(1).join("\n")):b="#version ".concat(v);var T={};a.forEach((function(e){Object.assign(T,e.getDefines())})),Object.assign(T,s);var w=m?"".concat(b,"\n").concat(getShaderName({id:r,source:n,type:i}),"\n").concat(getShaderType({type:i}),"\n").concat((0,_platformDefines.getPlatformShaderDefines)(e),"\n").concat((0,_platformDefines.getVersionDefines)(e,v,!_),"\n").concat(getApplicationDefines(T),"\n").concat(_?"":FRAGMENT_SHADER_PROLOGUE,"\n"):"".concat(b,"\n"),E=normalizeHookFunctions(u),A={},S={},P={};for(var M in d){var R="string"==typeof d[M]?{injection:d[M],order:0}:d[M],C=M.match(/^(v|f)s:(#)?([\w-]+)$/);C?C[2]?"decl"===C[3]?S[M]=[R]:P[M]=[R]:A[M]=[R]:P[M]=[R]}var O,L=_createForOfIteratorHelper$1(a);try{for(L.s();!(O=L.n()).done;){var I=O.value;g&&I.checkDeprecations(x,g),w+=I.getModuleSource(i,v);var D=I.injections[i];for(var k in D){var B=k.match(/^(v|f)s:#([\w-]+)$/);if(B){var F="decl"===B[2]?S:P;F[k]=F[k]||[],F[k].push(D[k])}else A[k]=A[k]||[],A[k].push(D[k])}}}catch(e){L.e(e)}finally{L.f()}return w=(0,_injectShader.default)(w+=INJECT_SHADER_DECLARATIONS,i,S),w+=getHookFunctions(E[i],A),w=(0,_injectShader.default)(w+=x,i,P),(0,_transpileShader.default)(w,f?100:v,_)}function assembleGetUniforms(e){return function(t){var r,n={},i=_createForOfIteratorHelper$1(e);try{for(i.s();!(r=i.n()).done;){var a=r.value.getUniforms(t,n);Object.assign(n,a)}}catch(e){i.e(e)}finally{i.f()}return n}}function getShaderType(e){return"\n#define SHADER_TYPE_".concat(SHADER_TYPE[e.type].toUpperCase(),"\n")}function getShaderName(e){var t=e.id,r=e.type;return t&&"string"==typeof t&&-1===e.source.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(t,"_").concat(SHADER_TYPE[r],"\n\n"):""}function getApplicationDefines(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r="";for(var n in e){0===t&&(r+="\n// APPLICATION DEFINES\n"),t++;var i=e[n];(i||Number.isFinite(i))&&(r+="#define ".concat(n.toUpperCase()," ").concat(e[n],"\n"))}return 0===t&&(r+="\n"),r}function getHookFunctions(e,t){var r="";for(var n in e){var i=e[n];if(r+="void ".concat(i.signature," {\n"),i.header&&(r+="  ".concat(i.header)),t[n]){var a=t[n];a.sort((function(e,t){return e.order-t.order}));var o,s=_createForOfIteratorHelper$1(a);try{for(s.s();!(o=s.n()).done;)r+="  ".concat(o.value.injection,"\n")}catch(e){s.e(e)}finally{s.f()}}i.footer&&(r+="  ".concat(i.footer)),r+="}\n"}return r}function normalizeHookFunctions(e){var t={vs:{},fs:{}};return e.forEach((function(e){var r;"string"!=typeof e?e=(r=e).hook:r={};var n=(e=e.trim()).split(":"),i=(0,_slicedToArray2$1.default)(n,2),a=i[0],o=i[1],s=e.replace(/\(.+/,"");t[a][s]=Object.assign(r,{signature:o})})),t}var shaderUtils={},_interopRequireDefault$7=interopRequireDefaultExports;Object.defineProperty(shaderUtils,"__esModule",{value:!0}),shaderUtils.convertToVec4=convertToVec4,shaderUtils.getPassthroughFS=getPassthroughFS,shaderUtils.getQualifierDetails=getQualifierDetails,shaderUtils.typeToChannelCount=typeToChannelCount,shaderUtils.typeToChannelSuffix=typeToChannelSuffix;var _slicedToArray2=_interopRequireDefault$7(requireSlicedToArray()),_utils=requireUtils$3(),FS100="void main() {gl_FragColor = vec4(0);}",FS_GLES="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",FS300="#version 300 es\n".concat(FS_GLES);function getQualifierDetails(e,t){t=Array.isArray(t)?t:[t];var r=e.replace(/^\s+/,"").split(/\s+/),n=(0,_slicedToArray2.default)(r,3),i=n[0],a=n[1],o=n[2];return t.includes(i)&&a&&o?{qualifier:i,type:a,name:o.split(";")[0]}:null}function getPassthroughFS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.version,r=void 0===t?100:t,n=e.input,i=e.inputType,a=e.output;if(!n)return 300===r?FS300:r>300?"#version ".concat(r,"\n").concat(FS_GLES):FS100;var o=convertToVec4(n,i);return r>=300?"#version ".concat(r," ").concat(300===r?"es":"","\nin ").concat(i," ").concat(n,";\nout vec4 ").concat(a,";\nvoid main() {\n  ").concat(a," = ").concat(o,";\n}"):"varying ".concat(i," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(o,";\n}")}function typeToChannelSuffix(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return(0,_utils.assert)(!1),null}}function typeToChannelCount(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return(0,_utils.assert)(!1),null}}function convertToVec4(e,t){switch(t){case"float":return"vec4(".concat(e,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(e,", 0.0, 1.0)");case"vec3":return"vec4(".concat(e,", 1.0)");case"vec4":return e;default:return(0,_utils.assert)(!1),null}}var modules={},random$1={};Object.defineProperty(random$1,"__esModule",{value:!0}),random$1.random=void 0;var fs$p="float random(vec3 scale, float seed) {\n  return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n",random={name:"random",fs:fs$p};random$1.random=random;var fp32$1={};Object.defineProperty(fp32$1,"__esModule",{value:!0}),fp32$1.fp32=void 0;var fp32shader="#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fp32={name:"fp32",vs:fp32shader,fs:null};fp32$1.fp32=fp32;var fp64={},fp64Utils={};function fp64ify(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.fround(e),i=e-n;return t[r]=n,t[r+1]=i,t}function fp64LowPart(e){return e-Math.fround(e)}function fp64ifyMatrix4(e){for(var t=new Float32Array(32),r=0;r<4;++r)for(var n=0;n<4;++n)fp64ify(e[4*n+r],t,2*(4*r+n));return t}Object.defineProperty(fp64Utils,"__esModule",{value:!0}),fp64Utils.fp64LowPart=fp64LowPart,fp64Utils.fp64ify=fp64ify,fp64Utils.fp64ifyMatrix4=fp64ifyMatrix4;var fp64Arithmetic_glsl={},hasRequiredFp64Arithmetic_glsl;function requireFp64Arithmetic_glsl(){return hasRequiredFp64Arithmetic_glsl||(hasRequiredFp64Arithmetic_glsl=1,Object.defineProperty(fp64Arithmetic_glsl,"__esModule",{value:!0}),fp64Arithmetic_glsl.default=void 0,fp64Arithmetic_glsl.default="uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n"),fp64Arithmetic_glsl}var fp64Functions_glsl={},hasRequiredFp64Functions_glsl;function requireFp64Functions_glsl(){return hasRequiredFp64Functions_glsl||(hasRequiredFp64Functions_glsl=1,Object.defineProperty(fp64Functions_glsl,"__esModule",{value:!0}),fp64Functions_glsl.default=void 0,fp64Functions_glsl.default="const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\nvec2 exp_fp64(vec2 a) {\n\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n\n\n\n\n\n  s = sum_fp64(s, t);\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"),fp64Functions_glsl}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),e.fp64=void 0,Object.defineProperty(e,"fp64LowPart",{enumerable:!0,get:function(){return r.fp64LowPart}}),e.fp64arithmetic=void 0,Object.defineProperty(e,"fp64ify",{enumerable:!0,get:function(){return r.fp64ify}}),Object.defineProperty(e,"fp64ifyMatrix4",{enumerable:!0,get:function(){return r.fp64ifyMatrix4}});var r=fp64Utils,n=t(requireFp64Arithmetic_glsl()),i=t(requireFp64Functions_glsl()),a={ONE:1},o={name:"fp64-arithmetic",vs:n.default,fs:null,getUniforms:function(){return a},fp64ify:r.fp64ify,fp64LowPart:r.fp64LowPart,fp64ifyMatrix4:r.fp64ifyMatrix4};e.fp64arithmetic=o,e.fp64={name:"fp64",vs:i.default,fs:null,dependencies:[o],fp64ify:r.fp64ify,fp64LowPart:r.fp64LowPart,fp64ifyMatrix4:r.fp64ifyMatrix4}}(fp64);var project$2={};Object.defineProperty(project$2,"__esModule",{value:!0}),project$2.project=void 0;var _core=es5$q,IDENTITY_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DEFAULT_MODULE_OPTIONS$2={modelMatrix:IDENTITY_MATRIX,viewMatrix:IDENTITY_MATRIX,projectionMatrix:IDENTITY_MATRIX,cameraPositionWorld:[0,0,0]};function getUniforms$4(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_MODULE_OPTIONS$2,t={};return void 0!==e.modelMatrix&&(t.modelMatrix=e.modelMatrix),void 0!==e.viewMatrix&&(t.viewMatrix=e.viewMatrix),void 0!==e.projectionMatrix&&(t.projectionMatrix=e.projectionMatrix),void 0!==e.cameraPositionWorld&&(t.cameraPositionWorld=e.cameraPositionWorld),void 0===e.projectionMatrix&&void 0===e.viewMatrix||(t.viewProjectionMatrix=new _core.Matrix4(e.projectionMatrix).multiplyRight(e.viewMatrix)),t}var common="varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n",vs$5="".concat(common,"\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n"),fs$o="\n".concat(common),project$1={name:"project",getUniforms:getUniforms$4,vs:vs$5,fs:fs$o};project$2.project=project$1;var lights$1={},lights_glsl={},hasRequiredLights_glsl;function requireLights_glsl(){return hasRequiredLights_glsl||(hasRequiredLights_glsl=1,Object.defineProperty(lights_glsl,"__esModule",{value:!0}),lights_glsl.default=void 0,lights_glsl.default="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n"),lights_glsl}var _interopRequireDefault$6=interopRequireDefaultExports;Object.defineProperty(lights$1,"__esModule",{value:!0}),lights$1.lights=void 0;var _lights$2=_interopRequireDefault$6(requireLights_glsl());function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var INITIAL_MODULE_OPTIONS$1={lightSources:{}};function convertColor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,r=e.intensity,n=void 0===r?1:r;return(void 0===t?[0,0,0]:t).map((function(e){return e*n/255}))}function getLightSourceUniforms(e){var t=e.ambientLight,r=e.pointLights,n=void 0===r?[]:r,i=e.directionalLights,a=void 0===i?[]:i,o={};return o["lighting_uAmbientLight.color"]=t?convertColor(t):[0,0,0],n.forEach((function(e,t){o["lighting_uPointLight[".concat(t,"].color")]=convertColor(e),o["lighting_uPointLight[".concat(t,"].position")]=e.position,o["lighting_uPointLight[".concat(t,"].attenuation")]=e.attenuation||[1,0,0]})),o.lighting_uPointLightCount=n.length,a.forEach((function(e,t){o["lighting_uDirectionalLight[".concat(t,"].color")]=convertColor(e),o["lighting_uDirectionalLight[".concat(t,"].direction")]=e.direction})),o.lighting_uDirectionalLightCount=a.length,o}function getUniforms$3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:INITIAL_MODULE_OPTIONS$1;if("lightSources"in e){var t=e.lightSources||{},r=t.ambientLight,n=t.pointLights,i=t.directionalLights;return r||n&&n.length>0||i&&i.length>0?Object.assign({},getLightSourceUniforms({ambientLight:r,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){var a,o={pointLights:[],directionalLights:[]},s=_createForOfIteratorHelper(e.lights||[]);try{for(s.s();!(a=s.n()).done;){var l=a.value;switch(l.type){case"ambient":o.ambientLight=l;break;case"directional":o.directionalLights.push(l);break;case"point":o.pointLights.push(l)}}}catch(e){s.e(e)}finally{s.f()}return getUniforms$3({lightSources:o})}return{}}var lights={name:"lights",vs:_lights$2.default,fs:_lights$2.default,getUniforms:getUniforms$3,defines:{MAX_LIGHTS:3}};lights$1.lights=lights;var dirlight$1={};Object.defineProperty(dirlight$1,"__esModule",{value:!0}),dirlight$1.dirlight=void 0;var _project=project$2,DEFAULT_LIGHT_DIRECTION=new Float32Array([1,1,2]),DEFAULT_MODULE_OPTIONS$1={lightDirection:DEFAULT_LIGHT_DIRECTION};function getUniforms$2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_MODULE_OPTIONS$1,t={};return e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection),t}var vs$4=null,fs$n="uniform vec3 dirlight_uLightDirection;\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n",dirlight={name:"dirlight",vs:vs$4,fs:fs$n,getUniforms:getUniforms$2,dependencies:[_project.project]};dirlight$1.dirlight=dirlight;var picking$2={};Object.defineProperty(picking$2,"__esModule",{value:!0}),picking$2.picking=void 0;var DEFAULT_HIGHLIGHT_COLOR=new Uint8Array([0,255,255,255]),DEFAULT_MODULE_OPTIONS={pickingSelectedColor:null,pickingHighlightColor:DEFAULT_HIGHLIGHT_COLOR,pickingActive:!1,pickingAttribute:!1};function getUniforms$1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_MODULE_OPTIONS,t={};if(void 0!==e.pickingSelectedColor)if(e.pickingSelectedColor){var r=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=r}else t.picking_uSelectedColorValid=0;if(e.pickingHighlightColor){var n=Array.from(e.pickingHighlightColor,(function(e){return e/255}));Number.isFinite(n[3])||(n[3]=1),t.picking_uHighlightColor=n}return void 0!==e.pickingActive&&(t.picking_uActive=Boolean(e.pickingActive),t.picking_uAttribute=Boolean(e.pickingAttribute)),t}var vs$3="uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs$m="uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",picking$1={name:"picking",vs:vs$3,fs:fs$m,getUniforms:getUniforms$1};picking$2.picking=picking$1;var phongLighting$1={},phongLighting_glsl={},hasRequiredPhongLighting_glsl;function requirePhongLighting_glsl(){return hasRequiredPhongLighting_glsl||(hasRequiredPhongLighting_glsl=1,Object.defineProperty(phongLighting_glsl,"__esModule",{value:!0}),phongLighting_glsl.default=void 0,phongLighting_glsl.default="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n"),phongLighting_glsl}var _interopRequireDefault$5=interopRequireDefaultExports;Object.defineProperty(phongLighting$1,"__esModule",{value:!0}),phongLighting$1.phongLighting=phongLighting$1.gouraudLighting=void 0;var _lights$1=lights$1,_phongLighting=_interopRequireDefault$5(requirePhongLighting_glsl()),INITIAL_MODULE_OPTIONS={};function getMaterialUniforms(e){var t=e.ambient,r=e.diffuse,n=e.shininess,i=e.specularColor;return{lighting_uAmbient:void 0===t?.35:t,lighting_uDiffuse:void 0===r?.6:r,lighting_uShininess:void 0===n?32:n,lighting_uSpecularColor:(void 0===i?[30,30,30]:i).map((function(e){return e/255}))}}function getUniforms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:INITIAL_MODULE_OPTIONS;if(!("material"in e))return{};var t=e.material;return t?getMaterialUniforms(t):{lighting_uEnabled:!1}}var gouraudLighting={name:"gouraud-lighting",dependencies:[_lights$1.lights],vs:_phongLighting.default,defines:{LIGHTING_VERTEX:1},getUniforms:getUniforms};phongLighting$1.gouraudLighting=gouraudLighting;var phongLighting={name:"phong-lighting",dependencies:[_lights$1.lights],fs:_phongLighting.default,defines:{LIGHTING_FRAGMENT:1},getUniforms:getUniforms};phongLighting$1.phongLighting=phongLighting;var pbr$1={},pbrVertex_glsl={},hasRequiredPbrVertex_glsl;function requirePbrVertex_glsl(){return hasRequiredPbrVertex_glsl||(hasRequiredPbrVertex_glsl=1,Object.defineProperty(pbrVertex_glsl,"__esModule",{value:!0}),pbrVertex_glsl.default=void 0,pbrVertex_glsl.default="uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n\nvarying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n"),pbrVertex_glsl}var pbrFragment_glsl={},hasRequiredPbrFragment_glsl;function requirePbrFragment_glsl(){return hasRequiredPbrFragment_glsl||(hasRequiredPbrFragment_glsl=1,Object.defineProperty(pbrFragment_glsl,"__esModule",{value:!0}),pbrFragment_glsl.default=void 0,pbrFragment_glsl.default="#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)\n# error PBR fragment shader: Texture LOD is not available\n#endif\n\n#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)\n# error PBR fragment shader: Derivatives are not available\n#endif\n\n\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\nuniform bool pbr_uUnlit;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n  vec3 n;\n  vec3 v;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\n  return vec4(linOut,srgbIn.w);;\n#else\n  return srgbIn;\n#endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);\n  vec3 h = normalize(l+v);\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 color = vec3(0, 0, 0);\n\n  if(pbr_uUnlit){\n    color.rgb = baseColor.rgb;\n  }\n  else{\n\n\n    float perceptualRoughness = u_MetallicRoughnessValues.y;\n    float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n#endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    vec3 n = getNormal();\n    vec3 v = normalize(u_Camera - pbr_vPosition);\n\n    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    PBRInfo pbrInputs = PBRInfo(\n      0.0,\n      NdotV,\n      0.0,\n      0.0,\n      0.0,\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n#ifdef USE_LIGHTS\n    PBRInfo_setAmbientLight(pbrInputs);\n    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n      if (i < lighting_uDirectionalLightCount) {\n        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n      }\n    }\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n      if (i < lighting_uPointLightCount) {\n        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n      }\n    }\n#endif\n#ifdef USE_IBL\n    color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n    color += emissive;\n#endif\n\n#ifdef PBR_DEBUG\n\n\n\n\n\n    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  }\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n"),pbrFragment_glsl}var _interopRequireDefault$4=interopRequireDefaultExports;Object.defineProperty(pbr$1,"__esModule",{value:!0}),pbr$1.pbr=void 0;var _lights=lights$1,_pbrVertex=_interopRequireDefault$4(requirePbrVertex_glsl()),_pbrFragment=_interopRequireDefault$4(requirePbrFragment_glsl()),pbr={name:"pbr",vs:_pbrVertex.default,fs:_pbrFragment.default,defines:{LIGHTING_FRAGMENT:1},dependencies:[_lights.lights]};pbr$1.pbr=pbr;var tiltshift={};Object.defineProperty(tiltshift,"__esModule",{value:!0}),tiltshift.tiltShift=void 0;var _random$3=random$1,fs$l="uniform float blurRadius;\nuniform float gradientRadius;\nuniform vec2 start;\nuniform vec2 end;\nuniform bool invert;\n\nvec2 tiltShift_getDelta(vec2 texSize) {\n  vec2 vector = normalize((end - start) * texSize);\n  return invert ? vec2(-vector.y, vector.x) : vector;\n}\n\nvec4 tiltShift_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec4 color = vec4(0.0);\n  float total = 0.0;\n  float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n  vec2 normal = normalize(vec2((start.y - end.y) * texSize.y, (end.x - start.x) * texSize.x));\n  float radius = smoothstep(0.0, 1.0,\n    abs(dot(texCoord * texSize - start * texSize, normal)) / gradientRadius) * blurRadius;\n\n  for (float t = -30.0; t <= 30.0; t++) {\n    float percent = (t + offset - 0.5) / 30.0;\n    float weight = 1.0 - abs(percent);\n    vec4 sample = texture2D(texture, texCoord + tiltShift_getDelta(texSize) / texSize * percent * radius);\n    sample.rgb *= sample.a;\n\n    color += sample * weight;\n    total += weight;\n  }\n\n  color = color / total;\n  color.rgb /= color.a + 0.00001;\n\n  return color;\n}\n",uniforms$h={blurRadius:{value:15,min:0,max:50},gradientRadius:{value:200,min:0,max:400},start:[0,0],end:[1,1],invert:{value:!1,private:!0}},tiltShift={name:"tiltShift",uniforms:uniforms$h,fs:fs$l,dependencies:[_random$3.random],passes:[{sampler:!0,uniforms:{invert:!1}},{sampler:!0,uniforms:{invert:!0}}]};tiltshift.tiltShift=tiltShift;var triangleblur={};Object.defineProperty(triangleblur,"__esModule",{value:!0}),triangleblur.triangleBlur=void 0;var _random$2=random$1,fs$k="uniform float radius;\nuniform vec2 delta;\n\nvec4 triangleBlur_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 adjustedDelta = delta * radius / texSize;\n\n  vec4 color = vec4(0.0);\n  float total = 0.0;\n  float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n  for (float t = -30.0; t <= 30.0; t++) {\n    float percent = (t + offset - 0.5) / 30.0;\n    float weight = 1.0 - abs(percent);\n    vec4 sample = texture2D(texture, texCoord + adjustedDelta * percent);\n    sample.rgb *= sample.a;\n\n    color += sample * weight;\n    total += weight;\n  }\n\n  color = color / total;\n  color.rgb /= color.a + 0.00001;\n\n  return color;\n}\n",uniforms$g={radius:{value:20,min:0,softMax:100},delta:{value:[1,0],private:!0}},triangleBlur={name:"triangleBlur",uniforms:uniforms$g,fs:fs$k,dependencies:[_random$2.random],passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]};triangleblur.triangleBlur=triangleBlur;var zoomblur={};Object.defineProperty(zoomblur,"__esModule",{value:!0}),zoomblur.zoomBlur=void 0;var _random$1=random$1,fs$j="\nuniform vec2 center;\nuniform float strength;\n\nvec4 zoomBlur_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec4 color = vec4(0.0);\n  float total = 0.0;\n  vec2 toCenter = center * texSize - texCoord * texSize;\n  float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n  for (float t = 0.0; t <= 40.0; t++) {\n    float percent = (t + offset) / 40.0;\n    float weight = 4.0 * (percent - percent * percent);\n    vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\n    sample.rgb *= sample.a;\n\n    color += sample * weight;\n    total += weight;\n  }\n\n  color = color / total;\n  color.rgb /= color.a + 0.00001;\n\n  return color;\n}\n",uniforms$f={center:[.5,.5],strength:{value:.3,min:0,softMax:1}},zoomBlur={name:"zoomBlur",uniforms:uniforms$f,fs:fs$j,dependencies:[_random$1.random],passes:[{sampler:!0}]};zoomblur.zoomBlur=zoomBlur;var brightnesscontrast={};Object.defineProperty(brightnesscontrast,"__esModule",{value:!0}),brightnesscontrast.brightnessContrast=void 0;var fs$i="uniform float brightness;\nuniform float contrast;\n\nvec4 brightnessContrast_filterColor(vec4 color) {\n  color.rgb += brightness;\n  if (contrast > 0.0) {\n    color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\n  } else {\n    color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\n  }\n  return color;\n}\n\nvec4 brightnessContrast_filterColor(vec4 color, vec2 texSize, vec2 texCoords) {\n  return brightnessContrast_filterColor(color);\n}\n",uniforms$e={brightness:{value:0,min:-1,max:1},contrast:{value:0,min:-1,max:1}},brightnessContrast={name:"brightnessContrast",uniforms:uniforms$e,fs:fs$i,passes:[{filter:!0}]};brightnesscontrast.brightnessContrast=brightnessContrast;var denoise$1={};Object.defineProperty(denoise$1,"__esModule",{value:!0}),denoise$1.denoise=void 0;var fs$h="uniform float strength;\n\nvec4 denoise_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  float adjustedExponent = 3. + 200. * pow(1. - strength, 4.);\n\n  vec4 center = texture2D(texture, texCoord);\n  vec4 color = vec4(0.0);\n  float total = 0.0;\n  for (float x = -4.0; x <= 4.0; x += 1.0) {\n    for (float y = -4.0; y <= 4.0; y += 1.0) {\n      vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\n      float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\n      weight = pow(weight, adjustedExponent);\n      color += sample * weight;\n      total += weight;\n    }\n  }\n\n  return color / total;\n}\n",uniforms$d={strength:{value:.5,min:0,max:.1,adjust:function(e){return.53+200*Math.pow(1-e,4)}}},denoise={name:"denoise",uniforms:uniforms$d,fs:fs$h,passes:[{sampler:!0},{sampler:!0}]};denoise$1.denoise=denoise;var huesaturation={};Object.defineProperty(huesaturation,"__esModule",{value:!0}),huesaturation.hueSaturation=void 0;var fs$g="uniform float hue;\nuniform float saturation;\n\nvec4 hueSaturation_filterColor(vec4 color) {\n  float angle = hue * 3.14159265;\n  float s = sin(angle), c = cos(angle);\n  vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n  float len = length(color.rgb);\n  color.rgb = vec3(\n    dot(color.rgb, weights.xyz),\n    dot(color.rgb, weights.zxy),\n    dot(color.rgb, weights.yzx)\n  );\n  float average = (color.r + color.g + color.b) / 3.0;\n  if (saturation > 0.0) {\n    color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n  } else {\n    color.rgb += (average - color.rgb) * (-saturation);\n  }\n\n  return color;\n}\n\nvec4 hueSaturation_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  return hueSaturation_filterColor(color);\n}\n",uniforms$c={hue:{value:0,min:-1,max:1},saturation:{value:0,min:-1,max:1}},hueSaturation={name:"hueSaturation",uniforms:uniforms$c,fs:fs$g,passes:[{filter:!0}]};huesaturation.hueSaturation=hueSaturation;var noise$1={};Object.defineProperty(noise$1,"__esModule",{value:!0}),noise$1.noise=void 0;var fs$f="uniform float amount;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvec4 noise_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  return noise_filterColor(color, texCoord);\n}\n",uniforms$b={amount:{value:.5,min:0,max:1}},noise={name:"noise",uniforms:uniforms$b,fs:fs$f,passes:[{filter:!0}]};noise$1.noise=noise;var sepia$1={};Object.defineProperty(sepia$1,"__esModule",{value:!0}),sepia$1.sepia=void 0;var fs$e="uniform float amount;\n\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\n  color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\n  color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\n\n  return color;\n}\n\nvec4 sepia_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  return sepia_filterColor(color);\n}\n",uniforms$a={amount:{value:.5,min:0,max:1}},sepia={name:"sepia",uniforms:uniforms$a,fs:fs$e,passes:[{filter:!0}]};sepia$1.sepia=sepia;var vibrance$1={};Object.defineProperty(vibrance$1,"__esModule",{value:!0}),vibrance$1.vibrance=void 0;var fs$d="uniform float amount;\n\nvec4 vibrance_filterColor(vec4 color) {\n  float average = (color.r + color.g + color.b) / 3.0;\n  float mx = max(color.r, max(color.g, color.b));\n  float amt = (mx - average) * (-amount * 3.0);\n  color.rgb = mix(color.rgb, vec3(mx), amt);\n  return color;\n}\n\nvec4 vibrance_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  return vibrance_filterColor(color);\n}\n",uniforms$9={amount:{value:0,min:-1,max:1}},vibrance={name:"vibrance",uniforms:uniforms$9,fs:fs$d,passes:[{filter:!0}]};vibrance$1.vibrance=vibrance;var vignette$1={};Object.defineProperty(vignette$1,"__esModule",{value:!0}),vignette$1.vignette=void 0;var fs$c="uniform float radius;\nuniform float amount;\n\nvec4 vignette_filterColor(vec4 color, vec2 texCoord) {\n  float dist = distance(texCoord, vec2(0.5, 0.5));\n  float ratio = smoothstep(0.8, radius * 0.799, dist * (amount + radius));\n  return color.rgba * ratio + (1.0 - ratio)*vec4(0.0, 0.0, 0.0, 1.0);\n}\n\nvec4 vignette_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  return vignette_filterColor(color, texCoord);\n}\n",uniforms$8={radius:{value:.5,min:0,max:1},amount:{value:.5,min:0,max:1}},vignette={name:"vignette",fs:fs$c,uniforms:uniforms$8,passes:[{filter:!0}]};vignette$1.vignette=vignette;var colorhalftone={};Object.defineProperty(colorhalftone,"__esModule",{value:!0}),colorhalftone.colorHalftone=void 0;var fs$b="uniform vec2 center;\nuniform float angle;\nuniform float size;\n\nfloat scale = 3.1514 / size;\n\nfloat pattern(float angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(angle), c = cos(angle);\n  vec2 tex = texCoord * texSize - center * texSize;\n  vec2 point = vec2(\n\tc * tex.x - s * tex.y,\n\ts * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n\tcmy * 10.0 - 3.0 + vec3(\n    pattern(angle + 0.26179, texSize, texCoord),\n\t  pattern(angle + 1.30899, texSize, texCoord),\n    pattern(angle, texSize, texCoord)\n  ),\n\t0.0,\n\t1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n",uniforms$7={center:[.5,.5],angle:{value:1.1,softMin:0,softMax:Math.PI/2},size:{value:4,min:1,softMin:3,softMax:20}},colorHalftone={name:"colorHalftone",uniforms:uniforms$7,fs:fs$b,passes:[{filter:!0}]};colorhalftone.colorHalftone=colorHalftone;var dotscreen={};Object.defineProperty(dotscreen,"__esModule",{value:!0}),dotscreen.dotScreen=void 0;var fs$a="uniform vec2 center;\nuniform float angle;\nuniform float size;\n\nfloat pattern(vec2 texSize, vec2 texCoord) {\n  float scale = 3.1415 / size;\n\n  float s = sin(angle), c = cos(angle);\n  vec2 tex = texCoord * texSize - center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvec4 dotScreen_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  float average = (color.r + color.g + color.b) / 3.0;\n  return vec4(vec3(average * 10.0 - 5.0 + pattern(texSize, texCoord)), color.a);\n}\n",uniforms$6={center:[.5,.5],angle:{value:1.1,softMin:0,softMax:Math.PI/2},size:{value:3,min:1,softMin:3,softMax:20}},dotScreen={name:"dotScreen",uniforms:uniforms$6,fs:fs$a,passes:[{filter:!0}]};dotscreen.dotScreen=dotScreen;var edgework={};Object.defineProperty(edgework,"__esModule",{value:!0}),edgework.edgeWork=void 0;var _random=random$1,fs$9="uniform float radius;\nuniform vec2 delta;\n\nvec4 edgeWork_sampleColor1(sampler2D source, vec2 texSize, vec2 texCoord) {\n  vec2 relativeDelta = radius * delta / texSize;\n\n  vec2 color = vec2(0.0);\n  vec2 total = vec2(0.0);\n  float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n  for (float t = -30.0; t <= 30.0; t++) {\n    float percent = (t + offset - 0.5) / 30.0;\n    float weight = 1.0 - abs(percent);\n    vec3 sampleColor = texture2D(source, texCoord + relativeDelta * percent).rgb;\n    float average = (sampleColor.r + sampleColor.g + sampleColor.b) / 3.0;\n    color.x += average * weight;\n    total.x += weight;\n    if (abs(t) < 15.0) {\n      weight = weight * 2.0 - 1.0;\n      color.y += average * weight;\n      total.y += weight;\n    }\n  }\n  return vec4(color / total, 0.0, 1.0);\n}\n\nvec4 edgeWork_sampleColor2(sampler2D source, vec2 texSize, vec2 texCoord) {\n  vec2 relativeDelta = radius * delta / texSize;\n\n  vec2 color = vec2(0.0);\n  vec2 total = vec2(0.0);\n  float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n  for (float t = -30.0; t <= 30.0; t++) {\n    float percent = (t + offset - 0.5) / 30.0;\n    float weight = 1.0 - abs(percent);\n    vec2 sampleColor = texture2D(source, texCoord + relativeDelta * percent).xy;\n    color.x += sampleColor.x * weight;\n    total.x += weight;\n    if (abs(t) < 15.0) {\n      weight = weight * 2.0 - 1.0;\n      color.y += sampleColor.y * weight;\n      total.y += weight;\n    }\n  }\n  float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\n  return vec4(c, c, c, 1.0);\n}\n",uniforms$5={radius:{value:2,min:1,softMax:50},delta:{value:[1,0],private:!0}},edgeWork={name:"edgeWork",uniforms:uniforms$5,fs:fs$9,dependencies:[_random.random],passes:[{sampler:"edgeWork_sampleColor1",uniforms:{delta:[1,0]}},{sampler:"edgeWork_sampleColor2",uniforms:{delta:[0,1]}}]};edgework.edgeWork=edgeWork;var hexagonalpixelate={};Object.defineProperty(hexagonalpixelate,"__esModule",{value:!0}),hexagonalpixelate.hexagonalPixelate=void 0;var fs$8="uniform vec2 center;\nuniform float scale;\n\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - center * texSize) / scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= scale / texSize;\n\n  return texture2D(texture, choice + center);\n}\n",uniforms$4={center:{value:[.5,.5],hint:"screenspace"},scale:{value:10,min:1,softMin:5,softMax:50}},hexagonalPixelate={name:"hexagonalPixelate",uniforms:uniforms$4,fs:fs$8,passes:[{sampler:!0}]};hexagonalpixelate.hexagonalPixelate=hexagonalPixelate;var ink$1={};Object.defineProperty(ink$1,"__esModule",{value:!0}),ink$1.ink=void 0;var fs$7="uniform float strength;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = strength * strength * strength * strength * strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n",uniforms$3={strength:{value:.25,min:0,softMax:1}},ink={name:"ink",uniforms:uniforms$3,fs:fs$7,passes:[{sampler:!0}]};ink$1.ink=ink;var magnify$1={};Object.defineProperty(magnify$1,"__esModule",{value:!0}),magnify$1.magnify=void 0;var fs$6="uniform vec2 screenXY;\nuniform float radiusPixels;\nuniform float zoom;\nuniform float borderWidthPixels;\nuniform vec4 borderColor;\n\nvec4 magnify_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 pos = vec2(screenXY.x, 1.0 - screenXY.y);\n  float dist = distance(texCoord * texSize, pos * texSize);\n  if (dist < radiusPixels) {\n    return texture2D(texture, (texCoord - pos) / zoom + pos);\n  }\n\n  if (dist <= radiusPixels + borderWidthPixels) {\n    return borderColor;\n  }\n  return texture2D(texture, texCoord);\n}\n",uniforms$2={screenXY:[0,0],radiusPixels:200,zoom:2,borderWidthPixels:0,borderColor:[255,255,255,255]},magnify={name:"magnify",uniforms:uniforms$2,fs:fs$6,passes:[{sampler:!0}]};magnify$1.magnify=magnify;var bulgepinch={},warp$1={};Object.defineProperty(warp$1,"__esModule",{value:!0}),warp$1.warp=void 0;var fs$5="vec4 warp_sampleColor(sampler2D texture, vec2 texSize, vec2 coord) {\n  vec4 color = texture2D(texture, coord / texSize);\n  vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\n  if (coord != clampedCoord) {\n    color.a *= max(0.0, 1.0 - length(coord - clampedCoord));\n  }\n\n  return color;\n}\n",warp={name:"warp",fs:fs$5};warp$1.warp=warp,Object.defineProperty(bulgepinch,"__esModule",{value:!0}),bulgepinch.bulgePinch=void 0;var _warp$1=warp$1,fs$4="uniform float radius;\nuniform float strength;\nuniform vec2 center;\n\nvec2 bulgePinch_warp(vec2 coord, vec2 texCenter) {\n  coord -= texCenter;\n  float distance = length(coord);\n  if (distance < radius) {\n    float percent = distance / radius;\n    if (strength > 0.0) {\n      coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n    } else {\n      coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n    }\n  }\n  coord += texCenter;\n  return coord;\n}\n\nvec4 bulgePinch_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 coord = texCoord * texSize;\n  coord = bulgePinch_warp(coord, center * texSize);\n\n  return warp_sampleColor(texture, texSize, coord);\n}\n",uniforms$1={center:[.5,.5],radius:{value:200,min:1,softMax:600},strength:{value:.5,min:-1,max:1}},bulgePinch={name:"bulgePinch",fs:fs$4,uniforms:uniforms$1,dependencies:[_warp$1.warp],passes:[{sampler:!0}]};bulgepinch.bulgePinch=bulgePinch;var swirl$1={};Object.defineProperty(swirl$1,"__esModule",{value:!0}),swirl$1.swirl=void 0;var _warp=warp$1,fs$3="uniform float radius;\nuniform float angle;\nuniform vec2 center;\n\nvec2 swirl_warp(vec2 coord, vec2 texCenter) {\n  coord -= texCenter;\n  float distance = length(coord);\n  if (distance < radius) {\n    float percent = (radius - distance) / radius;\n    float theta = percent * percent * angle;\n    float s = sin(theta);\n    float c = cos(theta);\n    coord = vec2(\n      coord.x * c - coord.y * s,\n      coord.x * s + coord.y * c\n    );\n  }\n  coord += texCenter;\n  return coord;\n}\n\nvec4 swirl_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 coord = texCoord * texSize;\n  coord = swirl_warp(coord, center * texSize);\n\n  return warp_sampleColor(texture, texSize, coord);\n}\n",uniforms={center:[.5,.5],radius:{value:200,min:1,softMax:600},angle:{value:3,softMin:-25,softMax:25}},swirl={name:"swirl",fs:fs$3,uniforms:uniforms,dependencies:[_warp.warp],passes:[{sampler:!0}]};swirl$1.swirl=swirl;var fxaa$1={};Object.defineProperty(fxaa$1,"__esModule",{value:!0}),fxaa$1.fxaa=void 0;
/**
 * ORIGINAL LICENCE
 * @license
 * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *  * Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *  * Neither the name of NVIDIA CORPORATION nor the names of its
 *    contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var fs$2="\n#define FXAA_QUALITY_PRESET 29\n\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n\nFxaaFloat FxaaLuma_(FxaaFloat4 rgba) { return dot(rgba.rgb, vec3(0.2126, 0.7152, 0.0722)); }\n\nFxaaFloat4 FxaaPixelShader_(\n\n\n    FxaaFloat2 pos,\n\n\n\n\n    FxaaTex tex,\n\n\n\n\n    FxaaFloat2 fxaaQualityRcpFrame,\n\n\n\n\n\n\n\n\n\n\n    FxaaFloat fxaaQualitySubpix,\n\n\n\n\n\n\n\n\n\n    FxaaFloat fxaaQualityEdgeThreshold,\n\n\n\n\n\n\n\n\n\n\n\n\n\n    FxaaFloat fxaaQualityEdgeThresholdMin\n) {\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n    #define lumaM rgbyM.y\n    FxaaFloat lumaS = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaE = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaN = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaW = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n    if(earlyExit)\n        return rgbyM;\n    FxaaFloat lumaNW = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSE = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNE = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSW = FxaaLuma_(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP));\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma_(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma_(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n                    }\n                    #endif\n                }\n                #endif\n            }\n            #endif\n        }\n        #endif\n    }\n    #endif\n                        }\n                        #endif\n                    }\n                    #endif\n                }\n                #endif\n            }\n            #endif\n        }\n        #endif\n    }\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    return FxaaTexTop(tex, posM);\n}\n\nvec4 fxaa_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n    const float fxaa_QualitySubpix = 0.5;\n    const float fxaa_QualityEdgeThreshold = 0.125;\n    const float fxaa_QualityEdgeThresholdMin = 0.0833;\n\n    return FxaaPixelShader_(\n        texCoord,\n        texture,\n        vec2(1.0) / texSize,\n        fxaa_QualitySubpix,\n        fxaa_QualityEdgeThreshold,\n        fxaa_QualityEdgeThresholdMin\n    );\n}\n",fxaa={name:"fxaa",uniforms:{},fs:fs$2,passes:[{sampler:!0}]};fxaa$1.fxaa=fxaa;var transform$2={};Object.defineProperty(transform$2,"__esModule",{value:!0}),transform$2.transform=void 0;var vs$2="attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",transform$1={name:"transform",vs:vs$2,fs:null},hasRequiredProgramManager;function requireProgramManager(){if(hasRequiredProgramManager)return programManager;hasRequiredProgramManager=1;var e=interopRequireDefaultExports;Object.defineProperty(programManager,"__esModule",{value:!0}),programManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$8,i=es5$b;function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=function(){function e(r){(0,t.default)(this,e),this.gl=r,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return(0,r.default)(e,[{key:"addDefaultModule",value:function(e){this._defaultModules.find((function(t){return t.name===e.name}))||this._defaultModules.push(e),this.stateHash++}},{key:"removeDefaultModule",value:function(e){var t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((function(e){return e.name!==t})),this.stateHash++}},{key:"addShaderHook",value:function(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}},{key:"get",value:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.vs,s=void 0===o?"":o,l=r.fs,u=void 0===l?"":l,c=r.defines,d=void 0===c?{}:c,h=r.inject,f=void 0===h?{}:h,p=r.varyings,m=void 0===p?[]:p,g=r.bufferMode,_=void 0===g?35981:g,y=r.transpileToGLSL100,v=void 0!==y&&y,b=this._getModuleList(r.modules),x=this._getHash(s),T=this._getHash(u),w=b.map((function(e){return t._getHash(e.name)})).sort(),E=m.map((function(e){return t._getHash(e)})),A=Object.keys(d).sort(),S=Object.keys(f).sort(),P=[],M=[],R=a(A);try{for(R.s();!(e=R.n()).done;){var C=e.value;P.push(this._getHash(C)),P.push(this._getHash(d[C]))}}catch(e){R.e(e)}finally{R.f()}var O,L=a(S);try{for(L.s();!(O=L.n()).done;){var I=O.value;M.push(this._getHash(I)),M.push(this._getHash(f[I]))}}catch(e){L.e(e)}finally{L.f()}var D="".concat(x,"/").concat(T,"D").concat(P.join("/"),"M").concat(w.join("/"),"I").concat(M.join("/"),"V").concat(E.join("/"),"H").concat(this.stateHash,"B").concat(_).concat(v?"T":"");if(!this._programCache[D]){var k=(0,n.assembleShaders)(this.gl,{vs:s,fs:u,modules:b,inject:f,defines:d,hookFunctions:this._hookFunctions,transpileToGLSL100:v});this._programCache[D]=new i.Program(this.gl,{hash:D,vs:k.vs,fs:k.fs,varyings:m,bufferMode:_}),this._getUniforms[D]=k.getUniforms||function(e){},this._useCounts[D]=0}return this._useCounts[D]++,this._programCache[D]}},{key:"getUniforms",value:function(e){return this._getUniforms[e.hash]||null}},{key:"release",value:function(e){var t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}},{key:"_getHash",value:function(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},{key:"_getModuleList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Array(this._defaultModules.length+e.length),r={},n=0,i=0,a=this._defaultModules.length;i<a;++i){var o=this._defaultModules[i],s=o.name;t[n++]=o,r[s]=!0}for(var l=0,u=e.length;l<u;++l){var c=e[l],d=c.name;r[d]||(t[n++]=c,r[d]=!0)}return t.length=n,t}}],[{key:"getDefaultProgramManager",value:function(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new e(t),t.luma.defaultProgramManager}}]),e}();return programManager.default=s,programManager}transform$2.transform=transform$1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"_transform",{enumerable:!0,get:function(){return C.transform}}),Object.defineProperty(e,"_warp",{enumerable:!0,get:function(){return M.warp}}),Object.defineProperty(e,"brightnessContrast",{enumerable:!0,get:function(){return f.brightnessContrast}}),Object.defineProperty(e,"bulgePinch",{enumerable:!0,get:function(){return S.bulgePinch}}),Object.defineProperty(e,"colorHalftone",{enumerable:!0,get:function(){return b.colorHalftone}}),Object.defineProperty(e,"denoise",{enumerable:!0,get:function(){return p.denoise}}),Object.defineProperty(e,"dirlight",{enumerable:!0,get:function(){return o.dirlight}}),Object.defineProperty(e,"dotScreen",{enumerable:!0,get:function(){return x.dotScreen}}),Object.defineProperty(e,"edgeWork",{enumerable:!0,get:function(){return T.edgeWork}}),Object.defineProperty(e,"fp32",{enumerable:!0,get:function(){return r.fp32}}),Object.defineProperty(e,"fp64",{enumerable:!0,get:function(){return n.fp64}}),Object.defineProperty(e,"fp64arithmetic",{enumerable:!0,get:function(){return n.fp64arithmetic}}),Object.defineProperty(e,"fxaa",{enumerable:!0,get:function(){return R.fxaa}}),Object.defineProperty(e,"gouraudLighting",{enumerable:!0,get:function(){return l.gouraudLighting}}),Object.defineProperty(e,"hexagonalPixelate",{enumerable:!0,get:function(){return w.hexagonalPixelate}}),Object.defineProperty(e,"hueSaturation",{enumerable:!0,get:function(){return m.hueSaturation}}),Object.defineProperty(e,"ink",{enumerable:!0,get:function(){return E.ink}}),Object.defineProperty(e,"lights",{enumerable:!0,get:function(){return a.lights}}),Object.defineProperty(e,"magnify",{enumerable:!0,get:function(){return A.magnify}}),Object.defineProperty(e,"noise",{enumerable:!0,get:function(){return g.noise}}),Object.defineProperty(e,"pbr",{enumerable:!0,get:function(){return u.pbr}}),Object.defineProperty(e,"phongLighting",{enumerable:!0,get:function(){return l.phongLighting}}),Object.defineProperty(e,"picking",{enumerable:!0,get:function(){return s.picking}}),Object.defineProperty(e,"project",{enumerable:!0,get:function(){return i.project}}),Object.defineProperty(e,"random",{enumerable:!0,get:function(){return t.random}}),Object.defineProperty(e,"sepia",{enumerable:!0,get:function(){return _.sepia}}),Object.defineProperty(e,"swirl",{enumerable:!0,get:function(){return P.swirl}}),Object.defineProperty(e,"tiltShift",{enumerable:!0,get:function(){return c.tiltShift}}),Object.defineProperty(e,"triangleBlur",{enumerable:!0,get:function(){return d.triangleBlur}}),Object.defineProperty(e,"vibrance",{enumerable:!0,get:function(){return y.vibrance}}),Object.defineProperty(e,"vignette",{enumerable:!0,get:function(){return v.vignette}}),Object.defineProperty(e,"zoomBlur",{enumerable:!0,get:function(){return h.zoomBlur}});var t=random$1,r=fp32$1,n=fp64,i=project$2,a=lights$1,o=dirlight$1,s=picking$2,l=phongLighting$1,u=pbr$1,c=tiltshift,d=triangleblur,h=zoomblur,f=brightnesscontrast,p=denoise$1,m=huesaturation,g=noise$1,_=sepia$1,y=vibrance$1,v=vignette$1,b=colorhalftone,x=dotscreen,T=edgework,w=hexagonalpixelate,E=ink$1,A=magnify$1,S=bulgepinch,P=swirl$1,M=warp$1,R=fxaa$1,C=transform$2}(modules),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t={assembleShaders:!0,combineInjects:!0,normalizeShaderModule:!0,getQualifierDetails:!0,getPassthroughFS:!0,typeToChannelSuffix:!0,typeToChannelCount:!0,convertToVec4:!0};Object.defineProperty(e,"assembleShaders",{enumerable:!0,get:function(){return r.assembleShaders}}),Object.defineProperty(e,"combineInjects",{enumerable:!0,get:function(){return n.combineInjects}}),Object.defineProperty(e,"convertToVec4",{enumerable:!0,get:function(){return a.convertToVec4}}),Object.defineProperty(e,"getPassthroughFS",{enumerable:!0,get:function(){return a.getPassthroughFS}}),Object.defineProperty(e,"getQualifierDetails",{enumerable:!0,get:function(){return a.getQualifierDetails}}),Object.defineProperty(e,"normalizeShaderModule",{enumerable:!0,get:function(){return i.normalizeShaderModule}}),Object.defineProperty(e,"typeToChannelCount",{enumerable:!0,get:function(){return a.typeToChannelCount}}),Object.defineProperty(e,"typeToChannelSuffix",{enumerable:!0,get:function(){return a.typeToChannelSuffix}});var r=assembleShaders$1,n=injectShader$1,i=shaderModule,a=shaderUtils,o=modules;Object.keys(o).forEach((function(r){"default"!==r&&"__esModule"!==r&&(Object.prototype.hasOwnProperty.call(t,r)||r in e&&e[r]===o[r]||Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[r]}}))}))}(es5$8);var modelUtils={},hasRequiredModelUtils,hasRequiredModel;function requireModelUtils(){if(hasRequiredModelUtils)return modelUtils;hasRequiredModelUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(modelUtils,"__esModule",{value:!0}),modelUtils.getBuffersFromGeometry=function(e,t,n){var a={},l=t.indices;for(var u in t.attributes){var c=t.attributes[u],d=o(u,n);if("indices"===u)l=c;else if(c.constant)a[d]=c.value;else{var h=c.value,f=i({},c);delete f.value,a[d]=[new r.Buffer(e,h),f],s(u,f)}}if(l){var p=l.value||l;(0,r.assert)(p instanceof Uint16Array||p instanceof Uint32Array,'attribute array for "indices" must be of integer type');var m={size:1,isIndexed:void 0===l.isIndexed||l.isIndexed};a.indices=[new r.Buffer(e,{data:p,target:34963}),m]}return a},modelUtils.inferAttributeAccessor=s;var t=e(requireDefineProperty()),r=es5$b;function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var a={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function o(e,t){var r=(t||{}).attributeMap,n=void 0===r?a:r;return n&&n[e]||e}function s(e,t){var n;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}(0,r.assert)(Number.isFinite(t.size),"attribute ".concat(e," needs size"))}return modelUtils}function requireModel(){if(hasRequiredModel)return model;hasRequiredModel=1;var e=interopRequireDefaultExports;Object.defineProperty(model,"__esModule",{value:!0}),model.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=es5$c,a=e(requireProgramManager()),o=es5$b,s=requireModelUtils(),l=function(){},u={},c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.default)(this,e);var a=n.id,s=void 0===a?(0,o.uid)("model"):a;(0,o.assert)((0,i.isWebGL)(t)),this.id=s,this.gl=t,this.id=n.id||(0,o.uid)("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}return(0,n.default)(e,[{key:"initialize",value:function(e){this.props={},this.programManager=e.programManager||a.default.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var t=e.program;this.programProps={program:void 0===t?null:t,vs:e.vs,fs:e.fs,modules:e.modules,defines:e.defines,inject:e.inject,varyings:e.varyings,bufferMode:e.bufferMode,transpileToGLSL100:e.transpileToGLSL100},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},(0,o.assert)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(e){this._setModelProps(e)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(e){this.programProps={program:e.program,vs:e.vs,fs:e.fs,modules:e.modules,defines:e.defines,inject:e.inject,varyings:e.varyings,bufferMode:e.bufferMode,transpileToGLSL100:e.transpileToGLSL100},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(e){return this.drawMode=e,this}},{key:"setVertexCount",value:function(e){return(0,o.assert)(Number.isFinite(e)),this.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return(0,o.assert)(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=(0,s.getBuffersFromGeometry)(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,o.isObjectEmpty)(e))return this;var t={};for(var r in e){var n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}},{key:"setUniforms",value:function(){return Object.assign(this.uniforms,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this}},{key:"getModuleUniforms",value:function(e){this._checkProgram();var t=this.programManager.getUniforms(this.program);return t?t(e):{}}},{key:"updateModuleSettings",value:function(e){var t=this.getModuleUniforms(e||{});return this.setUniforms(t)}},{key:"clear",value:function(e){return(0,o.clear)(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();var t,r=e.moduleSettings,n=void 0===r?null:r,i=e.framebuffer,a=e.uniforms,s=void 0===a?{}:a,c=e.attributes,d=e.transformFeedback,h=void 0===d?this.transformFeedback:d,f=e.parameters,p=void 0===f?{}:f,m=e.vertexArray,g=void 0===m?this.vertexArray:m;this.setAttributes(void 0===c?{}:c),this.updateModuleSettings(n),this.setUniforms(s),o.log.priority>=2&&(t=this._logDrawCallStart(2));var _=this.vertexArray.getDrawParams(),y=this.props,v=y.isIndexed,b=void 0===v?_.isIndexed:v,x=y.indexType,T=void 0===x?_.indexType:x,w=y.indexOffset,E=void 0===w?_.indexOffset:w,A=y.vertexArrayInstanced;(void 0===A?_.isInstanced:A)&&!this.isInstanced&&o.log.warn("Found instanced attributes on non-instanced model",this.id)();var S=this.isInstanced,P=this.instanceCount,M=this.props,R=M.onBeforeRender,C=M.onAfterRender,O=void 0===C?l:C;(void 0===R?l:R)(),this.program.setUniforms(this.uniforms);var L=this.program.draw(Object.assign(u,e,{logPriority:t,uniforms:null,framebuffer:i,parameters:p,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:h,isIndexed:b,indexType:T,isInstanced:S,instanceCount:P,offset:b?E:0}));return O(),o.log.priority>=2&&this._logDrawCallEnd(t,g,i),L}},{key:"transform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.discard,n=void 0===r||r,i=e.feedbackBuffers,a=e.unbindModels,o=void 0===a?[]:a,s=e.parameters;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,(0,t.default)({},35977,n))),o.forEach((function(e){return e.vertexArray.unbindBuffers()}));try{this.draw(Object.assign({},e,{parameters:s}))}finally{o.forEach((function(e){return e.vertexArray.bindBuffers()}))}return this}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.log.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}},{key:"_setModelProps",value:function(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}},{key:"_checkProgram",value:function(){if(this._programDirty||this.programManager.stateHash!==this._programManagerState){var e=this.programProps.program;if(e)this._managedProgram=!1;else{var t=this.programProps;e=this.programManager.get({vs:t.vs,fs:t.fs,modules:t.modules,inject:t.inject,defines:t.defines,varyings:t.varyings,bufferMode:t.bufferMode,transpileToGLSL100:t.transpileToGLSL100}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}(0,o.assert)(e instanceof o.Program,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new o.VertexArray(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var e in this.geometryBuffers){var t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof o.Buffer&&t.delete()}}},{key:"_setAnimationProps",value:function(e){this.animated&&(0,o.assert)(e,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.isObjectEmpty)(e)||(this.transformFeedback=this.transformFeedback||new o.TransformFeedback(this.program.gl,{program:this.program}),this.transformFeedback.setBuffers(e)),this}},{key:"_logDrawCallStart",value:function(e){var t=e>3?0:1e4;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),o.log.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:o.log.level<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,t,r,n){if(void 0!==e){var i=(0,o.getDebugTableForVertexArray)({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),a=(0,o.getDebugTableForUniforms)({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),s=a.table,l=a.unusedTable,u=a.unusedCount,c=(0,o.getDebugTableForUniforms)({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});c.count>0&&o.log.log("MISSING UNIFORMS",Object.keys(c.table))(),u>0&&o.log.log("UNUSED UNIFORMS",Object.keys(l))();var d=(0,o.getDebugTableForProgramConfiguration)(this.vertexArray.configuration);o.log.table(e,i)(),o.log.table(e,s)(),o.log.table(e+1,d)(),n&&n.log({logLevel:2,message:"Rendered to ".concat(n.id)}),o.log.groupEnd(2)()}}}]),e}();return model.default=c,model}var transform={},bufferTransform={},hasRequiredBufferTransform;function requireBufferTransform(){if(hasRequiredBufferTransform)return bufferTransform;hasRequiredBufferTransform=1;var e=interopRequireDefaultExports;Object.defineProperty(bufferTransform,"__esModule",{value:!0}),bufferTransform.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$c,i=es5$b;function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),this.gl=r,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}return(0,r.default)(e,[{key:"setupResources",value:function(e){var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(this.bindings);try{for(r.s();!(t=r.n()).done;)this._setupTransformFeedback(t.value,e)}catch(e){r.e(e)}finally{r.f()}}},{key:"updateModelProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.varyings;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}},{key:"getDrawOptions",value:function(){var e=this.bindings[this.currentIndex],t=e.transformFeedback;return{attributes:Object.assign({},e.sourceBuffers,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).attributes),transformFeedback:t}}},{key:"swap",value:function(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){this._setupBuffers(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getBuffer",value:function(e){var t=e?this.bindings[this.currentIndex].feedbackBuffers[e]:null;return t?t instanceof i.Buffer?t:t.buffer:null}},{key:"getData",value:function(){var e=this.getBuffer((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).varyingName);return e?e.getData():null}},{key:"delete",value:function(){for(var e in this.resources)this.resources[e].delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&(0,i.assert)((0,n.isWebGL2)(this.gl))}},{key:"_getFeedbackBuffers",value:function(e){var t=e.sourceBuffers,r=void 0===t?{}:t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var i in this.feedbackMap)i in r&&(n[this.feedbackMap[i]]=i);for(var a in Object.assign(n,e.feedbackBuffers),n){var o=n[a];if("string"==typeof o){var s=r[o];n[a]=this._createNewBuffer(a,{byteLength:s.byteLength,usage:s.usage,accessor:s.accessor})}}return n}},{key:"_setupBuffers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sourceBuffers,r=void 0===t?null:t;Object.assign(this.feedbackMap,e.feedbackMap);var n=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:r,feedbackBuffers:n})}},{key:"_setupTransformFeedback",value:function(e,t){e.transformFeedback=new i.TransformFeedback(this.gl,{program:t.model.program,buffers:e.feedbackBuffers})}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var t=this._swapBuffers(this.bindings[this.currentIndex]),r=t.sourceBuffers,n=t.feedbackBuffers,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:r,feedbackBuffers:n})}}},{key:"_updateBinding",value:function(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}},{key:"_swapBuffers",value:function(e){if(!this.feedbackMap)return null;var t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(var n in this.feedbackMap){var a=this.feedbackMap[n];t[n]=e.feedbackBuffers[a],r[a]=e.sourceBuffers[n],(0,i.assert)(r[a]instanceof i.Buffer)}return{sourceBuffers:t,feedbackBuffers:r}}},{key:"_createNewBuffer",value:function(e,t){var r=new i.Buffer(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),e}();return bufferTransform.default=o,bufferTransform}var textureTransform={},transformShaderUtils={},hasRequiredTransformShaderUtils,hasRequiredTextureTransform,hasRequiredTransform;function requireTransformShaderUtils(){if(hasRequiredTransformShaderUtils)return transformShaderUtils;hasRequiredTransformShaderUtils=1,Object.defineProperty(transformShaderUtils,"__esModule",{value:!0}),transformShaderUtils.getSizeUniforms=function(e){var t,r,i=e.sourceTextureMap,a=e.targetTextureVarying,o=e.targetTexture,s={};for(var l in a&&(t=o.width,r=o.height,s["".concat(n).concat(a)]=[t,r]),i){var u=i[l];t=u.width,r=u.height,s["".concat(n).concat(l)]=[t,r]}return s},transformShaderUtils.getVaryingType=a,transformShaderUtils.processAttributeDefinition=o,transformShaderUtils.updateForTextures=function(r){var s=r.vs,l=r.sourceTextureMap,u=r.targetTextureVarying,c=r.targetTexture,d=Object.keys(l).length,h=null,f={},p=s,m={};if(d>0||u){var g=p.split("\n"),_=g.slice();if(g.forEach((function(e,r,n){if(d>0){var i=o(e,l);if(i){var s=i.inject;_[r]=i.updatedLine,m=(0,t.combineInjects)([m,s]),Object.assign(f,i.samplerTextureMap),d--}}u&&!h&&(h=a(e,u))})),u){(0,e.assert)(c);var y="".concat(n).concat(u),v="uniform vec2 ".concat(y,";\n"),b="     vec2 ".concat(i," = transform_getPos(").concat(y,");\n     gl_Position = vec4(").concat(i,", 0, 1.);\n");m=(0,t.combineInjects)([m,{"vs:#decl":v,"vs:#main-start":b}])}p=_.join("\n")}return{vs:p,targetTextureType:h,inject:m,samplerTextureMap:f}};var e=es5$b,t=es5$8,r="transform_uSampler_",n="transform_uSize_",i="transform_position";function a(e,r){var n=(0,t.getQualifierDetails)(e,["varying","out"]);return n&&n.name===r?n.type:null}function o(e,i){var a={},o=function(e){return(0,t.getQualifierDetails)(e,["attribute","in"])}(e);if(!o)return null;var s=o.type,l=o.name;if(l&&i[l]){var u="// ".concat(e," => Replaced by Transform with a sampler"),c=function(e){var t="".concat(r).concat(e),i="".concat(n).concat(e);return{samplerName:t,sizeName:i,uniformDeclerations:"  uniform sampler2D ".concat(t,";\n  uniform vec2 ").concat(i,";")}}(l),d=c.samplerName,h=c.sizeName,f=c.uniformDeclerations,p=(0,t.typeToChannelSuffix)(s),m="  ".concat(s," ").concat(l," = transform_getInput(").concat(d,", ").concat(h,").").concat(p,";\n");return a[d]=l,{updatedLine:u,inject:{"vs:#decl":f,"vs:#main-start":m},samplerTextureMap:a}}return null}return transformShaderUtils}function requireTextureTransform(){if(hasRequiredTextureTransform)return textureTransform;hasRequiredTextureTransform=1;var e=interopRequireDefaultExports;Object.defineProperty(textureTransform,"__esModule",{value:!0}),textureTransform.default=void 0;var t,r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=es5$b,o=es5$8,s=requireTransformShaderUtils(),l=((0,i.default)(t={},10241,9728),(0,i.default)(t,10240,9728),(0,i.default)(t,10242,33071),(0,i.default)(t,10243,33071),t),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.default)(this,e),this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}return(0,n.default)(e,[{key:"updateModelProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._processVertexShader(e);return Object.assign({},e,t)}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.bindings[this.currentIndex],r=t.sourceTextures,n=t.framebuffer,i=t.targetTexture,a=Object.assign({},t.sourceBuffers,e.attributes),o=Object.assign({},e.uniforms),l=Object.assign({},e.parameters),u=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){for(var c in a.transform_elementID=this.elementIDBuffer,this.samplerTextureMap)o[c]=r[this.samplerTextureMap[c]];this._setSourceTextureParameters();var d=(0,s.getSizeUniforms)({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(o,d)}return this.hasTargetTexture&&(u=!1,l.viewport=[0,0,n.width,n.height]),{attributes:a,framebuffer:n,uniforms:o,discard:u,parameters:l}}},{key:"swap",value:function(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){this._setupTextures(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getTargetTexture",value:function(){return this.bindings[this.currentIndex].targetTexture}},{key:"getData",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).packed,t=void 0!==e&&e,r=(0,a.readPixelsToArray)(this.bindings[this.currentIndex].framebuffer);if(!t)return r;for(var n=r.constructor,i=(0,o.typeToChannelCount)(this.targetTextureType),s=new n(r.length*i/4),l=0,u=0;u<r.length;u+=4)for(var c=0;c<i;c++)s[l++]=r[u+c];return s}},{key:"getFramebuffer",value:function(){return this.bindings[this.currentIndex].framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e._targetTextureVarying;this._swapTexture=e._swapTexture,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}},{key:"_createTargetTexture",value:function(e){var t=e.textureOrReference;if(t instanceof a.Texture2D)return t;var r=e.sourceTextures[t];return r?(this._targetRefTexName=t,this._createNewTexture(r)):null}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sourceBuffers,r=e._sourceTextures,n=void 0===r?{}:r,i=this._createTargetTexture({sourceTextures:n,textureOrReference:e._targetTexture});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:n,targetTexture:i}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}},{key:"_updateElementIDBuffer",value:function(e){if(!("number"!=typeof e||this.elementCount>=e)){var t=new Float32Array(e);t.forEach((function(e,t,r){r[t]=t})),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new a.Buffer(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var t=this._swapTextures(this.bindings[this.currentIndex]),r=t.sourceTextures,n=t.targetTexture,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:r,targetTexture:n})}}},{key:"_updateBinding",value:function(e,t){var r=t.sourceBuffers,n=t.targetTexture;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,t.sourceTextures),Object.assign(e.sourceBuffers,r),n){e.targetTexture=n;var o=n.width,s=n.height,l=e.framebuffer;l?(l.update({attachments:(0,i.default)({},36064,n),resizeAttachments:!1}),l.resize({width:o,height:s})):e.framebuffer=new a.Framebuffer(this.gl,{id:"transform-framebuffer",width:o,height:s,attachments:(0,i.default)({},36064,n)})}return e}},{key:"_setSourceTextureParameters",value:function(){var e=this.bindings[this.currentIndex].sourceTextures;for(var t in e)e[t].setParameters(l)}},{key:"_swapTextures",value:function(e){if(!this._swapTexture)return null;var t=Object.assign({},e.sourceTextures);return t[this._swapTexture]=e.targetTexture,{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}},{key:"_createNewTexture",value:function(e){var t,r=(0,a.cloneTextureFrom)(e,{parameters:(t={},(0,i.default)(t,10241,9728),(0,i.default)(t,10240,9728),(0,i.default)(t,10242,33071),(0,i.default)(t,10243,33071),t),pixelStore:(0,i.default)({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=r,r}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.bindings[this.currentIndex],r=(0,s.updateForTextures)({vs:e.vs,sourceTextureMap:t.sourceTextures,targetTextureVarying:this.targetTextureVarying,targetTexture:t.targetTexture}),n=r.vs,i=r.uniforms,l=r.targetTextureType,u=r.samplerTextureMap,c=(0,o.combineInjects)([e.inject||{},r.inject]);return this.targetTextureType=l,this.samplerTextureMap=u,{vs:n,fs:e._fs||(0,o.getPassthroughFS)({version:(0,a.getShaderVersion)(n),input:this.targetTextureVarying,inputType:l,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[o._transform].concat(e.modules||[]):e.modules,uniforms:i,inject:c}}}]),e}();return textureTransform.default=u,textureTransform}function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1;var e=interopRequireDefaultExports;Object.defineProperty(transform,"__esModule",{value:!0}),transform.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$8,i=e(requireBufferTransform()),a=e(requireTextureTransform()),o=es5$c,s=es5$b,l=e(requireModel());function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),this.gl=r,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}return(0,r.default)(e,[{key:"delete",value:function(){var e=this.model,t=this.bufferTransform,r=this.textureTransform;e&&e.delete(),t&&t.delete(),r&&r.delete()}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.clearRenderTarget,r=void 0===t||t,n=this._updateDrawOptions(e);r&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}},{key:"swap",value:function(){var e,t=!1,r=u([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(e=r.n()).done;)t=t||e.value.swap()}catch(e){r.e(e)}finally{r.f()}(0,s.assert)(t,"Nothing to swap")}},{key:"getBuffer",value:function(){return this.bufferTransform&&this.bufferTransform.getBuffer(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}},{key:"getData",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=u([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(e=r.n()).done;){var n=e.value.getData(t);if(n)return n}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);var t,r=u([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(t=r.n()).done;)t.value.update(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"_initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.gl;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new l.default(t,Object.assign({},e,{fs:e.fs||(0,n.getPassthroughFS)({version:(0,s.getShaderVersion)(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(e){var t,r=Object.assign({},e),n=u([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(n.s();!(t=n.n()).done;)r=t.value.updateModelProps(r)}catch(e){n.e(e)}finally{n.f()}return r}},{key:"_buildResourceTransforms",value:function(e,t){(function(e){return!((0,s.isObjectEmpty)(e.feedbackBuffers)&&(0,s.isObjectEmpty)(e.feedbackMap)&&!(e.varyings&&e.varyings.length>0))})(t)&&(this.bufferTransform=new i.default(e,t)),function(e){return!((0,s.isObjectEmpty)(e._sourceTextures)&&!e._targetTexture&&!e._targetTextureVarying)}(t)&&(this.textureTransform=new a.default(e,t)),(0,s.assert)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(e){var t,r=Object.assign({},e),n=u([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(n.s();!(t=n.n()).done;)r=Object.assign(r,t.value.getDrawOptions(r))}catch(e){n.e(e)}finally{n.f()}return r}}],[{key:"isSupported",value:function(e){return(0,o.isWebGL2)(e)}}]),e}();return transform.default=d,transform}var geometry$1={},hasRequiredGeometry$1;function requireGeometry$1(){if(hasRequiredGeometry$1)return geometry$1;hasRequiredGeometry$1=1;var e=interopRequireDefaultExports;Object.defineProperty(geometry$1,"__esModule",{value:!0}),geometry$1.default=geometry$1.DRAW_MODE=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=es5$b;function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var o={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};geometry$1.DRAW_MODE=o;var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,e);var n=t.id,a=void 0===n?(0,i.uid)("geometry"):n,s=t.drawMode,l=void 0===s?o.TRIANGLES:s,u=t.attributes,c=void 0===u?{}:u,d=t.indices,h=void 0===d?null:d,f=t.vertexCount,p=void 0===f?null:f;this.id=a,this.drawMode=0|l,this.attributes={},this.userData={},this._setAttributes(c,h),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}return(0,n.default)(e,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}},{key:"_setAttributes",value:function(e,t){for(var r in t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t),e){var n=e[r];n=ArrayBuffer.isView(n)?{value:n}:n,(0,i.assert)(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),"POSITION"!==r&&"positions"!==r||n.size||(n.size=3),"indices"===r?((0,i.assert)(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(e,t){if(t)return t.value.length;var r=1/0;for(var n in e){var a=e[n],o=a.value,s=a.size;!a.constant&&o&&s>=1&&(r=Math.min(r,o.length/s))}return(0,i.assert)(Number.isFinite(r)),r}}],[{key:"DRAW_MODE",get:function(){return o}}]),e}();return geometry$1.default=s,geometry$1}var coneGeometry={},truncatedConeGeometry={},hasRequiredTruncatedConeGeometry,hasRequiredConeGeometry;function requireTruncatedConeGeometry(){if(hasRequiredTruncatedConeGeometry)return truncatedConeGeometry;hasRequiredTruncatedConeGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(truncatedConeGeometry,"__esModule",{value:!0}),truncatedConeGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireGeometry$1()),l=es5$b;function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={x:[2,0,1],y:[0,1,2],z:[1,2,0]},h=function(e){(0,i.default)(h,e);var t,s,u=(t=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,h);var t=e.id,r=void 0===t?(0,l.uid)("truncated-code-geometry"):t,i=function(e){for(var t=e.bottomRadius,r=void 0===t?0:t,n=e.topRadius,i=void 0===n?0:n,a=e.height,o=void 0===a?1:a,s=e.nradial,l=void 0===s?10:s,u=e.nvertical,c=void 0===u?10:u,h=e.verticalAxis,f=void 0===h?"y":h,p=e.topCap,m=void 0!==p&&p,g=e.bottomCap,_=void 0!==g&&g,y=(m?2:0)+(_?2:0),v=(l+1)*(c+1+y),b=Math.atan2(r-i,o),x=Math.sin,T=Math.cos,w=Math.PI,E=T(b),A=x(b),S=m?-2:0,P=c+(_?2:0),M=l+1,R=new Uint16Array(l*(c+y)*6),C=d[f],O=new Float32Array(3*v),L=new Float32Array(3*v),I=new Float32Array(2*v),D=0,k=0,B=S;B<=P;B++){var F=B/c,N=o*F,q=void 0;B<0?(N=0,F=1,q=r):B>c?(N=o,F=1,q=i):q=r+B/c*(i-r),-2!==B&&B!==c+2||(q=0,F=0),N-=o/2;for(var U=0;U<M;U++){var j=x(U*w*2/l),G=T(U*w*2/l);O[D+C[0]]=j*q,O[D+C[1]]=N,O[D+C[2]]=G*q,L[D+C[0]]=B<0||B>c?0:j*E,L[D+C[1]]=B<0?-1:B>c?1:A,L[D+C[2]]=B<0||B>c?0:G*E,I[k+0]=U/l,I[k+1]=F,k+=2,D+=3}}for(var z=0;z<c+y;z++)for(var V=0;V<l;V++){var $=6*(z*l+V);R[$+0]=M*(z+0)+0+V,R[$+1]=M*(z+0)+1+V,R[$+2]=M*(z+1)+1+V,R[$+3]=M*(z+0)+0+V,R[$+4]=M*(z+1)+1+V,R[$+5]=M*(z+1)+0+V}return{indices:R,attributes:{POSITION:{size:3,value:O},NORMAL:{size:3,value:L},TEXCOORD_0:{size:2,value:I}}}}(e),a=i.indices,o=i.attributes;return u.call(this,c(c({},e),{},{id:r,indices:a,attributes:c(c({},o),e.attributes)}))}return(0,r.default)(h)}(s.default);return truncatedConeGeometry.default=h,truncatedConeGeometry}function requireConeGeometry(){if(hasRequiredConeGeometry)return coneGeometry;hasRequiredConeGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(coneGeometry,"__esModule",{value:!0}),coneGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireTruncatedConeGeometry()),l=es5$b;function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(e){(0,i.default)(d,e);var t,s,u=(t=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,d);var t=e.id,r=void 0===t?(0,l.uid)("cone-geometry"):t,i=e.radius,a=void 0===i?1:i,o=e.cap,s=void 0===o||o;return u.call(this,c(c({},e),{},{id:r,topRadius:0,topCap:Boolean(s),bottomCap:Boolean(s),bottomRadius:a}))}return(0,r.default)(d)}(s.default);return coneGeometry.default=d,coneGeometry}var cubeGeometry={},hasRequiredCubeGeometry;function requireCubeGeometry(){if(hasRequiredCubeGeometry)return cubeGeometry;hasRequiredCubeGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(cubeGeometry,"__esModule",{value:!0}),cubeGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireGeometry$1()),l=es5$b;function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),h=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),f=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),p=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),m={POSITION:{size:3,value:new Float32Array(h)},NORMAL:{size:3,value:new Float32Array(f)},TEXCOORD_0:{size:2,value:new Float32Array(p)}},g=function(e){(0,i.default)(h,e);var t,s,u=(t=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,h);var t=e.id,r=void 0===t?(0,l.uid)("cube-geometry"):t;return u.call(this,c(c({},e),{},{id:r,indices:{size:1,value:new Uint16Array(d)},attributes:c(c({},m),e.attributes)}))}return(0,r.default)(h)}(s.default);return cubeGeometry.default=g,cubeGeometry}var cylinderGeometry={},hasRequiredCylinderGeometry;function requireCylinderGeometry(){if(hasRequiredCylinderGeometry)return cylinderGeometry;hasRequiredCylinderGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(cylinderGeometry,"__esModule",{value:!0}),cylinderGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireTruncatedConeGeometry()),l=es5$b;function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(e){(0,i.default)(d,e);var t,s,u=(t=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,d);var t=e.id,r=void 0===t?(0,l.uid)("cylinder-geometry"):t,i=e.radius,a=void 0===i?1:i;return u.call(this,c(c({},e),{},{id:r,bottomRadius:a,topRadius:a}))}return(0,r.default)(d)}(s.default);return cylinderGeometry.default=d,cylinderGeometry}var icoSphereGeometry={},hasRequiredIcoSphereGeometry;function requireIcoSphereGeometry(){if(hasRequiredIcoSphereGeometry)return icoSphereGeometry;hasRequiredIcoSphereGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(icoSphereGeometry,"__esModule",{value:!0}),icoSphereGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$q,l=e(requireGeometry$1()),u=es5$b;function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?c(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],f=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],p=function(e){(0,i.default)(p,e);var t,l,c=(t=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(l){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,p);var t=e.id,r=void 0===t?(0,u.uid)("ico-sphere-geometry"):t,i=function(e){var t=e.iterations,r=void 0===t?0:t,n=Math.PI,i=2*n,a=[].concat(h),o=[].concat(f);a.push(),o.push();for(var l=function(){var e={};return function(t,r){var n=(t*=3)>(r*=3)?t:r,i="".concat(t<r?t:r,"|").concat(n);if(i in e)return e[i];var o=(a[t]+a[r])/2,s=(a[t+1]+a[r+1])/2,l=(a[t+2]+a[r+2])/2,u=Math.sqrt(o*o+s*s+l*l);return a.push(o/=u,s/=u,l/=u),e[i]=a.length/3-1}}(),u=0;u<r;u++){for(var c=[],d=0;d<o.length;d+=3){var p=l(o[d+0],o[d+1]),m=l(o[d+1],o[d+2]),g=l(o[d+2],o[d+0]);c.push(g,o[d+0],p,p,o[d+1],m,m,o[d+2],g,p,m,g)}o=c}for(var _=new Array(a.length),y=new Array(a.length/3*2),v=o.length-3;v>=0;v-=3){var b=o[v+0],x=o[v+1],T=o[v+2],w=3*b,E=3*x,A=3*T,S=2*b,P=2*x,M=2*T,R=a[w+0],C=a[w+1],O=a[w+2],L=Math.acos(O/Math.sqrt(R*R+C*C+O*O))/n,I=1-(Math.atan2(C,R)+n)/i,D=a[E+0],k=a[E+1],B=a[E+2],F=Math.acos(B/Math.sqrt(D*D+k*k+B*B))/n,N=1-(Math.atan2(k,D)+n)/i,q=a[A+0],U=a[A+1],j=a[A+2],G=Math.acos(j/Math.sqrt(q*q+U*U+j*j))/n,z=1-(Math.atan2(U,q)+n)/i,V=[R-D,C-k,O-B],$=new s.Vector3([q-D,U-k,j-B]).cross(V).normalize(),H=void 0;(0===I||0===N||0===z)&&(0===I||I>.5)&&(0===N||N>.5)&&(0===z||z>.5)&&(a.push(a[w+0],a[w+1],a[w+2]),o.push(H=a.length/3-1),y[2*H+0]=1,y[2*H+1]=L,_[3*H+0]=$.x,_[3*H+1]=$.y,_[3*H+2]=$.z,a.push(a[E+0],a[E+1],a[E+2]),o.push(H=a.length/3-1),y[2*H+0]=1,y[2*H+1]=F,_[3*H+0]=$.x,_[3*H+1]=$.y,_[3*H+2]=$.z,a.push(a[A+0],a[A+1],a[A+2]),o.push(H=a.length/3-1),y[2*H+0]=1,y[2*H+1]=G,_[3*H+0]=$.x,_[3*H+1]=$.y,_[3*H+2]=$.z),_[w+0]=_[E+0]=_[A+0]=$.x,_[w+1]=_[E+1]=_[A+1]=$.y,_[w+2]=_[E+2]=_[A+2]=$.z,y[S+0]=I,y[S+1]=L,y[P+0]=N,y[P+1]=F,y[M+0]=z,y[M+1]=G}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(_)},TEXCOORD_0:{size:2,value:new Float32Array(y)}}}}(e),a=i.indices,o=i.attributes;return c.call(this,d(d({},e),{},{id:r,indices:a,attributes:d(d({},o),e.attributes)}))}return(0,r.default)(p)}(l.default);return icoSphereGeometry.default=p,icoSphereGeometry}var planeGeometry={},geometryUtils={},hasRequiredGeometryUtils,hasRequiredPlaneGeometry;function requireGeometryUtils(){return hasRequiredGeometryUtils||(hasRequiredGeometryUtils=1,Object.defineProperty(geometryUtils,"__esModule",{value:!0}),geometryUtils.unpackIndexedGeometry=function(e){var t=e.indices,r=e.attributes;if(!t)return e;var n=t.value.length,i={};for(var a in r){var o=r[a],s=o.value,l=o.size;if(!o.constant&&l){for(var u=new s.constructor(n*l),c=0;c<n;++c)for(var d=t.value[c],h=0;h<l;h++)u[c*l+h]=s[d*l+h];i[a]={size:l,value:u}}}return{attributes:Object.assign({},r,i)}}),geometryUtils}function requirePlaneGeometry(){if(hasRequiredPlaneGeometry)return planeGeometry;hasRequiredPlaneGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(planeGeometry,"__esModule",{value:!0}),planeGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireGeometry$1()),l=requireGeometryUtils(),u=es5$b;function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?c(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function(e){(0,i.default)(h,e);var t,s,c=(t=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,h);var t=e.id,r=void 0===t?(0,u.uid)("plane-geometry"):t,i=function(e){var t=e.type,r=void 0===t?"x,y":t,n=e.offset,i=void 0===n?0:n,a=e.flipCull,o=void 0!==a&&a,s=e.unpack,u=void 0!==s&&s,c=r.split(","),d=e["".concat(c[0],"len")]||1,h=e["".concat(c[1],"len")]||1,f=e["n".concat(c[0])]||1,p=e["n".concat(c[1])]||1,m=(f+1)*(p+1),g=new Float32Array(3*m),_=new Float32Array(3*m),y=new Float32Array(2*m);o&&(d=-d);for(var v=0,b=0,x=0;x<=p;x++)for(var T=0;T<=f;T++){var w=T/f,E=x/p;switch(y[v+0]=o?1-w:w,y[v+1]=E,r){case"x,y":g[b+0]=d*w-.5*d,g[b+1]=h*E-.5*h,g[b+2]=i,_[b+0]=0,_[b+1]=0,_[b+2]=o?1:-1;break;case"x,z":g[b+0]=d*w-.5*d,g[b+1]=i,g[b+2]=h*E-.5*h,_[b+0]=0,_[b+1]=o?1:-1,_[b+2]=0;break;case"y,z":g[b+0]=i,g[b+1]=d*w-.5*d,g[b+2]=h*E-.5*h,_[b+0]=o?1:-1,_[b+1]=0,_[b+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}v+=2,b+=3}for(var A=f+1,S=new Uint16Array(f*p*6),P=0;P<p;P++)for(var M=0;M<f;M++){var R=6*(P*f+M);S[R+0]=(P+0)*A+M,S[R+1]=(P+1)*A+M,S[R+2]=(P+0)*A+M+1,S[R+3]=(P+1)*A+M,S[R+4]=(P+1)*A+M+1,S[R+5]=(P+0)*A+M+1}var C={indices:{size:1,value:S},attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:_},TEXCOORD_0:{size:2,value:y}}};return u?(0,l.unpackIndexedGeometry)(C):C}(e),a=i.indices,o=i.attributes;return c.call(this,d(d({},e),{},{id:r,indices:a,attributes:d(d({},o),e.attributes)}))}return(0,r.default)(h)}(s.default);return planeGeometry.default=h,planeGeometry}var sphereGeometry={},hasRequiredSphereGeometry;function requireSphereGeometry(){if(hasRequiredSphereGeometry)return sphereGeometry;hasRequiredSphereGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(sphereGeometry,"__esModule",{value:!0}),sphereGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireCreateClass()),n=e(requireClassCallCheck()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireGeometry$1()),l=es5$b;function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(e){(0,i.default)(d,e);var t,s,u=(t=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,d);var t=e.id,r=void 0===t?(0,l.uid)("sphere-geometry"):t,i=function(e){var t=e.nlat,r=void 0===t?10:t,n=e.nlong,i=void 0===n?10:n,a=e.radius,o=void 0===a?1:a,s=Math.PI-0,l=2*Math.PI-0,u=(r+1)*(i+1);if("number"==typeof o){var c=o;o=function(e,t,r,n,i){return c}}for(var d=new Float32Array(3*u),h=new Float32Array(3*u),f=new Float32Array(2*u),p=new(u>65535?Uint32Array:Uint16Array)(r*i*6),m=0;m<=r;m++)for(var g=0;g<=i;g++){var _=g/i,y=m/r,v=g+m*(i+1),b=2*v,x=3*v,T=l*_,w=s*y,E=Math.sin(T),A=Math.cos(T),S=Math.sin(w),P=A*S,M=Math.cos(w),R=E*S,C=o(P,M,R,_,y);d[x+0]=C*P,d[x+1]=C*M,d[x+2]=C*R,h[x+0]=P,h[x+1]=M,h[x+2]=R,f[b+0]=_,f[b+1]=1-y}for(var O=i+1,L=0;L<i;L++)for(var I=0;I<r;I++){var D=6*(L*r+I);p[D+0]=I*O+L,p[D+1]=I*O+L+1,p[D+2]=(I+1)*O+L,p[D+3]=(I+1)*O+L,p[D+4]=I*O+L+1,p[D+5]=(I+1)*O+L+1}return{indices:{size:1,value:p},attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:h},TEXCOORD_0:{size:2,value:f}}}}(e),a=i.indices,o=i.attributes;return u.call(this,c(c({},e),{},{id:r,indices:a,attributes:c(c({},o),e.attributes)}))}return(0,r.default)(d)}(s.default);return sphereGeometry.default=d,sphereGeometry}var timeline={},hasRequiredTimeline;function requireTimeline(){if(hasRequiredTimeline)return timeline;hasRequiredTimeline=1;var e=interopRequireDefaultExports;Object.defineProperty(timeline,"__esModule",{value:!0}),timeline.Timeline=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass());function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=1,s=1,l=function(){function e(){(0,r.default)(this,e),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return(0,n.default)(e,[{key:"addChannel",value:function(e){var t=e.delay,r=e.duration,n=e.rate,i=e.repeat,a=o++,s={time:0,delay:void 0===t?0:t,duration:void 0===r?Number.POSITIVE_INFINITY:r,rate:void 0===n?1:n,repeat:void 0===i?1:i};return this._setChannelTime(s,this.time),this.channels.set(a,s),a}},{key:"removeChannel",value:function(e){this.channels.delete(e);var r,n=i(this.animations);try{for(n.s();!(r=n.n()).done;){var a=(0,t.default)(r.value,2);a[1].channel===e&&this.detachAnimation(a[0])}}catch(e){n.e(e)}finally{n.f()}}},{key:"isFinished",value:function(e){var t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}},{key:"getTime",value:function(e){if(void 0===e)return this.time;var t=this.channels.get(e);return void 0===t?-1:t.time}},{key:"setTime",value:function(e){this.time=Math.max(0,e);var t,r=i(this.channels.values());try{for(r.s();!(t=r.n()).done;)this._setChannelTime(t.value,this.time)}catch(e){r.e(e)}finally{r.f()}var n,a=i(this.animations.values());try{for(a.s();!(n=a.n()).done;){var o=n.value;o.animation.setTime(this.getTime(o.channel))}}catch(e){a.e(e)}finally{a.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(e,t){var r=s++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}},{key:"detachAnimation",value:function(e){this.animations.delete(e)}},{key:"update",value:function(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}},{key:"_setChannelTime",value:function(e,t){var r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}]),e}();return timeline.Timeline=l,timeline}var keyFrames={},hasRequiredKeyFrames;function requireKeyFrames(){if(hasRequiredKeyFrames)return keyFrames;hasRequiredKeyFrames=1;var e=interopRequireDefaultExports;Object.defineProperty(keyFrames,"__esModule",{value:!0}),keyFrames.KeyFrames=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=function(){function e(r){(0,t.default)(this,e),this._lastTime=-1,this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this.setKeyFrames(r),this.setTime(0)}return(0,r.default)(e,[{key:"setKeyFrames",value:function(e){var t=e.length;this.times.length=t,this.values.length=t;for(var r=0;r<t;++r)this.times[r]=e[r][0],this.values[r]=e[r][1];this._calculateKeys(this._lastTime)}},{key:"setTime",value:function(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}},{key:"getStartTime",value:function(){return this.times[this.startIndex]}},{key:"getEndTime",value:function(){return this.times[this.endIndex]}},{key:"getStartData",value:function(){return this.values[this.startIndex]}},{key:"getEndData",value:function(){return this.values[this.endIndex]}},{key:"_calculateKeys",value:function(e){var t=0,r=this.times.length;for(t=0;t<r-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;var n=this.times[this.startIndex];this.factor=Math.min(Math.max(0,(e-n)/(this.times[this.endIndex]-n)),1)}}]),e}();return keyFrames.KeyFrames=n,keyFrames}var clipSpace={},hasRequiredClipSpace;function requireClipSpace(){if(hasRequiredClipSpace)return clipSpace;hasRequiredClipSpace=1;var e=interopRequireDefaultExports;Object.defineProperty(clipSpace,"__esModule",{value:!0}),clipSpace.default=void 0;var t=e(requireCreateClass()),r=e(requireClassCallCheck()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireModel()),s=e(requireGeometry$1()),l=[-1,-1,1,-1,-1,1,1,1],u=function(e){(0,n.default)(d,e);var o,u,c=(o=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(u){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(e,t){var n;(0,r.default)(this,d);var i=l.map((function(e){return-1===e?0:e}));return(n=c.call(this,e,Object.assign({},t,{vs:"attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",geometry:new s.default({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(l)},aTexCoord:{size:2,value:new Float32Array(i)},aCoordinate:{size:2,value:new Float32Array(i)}}})}))).setVertexCount(4),n}return(0,t.default)(d)}(o.default);return clipSpace.default=u,clipSpace}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AnimationLoop",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"ClipSpace",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"ConeGeometry",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"CubeGeometry",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"CylinderGeometry",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"Geometry",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"IcoSphereGeometry",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"KeyFrames",{enumerable:!0,get:function(){return m.KeyFrames}}),Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"PlaneGeometry",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"ProgramManager",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"SphereGeometry",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"Timeline",{enumerable:!0,get:function(){return p.Timeline}}),Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"TruncatedConeGeometry",{enumerable:!0,get:function(){return f.default}});var r=t(requireAnimationLoop()),n=t(requireModel()),i=t(requireProgramManager()),a=t(requireTransform()),o=t(requireGeometry$1()),s=t(requireConeGeometry()),l=t(requireCubeGeometry()),u=t(requireCylinderGeometry()),c=t(requireIcoSphereGeometry()),d=t(requirePlaneGeometry()),h=t(requireSphereGeometry()),f=t(requireTruncatedConeGeometry()),p=requireTimeline(),m=requireKeyFrames(),g=t(requireClipSpace())}(es5$9),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AnimationLoop",{enumerable:!0,get:function(){return n.AnimationLoop}}),Object.defineProperty(e,"Buffer",{enumerable:!0,get:function(){return r.Buffer}}),Object.defineProperty(e,"ClipSpace",{enumerable:!0,get:function(){return n.ClipSpace}}),Object.defineProperty(e,"ConeGeometry",{enumerable:!0,get:function(){return n.ConeGeometry}}),Object.defineProperty(e,"CubeGeometry",{enumerable:!0,get:function(){return n.CubeGeometry}}),Object.defineProperty(e,"CylinderGeometry",{enumerable:!0,get:function(){return n.CylinderGeometry}}),Object.defineProperty(e,"FEATURES",{enumerable:!0,get:function(){return r.FEATURES}}),Object.defineProperty(e,"FragmentShader",{enumerable:!0,get:function(){return r.FragmentShader}}),Object.defineProperty(e,"Framebuffer",{enumerable:!0,get:function(){return r.Framebuffer}}),Object.defineProperty(e,"Geometry",{enumerable:!0,get:function(){return n.Geometry}}),Object.defineProperty(e,"IcoSphereGeometry",{enumerable:!0,get:function(){return n.IcoSphereGeometry}}),Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return n.Model}}),Object.defineProperty(e,"PlaneGeometry",{enumerable:!0,get:function(){return n.PlaneGeometry}}),Object.defineProperty(e,"Program",{enumerable:!0,get:function(){return r.Program}}),Object.defineProperty(e,"ProgramManager",{enumerable:!0,get:function(){return n.ProgramManager}}),Object.defineProperty(e,"Renderbuffer",{enumerable:!0,get:function(){return r.Renderbuffer}}),Object.defineProperty(e,"SphereGeometry",{enumerable:!0,get:function(){return n.SphereGeometry}}),Object.defineProperty(e,"Texture2D",{enumerable:!0,get:function(){return r.Texture2D}}),Object.defineProperty(e,"Texture3D",{enumerable:!0,get:function(){return r.Texture3D}}),Object.defineProperty(e,"TextureCube",{enumerable:!0,get:function(){return r.TextureCube}}),Object.defineProperty(e,"Timeline",{enumerable:!0,get:function(){return n.Timeline}}),Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return n.Transform}}),Object.defineProperty(e,"TransformFeedback",{enumerable:!0,get:function(){return r.TransformFeedback}}),Object.defineProperty(e,"TruncatedConeGeometry",{enumerable:!0,get:function(){return n.TruncatedConeGeometry}}),Object.defineProperty(e,"VertexShader",{enumerable:!0,get:function(){return r.VertexShader}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return r.assert}}),Object.defineProperty(e,"clear",{enumerable:!0,get:function(){return r.clear}}),Object.defineProperty(e,"cloneTextureFrom",{enumerable:!0,get:function(){return r.cloneTextureFrom}}),Object.defineProperty(e,"copyToTexture",{enumerable:!0,get:function(){return r.copyToTexture}}),Object.defineProperty(e,"createGLContext",{enumerable:!0,get:function(){return t.createGLContext}}),Object.defineProperty(e,"cssToDevicePixels",{enumerable:!0,get:function(){return t.cssToDevicePixels}}),Object.defineProperty(e,"cssToDeviceRatio",{enumerable:!0,get:function(){return t.cssToDeviceRatio}}),Object.defineProperty(e,"dirlight",{enumerable:!0,get:function(){return i.dirlight}}),Object.defineProperty(e,"fp32",{enumerable:!0,get:function(){return i.fp32}}),Object.defineProperty(e,"fp64",{enumerable:!0,get:function(){return i.fp64}}),Object.defineProperty(e,"getParameters",{enumerable:!0,get:function(){return t.getParameters}}),Object.defineProperty(e,"gouraudLighting",{enumerable:!0,get:function(){return i.gouraudLighting}}),Object.defineProperty(e,"hasFeature",{enumerable:!0,get:function(){return r.hasFeature}}),Object.defineProperty(e,"hasFeatures",{enumerable:!0,get:function(){return r.hasFeatures}}),Object.defineProperty(e,"instrumentGLContext",{enumerable:!0,get:function(){return t.instrumentGLContext}}),Object.defineProperty(e,"isWebGL",{enumerable:!0,get:function(){return t.isWebGL}}),Object.defineProperty(e,"isWebGL2",{enumerable:!0,get:function(){return t.isWebGL2}}),Object.defineProperty(e,"log",{enumerable:!0,get:function(){return r.log}}),Object.defineProperty(e,"lumaStats",{enumerable:!0,get:function(){return r.lumaStats}}),Object.defineProperty(e,"normalizeShaderModule",{enumerable:!0,get:function(){return i.normalizeShaderModule}}),Object.defineProperty(e,"pbr",{enumerable:!0,get:function(){return i.pbr}}),Object.defineProperty(e,"phongLighting",{enumerable:!0,get:function(){return i.phongLighting}}),Object.defineProperty(e,"picking",{enumerable:!0,get:function(){return i.picking}}),Object.defineProperty(e,"project",{enumerable:!0,get:function(){return i.project}}),Object.defineProperty(e,"readPixelsToArray",{enumerable:!0,get:function(){return r.readPixelsToArray}}),Object.defineProperty(e,"readPixelsToBuffer",{enumerable:!0,get:function(){return r.readPixelsToBuffer}}),Object.defineProperty(e,"resetParameters",{enumerable:!0,get:function(){return t.resetParameters}}),Object.defineProperty(e,"setParameters",{enumerable:!0,get:function(){return t.setParameters}}),Object.defineProperty(e,"uid",{enumerable:!0,get:function(){return r.uid}}),Object.defineProperty(e,"withParameters",{enumerable:!0,get:function(){return t.withParameters}});var t=es5$c,r=es5$b,n=es5$9,i=es5$8}(es5$d);var ambientLight={},hasRequiredAmbientLight;function requireAmbientLight(){if(hasRequiredAmbientLight)return ambientLight;hasRequiredAmbientLight=1;var e=interopRequireDefaultExports;Object.defineProperty(ambientLight,"__esModule",{value:!0}),ambientLight.AmbientLight=void 0;var t=e(requireClassCallCheck()),r=e(requireDefineProperty()),n=[255,255,255],i=0;return ambientLight.AmbientLight=function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,r.default)(this,"id",void 0),(0,r.default)(this,"color",void 0),(0,r.default)(this,"intensity",void 0),(0,r.default)(this,"type","ambient");var o=a.color,s=void 0===o?n:o,l=a.intensity,u=void 0===l?1:l;this.id=a.id||"ambient-".concat(i++),this.color=s,this.intensity=u},ambientLight}var directionalLight={},hasRequiredDirectionalLight;function requireDirectionalLight(){if(hasRequiredDirectionalLight)return directionalLight;hasRequiredDirectionalLight=1;var e=interopRequireDefaultExports;Object.defineProperty(directionalLight,"__esModule",{value:!0}),directionalLight.DirectionalLight=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=[255,255,255],o=[0,0,-1],s=0,l=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"color",void 0),(0,n.default)(this,"intensity",void 0),(0,n.default)(this,"type","directional"),(0,n.default)(this,"direction",void 0),(0,n.default)(this,"shadow",void 0);var l=r.color,u=void 0===l?a:l,c=r.intensity,d=void 0===c?1:c,h=r.direction,f=void 0===h?o:h,p=r._shadow,m=void 0!==p&&p;this.id=r.id||"directional-".concat(s++),this.color=u,this.intensity=d,this.type="directional",this.direction=new i.Vector3(f).normalize().toArray(),this.shadow=m}return(0,r.default)(e,[{key:"getProjectedLight",value:function(e){return this}}]),e}();return directionalLight.DirectionalLight=l,directionalLight}var shadowPass={},layersPass={},pass={},hasRequiredPass,hasRequiredLayersPass,hasRequiredShadowPass;function requirePass(){if(hasRequiredPass)return pass;hasRequiredPass=1;var e=interopRequireDefaultExports;Object.defineProperty(pass,"__esModule",{value:!0}),pass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty());function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var a=function(){function e(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"pass"};(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"props",void 0),this.id=a.id,this.gl=r,this.props=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a)}return(0,r.default)(e,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e){}},{key:"cleanup",value:function(){}}]),e}();return pass.default=a,pass}function requireLayersPass(){if(hasRequiredLayersPass)return layersPass;hasRequiredLayersPass=1;var e=interopRequireDefaultExports;Object.defineProperty(layersPass,"__esModule",{value:!0}),layersPass.layerIndexResolver=f,layersPass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=e(requirePass()),u=es5$d;function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=function(e){(0,i.default)(p,e);var l,d,h=(l=p,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(l);if(d){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(){var e;(0,t.default)(this,p);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),(0,s.default)((0,n.default)(e),"_lastRenderIndex",-1),e}return(0,r.default)(p,[{key:"render",value:function(e){return(0,u.setParameters)(this.gl,{framebuffer:e.target}),this._drawLayers(e)}},{key:"_drawLayers",value:function(e){var t=e.target,r=e.moduleParameters,n=e.viewports,i=e.views,a=e.onViewportActive,o=e.clearStack,s=void 0===o||o,l=e.clearCanvas,d=void 0===l||l;e.pass=e.pass||"unknown";var h=this.gl;d&&function(e,t){(0,u.setParameters)(e,{viewport:[0,0,t?t.width:e.drawingBufferWidth,t?t.height:e.drawingBufferHeight]}),e.clear(16640)}(h,t),s&&(this._lastRenderIndex=-1);var f,p=[],m=c(n);try{for(m.s();!(f=m.n()).done;){var g=f.value,_=i&&i[g.id];null==a||a(g);var y,v=this._getDrawLayerParams(g,e),b=c(g.subViewports||[g]);try{for(b.s();!(y=b.n()).done;){var x=this._drawLayersInViewport(h,{target:t,moduleParameters:r,viewport:y.value,view:_,pass:e.pass,layers:e.layers},v);p.push(x)}}catch(e){b.e(e)}finally{b.f()}}}catch(e){m.e(e)}finally{m.f()}return p}},{key:"_getDrawLayerParams",value:function(e,t){for(var r=t.layers,n=t.pass,i=t.isPicking,a=void 0!==i&&i,o=t.layerFilter,s=t.cullRect,l=t.effects,u=t.moduleParameters,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[],h=f(this._lastRenderIndex+1),p={layer:r[0],viewport:e,isPicking:a,renderPass:n,cullRect:s},m={},g=0;g<r.length;g++){var _=r[g],y=this._shouldDrawLayer(_,p,o,m),v={shouldDrawLayer:y};y&&!c&&(v.layerRenderIndex=h(_,y),v.moduleParameters=this._getModuleParameters(_,l,n,u),v.layerParameters=this.getLayerParameters(_,g,e)),d[g]=v}return d}},{key:"_drawLayersInViewport",value:function(e,t,r){var n=t.layers,i=t.pass,a=t.viewport,o=t.view,s=function(e,t){var r=t.moduleParameters,n=t.target,i=t.viewport,a=n&&"default-framebuffer"!==n.id,o=r&&r.devicePixelRatio||(0,u.cssToDeviceRatio)(e);return[i.x*o,(a?n.height:e.drawingBufferHeight)-(i.y+i.height)*o,i.width*o,i.height*o]}(e,{moduleParameters:t.moduleParameters,target:t.target,viewport:a});if(o&&o.props.clear){var l=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;(0,u.withParameters)(e,{scissorTest:!0,scissor:s},(function(){return(0,u.clear)(e,l)}))}var c={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};(0,u.setParameters)(e,{viewport:s});for(var d=0;d<n.length;d++){var h=n[d],f=r[d],p=f.shouldDrawLayer,m=f.layerRenderIndex,g=f.moduleParameters,_=f.layerParameters;if(p&&h.props.pickable&&c.pickableCount++,h.isComposite)c.compositeCount++;else if(p){c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),g.viewport=a;try{h._drawLayer({moduleParameters:g,uniforms:{layerIndex:m},parameters:_})}catch(e){h.raiseError(e,"drawing ".concat(h," to ").concat(i))}}}return c}},{key:"shouldDrawLayer",value:function(e){return!0}},{key:"getModuleParameters",value:function(e,t){return null}},{key:"getLayerParameters",value:function(e,t,r){return e.props.parameters}},{key:"_shouldDrawLayer",value:function(e,t,r,n){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;for(var i=e.parent;i;){if(!i.props.visible||!i.filterSubLayer(t))return!1;t.layer=i,i=i.parent}if(r){var a=t.layer.id;if(a in n||(n[a]=r(t)),!n[a])return!1}return e.activateViewport(t.viewport),!0}},{key:"_getModuleParameters",value:function(e,t,r,n){var i,a=Object.assign(Object.create((null===(i=e.internalState)||void 0===i?void 0:i.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:(0,u.cssToDeviceRatio)(this.gl)});if(t){var o,s=c(t);try{for(s.s();!(o=s.n()).done;){var l,d=o.value;Object.assign(a,null===(l=d.getModuleParameters)||void 0===l?void 0:l.call(d,e))}}catch(e){s.e(e)}finally{s.f()}}return Object.assign(a,this.getModuleParameters(e,t),n)}}]),p}(l.default);function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};return function n(i,a){var o,s=i.props._offset,l=i.id,u=i.parent&&i.parent.id;if(u&&!(u in t)&&n(i.parent,!1),u in r){var c=r[u]=r[u]||f(t[u],t);o=c(i,a),r[l]=c}else Number.isFinite(s)?(o=s+(t[u]||0),r[l]=null):o=e;return a&&o>=e&&(e=o+1),t[l]=o,o}}return layersPass.default=h,layersPass}function requireShadowPass(){if(hasRequiredShadowPass)return shadowPass;hasRequiredShadowPass=1;var e=interopRequireDefaultExports;Object.defineProperty(shadowPass,"__esModule",{value:!0}),shadowPass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=e(requireLayersPass()),c=es5$d;function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=function(e){(0,a.default)(p,e);var u,d,f=(u=p,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(d){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function p(e,r){var i,a,o;return(0,t.default)(this,p),o=f.call(this,e,r),(0,l.default)((0,n.default)(o),"shadowMap",void 0),(0,l.default)((0,n.default)(o),"depthBuffer",void 0),(0,l.default)((0,n.default)(o),"fbo",void 0),o.shadowMap=new c.Texture2D(e,{width:1,height:1,parameters:(i={},(0,l.default)(i,10241,9729),(0,l.default)(i,10240,9729),(0,l.default)(i,10242,33071),(0,l.default)(i,10243,33071),i)}),o.depthBuffer=new c.Renderbuffer(e,{format:33189,width:1,height:1}),o.fbo=new c.Framebuffer(e,{id:"shadowmap",width:1,height:1,attachments:(a={},(0,l.default)(a,36064,o.shadowMap),(0,l.default)(a,36096,o.depthBuffer),a)}),o}return(0,r.default)(p,[{key:"render",value:function(e){var t=this,r=this.fbo;(0,c.withParameters)(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(function(){var n=e.viewports[0],a=(0,c.cssToDeviceRatio)(t.gl),o=n.width*a,l=n.height*a;o===r.width&&l===r.height||r.resize({width:o,height:l}),(0,i.default)((0,s.default)(p.prototype),"render",t).call(t,h(h({},e),{},{target:r,pass:"shadow"}))}))}},{key:"shouldDrawLayer",value:function(e){return!1!==e.props.shadowEnabled}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),p}(u.default);return shadowPass.default=f,shadowPass}var shadow={},project={},geometry={},hasRequiredGeometry;function requireGeometry(){if(hasRequiredGeometry)return geometry;hasRequiredGeometry=1,Object.defineProperty(geometry,"__esModule",{value:!0}),geometry.default=void 0;var e="#define SMOOTH_EDGE_RADIUS 0.5",t="\n".concat(e,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),r="\n".concat(e,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n");return geometry.default={name:"geometry",vs:t,fs:r},geometry}var project_glsl={},hasRequiredProject_glsl;function requireProject_glsl(){if(hasRequiredProject_glsl)return project_glsl;hasRequiredProject_glsl=1,Object.defineProperty(project_glsl,"__esModule",{value:!0}),project_glsl.default=void 0;var e=constants$4,t=Object.keys(e.COORDINATE_SYSTEM).map((function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(e.COORDINATE_SYSTEM[t],";")})).join(""),r=Object.keys(e.PROJECTION_MODE).map((function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(e.PROJECTION_MODE[t],";")})).join(""),n=Object.keys(e.UNIT).map((function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(e.UNIT[t],";")})).join(""),i="".concat(t,"\n").concat(r,"\n").concat(n,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\n  float y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      return project_size_at_latitude(geometry.worldPosition.y);\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\nfloat project_size_at_latitude(float meters, float lat) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size_at_latitude(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n");return project_glsl.default=i,project_glsl}var viewportUniforms={},memoize={},hasRequiredMemoize,hasRequiredViewportUniforms,hasRequiredProject;function requireMemoize(){if(hasRequiredMemoize)return memoize;function e(e,t){if(e===t)return!0;if(Array.isArray(e)){var r=e.length;if(!t||t.length!==r)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}return hasRequiredMemoize=1,Object.defineProperty(memoize,"__esModule",{value:!0}),memoize.default=function(t){var r,n={};return function(i){for(var a in i)if(!e(i[a],n[a])){r=t(i),n=i;break}return r}},memoize}function requireViewportUniforms(){if(hasRequiredViewportUniforms)return viewportUniforms;hasRequiredViewportUniforms=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(viewportUniforms,"__esModule",{value:!0}),viewportUniforms.getOffsetOrigin=p,viewportUniforms.getUniformsFromViewport=function(e){var t=e.viewport,r=e.devicePixelRatio,n=e.modelMatrix,a=void 0===n?null:n,o=e.coordinateSystem,s=void 0===o?i.COORDINATE_SYSTEM.DEFAULT:o,l=e.coordinateOrigin,u=e.autoWrapLongitude,d=void 0!==u&&u;s===i.COORDINATE_SYSTEM.DEFAULT&&(s=t.isGeospatial?i.COORDINATE_SYSTEM.LNGLAT:i.COORDINATE_SYSTEM.CARTESIAN);var p=f({viewport:t,devicePixelRatio:void 0===r?1:r,coordinateSystem:s,coordinateOrigin:void 0===l?h:l});return p.project_uWrapLongitude=d,p.project_uModelMatrix=a||c,p};var r=s(requireMat4()),n=s(requireVec4()),i=constants$4,a=e(requireMemoize());function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=o(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=a?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}var l=[0,0,0,0],u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0,0],h=[0,0,0],f=(0,a.default)((function(e){var t=e.viewport,a=e.devicePixelRatio,o=e.coordinateSystem,s=function(e,t,i){var a=e.viewMatrixUncentered,o=e.projectionMatrix,s=e.viewMatrix,c=e.viewProjectionMatrix,d=l,h=l,f=e.cameraPosition,m=p(e,t,i),g=m.geospatialOrigin,_=m.shaderCoordinateOrigin;return m.offsetMode&&(h=e.projectPosition(g||_),f=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],h[3]=1,d=n.transformMat4([],h,c),c=r.multiply([],o,s=a||s),c=r.multiply([],c,u)),{viewMatrix:s,viewProjectionMatrix:c,projectionCenter:d,originCommon:h,cameraPosCommon:f,shaderCoordinateOrigin:_,geospatialOrigin:g}}(t,o,e.coordinateOrigin),h=s.projectionCenter,f=s.viewProjectionMatrix,m=s.originCommon,g=s.cameraPosCommon,_=s.shaderCoordinateOrigin,y=s.geospatialOrigin,v=t.getDistanceScales(),b=[t.width*a,t.height*a],x=n.transformMat4([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,T={project_uCoordinateSystem:o,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:_,project_uCommonOrigin:m.slice(0,3),project_uCenter:h,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:b,project_uDevicePixelRatio:a,project_uFocalDistance:x,project_uCommonUnitsPerMeter:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:d,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:f,project_uModelMatrix:c,project_uCameraPosition:g};if(y){var w=t.getDistanceScales(y);switch(o){case i.COORDINATE_SYSTEM.METER_OFFSETS:T.project_uCommonUnitsPerWorldUnit=w.unitsPerMeter,T.project_uCommonUnitsPerWorldUnit2=w.unitsPerMeter2;break;case i.COORDINATE_SYSTEM.LNGLAT:case i.COORDINATE_SYSTEM.LNGLAT_OFFSETS:t._pseudoMeters||(T.project_uCommonUnitsPerMeter=w.unitsPerMeter),T.project_uCommonUnitsPerWorldUnit=w.unitsPerDegree,T.project_uCommonUnitsPerWorldUnit2=w.unitsPerDegree2;break;case i.COORDINATE_SYSTEM.CARTESIAN:T.project_uCommonUnitsPerWorldUnit=[1,1,w.unitsPerMeter[2]],T.project_uCommonUnitsPerWorldUnit2=[0,0,w.unitsPerMeter2[2]]}}return T}));function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;r.length<3&&(r=[r[0],r[1],0]);var n,a=r,o=!0;switch(n=t===i.COORDINATE_SYSTEM.LNGLAT_OFFSETS||t===i.COORDINATE_SYSTEM.METER_OFFSETS?r:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case i.PROJECTION_MODE.WEB_MERCATOR:t!==i.COORDINATE_SYSTEM.LNGLAT&&t!==i.COORDINATE_SYSTEM.CARTESIAN||(n=[0,0,0],o=!1);break;case i.PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:t===i.COORDINATE_SYSTEM.LNGLAT?a=n:t===i.COORDINATE_SYSTEM.CARTESIAN&&(a=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(a),a[0]-=r[0],a[1]-=r[1],a[2]-=r[2]);break;case i.PROJECTION_MODE.IDENTITY:(a=e.position.map(Math.fround))[2]=a[2]||0;break;case i.PROJECTION_MODE.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:a,offsetMode:o}}return viewportUniforms}function requireProject(){if(hasRequiredProject)return project;hasRequiredProject=1;var e=interopRequireDefaultExports;Object.defineProperty(project,"__esModule",{value:!0}),project.default=void 0;var t=es5$d,r=e(requireGeometry()),n=e(requireProject_glsl()),i=requireViewportUniforms(),a={},o={name:"project",dependencies:[t.fp32,r.default],vs:n.default,getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;return"viewport"in e?(0,i.getUniformsFromViewport)(e):{}}};return project.default=o,project}var es5$7={},webMercatorViewport$1={},mathUtils$1={},hasRequiredMathUtils$1;function requireMathUtils$1(){if(hasRequiredMathUtils$1)return mathUtils$1;hasRequiredMathUtils$1=1,Object.defineProperty(mathUtils$1,"__esModule",{value:!0}),mathUtils$1.createMat4=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},mathUtils$1.transformVector=function(t,r){var n=(0,e.transformMat4)([],r,t);return(0,e.scale)(n,n,1/n[3]),n},mathUtils$1.mod=function(e,t){var r=e%t;return r<0?t+r:r},mathUtils$1.lerp=function(e,t,r){return r*t+(1-r)*e},mathUtils$1.clamp=function(e,t,r){return e<t?t:e>r?r:e},mathUtils$1.log2=void 0;var e=requireVec4(),t=Math.log2||function(e){return Math.log(e)*Math.LOG2E};return mathUtils$1.log2=t,mathUtils$1}var webMercatorUtils={},assert$2={},hasRequiredAssert$1,hasRequiredWebMercatorUtils;function requireAssert$1(){return hasRequiredAssert$1||(hasRequiredAssert$1=1,Object.defineProperty(assert$2,"__esModule",{value:!0}),assert$2.default=function(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}),assert$2}function requireWebMercatorUtils(){if(hasRequiredWebMercatorUtils)return webMercatorUtils;hasRequiredWebMercatorUtils=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(webMercatorUtils,"__esModule",{value:!0}),webMercatorUtils.zoomToScale=function(e){return Math.pow(2,e)},webMercatorUtils.scaleToZoom=_,webMercatorUtils.lngLatToWorld=y,webMercatorUtils.worldToLngLat=v,webMercatorUtils.getMeterZoom=function(e){var t=e.latitude;(0,s.default)(Number.isFinite(t));var r=Math.cos(t*h);return _(m*r)-9},webMercatorUtils.unitsPerMeter=function(e){var t=Math.cos(e*h);return p/m/t},webMercatorUtils.getDistanceScales=b,webMercatorUtils.addMetersToLngLat=function(e,t){var n=(0,r.default)(e,3),i=n[0],a=n[1],o=n[2],s=(0,r.default)(t,3),l=s[0],u=s[1],c=s[2],d=b({longitude:i,latitude:a,highPrecision:!0}),h=d.unitsPerMeter,f=d.unitsPerMeter2,p=y(e);p[0]+=l*(h[0]+f[0]*u),p[1]+=u*(h[1]+f[1]*u);var m=v(p),g=(o||0)+(c||0);return Number.isFinite(o)||Number.isFinite(c)?[m[0],m[1],g]:m},webMercatorUtils.getViewMatrix=function(e){var t=e.height,r=e.pitch,a=e.bearing,s=e.altitude,l=e.scale,u=e.center,c=(0,n.createMat4)();i.translate(c,c,[0,0,-s]),i.rotateX(c,c,-r*h),i.rotateZ(c,c,a*h);var d=l/t;return i.scale(c,c,[d,d,d]),u&&i.translate(c,c,o.negate([],u)),c},webMercatorUtils.getProjectionParameters=x,webMercatorUtils.getProjectionMatrix=function(e){var t=x(e);return i.perspective([],t.fov,t.aspect,t.near,t.far)},webMercatorUtils.altitudeToFovy=T,webMercatorUtils.fovyToAltitude=w,webMercatorUtils.worldToPixels=function(e,t){var i=(0,r.default)(e,3),a=i[0],o=i[1],l=i[2],u=void 0===l?0:l;return(0,s.default)(Number.isFinite(a)&&Number.isFinite(o)&&Number.isFinite(u)),(0,n.transformVector)(t,[a,o,u,1])},webMercatorUtils.pixelsToWorld=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=(0,r.default)(e,3),l=o[0],u=o[1],c=o[2];if((0,s.default)(Number.isFinite(l)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(c))return(0,n.transformVector)(t,[l,u,c,1]);var d=(0,n.transformVector)(t,[l,u,0,1]),h=(0,n.transformVector)(t,[l,u,1,1]),f=d[2],p=h[2];return a.lerp([],d,h,f===p?0:((i||0)-f)/(p-f))},webMercatorUtils.DEFAULT_ALTITUDE=webMercatorUtils.MAX_LATITUDE=void 0;var r=e(requireSlicedToArray()),n=requireMathUtils$1(),i=u(requireMat4()),a=u(requireVec2()),o=u(requireVec3()),s=e(requireAssert$1());function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function u(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=l(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}var c=Math.PI,d=c/4,h=c/180,f=180/c,p=512,m=4003e4;webMercatorUtils.MAX_LATITUDE=85.051129;var g=1.5;function _(e){return(0,n.log2)(e)}function y(e){var t=(0,r.default)(e,2),n=t[0],i=t[1];return(0,s.default)(Number.isFinite(n)),(0,s.default)(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),[p*(n*h+c)/(2*c),p*(c+Math.log(Math.tan(d+i*h*.5)))/(2*c)]}function v(e){var t=(0,r.default)(e,2),n=t[0]/p*(2*c)-c,i=2*(Math.atan(Math.exp(t[1]/p*(2*c)-c))-d);return[n*f,i*f]}function b(e){var t=e.latitude,r=e.longitude,n=e.highPrecision,i=void 0!==n&&n;(0,s.default)(Number.isFinite(t)&&Number.isFinite(r));var a=p,o=Math.cos(t*h),l=a/360,u=l/o,c=a/m/o,d={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[l,u,c],degreesPerUnit:[1/l,1/u,1/c]};if(i){var f=h*Math.tan(t*h)/o,g=a/m*f,_=g/u*c;d.unitsPerDegree2=[0,l*f/2,g],d.unitsPerMeter2=[_,0,_]}return d}function x(e){var t=e.width,r=e.height,i=e.altitude,a=e.pitch,o=void 0===a?0:a,s=e.offset,l=e.center,u=e.scale,c=e.nearZMultiplier,d=void 0===c?1:c,f=e.farZMultiplier,p=void 0===f?1:f,m=e.fovy,_=void 0===m?T(g):m;void 0!==i&&(_=T(i));var y=_*h,v=o*h,b=w(_),x=b;l&&(x+=l[2]*u/Math.cos(v)/r);var E=y*(.5+(s?s[1]:0)/r),A=Math.sin(E)*x/Math.sin((0,n.clamp)(Math.PI/2-v-E,.01,Math.PI-.01)),S=Math.sin(v)*A+x;return{fov:y,aspect:t/r,focalDistance:b,near:d,far:Math.min(S*p,10*x)}}function T(e){return 2*Math.atan(.5/e)*f}function w(e){return.5/Math.tan(.5*e*h)}return webMercatorUtils.DEFAULT_ALTITUDE=g,webMercatorUtils}var fitBounds={},hasRequiredFitBounds;function requireFitBounds(){if(hasRequiredFitBounds)return fitBounds;hasRequiredFitBounds=1;var e=interopRequireDefaultExports;Object.defineProperty(fitBounds,"__esModule",{value:!0}),fitBounds.default=function(e){var a=e.width,o=e.height,s=e.minExtent,l=void 0===s?0:s,u=e.maxZoom,c=void 0===u?24:u,d=e.offset,h=void 0===d?[0,0]:d,f=(0,t.default)(e.bounds,2),p=(0,t.default)(f[0],2),m=p[0],g=p[1],_=(0,t.default)(f[1],2),y=_[0],v=_[1],b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:((0,r.default)(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),x=(0,i.lngLatToWorld)([m,(0,n.clamp)(v,-i.MAX_LATITUDE,i.MAX_LATITUDE)]),T=(0,i.lngLatToWorld)([y,(0,n.clamp)(g,-i.MAX_LATITUDE,i.MAX_LATITUDE)]),w=[Math.max(Math.abs(T[0]-x[0]),l),Math.max(Math.abs(T[1]-x[1]),l)],E=[a-b.left-b.right-2*Math.abs(h[0]),o-b.top-b.bottom-2*Math.abs(h[1])];(0,r.default)(E[0]>0&&E[1]>0);var A=E[0]/w[0],S=E[1]/w[1],P=(0,i.worldToLngLat)([(T[0]+x[0])/2+(b.right-b.left)/2/A,(T[1]+x[1])/2+(b.top-b.bottom)/2/S]),M=Math.min(c,(0,n.log2)(Math.abs(Math.min(A,S))));return(0,r.default)(Number.isFinite(M)),{longitude:P[0],latitude:P[1],zoom:M}};var t=e(requireSlicedToArray()),r=e(requireAssert$1()),n=requireMathUtils$1(),i=requireWebMercatorUtils();return fitBounds}var getBounds={},hasRequiredGetBounds,hasRequiredWebMercatorViewport$1;function requireGetBounds(){if(hasRequiredGetBounds)return getBounds;hasRequiredGetBounds=1;var e=_typeofExports;Object.defineProperty(getBounds,"__esModule",{value:!0}),getBounds.default=function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.width,s=e.height,l=e.unproject,u={targetZ:n},c=l([0,s],u),d=l([i,s],u);return(e.fovy?.5*e.fovy*a:Math.atan(.5/e.altitude))>(90-e.pitch)*a-.01?(t=o(e,0,n),r=o(e,i,n)):(t=l([0,0],u),r=l([i,0],u)),[c,d,r,t]};var t=requireWebMercatorUtils(),r=function(t,r){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var n=i(void 0);if(n&&n.has(t))return n.get(t);var a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var l=o?Object.getOwnPropertyDescriptor(t,s):null;l&&(l.get||l.set)?Object.defineProperty(a,s,l):a[s]=t[s]}return a.default=t,n&&n.set(t,a),a}(requireVec2()),n=requireMathUtils$1();function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}var a=Math.PI/180;function o(e,i,a){var o=e.pixelUnprojectionMatrix,s=(0,n.transformVector)(o,[i,0,1,1]),l=(0,n.transformVector)(o,[i,e.height,1,1]),u=r.lerp([],s,l,(a*e.distanceScales.unitsPerMeter[2]-s[2])/(l[2]-s[2])),c=(0,t.worldToLngLat)(u);return c.push(a),c}return getBounds}function requireWebMercatorViewport$1(){if(hasRequiredWebMercatorViewport$1)return webMercatorViewport$1;hasRequiredWebMercatorViewport$1=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(webMercatorViewport$1,"__esModule",{value:!0}),webMercatorViewport$1.default=void 0;var r=e(requireToConsumableArray()),n=e(requireSlicedToArray()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=e(requireDefineProperty()),s=requireMathUtils$1(),l=requireWebMercatorUtils(),u=e(requireFitBounds()),c=e(requireGetBounds()),d=m(requireMat4()),h=m(requireVec2()),f=m(requireVec3());function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function m(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=p(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}var g=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1};(0,i.default)(this,e),(0,o.default)(this,"latitude",void 0),(0,o.default)(this,"longitude",void 0),(0,o.default)(this,"zoom",void 0),(0,o.default)(this,"pitch",void 0),(0,o.default)(this,"bearing",void 0),(0,o.default)(this,"altitude",void 0),(0,o.default)(this,"fovy",void 0),(0,o.default)(this,"meterOffset",void 0),(0,o.default)(this,"center",void 0),(0,o.default)(this,"width",void 0),(0,o.default)(this,"height",void 0),(0,o.default)(this,"scale",void 0),(0,o.default)(this,"distanceScales",void 0),(0,o.default)(this,"viewMatrix",void 0),(0,o.default)(this,"projectionMatrix",void 0),(0,o.default)(this,"viewProjectionMatrix",void 0),(0,o.default)(this,"pixelProjectionMatrix",void 0),(0,o.default)(this,"pixelUnprojectionMatrix",void 0),(0,o.default)(this,"equals",(function(r){return r instanceof e&&r.width===t.width&&r.height===t.height&&d.equals(r.projectionMatrix,t.projectionMatrix)&&d.equals(r.viewMatrix,t.viewMatrix)})),(0,o.default)(this,"project",(function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===r||r,a=t.projectPosition(e),o=(0,l.worldToPixels)(a,t.pixelProjectionMatrix),s=(0,n.default)(o,2),u=s[0],c=s[1],d=i?c:t.height-c;return 2===e.length?[u,d]:[u,d,o[2]]})),(0,o.default)(this,"unproject",(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.topLeft,a=void 0===i||i,o=r.targetZ,s=void 0===o?void 0:o,u=(0,n.default)(e,3),c=u[1],d=u[2],h=(0,l.pixelsToWorld)([u[0],a?c:t.height-c,d],t.pixelUnprojectionMatrix,s&&s*t.distanceScales.unitsPerMeter[2]),f=t.unprojectPosition(h),p=(0,n.default)(f,3),m=p[0],g=p[1],_=p[2];return Number.isFinite(d)?[m,g,_]:Number.isFinite(s)?[m,g,s]:[m,g]})),(0,o.default)(this,"projectPosition",(function(e){var r=(0,l.lngLatToWorld)(e),i=(0,n.default)(r,2);return[i[0],i[1],(e[2]||0)*t.distanceScales.unitsPerMeter[2]]})),(0,o.default)(this,"unprojectPosition",(function(e){var r=(0,l.worldToLngLat)(e),i=(0,n.default)(r,2);return[i[0],i[1],(e[2]||0)*t.distanceScales.metersPerUnit[2]]}));var a=r.width,s=r.height,u=r.altitude,c=void 0===u?null:u,h=r.fovy,p=void 0===h?null:h,m=r.latitude,g=void 0===m?0:m,_=r.longitude,y=void 0===_?0:_,v=r.zoom,b=void 0===v?0:v,x=r.pitch,T=void 0===x?0:x,w=r.bearing,E=void 0===w?0:w,A=r.position,S=void 0===A?null:A,P=r.nearZMultiplier,M=void 0===P?.02:P,R=r.farZMultiplier,C=void 0===R?1.01:R;a=a||1,s=s||1,null===p&&null===c?p=(0,l.altitudeToFovy)(c=l.DEFAULT_ALTITUDE):null===p?p=(0,l.altitudeToFovy)(c):null===c&&(c=(0,l.fovyToAltitude)(p));var O=(0,l.zoomToScale)(b);c=Math.max(.75,c);var L=(0,l.getDistanceScales)({longitude:y,latitude:g}),I=(0,l.lngLatToWorld)([y,g]);I.push(0),S&&f.add(I,I,f.mul([],S,L.unitsPerMeter)),this.projectionMatrix=(0,l.getProjectionMatrix)({width:a,height:s,scale:O,center:I,pitch:T,fovy:p,nearZMultiplier:M,farZMultiplier:C}),this.viewMatrix=(0,l.getViewMatrix)({height:s,scale:O,center:I,pitch:T,bearing:E,altitude:c}),this.width=a,this.height=s,this.scale=O,this.latitude=g,this.longitude=y,this.zoom=b,this.pitch=T,this.bearing=E,this.altitude=c,this.fovy=p,this.center=I,this.meterOffset=S||[0,0,0],this.distanceScales=L,this._initMatrices(),Object.freeze(this)}return(0,a.default)(e,[{key:"_initMatrices",value:function(){var e=this.width,t=this.height,r=this.projectionMatrix,n=this.viewMatrix,i=(0,s.createMat4)();d.multiply(i,i,r),d.multiply(i,i,n),this.viewProjectionMatrix=i;var a=(0,s.createMat4)();d.scale(a,a,[e/2,-t/2,1]),d.translate(a,a,[1,-1,0]),d.multiply(a,a,i);var o=d.invert((0,s.createMat4)(),a);if(!o)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=a,this.pixelUnprojectionMatrix=o}},{key:"projectFlat",value:function(e){return(0,l.lngLatToWorld)(e)}},{key:"unprojectFlat",value:function(e){return(0,l.worldToLngLat)(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,r=(0,l.pixelsToWorld)(e.pos,this.pixelUnprojectionMatrix),n=(0,l.lngLatToWorld)(t),i=h.add([],n,h.negate([],r)),a=h.add([],this.center,i);return(0,l.worldToLngLat)(a)}},{key:"fitBounds",value:function(t){var r=this.width,n=this.height,i=(0,u.default)(Object.assign({width:r,height:n,bounds:t},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}));return new e({width:r,height:n,longitude:i.longitude,latitude:i.latitude,zoom:i.zoom})}},{key:"getBounds",value:function(e){var t=this.getBoundingRegion(e),n=Math.min.apply(Math,(0,r.default)(t.map((function(e){return e[0]})))),i=Math.max.apply(Math,(0,r.default)(t.map((function(e){return e[0]}))));return[[n,Math.min.apply(Math,(0,r.default)(t.map((function(e){return e[1]}))))],[i,Math.max.apply(Math,(0,r.default)(t.map((function(e){return e[1]}))))]]}},{key:"getBoundingRegion",value:function(){return(0,c.default)(this,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0)}},{key:"getLocationAtPoint",value:function(e){return this.getMapCenterByLngLatPosition({lngLat:e.lngLat,pos:e.pos})}}]),e}();return webMercatorViewport$1.default=g,webMercatorViewport$1}var normalizeViewportProps={},hasRequiredNormalizeViewportProps;function requireNormalizeViewportProps(){if(hasRequiredNormalizeViewportProps)return normalizeViewportProps;hasRequiredNormalizeViewportProps=1,Object.defineProperty(normalizeViewportProps,"__esModule",{value:!0}),normalizeViewportProps.default=function(n){var i=n.width,a=n.height,o=n.pitch,s=void 0===o?0:o,l=n.longitude,u=n.latitude,c=n.zoom,d=n.bearing,h=void 0===d?0:d;(l<-180||l>180)&&(l=(0,t.mod)(l+180,360)-180),(h<-180||h>180)&&(h=(0,t.mod)(h+180,360)-180);var f=(0,t.log2)(a/r);if(c<=f)c=f,u=0;else{var p=a/2/Math.pow(2,c),m=(0,e.worldToLngLat)([0,p])[1];if(u<m)u=m;else{var g=(0,e.worldToLngLat)([0,r-p])[1];u>g&&(u=g)}}return{width:i,height:a,longitude:l,latitude:u,zoom:c,pitch:s,bearing:h}};var e=requireWebMercatorUtils(),t=requireMathUtils$1(),r=512;return normalizeViewportProps}var flyToViewport={},hasRequiredFlyToViewport,hasRequiredShadow,hasRequiredLightingEffect;function requireFlyToViewport(){if(hasRequiredFlyToViewport)return flyToViewport;hasRequiredFlyToViewport=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(flyToViewport,"__esModule",{value:!0}),flyToViewport.default=function(e,t,r,o){var s=f(e,t,o),l=s.startZoom,h=s.startCenterXY,p=s.uDelta,m=s.w0,g=s.u1,_=s.S,y=s.rho,v=s.rho2,b=s.r0;if(g<c){var x,T={},w=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(d);try{for(w.s();!(x=w.n()).done;){var E=x.value;T[E]=(0,n.lerp)(e[E],t[E],r)}}catch(e){w.e(e)}finally{w.f()}return T}var A=r*_,S=Math.cosh(b)/Math.cosh(b+y*A),P=m*((Math.cosh(b)*Math.tanh(b+y*A)-Math.sinh(b))/v)/g,M=l+(0,i.scaleToZoom)(1/S),R=a.scale([],p,P);a.add(R,R,h);var C=(0,i.worldToLngLat)(R);return{longitude:C[0],latitude:C[1],zoom:M}},flyToViewport.getFlyToDuration=function(e,t,r){var n,i=l(l({},h),r),a=i.screenSpeed,o=i.speed,s=i.maxDuration,u=f(e,t,i),c=u.rho,d=1e3*u.S;return n=Number.isFinite(a)?d/(a/c):d/o,Number.isFinite(s)&&n>s?0:n};var r=e(requireDefineProperty()),n=requireMathUtils$1(),i=requireWebMercatorUtils(),a=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=o(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=a?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,n&&n.set(e,i),i}(requireVec2());function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=.01,d=["longitude","latitude","zoom"],h={curve:1.414,speed:1.2};function f(e,t,r){var n=(r=Object.assign({},h,r)).curve,o=e.zoom,s=[e.longitude,e.latitude],l=(0,i.zoomToScale)(o),u=[t.longitude,t.latitude],d=(0,i.zoomToScale)(t.zoom-o),f=(0,i.lngLatToWorld)(s),p=(0,i.lngLatToWorld)(u),m=a.sub([],p,f),g=Math.max(e.width,e.height),_=g/d,y=a.length(m)*l,v=Math.max(y,c),b=n*n,x=(_*_-g*g+b*b*v*v)/(2*g*b*v),T=(_*_-g*g-b*b*v*v)/(2*_*b*v),w=Math.log(Math.sqrt(x*x+1)-x),E=Math.log(Math.sqrt(T*T+1)-T);return{startZoom:o,startCenterXY:f,uDelta:m,w0:g,u1:y,S:(E-w)/n,rho:n,rho2:b,r0:w,r1:E}}return flyToViewport}function requireShadow(){if(hasRequiredShadow)return shadow;hasRequiredShadow=1;var e=interopRequireDefaultExports;Object.defineProperty(shadow,"__esModule",{value:!0}),shadow.default=void 0;var t=e(requireToConsumableArray()),r=e(requireSlicedToArray()),n=constants$4,i=e(requireProject()),a=es5$q,o=e(requireMemoize()),s=es5$7;function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var u=(0,o.default)((function(e){var t=e.center;return new a.Matrix4(e.viewport.viewProjectionMatrix).invert().transform(t)})),c=(0,o.default)((function(e){var n,i=e.viewport,o=e.shadowMatrices,u=[],c=i.pixelUnprojectionMatrix,d=i.isGeospatial?void 0:1,h=[[0,0,d],[i.width,0,d],[0,i.height,d],[i.width,i.height,d],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map((function(e){return function(e,t){var n=(0,r.default)(e,3),i=n[2],a=(0,s.pixelsToWorld)([n[0],n[1],i],t);return Number.isFinite(i)?a:[a[0],a[1],0]}(e,c)})),f=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(o);try{var p=function(){var e=n.value,r=e.clone().translate(new a.Vector3(i.center).negate()),o=h.map((function(e){return r.transform(e)})),s=(new a.Matrix4).ortho({left:Math.min.apply(Math,(0,t.default)(o.map((function(e){return e[0]})))),right:Math.max.apply(Math,(0,t.default)(o.map((function(e){return e[0]})))),bottom:Math.min.apply(Math,(0,t.default)(o.map((function(e){return e[1]})))),top:Math.max.apply(Math,(0,t.default)(o.map((function(e){return e[1]})))),near:Math.min.apply(Math,(0,t.default)(o.map((function(e){return-e[2]})))),far:Math.max.apply(Math,(0,t.default)(o.map((function(e){return-e[2]}))))});u.push(s.multiplyRight(e))};for(f.s();!(n=f.n()).done;)p()}catch(e){f.e(e)}finally{f.f()}return u})),d=[0,0,0,1],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],f={name:"shadow",dependencies:[i.default],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?function(e,t){var r=e.shadowEnabled;if(void 0!==r&&!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};for(var i={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||d,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},o=u({viewport:e.viewport,center:t.project_uCenter}),s=[],l=c({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice(),f=0;f<e.shadowMatrices.length;f++){var p=l[f],m=p.clone().translate(new a.Vector3(e.viewport.center).negate());t.project_uCoordinateSystem===n.COORDINATE_SYSTEM.LNGLAT&&t.project_uProjectionMode===n.PROJECTION_MODE.WEB_MERCATOR?(l[f]=m,s[f]=o):(l[f]=p.clone().multiplyRight(h),s[f]=m.transform(o))}for(var g=0;g<l.length;g++)i["shadow_uViewProjectionMatrices[".concat(g,"]")]=l[g],i["shadow_uProjectCenters[".concat(g,"]")]=s[g],i["shadow_uShadowMap".concat(g)]=e.shadowMaps&&e.shadowMaps.length>0?e.shadowMaps[g]:e.dummyShadowMap;return i}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}):{}}};return shadow.default=f,shadow}function requireLightingEffect(){if(hasRequiredLightingEffect)return lightingEffect;hasRequiredLightingEffect=1;var e=interopRequireDefaultExports;Object.defineProperty(lightingEffect,"__esModule",{value:!0}),lightingEffect.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=requireAmbientLight(),o=requireDirectionalLight(),s=es5$q,l=e(requireShadowPass()),u=e(requireShadow());function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h={color:[255,255,255],intensity:1},f=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],p=[0,0,0,200/255],m=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"id","lighting-effect"),(0,n.default)(this,"props",void 0),(0,n.default)(this,"shadowColor",p),(0,n.default)(this,"shadow",void 0),(0,n.default)(this,"ambientLight",void 0),(0,n.default)(this,"directionalLights",void 0),(0,n.default)(this,"pointLights",void 0),(0,n.default)(this,"shadowPasses",[]),(0,n.default)(this,"shadowMaps",[]),(0,n.default)(this,"dummyShadowMap",null),(0,n.default)(this,"programManager",void 0),(0,n.default)(this,"shadowMatrices",void 0),this.setProps(r)}return(0,r.default)(e,[{key:"setProps",value:function(e){for(var t in this.ambientLight=null,this.directionalLights=[],this.pointLights=[],e){var r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((function(e){return e.shadow})),this.props=e}},{key:"preRender",value:function(e,t){var r=t.layers,n=t.layerFilter,a=t.viewports,o=t.onViewportActive,s=t.views;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),0===this.shadowPasses.length&&this._createShadowPasses(e),this.programManager||(this.programManager=i.ProgramManager.getDefaultProgramManager(e),u.default&&this.programManager.addDefaultModule(u.default)),this.dummyShadowMap||(this.dummyShadowMap=new i.Texture2D(e,{width:1,height:1}));for(var l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:r,layerFilter:n,viewports:a,onViewportActive:o,views:s,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}},{key:"getModuleParameters",value:function(e){var t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((function(t){return t.getProjectedLight({layer:e})})),pointLights:this.pointLights.map((function(t){return t.getProjectedLight({layer:e})}))},t}},{key:"cleanup",value:function(){var e,t=c(this.shadowPasses);try{for(t.s();!(e=t.n()).done;)e.value.delete()}catch(e){t.e(e)}finally{t.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(u.default),this.programManager=null)}},{key:"_calculateMatrices",value:function(){var e,t=[],r=c(this.directionalLights);try{for(r.s();!(e=r.n()).done;){var n=e.value,i=(new s.Matrix4).lookAt({eye:new s.Vector3(n.direction).negate()});t.push(i)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"_createShadowPasses",value:function(e){for(var t=0;t<this.directionalLights.length;t++){var r=new l.default(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}},{key:"_applyDefaultLights",value:function(){this.ambientLight||0!==this.pointLights.length||0!==this.directionalLights.length||(this.ambientLight=new a.AmbientLight(h),this.directionalLights.push(new o.DirectionalLight(f[0]),new o.DirectionalLight(f[1])))}}]),e}();return lightingEffect.default=m,lightingEffect}!function(e){var t=interopRequireDefaultExports,r=_typeofExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"WebMercatorViewport",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"getBounds",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"fitBounds",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"normalizeViewportProps",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"flyToViewport",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"getFlyToDuration",{enumerable:!0,get:function(){return s.getFlyToDuration}}),Object.defineProperty(e,"MAX_LATITUDE",{enumerable:!0,get:function(){return l.MAX_LATITUDE}}),Object.defineProperty(e,"lngLatToWorld",{enumerable:!0,get:function(){return l.lngLatToWorld}}),Object.defineProperty(e,"worldToLngLat",{enumerable:!0,get:function(){return l.worldToLngLat}}),Object.defineProperty(e,"worldToPixels",{enumerable:!0,get:function(){return l.worldToPixels}}),Object.defineProperty(e,"pixelsToWorld",{enumerable:!0,get:function(){return l.pixelsToWorld}}),Object.defineProperty(e,"zoomToScale",{enumerable:!0,get:function(){return l.zoomToScale}}),Object.defineProperty(e,"scaleToZoom",{enumerable:!0,get:function(){return l.scaleToZoom}}),Object.defineProperty(e,"altitudeToFovy",{enumerable:!0,get:function(){return l.altitudeToFovy}}),Object.defineProperty(e,"fovyToAltitude",{enumerable:!0,get:function(){return l.fovyToAltitude}}),Object.defineProperty(e,"getMeterZoom",{enumerable:!0,get:function(){return l.getMeterZoom}}),Object.defineProperty(e,"unitsPerMeter",{enumerable:!0,get:function(){return l.unitsPerMeter}}),Object.defineProperty(e,"getDistanceScales",{enumerable:!0,get:function(){return l.getDistanceScales}}),Object.defineProperty(e,"addMetersToLngLat",{enumerable:!0,get:function(){return l.addMetersToLngLat}}),Object.defineProperty(e,"getViewMatrix",{enumerable:!0,get:function(){return l.getViewMatrix}}),Object.defineProperty(e,"getProjectionMatrix",{enumerable:!0,get:function(){return l.getProjectionMatrix}}),Object.defineProperty(e,"getProjectionParameters",{enumerable:!0,get:function(){return l.getProjectionParameters}});var n=t(requireWebMercatorViewport$1()),i=t(requireGetBounds()),a=t(requireFitBounds()),o=t(requireNormalizeViewportProps()),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=u(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireFlyToViewport()),l=requireWebMercatorUtils();function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}}(es5$7);var pointLight={},projectFunctions={},webMercatorViewport={},viewport={},mathUtils={},typedArrayManager={},hasRequiredTypedArrayManager,hasRequiredMathUtils,hasRequiredViewport,hasRequiredWebMercatorViewport,hasRequiredProjectFunctions,hasRequiredPointLight;function requireTypedArrayManager(){if(hasRequiredTypedArrayManager)return typedArrayManager;hasRequiredTypedArrayManager=1;var e=interopRequireDefaultExports;Object.defineProperty(typedArrayManager,"__esModule",{value:!0}),typedArrayManager.default=typedArrayManager.TypedArrayManager=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"_pool",[]),(0,n.default)(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(r)}return(0,r.default)(e,[{key:"setOptions",value:function(e){Object.assign(this.opts,e)}},{key:"allocate",value:function(e,t,r){var n=r.size,i=void 0===n?1:n,a=r.padding,o=void 0===a?0:a,s=r.copy,l=void 0!==s&&s,u=r.initialize,c=void 0!==u&&u,d=r.maxCount,h=r.type||e&&e.constructor||Float32Array,f=t*i+o;if(ArrayBuffer.isView(e)){if(f<=e.length)return e;if(f*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,f)}var p=1/0;d&&(p=d*i+o);var m=this._allocate(h,f,c,p);return e&&l?m.set(e):c||m.fill(0,0,4),this._release(e),m}},{key:"release",value:function(e){this._release(e)}},{key:"_allocate",value:function(e,t,r,n){var i=Math.max(Math.ceil(t*this.opts.overAlloc),1);i>n&&(i=n);var a=this._pool,o=e.BYTES_PER_ELEMENT*i,s=a.findIndex((function(e){return e.byteLength>=o}));if(s>=0){var l=new e(a.splice(s,1)[0],0,i);return r&&l.fill(0),l}return new e(i)}},{key:"_release",value:function(e){if(ArrayBuffer.isView(e)){var t=this._pool,r=e.buffer,n=r.byteLength,i=t.findIndex((function(e){return e.byteLength>=n}));i<0?t.push(r):(i>0||t.length<this.opts.poolSize)&&t.splice(i,0,r),t.length>this.opts.poolSize&&t.shift()}}}]),e}();typedArrayManager.TypedArrayManager=i;var a=new i;return typedArrayManager.default=a,typedArrayManager}function requireMathUtils(){if(hasRequiredMathUtils)return mathUtils;hasRequiredMathUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(mathUtils,"__esModule",{value:!0}),mathUtils.createMat4=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},mathUtils.mod=function(e,t){var r=e%t;return r<0?t+r:r},mathUtils.getCameraPosition=function(e){return[e[12],e[13],e[14]]},mathUtils.getFrustumPlanes=function(e){return{left:o(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:o(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:o(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:o(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:o(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:o(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}},mathUtils.fp64LowPart=s,mathUtils.toDoublePrecisionArray=function(e,r){var n=r.size,a=void 0===n?1:n,o=r.startIndex,l=void 0===o?0:o,u=void 0!==r.endIndex?r.endIndex:e.length,c=(u-l)/a;i=t.default.allocate(i,c,{type:Float32Array,size:2*a});for(var d=l,h=0;d<u;){for(var f=0;f<a;f++){var p=e[d++];i[h+f]=p,i[h+f+a]=s(p)}h+=2*a}return i.subarray(0,c*a*2)},mathUtils.mergeBounds=function(e){var t,r=null,i=!1,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;o&&(r?(i||(r=[[r[0][0],r[0][1]],[r[1][0],r[1][1]]],i=!0),r[0][0]=Math.min(r[0][0],o[0][0]),r[0][1]=Math.min(r[0][1],o[0][1]),r[1][0]=Math.max(r[1][0],o[1][0]),r[1][1]=Math.max(r[1][1],o[1][1])):r=o)}}catch(e){a.e(e)}finally{a.f()}return r};var t=e(requireTypedArrayManager()),r=es5$q;function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i,a=new r.Vector3;function o(e,t,n,i){a.set(e,t,n);var o=a.len();return{distance:i/o,normal:new r.Vector3(-e/o,-t/o,-n/o)}}function s(e){return e-Math.fround(e)}return mathUtils}function requireViewport(){if(hasRequiredViewport)return viewport;hasRequiredViewport=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(viewport,"__esModule",{value:!0}),viewport.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=e(requireLog()),s=requireMathUtils(),l=es5$q,u=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireMat4()),c=es5$7,d=constants$4;function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}var f=Math.PI/180,p=(0,s.createMat4)(),m=[0,0,0],g={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]},_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,e),(0,a.default)(this,"id",void 0),(0,a.default)(this,"x",void 0),(0,a.default)(this,"y",void 0),(0,a.default)(this,"width",void 0),(0,a.default)(this,"height",void 0),(0,a.default)(this,"padding",void 0),(0,a.default)(this,"isGeospatial",void 0),(0,a.default)(this,"zoom",void 0),(0,a.default)(this,"focalDistance",void 0),(0,a.default)(this,"position",void 0),(0,a.default)(this,"modelMatrix",void 0),(0,a.default)(this,"distanceScales",void 0),(0,a.default)(this,"scale",void 0),(0,a.default)(this,"center",void 0),(0,a.default)(this,"cameraPosition",void 0),(0,a.default)(this,"projectionMatrix",void 0),(0,a.default)(this,"viewMatrix",void 0),(0,a.default)(this,"viewMatrixUncentered",void 0),(0,a.default)(this,"viewMatrixInverse",void 0),(0,a.default)(this,"viewProjectionMatrix",void 0),(0,a.default)(this,"pixelProjectionMatrix",void 0),(0,a.default)(this,"pixelUnprojectionMatrix",void 0),(0,a.default)(this,"resolution",void 0),(0,a.default)(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||g,this.focalDistance=t.focalDistance||1,this.position=t.position||m,this.modelMatrix=t.modelMatrix||null;var r=t.longitude;this.isGeospatial=Number.isFinite(t.latitude)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,i.default)(e,[{key:"subViewports",get:function(){return null}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?d.PROJECTION_MODE.WEB_MERCATOR:d.PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:d.PROJECTION_MODE.IDENTITY}},{key:"equals",value:function(t){return t instanceof e&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&(0,l.equals)(t.projectionMatrix,this.projectionMatrix)&&(0,l.equals)(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===t||t,i=this.projectPosition(e),a=(0,c.worldToPixels)(i,this.pixelProjectionMatrix),o=(0,r.default)(a,2),s=o[0],l=o[1],u=n?l:this.height-l;return 2===e.length?[s,u]:[s,u,a[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,a=t.targetZ,o=(0,r.default)(e,3),s=o[1],l=o[2],u=(0,c.pixelsToWorld)([o[0],i?s:this.height-s,l],this.pixelUnprojectionMatrix,a&&a*this.distanceScales.unitsPerMeter[2]),d=this.unprojectPosition(u),h=(0,r.default)(d,3),f=h[0],p=h[1],m=h[2];return Number.isFinite(l)?[f,p,m]:Number.isFinite(a)?[f,p,a]:[f,p]}},{key:"projectPosition",value:function(e){var t=this.projectFlat(e),n=(0,r.default)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(e){var t=this.unprojectFlat(e),n=(0,r.default)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(e){if(this.isGeospatial){var t=(0,c.lngLatToWorld)(e);return t[1]=(0,l.clamp)(t[1],-318,830),t}return e}},{key:"unprojectFlat",value:function(e){return this.isGeospatial?(0,c.worldToLngLat)(e):e}},{key:"getBounds",value:function(){var e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,0],e),r=this.unproject([this.width,0],e),n=this.unproject([0,this.height],e),i=this.unproject([this.width,this.height],e);return[Math.min(t[0],r[0],n[0],i[0]),Math.min(t[1],r[1],n[1],i[1]),Math.max(t[0],r[0],n[0],i[0]),Math.max(t[1],r[1],n[1],i[1])]}},{key:"getDistanceScales",value:function(e){return e?(0,c.getDistanceScales)({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(e){var t=e.x,r=e.y,n=e.width,i=e.height;return t<this.x+this.width&&this.x<t+(void 0===n?1:n)&&r<this.y+this.height&&this.y<r+(void 0===i?1:i)}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,(0,s.getFrustumPlanes)(this.viewProjectionMatrix)),this._frustumPlanes}},{key:"panByPosition",value:function(e,t){return null}},{key:"_initProps",value:function(e){var t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=(0,c.getMeterZoom)({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||(0,c.getDistanceScales)({latitude:r,longitude:t}));var n=Math.pow(2,this.zoom);this.scale=n;var i=e.position,a=e.modelMatrix,o=m;if(i&&(o=a?new l.Matrix4(a).transformAsVector(i,[]):i),this.isGeospatial){var s=this.projectPosition([t,r,0]);this.center=new l.Vector3(o).scale(this.distanceScales.unitsPerMeter).add(s)}else this.center=this.projectPosition(o)}},{key:"_initMatrices",value:function(e){var t=e.viewMatrix,r=void 0===t?p:t,n=e.projectionMatrix,i=void 0===n?null:n,a=e.orthographic,c=void 0!==a&&a,d=e.fovyRadians,h=e.fovy,m=void 0===h?75:h,g=e.near,_=void 0===g?.1:g,y=e.far,v=void 0===y?1e3:y,b=e.padding,x=void 0===b?null:b,T=e.focalDistance,w=void 0===T?1:T;this.viewMatrixUncentered=r,this.viewMatrix=(new l.Matrix4).multiplyRight(r).translate(new l.Vector3(this.center).negate()),this.projectionMatrix=i||function(e){var t=e.width,r=e.height,n=e.fovyRadians,i=e.focalDistance,a=e.padding,o=e.near,s=e.far,u=t/r,c=e.orthographic?(new l.Matrix4).orthographic({fovy:n,aspect:u,focalDistance:i,near:o,far:s}):(new l.Matrix4).perspective({fovy:n,aspect:u,near:o,far:s});if(a){var d=a.left,h=a.right,f=a.top,p=void 0===f?0:f,m=a.bottom,g=void 0===m?0:m,_=(0,l.clamp)(((void 0===d?0:d)+t-(void 0===h?0:h))/2,0,t)-t/2,y=(0,l.clamp)((p+r-g)/2,0,r)-r/2;c[8]-=2*_/t,c[9]+=2*y/r}return c}({width:this.width,height:this.height,orthographic:c,fovyRadians:d||m*f,focalDistance:w,padding:x,near:_,far:v});var E=(0,s.createMat4)();u.multiply(E,E,this.projectionMatrix),u.multiply(E,E,this.viewMatrix),this.viewProjectionMatrix=E,this.viewMatrixInverse=u.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=(0,s.getCameraPosition)(this.viewMatrixInverse);var A=(0,s.createMat4)(),S=(0,s.createMat4)();u.scale(A,A,[this.width/2,-this.height/2,1]),u.translate(A,A,[1,-1,0]),u.multiply(S,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=S,this.pixelUnprojectionMatrix=u.invert((0,s.createMat4)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||o.default.warn("Pixel project matrix not invertible")()}}]),e}();return viewport.default=_,(0,a.default)(_,"displayName","Viewport"),viewport}function requireWebMercatorViewport(){if(hasRequiredWebMercatorViewport)return webMercatorViewport;hasRequiredWebMercatorViewport=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(webMercatorViewport,"__esModule",{value:!0}),webMercatorViewport.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireGet()),s=e(requireInherits()),l=e(requirePossibleConstructorReturn()),u=e(requireGetPrototypeOf()),c=e(requireDefineProperty()),d=e(requireViewport()),h=es5$7,f=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=m(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec2()),p=es5$q;function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,c.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y=function(e){(0,s.default)(g,e);var t,d,m=(t=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,u.default)(t);if(d){var n=(0,u.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,l.default)(this,e)});function g(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,g);var r,i=t.latitude,o=void 0===i?0:i,s=t.longitude,l=void 0===s?0:s,u=t.zoom,d=void 0===u?0:u,f=t.pitch,y=void 0===f?0:f,v=t.bearing,b=void 0===v?0:v,x=t.nearZMultiplier,T=void 0===x?.1:x,w=t.farZMultiplier,E=void 0===w?1.01:w,A=t.nearZ,S=t.farZ,P=t.orthographic,M=void 0!==P&&P,R=t.projectionMatrix,C=t.repeat,O=void 0!==C&&C,L=t.worldOffset,I=void 0===L?0:L,D=t.position,k=t.padding,B=t.legacyMeterSizes,F=void 0!==B&&B,N=t.width,q=t.height,U=t.altitude,j=void 0===U?1.5:U,G=Math.pow(2,d);N=N||1,q=q||1;var z=null;if(R)r=(0,h.altitudeToFovy)(j=R[5]/2);else{var V;if(t.fovy?j=(0,h.fovyToAltitude)(r=t.fovy):r=(0,h.altitudeToFovy)(j),k){var $=k.top,H=k.bottom;V=[0,(0,p.clamp)(((void 0===$?0:$)+q-(void 0===H?0:H))/2,0,q)-q/2]}z=(0,h.getProjectionParameters)({width:N,height:q,scale:G,center:D&&[0,0,D[2]*(0,h.unitsPerMeter)(o)],offset:V,pitch:y,fovy:r,nearZMultiplier:T,farZMultiplier:E}),Number.isFinite(A)&&(z.near=A),Number.isFinite(S)&&(z.far=S)}var W=(0,h.getViewMatrix)({height:q,pitch:y,bearing:b,scale:G,altitude:j});return I&&(W=(new p.Matrix4).translate([512*I,0,0]).multiplyLeft(W)),e=m.call(this,_(_(_({},t),{},{width:N,height:q,viewMatrix:W,longitude:l,latitude:o,zoom:d},z),{},{fovy:r,focalDistance:j})),(0,c.default)((0,a.default)(e),"longitude",void 0),(0,c.default)((0,a.default)(e),"latitude",void 0),(0,c.default)((0,a.default)(e),"pitch",void 0),(0,c.default)((0,a.default)(e),"bearing",void 0),(0,c.default)((0,a.default)(e),"altitude",void 0),(0,c.default)((0,a.default)(e),"fovy",void 0),(0,c.default)((0,a.default)(e),"orthographic",void 0),(0,c.default)((0,a.default)(e),"_subViewports",void 0),(0,c.default)((0,a.default)(e),"_pseudoMeters",void 0),e.latitude=o,e.longitude=l,e.zoom=d,e.pitch=y,e.bearing=b,e.altitude=j,e.fovy=r,e.orthographic=M,e._subViewports=O?[]:null,e._pseudoMeters=F,Object.freeze((0,a.default)(e)),e}return(0,i.default)(g,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360),n=t;n<=r;n++){var i=n?new g(_(_({},this),{},{worldOffset:n})):this;this._subViewports.push(i)}return this._subViewports}},{key:"projectPosition",value:function(e){if(this._pseudoMeters)return(0,o.default)((0,u.default)(g.prototype),"projectPosition",this).call(this,e);var t=this.projectFlat(e),n=(0,r.default)(t,2);return[n[0],n[1],(e[2]||0)*(0,h.unitsPerMeter)(e[1])]}},{key:"unprojectPosition",value:function(e){if(this._pseudoMeters)return(0,o.default)((0,u.default)(g.prototype),"unprojectPosition",this).call(this,e);var t=this.unprojectFlat(e),n=(0,r.default)(t,2),i=n[1];return[n[0],i,(e[2]||0)/(0,h.unitsPerMeter)(i)]}},{key:"addMetersToLngLat",value:function(e,t){return(0,h.addMetersToLngLat)(e,t)}},{key:"panByPosition",value:function(e,t){var n=(0,h.pixelsToWorld)(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),a=f.add([],i,f.negate([],n)),o=f.add([],this.center,a),s=this.unprojectFlat(o),l=(0,r.default)(s,2);return{longitude:l[0],latitude:l[1]}}},{key:"getBounds",value:function(){var e=(0,h.getBounds)(this,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}},{key:"fitBounds",value:function(e){var t=this.width,r=this.height,n=(0,h.fitBounds)(_({width:t,height:r,bounds:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}));return new g({width:t,height:r,longitude:n.longitude,latitude:n.latitude,zoom:n.zoom})}}]),g}(d.default);return webMercatorViewport.default=y,(0,c.default)(y,"displayName","WebMercatorViewport"),webMercatorViewport}function requireProjectFunctions(){if(hasRequiredProjectFunctions)return projectFunctions;hasRequiredProjectFunctions=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(projectFunctions,"__esModule",{value:!0}),projectFunctions.getWorldPosition=f,projectFunctions.projectPosition=function(e,t){var r=function(e){var t=e.viewport,r=e.coordinateOrigin,i=e.coordinateSystem,a=e.fromCoordinateSystem,o=e.fromCoordinateOrigin;return i===n.COORDINATE_SYSTEM.DEFAULT&&(i=t.isGeospatial?n.COORDINATE_SYSTEM.LNGLAT:n.COORDINATE_SYSTEM.CARTESIAN),void 0===a&&(a=i),void 0===o&&(o=r),{viewport:t,coordinateSystem:i,coordinateOrigin:r,modelMatrix:e.modelMatrix,fromCoordinateSystem:a,fromCoordinateOrigin:o}}(t),a=r.viewport,o=r.modelMatrix,l=r.fromCoordinateSystem,u=r.fromCoordinateOrigin,c=t.autoOffset,h=void 0===c||c?(0,i.getOffsetOrigin)(a,r.coordinateSystem,r.coordinateOrigin):{},p=h.geospatialOrigin,m=void 0===p?d:p,g=h.shaderCoordinateOrigin,_=void 0===g?d:g,y=h.offsetMode,v=void 0!==y&&y,b=f(e,{viewport:a,modelMatrix:o,coordinateSystem:l,coordinateOrigin:u,offsetMode:v});if(v){var x=a.projectPosition(m||_);s.sub(b,b,x)}return b};var r=e(requireSlicedToArray()),n=constants$4,i=requireViewportUniforms(),a=e(requireWebMercatorViewport()),o=c(requireVec4()),s=c(requireVec3()),l=es5$7;function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function c(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=u(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}var d=[0,0,0];function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.projectPosition(e);if(n&&t instanceof a.default){var o=(0,r.default)(e,3),s=o[2],l=void 0===s?0:s,u=t.getDistanceScales([o[0],o[1]]);i[2]=l*u.unitsPerMeter[2]}return i}function f(e,t){var i=t.viewport,a=t.modelMatrix,s=t.coordinateSystem,u=t.coordinateOrigin,c=t.offsetMode,d=(0,r.default)(e,3),f=d[0],p=d[1],m=d[2],g=void 0===m?0:m;if(a){var _=o.transformMat4([],[f,p,g,1],a),y=(0,r.default)(_,3);f=y[0],p=y[1],g=y[2]}switch(s){case n.COORDINATE_SYSTEM.LNGLAT:return h([f,p,g],i,c);case n.COORDINATE_SYSTEM.LNGLAT_OFFSETS:return h([f+u[0],p+u[1],g+(u[2]||0)],i,c);case n.COORDINATE_SYSTEM.METER_OFFSETS:return h((0,l.addMetersToLngLat)(u,[f,p,g]),i,c);default:return i.isGeospatial?[f+u[0],p+u[1],g+u[2]]:i.projectPosition([f,p,g])}}return projectFunctions}function requirePointLight(){if(hasRequiredPointLight)return pointLight;hasRequiredPointLight=1;var e=interopRequireDefaultExports;Object.defineProperty(pointLight,"__esModule",{value:!0}),pointLight.PointLight=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireProjectFunctions(),a=constants$4;function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var s=[255,255,255],l=[0,0,1],u=[0,0,1],c=0,d=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"color",void 0),(0,n.default)(this,"intensity",void 0),(0,n.default)(this,"type","point"),(0,n.default)(this,"position",void 0),(0,n.default)(this,"attenuation",void 0),(0,n.default)(this,"projectedLight",void 0);var i=r.color,a=void 0===i?s:i,d=r.intensity,h=void 0===d?1:d,f=r.position,p=void 0===f?u:f;this.id=r.id||"point-".concat(c++),this.color=a,this.intensity=h,this.type="point",this.position=p,this.attenuation=function(e){return e.attenuation?e.attenuation:"intensity"in e?[0,0,e.intensity||0]:l}(r),this.projectedLight=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},this)}return(0,r.default)(e,[{key:"getProjectedLight",value:function(e){var t=e.layer,r=this.projectedLight,n=t.context.viewport,o=t.props,s=(0,i.projectPosition)(this.position,{viewport:n,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,fromCoordinateSystem:n.isGeospatial?a.COORDINATE_SYSTEM.LNGLAT:a.COORDINATE_SYSTEM.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return r.color=this.color,r.intensity=this.intensity,r.position=s,r}}]),e}();return pointLight.PointLight=d,pointLight}var cameraLight={},hasRequiredCameraLight;function requireCameraLight(){if(hasRequiredCameraLight)return cameraLight;hasRequiredCameraLight=1;var e=interopRequireDefaultExports;Object.defineProperty(cameraLight,"__esModule",{value:!0}),cameraLight.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=requirePointLight(),s=requireViewportUniforms(),l=function(e){(0,n.default)(c,e);var o,l,u=(o=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(l){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function c(){return(0,t.default)(this,c),u.apply(this,arguments)}return(0,r.default)(c,[{key:"getProjectedLight",value:function(e){var t=e.layer,r=this.projectedLight,n=t.props,i=(0,s.getUniformsFromViewport)({viewport:t.context.viewport,modelMatrix:n.modelMatrix,coordinateSystem:n.coordinateSystem,coordinateOrigin:n.coordinateOrigin}).project_uCameraPosition;return r.color=this.color,r.intensity=this.intensity,r.position=i,r}}]),c}(o.PointLight);return cameraLight.default=l,cameraLight}var sunLight={},es5$6={},suncalc={},hasRequiredSuncalc,hasRequiredEs5$2,hasRequiredSunLight;function requireSuncalc(){if(hasRequiredSuncalc)return suncalc;hasRequiredSuncalc=1,Object.defineProperty(suncalc,"__esModule",{value:!0}),suncalc.getSunPosition=u,suncalc.getSunDirection=function(e,t,r){var n=u(e,t,r),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]};var e=Math.PI/180,t=864e5,r=2440588,n=2451545,i=23.4397*e,a=357.5291,o=.98560028,s=280.147,l=360.9856235;function u(u,f,p){var m,g,_,y,v=e*-p,b=e*f,x=function(e){return function(e){return("number"==typeof e?e:e.getTime())/t-.5+r}(e)-n}(u),T={declination:(_=g=(m=e*(a+o*x))+e*(1.9148*Math.sin(m)+.02*Math.sin(2*m)+3e-4*Math.sin(3*m))+102.9372*e+Math.PI,0,y=_,Math.asin(Math.sin(0)*Math.cos(i)+Math.cos(0)*Math.sin(i)*Math.sin(y))),rightAscension:c(g,0)},w=function(t,r){return e*(s+l*t)-r}(x,v)-T.rightAscension;return{azimuth:d(w,b,T.declination),altitude:h(w,b,T.declination)}}function c(e,t){var r=e;return Math.atan2(Math.sin(r)*Math.cos(i)-Math.tan(t)*Math.sin(i),Math.cos(r))}function d(e,t,r){var n=e,i=t,a=r;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function h(e,t,r){var n=e,i=t,a=r;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}return suncalc}function requireEs5$2(){return hasRequiredEs5$2||(hasRequiredEs5$2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getSunPosition",{enumerable:!0,get:function(){return t.getSunPosition}}),Object.defineProperty(e,"getSunDirection",{enumerable:!0,get:function(){return t.getSunDirection}});var t=requireSuncalc()}(es5$6)),es5$6}function requireSunLight(){if(hasRequiredSunLight)return sunLight;hasRequiredSunLight=1;var e=interopRequireDefaultExports;Object.defineProperty(sunLight,"__esModule",{value:!0}),sunLight.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=requireDirectionalLight(),c=requireEs5$2(),d=function(e){(0,a.default)(f,e);var u,d,h=(u=f,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(d){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function f(e){var t;return(0,r.default)(this,f),t=h.call(this,e),(0,l.default)((0,i.default)(t),"timestamp",void 0),t.timestamp=e.timestamp,t}return(0,n.default)(f,[{key:"getProjectedLight",value:function(e){var r=e.layer.context.viewport;if(r.resolution&&r.resolution>0){var n=(0,c.getSunDirection)(this.timestamp,0,0),i=(0,t.default)(n,3);this.direction=[i[0],-i[2],i[1]]}else this.direction=(0,c.getSunDirection)(this.timestamp,r.latitude,r.longitude);return this}}]),f}(u.DirectionalLight);return sunLight.default=d,sunLight}var postProcessEffect={},screenPass={},hasRequiredScreenPass,hasRequiredPostProcessEffect;function requireScreenPass(){if(hasRequiredScreenPass)return screenPass;hasRequiredScreenPass=1;var e=interopRequireDefaultExports;Object.defineProperty(screenPass,"__esModule",{value:!0}),screenPass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$d,u=function(e){(0,i.default)(h,e);var u,c,d=(u=h,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(u);if(c){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function h(e,r){var i;return(0,t.default)(this,h),i=d.call(this,e,r),(0,s.default)((0,n.default)(i),"model",void 0),i.model=new l.ClipSpace(e,{id:r.id,fs:r.fs,modules:[r.module]}),i}return(0,r.default)(h,[{key:"render",value:function(e){var t=this,r=this.gl;(0,l.setParameters)(r,{viewport:[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}),(0,l.withParameters)(r,{framebuffer:e.outputBuffer,clearColor:[0,0,0,0]},(function(){return t._renderPass(r,e)}))}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(e,t){var r=t.inputBuffer;(0,l.clear)(e,{color:!0}),this.model.draw({moduleSettings:t.moduleSettings,uniforms:{texture:r,texSize:[r.width,r.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),h}(e(requirePass()).default);return screenPass.default=u,screenPass}function requirePostProcessEffect(){if(hasRequiredPostProcessEffect)return postProcessEffect;hasRequiredPostProcessEffect=1;var e=interopRequireDefaultExports;Object.defineProperty(postProcessEffect,"__esModule",{value:!0}),postProcessEffect.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireScreenPass()),a=es5$d;function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=function(){function e(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"props",void 0),(0,n.default)(this,"module",void 0),(0,n.default)(this,"passes",void 0),this.id="".concat(r.name,"-pass"),this.props=i,(0,a.normalizeShaderModule)(r),this.module=r}return(0,r.default)(e,[{key:"setProps",value:function(e){this.props=e}},{key:"preRender",value:function(){}},{key:"postRender",value:function(e,t){var r=this.passes||function(e,t,r){if(!t.passes){var n=c(t);return[new i.default(e,{id:r,module:t,fs:n})]}return t.passes.map((function(n,a){var o=c(t,n),s="".concat(r,"-").concat(a);return new i.default(e,{id:s,module:t,fs:o})}))}(e,this.module,this.id);this.passes=r;for(var n=t.target,a=t.inputBuffer,o=t.swapBuffer,s=0;s<this.passes.length;s++){n&&s===this.passes.length-1&&(o=n),this.passes[s].render({inputBuffer:a,outputBuffer:o,moduleSettings:this.props});var l=o;o=a,a=l}return a}},{key:"cleanup",value:function(){if(this.passes){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}(this.passes);try{for(t.s();!(e=t.n()).done;)e.value.delete()}catch(e){t.e(e)}finally{t.f()}this.passes=void 0}}}]),e}();postProcessEffect.default=s;var l=function(e){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(e,"(gl_FragColor, texSize, texCoord);\n}\n")},u=function(e){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(e,"(texture, texSize, texCoord);\n}\n")};function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(t.filter){var r="string"==typeof t.filter?t.filter:"".concat(e.name,"_filterColor");return l(r)}if(t.sampler){var n="string"==typeof t.sampler?t.sampler:"".concat(e.name,"_sampleColor");return u(n)}return null}return postProcessEffect}var pickLayersPass={},hasRequiredPickLayersPass;function requirePickLayersPass(){if(hasRequiredPickLayersPass)return pickLayersPass;hasRequiredPickLayersPass=1;var e=interopRequireDefaultExports;Object.defineProperty(pickLayersPass,"__esModule",{value:!0}),pickLayersPass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=e(requireLayersPass()),c=es5$d,d=e(requireLog());function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={blendFunc:[1,0,32771,0],blendEquation:32774},m=function(e){(0,a.default)(_,e);var u,h,m=(u=_,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(h){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function _(){var e;(0,t.default)(this,_);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=m.call.apply(m,[this].concat(i)),(0,l.default)((0,n.default)(e),"pickZ",void 0),(0,l.default)((0,n.default)(e),"_colorEncoderState",null),e}return(0,r.default)(_,[{key:"render",value:function(e){return"pickingFBO"in e?this._drawPickingBuffer(e):(0,i.default)((0,s.default)(_.prototype),"render",this).call(this,e)}},{key:"_drawPickingBuffer",value:function(e){var t=this,r=e.layers,n=e.layerFilter,a=e.views,o=e.viewports,l=e.onViewportActive,u=e.pickingFBO,d=e.deviceRect,h=d.x,m=d.y,y=d.width,v=d.height,b=e.cullRect,x=e.effects,T=e.pass,w=void 0===T?"picking":T,E=e.pickZ,A=e.moduleParameters,S=this.gl;this.pickZ=E;var P=this._resetColorEncoder(E),M=(0,c.withParameters)(S,f(f({scissorTest:!0,scissor:[h,m,y,v],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},p),{},{blend:!E}),(function(){return(0,i.default)((0,s.default)(_.prototype),"render",t).call(t,{target:u,layers:r,layerFilter:n,views:a,viewports:o,onViewportActive:l,cullRect:b,effects:null==x?void 0:x.filter((function(e){return e.useInPicking})),pass:w,isPicking:!0,moduleParameters:A})}));return this._colorEncoderState=null,{decodePickingColor:P&&g.bind(null,P),stats:M}}},{key:"shouldDrawLayer",value:function(e){var t=e.props,r=t.operation;return t.pickable&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(e,t,r){var n=f({},e.props.parameters),i=e.props,a=i.operation;return this._colorEncoderState?i.pickable&&a.includes("draw")&&(Object.assign(n,p),n.blend=!0,n.blendColor=function(e,t,r){var n,i=e.byLayer,a=e.byAlpha,o=i.get(t);return o?(o.viewports.push(r),n=o.a):(n=i.size+1)<=255?(i.set(t,o={a:n,layer:t,viewports:[r]}),a[n]=o):(d.default.warn("Too many pickable layers, only picking the first 255")(),n=0),[0,0,0,n/255]}(this._colorEncoderState,e,r)):n.blend=!1,a.includes("terrain")&&(n.blend=!1),n}},{key:"_resetColorEncoder",value:function(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}]),_}(u.default);function g(e,t){var r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}return pickLayersPass.default=m,pickLayersPass}var deck={},layerManager={},constants$2={},hasRequiredConstants$2;function requireConstants$2(){if(hasRequiredConstants$2)return constants$2;hasRequiredConstants$2=1,Object.defineProperty(constants$2,"__esModule",{value:!0}),constants$2.ASYNC_RESOLVED_SYMBOL=constants$2.ASYNC_ORIGINAL_SYMBOL=constants$2.ASYNC_DEFAULTS_SYMBOL=constants$2.DEPRECATED_PROPS_SYMBOL=constants$2.PROP_TYPES_SYMBOL=constants$2.COMPONENT_SYMBOL=constants$2.LIFECYCLE=void 0,constants$2.LIFECYCLE={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"};var e=Symbol.for("component");constants$2.COMPONENT_SYMBOL=e;var t=Symbol.for("propTypes");constants$2.PROP_TYPES_SYMBOL=t;var r=Symbol.for("deprecatedProps");constants$2.DEPRECATED_PROPS_SYMBOL=r;var n=Symbol.for("asyncPropDefaults");constants$2.ASYNC_DEFAULTS_SYMBOL=n;var i=Symbol.for("asyncPropOriginal");constants$2.ASYNC_ORIGINAL_SYMBOL=i;var a=Symbol.for("asyncPropResolved");return constants$2.ASYNC_RESOLVED_SYMBOL=a,constants$2}var flatten={},hasRequiredFlatten;function requireFlatten(){if(hasRequiredFlatten)return flatten;function e(t,r,n){for(var i=-1;++i<t.length;){var a=t[i];Array.isArray(a)?e(a,r,n):r(a)&&n.push(a)}return n}return hasRequiredFlatten=1,Object.defineProperty(flatten,"__esModule",{value:!0}),flatten.flatten=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};return Array.isArray(t)?e(t,r,[]):r(t)?[t]:[]},flatten.fillArray=function(e){for(var t=e.target,r=e.source,n=e.start,i=void 0===n?0:n,a=e.count,o=r.length,s=(void 0===a?1:a)*o,l=0,u=i;l<o;l++)t[u++]=r[l];for(;l<s;)l<s-l?(t.copyWithin(i+l,i,i+l),l*=2):(t.copyWithin(i+l,i,i+s-l),l=s);return t},flatten}var resourceManager={},resource={},hasRequiredResource,hasRequiredResourceManager;function requireResource(){if(hasRequiredResource)return resource;hasRequiredResource=1;var e=interopRequireDefaultExports;Object.defineProperty(resource,"__esModule",{value:!0}),resource.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$n;function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=function(){function e(r,i,a){(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"context",void 0),(0,n.default)(this,"isLoaded",void 0),(0,n.default)(this,"persistent",void 0),(0,n.default)(this,"_loadCount",0),(0,n.default)(this,"_subscribers",new Set),(0,n.default)(this,"_data",void 0),(0,n.default)(this,"_loader",void 0),(0,n.default)(this,"_error",void 0),(0,n.default)(this,"_content",void 0),this.id=r,this.context=a,this.setData(i)}return(0,r.default)(e,[{key:"subscribe",value:function(e){this._subscribers.add(e)}},{key:"unsubscribe",value:function(e){this._subscribers.delete(e)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var e=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((function(){return e.getData()}))}},{key:"setData",value:function(e,t){var r=this;if(e!==this._data||t){this._data=e;var n=++this._loadCount,o=e;"string"==typeof e&&(o=(0,i.load)(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then((function(e){r._loadCount===n&&(r.isLoaded=!0,r._error=void 0,r._content=e)})).catch((function(e){r._loadCount===n&&(r.isLoaded=!0,r._error=e||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=e);var s,l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(this._subscribers);try{for(l.s();!(s=l.n()).done;)s.value.onChange(this.getData())}catch(e){l.e(e)}finally{l.f()}}}}]),e}();return resource.default=o,resource}function requireResourceManager(){if(hasRequiredResourceManager)return resourceManager;hasRequiredResourceManager=1;var e=interopRequireDefaultExports;Object.defineProperty(resourceManager,"__esModule",{value:!0}),resourceManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireResource()),a=function(){function e(r){var i=r.gl,a=r.protocol;(0,t.default)(this,e),(0,n.default)(this,"protocol",void 0),(0,n.default)(this,"_context",void 0),(0,n.default)(this,"_resources",void 0),(0,n.default)(this,"_consumers",void 0),(0,n.default)(this,"_pruneRequest",void 0),this.protocol=a||"resource://",this._context={gl:i,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return(0,r.default)(e,[{key:"contains",value:function(e){return!!e.startsWith(this.protocol)||e in this._resources}},{key:"add",value:function(e){var t=e.resourceId,r=e.data,n=e.forceUpdate,a=e.persistent,o=void 0===a||a,s=this._resources[t];s?s.setData(r,void 0!==n&&n):(s=new i.default(t,r,this._context),this._resources[t]=s),s.persistent=o}},{key:"remove",value:function(e){var t=this._resources[e];t&&(t.delete(),delete this._resources[e])}},{key:"unsubscribe",value:function(e){var t=e.consumerId,r=this._consumers[t];if(r){for(var n in r){var i=r[n],a=this._resources[i.resourceId];a&&a.unsubscribe(i)}delete this._consumers[t],this.prune()}}},{key:"subscribe",value:function(e){var t=e.resourceId,r=e.onChange,n=e.consumerId,i=e.requestId,a=void 0===i?"default":i,o=this._resources,s=this.protocol;t.startsWith(s)&&(o[t=t.replace(s,"")]||this.add({resourceId:t,data:null,persistent:!1}));var l=o[t];if(this._track(n,a,l,r),l)return l.getData()}},{key:"prune",value:function(){var e=this;this._pruneRequest||(this._pruneRequest=setTimeout((function(){return e._prune()}),0))}},{key:"finalize",value:function(){for(var e in this._resources)this._resources[e].delete()}},{key:"_track",value:function(e,t,r,n){var i=this._consumers,a=i[e]=i[e]||{},o=a[t]||{},s=o.resourceId&&this._resources[o.resourceId];s&&(s.unsubscribe(o),this.prune()),r&&(a[t]=o,o.onChange=n,o.resourceId=r.id,r.subscribe(o))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var e=0,t=Object.keys(this._resources);e<t.length;e++){var r=t[e],n=this._resources[r];n.persistent||n.inUse()||(n.delete(),delete this._resources[r])}}}]),e}();return resourceManager.default=a,resourceManager}var shaderlib={},project32={},hasRequiredProject32;function requireProject32(){if(hasRequiredProject32)return project32;hasRequiredProject32=1;var e=interopRequireDefaultExports;Object.defineProperty(project32,"__esModule",{value:!0}),project32.default=void 0;var t=e(requireProject());return project32.default={name:"project32",dependencies:[t.default],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},project32}var picking={},hasRequiredPicking,hasRequiredShaderlib,hasRequiredLayerManager;function requirePicking(){if(hasRequiredPicking)return picking;hasRequiredPicking=1;var e=interopRequireDefaultExports;Object.defineProperty(picking,"__esModule",{value:!0}),picking.default=void 0;var t=e(requireDefineProperty());function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var n=function(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:#decl":"\nuniform bool picking_uAttribute;\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},es5$d.picking);return picking.default=n,picking}function requireShaderlib(){return hasRequiredShaderlib||(hasRequiredShaderlib=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),e.createProgramManager=function(e){var t,n=r.ProgramManager.getDefaultProgramManager(e),i=s(u);try{for(i.s();!(t=i.n()).done;)n.addDefaultModule(t.value)}catch(e){i.e(e)}finally{i.f()}var a,o=s(c);try{for(o.s();!(a=o.n()).done;)n.addShaderHook(a.value)}catch(e){o.e(e)}finally{o.f()}return n},Object.defineProperty(e,"gouraudLighting",{enumerable:!0,get:function(){return r.gouraudLighting}}),Object.defineProperty(e,"phongLighting",{enumerable:!0,get:function(){return r.phongLighting}}),Object.defineProperty(e,"project",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"project32",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"picking",{enumerable:!0,get:function(){return o.default}});var r=es5$d,n=t(requireProject()),i=t(requireProject32()),a=t(requireShadow()),o=t(requirePicking());function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var u=[n.default],c=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"]}(shaderlib)),shaderlib}function requireLayerManager(){if(hasRequiredLayerManager)return layerManager;hasRequiredLayerManager=1;var e=interopRequireDefaultExports;Object.defineProperty(layerManager,"__esModule",{value:!0}),layerManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=requireConstants$2(),o=e(requireLog()),s=e(requireDebug()),l=requireFlatten(),u=requireEs5$3(),c=e(requireResourceManager()),d=e(requireViewport()),h=requireShaderlib();function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=function(){function e(r){var a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=o.deck,f=o.stats,p=o.viewport,m=o.timeline;(0,t.default)(this,e),(0,n.default)(this,"layers",void 0),(0,n.default)(this,"context",void 0),(0,n.default)(this,"resourceManager",void 0),(0,n.default)(this,"_lastRenderedLayers",[]),(0,n.default)(this,"_needsRedraw",!1),(0,n.default)(this,"_needsUpdate",!1),(0,n.default)(this,"_nextLayers",null),(0,n.default)(this,"_debug",!1),(0,n.default)(this,"activateViewport",(function(e){(0,s.default)("layerManager.activateViewport",a,e),e&&(a.context.viewport=e)})),this.layers=[],this.resourceManager=new c.default({gl:r,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:r,deck:l,programManager:r&&(0,h.createProgramManager)(r),stats:f||new u.Stats({id:"deck.gl"}),viewport:p||new d.default({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:m||new i.Timeline,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}return(0,r.default)(e,[{key:"finalize",value:function(){this.resourceManager.finalize();var e,t=f(this.layers);try{for(t.s();!(e=t.n()).done;)this._finalizeLayer(e.value)}catch(e){t.e(e)}finally{t.f()}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var r,n=f(this.layers);try{for(n.s();!(r=n.n()).done;){var i=r.value.getNeedsRedraw(e);t=t||i}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(e){this._needsRedraw=this._needsRedraw||e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e}},{key:"getLayers",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds;return e?this.layers.filter((function(t){return e.find((function(e){return 0===t.id.indexOf(e)}))})):this.layers}},{key:"setProps",value:function(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}},{key:"setLayers",value:function(e,t){(0,s.default)("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;var r,n=(0,l.flatten)(e,Boolean),i=f(n);try{for(i.s();!(r=i.n()).done;)r.value.context=this.context}catch(e){i.e(e)}finally{i.f()}this._updateLayers(this.layers,n)}},{key:"updateLayers",value:function(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}},{key:"_handleError",value:function(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}},{key:"_updateLayers",value:function(e,t){var r,n={},i=f(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;n[a.id]?o.default.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a}}catch(e){i.e(e)}finally{i.f()}var s=[];this._updateSublayersRecursively(t,n,s),this._finalizeOldLayers(n);for(var l=!1,u=0,c=s;u<c.length;u++){var d=c[u];if(d.hasUniformTransition()){l="Uniform transition in ".concat(d);break}}this._needsUpdate=l,this.layers=s}},{key:"_updateSublayersRecursively",value:function(e,t,r){var n,i=f(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.context=this.context;var s=t[a.id];null===s&&o.default.warn("Multiple new layers with same id ".concat(a.id))(),t[a.id]=null;var l=null;try{this._debug&&s!==a&&a.validateProps(),s?(this._transferLayerState(s,a),this._updateLayer(a)):this._initializeLayer(a),r.push(a),l=a.isComposite?a.getSubLayers():null}catch(e){this._handleError("matching",e,a)}l&&this._updateSublayersRecursively(l,t,r)}}catch(e){i.e(e)}finally{i.f()}}},{key:"_finalizeOldLayers",value:function(e){for(var t in e){var r=e[t];r&&this._finalizeLayer(r)}}},{key:"_initializeLayer",value:function(e){try{e._initialize(),e.lifecycle=a.LIFECYCLE.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}},{key:"_transferLayerState",value:function(e,t){t._transferState(e),t.lifecycle=a.LIFECYCLE.MATCHED,t!==e&&(e.lifecycle=a.LIFECYCLE.AWAITING_GC)}},{key:"_updateLayer",value:function(e){try{e._update()}catch(t){this._handleError("update",t,e)}}},{key:"_finalizeLayer",value:function(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=a.LIFECYCLE.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=a.LIFECYCLE.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}]),e}();return layerManager.default=m,layerManager}var viewManager={},deepEqual={},hasRequiredDeepEqual,hasRequiredViewManager;function requireDeepEqual(){if(hasRequiredDeepEqual)return deepEqual;hasRequiredDeepEqual=1;var e=interopRequireDefaultExports;Object.defineProperty(deepEqual,"__esModule",{value:!0}),deepEqual.deepEqual=function e(r,n,i){if(r===n)return!0;if(!i||!r||!n)return!1;if(Array.isArray(r)){if(!Array.isArray(n)||r.length!==n.length)return!1;for(var a=0;a<r.length;a++)if(!e(r[a],n[a],i-1))return!1;return!0}if(Array.isArray(n))return!1;if("object"===(0,t.default)(r)&&"object"===(0,t.default)(n)){var o=Object.keys(r),s=Object.keys(n);if(o.length!==s.length)return!1;for(var l=0,u=o;l<u.length;l++){var c=u[l];if(!n.hasOwnProperty(c))return!1;if(!e(r[c],n[c],i-1))return!1}return!0}return!1};var t=e(_typeofExports);return deepEqual}function requireViewManager(){if(hasRequiredViewManager)return viewManager;hasRequiredViewManager=1;var e=interopRequireDefaultExports;Object.defineProperty(viewManager,"__esModule",{value:!0}),viewManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireDeepEqual(),a=e(requireLog()),o=requireFlatten();function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"width",void 0),(0,n.default)(this,"height",void 0),(0,n.default)(this,"views",void 0),(0,n.default)(this,"viewState",void 0),(0,n.default)(this,"controllers",void 0),(0,n.default)(this,"timeline",void 0),(0,n.default)(this,"_viewports",void 0),(0,n.default)(this,"_viewportMap",void 0),(0,n.default)(this,"_isUpdating",void 0),(0,n.default)(this,"_needsRedraw",void 0),(0,n.default)(this,"_needsUpdate",void 0),(0,n.default)(this,"_eventManager",void 0),(0,n.default)(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=r.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=r.eventManager,this._eventCallbacks={onViewStateChange:r.onViewStateChange,onInteractionStateChange:r.onInteractionStateChange},Object.seal(this),this.setProps(r)}return(0,r.default)(e,[{key:"finalize",value:function(){for(var e in this.controllers){var t=this.controllers[e];t&&t.finalize()}this.controllers={}}},{key:"needsRedraw",value:function(){var e=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}},{key:"updateViewStates",value:function(){for(var e in this.controllers){var t=this.controllers[e];t&&t.updateTransition()}}},{key:"getViewports",value:function(e){return e?this._viewports.filter((function(t){return t.containsPixel(e)})):this._viewports}},{key:"getViews",value:function(){var e={};return this.views.forEach((function(t){e[t.id]=t})),e}},{key:"getView",value:function(e){return this.views.find((function(t){return t.id===e}))}},{key:"getViewState",value:function(e){var t="string"==typeof e?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}},{key:"getViewport",value:function(e){return this._viewportMap[e]}},{key:"unproject",value:function(e,t){for(var r=this.getViewports(),n={x:e[0],y:e[1]},i=r.length-1;i>=0;--i){var a=r[i];if(a.containsPixel(n)){var o=e.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,t)}}return null}},{key:"setProps",value:function(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(e){e=(0,o.flatten)(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}},{key:"_setViewState",value:function(e){e?(!(0,i.deepEqual)(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):a.default.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(l(l({},t),{},{viewId:e}))}},{key:"_createController",value:function(e,t){var r=this,n=new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(t){var n;return null===(n=r.getView(e.id))||void 0===n?void 0:n.makeViewport({viewState:t,width:r.width,height:r.height})}});return n}},{key:"_updateController",value:function(e,t,r,n){var i=e.controller;if(i&&r){var a=l(l(l({},t),i),{},{id:e.id,x:r.x,y:r.y,width:r.width,height:r.height});return n&&n.constructor===i.type||(n=this._createController(e,a)),n&&n.setProps(a),n}return null}},{key:"_rebuildViewports",value:function(){var e=this.views,t=this.controllers;this._viewports=[],this.controllers={};for(var r=!1,n=e.length;n--;){var i=e[n],a=this.getViewState(i),o=i.makeViewport({viewState:a,width:this.width,height:this.height}),s=t[i.id],l=Boolean(i.controller);l&&!s&&(r=!0),!r&&l||!s||(s.finalize(),s=null),this.controllers[i.id]=this._updateController(i,a,o,s),o&&this._viewports.unshift(o)}for(var u in t){var c=t[u];c&&!this.controllers[u]&&c.finalize()}this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var e=this;this._viewportMap={},this._viewports.forEach((function(t){t.id&&(e._viewportMap[t.id]=e._viewportMap[t.id]||t)}))}},{key:"_diffViews",value:function(e,t){return e.length!==t.length||e.some((function(r,n){return!e[n].equals(t[n])}))}}]),e}();return viewManager.default=u,viewManager}var mapView={},view={},positions={},hasRequiredPositions;function requirePositions(){if(hasRequiredPositions)return positions;hasRequiredPositions=1;var e=interopRequireDefaultExports;Object.defineProperty(positions,"__esModule",{value:!0}),positions.parsePosition=function(e){switch((0,t.default)(e)){case"number":return{position:e,relative:!1};case"string":var n=r.exec(e);if(n&&n.length>=3){var i="%"===n[2],a=parseFloat(n[1]);return{position:i?a/100:a,relative:i}}default:throw new Error("Could not parse position string ".concat(e))}},positions.getPosition=function(e,t){return e.relative?Math.round(e.position*t):e.position};var t=e(_typeofExports),r=/([0-9]+\.?[0-9]*)(%|px)/;return positions}var assert$1={},hasRequiredAssert,hasRequiredView;function requireAssert(){return hasRequiredAssert||(hasRequiredAssert=1,Object.defineProperty(assert$1,"__esModule",{value:!0}),assert$1.default=function(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}),assert$1}function requireView(){if(hasRequiredView)return view;hasRequiredView=1;var e=interopRequireDefaultExports;Object.defineProperty(view,"__esModule",{value:!0}),view.default=void 0;var t=e(_typeofExports),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=e(requireViewport()),o=requirePositions(),s=requireDeepEqual(),l=e(requireAssert());function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=function(){function e(t){(0,r.default)(this,e),(0,i.default)(this,"id",void 0),(0,i.default)(this,"viewportInstance",void 0),(0,i.default)(this,"_x",void 0),(0,i.default)(this,"_y",void 0),(0,i.default)(this,"_width",void 0),(0,i.default)(this,"_height",void 0),(0,i.default)(this,"_padding",void 0),(0,i.default)(this,"props",void 0);var n=t||{},s=n.id,u=n.x,d=void 0===u?0:u,h=n.y,f=void 0===h?0:h,p=n.width,m=void 0===p?"100%":p,g=n.height,_=void 0===g?"100%":g,y=n.padding,v=void 0===y?null:y,b=n.viewportInstance;(0,l.default)(!b||b instanceof a.default),this.viewportInstance=b,this.id=s||this.constructor.displayName||"view",this.props=c(c({},t),{},{id:this.id}),this._x=(0,o.parsePosition)(d),this._y=(0,o.parsePosition)(f),this._width=(0,o.parsePosition)(m),this._height=(0,o.parsePosition)(_),this._padding=v&&{left:(0,o.parsePosition)(v.left||0),right:(0,o.parsePosition)(v.right||0),top:(0,o.parsePosition)(v.top||0),bottom:(0,o.parsePosition)(v.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}return(0,n.default)(e,[{key:"equals",value:function(e){return this===e||(this.viewportInstance?!!e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance):this.ViewportType===e.ViewportType&&(0,s.deepEqual)(this.props,e.props,2))}},{key:"makeViewport",value:function(e){var t=e.width,r=e.height,n=e.viewState;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);var i=this.getDimensions({width:t,height:r});return i.height&&i.width?new this.ViewportType(c(c(c({},n),this.props),i)):null}},{key:"getViewStateId",value:function(){var e=this.props.viewState;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}},{key:"filterViewState",value:function(e){if(this.props.viewState&&"object"===(0,t.default)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var r=c({},e);for(var n in this.props.viewState)"id"!==n&&(r[n]=this.props.viewState[n]);return r}return e}},{key:"getDimensions",value:function(e){var t=e.width,r=e.height,n={x:(0,o.getPosition)(this._x,t),y:(0,o.getPosition)(this._y,r),width:(0,o.getPosition)(this._width,t),height:(0,o.getPosition)(this._height,r)};return this._padding&&(n.padding={left:(0,o.getPosition)(this._padding.left,t),top:(0,o.getPosition)(this._padding.top,r),right:(0,o.getPosition)(this._padding.right,t),bottom:(0,o.getPosition)(this._padding.bottom,r)}),n}},{key:"controller",get:function(){var e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:c({type:this.ControllerType},e):null}}]),e}();return view.default=d,view}var mapController={},controller={},transitionManager={},transition={},hasRequiredTransition,hasRequiredTransitionManager;function requireTransition(){if(hasRequiredTransition)return transition;hasRequiredTransition=1;var e=interopRequireDefaultExports;Object.defineProperty(transition,"__esModule",{value:!0}),transition.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"_inProgress",void 0),(0,n.default)(this,"_handle",void 0),(0,n.default)(this,"_timeline",void 0),(0,n.default)(this,"time",void 0),(0,n.default)(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=r,this.time=0,this.settings={duration:0}}return(0,r.default)(e,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,null===(t=(r=this.settings).onStart)||void 0===t||t.call(r,this)}},{key:"end",value:function(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(e=(t=this.settings).onEnd)||void 0===e||e.call(t,this))}},{key:"cancel",value:function(){var e,t;this._inProgress&&(null===(e=(t=this.settings).onInterrupt)||void 0===e||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}},{key:"update",value:function(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){var r=this._timeline,n=this.settings;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(e=(t=this.settings).onUpdate)||void 0===e||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),e}();return transition.default=i,transition}function requireTransitionManager(){if(hasRequiredTransitionManager)return transitionManager;hasRequiredTransitionManager=1;var e=interopRequireDefaultExports;Object.defineProperty(transitionManager,"__esModule",{value:!0}),transitionManager.default=transitionManager.TRANSITION_EVENTS=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireTransition());function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s=function(){},l={BREAK:1,SNAP_TO_END:2,IGNORE:3};transitionManager.TRANSITION_EVENTS=l;var u=function(e){return e},c=l.BREAK,d=function(){function e(r){var a=this;(0,t.default)(this,e),(0,n.default)(this,"getControllerState",void 0),(0,n.default)(this,"props",void 0),(0,n.default)(this,"propsInTransition",void 0),(0,n.default)(this,"transition",void 0),(0,n.default)(this,"onViewStateChange",void 0),(0,n.default)(this,"onStateChange",void 0),(0,n.default)(this,"_onTransitionUpdate",(function(e){var t=e.settings,r=t.interpolator,n=t.startProps,i=t.endProps,s=(0,t.easing)(e.time/t.duration),l=r.interpolateProps(n,i,s);a.propsInTransition=a.getControllerState(o(o({},a.props),l)).getViewportProps(),a.onViewStateChange({viewState:a.propsInTransition,oldViewState:a.props})})),this.getControllerState=r.getControllerState,this.propsInTransition=null,this.transition=new i.default(r.timeline),this.onViewStateChange=r.onViewStateChange||s,this.onStateChange=r.onStateChange||s}return(0,r.default)(e,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(e){var t=!1,r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){var n=r;if(this.transition.inProgress){var i=this.transition.settings,a=i.interruption,s=i.endProps;n=o(o({},r),a===l.SNAP_TO_END?s:this.propsInTransition||r)}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(e){var t=e.transitionDuration;return(t>0||"auto"===t)&&Boolean(e.transitionInterpolator)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(e,t){return this.transition.inProgress?this.transition.settings.interruption===l.IGNORE||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}},{key:"_triggerTransition",value:function(e,t){var r=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(r),i=t.transitionInterpolator,a=i.getDuration?i.getDuration(e,t):t.transitionDuration;if(0!==a){var o=i.initializeProps(e,n);this.propsInTransition={};var s={duration:a,easing:t.transitionEasing||u,interpolator:i,interruption:t.transitionInterruption||c,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(s),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(e){var t=this;return function(r){t.propsInTransition=null,t.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(r)}}}]),e}();return transitionManager.default=d,transitionManager}var linearInterpolator={},transitionInterpolator={},hasRequiredTransitionInterpolator,hasRequiredLinearInterpolator,hasRequiredController;function requireTransitionInterpolator(){if(hasRequiredTransitionInterpolator)return transitionInterpolator;hasRequiredTransitionInterpolator=1;var e=interopRequireDefaultExports;Object.defineProperty(transitionInterpolator,"__esModule",{value:!0}),transitionInterpolator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=e(requireAssert());function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"_propsToCompare",void 0),(0,n.default)(this,"_propsToExtract",void 0),(0,n.default)(this,"_requiredProps",void 0);var i=r.compare,a=r.extract,o=r.required;this._propsToCompare=i,this._propsToExtract=a||i,this._requiredProps=o}return(0,r.default)(e,[{key:"arePropsEqual",value:function(e,t){var r,n=o(this._propsToCompare);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(!(a in e)||!(a in t)||!(0,i.equals)(e[a],t[a]))return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"initializeProps",value:function(e,t){var r,n={},i={},a=o(this._propsToExtract);try{for(a.s();!(r=a.n()).done;){var s=r.value;(s in e||s in t)&&(n[s]=e[s],i[s]=t[s])}}catch(e){a.e(e)}finally{a.f()}return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}},{key:"getDuration",value:function(e,t){return t.transitionDuration}},{key:"_checkRequiredProps",value:function(e){this._requiredProps&&this._requiredProps.forEach((function(t){var r=e[t];(0,a.default)(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))}))}}]),e}();return transitionInterpolator.default=l,transitionInterpolator}function requireLinearInterpolator(){if(hasRequiredLinearInterpolator)return linearInterpolator;hasRequiredLinearInterpolator=1;var e=interopRequireDefaultExports;Object.defineProperty(linearInterpolator,"__esModule",{value:!0}),linearInterpolator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=e(requireTransitionInterpolator()),c=es5$q;function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=["longitude","latitude","zoom","bearing","pitch"],m=["longitude","latitude","zoom"],g=function(e){(0,a.default)(_,e);var u,d,g=(u=_,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(d){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function _(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,_);var i=Array.isArray(r)?r:r.transitionProps,a=Array.isArray(r)?{}:r;return a.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:p,required:m},e=g.call(this,a.transitionProps),(0,l.default)((0,n.default)(e),"opts",void 0),e.opts=a,e}return(0,r.default)(_,[{key:"initializeProps",value:function(e,t){var r=(0,i.default)((0,s.default)(_.prototype),"initializeProps",this).call(this,e,t),n=this.opts,a=n.makeViewport,o=n.around;if(a&&o){var l=a(e),u=a(t),c=l.unproject(o);r.start.around=o,Object.assign(r.end,{around:u.project(c),aroundPosition:c,width:t.width,height:t.height})}return r}},{key:"interpolateProps",value:function(e,t,r){var n,i={},a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this._propsToExtract);try{for(a.s();!(n=a.n()).done;){var o=n.value;i[o]=(0,c.lerp)(e[o]||0,t[o]||0,r)}}catch(e){a.e(e)}finally{a.f()}if(t.aroundPosition&&this.opts.makeViewport){var s=this.opts.makeViewport(h(h({},t),i));Object.assign(i,s.panByPosition(t.aroundPosition,(0,c.lerp)(e.around,t.around,r)))}return i}}]),_}(u.default);return linearInterpolator.default=g,linearInterpolator}function requireController(){if(hasRequiredController)return controller;hasRequiredController=1;var e=interopRequireDefaultExports;Object.defineProperty(controller,"__esModule",{value:!0}),controller.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireTransitionManager()),a=e(requireLinearInterpolator());function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={transitionDuration:0},u=function(e){return 1-(1-e)*(1-e)},c=["wheel"],d=["panstart","panmove","panend"],h=["pinchstart","pinchmove","pinchend"],f=["tripanstart","tripanmove","tripanend"],p=["doubletap"],m=["keydown"],g={},_=function(){function e(r){var a=this;(0,t.default)(this,e),(0,n.default)(this,"props",void 0),(0,n.default)(this,"state",{}),(0,n.default)(this,"transitionManager",void 0),(0,n.default)(this,"eventManager",void 0),(0,n.default)(this,"onViewStateChange",void 0),(0,n.default)(this,"onStateChange",void 0),(0,n.default)(this,"makeViewport",void 0),(0,n.default)(this,"_controllerState",void 0),(0,n.default)(this,"_events",{}),(0,n.default)(this,"_interactionState",{isDragging:!1}),(0,n.default)(this,"_customEvents",[]),(0,n.default)(this,"_eventStartBlocked",null),(0,n.default)(this,"_panMove",!1),(0,n.default)(this,"invertPan",!1),(0,n.default)(this,"dragMode","rotate"),(0,n.default)(this,"inertia",0),(0,n.default)(this,"scrollZoom",!0),(0,n.default)(this,"dragPan",!0),(0,n.default)(this,"dragRotate",!0),(0,n.default)(this,"doubleClickZoom",!0),(0,n.default)(this,"touchZoom",!0),(0,n.default)(this,"touchRotate",!1),(0,n.default)(this,"keyboard",!0),this.transitionManager=new i.default(s(s({},r),{},{getControllerState:function(e){return new a.ControllerState(e)},onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=r.eventManager,this.onViewStateChange=r.onViewStateChange||function(){},this.onStateChange=r.onStateChange||function(){},this.makeViewport=r.makeViewport}return(0,r.default)(e,[{key:"events",set:function(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}},{key:"finalize",value:function(){for(var e in this._events){var t;this._events[e]&&(null===(t=this.eventManager)||void 0===t||t.off(e,this.handleEvent))}this.transitionManager.finalize()}},{key:"handleEvent",value:function(e){this._controllerState=void 0;var t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"controllerState",get:function(){return this._controllerState=this._controllerState||new this.ControllerState(s(s({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}},{key:"getCenter",value:function(e){var t=this.props,r=e.offsetCenter;return[r.x-t.x,r.y-t.y]}},{key:"isPointInBounds",value:function(e,t){var r=this.props;if(t&&t.handled)return!1;var n=e[0]>=0&&e[0]<=r.width&&e[1]>=0&&e[1]<=r.height;return n&&t&&t.stopPropagation(),n}},{key:"isFunctionKeyPressed",value:function(e){var t=e.srcEvent;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging||!1}},{key:"blockEvents",value:function(e){var t=this,r=setTimeout((function(){t._eventStartBlocked===r&&(t._eventStartBlocked=null)}),e);this._eventStartBlocked=r}},{key:"setProps",value:function(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);var t=e.inertia;this.inertia=Number.isFinite(t)?t:!0===t?300:0;var r=e.scrollZoom,n=void 0===r||r,i=e.dragPan,a=void 0===i||i,o=e.dragRotate,s=void 0===o||o,l=e.doubleClickZoom,u=void 0===l||l,g=e.touchZoom,_=void 0===g||g,y=e.touchRotate,v=void 0!==y&&y,b=e.keyboard,x=void 0===b||b,T=Boolean(this.onViewStateChange);this.toggleEvents(c,T&&n),this.toggleEvents(d,T),this.toggleEvents(h,T&&(_||v)),this.toggleEvents(f,T&&v),this.toggleEvents(p,T&&u),this.toggleEvents(m,T&&x),this.scrollZoom=n,this.dragPan=a,this.dragRotate=s,this.doubleClickZoom=u,this.touchZoom=_,this.touchRotate=v,this.keyboard=x}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(e,t){var r=this;this.eventManager&&e.forEach((function(e){r._events[e]!==t&&(r._events[e]=t,t?r.eventManager.on(e,r.handleEvent):r.eventManager.off(e,r.handleEvent))}))}},{key:"updateViewport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=s(s({},e.getViewportProps()),t),i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),i){var a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a})}}},{key:"_onTransition",value:function(e){this.onViewStateChange(s(s({},e),{},{interactionState:this._interactionState}))}},{key:"_setInteractionState",value:function(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;var r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(r=!r);var n=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(n,l,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}},{key:"_onPanEnd",value:function(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,l,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){var t=this.inertia;if(this.dragPan&&t&&e.velocity){var r=this.getCenter(e),n=this.controllerState.pan({pos:[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2]}).panEnd();this.updateViewport(n,s(s({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:u}),{isDragging:!1,isPanning:!0})}else{var i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,l,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){var t=this.inertia;if(this.dragRotate&&t&&e.velocity){var r=this.getCenter(e),n=this.controllerState.rotate({pos:[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2]}).rotateEnd();this.updateViewport(n,s(s({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:u}),{isDragging:!1,isRotating:!0})}else{var i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();var r=!0===this.scrollZoom?{}:this.scrollZoom,n=r.speed,i=r.smooth,a=void 0!==i&&i,o=e.delta,l=2/(1+Math.exp(-Math.abs(o*(void 0===n?.01:n))));o<0&&0!==l&&(l=1/l);var u=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(u,s(s({},this._getTransitionProps({around:t})),{},{transitionDuration:a?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;var r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,l,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;var t=this.getCenter(e);t[0]-=e.deltaX;var r=this.controllerState.rotate({pos:t});return this.updateViewport(r,l,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;var t=this.inertia;if(this.touchRotate&&t&&e.velocityY){var r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*t/2],i=this.controllerState.rotate({pos:n});this.updateViewport(i,s(s({},this._getTransitionProps()),{},{transitionDuration:t,transitionEasing:u}),{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{var a=this.controllerState.rotateEnd();this.updateViewport(a,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;var r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return g._startPinchRotation=e.rotation,g._lastPinchEvent=e,this.updateViewport(r,l,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;var t=this.controllerState;if(this.touchZoom){var r=e.scale,n=this.getCenter(e);t=t.zoom({pos:n,scale:r})}return this.touchRotate&&(t=t.rotate({deltaAngleX:g._startPinchRotation-e.rotation})),this.updateViewport(t,l,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),g._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;var t=this.inertia,r=g._lastPinchEvent;if(this.touchZoom&&t&&r&&e.scale!==r.scale){var n=this.getCenter(e),i=this.controllerState.rotateEnd(),a=Math.log2(e.scale),o=(a-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,a+o*t/2);i=i.zoom({pos:n,scale:l}).zoomEnd(),this.updateViewport(i,s(s({},this._getTransitionProps({around:n})),{},{transitionDuration:t,transitionEasing:u}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{var c=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(c,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return g._startPinchRotation=null,g._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;var r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var t,r=this.isFunctionKeyPressed(e),n=!0===this.keyboard?{}:this.keyboard,i=n.zoomSpeed,a=n.moveSpeed,o=n.rotateSpeedX,s=n.rotateSpeedY,l=this.controllerState,u={};switch(e.srcEvent.code){case"Minus":t=r?l.zoomOut(i).zoomOut(i):l.zoomOut(i),u.isZooming=!0;break;case"Equal":t=r?l.zoomIn(i).zoomIn(i):l.zoomIn(i),u.isZooming=!0;break;case"ArrowLeft":r?(t=l.rotateLeft(o),u.isRotating=!0):(t=l.moveLeft(a),u.isPanning=!0);break;case"ArrowRight":r?(t=l.rotateRight(o),u.isRotating=!0):(t=l.moveRight(a),u.isPanning=!0);break;case"ArrowUp":r?(t=l.rotateUp(s),u.isRotating=!0):(t=l.moveUp(a),u.isPanning=!0);break;case"ArrowDown":r?(t=l.rotateDown(s),u.isRotating=!0):(t=l.moveDown(a),u.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),u),!0}},{key:"_getTransitionProps",value:function(e){var t=this.transition;return t&&t.transitionInterpolator?e?s(s({},t),{},{transitionInterpolator:new a.default(s(s(s({},e),t.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):t:l}}]),e}();return controller.default=_,controller}var viewState={},hasRequiredViewState,hasRequiredMapController,hasRequiredMapView;function requireViewState(){if(hasRequiredViewState)return viewState;hasRequiredViewState=1;var e=interopRequireDefaultExports;Object.defineProperty(viewState,"__esModule",{value:!0}),viewState.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(r,i){(0,t.default)(this,e),(0,n.default)(this,"_viewportProps",void 0),(0,n.default)(this,"_state",void 0),this._viewportProps=this.applyConstraints(r),this._state=i}return(0,r.default)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}}]),e}();return viewState.default=i,viewState}function requireMapController(){if(hasRequiredMapController)return mapController;hasRequiredMapController=1;var e=interopRequireDefaultExports;Object.defineProperty(mapController,"__esModule",{value:!0}),mapController.default=mapController.MapState=void 0;var t=e(requireGet()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$q,c=e(requireController()),d=e(requireViewState()),h=es5$7,f=e(requireAssert()),p=e(requireLinearInterpolator());function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.default)(this,r)}}var y=function(e){(0,a.default)(o,e);var t=_(o);function o(e){var n;(0,r.default)(this,o);var a=e.width,s=e.height,u=e.latitude,c=e.longitude,d=e.zoom,h=e.bearing,p=void 0===h?0:h,m=e.pitch,g=void 0===m?0:m,_=e.altitude,y=void 0===_?1.5:_,v=e.position,b=void 0===v?[0,0,0]:v,x=e.maxZoom,T=void 0===x?20:x,w=e.minZoom,E=void 0===w?0:w,A=e.maxPitch,S=void 0===A?60:A,P=e.minPitch,M=void 0===P?0:P,R=e.startPanLngLat,C=e.startZoomLngLat,O=e.startRotatePos,L=e.startBearing,I=e.startPitch,D=e.startZoom,k=e.normalize,B=void 0===k||k;return(0,f.default)(Number.isFinite(c)),(0,f.default)(Number.isFinite(u)),(0,f.default)(Number.isFinite(d)),n=t.call(this,{width:a,height:s,latitude:u,longitude:c,zoom:d,bearing:p,pitch:g,altitude:y,maxZoom:T,minZoom:E,maxPitch:S,minPitch:M,normalize:B,position:b},{startPanLngLat:R,startZoomLngLat:C,startRotatePos:O,startBearing:L,startPitch:I,startZoom:D}),(0,l.default)((0,i.default)(n),"makeViewport",void 0),n.makeViewport=e.makeViewport,n}return(0,n.default)(o,[{key:"panStart",value:function(e){return this._getUpdatedState({startPanLngLat:this._unproject(e.pos)})}},{key:"pan",value:function(e){var t=e.pos,r=e.startPos,n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;var i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(e){return this._getUpdatedState({startRotatePos:e.pos,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(e){var t,r=e.pos,n=e.deltaAngleX,i=void 0===n?0:n,a=e.deltaAngleY,o=void 0===a?0:a,s=this.getState(),l=s.startRotatePos,u=s.startBearing,c=s.startPitch;return l&&void 0!==u&&void 0!==c?(t=r?this._getNewRotation(r,l,c,u):{bearing:u+i,pitch:c+o},this._getUpdatedState(t)):this}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(e){return this._getUpdatedState({startZoomLngLat:this._unproject(e.pos),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(e){var t=e.pos,r=e.startPos,n=e.scale,i=this.getState(),a=i.startZoom,o=i.startZoomLngLat;if(o||(a=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(t)),!o)return this;var s=this.getViewportProps(),l=s.maxZoom,c=s.minZoom,d=a+Math.log2(n);d=(0,u.clamp)(d,c,l);var h=this.makeViewport(g(g({},this.getViewportProps()),{},{zoom:d}));return this._getUpdatedState(g({zoom:d},h.panByPosition(o,t)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2))}},{key:"moveLeft",value:function(){return this._panFromCenter([arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100),0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100)])}},{key:"rotateLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}},{key:"rotateRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}},{key:"rotateUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}},{key:"rotateDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}},{key:"shortestPathFrom",value:function(e){var t=e.getViewportProps(),r=g({},this.getViewportProps()),n=r.bearing,i=r.longitude;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(i-t.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}},{key:"applyConstraints",value:function(e){e.zoom=(0,u.clamp)(e.zoom,e.minZoom,e.maxZoom),e.pitch=(0,u.clamp)(e.pitch,e.minPitch,e.maxPitch);var t=e.normalize;return(void 0===t||t)&&Object.assign(e,(0,h.normalizeViewportProps)(e)),e}},{key:"_zoomFromCenter",value:function(e){var t=this.getViewportProps();return this.zoom({pos:[t.width/2,t.height/2],scale:e})}},{key:"_panFromCenter",value:function(e){var t=this.getViewportProps(),r=t.width,n=t.height;return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}},{key:"_getUpdatedState",value:function(e){return new this.constructor(g(g(g({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),e))}},{key:"_unproject",value:function(e){var t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}},{key:"_getNewRotation",value:function(e,t,r,n){var i=e[0]-t[0],a=e[1]-t[1],o=e[1],s=t[1],l=this.getViewportProps(),c=l.height,d=i/l.width,h=0;a>0?Math.abs(c-s)>5&&(h=a/(s-c)*1.2):a<0&&s>5&&(h=1-o/s),h=(0,u.clamp)(h,-1,1);var f=this.getViewportProps(),p=r;return h>0?p=r+h*(f.maxPitch-r):h<0&&(p=r-h*(f.minPitch-r)),{pitch:p,bearing:n+180*d}}}]),o}(d.default);mapController.MapState=y;var v=function(e){(0,a.default)(u,e);var o=_(u);function u(){var e;(0,r.default)(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=o.call.apply(o,[this].concat(n)),(0,l.default)((0,i.default)(e),"ControllerState",y),(0,l.default)((0,i.default)(e),"transition",{transitionDuration:300,transitionInterpolator:new p.default({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),(0,l.default)((0,i.default)(e),"dragMode","pan"),e}return(0,n.default)(u,[{key:"setProps",value:function(e){e.position=e.position||[0,0,0];var r=this.props;(0,t.default)((0,s.default)(u.prototype),"setProps",this).call(this,e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState(g(g({makeViewport:this.makeViewport},e),this.state)))}}]),u}(c.default);return mapController.default=v,mapController}function requireMapView(){if(hasRequiredMapView)return mapView;hasRequiredMapView=1;var e=interopRequireDefaultExports;Object.defineProperty(mapView,"__esModule",{value:!0}),mapView.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireView()),l=e(requireWebMercatorViewport()),u=e(requireMapController()),c=function(e){(0,n.default)(d,e);var o,s,c=(o=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"ViewportType",get:function(){return l.default}},{key:"ControllerType",get:function(){return u.default}}]),d}(s.default);return mapView.default=c,(0,o.default)(c,"displayName","MapView"),mapView}var effectManager={},hasRequiredEffectManager;function requireEffectManager(){if(hasRequiredEffectManager)return effectManager;hasRequiredEffectManager=1;var e=interopRequireDefaultExports;Object.defineProperty(effectManager,"__esModule",{value:!0}),effectManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireDeepEqual(),a=e(requireLightingEffect());function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=new a.default,u=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"effects",void 0),(0,n.default)(this,"_resolvedEffects",[]),(0,n.default)(this,"_defaultEffects",[]),(0,n.default)(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}return(0,r.default)(e,[{key:"addDefaultEffect",value:function(e){var t=this._defaultEffects;if(!t.find((function(t){return t.id===e.id}))){var r=t.findIndex((function(t){return(null!==(r=t.order)&&void 0!==r?r:1/0)-(null!==(n=e.order)&&void 0!==n?n:1/0)>0;var r,n}));r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}},{key:"setProps",value:function(e){"effects"in e&&((0,i.deepEqual)(e.effects,this.effects,1)||this._setEffects(e.effects))}},{key:"needsRedraw",value:function(){var e=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){return this._resolvedEffects}},{key:"_setEffects",value:function(e){var t,r={},n=o(this.effects);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.id]=i}}catch(e){n.e(e)}finally{n.f()}var s,u=[],c=o(e);try{for(c.s();!(s=c.n()).done;){var d=s.value,h=r[d.id];h&&h!==d?h.setProps?(h.setProps(d.props),u.push(h)):(h.cleanup(),u.push(d)):u.push(d),delete r[d.id]}}catch(e){c.e(e)}finally{c.f()}for(var f in r)r[f].cleanup();this.effects=u,this._resolvedEffects=u.concat(this._defaultEffects),e.some((function(e){return e instanceof a.default}))||this._resolvedEffects.push(l),this._needsRedraw="effects changed"}},{key:"finalize",value:function(){var e,t=o(this._resolvedEffects);try{for(t.s();!(e=t.n()).done;)e.value.cleanup()}catch(e){t.e(e)}finally{t.f()}this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}]),e}();return effectManager.default=u,effectManager}var deckRenderer={},drawLayersPass={},hasRequiredDrawLayersPass,hasRequiredDeckRenderer;function requireDrawLayersPass(){if(hasRequiredDrawLayersPass)return drawLayersPass;hasRequiredDrawLayersPass=1;var e=interopRequireDefaultExports;Object.defineProperty(drawLayersPass,"__esModule",{value:!0}),drawLayersPass.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=function(e){(0,n.default)(u,e);var o,s,l=(o=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function u(){return(0,t.default)(this,u),l.apply(this,arguments)}return(0,r.default)(u,[{key:"shouldDrawLayer",value:function(e){var t=e.props.operation;return t.includes("draw")||t.includes("terrain")}}]),u}(e(requireLayersPass()).default);return drawLayersPass.default=o,drawLayersPass}function requireDeckRenderer(){if(hasRequiredDeckRenderer)return deckRenderer;hasRequiredDeckRenderer=1;var e=interopRequireDefaultExports;Object.defineProperty(deckRenderer,"__esModule",{value:!0}),deckRenderer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireDebug()),a=e(requireDrawLayersPass()),o=e(requirePickLayersPass()),s=es5$d;function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"layerFilter",void 0),(0,n.default)(this,"drawPickingColors",void 0),(0,n.default)(this,"drawLayersPass",void 0),(0,n.default)(this,"pickLayersPass",void 0),(0,n.default)(this,"renderCount",void 0),(0,n.default)(this,"_needsRedraw",void 0),(0,n.default)(this,"renderBuffers",void 0),(0,n.default)(this,"lastPostProcessEffect",void 0),this.gl=r,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new a.default(r),this.pickLayersPass=new o.default(r),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return(0,r.default)(e,[{key:"setProps",value:function(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(e){if(e.viewports.length){var t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r=d(d({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e),{},{target:e.target||s.Framebuffer.getDefaultFramebuffer(this.gl)});r.effects&&this._preRender(r.effects,r);var n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,a=t.render(d(d({},r),{},{target:n}));r.effects&&this._postRender(r.effects,r),this.renderCount++,(0,i.default)("deckRenderer.renderLayers",this,a,e)}}},{key:"needsRedraw",value:function(){var e=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"finalize",value:function(){var e,t=this.renderBuffers,r=l(t);try{for(r.s();!(e=r.n()).done;)e.value.delete()}catch(e){r.e(e)}finally{r.f()}t.length=0}},{key:"_preRender",value:function(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};var r,n=l(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;t.preRenderStats[i.id]=i.preRender(this.gl,t),i.postRender&&(this.lastPostProcessEffect=i.id)}}catch(e){n.e(e)}finally{n.f()}this.lastPostProcessEffect&&this._resizeRenderBuffers()}},{key:"_resizeRenderBuffers",value:function(){var e=this.renderBuffers;0===e.length&&e.push(new s.Framebuffer(this.gl),new s.Framebuffer(this.gl));var t,r=l(e);try{for(r.s();!(t=r.n()).done;)t.value.resize()}catch(e){r.e(e)}finally{r.f()}}},{key:"_postRender",value:function(e,t){var r,n=this.renderBuffers,i=d(d({},t),{},{inputBuffer:n[0],swapBuffer:n[1],target:null}),a=l(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.postRender){if(o.id===this.lastPostProcessEffect){i.target=t.target,o.postRender(this.gl,i);break}var s=o.postRender(this.gl,i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}catch(e){a.e(e)}finally{a.f()}}}]),e}();return deckRenderer.default=h,deckRenderer}var deckPicker={},queryObject={},hasRequiredQueryObject;function requireQueryObject(){if(hasRequiredQueryObject)return queryObject;hasRequiredQueryObject=1;var e=interopRequireDefaultExports;Object.defineProperty(queryObject,"__esModule",{value:!0}),queryObject.getClosestObject=function(e){for(var t=e.pickedColors,n=e.decodePickingColor,o=e.deviceX,s=e.deviceY,l=e.deviceRadius,u=e.deviceRect,c=u.x,d=u.y,h=u.width,f=u.height,p=l*l,m=-1,g=0,_=0;_<f;_++){var y=_+d-s,v=y*y;if(v>p)g+=4*h;else for(var b=0;b<h;b++){if(t[g+3]-1>=0){var x=b+c-o,T=x*x+v;T<=p&&(p=T,m=g)}g+=4}}if(m>=0){var w=t.slice(m,m+4),E=n(w);if(E){var A=Math.floor(m/4/h),S=m/4-A*h;return i(i({},E),{},{pickedColor:w,pickedX:c+S,pickedY:d+A})}r.default.error("Picked non-existent layer. Is picking buffer corrupt?")()}return a},queryObject.getUniqueObjects=function(e){var t=e.pickedColors,n=e.decodePickingColor,a=new Map;if(t)for(var o=0;o<t.length;o+=4)if(t[o+3]-1>=0){var s=t.slice(o,o+4),l=s.join(",");if(!a.has(l)){var u=n(s);u?a.set(l,i(i({},u),{},{color:s})):r.default.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(a.values())};var t=e(requireDefineProperty()),r=e(requireLog());function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var a={pickedColor:null,pickedObjectIndex:-1};return queryObject}var pickInfo={},hasRequiredPickInfo,hasRequiredDeckPicker;function requirePickInfo(){if(hasRequiredPickInfo)return pickInfo;hasRequiredPickInfo=1;var e=interopRequireDefaultExports;Object.defineProperty(pickInfo,"__esModule",{value:!0}),pickInfo.getEmptyPickingInfo=n,pickInfo.processPickInfo=function(e){var a=e.pickInfo,o=e.lastPickedInfo,s=e.mode,l=a.pickedColor,u=a.pickedLayer,c=a.pickedObjectIndex,d=u?[u]:[];if("hover"===s){var h=o.layerId,f=u?u.props.id:null;if(f!==h||c!==o.index){if(f!==h){var p=e.layers.find((function(e){return e.props.id===h}));p&&d.unshift(p)}o.layerId=f,o.index=c,o.info=null}}var m=n(e),g=new Map;return g.set(null,m),d.forEach((function(e){var n=function(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},m);e===u&&(n.color=l,n.index=c,n.picked=!0);var a=(n=i({layer:e,info:n,mode:s})).layer;e===u&&"hover"===s&&(o.info=n),g.set(a.id,n),"hover"===s&&a.updateAutoHighlight(n)})),g},pickInfo.getLayerPickingInfo=i;var t=e(requireDefineProperty());function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){var t,r=e.pickInfo,n=e.viewports,i=e.pixelRatio,a=e.x,o=e.y,s=e.z,l=n[0];if(n.length>1&&(l=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.containsPixel(t))return n}return e[0]}((null==r?void 0:r.pickedViewports)||n,{x:a,y:o})),l){var u=[a-l.x,o-l.y];void 0!==s&&(u[2]=s),t=l.unproject(u)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:a,y:o,pixel:[a,o],coordinate:t,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:i}}function i(e){for(var t=e.layer,r=e.info,n=e.mode;t&&r;){var i=r.layer||null;r.sourceLayer=i,r.layer=t,r=t.getPickingInfo({info:r,mode:n,sourceLayer:i}),t=t.parent}return r}return pickInfo}function requireDeckPicker(){if(hasRequiredDeckPicker)return deckPicker;hasRequiredDeckPicker=1;var e=interopRequireDefaultExports;Object.defineProperty(deckPicker,"__esModule",{value:!0}),deckPicker.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=e(requirePickLayersPass()),o=requireQueryObject(),s=requirePickInfo();function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"pickingFBO",void 0),(0,n.default)(this,"depthFBO",void 0),(0,n.default)(this,"pickLayersPass",void 0),(0,n.default)(this,"layerFilter",void 0),(0,n.default)(this,"lastPickedInfo",void 0),(0,n.default)(this,"_pickable",!0),this.gl=r,this.pickLayersPass=new a.default(r),this.lastPickedInfo={index:-1,layerId:null,info:null}}return(0,r.default)(e,[{key:"setProps",value:function(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(e){return this._pickClosestObject(e)}},{key:"pickObjects",value:function(e){return this._pickVisibleObjects(e)}},{key:"getLastPickedObject",value:function(e){var t=e.x,r=e.y,n=e.viewports,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,a=i&&i.layer&&i.layer.id,o=i&&i.viewport&&i.viewport.id,s=a?e.layers.find((function(e){return e.id===a})):null,l=o&&n.find((function(e){return e.id===o}))||n[0],u=l&&l.unproject([t-l.x,r-l.y]),c={x:t,y:r,viewport:l,coordinate:u,layer:s};return d(d({},i),c)}},{key:"_resizeBuffer",value:function(){var e,t,r=this.gl;if(!this.pickingFBO&&(this.pickingFBO=new i.Framebuffer(r),i.Framebuffer.isSupported(r,{colorBufferFloat:!0}))){var a=new i.Framebuffer(r);a.attach((0,n.default)({},36064,new i.Texture2D(r,{format:(0,i.isWebGL2)(r)?34836:6408,type:5126}))),this.depthFBO=a}null===(e=this.pickingFBO)||void 0===e||e.resize({width:r.canvas.width,height:r.canvas.height}),null===(t=this.depthFBO)||void 0===t||t.resize({width:r.canvas.width,height:r.canvas.height})}},{key:"_getPickable",value:function(e){var t=this;if(!1===this._pickable)return null;var r=e.filter((function(e){return t.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite}));return r.length?r:null}},{key:"_pickClosestObject",value:function(e){var t=e.views,r=e.viewports,n=e.x,a=e.y,u=e.radius,c=void 0===u?0:u,h=e.depth,f=void 0===h?1:h,p=e.mode,m=void 0===p?"query":p,g=e.unproject3D,_=e.onViewportActive,y=e.effects,v=this._getPickable(e.layers),b=(0,i.cssToDeviceRatio)(this.gl);if(!v)return{result:[],emptyInfo:(0,s.getEmptyPickingInfo)({viewports:r,x:n,y:a,pixelRatio:b})};this._resizeBuffer();for(var x,T=(0,i.cssToDevicePixels)(this.gl,[n,a],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],E=Math.round(c*b),A=this.pickingFBO,S=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:E,deviceWidth:A.width,deviceHeight:A.height}),P={x:n-c,y:a-c,width:2*c+1,height:2*c+1},M=[],R=new Set,C=0;C<f;C++){var O=void 0;if(S){var L=this._drawAndSample({layers:v,views:t,viewports:r,onViewportActive:_,deviceRect:S,cullRect:P,effects:y,pass:"picking:".concat(m)});O=(0,o.getClosestObject)(d(d({},L),{},{deviceX:w[0],deviceY:w[1],deviceRadius:E,deviceRect:S}))}else O={pickedColor:null,pickedObjectIndex:-1};var I=void 0;if(O.pickedLayer&&g&&this.depthFBO){var D=this._drawAndSample({layers:[O.pickedLayer],views:t,viewports:r,onViewportActive:_,deviceRect:{x:O.pickedX,y:O.pickedY,width:1,height:1},cullRect:P,effects:y,pass:"picking:".concat(m,":z")},!0).pickedColors;D[3]&&(I=D[0])}O.pickedLayer&&C+1<f&&(R.add(O.pickedLayer),O.pickedLayer.disablePickingIndex(O.pickedObjectIndex));var k,B=l((x=(0,s.processPickInfo)({pickInfo:O,lastPickedInfo:this.lastPickedInfo,mode:m,layers:v,viewports:r,x:n,y:a,z:I,pixelRatio:b})).values());try{for(B.s();!(k=B.n()).done;){var F=k.value;F.layer&&M.push(F)}}catch(e){B.e(e)}finally{B.f()}if(!O.pickedColor)break}var N,q=l(R);try{for(q.s();!(N=q.n()).done;)N.value.restorePickingColors()}catch(e){q.e(e)}finally{q.f()}return{result:M,emptyInfo:x.get(null)}}},{key:"_pickVisibleObjects",value:function(e){var t=e.views,r=e.viewports,n=e.x,a=e.y,l=e.width,u=void 0===l?1:l,c=e.height,d=void 0===c?1:c,h=e.mode,f=void 0===h?"query":h,p=e.maxObjects,m=void 0===p?null:p,g=e.onViewportActive,_=e.effects,y=this._getPickable(e.layers);if(!y)return[];this._resizeBuffer();for(var v=(0,i.cssToDeviceRatio)(this.gl),b=(0,i.cssToDevicePixels)(this.gl,[n,a],!0),x=b.x,T=b.y+b.height,w=(0,i.cssToDevicePixels)(this.gl,[n+u,a+d],!0),E=w.y,A=this._drawAndSample({layers:y,views:t,viewports:r,onViewportActive:g,deviceRect:{x:x,y:E,width:w.x+w.width-x,height:T-E},cullRect:{x:n,y:a,width:u,height:d},effects:_,pass:"picking:".concat(f)}),S=(0,o.getUniqueObjects)(A),P=new Map,M=Number.isFinite(m),R=0;R<S.length;R++){var C;if(M&&m&&P.size>=m)break;var O=S[R],L={color:O.pickedColor,layer:null,index:O.pickedObjectIndex,picked:!0,x:n,y:a,pixelRatio:v},I=null!==(C=(L=(0,s.getLayerPickingInfo)({layer:O.pickedLayer,info:L,mode:f})).object)&&void 0!==C?C:"".concat(L.layer.id,"[").concat(L.index,"]");P.has(I)||P.set(I,L)}return Array.from(P.values())}},{key:"_drawAndSample",value:function(e){var t,r=e.deviceRect,n=e.effects,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=a?this.depthFBO:this.pickingFBO,s={layers:e.layers,layerFilter:this.layerFilter,views:e.views,viewports:e.viewports,onViewportActive:e.onViewportActive,pickingFBO:o,deviceRect:r,cullRect:e.cullRect,effects:n,pass:e.pass,pickZ:a,preRenderStats:{}},u=l(n);try{for(u.s();!(t=u.n()).done;){var c=t.value;c.useInPicking&&(s.preRenderStats[c.id]=c.preRender(this.gl,s))}}catch(e){u.e(e)}finally{u.f()}var d=this.pickLayersPass.render(s).decodePickingColor,h=r.x,f=r.y,p=r.width,m=r.height,g=new(a?Float32Array:Uint8Array)(p*m*4);return(0,i.readPixelsToArray)(o,{sourceX:h,sourceY:f,sourceWidth:p,sourceHeight:m,target:g}),{pickedColors:g,decodePickingColor:d}}},{key:"_getPickingRect",value:function(e){var t=e.deviceX,r=e.deviceY,n=e.deviceRadius,i=e.deviceWidth,a=e.deviceHeight,o=Math.max(0,t-n),s=Math.max(0,r-n),l=Math.min(i,t+n+1)-o,u=Math.min(a,r+n+1)-s;return l<=0||u<=0?null:{x:o,y:s,width:l,height:u}}}]),e}();return deckPicker.default=h,deckPicker}var tooltip={},hasRequiredTooltip;function requireTooltip(){if(hasRequiredTooltip)return tooltip;hasRequiredTooltip=1;var e=interopRequireDefaultExports;Object.defineProperty(tooltip,"__esModule",{value:!0}),tooltip.default=void 0;var t=e(_typeofExports),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},o=function(){function e(t){(0,r.default)(this,e),(0,i.default)(this,"el",null),(0,i.default)(this,"isVisible",!1);var n=t.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,a),n.appendChild(this.el))}return(0,n.default)(e,[{key:"setTooltip",value:function(e,r,n){var i=this.el;if(i){if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(r,"px, ").concat(n,"px)"),e&&"object"===(0,t.default)(e)&&"style"in e&&Object.assign(i.style,e.style)}}},{key:"remove",value:function(){this.el&&(this.el.remove(),this.el=null)}}]),e}();return tooltip.default=o,tooltip}var es5$5={},eventManager={},hammer_browser={},hammer={exports:{}},hasRequiredHammer;function requireHammer(){return hasRequiredHammer||(hasRequiredHammer=1,function(e){!function(t,r,n,i){var a,o=["","webkit","Moz","MS","ms","o"],s=r.createElement("div"),l="function",u=Math.round,c=Math.abs,d=Date.now;function h(e,t,r){return setTimeout(v(e,r),t)}function f(e,t,r){return!!Array.isArray(e)&&(p(e,r[t],r),!0)}function p(e,t,r){var n;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==i)for(n=0;n<e.length;)t.call(r,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function m(e,r,n){var i="DEPRECATED METHOD: "+r+"\n"+n+" AT \n";return function(){var r=new Error("get-stack-trace"),n=r&&r.stack?r.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=t.console&&(t.console.warn||t.console.log);return a&&a.call(t.console,i,n),e.apply(this,arguments)}}a="function"!=typeof Object.assign?function(e){if(e===i||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==i&&null!==n)for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])}return t}:Object.assign;var g=m((function(e,t,r){for(var n=Object.keys(t),a=0;a<n.length;)(!r||r&&e[n[a]]===i)&&(e[n[a]]=t[n[a]]),a++;return e}),"extend","Use `assign`."),_=m((function(e,t){return g(e,t,!0)}),"merge","Use `assign`.");function y(e,t,r){var n,i=t.prototype;(n=e.prototype=Object.create(i)).constructor=e,n._super=i,r&&a(n,r)}function v(e,t){return function(){return e.apply(t,arguments)}}function b(e,t){return typeof e==l?e.apply(t&&t[0]||i,t):e}function x(e,t){return e===i?t:e}function T(e,t,r){p(S(t),(function(t){e.addEventListener(t,r,!1)}))}function w(e,t,r){p(S(t),(function(t){e.removeEventListener(t,r,!1)}))}function E(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function A(e,t){return e.indexOf(t)>-1}function S(e){return e.trim().split(/\s+/g)}function P(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var n=0;n<e.length;){if(r&&e[n][r]==t||!r&&e[n]===t)return n;n++}return-1}function M(e){return Array.prototype.slice.call(e,0)}function R(e,t,r){for(var n=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];P(i,o)<0&&n.push(e[a]),i[a]=o,a++}return r&&(n=t?n.sort((function(e,r){return e[t]>r[t]})):n.sort()),n}function C(e,t){for(var r,n,a=t[0].toUpperCase()+t.slice(1),s=0;s<o.length;){if((n=(r=o[s])?r+a:t)in e)return n;s++}return i}var O=1;function L(e){var r=e.ownerDocument||e;return r.defaultView||r.parentWindow||t}var I="ontouchstart"in t,D=C(t,"PointerEvent")!==i,k=I&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",F="mouse",N=25,q=1,U=4,j=8,G=1,z=2,V=4,$=8,H=16,W=z|V,X=$|H,Y=W|X,Z=["x","y"],K=["clientX","clientY"];function J(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){b(e.options.enable,[e])&&r.handler(t)},this.init()}function Q(e,t,r){var n=r.pointers.length,a=r.changedPointers.length,o=t&q&&n-a==0,s=t&(U|j)&&n-a==0;r.isFirst=!!o,r.isFinal=!!s,o&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,n=t.pointers,a=n.length;r.firstInput||(r.firstInput=ee(t)),a>1&&!r.firstMultiple?r.firstMultiple=ee(t):1===a&&(r.firstMultiple=!1);var o=r.firstInput,s=r.firstMultiple,l=s?s.center:o.center,u=t.center=te(n);t.timeStamp=d(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=ae(l,u),t.distance=ie(l,u),function(e,t){var r=t.center,n=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};t.eventType!==q&&a.eventType!==U||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y}),t.deltaX=i.x+(r.x-n.x),t.deltaY=i.y+(r.y-n.y)}(r,t),t.offsetDirection=ne(t.deltaX,t.deltaY);var h,f,p=re(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=c(p.x)>c(p.y)?p.x:p.y,t.scale=s?(h=s.pointers,ie((f=n)[0],f[1],K)/ie(h[0],h[1],K)):1,t.rotation=s?function(e,t){return ae(t[1],t[0],K)+ae(e[1],e[0],K)}(s.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,function(e,t){var r,n,a,o,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(t.eventType!=j&&(l>N||s.velocity===i)){var u=t.deltaX-s.deltaX,d=t.deltaY-s.deltaY,h=re(l,u,d);n=h.x,a=h.y,r=c(h.x)>c(h.y)?h.x:h.y,o=ne(u,d),e.lastInterval=t}else r=s.velocity,n=s.velocityX,a=s.velocityY,o=s.direction;t.velocity=r,t.velocityX=n,t.velocityY=a,t.direction=o}(r,t);var m=e.element;E(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function ee(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:u(e.pointers[r].clientX),clientY:u(e.pointers[r].clientY)},r++;return{timeStamp:d(),pointers:t,center:te(t),deltaX:e.deltaX,deltaY:e.deltaY}}function te(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var r=0,n=0,i=0;i<t;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:u(r/t),y:u(n/t)}}function re(e,t,r){return{x:t/e||0,y:r/e||0}}function ne(e,t){return e===t?G:c(e)>=c(t)?e<0?z:V:t<0?$:H}function ie(e,t,r){r||(r=Z);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.sqrt(n*n+i*i)}function ae(e,t,r){return r||(r=Z),180*Math.atan2(t[r[1]]-e[r[1]],t[r[0]]-e[r[0]])/Math.PI}J.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(L(this.element),this.evWin,this.domHandler)}};var oe={mousedown:q,mousemove:2,mouseup:U},se="mousedown",le="mousemove mouseup";function ue(){this.evEl=se,this.evWin=le,this.pressed=!1,J.apply(this,arguments)}y(ue,J,{handler:function(e){var t=oe[e.type];t&q&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=U),this.pressed&&(t&U&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:F,srcEvent:e}))}});var ce={pointerdown:q,pointermove:2,pointerup:U,pointercancel:j,pointerout:j},de={2:B,3:"pen",4:F,5:"kinect"},he="pointerdown",fe="pointermove pointerup pointercancel";function pe(){this.evEl=he,this.evWin=fe,J.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}t.MSPointerEvent&&!t.PointerEvent&&(he="MSPointerDown",fe="MSPointerMove MSPointerUp MSPointerCancel"),y(pe,J,{handler:function(e){var t=this.store,r=!1,n=e.type.toLowerCase().replace("ms",""),i=ce[n],a=de[e.pointerType]||e.pointerType,o=a==B,s=P(t,e.pointerId,"pointerId");i&q&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):i&(U|j)&&(r=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),r&&t.splice(s,1))}});var me={touchstart:q,touchmove:2,touchend:U,touchcancel:j};function ge(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,J.apply(this,arguments)}function _e(e,t){var r=M(e.touches),n=M(e.changedTouches);return t&(U|j)&&(r=R(r.concat(n),"identifier",!0)),[r,n]}y(ge,J,{handler:function(e){var t=me[e.type];if(t===q&&(this.started=!0),this.started){var r=_e.call(this,e,t);t&(U|j)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:B,srcEvent:e})}}});var ye={touchstart:q,touchmove:2,touchend:U,touchcancel:j},ve="touchstart touchmove touchend touchcancel";function be(){this.evTarget=ve,this.targetIds={},J.apply(this,arguments)}function xe(e,t){var r=M(e.touches),n=this.targetIds;if(t&(2|q)&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,a,o=M(e.changedTouches),s=[],l=this.target;if(a=r.filter((function(e){return E(e.target,l)})),t===q)for(i=0;i<a.length;)n[a[i].identifier]=!0,i++;for(i=0;i<o.length;)n[o[i].identifier]&&s.push(o[i]),t&(U|j)&&delete n[o[i].identifier],i++;return s.length?[R(a.concat(s),"identifier",!0),s]:void 0}y(be,J,{handler:function(e){var t=ye[e.type],r=xe.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:B,srcEvent:e})}});var Te=2500;function we(){J.apply(this,arguments);var e=v(this.handler,this);this.touch=new be(this.manager,e),this.mouse=new ue(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ee(e,t){e&q?(this.primaryTouch=t.changedPointers[0].identifier,Ae.call(this,t)):e&(U|j)&&Ae.call(this,t)}function Ae(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var n=this.lastTouches;setTimeout((function(){var e=n.indexOf(r);e>-1&&n.splice(e,1)}),Te)}}function Se(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],a=Math.abs(t-i.x),o=Math.abs(r-i.y);if(a<=25&&o<=25)return!0}return!1}y(we,J,{handler:function(e,t,r){var n=r.pointerType==F;if(!(n&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(r.pointerType==B)Ee.call(this,t,r);else if(n&&Se.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Pe=C(s.style,"touchAction"),Me=Pe!==i,Re="compute",Ce="auto",Oe="manipulation",Le="none",Ie="pan-x",De="pan-y",ke=function(){if(!Me)return!1;var e={},r=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!r||t.CSS.supports("touch-action",n)})),e}();function Be(e,t){this.manager=e,this.set(t)}Be.prototype={set:function(e){e==Re&&(e=this.compute()),Me&&this.manager.element.style&&ke[e]&&(this.manager.element.style[Pe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return p(this.manager.recognizers,(function(t){b(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(A(e,Le))return Le;var t=A(e,Ie),r=A(e,De);return t&&r?Le:t||r?t?Ie:De:A(e,Oe)?Oe:Ce}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,i=A(n,Le)&&!ke[Le],a=A(n,De)&&!ke[De],o=A(n,Ie)&&!ke[Ie];if(i&&1===e.pointers.length&&e.distance<2&&e.deltaTime<250)return;if(!o||!a)return i||a&&r&W||o&&r&X?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Fe=1,Ne=32;function qe(e){this.options=a({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Fe,this.simultaneous={},this.requireFail=[]}function Ue(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function je(e){return e==H?"down":e==$?"up":e==z?"left":e==V?"right":""}function Ge(e,t){var r=t.manager;return r?r.get(e):e}function ze(){qe.apply(this,arguments)}function Ve(){ze.apply(this,arguments),this.pX=null,this.pY=null}function $e(){ze.apply(this,arguments)}function He(){qe.apply(this,arguments),this._timer=null,this._input=null}function We(){ze.apply(this,arguments)}function Xe(){ze.apply(this,arguments)}function Ye(){qe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ze(e,t){return(t=t||{}).recognizers=x(t.recognizers,Ze.defaults.preset),new Ke(e,t)}function Ke(e,t){this.options=a({},Ze.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(D?pe:k?be:I?we:ue))(this,Q),this.touchAction=new Be(this,this.options.touchAction),Je(this,!0),p(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Je(e,t){var r,n=e.element;n.style&&(p(e.options.cssProps,(function(i,a){r=C(n.style,a),t?(e.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=e.oldCssProps[r]||""})),t||(e.oldCssProps={}))}qe.prototype={defaults:{},set:function(e){return a(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(f(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Ge(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return f(e,"dropRecognizeWith",this)||(e=Ge(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(f(e,"requireFailure",this))return this;var t=this.requireFail;return-1===P(t,e=Ge(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(f(e,"dropRequireFailure",this))return this;e=Ge(e,this);var t=P(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,r=this.state;function n(r){t.manager.emit(r,e)}r<8&&n(t.options.event+Ue(r)),n(t.options.event),e.additionalEvent&&n(e.additionalEvent),r>=8&&n(t.options.event+Ue(r))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ne},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ne|Fe)))return!1;e++}return!0},recognize:function(e){var t=a({},e);if(!b(this.options.enable,[this,t]))return this.reset(),void(this.state=Ne);56&this.state&&(this.state=Fe),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},y(ze,qe,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,n=6&t,i=this.attrTest(e);return n&&(r&j||!i)?16|t:n||i?r&U?8|t:2&t?4|t:2:Ne}}),y(Ve,ze,{defaults:{event:"pan",threshold:10,pointers:1,direction:Y},getTouchAction:function(){var e=this.options.direction,t=[];return e&W&&t.push(De),e&X&&t.push(Ie),t},directionTest:function(e){var t=this.options,r=!0,n=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(t.direction&W?(i=0===a?G:a<0?z:V,r=a!=this.pX,n=Math.abs(e.deltaX)):(i=0===o?G:o<0?$:H,r=o!=this.pY,n=Math.abs(e.deltaY))),e.direction=i,r&&n>t.threshold&&i&t.direction},attrTest:function(e){return ze.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=je(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),y($e,ze,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Le]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){1!==e.scale&&(e.additionalEvent=this.options.event+(e.scale<1?"in":"out")),this._super.emit.call(this,e)}}),y(He,qe,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ce]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!n||!r||e.eventType&(U|j)&&!i)this.reset();else if(e.eventType&q)this.reset(),this._timer=h((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&U)return 8;return Ne},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&U?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),y(We,ze,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Le]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),y(Xe,ze,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:W|X,pointers:1},getTouchAction:function(){return Ve.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return r&(W|X)?t=e.overallVelocity:r&W?t=e.overallVelocityX:r&X&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&c(t)>this.options.velocity&&e.eventType&U},emit:function(e){var t=je(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),y(Ye,qe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Oe]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&q&&0===this.count)return this.failTimeout();if(n&&i&&r){if(e.eventType!=U)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||ie(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=h((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ne},failTimeout:function(){return this._timer=h((function(){this.state=Ne}),this.options.interval,this),Ne},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ze.VERSION="2.0.7",Ze.defaults={domEvents:!1,touchAction:Re,enable:!0,inputTarget:null,inputClass:null,preset:[[We,{enable:!1}],[$e,{enable:!1},["rotate"]],[Xe,{direction:W}],[Ve,{direction:W},["swipe"]],[Ye],[Ye,{event:"doubletap",taps:2},["tap"]],[He]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ke.prototype={set:function(e){return a(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var r;this.touchAction.preventDefaults(e);var n=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var a=0;a<n.length;)r=n[a],2===t.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(e),!i&&14&r.state&&(i=t.curRecognizer=r),a++}},get:function(e){if(e instanceof qe)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(f(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(f(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=P(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==i&&t!==i){var r=this.handlers;return p(S(e),(function(e){r[e]=r[e]||[],r[e].push(t)})),this}},off:function(e,t){if(e!==i){var r=this.handlers;return p(S(e),(function(e){t?r[e]&&r[e].splice(P(r[e],t),1):delete r[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=r.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&Je(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(Ze,{INPUT_START:q,INPUT_MOVE:2,INPUT_END:U,INPUT_CANCEL:j,STATE_POSSIBLE:Fe,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ne,DIRECTION_NONE:G,DIRECTION_LEFT:z,DIRECTION_RIGHT:V,DIRECTION_UP:$,DIRECTION_DOWN:H,DIRECTION_HORIZONTAL:W,DIRECTION_VERTICAL:X,DIRECTION_ALL:Y,Manager:Ke,Input:J,TouchAction:Be,TouchInput:be,MouseInput:ue,PointerEventInput:pe,TouchMouseInput:we,SingleTouchInput:ge,Recognizer:qe,AttrRecognizer:ze,Tap:Ye,Pan:Ve,Swipe:Xe,Pinch:$e,Rotate:We,Press:He,on:T,off:w,each:p,merge:_,extend:g,assign:a,inherit:y,bindFn:v,prefixed:C}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=Ze,"function"==typeof i&&i.amd?i((function(){return Ze})):e.exports?e.exports=Ze:t.Hammer=Ze}(window,document)}(hammer)),hammer.exports}var hammerOverrides={},hasRequiredHammerOverrides,hasRequiredHammer_browser;function requireHammerOverrides(){if(hasRequiredHammerOverrides)return hammerOverrides;hasRequiredHammerOverrides=1,Object.defineProperty(hammerOverrides,"__esModule",{value:!0}),hammerOverrides.enhanceMouseInput=hammerOverrides.enhancePointerEventInput=void 0;var e={mousedown:1,mousemove:2,mouseup:4};return hammerOverrides.enhancePointerEventInput=function(e){var t=e.prototype.handler;e.prototype.handler=function(e){var r=this.store;e.button>0&&"pointerdown"===e.type&&(function(t,r){for(var n=0;n<t.length;n++)if(t[n].pointerId===e.pointerId)return!0;return!1}(r)||r.push(e)),t.call(this,e)}},hammerOverrides.enhanceMouseInput=function(t){t.prototype.handler=function(t){var r=e[t.type];1&r&&t.button>=0&&(this.pressed=!0),2&r&&0===t.which&&(r=4),this.pressed&&(4&r&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}},hammerOverrides}function requireHammer_browser(){if(hasRequiredHammer_browser)return hammer_browser;hasRequiredHammer_browser=1,Object.defineProperty(hammer_browser,"__esModule",{value:!0}),hammer_browser.Manager=void 0;var e=requireHammer(),t=requireHammerOverrides();return(0,t.enhancePointerEventInput)(e.PointerEventInput),(0,t.enhanceMouseInput)(e.MouseInput),hammer_browser.Manager=e.Manager,hammer_browser.default=e,hammer_browser}var wheelInput={},input={},hasRequiredInput;function requireInput(){if(hasRequiredInput)return input;hasRequiredInput=1;var e=this&&this.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};return Object.defineProperty(input,"__esModule",{value:!0}),input.default=function(t,r,n){this.element=t,this.callback=r,this.options=e({enable:!0},n)},input}var constants$1={},hasRequiredConstants$1;function requireConstants$1(){if(hasRequiredConstants$1)return constants$1;hasRequiredConstants$1=1,Object.defineProperty(constants$1,"__esModule",{value:!0}),constants$1.GESTURE_EVENT_ALIASES=constants$1.EVENT_RECOGNIZER_MAP=constants$1.INPUT_EVENT_TYPES=constants$1.BASIC_EVENT_ALIASES=constants$1.RECOGNIZER_FALLBACK_MAP=constants$1.RECOGNIZER_COMPATIBLE_MAP=constants$1.RECOGNIZERS=void 0;var e=requireHammer_browser();return constants$1.RECOGNIZERS=e.default?[[e.default.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[e.default.Rotate,{enable:!1}],[e.default.Pinch,{enable:!1}],[e.default.Swipe,{enable:!1}],[e.default.Pan,{threshold:0,enable:!1}],[e.default.Press,{enable:!1}],[e.default.Tap,{event:"doubletap",taps:2,enable:!1}],[e.default.Tap,{event:"anytap",enable:!1}],[e.default.Tap,{enable:!1}]]:null,constants$1.RECOGNIZER_COMPATIBLE_MAP={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},constants$1.RECOGNIZER_FALLBACK_MAP={doubletap:["tap"]},constants$1.BASIC_EVENT_ALIASES={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},constants$1.INPUT_EVENT_TYPES={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},constants$1.EVENT_RECOGNIZER_MAP={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},constants$1.GESTURE_EVENT_ALIASES={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},constants$1}var globals={},hasRequiredGlobals,hasRequiredWheelInput;function requireGlobals(){if(hasRequiredGlobals)return globals;hasRequiredGlobals=1,Object.defineProperty(globals,"__esModule",{value:!0}),globals.passiveSupported=globals.document=globals.global=globals.window=globals.userAgent=void 0,globals.userAgent="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";var e="undefined"!=typeof window?window:global;globals.window=e;var t="undefined"!=typeof global?global:window;globals.global=t;var r="undefined"!=typeof document?document:{};globals.document=r;var n=!1;globals.passiveSupported=n;try{e.addEventListener("test",null,{get passive(){return globals.passiveSupported=n=!0,!0}}),e.removeEventListener("test",null)}catch(e){globals.passiveSupported=n=!1}return globals}function requireWheelInput(){if(hasRequiredWheelInput)return wheelInput;hasRequiredWheelInput=1;var e,t=this&&this.__extends||(e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});Object.defineProperty(wheelInput,"__esModule",{value:!0});var r=requireInput(),n=requireConstants$1(),i=requireGlobals(),a=-1!==i.userAgent.indexOf("firefox"),o=n.INPUT_EVENT_TYPES.WHEEL_EVENTS,s="wheel",l=4.000244140625,u=function(e){function r(t,r,n){var u=e.call(this,t,r,n)||this;return u.handleEvent=function(e){if(u.options.enable){var t=e.deltaY;i.window.WheelEvent&&(a&&e.deltaMode===i.window.WheelEvent.DOM_DELTA_PIXEL&&(t/=i.window.devicePixelRatio),e.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%l==0&&(t=Math.floor(t/l)),e.shiftKey&&t&&(t*=.25),u.callback({type:s,center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})}},u.events=(u.options.events||[]).concat(o),u.events.forEach((function(e){return t.addEventListener(e,u.handleEvent,!!i.passiveSupported&&{passive:!1})})),u}return t(r,e),r.prototype.destroy=function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))},r.prototype.enableEventType=function(e,t){e===s&&(this.options.enable=t)},r}(r.default);return wheelInput.default=u,wheelInput}var moveInput={},hasRequiredMoveInput;function requireMoveInput(){if(hasRequiredMoveInput)return moveInput;hasRequiredMoveInput=1;var e,t=this&&this.__extends||(e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});Object.defineProperty(moveInput,"__esModule",{value:!0});var r=requireInput(),n=requireConstants$1().INPUT_EVENT_TYPES.MOUSE_EVENTS,i="pointermove",a="pointerover",o="pointerout",s="pointerenter",l="pointerleave",u=function(e){function r(t,r,i){var a=e.call(this,t,r,i)||this;a.handleEvent=function(e){a.handleOverEvent(e),a.handleOutEvent(e),a.handleEnterEvent(e),a.handleLeaveEvent(e),a.handleMoveEvent(e)},a.pressed=!1;var o=a.options.enable;return a.enableMoveEvent=o,a.enableLeaveEvent=o,a.enableEnterEvent=o,a.enableOutEvent=o,a.enableOverEvent=o,a.events=(a.options.events||[]).concat(n),a.events.forEach((function(e){return t.addEventListener(e,a.handleEvent)})),a}return t(r,e),r.prototype.destroy=function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))},r.prototype.enableEventType=function(e,t){e===i&&(this.enableMoveEvent=t),e===a&&(this.enableOverEvent=t),e===o&&(this.enableOutEvent=t),e===s&&(this.enableEnterEvent=t),e===l&&(this.enableLeaveEvent=t)},r.prototype.handleOverEvent=function(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit(a,e)},r.prototype.handleOutEvent=function(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit(o,e)},r.prototype.handleEnterEvent=function(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit(s,e)},r.prototype.handleLeaveEvent=function(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit(l,e)},r.prototype.handleMoveEvent=function(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this._emit(i,e);break;case"mouseup":this.pressed=!1}},r.prototype._emit=function(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})},r}(r.default);return moveInput.default=u,moveInput}var keyInput={},hasRequiredKeyInput;function requireKeyInput(){if(hasRequiredKeyInput)return keyInput;hasRequiredKeyInput=1;var e,t=this&&this.__extends||(e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});Object.defineProperty(keyInput,"__esModule",{value:!0});var r=requireInput(),n=requireConstants$1().INPUT_EVENT_TYPES.KEY_EVENTS,i="keydown",a="keyup",o=function(e){function r(t,r,o){var s=e.call(this,t,r,o)||this;return s.handleEvent=function(e){var t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(s.enableDownEvent&&"keydown"===e.type&&s.callback({type:i,srcEvent:e,key:e.key,target:e.target}),s.enableUpEvent&&"keyup"===e.type&&s.callback({type:a,srcEvent:e,key:e.key,target:e.target}))},s.enableDownEvent=s.options.enable,s.enableUpEvent=s.options.enable,s.events=(s.options.events||[]).concat(n),t.tabIndex=s.options.tabIndex||0,t.style.outline="none",s.events.forEach((function(e){return t.addEventListener(e,s.handleEvent)})),s}return t(r,e),r.prototype.destroy=function(){var e=this;this.events.forEach((function(t){return e.element.removeEventListener(t,e.handleEvent)}))},r.prototype.enableEventType=function(e,t){e===i&&(this.enableDownEvent=t),e===a&&(this.enableUpEvent=t)},r}(r.default);return keyInput.default=o,keyInput}var contextmenuInput={},hasRequiredContextmenuInput;function requireContextmenuInput(){if(hasRequiredContextmenuInput)return contextmenuInput;hasRequiredContextmenuInput=1;var e,t=this&&this.__extends||(e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)},function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)});Object.defineProperty(contextmenuInput,"__esModule",{value:!0});var r=requireInput(),n="contextmenu",i=function(e){function r(t,r,i){var a=e.call(this,t,r,i)||this;return a.handleEvent=function(e){a.options.enable&&a.callback({type:n,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},t.addEventListener("contextmenu",a.handleEvent),a}return t(r,e),r.prototype.destroy=function(){this.element.removeEventListener("contextmenu",this.handleEvent)},r.prototype.enableEventType=function(e,t){e===n&&(this.options.enable=t)},r}(r.default);return contextmenuInput.default=i,contextmenuInput}var eventRegistrar={},eventUtils={},hasRequiredEventUtils,hasRequiredEventRegistrar,hasRequiredEventManager,hasRequiredEs5$1,hasRequiredDeck;function requireEventUtils(){if(hasRequiredEventUtils)return eventUtils;hasRequiredEventUtils=1,Object.defineProperty(eventUtils,"__esModule",{value:!0}),eventUtils.getOffsetPosition=eventUtils.whichButtons=void 0;var e={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};return eventUtils.whichButtons=function(t){var r=e[t.srcEvent.type];if(!r)return null;var n=t.srcEvent,i=n.buttons,a=n.button,o=n.which,s=!1,l=!1,u=!1;return 4===r||2===r&&!Number.isFinite(i)?(s=1===o,l=2===o,u=3===o):2===r?(s=Boolean(1&i),l=Boolean(4&i),u=Boolean(2&i)):1===r&&(s=0===a,l=1===a,u=2===a),{leftButton:s,middleButton:l,rightButton:u}},eventUtils.getOffsetPosition=function(e,t){var r=e.center;if(!r)return null;var n=t.getBoundingClientRect();return{center:r,offsetCenter:{x:(r.x-n.left-t.clientLeft)/(n.width/t.offsetWidth||1),y:(r.y-n.top-t.clientTop)/(n.height/t.offsetHeight||1)}}},eventUtils}function requireEventRegistrar(){if(hasRequiredEventRegistrar)return eventRegistrar;hasRequiredEventRegistrar=1;var e=this&&this.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};Object.defineProperty(eventRegistrar,"__esModule",{value:!0});var t=requireEventUtils(),r={srcElement:"root",priority:0},n=function(){function n(e){var t=this;this.handleEvent=function(e){if(!t.isEmpty()){for(var r=t._normalizeEvent(e),n=e.srcEvent.target;n&&n!==r.rootElement;){if(t._emit(r,n),r.handled)return;n=n.parentNode}t._emit(r,"root")}},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}return n.prototype.isEmpty=function(){return!this._active},n.prototype.add=function(t,n,i,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1);var s=this.handlers,l=this.handlersByElement,u=r;"string"==typeof i||i&&i.addEventListener?u=e(e({},r),{srcElement:i}):i&&(u=e(e({},r),i));var c=l.get(u.srcElement);c||l.set(u.srcElement,c=[]);var d={type:t,handler:n,srcElement:u.srcElement,priority:u.priority};a&&(d.once=!0),o&&(d.passive=!0),s.push(d),this._active=this._active||!d.passive;for(var h=c.length-1;h>=0&&!(c[h].priority>=d.priority);)h--;c.splice(h+1,0,d)},n.prototype.remove=function(e,t){for(var r=this.handlers,n=this.handlersByElement,i=r.length-1;i>=0;i--){var a=r[i];if(a.type===e&&a.handler===t){r.splice(i,1);var o=n.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&n.delete(a.srcElement)}}this._active=r.some((function(e){return!e.passive}))},n.prototype._emit=function(t,r){var n=this.handlersByElement.get(r);if(n){for(var i=!1,a=function(){t.handled=!0},o=function(){t.handled=!0,i=!0},s=[],l=0;l<n.length;l++){var u=n[l],c=u.type,d=u.once;if((0,u.handler)(e(e({},t),{type:c,stopPropagation:a,stopImmediatePropagation:o})),d&&s.push(n[l]),i)break}for(l=0;l<s.length;l++){var h=s[l];this.remove(c=h.type,h.handler)}}},n.prototype._normalizeEvent=function(r){var n=this.eventManager.getElement();return e(e(e(e({},r),(0,t.whichButtons)(r)),(0,t.getOffsetPosition)(r,n)),{preventDefault:function(){r.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n})},n}();return eventRegistrar.default=n,eventRegistrar}function requireEventManager(){if(hasRequiredEventManager)return eventManager;hasRequiredEventManager=1;var e=this&&this.__assign||function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)},t=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o};Object.defineProperty(eventManager,"__esModule",{value:!0});var n=requireHammer_browser(),i=requireWheelInput(),a=requireMoveInput(),o=requireKeyInput(),s=requireContextmenuInput(),l=requireEventRegistrar(),u=requireConstants$1(),c={events:null,recognizers:null,recognizerOptions:{},Manager:n.Manager,touchAction:"none",tabIndex:0},d=function(){function n(t,r){var n=this;void 0===t&&(t=null),this._onBasicInput=function(e){var t=u.BASIC_EVENT_ALIASES[e.srcEvent.type];t&&n.manager.emit(t,e)},this._onOtherEvent=function(e){n.manager.emit(e.type,e)},this.options=e(e({},c),r),this.events=new Map,this.setElement(t);var i=this.options.events;i&&this.on(i)}return n.prototype.getElement=function(){return this.element},n.prototype.setElement=function(e){var n,l,c=this;if(this.element&&this.destroy(),this.element=e,e){var d=this.options,h=d.Manager;for(var f in this.manager=new h(e,{touchAction:d.touchAction,recognizers:d.recognizers||u.RECOGNIZERS}).on("hammer.input",this._onBasicInput),d.recognizers||Object.keys(u.RECOGNIZER_COMPATIBLE_MAP).forEach((function(e){var t=c.manager.get(e);t&&u.RECOGNIZER_COMPATIBLE_MAP[e].forEach((function(e){t.recognizeWith(e)}))})),d.recognizerOptions){var p=this.manager.get(f);if(p){var m=d.recognizerOptions[f];delete m.enable,p.set(m)}}this.wheelInput=new i.default(e,this._onOtherEvent,{enable:!1}),this.moveInput=new a.default(e,this._onOtherEvent,{enable:!1}),this.keyInput=new o.default(e,this._onOtherEvent,{enable:!1,tabIndex:d.tabIndex}),this.contextmenuInput=new s.default(e,this._onOtherEvent,{enable:!1});try{for(var g=t(this.events),_=g.next();!_.done;_=g.next()){var y=r(_.value,2),v=y[0],b=y[1];b.isEmpty()||(this._toggleRecognizer(b.recognizerName,!0),this.manager.on(v,b.handleEvent))}}catch(e){n={error:e}}finally{try{_&&!_.done&&(l=g.return)&&l.call(g)}finally{if(n)throw n.error}}}},n.prototype.destroy=function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)},n.prototype.on=function(e,t,r){this._addEventHandler(e,t,r,!1)},n.prototype.once=function(e,t,r){this._addEventHandler(e,t,r,!0)},n.prototype.watch=function(e,t,r){this._addEventHandler(e,t,r,!1,!0)},n.prototype.off=function(e,t){this._removeEventHandler(e,t)},n.prototype._toggleRecognizer=function(e,t){var r=this.manager;if(r){var n=r.get(e);if(n&&n.options.enable!==t){n.set({enable:t});var i=u.RECOGNIZER_FALLBACK_MAP[e];i&&!this.options.recognizers&&i.forEach((function(i){var a=r.get(i);t?(a.requireFailure(e),n.dropRequireFailure(i)):a.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}},n.prototype._addEventHandler=function(e,t,r,n,i){if("string"==typeof e){var a=this.manager,o=this.events,s=u.GESTURE_EVENT_ALIASES[e]||e,c=o.get(s);c||(c=new l.default(this),o.set(s,c),c.recognizerName=u.EVENT_RECOGNIZER_MAP[s]||s,a&&a.on(s,c.handleEvent)),c.add(e,t,r,n,i),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}else for(var d in r=t,e)this._addEventHandler(d,e[d],r,n,i)},n.prototype._removeEventHandler=function(e,r){var n,i;if("string"==typeof e){var a=this.events,o=a.get(u.GESTURE_EVENT_ALIASES[e]||e);if(o&&(o.remove(e,r),o.isEmpty())){var s=o.recognizerName,l=!1;try{for(var c=t(a.values()),d=c.next();!d.done;d=c.next()){var h=d.value;if(h.recognizerName===s&&!h.isEmpty()){l=!0;break}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}l||this._toggleRecognizer(s,!1)}}else for(var f in e)this._removeEventHandler(f,e[f])},n}();return eventManager.default=d,eventManager}function requireEs5$1(){return hasRequiredEs5$1||(hasRequiredEs5$1=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=void 0;var t=requireEventManager();Object.defineProperty(e,"EventManager",{enumerable:!0,get:function(){return t.default}})}(es5$5)),es5$5}function requireDeck(){if(hasRequiredDeck)return deck;hasRequiredDeck=1;var e=interopRequireDefaultExports;Object.defineProperty(deck,"__esModule",{value:!0}),deck.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireLayerManager()),a=e(requireViewManager()),o=e(requireMapView()),s=e(requireEffectManager()),l=e(requireDeckRenderer()),u=e(requireDeckPicker()),c=e(requireTooltip()),d=e(requireLog()),h=requireDeepEqual(),f=e(requireTypedArrayManager()),p=init$2,m=requireEs5$5(),g=es5$d,_=requireEs5$3(),y=requireEs5$1(),v=e(requireAssert()),b=constants$4;function x(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(){}var S={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:A,onResize:A,onViewStateChange:A,onInteractionStateChange:A,onBeforeRender:A,onAfterRender:A,onLoad:A,onError:function(e){return d.default.error(e.message,e.cause)()},onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:function(e){return e.isDragging?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1},P=function(){function e(r){var i=this;(0,t.default)(this,e),(0,n.default)(this,"props",void 0),(0,n.default)(this,"width",0),(0,n.default)(this,"height",0),(0,n.default)(this,"userData",{}),(0,n.default)(this,"canvas",null),(0,n.default)(this,"viewManager",null),(0,n.default)(this,"layerManager",null),(0,n.default)(this,"effectManager",null),(0,n.default)(this,"deckRenderer",null),(0,n.default)(this,"deckPicker",null),(0,n.default)(this,"eventManager",null),(0,n.default)(this,"tooltip",null),(0,n.default)(this,"metrics",void 0),(0,n.default)(this,"animationLoop",void 0),(0,n.default)(this,"stats",void 0),(0,n.default)(this,"viewState",void 0),(0,n.default)(this,"cursorState",void 0),(0,n.default)(this,"_needsRedraw",void 0),(0,n.default)(this,"_pickRequest",void 0),(0,n.default)(this,"_lastPointerDownInfo",null),(0,n.default)(this,"_metricsCounter",void 0),(0,n.default)(this,"_onPointerMove",(function(e){var t=i._pickRequest;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;var r=e.offsetCenter;if(!r)return;t.x=r.x,t.y=r.y,t.radius=i.props.pickingRadius}i.layerManager&&(i.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e})),(0,n.default)(this,"_onEvent",(function(e){var t=b.EVENTS[e.type],r=e.offsetCenter;if(t&&r&&i.layerManager){var n=i.layerManager.getLayers(),a=i.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:n,viewports:i.getViewports(r)},i._lastPointerDownInfo),o=a.layer,s=o&&(o[t.handler]||o.props[t.handler]),l=i.props[t.handler],u=!1;s&&(u=s.call(o,a,e)),!u&&l&&l(a,e)}})),(0,n.default)(this,"_onPointerDown",(function(e){var t=e.offsetCenter,r=i._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:i.props.pickingRadius});i._lastPointerDownInfo=r.result[0]||r.emptyInfo})),this.props=E(E({},S),r),r=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},r.viewState&&r.initialViewState&&d.default.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===(0,m.getBrowser)()&&d.default.warn("IE 11 is not supported")(),this.viewState=r.initialViewState,r.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(r)),this.animationLoop=this._createAnimationLoop(r),this.stats=new _.Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(r),r._typedArrayManagerProps&&f.default.setOptions(r._typedArrayManagerProps),this.animationLoop.start()}return(0,r.default)(e,[{key:"finalize",value:function(){var e,t,r,n,i,a,o,s,l;null===(e=this.animationLoop)||void 0===e||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,null===(t=this.layerManager)||void 0===t||t.finalize(),this.layerManager=null,null===(r=this.viewManager)||void 0===r||r.finalize(),this.viewManager=null,null===(n=this.effectManager)||void 0===n||n.finalize(),this.effectManager=null,null===(i=this.deckRenderer)||void 0===i||i.finalize(),this.deckRenderer=null,null===(a=this.deckPicker)||void 0===a||a.finalize(),this.deckPicker=null,null===(o=this.eventManager)||void 0===o||o.destroy(),this.eventManager=null,null===(s=this.tooltip)||void 0===s||s.remove(),this.tooltip=null,this.props.canvas||this.props.gl||!this.canvas||(null===(l=this.canvas.parentElement)||void 0===l||l.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&d.default.removed("onLayerHover","onHover")(),"onLayerClick"in e&&d.default.removed("onLayerClick","onClick")(),e.initialViewState&&!(0,h.deepEqual)(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);var t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";var t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t||r||n||i||a}},{key:"redraw",value:function(e){if(this.layerManager){var t=this.needsRedraw({clearRedrawFlags:!0});(t=e||t)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}}},{key:"isInitialized",get:function(){return null!==this.viewManager}},{key:"getViews",value:function(){return(0,v.default)(this.viewManager),this.viewManager.views}},{key:"getViewports",value:function(e){return(0,v.default)(this.viewManager),this.viewManager.getViewports(e)}},{key:"getCanvas",value:function(){return this.canvas}},{key:"pickObject",value:function(e){var t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}},{key:"pickMultipleObjects",value:function(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}},{key:"pickObjects",value:function(e){return this._pick("pickObjects","pickObjects Time",e)}},{key:"_addResources",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}},{key:"_removeResources",value:function(e){var t,r=x(e);try{for(r.s();!(t=r.n()).done;)this.layerManager.resourceManager.remove(t.value)}catch(e){r.e(e)}finally{r.f()}}},{key:"_addDefaultEffect",value:function(e){this.effectManager.addDefaultEffect(e)}},{key:"_pick",value:function(e,t,r){(0,v.default)(this.deckPicker);var n=this.stats;n.get("Pick Count").incrementCount(),n.get(t).timeStart();var i=this.deckPicker[e](E({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},r));return n.get(t).timeEnd(),i}},{key:"_createCanvas",value:function(e){var t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),(0,v.default)(t)),t||((t=document.createElement("canvas")).id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}},{key:"_setCanvasSize",value:function(e){if(this.canvas){var t=e.width,r=e.height;if(t||0===t){var n=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=n}if(r||0===r){var i,a=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=(null===(i=e.style)||void 0===i?void 0:i.position)||"absolute",this.canvas.style.height=a}}}},{key:"_updateCanvasSize",value:function(){var e,t,r=this.canvas;if(r){var n,i,a=null!==(e=r.clientWidth)&&void 0!==e?e:r.width,o=null!==(t=r.clientHeight)&&void 0!==t?t:r.height;a===this.width&&o===this.height||(this.width=a,this.height=o,null===(n=this.viewManager)||void 0===n||n.setProps({width:a,height:o}),null===(i=this.layerManager)||void 0===i||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:a,height:o}))}}},{key:"_createAnimationLoop",value:function(e){var t=this,r=e.gl,n=e.glOptions,i=e.debug,a=e.onError,o=e.onBeforeRender,s=e.onAfterRender;return new g.AnimationLoop({width:e.width,height:e.height,useDevicePixels:e.useDevicePixels,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,gl:r,onCreateContext:function(e){return(0,g.createGLContext)(E(E(E({},n),e),{},{canvas:t.canvas,debug:i,onContextLost:function(){return t._onContextLost()}}))},onInitialize:function(e){return t._setGLContext(e.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:o,onAfterRender:s,onError:a})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var e=this.props.views||[new o.default({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}},{key:"_onContextLost",value:function(){var e=this.props.onError;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}},{key:"_pickAndCallback",value:function(){var e=this._pickRequest;if(e.event){var t=this._pick("pickObject","pickObject Time",e),r=t.result,n=t.emptyInfo;this.cursorState.isHovering=r.length>0;var i,a=n,o=!1,s=x(r);try{for(s.s();!(i=s.n()).done;){var l,u=i.value;a=u,o=(null===(l=u.layer)||void 0===l?void 0:l.onHover(u,e.event))||o}}catch(e){s.e(e)}finally{s.f()}if(!o&&this.props.onHover&&this.props.onHover(a,e.event),this.props.getTooltip&&this.tooltip){var c=this.props.getTooltip(a);this.tooltip.setTooltip(c,a.x,a.y)}e.event=null}}},{key:"_updateCursor",value:function(){var e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}},{key:"_setGLContext",value:function(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,(0,g.instrumentGLContext)(e,{enable:!0,copyState:!0})),this.tooltip=new c.default(this.canvas),(0,g.setParameters)(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);var t=new g.Timeline;for(var r in t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new y.EventManager(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),b.EVENTS)this.eventManager.on(r,this._onEvent);this.viewManager=new a.default({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var n=this.viewManager.getViewports()[0];this.layerManager=new i.default(e,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new s.default,this.deckRenderer=new l.default(e),this.deckPicker=new u.default(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(e,t){var r=this.layerManager.context.gl;(0,g.setParameters)(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers(E({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},t)),this.props.onAfterRender({gl:r})}},{key:"_onRenderFrame",value:function(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),d.default.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(e){var t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=E(E({},this.viewState),{},(0,n.default)({},e.viewId,t)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}},{key:"_getFrameStats",value:function(){var e=this.stats;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();var t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var e=this.metrics,t=this.stats;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();var r=g.lumaStats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}]),e}();return deck.default=P,(0,n.default)(P,"defaultProps",S),(0,n.default)(P,"VERSION",p.VERSION),deck}var attributeManager={},attribute={},dataColumn={},shaderAttribute={},hasRequiredShaderAttribute;function requireShaderAttribute(){if(hasRequiredShaderAttribute)return shaderAttribute;hasRequiredShaderAttribute=1;var e=interopRequireDefaultExports;Object.defineProperty(shaderAttribute,"__esModule",{value:!0}),shaderAttribute.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty());function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var o=function(){function e(r,i){(0,t.default)(this,e),(0,n.default)(this,"opts",void 0),(0,n.default)(this,"source",void 0),this.opts=i,this.source=r}return(0,r.default)(e,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];var r=this.source.value,n=t.size,i=r;if(r&&r.length!==n){i=new Float32Array(n);for(var a=t.elementOffset||0,o=0;o<n;++o)i[o]=r[a+o]}return i}},{key:"getAccessor",value:function(){return a(a({},this.source.getAccessor()),this.opts)}}]),e}();return shaderAttribute.default=o,shaderAttribute}var glUtils={},hasRequiredGlUtils,hasRequiredDataColumn;function requireGlUtils(){return hasRequiredGlUtils||(hasRequiredGlUtils=1,Object.defineProperty(glUtils,"__esModule",{value:!0}),glUtils.glArrayFromType=function(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}),glUtils}function requireDataColumn(){if(hasRequiredDataColumn)return dataColumn;hasRequiredDataColumn=1;var e=interopRequireDefaultExports;Object.defineProperty(dataColumn,"__esModule",{value:!0}),dataColumn.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=e(requireShaderAttribute()),o=requireGlUtils(),s=e(requireTypedArrayManager()),l=requireMathUtils(),u=e(requireLog());function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){return e.stride||e.size*e.bytesPerElement}function f(e,t){t.offset&&u.default.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var r=h(e),n=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*r+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return d(d({},t),{},{offset:n,stride:r})}var p=function(){function e(r,a,s){(0,t.default)(this,e),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"id",void 0),(0,n.default)(this,"size",void 0),(0,n.default)(this,"settings",void 0),(0,n.default)(this,"value",void 0),(0,n.default)(this,"doublePrecision",void 0),(0,n.default)(this,"_buffer",void 0),(0,n.default)(this,"state",void 0),this.gl=r,this.id=a.id||"",this.size=a.size||1;var l,u=a.logicalType||a.type,c=5130===u,h=a.defaultValue;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0),l=c?5126:!u&&a.isIndexed?r&&(0,i.hasFeature)(r,i.FEATURES.ELEMENT_INDEX_UINT32)?5125:5123:u||5126;var f=(0,o.glArrayFromType)(u||l||5126);this.doublePrecision=c,c&&!1===a.fp64&&(f=Float32Array),this.value=null,this.settings=d(d({},a),{},{defaultType:f,defaultValue:h,logicalType:u,type:l,size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT}),this.state=d(d({},s),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}),this._buffer=null}return(0,r.default)(e,[{key:"isConstant",get:function(){return this.state.constant}},{key:"buffer",get:function(){if(!this._buffer){var e=this.settings;this._buffer=new i.Buffer(this.gl,{id:this.id,target:e.isIndexed?34963:34962,accessor:{type:e.type}})}return this._buffer}},{key:"byteOffset",get:function(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*h(e):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(e){this.state.numInstances=e}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),s.default.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(e,t){if(this.doublePrecision){var r={},i=this.value instanceof Float64Array,o={high:l=f(s=this.getAccessor(),t||{}),low:d(d({},l),{},{offset:l.offset+4*s.size})};return r[e]=new a.default(this,o.high),r["".concat(e,"64Low")]=i?new a.default(this,o.low):new Float32Array(this.size),r}var s,l;if(t){var u=f(this.getAccessor(),t);return(0,n.default)({},e,new a.default(this,u))}return(0,n.default)({},e,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var e=null;if(this.state.constant&&this.value){var t=Array.from(this.value);e=[t,t]}else{var r=this.value,n=this.size,i=this.numInstances*n;if(r&&i&&r.length>=i){for(var a=new Array(n).fill(1/0),o=new Array(n).fill(-1/0),s=0;s<i;)for(var l=0;l<n;l++){var u=r[s++];u<a[l]&&(a[l]=u),u>o[l]&&(o[l]=u)}e=[a,o]}}return this.state.bounds=e,e}},{key:"setData",value:function(e){var t,r=this.state;t=ArrayBuffer.isView(e)?{value:e}:e instanceof i.Buffer?{buffer:e}:e;var n=d(d({},this.settings),t);if(r.bufferAccessor=n,r.bounds=null,t.constant){var a=t.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),r.constant&&this._areValuesEqual(a,this.value))return!1;r.externalBuffer=null,r.constant=!0,this.value=a}else if(t.buffer){var o=t.buffer;r.externalBuffer=o,r.constant=!1,this.value=t.value||null;var s=t.value instanceof Float64Array;n.type=t.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(s?2:1),n.stride=h(n)}else if(t.value){this._checkExternalBuffer(t);var u=t.value;r.externalBuffer=null,r.constant=!1,this.value=u,n.bytesPerElement=u.BYTES_PER_ELEMENT,n.stride=h(n);var c=this.buffer,f=this.byteOffset;this.doublePrecision&&u instanceof Float64Array&&(u=(0,l.toDoublePrecisionArray)(u,n));var p=u.byteLength+f+2*n.stride;c.byteLength<p&&c.reallocate(p),c.setAccessor(null),c.subData({data:u,offset:f}),n.type=t.type||c.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;var t=this.value,r=e.startOffset,n=void 0===r?0:r,i=e.endOffset;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?(0,l.toDoublePrecisionArray)(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),offset:n*t.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.state,n=r.allocatedValue,i=s.default.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=i;var a=this.buffer,o=this.byteOffset;return a.byteLength<i.byteLength+o&&(a.reallocate(i.byteLength+o),t&&n&&a.subData({data:n instanceof Float64Array?(0,l.toDoublePrecisionArray)(n,this):n,offset:o})),r.allocatedValue=i,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(e){var t=e.value;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));var r=this.settings.defaultType,n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));t instanceof r||!this.settings.normalized||"normalized"in e||u.default.warn("Attribute ".concat(this.id," is normalized"))()}},{key:"normalizeConstant",value:function(e){switch(this.settings.type){case 5120:return new Float32Array(e).map((function(e){return(e+128)/255*2-1}));case 5122:return new Float32Array(e).map((function(e){return(e+32768)/65535*2-1}));case 5121:return new Float32Array(e).map((function(e){return e/255}));case 5123:return new Float32Array(e).map((function(e){return e/65535}));default:return e}}},{key:"_normalizeValue",value:function(e,t,r){var n=this.settings,i=n.defaultValue,a=n.size;if(Number.isFinite(e))return t[r]=e,t;if(!e){for(var o=a;--o>=0;)t[r+o]=i[o];return t}switch(a){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:for(var s=a;--s>=0;)t[r+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}},{key:"_areValuesEqual",value:function(e,t){if(!e||!t)return!1;for(var r=this.size,n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}]),e}();return dataColumn.default=p,dataColumn}var iterableUtils={},hasRequiredIterableUtils;function requireIterableUtils(){if(hasRequiredIterableUtils)return iterableUtils;hasRequiredIterableUtils=1,Object.defineProperty(iterableUtils,"__esModule",{value:!0}),iterableUtils.createIterable=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,a=e,o={index:-1,data:r,target:[]};return r?"function"==typeof r[Symbol.iterator]?a=r:r.length>0&&(t.length=r.length,a=t):a=e,(n>0||Number.isFinite(i))&&(a=(Array.isArray(a)?a:Array.from(a)).slice(n,i),o.index=n-1),{iterable:a,objectInfo:o}},iterableUtils.isAsyncIterable=function(e){return e&&e[Symbol.asyncIterator]},iterableUtils.getAccessorFromBuffer=function(e,t){var r=t.size,n=t.stride,i=t.offset,a=t.startIndices,o=t.nested,s=e.BYTES_PER_ELEMENT,l=n?n/s:r,u=i?i/s:0,c=Math.floor((e.length-u)/l);return function(t,n){var i=n.index,s=n.target;if(!a){for(var d=i*l+u,h=0;h<r;h++)s[h]=e[d+h];return s}var f,p=a[i],m=a[i+1]||c;if(o){f=new Array(m-p);for(var g=p;g<m;g++){var _=g*l+u;s=new Array(r);for(var y=0;y<r;y++)s[y]=e[_+y];f[g-p]=s}}else if(l===r)f=e.subarray(p*r+u,m*r+u);else{f=new e.constructor((m-p)*r);for(var v=0,b=p;b<m;b++)for(var x=b*l+u,T=0;T<r;T++)f[v++]=e[x+T]}return f}};var e=[],t=[];return iterableUtils}var range={},hasRequiredRange;function requireRange(){if(hasRequiredRange)return range;hasRequiredRange=1,Object.defineProperty(range,"__esModule",{value:!0}),range.add=function(t,r){if(t===e)return t;if(r[0]<0&&(r[0]=0),r[0]>=r[1])return t;for(var n=[],i=t.length,a=0,o=0;o<i;o++){var s=t[o];s[1]<r[0]?(n.push(s),a=o+1):s[0]>r[1]?n.push(s):r=[Math.min(s[0],r[0]),Math.max(s[1],r[1])]}return n.splice(a,0,r),n},range.FULL=range.EMPTY=void 0,range.EMPTY=[];var e=[[0,1/0]];return range.FULL=e,range}var attributeTransitionUtils={},arrayUtils={},hasRequiredArrayUtils,hasRequiredAttributeTransitionUtils,hasRequiredAttribute;function requireArrayUtils(){if(hasRequiredArrayUtils)return arrayUtils;function e(e){var t=e.source,r=e.target,n=e.start,i=void 0===n?0:n,a=e.size,o=e.getData,s=t.length,l=(e.end||r.length)-i;if(s>l)r.set(t.subarray(0,l),i);else if(r.set(t,i),o)for(var u=s;u<l;)for(var c=o(u,t),d=0;d<a;d++)r[i+u]=c[d]||0,u++}return hasRequiredArrayUtils=1,Object.defineProperty(arrayUtils,"__esModule",{value:!0}),arrayUtils.padArray=function(t){var r=t.source,n=t.target,i=t.size,a=t.getData,o=t.sourceStartIndices,s=t.targetStartIndices;if(!Array.isArray(s))return e({source:r,target:n,size:i,getData:a}),n;for(var l=0,u=0,c=a&&function(e,t){return a(e+u,t)},d=Math.min(o.length,s.length),h=1;h<d;h++){var f=o[h]*i,p=s[h]*i;e({source:r.subarray(l,f),target:n,start:u,end:p,size:i,getData:c}),l=f,u=p}return u<n.length&&e({source:[],target:n,start:u,size:i,getData:c}),n},arrayUtils}function requireAttributeTransitionUtils(){if(hasRequiredAttributeTransitionUtils)return attributeTransitionUtils;hasRequiredAttributeTransitionUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(attributeTransitionUtils,"__esModule",{value:!0}),attributeTransitionUtils.normalizeTransitionSettings=function(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});var r=e.type||"interpolation";return i(i(i(i({},a[r]),t),e),{},{type:r})},attributeTransitionUtils.getSourceBufferAttribute=function(e,t){var r=t.getBuffer();return r?[r,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value},attributeTransitionUtils.getAttributeTypeFromSize=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}},attributeTransitionUtils.cycleBuffers=function(e){e.push(e.shift())},attributeTransitionUtils.getAttributeBufferLength=o,attributeTransitionUtils.padBuffer=function(e){var t=e.buffer,n=e.attribute,i=e.fromLength,a=e.fromStartIndices,s=e.getData,l=void 0===s?function(e){return e}:s,u=n.doublePrecision&&n.value instanceof Float64Array?2:1,c=n.size*u,d=n.byteOffset,h=n.startIndices,f=a&&h,p=o(n,e.numInstances),m=n.isConstant;if(f||!(i>=p)){var g=m?n.value:n.getBuffer().getData({srcByteOffset:d});if(n.settings.normalized&&!m){var _=l;l=function(e,t){return n.normalizeConstant(_(e,t))}}var y=m?function(e,t){return l(g,t)}:function(e,t){return l(g.subarray(e,e+c),t)},v=t.getData({length:i}),b=new Float32Array(p);(0,r.padArray)({source:v,target:b,sourceStartIndices:a,targetStartIndices:h,size:c,getData:y}),t.byteLength<b.byteLength+d&&t.reallocate(b.byteLength+d),t.subData({data:b,offset:d})}};var t=e(requireDefineProperty()),r=requireArrayUtils();function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var a={interpolation:{duration:0,easing:function(e){return e}},spring:{stiffness:.05,damping:.5}};function o(e,t){var r=e.value,n=e.doublePrecision&&r instanceof Float64Array?2:1;return(e.settings.noAlloc?r.length:t*e.size)*n}return attributeTransitionUtils}function requireAttribute(){if(hasRequiredAttribute)return attribute;hasRequiredAttribute=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(attribute,"__esModule",{value:!0}),attribute.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireGet()),s=e(requireInherits()),l=e(requirePossibleConstructorReturn()),u=e(requireGetPrototypeOf()),c=e(requireDefineProperty()),d=e(requireDataColumn()),h=e(requireAssert()),f=requireIterableUtils(),p=requireFlatten(),m=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=_(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireRange()),g=requireAttributeTransitionUtils();function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b=function(e){(0,s.default)(v,e);var t,d,_=(t=v,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,u.default)(t);if(d){var n=(0,u.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,l.default)(this,e)});function v(e,t){var r;return(0,n.default)(this,v),r=_.call(this,e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:m.FULL}),(0,c.default)((0,a.default)(r),"constant",!1),r.settings.update=t.update||(t.accessor?r._autoUpdater:void 0),Object.seal(r.settings),Object.seal(r.state),r._validateAttributeUpdaters(),r}return(0,i.default)(v,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(e){this.state.startIndices=e}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,t=this.state.needsRedraw;return this.state.needsRedraw=t&&!(void 0!==e&&e),t}},{key:"getUpdateTriggers",value:function(){var e=this.settings.accessor;return[this.id].concat("function"!=typeof e&&e||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(e){if(!e||!this.supportsTransition())return null;var t=this.settings.accessor,r=this.settings.transition,n=Array.isArray(t)?e[t.find((function(t){return e[t]}))]:e[t];return(0,g.normalizeTransitionSettings)(n,r)}},{key:"setNeedsUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){var r=t.startRow,n=t.endRow;this.state.updateRanges=m.add(this.state.updateRanges,[void 0===r?0:r,void 0===n?1/0:n])}else this.state.updateRanges=m.FULL}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=m.EMPTY}},{key:"setNeedsRedraw",value:function(){this.state.needsRedraw=this.state.needsRedraw||(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id)}},{key:"allocate",value:function(e){var t=this.state,r=this.settings;return!r.noAlloc&&!!r.update&&((0,o.default)((0,u.default)(v.prototype),"allocate",this).call(this,e,t.updateRanges!==m.FULL),!0)}},{key:"updateBuffer",value:function(e){var t=e.numInstances,n=e.data,i=e.props,a=e.context;if(!this.needsUpdate())return!1;var s=this.state.updateRanges,l=this.settings,c=l.update,d=l.noAlloc,h=!0;if(c){var f,p=y(s);try{for(p.s();!(f=p.n()).done;){var m=(0,r.default)(f.value,2);c.call(a,this,{data:n,startRow:m[0],endRow:m[1],props:i,numInstances:t})}}catch(e){p.e(e)}finally{p.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var g,_=y(s);try{for(_.s();!(g=_.n()).done;){var b=(0,r.default)(g.value,2),x=b[0],T=b[1],w=Number.isFinite(x)?this.getVertexOffset(x):0,E=Number.isFinite(T)?this.getVertexOffset(T):d||!Number.isFinite(t)?this.value.length:t*this.size;(0,o.default)((0,u.default)(v.prototype),"updateSubBuffer",this).call(this,{startOffset:w,endOffset:E})}}catch(e){_.e(e)}finally{_.f()}}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}},{key:"setConstantValue",value:function(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}},{key:"setExternalBuffer",value:function(e){var t=this.state;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.state,n=this.settings;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});var i=e;(0,h.default)(ArrayBuffer.isView(i.value),"invalid ".concat(n.accessor));var a=Boolean(i.size)&&i.size!==this.size;return r.binaryAccessor=(0,f.getAccessorFromBuffer)(i.value,{size:i.size||this.size,stride:i.stride,offset:i.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}},{key:"getVertexOffset",value:function(e){var t=this.startIndices;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}},{key:"getShaderAttributes",value:function(){var e=this.settings.shaderAttributes||(0,c.default)({},this.id,null),t={};for(var r in e)Object.assign(t,(0,o.default)((0,u.default)(v.prototype),"getShaderAttributes",this).call(this,r,e[r]));return t}},{key:"_autoUpdater",value:function(e,t){var r=t.data,n=t.startRow,i=t.endRow,a=t.numInstances;if(!e.constant){var o=e.settings,s=e.value,l=e.size,u=e.startIndices,c=o.accessor,d=o.transform,m=e.state.binaryAccessor||("function"==typeof c?c:t.props[c]);(0,h.default)("function"==typeof m,'accessor "'.concat(c,'" is not a function'));var g,_=e.getVertexOffset(n),v=(0,f.createIterable)(r,n,i),b=v.objectInfo,x=y(v.iterable);try{for(x.s();!(g=x.n()).done;){var T=g.value;b.index++;var w=m(T,b);if(d&&(w=d.call(this,w)),u){var E=(b.index<u.length-1?u[b.index+1]:a)-u[b.index];if(w&&Array.isArray(w[0])){var A,S=_,P=y(w);try{for(P.s();!(A=P.n()).done;)e._normalizeValue(A.value,s,S),S+=l}catch(e){P.e(e)}finally{P.f()}}else w&&w.length>l?s.set(w,_):(e._normalizeValue(w,b.target,0),(0,p.fillArray)({target:s,source:b.target,start:_,count:E}));_+=E*l}else e._normalizeValue(w,s,_),_+=l}}catch(e){x.e(e)}finally{x.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var e=this.settings;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var e=this.value,t=Math.min(4,this.size);if(e&&e.length>=t){var r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),v}(d.default);return attribute.default=b,attribute}var attributeTransitionManager={},gpuInterpolationTransition={},hasRequiredGpuInterpolationTransition;function requireGpuInterpolationTransition(){if(hasRequiredGpuInterpolationTransition)return gpuInterpolationTransition;hasRequiredGpuInterpolationTransition=1;var e=interopRequireDefaultExports;Object.defineProperty(gpuInterpolationTransition,"__esModule",{value:!0}),gpuInterpolationTransition.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=e(requireAttribute()),o=requireAttributeTransitionUtils(),s=e(requireTransition());function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=function(){function e(r){var l=r.gl,u=r.attribute,c=r.timeline;(0,t.default)(this,e),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"type","interpolation"),(0,n.default)(this,"attributeInTransition",void 0),(0,n.default)(this,"settings",void 0),(0,n.default)(this,"attribute",void 0),(0,n.default)(this,"transition",void 0),(0,n.default)(this,"currentStartIndices",void 0),(0,n.default)(this,"currentLength",void 0),(0,n.default)(this,"transform",void 0),(0,n.default)(this,"buffers",void 0),this.gl=l,this.transition=new s.default(c),this.attribute=u,this.attributeInTransition=new a.default(l,u.settings),this.currentStartIndices=u.startIndices,this.currentLength=0,this.transform=function(e,t){var r=(0,o.getAttributeTypeFromSize)(t.size);return new i.Transform(e,{vs:f,defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"]})}(l,u);var d={byteLength:0,usage:35050};this.buffers=[new i.Buffer(l,d),new i.Buffer(l,d)]}return(0,r.default)(e,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,t){if(e.duration<=0)this.transition.cancel();else{this.settings=e;var r=this.gl,n=this.buffers,i=this.attribute;(0,o.cycleBuffers)(n);var a,s={numInstances:t,attribute:i,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},l=c(n);try{for(l.s();!(a=l.n()).done;)(0,o.padBuffer)(u({buffer:a.value},s))}catch(e){l.e(e)}finally{l.f()}this.currentStartIndices=i.startIndices,this.currentLength=(0,o.getAttributeBufferLength)(i,t),this.attributeInTransition.setData({buffer:n[1],value:i.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/i.size),sourceBuffers:{aFrom:n[0],aTo:(0,o.getSourceBufferAttribute)(r,i)},feedbackBuffers:{vCurrent:n[1]}})}}},{key:"update",value:function(){var e=this.transition.update();if(e){var t=this.settings,r=t.easing,n=this.transition.time/t.duration;r&&(n=r(n)),this.transform.run({uniforms:{time:n}})}return e}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e,t=c(this.buffers);try{for(t.s();!(e=t.n()).done;)e.value.delete()}catch(e){t.e(e)}finally{t.f()}this.buffers.length=0}}]),e}();gpuInterpolationTransition.default=h;var f="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";return gpuInterpolationTransition}var gpuSpringTransition={},hasRequiredGpuSpringTransition,hasRequiredAttributeTransitionManager,hasRequiredAttributeManager;function requireGpuSpringTransition(){if(hasRequiredGpuSpringTransition)return gpuSpringTransition;hasRequiredGpuSpringTransition=1;var e=interopRequireDefaultExports;Object.defineProperty(gpuSpringTransition,"__esModule",{value:!0}),gpuSpringTransition.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=requireAttributeTransitionUtils(),o=e(requireAttribute()),s=e(requireTransition());function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(){function e(r){var l=r.gl,u=r.attribute,c=r.timeline;(0,t.default)(this,e),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"type","spring"),(0,n.default)(this,"attributeInTransition",void 0),(0,n.default)(this,"settings",void 0),(0,n.default)(this,"attribute",void 0),(0,n.default)(this,"transition",void 0),(0,n.default)(this,"currentStartIndices",void 0),(0,n.default)(this,"currentLength",void 0),(0,n.default)(this,"texture",void 0),(0,n.default)(this,"framebuffer",void 0),(0,n.default)(this,"transform",void 0),(0,n.default)(this,"buffers",void 0),this.gl=l,this.type="spring",this.transition=new s.default(c),this.attribute=u,this.attributeInTransition=new o.default(l,d(d({},u.settings),{},{normalized:!1})),this.currentStartIndices=u.startIndices,this.currentLength=0,this.texture=function(e){return new i.Texture2D(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(l),this.framebuffer=function(e,t){return new i.Framebuffer(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:(0,n.default)({},36064,t)})}(l,this.texture),this.transform=function(e,t,r){var n=(0,a.getAttributeTypeFromSize)(t.size);return new i.Transform(e,{framebuffer:r,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}(l,u,this.framebuffer);var h={byteLength:0,usage:35050};this.buffers=[new i.Buffer(l,h),new i.Buffer(l,h),new i.Buffer(l,h)]}return(0,r.default)(e,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,t){var r,n=this.gl,i=this.buffers,o=this.attribute,s={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=l(i);try{for(u.s();!(r=u.n()).done;)(0,a.padBuffer)(d({buffer:r.value},s))}catch(e){u.e(e)}finally{u.f()}this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=(0,a.getAttributeBufferLength)(o,t),this.attributeInTransition.setData({buffer:i[1],value:o.value}),this.transition.start(d(d({},e),{},{duration:1/0})),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:(0,a.getSourceBufferAttribute)(n,o)}})}},{key:"update",value:function(){var e=this.buffers,t=this.transform,r=this.framebuffer,n=this.transition;if(!n.update())return!1;var o=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),(0,a.cycleBuffers)(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),(0,i.readPixelsToArray)(r)[0]>0||n.end(),!0}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e,t=l(this.buffers);try{for(t.s();!(e=t.n()).done;)e.value.delete()}catch(e){t.e(e)}finally{t.f()}this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}]),e}();return gpuSpringTransition.default=h,gpuSpringTransition}function requireAttributeTransitionManager(){if(hasRequiredAttributeTransitionManager)return attributeTransitionManager;hasRequiredAttributeTransitionManager=1;var e=interopRequireDefaultExports;Object.defineProperty(attributeTransitionManager,"__esModule",{value:!0}),attributeTransitionManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$d,a=e(requireGpuInterpolationTransition()),o=e(requireGpuSpringTransition()),s=e(requireLog()),l={interpolation:a.default,spring:o.default},u=function(){function e(r,a){var o=a.id,s=a.timeline;(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"isSupported",void 0),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"timeline",void 0),(0,n.default)(this,"transitions",void 0),(0,n.default)(this,"needsRedraw",void 0),(0,n.default)(this,"numInstances",void 0),this.id=o,this.gl=r,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=i.Transform.isSupported(r)}return(0,r.default)(e,[{key:"finalize",value:function(){for(var e in this.transitions)this._removeTransition(e)}},{key:"update",value:function(e){var t=e.attributes,r=e.transitions,n=e.numInstances;for(var i in this.numInstances=n||1,t){var a=t[i],o=a.getTransitionSetting(r);o&&this._updateAttribute(i,a,o)}for(var s in this.transitions){var l=t[s];l&&l.getTransitionSetting(r)||this._removeTransition(s)}}},{key:"hasAttribute",value:function(e){var t=this.transitions[e];return t&&t.inProgress}},{key:"getAttributes",value:function(){var e={};for(var t in this.transitions){var r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}},{key:"run",value:function(){if(!this.isSupported||0===this.numInstances)return!1;for(var e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);var t=this.needsRedraw;return this.needsRedraw=!1,t}},{key:"_removeTransition",value:function(e){this.transitions[e].cancel(),delete this.transitions[e]}},{key:"_updateAttribute",value:function(e,t,r){var n=this.transitions[e],i=!n||n.type!==r.type;if(i){if(!this.isSupported)return void s.default.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();n&&this._removeTransition(e);var a=l[r.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):(s.default.error("unsupported transition type '".concat(r.type,"'"))(),i=!1)}(i||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}]),e}();return attributeTransitionManager.default=u,attributeTransitionManager}function requireAttributeManager(){if(hasRequiredAttributeManager)return attributeManager;hasRequiredAttributeManager=1;var e=interopRequireDefaultExports;Object.defineProperty(attributeManager,"__esModule",{value:!0}),attributeManager.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(requireAttribute()),a=e(requireLog()),o=e(requireMemoize()),s=requireMathUtils(),l=e(requireDebug()),u=e(requireAttributeTransitionManager());function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f="attributeManager.invalidate",p=function(){function e(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.id,l=void 0===a?"attribute-manager":a,c=i.stats,d=i.timeline;(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"gl",void 0),(0,n.default)(this,"attributes",void 0),(0,n.default)(this,"updateTriggers",void 0),(0,n.default)(this,"needsRedraw",void 0),(0,n.default)(this,"userData",void 0),(0,n.default)(this,"stats",void 0),(0,n.default)(this,"attributeTransitionManager",void 0),(0,n.default)(this,"mergeBoundsMemoized",(0,o.default)(s.mergeBounds)),this.id=l,this.gl=r,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=c,this.attributeTransitionManager=new u.default(r,{id:"".concat(l,"-transitions"),timeline:d}),Object.seal(this)}return(0,r.default)(e,[{key:"finalize",value:function(){for(var e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){this.needsRedraw=!0}},{key:"add",value:function(e){this._add(e)}},{key:"addInstanced",value:function(e){this._add(e,{instanced:1})}},{key:"remove",value:function(e){var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}catch(e){r.e(e)}finally{r.f()}}},{key:"invalidate",value:function(e,t){var r=this._invalidateTrigger(e,t);(0,l.default)(f,this,e,r)}},{key:"invalidateAll",value:function(e){for(var t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);(0,l.default)(f,this,"all")}},{key:"update",value:function(e){var t=e.data,r=e.numInstances,n=e.startIndices,i=void 0===n?null:n,o=e.transitions,s=e.props,u=void 0===s?{}:s,c=e.buffers,d=void 0===c?{}:c,h=e.context,f=void 0===h?{}:h,p=!1;for(var m in(0,l.default)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var g=this.attributes[m],_=g.settings.accessor;g.startIndices=i,g.numInstances=r,u[m]&&a.default.removed("props.".concat(m),"data.attributes.".concat(m))(),g.setExternalBuffer(d[m])||g.setBinaryValue("string"==typeof _?d[_]:void 0,t.startIndices)||"string"==typeof _&&!d[_]&&g.setConstantValue(u[_])||g.needsUpdate()&&(p=!0,this._updateAttribute({attribute:g,numInstances:r,data:t,props:u,context:f})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}p&&(0,l.default)("attributeManager.updateEnd",this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}},{key:"updateTransition",value:function(){var e=this.attributeTransitionManager.run();return this.needsRedraw=this.needsRedraw||e,e}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getBounds",value:function(e){var t=this,r=e.map((function(e){var r;return null===(r=t.attributes[e])||void 0===r?void 0:r.getBounds()}));return this.mergeBoundsMemoized(r)}},{key:"getChangedAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},t=this.attributes,r=this.attributeTransitionManager,n=d({},r.getAttributes());for(var i in t){var a=t[i];a.needsRedraw(e)&&!r.hasAttribute(i)&&(n[i]=a)}return n}},{key:"getShaderAttributes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e||(e=this.getAttributes());var r={};for(var n in e)t[n]||Object.assign(r,e[n].getShaderAttributes());return r}},{key:"_add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in e)this.attributes[r]=this._createAttribute(r,e[r],t);this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(e,t,r){var n=d(d({},t),{},{id:e,size:(t.isIndexed?1:t.size)||1,divisor:r.instanced?1:t.divisor||0});return new i.default(this.gl,n)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var e=this,t={},r=function(r){e.attributes[r].getUpdateTriggers().forEach((function(e){t[e]||(t[e]=[]),t[e].push(r)}))};for(var n in this.attributes)r(n);this.updateTriggers=t}},{key:"_invalidateTrigger",value:function(e,t){var r=this.attributes,n=this.updateTriggers[e];return n&&n.forEach((function(e){var n=r[e];n&&n.setNeedsUpdate(n.id,t)})),n}},{key:"_updateAttribute",value:function(e){var t=e.attribute,r=e.numInstances;(0,l.default)("attribute.updateStart",t),t.constant?t.setConstantValue(t.value):(t.allocate(r)&&(0,l.default)("attribute.allocate",t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,(0,l.default)("attribute.updateEnd",t,r)))}}]),e}();return attributeManager.default=p,attributeManager}var layer={},uniformTransitionManager={},cpuInterpolationTransition={},hasRequiredCpuInterpolationTransition;function requireCpuInterpolationTransition(){if(hasRequiredCpuInterpolationTransition)return cpuInterpolationTransition;hasRequiredCpuInterpolationTransition=1;var e=interopRequireDefaultExports;Object.defineProperty(cpuInterpolationTransition,"__esModule",{value:!0}),cpuInterpolationTransition.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=es5$q,s=function(e){(0,n.default)(c,e);var s,l,u=(s=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(s);if(l){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function c(){return(0,t.default)(this,c),u.apply(this,arguments)}return(0,r.default)(c,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var e=this.settings,t=e.fromValue,r=e.toValue,n=(0,e.easing)(this.time/e.duration);this._value=(0,o.lerp)(t,r,n)}}]),c}(e(requireTransition()).default);return cpuInterpolationTransition.default=s,cpuInterpolationTransition}var cpuSpringTransition={},hasRequiredCpuSpringTransition,hasRequiredUniformTransitionManager;function requireCpuSpringTransition(){if(hasRequiredCpuSpringTransition)return cpuSpringTransition;hasRequiredCpuSpringTransition=1;var e=interopRequireDefaultExports;Object.defineProperty(cpuSpringTransition,"__esModule",{value:!0}),cpuSpringTransition.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireTransition()),s=1e-5;function l(e,t,r,n,i){var a=t-e;return(r-t)*i+-a*n+a+t}function u(e,t){if(Array.isArray(e)){for(var r=0,n=0;n<e.length;n++){var i=e[n]-t[n];r+=i*i}return Math.sqrt(r)}return Math.abs(e-t)}var c=function(e){(0,n.default)(h,e);var o,c,d=(o=h,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(c){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function h(){return(0,t.default)(this,h),d.apply(this,arguments)}return(0,r.default)(h,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var e=this.settings,t=e.fromValue,r=e.toValue,n=this._prevValue,i=this._currValue,a=void 0===i?t:i,o=function(e,t,r,n,i){if(Array.isArray(r)){for(var a=[],o=0;o<r.length;o++)a[o]=l(e[o],t[o],r[o],n,i);return a}return l(e,t,r,n,i)}(void 0===n?t:n,a,r,e.damping,e.stiffness),c=u(o,r),d=u(o,a);c<s&&d<s&&(o=r,this.end()),this._prevValue=a,this._currValue=o}}]),h}(o.default);return cpuSpringTransition.default=c,cpuSpringTransition}function requireUniformTransitionManager(){if(hasRequiredUniformTransitionManager)return uniformTransitionManager;hasRequiredUniformTransitionManager=1;var e=interopRequireDefaultExports;Object.defineProperty(uniformTransitionManager,"__esModule",{value:!0}),uniformTransitionManager.default=void 0;var t=e(requireSlicedToArray()),r=e(requireDefineProperty()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=requireAttributeTransitionUtils(),o=e(requireCpuInterpolationTransition()),s=e(requireCpuSpringTransition()),l=e(requireLog());function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={interpolation:o.default,spring:s.default},p=function(){function e(t){(0,n.default)(this,e),this.transitions=new Map,this.timeline=t}return(0,i.default)(e,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(e,t,r,n){var i=this.transitions;if(i.has(e)){var o=i.get(e),s=o.value;t=void 0===s?o.settings.fromValue:s,this.remove(e)}if(n=(0,a.normalizeTransitionSettings)(n)){var u=f[n.type];if(u){var c=new u(this.timeline);c.start(h(h({},n),{},{fromValue:t,toValue:r})),i.set(e,c)}else l.default.error("unsupported transition type '".concat(n.type,"'"))()}}},{key:"remove",value:function(e){var t=this.transitions;t.has(e)&&(t.get(e).cancel(),t.delete(e))}},{key:"update",value:function(){var e,r={},n=u(this.transitions);try{for(n.s();!(e=n.n()).done;){var i=(0,t.default)(e.value,2),a=i[0],o=i[1];o.update(),r[a]=o.value,o.inProgress||this.remove(a)}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"clear",value:function(){var e,t=u(this.transitions.keys());try{for(t.s();!(e=t.n()).done;)this.remove(e.value)}catch(e){t.e(e)}finally{t.f()}}}]),e}();return uniformTransitionManager.default=p,uniformTransitionManager}var props={},hasRequiredProps;function requireProps(){if(hasRequiredProps)return props;hasRequiredProps=1;var e=interopRequireDefaultExports;Object.defineProperty(props,"__esModule",{value:!0}),props.validateProps=function(e){var t=e[r.PROP_TYPES_SYMBOL];for(var n in t){var i=t[n],a=i.validate;if(a&&!a(e[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(e[n]))}},props.diffProps=function(e,t){var a=i({newProps:e,oldProps:t,propTypes:e[r.PROP_TYPES_SYMBOL],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),l=function(e,t){if(null===t)return"oldProps is null, initial diff";var r=!1,n=e.dataComparator,i=e._dataDiff;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&i&&(r=i(e.data,t.data)||r),r}(e,t),u=!1;return l||(u=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&s(e,t,"all"))return{all:!0};var r={},n=!1;for(var i in e.updateTriggers)"all"!==i&&s(e,t,i)&&(r[i]=!0,n=!0);return!!n&&r}(e,t)),{dataChanged:l,propsChanged:a,updateTriggersChanged:u,extensionsChanged:o(e,t),transitionsChanged:n(e,t)}},props.compareProps=i;var t=e(_typeofExports),r=requireConstants$2();function n(e,t){if(!e.transitions)return!1;var n={},i=e[r.PROP_TYPES_SYMBOL],o=!1;for(var s in e.transitions){var l=i[s],u=l&&l.type;("number"===u||"color"===u||"array"===u)&&a(e[s],t[s],l)&&(n[s]=!0,o=!0)}return!!o&&n}function i(e){var r=e.newProps,n=e.oldProps,i=e.ignoreProps,o=void 0===i?{}:i,s=e.propTypes,l=void 0===s?{}:s,u=e.triggerName,c=void 0===u?"props":u;if(n===r)return!1;if("object"!==(0,t.default)(r)||null===r)return"".concat(c," changed shallowly");if("object"!==(0,t.default)(n)||null===n)return"".concat(c," changed shallowly");for(var d=0,h=Object.keys(r);d<h.length;d++){var f=h[d];if(!(f in o)){if(!(f in n))return"".concat(c,".").concat(f," added");var p=a(r[f],n[f],l[f]);if(p)return"".concat(c,".").concat(f," ").concat(p)}}for(var m=0,g=Object.keys(n);m<g.length;m++){var _=g[m];if(!(_ in o)){if(!(_ in r))return"".concat(c,".").concat(_," dropped");if(!Object.hasOwnProperty.call(r,_)){var y=a(r[_],n[_],l[_]);if(y)return"".concat(c,".").concat(_," ").concat(y)}}}return!1}function a(e,t,r){var n=r&&r.equal;return n&&!n(e,t,r)?"changed deeply":n||!(n=e&&t&&e.equals)||n.call(e,t)?n||t===e?null:"changed shallowly":"changed deeply"}function o(e,t){if(null===t)return!0;var r=t.extensions,n=e.extensions;if(n===r)return!1;if(!r||!n)return!0;if(n.length!==r.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function s(e,t,r){var n=e.updateTriggers[r],a=t.updateTriggers[r];return i({oldProps:a=null==a?{}:a,newProps:n=null==n?{}:n,triggerName:r})}return props}var count={},hasRequiredCount;function requireCount(){if(hasRequiredCount)return count;hasRequiredCount=1;var e=interopRequireDefaultExports;Object.defineProperty(count,"__esModule",{value:!0}),count.count=function(e){if(null===(i=e)||"object"!==(0,t.default)(i))throw new Error(r);var i;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"===(0,t.default)(e)&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error(n)};var t=e(_typeofExports),r="count(): argument not an object",n="count(): argument not a container";return count}var shader={},hasRequiredShader;function requireShader(){if(hasRequiredShader)return shader;hasRequiredShader=1;var e=interopRequireDefaultExports;Object.defineProperty(shader,"__esModule",{value:!0}),shader.mergeShaders=function(e,t){if(!t)return e;var r=n(n({},e),t);if("defines"in t&&(r.defines=n(n({},e.defines),t.defines)),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some((function(e){return"project64"===e.name})))){var i=r.modules.findIndex((function(e){return"project32"===e.name}));i>=0&&r.modules.splice(i,1)}if("inject"in t)if(e.inject){var a=n({},e.inject);for(var o in t.inject)a[o]=(a[o]||"")+t.inject[o];r.inject=a}else r.inject=t.inject;return r};var t=e(requireDefineProperty());function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}return shader}var component={},createProps={},propTypes={},texture={},hasRequiredTexture,hasRequiredPropTypes,hasRequiredCreateProps,hasRequiredComponent;function requireTexture(){if(hasRequiredTexture)return texture;hasRequiredTexture=1;var e=interopRequireDefaultExports;Object.defineProperty(texture,"__esModule",{value:!0}),texture.createTexture=function(e,t,i,l){if(i instanceof n.Texture2D)return i;i.constructor&&"Object"!==i.constructor.name&&(i={data:i});var u=null;i.compressed&&(u=(0,r.default)({},10241,i.data.length>1?9985:9729));var c=new n.Texture2D(t,a(a({},i),{},{parameters:a(a(a({},o),u),l)}));return s[c.id]=e,c},texture.destroyTexture=function(e,t){t&&t instanceof n.Texture2D&&s[t.id]===e&&(t.delete(),delete s[t.id])};var t,r=e(requireDefineProperty()),n=es5$d;function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var o=((0,r.default)(t={},10241,9987),(0,r.default)(t,10240,9729),(0,r.default)(t,10242,33071),(0,r.default)(t,10243,33071),t),s={};return texture}function requirePropTypes(){if(hasRequiredPropTypes)return propTypes;hasRequiredPropTypes=1;var e=interopRequireDefaultExports;Object.defineProperty(propTypes,"__esModule",{value:!0}),propTypes.parsePropTypes=function(e){for(var t={},n={},i={},a=0,o=Object.entries(e);a<o.length;a++){var s=(0,r.default)(o[a],2),l=s[0],c=s[1],d=null==c?void 0:c.deprecatedFor;if(d)i[l]=Array.isArray(d)?d:[d];else{var h=u(l,c);t[l]=h,n[l]=h.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}};var t=e(_typeofExports),r=e(requireSlicedToArray()),n=e(requireDefineProperty()),i=requireTexture(),a=requireDeepEqual();function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={boolean:{validate:function(e,t){return!0},equal:function(e,t,r){return Boolean(e)===Boolean(t)}},number:{validate:function(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate:function(e,t){return t.optional&&!e||d(e)&&(3===e.length||4===e.length)},equal:function(e,t,r){return(0,a.deepEqual)(e,t,1)}},accessor:{validate:function(e,t){var r=h(e);return"function"===r||r===h(t.value)},equal:function(e,t,r){return"function"==typeof t||(0,a.deepEqual)(e,t,1)}},array:{validate:function(e,t){return t.optional&&!e||d(e)},equal:function(e,t,r){var n=r.compare,i=Number.isInteger(n)?n:n?1:0;return n?(0,a.deepEqual)(e,t,i):e===t}},object:{equal:function(e,t,r){if(r.ignore)return!0;var n=r.compare,i=Number.isInteger(n)?n:n?1:0;return n?(0,a.deepEqual)(e,t,i):e===t}},function:{validate:function(e,t){return t.optional&&!e||"function"==typeof e},equal:function(e,t,r){return!r.compare&&!1!==r.ignore||e===t}},data:{transform:function(e,t,r){var n=r.props.dataTransform;return n&&e?n(e):e}},image:{transform:function(e,t,r){var n=r.context;return n&&n.gl?(0,i.createTexture)(r.id,n.gl,e,s(s({},t.parameters),r.props.textureParameters)):null},release:function(e,t,r){(0,i.destroyTexture)(r.id,e)}}};function u(e,t){switch(h(t)){case"object":return c(e,t);case"array":return c(e,{type:"array",value:t,compare:!1});case"boolean":return c(e,{type:"boolean",value:t});case"number":return c(e,{type:"number",value:t});case"function":return c(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function c(e,t){return"type"in t?s(s({name:e},l[t.type]),t):"value"in t?s({name:e,type:h(t.value)},t):{name:e,type:"object",value:t}}function d(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function h(e){return d(e)?"array":null===e?"null":(0,t.default)(e)}return propTypes}function requireCreateProps(){if(hasRequiredCreateProps)return createProps;hasRequiredCreateProps=1;var e=interopRequireDefaultExports;Object.defineProperty(createProps,"__esModule",{value:!0}),createProps.createProps=function(e,t){for(var r,n=t.length-1;n>=0;n--){var a=t[n];"extensions"in a&&(r=a.extensions)}var o=l(e.constructor,r),s=Object.create(o);s[i.COMPONENT_SYMBOL]=e,s[i.ASYNC_ORIGINAL_SYMBOL]={},s[i.ASYNC_RESOLVED_SYMBOL]={};for(var u=0;u<t.length;++u){var c=t[u];for(var d in c)s[d]=c[d]}return Object.freeze(s),s};var t=e(requireLog()),r=requireIterableUtils(),n=requirePropTypes(),i=requireConstants$2();function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s="_mergedDefaultProps";function l(e,r){var o=s;if(r){var h,f=a(r);try{for(f.s();!(h=f.n()).done;){var p=h.value.constructor;p&&(o+=":".concat(p.extensionName||p.name))}}catch(e){f.e(e)}finally{f.f()}}return d(e,o)||(e[o]=function(e,r){if(!e.prototype)return null;var o,s=l(Object.getPrototypeOf(e)),h=d(e,"defaultProps")||{},f=(0,n.parsePropTypes)(h),p=Object.assign(Object.create(null),s,f.defaultProps),m=Object.assign(Object.create(null),null==s?void 0:s[i.PROP_TYPES_SYMBOL],f.propTypes),g=Object.assign(Object.create(null),null==s?void 0:s[i.DEPRECATED_PROPS_SYMBOL],f.deprecatedProps),_=a(r);try{for(_.s();!(o=_.n()).done;){var y=l(o.value.constructor);y&&(Object.assign(p,y),Object.assign(m,y[i.PROP_TYPES_SYMBOL]),Object.assign(g,y[i.DEPRECATED_PROPS_SYMBOL]))}}catch(e){_.e(e)}finally{_.f()}return function(e,r){var n=function(e){var r=e.componentName;return r||t.default.warn("".concat(e.name,".componentName not specified"))(),r||e.name}(r);Object.defineProperties(e,{id:{writable:!0,value:n}})}(p,e),function(e,t){var r={},n={};for(var a in t){var o=t[a],s=o.name;o.async&&(r[s]=o.value,n[s]=u(s))}e[i.ASYNC_DEFAULTS_SYMBOL]=r,e[i.ASYNC_ORIGINAL_SYMBOL]={},Object.defineProperties(e,n)}(p,m),function(e,r){var n=function(n){Object.defineProperty(e,n,{enumerable:!1,set:function(e){var i,o="".concat(this.id,": ").concat(n),s=a(r[n]);try{for(s.s();!(i=s.n()).done;){var l=i.value;c(this,l)||(this[l]=e)}}catch(e){s.e(e)}finally{s.f()}t.default.deprecated(o,r[n].join("/"))()}})};for(var i in r)n(i)}(p,g),p[i.PROP_TYPES_SYMBOL]=m,p[i.DEPRECATED_PROPS_SYMBOL]=g,0!==r.length||c(e,"_propTypes")||(e._propTypes=m),p}(e,r||[]))}function u(e){return{enumerable:!0,set:function(t){"string"==typeof t||t instanceof Promise||(0,r.isAsyncIterable)(t)?this[i.ASYNC_ORIGINAL_SYMBOL][e]=t:this[i.ASYNC_RESOLVED_SYMBOL][e]=t},get:function(){if(this[i.ASYNC_RESOLVED_SYMBOL]){if(e in this[i.ASYNC_RESOLVED_SYMBOL])return this[i.ASYNC_RESOLVED_SYMBOL][e]||this[i.ASYNC_DEFAULTS_SYMBOL][e];if(e in this[i.ASYNC_ORIGINAL_SYMBOL]){var t=this[i.COMPONENT_SYMBOL]&&this[i.COMPONENT_SYMBOL].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[i.ASYNC_DEFAULTS_SYMBOL][e]}}return this[i.ASYNC_DEFAULTS_SYMBOL][e]}}}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){return c(e,t)&&e[t]}return createProps}function requireComponent(){if(hasRequiredComponent)return component;hasRequiredComponent=1;var e=interopRequireDefaultExports;Object.defineProperty(component,"__esModule",{value:!0}),component.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireConstants$2(),a=requireCreateProps();function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=0,u=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"id",void 0),(0,n.default)(this,"props",void 0),(0,n.default)(this,"count",void 0);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.props=(0,a.createProps)(this,i),this.id=this.props.id,this.count=l++}return(0,r.default)(e,[{key:"clone",value:function(e){var t=this.props,r={};for(var n in t[i.ASYNC_DEFAULTS_SYMBOL])n in t[i.ASYNC_RESOLVED_SYMBOL]?r[n]=t[i.ASYNC_RESOLVED_SYMBOL][n]:n in t[i.ASYNC_ORIGINAL_SYMBOL]&&(r[n]=t[i.ASYNC_ORIGINAL_SYMBOL][n]);return new this.constructor(s(s(s({},t),r),e))}}]),e}();return component.default=u,(0,n.default)(u,"componentName","Component"),(0,n.default)(u,"defaultProps",{}),component}var layerState={},componentState={},asyncIterator={exports:{}},hasRequiredAsyncIterator,hasRequiredComponentState,hasRequiredLayerState,hasRequiredLayer;function requireAsyncIterator(){return hasRequiredAsyncIterator||(hasRequiredAsyncIterator=1,function(e){function t(e){function r(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return t=function(e){this.s=e,this.n=e.next},t.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):r(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):r(t.apply(this.s,arguments))}},new t(e)}e.exports=function(e){var r,n,i,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);a--;){if(n&&null!=(r=e[n]))return r.call(e);if(i&&null!=(r=e[i]))return new t(r.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")},e.exports.__esModule=!0,e.exports.default=e.exports}(asyncIterator)),asyncIterator.exports}function requireComponentState(){if(hasRequiredComponentState)return componentState;hasRequiredComponentState=1;var e=interopRequireDefaultExports;Object.defineProperty(componentState,"__esModule",{value:!0}),componentState.default=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireDefineProperty()),o=e(requireAsyncIterator()),s=requireIterableUtils(),l=requireConstants$2(),u=Object.freeze({}),c=function(){function e(t){(0,n.default)(this,e),(0,a.default)(this,"component",void 0),(0,a.default)(this,"onAsyncPropUpdated",void 0),(0,a.default)(this,"asyncProps",void 0),(0,a.default)(this,"oldProps",void 0),(0,a.default)(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}var c;return(0,i.default)(e,[{key:"finalize",value:function(){for(var e in this.asyncProps){var t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||u}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}},{key:"hasAsyncProp",value:function(e){return e in this.asyncProps}},{key:"getAsyncProp",value:function(e){var t=this.asyncProps[e];return t&&t.resolvedValue}},{key:"isAsyncPropLoading",value:function(e){if(e){var t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(var r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}},{key:"reloadAsyncProp",value:function(e,t){this._watchPromise(e,Promise.resolve(t))}},{key:"setAsyncProps",value:function(e){this.component=e[l.COMPONENT_SYMBOL]||this.component;var t=e[l.ASYNC_RESOLVED_SYMBOL]||{},r=e[l.ASYNC_ORIGINAL_SYMBOL]||e,n=e[l.ASYNC_DEFAULTS_SYMBOL]||{};for(var i in t){var a=t[i];this._createAsyncPropData(i,n[i]),this._updateAsyncProp(i,a),t[i]=this.getAsyncProp(i)}for(var o in r){var s=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,s)}}},{key:"_fetch",value:function(e,t){return null}},{key:"_onResolve",value:function(e,t){}},{key:"_onError",value:function(e,t){}},{key:"_updateAsyncProp",value:function(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):(0,s.isAsyncIterable)(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps)for(var e in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}},{key:"_didAsyncInputValueChange",value:function(e,t){var r=this.asyncProps[e];return t!==r.resolvedValue&&t!==r.lastValue&&(r.lastValue=t,!0)}},{key:"_setPropValue",value:function(e,t){this._freezeAsyncOldProps();var r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(e,t,r){var n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}},{key:"_watchPromise",value:function(e,t){var r=this,n=this.asyncProps[e];if(n){n.pendingLoadCount++;var i=n.pendingLoadCount;t.then((function(t){r.component&&(t=r._postProcessValue(n,t),r._setAsyncPropValue(e,t,i),r._onResolve(e,t))})).catch((function(t){r._onError(e,t)}))}}},{key:"_resolveAsyncIterable",value:(c=(0,r.default)(t.default.mark((function e(r,n){var i,a,s,l,u,c,d,h,f,p,m;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("data"===r){e.next=3;break}return this._setPropValue(r,n),e.abrupt("return");case 3:if(i=this.asyncProps[r]){e.next=6;break}return e.abrupt("return");case 6:i.pendingLoadCount++,a=i.pendingLoadCount,s=[],l=0,u=!1,c=!1,e.prev=12,h=(0,o.default)(n);case 14:return e.next=16,h.next();case 16:if(!(u=!(f=e.sent).done)){e.next=28;break}if(p=f.value,this.component){e.next=20;break}return e.abrupt("return");case 20:s=(m=this.component.props.dataTransform)?m(p,s):s.concat(p),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:l,endRow:s.length}]}),l=s.length,this._setAsyncPropValue(r,s,a);case 25:u=!1,e.next=14;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(12),c=!0,d=e.t0;case 34:if(e.prev=34,e.prev=35,!u||null==h.return){e.next=39;break}return e.next=39,h.return();case 39:if(e.prev=39,!c){e.next=42;break}throw d;case 42:return e.finish(39);case 43:return e.finish(34);case 44:this._onResolve(r,s);case 45:case"end":return e.stop()}}),e,this,[[12,30,34,44],[35,,39,43]])}))),function(e,t){return c.apply(this,arguments)})},{key:"_postProcessValue",value:function(e,t){var r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}},{key:"_createAsyncPropData",value:function(e,t){if(!this.asyncProps[e]){var r=this.component&&this.component.props[l.PROP_TYPES_SYMBOL];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}]),e}();return componentState.default=c,componentState}function requireLayerState(){if(hasRequiredLayerState)return layerState;hasRequiredLayerState=1;var e=interopRequireDefaultExports;Object.defineProperty(layerState,"__esModule",{value:!0}),layerState.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=function(e){(0,a.default)(h,e);var u,c,d=(u=h,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(c){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function h(e){var r,i=e.attributeManager,a=e.layer;return(0,t.default)(this,h),r=d.call(this,a),(0,l.default)((0,n.default)(r),"attributeManager",void 0),(0,l.default)((0,n.default)(r),"needsRedraw",void 0),(0,l.default)((0,n.default)(r),"needsUpdate",void 0),(0,l.default)((0,n.default)(r),"subLayers",void 0),(0,l.default)((0,n.default)(r),"usesPickingColorCache",void 0),(0,l.default)((0,n.default)(r),"hasPickingBuffer",void 0),(0,l.default)((0,n.default)(r),"changeFlags",void 0),(0,l.default)((0,n.default)(r),"viewport",void 0),(0,l.default)((0,n.default)(r),"uniformTransitions",void 0),(0,l.default)((0,n.default)(r),"propsInTransition",void 0),r.attributeManager=i,r.needsRedraw=!0,r.needsUpdate=!0,r.subLayers=null,r.usesPickingColorCache=!1,r}return(0,r.default)(h,[{key:"layer",get:function(){return this.component}},{key:"_fetch",value:function(e,t){var r=this.layer,n=null==r?void 0:r.props.fetch;return n?n(t,{propName:e,layer:r}):(0,i.default)((0,s.default)(h.prototype),"_fetch",this).call(this,e,t)}},{key:"_onResolve",value:function(e,t){var r=this.layer;if(r){var n=r.props.onDataLoad;"data"===e&&n&&n(t,{propName:e,layer:r})}}},{key:"_onError",value:function(e,t){var r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}]),h}(e(requireComponentState()).default);return layerState.default=u,layerState}function requireLayer(){if(hasRequiredLayer)return layer;hasRequiredLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(layer,"__esModule",{value:!0}),layer.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=constants$4,c=e(requireAttributeManager()),d=e(requireUniformTransitionManager()),h=requireProps(),f=requireConstants$2(),p=requireCount(),m=e(requireLog()),g=e(requireDebug()),_=es5$d,y=e(requireAssert()),v=e(requireMemoize()),b=requireShader(),x=requireProjectFunctions(),T=e(requireTypedArrayManager()),w=e(requireComponent()),E=e(requireLayerState()),A=es5$7,S=es5$n;function P(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=Math.pow(2,24)-1,L=Object.freeze([]),I=(0,v.default)((function(e){return e.oldViewport.equals(e.viewport)})),D=new Uint8ClampedArray(0),k={data:{type:"data",value:L,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:function(e){return e&&e.__diff},optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:function(e,t){var r,n=t.propName,i=t.layer,a=t.loaders,o=t.loadOptions,s=t.signal,l=i.context.resourceManager;o=o||i.getLoadOptions(),a=a||i.props.loaders,s&&(o=C(C({},o),{},{fetch:C(C({},null===(r=o)||void 0===r?void 0:r.fetch),{},{signal:s})}));var u=l.contains(e);return u||o||(l.add({resourceId:e,data:(0,S.load)(e,a),persistent:!1}),u=!0),u?l.subscribe({resourceId:e,onChange:function(e){var t;return null===(t=i.internalState)||void 0===t?void 0:t.reloadAsyncProp(n,e)},consumerId:i.id,requestId:n}):(0,S.load)(e,a,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:u.COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:function(e){return[0,100*-e.layerIndex]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},B=function(e){(0,a.default)(M,e);var v,w,S=(v=M,w=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(v);if(w){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function M(){var e;(0,r.default)(this,M);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=S.call.apply(S,[this].concat(n)),(0,l.default)((0,i.default)(e),"internalState",null),(0,l.default)((0,i.default)(e),"lifecycle",f.LIFECYCLE.NO_STATE),(0,l.default)((0,i.default)(e),"context",void 0),(0,l.default)((0,i.default)(e),"state",void 0),(0,l.default)((0,i.default)(e),"parent",null),e}return(0,n.default)(M,[{key:"root",get:function(){for(var e=this;e.parent;)e=e.parent;return e}},{key:"toString",value:function(){return"".concat(this.constructor.layerName||this.constructor.name,"({id: '").concat(this.props.id,"'})")}},{key:"project",value:function(e){(0,y.default)(this.internalState);var r=this.internalState.viewport||this.context.viewport,n=(0,x.getWorldPosition)(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),i=(0,A.worldToPixels)(n,r.pixelProjectionMatrix),a=(0,t.default)(i,3),o=a[0],s=a[1];return 2===e.length?[o,s]:[o,s,a[2]]}},{key:"unproject",value:function(e){return(0,y.default)(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}},{key:"projectPosition",value:function(e,t){return(0,y.default)(this.internalState),(0,x.projectPosition)(e,C({viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},t))}},{key:"isComposite",get:function(){return!1}},{key:"setState",value:function(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!0)}},{key:"setNeedsUpdate",value:function(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}},{key:"isLoaded",get:function(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}},{key:"setModuleParameters",value:function(e){var t,r=P(this.getModels());try{for(r.s();!(t=r.n()).done;)t.value.updateModuleSettings(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"use64bitPositions",value:function(){var e=this.props.coordinateSystem;return e===u.COORDINATE_SYSTEM.DEFAULT||e===u.COORDINATE_SYSTEM.LNGLAT||e===u.COORDINATE_SYSTEM.CARTESIAN}},{key:"onHover",value:function(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}},{key:"onClick",value:function(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}},{key:"decodePickingColor",value:function(e){(0,y.default)(e instanceof Uint8Array);var r=(0,t.default)(e,3);return r[0]+256*r[1]+65536*r[2]-1}},{key:"getNumInstances",value:function(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:(0,p.count)(this.props.data)}},{key:"getStartIndices",value:function(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"getBounds",value:function(){var e;return null===(e=this.getAttributeManager())||void 0===e?void 0:e.getBounds(["positions","instancePositions"])}},{key:"getShaders",value:function(e){var t,r=P(this.props.extensions);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=(0,b.mergeShaders)(e,n.getShaders.call(this,n))}}catch(e){r.e(e)}finally{r.f()}return e}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(e){var t=this,r=this.getAttributeManager(),n=e.changeFlags.dataChanged;if(n&&r)if(Array.isArray(n)){var i,a=P(n);try{for(a.s();!(i=a.n()).done;)r.invalidateAll(i.value)}catch(e){a.e(e)}finally{a.f()}}else r.invalidateAll();if(r){var o=e.props,s=this.internalState.hasPickingBuffer,l=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some((function(e){return e.getNeedsPickingBuffer.call(t,e)}));if(s!==l){this.internalState.hasPickingBuffer=l;var u=r.attributes,c=u.pickingColors||u.instancePickingColors;c&&(l&&c.constant&&(c.constant=!1,r.invalidate(c.id)),c.value||l||(c.constant=!0,c.value=[0,0,0]))}}}},{key:"finalizeState",value:function(e){var t,r=P(this.getModels());try{for(r.s();!(t=r.n()).done;)t.value.delete()}catch(e){r.e(e)}finally{r.f()}var n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}},{key:"draw",value:function(e){var t,r=P(this.getModels());try{for(r.s();!(t=r.n()).done;)t.value.draw(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getPickingInfo",value:function(e){var t=e.info,r=t.index;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}},{key:"raiseError",value:function(e,t){var r,n,i,a;t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),null!==(r=(n=this.props).onError)&&void 0!==r&&r.call(n,e)||null===(i=this.context)||void 0===i||null===(a=i.onError)||void 0===a||a.call(i,e,this)}},{key:"getNeedsRedraw",value:function(){return this._getNeedsRedraw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1})}},{key:"needsUpdate",value:function(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}},{key:"hasUniformTransition",value:function(){var e;return(null===(e=this.internalState)||void 0===e?void 0:e.uniformTransitions.active)||!1}},{key:"activateViewport",value:function(e){if(this.internalState){var t=this.internalState.viewport;this.internalState.viewport=e,t&&I({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}}},{key:"invalidateAttribute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}},{key:"updateAttributes",value:function(e){var t,r=P(this.getModels());try{for(r.s();!(t=r.n()).done;)this._setModelAttributes(t.value,e)}catch(e){r.e(e)}finally{r.f()}}},{key:"_updateAttributes",value:function(){var e=this.getAttributeManager();if(e){var t=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});var i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}}},{key:"_updateAttributeTransition",value:function(){var e=this.getAttributeManager();e&&e.updateTransition()}},{key:"_updateUniformTransition",value:function(){var e=this.internalState.uniformTransitions;if(e.active){var t=e.update(),r=Object.create(this.props);for(var n in t)Object.defineProperty(r,n,{value:t[n]});return r}return this.props}},{key:"calculateInstancePickingColors",value:function(e,t){var r=t.numInstances;if(!e.constant){var n=Math.floor(D.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>O&&m.default.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),D=T.default.allocate(D,r,{size:3,copy:!0,maxCount:Math.max(r,O)});for(var i=Math.floor(D.length/3),a=[],o=n;o<i;o++)this.encodePickingColor(o,a),D[3*o+0]=a[0],D[3*o+1]=a[1],D[3*o+2]=a[2]}e.value=D.subarray(0,3*r)}}},{key:"_setModelAttributes",value:function(e,t){var r=this.getAttributeManager().getShaderAttributes(t,e.userData.excludeAttributes||{});e.setAttributes(r)}},{key:"disablePickingIndex",value:function(e){var t=this.props.data;if("attributes"in t){var r=this.getAttributeManager().attributes,n=r.pickingColors||r.instancePickingColors,i=n&&t.attributes&&t.attributes[n.id];if(i&&i.value)for(var a=i.value,o=this.encodePickingColor(e),s=0;s<t.length;s++){var l=n.getVertexOffset(s);a[l]===o[0]&&a[l+1]===o[1]&&a[l+2]===o[2]&&this._disablePickingIndex(s)}else this._disablePickingIndex(e)}else this._disablePickingIndex(e)}},{key:"_disablePickingIndex",value:function(e){var t=this.getAttributeManager().attributes,r=t.pickingColors||t.instancePickingColors;if(r){var n=r.getVertexOffset(e),i=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(i-n),offset:n})}}},{key:"restorePickingColors",value:function(){var e=this.getAttributeManager().attributes,t=e.pickingColors||e.instancePickingColors;t&&(this.internalState.usesPickingColorCache&&t.value.buffer!==D.buffer&&(t.value=D.subarray(0,t.value.length)),t.updateSubBuffer({startOffset:0}))}},{key:"_initialize",value:function(){(0,y.default)(!this.internalState),(0,y.default)(Number.isFinite(this.props.coordinateSystem)),(0,g.default)("layer.initialize",this);var e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new E.default({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return m.default.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e}}),this.internalState.uniformTransitions=new d.default(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);var t,r=P(this.props.extensions);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.initializeState.call(this,this.context,n)}}catch(e){r.e(e)}finally{r.f()}this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}},{key:"_transferState",value:function(e){(0,g.default)("layer.matched",this,this===e);var t=e.state;this!==e&&(this.internalState=e.internalState,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}},{key:"_update",value:function(){var e=this.needsUpdate();if((0,g.default)("layer.update",this,e),e){var t=this.props,r=this.context,n=this.internalState,i=r.viewport,a=this._updateUniformTransition();n.propsInTransition=a,r.viewport=n.viewport||i,this.props=a;try{var o=this._getUpdateParams(),s=this.getModels();if(r.gl)this.updateState(o);else try{this.updateState(o)}catch(e){}var l,u=P(this.props.extensions);try{for(u.s();!(l=u.n()).done;){var c=l.value;c.updateState.call(this,o,c)}}catch(e){u.e(e)}finally{u.f()}var d=this.getModels()[0]!==s[0];this._postUpdate(o,d)}finally{r.viewport=i,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}}},{key:"_finalize",value:function(){(0,g.default)("layer.finalize",this),this.finalizeState(this.context);var e,t=P(this.props.extensions);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.finalizeState.call(this,this.context,r)}}catch(e){t.e(e)}finally{t.f()}}},{key:"_drawLayer",value:function(e){var t=this,r=e.moduleParameters,n=void 0===r?null:r,i=e.uniforms,a=void 0===i?{}:i,o=e.parameters,s=void 0===o?{}:o;this._updateAttributeTransition();var l=this.props,u=this.context;this.props=this.internalState.propsInTransition||l,a.opacity=Math.pow(this.props.opacity,1/2.2);try{n&&this.setModuleParameters(n);var c=this.props.getPolygonOffset,d=c&&c(a)||[0,0];(0,_.setParameters)(u.gl,{polygonOffset:d}),(0,_.withParameters)(u.gl,s,(function(){var e,r={moduleParameters:n,uniforms:a,parameters:s,context:u},i=P(t.props.extensions);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.draw.call(t,r,o)}}catch(e){i.e(e)}finally{i.f()}t.draw(r)}))}finally{this.props=l}}},{key:"getChangeFlags",value:function(){var e;return null===(e=this.internalState)||void 0===e?void 0:e.changeFlags}},{key:"setChangeFlags",value:function(e){if(this.internalState){var t=this.internalState.changeFlags;for(var r in e)if(e[r]){var n=!1;if("dataChanged"===r){var i=e[r],a=t[r];i&&Array.isArray(a)&&(t.dataChanged=Array.isArray(i)?a.concat(i):i,n=!0)}t[r]||(t[r]=e[r],n=!0),n&&(0,g.default)("layer.changeFlag",this,r,e)}var o=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=o,t.somethingChanged=o||t.viewportChanged||t.stateChanged}}},{key:"_clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"_diffProps",value:function(e,t){var r=(0,h.diffProps)(e,t);if(r.updateTriggersChanged)for(var n in r.updateTriggersChanged)r.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(r.transitionsChanged)for(var i in r.transitionsChanged){var a;this.internalState.uniformTransitions.add(i,t[i],e[i],null===(a=e.transitions)||void 0===a?void 0:a[i])}return this.setChangeFlags(r)}},{key:"validateProps",value:function(){(0,h.validateProps)(this.props)}},{key:"updateAutoHighlight",value:function(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}},{key:"_updateAutoHighlight",value:function(e){var t={pickingSelectedColor:e.picked?e.color:null},r=this.props.highlightColor;e.picked&&"function"==typeof r&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}},{key:"_getAttributeManager",value:function(){var e=this.context;return new c.default(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}},{key:"_postUpdate",value:function(e,t){var r=e.props,n=e.oldProps;this.setNeedsRedraw(),this._updateAttributes();var i=this.state.model;null==i||i.setInstanceCount(this.getNumInstances());var a=r.autoHighlight,o=r.highlightedObjectIndex,s=r.highlightColor;if(t||n.autoHighlight!==a||n.highlightedObjectIndex!==o||n.highlightColor!==s){var l={};a||(l.pickingSelectedColor=null),Array.isArray(s)&&(l.pickingHighlightColor=s),(t||o!==n.highlightedObjectIndex)&&(l.pickingSelectedColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setModuleParameters(l)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(e){if(!this.internalState)return!1;var t=!1;t=t||this.internalState.needsRedraw&&this.id;var r=this.getAttributeManager(),n=!!r&&r.getNeedsRedraw(e);if(t=t||n){var i,a=P(this.props.extensions);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.onNeedsRedraw.call(this,o)}}catch(e){a.e(e)}finally{a.f()}}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}},{key:"_onAsyncPropUpdated",value:function(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}}]),M}(w.default);return layer.default=B,(0,l.default)(B,"defaultProps",k),(0,l.default)(B,"layerName","Layer"),layer}var compositeLayer={},hasRequiredCompositeLayer;function requireCompositeLayer(){if(hasRequiredCompositeLayer)return compositeLayer;hasRequiredCompositeLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(compositeLayer,"__esModule",{value:!0}),compositeLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=e(requireLayer()),u=e(requireDebug()),c=requireFlatten(),d=requireConstants$2();function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(e){(0,i.default)(p,e);var s,l,f=(s=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(s);if(l){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function p(){return(0,t.default)(this,p),f.apply(this,arguments)}return(0,r.default)(p,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return(0,n.default)((0,o.default)(p.prototype),"isLoaded",this)&&this.getSubLayers().every((function(e){return e.isLoaded}))}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(e){}},{key:"setState",value:function(e){(0,n.default)((0,o.default)(p.prototype),"setState",this).call(this,e),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(e){var t=e.info,r=t.object;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id?(t.object=r.__source.object,t.index=r.__source.index,t):t}},{key:"filterSubLayer",value:function(e){return!0}},{key:"shouldRenderSubLayer",value:function(e,t){return t&&t.length}},{key:"getSubLayerClass",value:function(e,t){var r=this.props._subLayerProps;return r&&r[e]&&r[e].type||t}},{key:"getSubLayerRow",value:function(e,t,r){return e.__source={parent:this,object:t,index:r},e}},{key:"getSubLayerAccessor",value:function(e){if("function"==typeof e){var t={index:-1,data:this.props.data,target:[]};return function(r,n){return r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,n)}}return e}},{key:"getSubLayerProps",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.props,n=r.extensions,i=r._subLayerProps,a={id:"",updateTriggers:{},opacity:r.opacity,pickable:r.pickable,visible:r.visible,parameters:r.parameters,getPolygonOffset:r.getPolygonOffset,highlightedObjectIndex:r.highlightedObjectIndex,autoHighlight:r.autoHighlight,highlightColor:r.highlightColor,coordinateSystem:r.coordinateSystem,coordinateOrigin:r.coordinateOrigin,wrapLongitude:r.wrapLongitude,positionFormat:r.positionFormat,modelMatrix:r.modelMatrix,extensions:n,fetch:r.fetch,operation:r.operation},o=i&&t.id&&i[t.id],s=o&&o.updateTriggers,l=t.id||"sublayer";if(o){var u=this.props[d.PROP_TYPES_SYMBOL],c=t.type?t.type._propTypes:{};for(var f in o){var p=c[f]||u[f];p&&"accessor"===p.type&&(o[f]=this.getSubLayerAccessor(o[f]))}}Object.assign(a,t,o),a.id="".concat(this.props.id,"-").concat(l),a.updateTriggers=m(m({all:null===(e=this.props.updateTriggers)||void 0===e?void 0:e.all},t.updateTriggers),s);var g,_=h(n);try{for(_.s();!(g=_.n()).done;){var y=g.value,v=y.getSubLayerProps.call(this,y);v&&Object.assign(a,v,{updateTriggers:Object.assign(a.updateTriggers,v.updateTriggers)})}}catch(e){_.e(e)}finally{_.f()}return a}},{key:"_updateAutoHighlight",value:function(e){var t,r=h(this.getSubLayers());try{for(r.s();!(t=r.n()).done;)t.value.updateAutoHighlight(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_postUpdate",value:function(e,t){var r=this.internalState.subLayers,n=!r||this.needsUpdate();if(n){var i=this.renderLayers();r=(0,c.flatten)(i,Boolean),this.internalState.subLayers=r}(0,u.default)("compositeLayer.renderLayers",this,n,r);var a,o=h(r);try{for(o.s();!(a=o.n()).done;)a.value.parent=this}catch(e){o.e(e)}finally{o.f()}}}]),p}(l.default);return compositeLayer.default=g,(0,s.default)(g,"layerName","CompositeLayer"),compositeLayer}var globeViewport={},hasRequiredGlobeViewport;function requireGlobeViewport(){if(hasRequiredGlobeViewport)return globeViewport;hasRequiredGlobeViewport=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(globeViewport,"__esModule",{value:!0}),globeViewport.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=e(requireDefineProperty()),c=es5$q,d=e(requireViewport()),h=constants$4,f=g(requireVec3()),p=g(requireVec4());function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function g(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=m(r);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=Math.PI/180,b=180/Math.PI,x=6370972,T=256,w=function(e){(0,o.default)(m,e);var t,d,p=(t=m,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);if(d){var n=(0,l.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,s.default)(this,e)});function m(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,m);var r=t.latitude,i=void 0===r?0:r,o=t.longitude,s=void 0===o?0:o,l=t.zoom,d=void 0===l?0:l,h=t.nearZMultiplier,f=void 0===h?.1:h,g=t.farZMultiplier,_=void 0===g?2:g,b=t.resolution,x=void 0===b?10:b,w=t.height,E=t.altitude,A=void 0===E?1.5:E;w=w||1,A=Math.max(.75,A);var S=(new c.Matrix4).lookAt({eye:[0,-A,0],up:[0,0,1]}),P=Math.pow(2,d);S.rotateX(i*v),S.rotateZ(-s*v),S.scale(P/w);var M,R,C=Math.atan(.5/A),O=512*P/w;return e=p.call(this,y(y({},t),{},{height:w,viewMatrix:S,longitude:s,latitude:i,zoom:d,distanceScales:(M=4018225162502676e-20,R=Math.PI/180*T,{unitsPerMeter:[M,M,M],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[R,R,M],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/R,1/R,24886.609375]}),fovyRadians:2*C,focalDistance:A,near:f,far:Math.min(2,1/O+1)*A*_})),(0,u.default)((0,a.default)(e),"longitude",void 0),(0,u.default)((0,a.default)(e),"latitude",void 0),(0,u.default)((0,a.default)(e),"resolution",void 0),e.latitude=i,e.longitude=s,e.resolution=x,e}return(0,i.default)(m,[{key:"projectionMode",get:function(){return h.PROJECTION_MODE.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var e={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},t=this.unproject([0,this.height/2],e),r=this.unproject([this.width/2,0],e),n=this.unproject([this.width,this.height/2],e),i=this.unproject([this.width/2,this.height],e);return n[0]<this.longitude&&(n[0]+=360),t[0]>this.longitude&&(t[0]-=360),[Math.min(t[0],n[0],r[0],i[0]),Math.min(t[1],n[1],r[1],i[1]),Math.max(t[0],n[0],r[0],i[0]),Math.max(t[1],n[1],r[1],i[1])]}},{key:"unproject",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.topLeft,a=void 0===i||i,o=n.targetZ,s=(0,r.default)(e,3),l=s[0],u=s[1],c=s[2],d=a?u:this.height-u,h=this.pixelUnprojectionMatrix;if(Number.isFinite(c))t=E(h,[l,d,c,1]);else{var p=E(h,[l,d,-1,1]),m=E(h,[l,d,1,1]),g=((o||0)/x+1)*T,_=f.sqrLen(f.sub([],p,m)),y=f.sqrLen(p),v=f.sqrLen(m),b=(4*y*v-Math.pow(_-y-v,2))/16*4/_,w=(Math.sqrt(y-b)-Math.sqrt(Math.max(0,g*g-b)))/Math.sqrt(_);t=f.lerp([],p,m,w)}var A=this.unprojectPosition(t),S=(0,r.default)(A,3),P=S[0],M=S[1],R=S[2];return Number.isFinite(c)?[P,M,R]:Number.isFinite(o)?[P,M,o]:[P,M]}},{key:"projectPosition",value:function(e){var t=(0,r.default)(e,3),n=t[2],i=void 0===n?0:n,a=t[0]*v,o=t[1]*v,s=Math.cos(o),l=(i/x+1)*T;return[Math.sin(a)*s*l,-Math.cos(a)*s*l,Math.sin(o)*l]}},{key:"unprojectPosition",value:function(e){var t=(0,r.default)(e,3),n=t[0],i=t[1],a=t[2],o=f.len(e),s=Math.asin(a/o);return[Math.atan2(n,-i)*b,s*b,(o/T-1)*x]}},{key:"projectFlat",value:function(e){return e}},{key:"unprojectFlat",value:function(e){return e}},{key:"panByPosition",value:function(e,t){var r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}]),m}(d.default);function E(e,t){var r=p.transformMat4([],t,e);return p.scale(r,r,1/r[3]),r}return globeViewport.default=w,globeViewport}var orbitViewport={},hasRequiredOrbitViewport;function requireOrbitViewport(){if(hasRequiredOrbitViewport)return orbitViewport;hasRequiredOrbitViewport=1;var e=interopRequireDefaultExports;Object.defineProperty(orbitViewport,"__esModule",{value:!0}),orbitViewport.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=e(requireViewport()),c=es5$q,d=es5$7;function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Math.PI/180;function m(e){var t=e.height,r=e.focalDistance,n=e.orbitAxis,i=e.rotationX,a=e.rotationOrbit,o=e.zoom,s="Z"===n?[0,0,1]:[0,1,0],l="Z"===n?[0,-r,0]:[0,0,r],u=(new c.Matrix4).lookAt({eye:l,up:s});u.rotateX(i*p),"Z"===n?u.rotateZ(a*p):u.rotateY(a*p);var d=Math.pow(2,o)/t;return u.scale(d),u}var g=function(e){(0,a.default)(p,e);var u,c,h=(u=p,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(c){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function p(e){var t;(0,r.default)(this,p);var n=e.height,a=e.projectionMatrix,o=e.fovy,s=void 0===o?50:o,u=e.orbitAxis,c=void 0===u?"Z":u,g=e.target,_=void 0===g?[0,0,0]:g,y=e.rotationX,v=void 0===y?0:y,b=e.rotationOrbit,x=void 0===b?0:b,T=e.zoom,w=void 0===T?0:T,E=a?a[5]/2:(0,d.fovyToAltitude)(s);return t=h.call(this,f(f({},e),{},{longitude:void 0,viewMatrix:m({height:n||1,focalDistance:E,orbitAxis:c,rotationX:v,rotationOrbit:x,zoom:w}),fovy:s,focalDistance:E,position:_,zoom:w})),(0,l.default)((0,i.default)(t),"projectedCenter",void 0),t.projectedCenter=t.project(t.center),t}return(0,n.default)(p,[{key:"unproject",value:function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===r||r,i=(0,t.default)(e,3),a=i[1],o=i[2],s=(0,d.pixelsToWorld)([i[0],n?a:this.height-a,void 0===o?this.projectedCenter[2]:o],this.pixelUnprojectionMatrix),l=(0,t.default)(s,3);return[l[0],l[1],l[2]]}},{key:"panByPosition",value:function(e,t){var r=this.project(e);return{target:this.unproject([this.width/2+r[0]-t[0],this.height/2+r[1]-t[1],this.projectedCenter[2]])}}}]),p}(u.default);return orbitViewport.default=g,orbitViewport}var orthographicViewport={},hasRequiredOrthographicViewport;function requireOrthographicViewport(){if(hasRequiredOrthographicViewport)return orthographicViewport;hasRequiredOrthographicViewport=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(orthographicViewport,"__esModule",{value:!0}),orthographicViewport.default=void 0;var r=e(requireSlicedToArray()),n=e(requireDefineProperty()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=e(requireViewport()),c=es5$q,d=es5$7,h=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=f(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireVec2());function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=(new c.Matrix4).lookAt({eye:[0,0,1]});function _(e){var t=e.width,r=e.height,n=e.near,i=e.far,a=e.padding,o=-t/2,s=t/2,l=-r/2,u=r/2;if(a){var d=a.left,h=a.right,f=a.top,p=void 0===f?0:f,m=a.bottom,g=void 0===m?0:m,_=(0,c.clamp)(((void 0===d?0:d)+t-(void 0===h?0:h))/2,0,t)-t/2,y=(0,c.clamp)((p+r-g)/2,0,r)-r/2;o-=_,s-=_,l+=y,u+=y}return(new c.Matrix4).ortho({left:o,right:s,bottom:l,top:u,near:n,far:i})}var y=function(e){(0,o.default)(c,e);var t,n,u=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);if(n){var i=(0,l.default)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,s.default)(this,e)});function c(e){(0,i.default)(this,c);var t,r=e.width,n=e.height,a=e.near,o=void 0===a?.1:a,s=e.far,l=void 0===s?1e3:s,d=e.zoom,h=void 0===d?0:d,f=e.target,p=void 0===f?[0,0,0]:f,y=e.padding,v=void 0===y?null:y,b=e.flipY,x=void 0===b||b,T=Array.isArray(h)?h[0]:h,w=Array.isArray(h)?h[1]:h,E=Math.min(T,w),A=Math.pow(2,E);if(T!==w){var S=Math.pow(2,T),P=Math.pow(2,w);t={unitsPerMeter:[S/A,P/A,1],metersPerUnit:[A/S,A/P,1]}}return u.call(this,m(m({},e),{},{longitude:void 0,position:p,viewMatrix:g.clone().scale([A,A*(x?-1:1),A]),projectionMatrix:_({width:r||1,height:n||1,padding:v,near:o,far:l}),zoom:E,distanceScales:t}))}return(0,a.default)(c,[{key:"projectFlat",value:function(e){var t=(0,r.default)(e,2),n=this.distanceScales.unitsPerMeter;return[t[0]*n[0],t[1]*n[1]]}},{key:"unprojectFlat",value:function(e){var t=(0,r.default)(e,2),n=this.distanceScales.metersPerUnit;return[t[0]*n[0],t[1]*n[1]]}},{key:"panByPosition",value:function(e,t){var r=(0,d.pixelsToWorld)(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),i=h.add([],n,h.negate([],r)),a=h.add([],this.center,i);return{target:this.unprojectFlat(a)}}}]),c}(u.default);return orthographicViewport.default=y,orthographicViewport}var firstPersonViewport={},hasRequiredFirstPersonViewport;function requireFirstPersonViewport(){if(hasRequiredFirstPersonViewport)return firstPersonViewport;hasRequiredFirstPersonViewport=1;var e=interopRequireDefaultExports;Object.defineProperty(firstPersonViewport,"__esModule",{value:!0}),firstPersonViewport.default=void 0;var t=e(requireClassCallCheck()),r=e(requireAssertThisInitialized()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireViewport()),l=es5$7,u=es5$q;function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(e){(0,n.default)(f,e);var s,c,h=(s=f,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(s);if(c){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function f(e){var n;(0,t.default)(this,f);var i=e.longitude,a=e.latitude,s=e.modelMatrix,c=e.bearing,p=e.pitch,m=void 0===p?0:p,g=e.up,_=void 0===g?[0,0,1]:g,y=new u._SphericalCoordinates({bearing:void 0===c?0:c,pitch:-90===m?1e-4:90+m}).toVector3().normalize(),v=s?new u.Matrix4(s).transformAsVector(y):y,b=Number.isFinite(a)?(0,l.getMeterZoom)({latitude:a}):0,x=Math.pow(2,b),T=(new u.Matrix4).lookAt({eye:[0,0,0],center:v,up:_}).scale(x);return n=h.call(this,d(d({},e),{},{zoom:b,viewMatrix:T})),(0,o.default)((0,r.default)(n),"longitude",void 0),(0,o.default)((0,r.default)(n),"latitude",void 0),n.latitude=a,n.longitude=i,n}return f}(s.default);return firstPersonViewport.default=h,firstPersonViewport}var firstPersonView={},firstPersonController={},hasRequiredFirstPersonController,hasRequiredFirstPersonView;function requireFirstPersonController(){if(hasRequiredFirstPersonController)return firstPersonController;hasRequiredFirstPersonController=1;var e=interopRequireDefaultExports;Object.defineProperty(firstPersonController,"__esModule",{value:!0}),firstPersonController.default=void 0;var t=e(requireAssertThisInitialized()),r=e(requireDefineProperty()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireController()),u=e(requireViewState()),c=requireMathUtils(),d=e(requireLinearInterpolator()),h=es5$q;function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.default)(this,r)}}var g=function(e){(0,a.default)(r,e);var t=m(r);function r(e){(0,n.default)(this,r);var i=e.position,a=e.bearing,o=e.pitch,s=e.longitude,l=e.latitude,u=e.maxPitch,c=e.minPitch;return t.call(this,{width:e.width,height:e.height,position:void 0===i?[0,0,0]:i,bearing:void 0===a?0:a,pitch:void 0===o?0:o,longitude:void 0===s?null:s,latitude:void 0===l?null:l,maxPitch:void 0===u?90:u,minPitch:void 0===c?-90:c},{startRotatePos:e.startRotatePos,startBearing:e.startBearing,startPitch:e.startPitch,startZoomPosition:e.startZoomPosition})}return(0,i.default)(r,[{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(e){return this._getUpdatedState({startRotatePos:e.pos,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(e){var t=e.pos,r=e.deltaAngleX,n=void 0===r?0:r,i=e.deltaAngleY,a=void 0===i?0:i,o=this.getState(),s=o.startRotatePos,l=o.startBearing,u=o.startPitch,c=this.getViewportProps();return s&&void 0!==l&&void 0!==u?this._getUpdatedState(t?{bearing:l-(t[0]-s[0])/c.width*180,pitch:u-(t[1]-s[1])/c.height*90}:{bearing:l-n,pitch:u-a}):this}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}},{key:"zoom",value:function(e){var t=e.scale,r=this.getState().startZoomPosition;r||(r=this.getViewportProps().position);var n=this.getDirection();return this._move(n,20*Math.log2(t),r)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null})}},{key:"moveLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=this.getDirection(!0);return this._move(t.rotateZ({radians:Math.PI/2}),e)}},{key:"moveRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=this.getDirection(!0);return this._move(t.rotateZ({radians:-Math.PI/2}),e)}},{key:"moveUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=this.getDirection(!0);return this._move(t,e)}},{key:"moveDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=this.getDirection(!0);return this._move(t.negate(),e)}},{key:"rotateLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}},{key:"rotateRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}},{key:"rotateUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}},{key:"rotateDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}},{key:"zoomIn",value:function(){return this.zoom({scale:arguments.length>0&&void 0!==arguments[0]?arguments[0]:2})}},{key:"zoomOut",value:function(){return this.zoom({scale:1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)})}},{key:"shortestPathFrom",value:function(e){var t=e.getViewportProps(),r=p({},this.getViewportProps()),n=r.bearing,i=r.longitude;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),null!==i&&null!==t.longitude&&Math.abs(i-t.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}},{key:"_move",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getViewportProps().position,n=e.scale(t);return this._getUpdatedState({position:new h.Vector3(r).add(n)})}},{key:"getDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new h._SphericalCoordinates({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}},{key:"_getUpdatedState",value:function(e){return new r(p(p(p({},this.getViewportProps()),this.getState()),e))}},{key:"applyConstraints",value:function(e){var t=e.longitude,r=e.bearing;return e.pitch=(0,h.clamp)(e.pitch,e.minPitch,e.maxPitch),null!==t&&(t<-180||t>180)&&(e.longitude=(0,c.mod)(t+180,360)-180),(r<-180||r>180)&&(e.bearing=(0,c.mod)(r+180,360)-180),e}}]),r}(u.default),_=function(e){(0,a.default)(o,e);var i=m(o);function o(){var e;(0,n.default)(this,o);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return e=i.call.apply(i,[this].concat(s)),(0,r.default)((0,t.default)(e),"ControllerState",g),(0,r.default)((0,t.default)(e),"transition",{transitionDuration:300,transitionInterpolator:new d.default(["position","pitch","bearing"])}),e}return o}(l.default);return firstPersonController.default=_,firstPersonController}function requireFirstPersonView(){if(hasRequiredFirstPersonView)return firstPersonView;hasRequiredFirstPersonView=1;var e=interopRequireDefaultExports;Object.defineProperty(firstPersonView,"__esModule",{value:!0}),firstPersonView.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireView()),l=e(requireFirstPersonViewport()),u=e(requireFirstPersonController()),c=function(e){(0,n.default)(d,e);var o,s,c=(o=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"ViewportType",get:function(){return l.default}},{key:"ControllerType",get:function(){return u.default}}]),d}(s.default);return firstPersonView.default=c,(0,o.default)(c,"displayName","FirstPersonView"),firstPersonView}var orbitView={},orbitController={},hasRequiredOrbitController,hasRequiredOrbitView;function requireOrbitController(){if(hasRequiredOrbitController)return orbitController;hasRequiredOrbitController=1;var e=interopRequireDefaultExports;Object.defineProperty(orbitController,"__esModule",{value:!0}),orbitController.default=orbitController.OrbitState=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$q,u=e(requireController()),c=e(requireViewState()),d=requireMathUtils(),h=e(requireLinearInterpolator());function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,o.default)(e);if(t){var i=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var g=function(e){(0,i.default)(o,e);var a=m(o);function o(e){var r;(0,t.default)(this,o);var i=e.rotationX,l=e.rotationOrbit,u=e.target,c=e.zoom,d=e.minRotationX,h=e.maxRotationX,f=e.minZoom,p=e.maxZoom;return r=a.call(this,{width:e.width,height:e.height,rotationX:void 0===i?0:i,rotationOrbit:void 0===l?0:l,target:void 0===u?[0,0,0]:u,zoom:void 0===c?0:c,minRotationX:void 0===d?-90:d,maxRotationX:void 0===h?90:h,minZoom:void 0===f?-1/0:f,maxZoom:void 0===p?1/0:p},{startPanPosition:e.startPanPosition,startRotatePos:e.startRotatePos,startRotationX:e.startRotationX,startRotationOrbit:e.startRotationOrbit,startZoomPosition:e.startZoomPosition,startZoom:e.startZoom}),(0,s.default)((0,n.default)(r),"makeViewport",void 0),r.makeViewport=e.makeViewport,r}return(0,r.default)(o,[{key:"panStart",value:function(e){return this._getUpdatedState({startPanPosition:this._unproject(e.pos)})}},{key:"pan",value:function(e){var t=e.pos,r=e.startPosition,n=this.getState().startPanPosition||r;if(!n)return this;var i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(e){return this._getUpdatedState({startRotatePos:e.pos,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}},{key:"rotate",value:function(e){var t,r=e.pos,n=e.deltaAngleX,i=void 0===n?0:n,a=e.deltaAngleY,o=void 0===a?0:a,s=this.getState(),l=s.startRotatePos,u=s.startRotationX,c=s.startRotationOrbit,d=this.getViewportProps();if(!l||void 0===u||void 0===c)return this;if(r){var h=(r[0]-l[0])/d.width;(u<-90||u>90)&&(h*=-1),t={rotationX:u+(r[1]-l[1])/d.height*180,rotationOrbit:c+180*h}}else t={rotationX:u+o,rotationOrbit:c+i};return this._getUpdatedState(t)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(e){var t=e.getViewportProps(),r=p({},this.getViewportProps()),n=r.rotationOrbit;return Math.abs(n-t.rotationOrbit)>180&&(r.rotationOrbit=n<0?n+360:n-360),r}},{key:"zoomStart",value:function(e){return this._getUpdatedState({startZoomPosition:this._unproject(e.pos),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(e){var t=e.pos,r=e.startPos,n=e.scale,i=this.getState(),a=i.startZoom,o=i.startZoomPosition;if(o||(a=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(t)),!o)return this;var s=this._calculateNewZoom({scale:n,startZoom:a}),l=this.makeViewport(p(p({},this.getViewportProps()),{},{zoom:s}));return this._getUpdatedState(p({zoom:s},l.panByPosition(o,t)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:arguments.length>0&&void 0!==arguments[0]?arguments[0]:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)})})}},{key:"moveLeft",value:function(){return this._panFromCenter([-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:50),0])}},{key:"moveRight",value:function(){return this._panFromCenter([arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:50)])}},{key:"moveDown",value:function(){return this._panFromCenter([0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:50])}},{key:"rotateLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}},{key:"rotateRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}},{key:"rotateUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}},{key:"rotateDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}},{key:"_unproject",value:function(e){var t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}},{key:"_calculateNewZoom",value:function(e){var t=e.scale,r=e.startZoom,n=this.getViewportProps(),i=n.maxZoom,a=n.minZoom;void 0===r&&(r=this.getViewportProps().zoom);var o=r+Math.log2(t);return(0,l.clamp)(o,a,i)}},{key:"_panFromCenter",value:function(e){var t=this.getViewportProps();return this.pan({startPosition:t.target,pos:[t.width/2+e[0],t.height/2+e[1]]})}},{key:"_getUpdatedState",value:function(e){return new this.constructor(p(p(p({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),e))}},{key:"applyConstraints",value:function(e){var t=e.maxZoom,r=e.minZoom,n=e.zoom,i=e.maxRotationX,a=e.minRotationX,o=e.rotationOrbit;return e.zoom=Array.isArray(n)?[(0,l.clamp)(n[0],r,t),(0,l.clamp)(n[1],r,t)]:(0,l.clamp)(n,r,t),e.rotationX=(0,l.clamp)(e.rotationX,a,i),(o<-180||o>180)&&(e.rotationOrbit=(0,d.mod)(o+180,360)-180),e}}]),o}(c.default);orbitController.OrbitState=g;var _=function(e){(0,i.default)(a,e);var r=m(a);function a(){var e;(0,t.default)(this,a);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return e=r.call.apply(r,[this].concat(o)),(0,s.default)((0,n.default)(e),"ControllerState",g),(0,s.default)((0,n.default)(e),"transition",{transitionDuration:300,transitionInterpolator:new h.default({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}),e}return a}(u.default);return orbitController.default=_,orbitController}function requireOrbitView(){if(hasRequiredOrbitView)return orbitView;hasRequiredOrbitView=1;var e=interopRequireDefaultExports;Object.defineProperty(orbitView,"__esModule",{value:!0}),orbitView.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireView()),l=e(requireOrbitViewport()),u=e(requireOrbitController()),c=function(e){(0,n.default)(d,e);var o,s,c=(o=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.default)(this,d),(e=c.call(this,r)).props.orbitAxis=r.orbitAxis||"Z",e}return(0,r.default)(d,[{key:"ViewportType",get:function(){return l.default}},{key:"ControllerType",get:function(){return u.default}}]),d}(s.default);return orbitView.default=c,(0,o.default)(c,"displayName","OrbitView"),orbitView}var orthographicView={},orthographicController={},hasRequiredOrthographicController,hasRequiredOrthographicView;function requireOrthographicController(){if(hasRequiredOrthographicController)return orthographicController;hasRequiredOrthographicController=1;var e=interopRequireDefaultExports;Object.defineProperty(orthographicController,"__esModule",{value:!0}),orthographicController.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$q,c=e(requireController()),d=requireOrbitController(),h=e(requireLinearInterpolator());function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,o.default)(this,r)}}var p=function(e){(0,a.default)(s,e);var o=f(s);function s(e){var t;return(0,r.default)(this,s),t=o.call(this,e),(0,l.default)((0,i.default)(t),"zoomAxis",void 0),t.zoomAxis=e.zoomAxis||"all",t}return(0,n.default)(s,[{key:"_calculateNewZoom",value:function(e){var r=e.scale,n=e.startZoom,i=this.getViewportProps(),a=i.maxZoom,o=i.minZoom;void 0===n&&(n=this.getViewportProps().zoom);var s=Math.log2(r);if(Array.isArray(n)){var l=(0,t.default)(n,2),c=l[0],d=l[1];switch(this.zoomAxis){case"X":c=(0,u.clamp)(c+s,o,a);break;case"Y":d=(0,u.clamp)(d+s,o,a);break;default:var h=Math.min(c+s,d+s);h<o&&(s+=o-h),(h=Math.max(c+s,d+s))>a&&(s+=a-h),c+=s,d+=s}return[c,d]}return(0,u.clamp)(n+s,o,a)}}]),s}(d.OrbitState),m=function(e){(0,a.default)(o,e);var t=f(o);function o(){var e;(0,r.default)(this,o);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),(0,l.default)((0,i.default)(e),"ControllerState",p),(0,l.default)((0,i.default)(e),"transition",{transitionDuration:300,transitionInterpolator:new h.default(["target","zoom"])}),(0,l.default)((0,i.default)(e),"dragMode","pan"),e}return(0,n.default)(o,[{key:"_onPanRotate",value:function(){return!1}}]),o}(c.default);return orthographicController.default=m,orthographicController}function requireOrthographicView(){if(hasRequiredOrthographicView)return orthographicView;hasRequiredOrthographicView=1;var e=interopRequireDefaultExports;Object.defineProperty(orthographicView,"__esModule",{value:!0}),orthographicView.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireView()),l=e(requireOrthographicViewport()),u=e(requireOrthographicController()),c=function(e){(0,n.default)(d,e);var o,s,c=(o=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"ViewportType",get:function(){return l.default}},{key:"ControllerType",get:function(){return u.default}}]),d}(s.default);return orthographicView.default=c,(0,o.default)(c,"displayName","OrthographicView"),orthographicView}var globeView={},globeController={},hasRequiredGlobeController,hasRequiredGlobeView;function requireGlobeController(){if(hasRequiredGlobeController)return globeController;hasRequiredGlobeController=1;var e=interopRequireDefaultExports;Object.defineProperty(globeController,"__esModule",{value:!0}),globeController.default=void 0;var t=e(requireAssertThisInitialized()),r=e(requireGet()),n=e(requireDefineProperty()),i=e(requireClassCallCheck()),a=e(requireCreateClass()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=es5$q,c=e(requireController()),d=requireMapController(),h=requireMathUtils(),f=e(requireLinearInterpolator());function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var m=function(e){(0,o.default)(r,e);var t=p(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,a.default)(r,[{key:"applyConstraints",value:function(e){e.zoom=(0,u.clamp)(e.zoom,e.minZoom,e.maxZoom);var t=e.longitude,r=e.latitude;return(t<-180||t>180)&&(e.longitude=(0,h.mod)(t+180,360)-180),e.latitude=(0,u.clamp)(r,-89,89),e}}]),r}(d.MapState),g=function(e){(0,o.default)(u,e);var s=p(u);function u(){var e;(0,i.default)(this,u);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=s.call.apply(s,[this].concat(a)),(0,n.default)((0,t.default)(e),"ControllerState",m),(0,n.default)((0,t.default)(e),"transition",{transitionDuration:300,transitionInterpolator:new f.default(["longitude","latitude","zoom"])}),(0,n.default)((0,t.default)(e),"dragMode","pan"),e}return(0,a.default)(u,[{key:"setProps",value:function(e){(0,r.default)((0,l.default)(u.prototype),"setProps",this).call(this,e),this.dragRotate=!1,this.touchRotate=!1}}]),u}(c.default);return globeController.default=g,globeController}function requireGlobeView(){if(hasRequiredGlobeView)return globeView;hasRequiredGlobeView=1;var e=interopRequireDefaultExports;Object.defineProperty(globeView,"__esModule",{value:!0}),globeView.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=e(requireView()),l=e(requireGlobeViewport()),u=e(requireGlobeController()),c=function(e){(0,n.default)(d,e);var o,s,c=(o=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(s){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"ViewportType",get:function(){return l.default}},{key:"ControllerType",get:function(){return u.default}}]),d}(s.default);return globeView.default=c,(0,o.default)(c,"displayName","GlobeView"),globeView}var layerExtension={},hasRequiredLayerExtension;function requireLayerExtension(){if(hasRequiredLayerExtension)return layerExtension;hasRequiredLayerExtension=1;var e=interopRequireDefaultExports;Object.defineProperty(layerExtension,"__esModule",{value:!0}),layerExtension.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireDeepEqual(),a=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"opts",void 0),r&&(this.opts=r)}return(0,r.default)(e,[{key:"equals",value:function(e){return this===e||this.constructor===e.constructor&&(0,i.deepEqual)(this.opts,e.opts,1)}},{key:"getShaders",value:function(e){return null}},{key:"getSubLayerProps",value:function(e){var t=e.constructor.defaultProps,r={updateTriggers:{}};for(var n in t)if(n in this.props){var i=t[n],a=this.props[n];r[n]=a,i&&"accessor"===i.type&&(r.updateTriggers[n]=this.props.updateTriggers[n],"function"==typeof a&&(r[n]=this.getSubLayerAccessor(a)))}return r}},{key:"initializeState",value:function(e,t){}},{key:"updateState",value:function(e,t){}},{key:"onNeedsRedraw",value:function(e){}},{key:"getNeedsPickingBuffer",value:function(e){return!1}},{key:"draw",value:function(e,t){}},{key:"finalizeState",value:function(e,t){}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}}]),e}();return layerExtension.default=a,(0,n.default)(a,"defaultProps",{}),(0,n.default)(a,"extensionName","LayerExtension"),layerExtension}var flyToInterpolator={},hasRequiredFlyToInterpolator;function requireFlyToInterpolator(){if(hasRequiredFlyToInterpolator)return flyToInterpolator;hasRequiredFlyToInterpolator=1;var e=interopRequireDefaultExports;Object.defineProperty(flyToInterpolator,"__esModule",{value:!0}),flyToInterpolator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=e(requireTransitionInterpolator()),u=es5$q,c=es5$7;function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f={bearing:0,pitch:0,position:[0,0,0]},p={speed:1.2,curve:1.414},m=function(e){(0,i.default)(g,e);var l,d,m=(l=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(l);if(d){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function g(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.default)(this,g),e=m.call(this,{compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),(0,s.default)((0,n.default)(e),"opts",void 0),e.opts=h(h({},p),r),e}return(0,r.default)(g,[{key:"interpolateProps",value:function(e,t,r){var n=(0,c.flyToViewport)(e,t,r,this.opts);for(var i in f)n[i]=(0,u.lerp)(e[i]||f[i],t[i]||f[i],r);return n}},{key:"getDuration",value:function(e,t){var r=t.transitionDuration;return"auto"===r&&(r=(0,c.getFlyToDuration)(e,t,this.opts)),r}}]),g}(l.default);return flyToInterpolator.default=m,flyToInterpolator}var tesselator={},hasRequiredTesselator;function requireTesselator(){if(hasRequiredTesselator)return tesselator;hasRequiredTesselator=1;var e=interopRequireDefaultExports;Object.defineProperty(tesselator,"__esModule",{value:!0}),tesselator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=requireIterableUtils(),a=e(requireTypedArrayManager()),o=e(requireAssert()),s=es5$b;function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=function(){function e(r){(0,t.default)(this,e),(0,n.default)(this,"opts",void 0),(0,n.default)(this,"typedArrayManager",void 0),(0,n.default)(this,"indexStarts",[0]),(0,n.default)(this,"vertexStarts",[0]),(0,n.default)(this,"vertexCount",0),(0,n.default)(this,"instanceCount",0),(0,n.default)(this,"attributes",void 0),(0,n.default)(this,"_attributeDefs",void 0),(0,n.default)(this,"data",void 0),(0,n.default)(this,"getGeometry",void 0),(0,n.default)(this,"geometryBuffer",void 0),(0,n.default)(this,"buffers",void 0),(0,n.default)(this,"positionSize",void 0),(0,n.default)(this,"normalize",void 0);var i=r.attributes,o=void 0===i?{}:i;this.typedArrayManager=a.default,this.attributes={},this._attributeDefs=o,this.opts=r,this.updateGeometry(r)}return(0,r.default)(e,[{key:"updateGeometry",value:function(e){Object.assign(this.opts,e);var t=this.opts,r=t.data,n=t.buffers,i=void 0===n?{}:n,a=t.getGeometry,s=t.geometryBuffer,u=t.positionFormat,c=t.dataChanged,d=t.normalize,h=void 0===d||d;if(this.data=r,this.getGeometry=a,this.positionSize=s&&s.size||("XY"===u?2:3),this.buffers=i,this.normalize=h,s&&((0,o.default)(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),h||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(c)){var f,p=l(c);try{for(p.s();!(f=p.n()).done;)this._rebuildGeometry(f.value)}catch(e){p.e(e)}finally{p.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(e){this._rebuildGeometry({startRow:e.startRow,endRow:e.endRow})}},{key:"getGeometryFromBuffer",value:function(e){var t=e.value||e;return ArrayBuffer.isView(t)?(0,i.getAccessorFromBuffer)(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}},{key:"_allocate",value:function(e,t){var r=this.attributes,n=this.buffers,i=this._attributeDefs,a=this.typedArrayManager;for(var o in i)if(o in n)a.release(r[o]),r[o]=null;else{var s=i[o];s.copy=t,r[o]=a.allocate(r[o],e,s)}}},{key:"_forEachGeometry",value:function(e,t,r){var n,a=this.getGeometry,o=(0,i.createIterable)(this.data,t,r),s=o.objectInfo,u=l(o.iterable);try{for(u.s();!(n=u.n()).done;){var c=n.value;s.index++,e(a?a(c,s):null,s.index)}}catch(e){u.e(e)}finally{u.f()}}},{key:"_rebuildGeometry",value:function(e){var t=this;if(this.data){var r=this.indexStarts,n=this.vertexStarts,i=this.instanceCount,a=this.data,o=this.geometryBuffer,l=e||{},u=l.startRow,c=void 0===u?0:u,d=l.endRow,h=void 0===d?1/0:d,f={};if(e||(r=[0],n=[0]),this.normalize||!o)this._forEachGeometry((function(e,r){var i=e&&t.normalizeGeometry(e);f[r]=i,n[r+1]=n[r]+(i?t.getGeometrySize(i):0)}),c,h),i=n[n.length-1];else if(i=(n=a.startIndices)[a.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof s.Buffer)i=i||o.byteLength/(o.accessor.stride||4*this.positionSize);else if(o.buffer)i=i||o.buffer.byteLength/(o.stride||4*this.positionSize);else if(o.value){var p=o.value;i=i||p.length/(o.stride/p.BYTES_PER_ELEMENT||this.positionSize)}this._allocate(i,Boolean(e)),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;var m={};this._forEachGeometry((function(e,a){var o=f[a]||e;m.vertexStart=n[a],m.indexStart=r[a],m.geometrySize=(a<n.length-1?n[a+1]:i)-n[a],m.geometryIndex=a,t.updateGeometryAttributes(o,m)}),c,h),this.vertexCount=r[r.length-1]}}}]),e}();return tesselator.default=c,tesselator}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"VERSION",{enumerable:!0,get:function(){return r.VERSION}}),Object.defineProperty(e,"COORDINATE_SYSTEM",{enumerable:!0,get:function(){return n.COORDINATE_SYSTEM}}),Object.defineProperty(e,"OPERATION",{enumerable:!0,get:function(){return n.OPERATION}}),Object.defineProperty(e,"UNIT",{enumerable:!0,get:function(){return n.UNIT}}),Object.defineProperty(e,"LightingEffect",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"AmbientLight",{enumerable:!0,get:function(){return a.AmbientLight}}),Object.defineProperty(e,"DirectionalLight",{enumerable:!0,get:function(){return o.DirectionalLight}}),Object.defineProperty(e,"PointLight",{enumerable:!0,get:function(){return s.PointLight}}),Object.defineProperty(e,"_CameraLight",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"_SunLight",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"PostProcessEffect",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"_LayersPass",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"_PickLayersPass",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"Deck",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"LayerManager",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"AttributeManager",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(e,"Layer",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"CompositeLayer",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(e,"DeckRenderer",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(e,"Viewport",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(e,"WebMercatorViewport",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(e,"_GlobeViewport",{enumerable:!0,get:function(){return x.default}}),Object.defineProperty(e,"OrbitViewport",{enumerable:!0,get:function(){return T.default}}),Object.defineProperty(e,"OrthographicViewport",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(e,"FirstPersonViewport",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(e,"picking",{enumerable:!0,get:function(){return A.picking}}),Object.defineProperty(e,"project",{enumerable:!0,get:function(){return A.project}}),Object.defineProperty(e,"project32",{enumerable:!0,get:function(){return A.project32}}),Object.defineProperty(e,"gouraudLighting",{enumerable:!0,get:function(){return A.gouraudLighting}}),Object.defineProperty(e,"phongLighting",{enumerable:!0,get:function(){return A.phongLighting}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return A.shadow}}),Object.defineProperty(e,"View",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(e,"MapView",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(e,"FirstPersonView",{enumerable:!0,get:function(){return M.default}}),Object.defineProperty(e,"OrbitView",{enumerable:!0,get:function(){return R.default}}),Object.defineProperty(e,"OrthographicView",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(e,"_GlobeView",{enumerable:!0,get:function(){return O.default}}),Object.defineProperty(e,"Controller",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(e,"MapController",{enumerable:!0,get:function(){return I.default}}),Object.defineProperty(e,"_GlobeController",{enumerable:!0,get:function(){return D.default}}),Object.defineProperty(e,"FirstPersonController",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(e,"OrbitController",{enumerable:!0,get:function(){return B.default}}),Object.defineProperty(e,"OrthographicController",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(e,"LayerExtension",{enumerable:!0,get:function(){return N.default}}),Object.defineProperty(e,"TRANSITION_EVENTS",{enumerable:!0,get:function(){return q.TRANSITION_EVENTS}}),Object.defineProperty(e,"TransitionInterpolator",{enumerable:!0,get:function(){return U.default}}),Object.defineProperty(e,"LinearInterpolator",{enumerable:!0,get:function(){return j.default}}),Object.defineProperty(e,"FlyToInterpolator",{enumerable:!0,get:function(){return G.default}}),Object.defineProperty(e,"log",{enumerable:!0,get:function(){return z.default}}),Object.defineProperty(e,"assert",{enumerable:!0,get:function(){return V.default}}),Object.defineProperty(e,"createIterable",{enumerable:!0,get:function(){return $.createIterable}}),Object.defineProperty(e,"fp64LowPart",{enumerable:!0,get:function(){return H.fp64LowPart}}),Object.defineProperty(e,"Tesselator",{enumerable:!0,get:function(){return W.default}}),Object.defineProperty(e,"_fillArray",{enumerable:!0,get:function(){return X.fillArray}}),Object.defineProperty(e,"_flatten",{enumerable:!0,get:function(){return X.flatten}}),Object.defineProperty(e,"_count",{enumerable:!0,get:function(){return Y.count}}),Object.defineProperty(e,"_deepEqual",{enumerable:!0,get:function(){return Z.deepEqual}}),Object.defineProperty(e,"_memoize",{enumerable:!0,get:function(){return K.default}}),Object.defineProperty(e,"_mergeShaders",{enumerable:!0,get:function(){return J.mergeShaders}}),Object.defineProperty(e,"_compareProps",{enumerable:!0,get:function(){return Q.compareProps}});var r=init$2,n=constants$4,i=t(requireLightingEffect()),a=requireAmbientLight(),o=requireDirectionalLight(),s=requirePointLight(),l=t(requireCameraLight()),u=t(requireSunLight()),c=t(requirePostProcessEffect()),d=t(requireLayersPass()),h=t(requirePickLayersPass()),f=t(requireDeck()),p=t(requireLayerManager()),m=t(requireAttributeManager()),g=t(requireLayer()),_=t(requireCompositeLayer()),y=t(requireDeckRenderer()),v=t(requireViewport()),b=t(requireWebMercatorViewport()),x=t(requireGlobeViewport()),T=t(requireOrbitViewport()),w=t(requireOrthographicViewport()),E=t(requireFirstPersonViewport()),A=requireShaderlib(),S=t(requireView()),P=t(requireMapView()),M=t(requireFirstPersonView()),R=t(requireOrbitView()),C=t(requireOrthographicView()),O=t(requireGlobeView()),L=t(requireController()),I=t(requireMapController()),D=t(requireGlobeController()),k=t(requireFirstPersonController()),B=t(requireOrbitController()),F=t(requireOrthographicController()),N=t(requireLayerExtension()),q=requireTransitionManager(),U=t(requireTransitionInterpolator()),j=t(requireLinearInterpolator()),G=t(requireFlyToInterpolator()),z=t(requireLog()),V=t(requireAssert()),$=requireIterableUtils(),H=requireMathUtils(),W=t(requireTesselator()),X=requireFlatten(),Y=requireCount(),Z=requireDeepEqual(),K=t(requireMemoize()),J=requireShader(),Q=requireProps()}(es5$g);const TILE_SIZE=512,DEGREES_TO_RADIANS=Math.PI/180;function getDeckInstance({map:e,gl:t,deck:r}){if(e.__deck)return e.__deck;const n=null==r?void 0:r.props._customRender,i=null==r?void 0:r.props.onLoad,a=getInterleavedProps({...null==r?void 0:r.props,_customRender:()=>{e.triggerRepaint(),null==n||n("")}});let o;return r&&r.props.gl!==t||(Object.assign(a,{gl:t,width:null,height:null,touchAction:"unset",viewState:getViewState(e)}),null!=r&&r.isInitialized?watchMapMove(r,e):a.onLoad=()=>{null==i||i(),watchMapMove(o,e)}),r?(o=r,r.setProps(a),r.userData.isExternal=!0):(o=new es5$g.Deck(a),e.on("remove",(()=>{removeDeckInstance(e)}))),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",(()=>{o.isInitialized&&afterRender(o,e)})),o}function watchMapMove(e,t){const r=()=>{e.isInitialized?onMapMove(e,t):t.off("move",r)};t.on("move",r)}function removeDeckInstance(e){var t;null===(t=e.__deck)||void 0===t||t.finalize(),e.__deck=null}function getInterleavedProps(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new es5$g.MapView({id:"mapbox"})]}}function addLayer(e,t){e.userData.mapboxLayers.add(t),updateLayers(e)}function removeLayer(e,t){e.userData.mapboxLayers.delete(t),updateLayers(e)}function updateLayer(e,t){updateLayers(e)}function drawLayer(e,t,r){let{currentViewport:n}=e.userData,i=!1;n||(n=getViewport(e,t,!0),e.userData.currentViewport=n,i=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:e})=>r.id===e.id||e.props.operation.includes("terrain"),clearStack:i,clearCanvas:!1})}function getViewState(e){var t;const{lng:r,lat:n}=e.getCenter(),i={longitude:(r+540)%360-180,latitude:n,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return null!==(t=e.getTerrain)&&void 0!==t&&t.call(e)&&centerCameraOnTerrain(e,i),i}function centerCameraOnTerrain(e,t){if(e.getFreeCameraOptions){const{position:r}=e.getFreeCameraOptions();if(!r||void 0===r.z)return;const n=e.transform.height,{longitude:i,latitude:a,pitch:o}=t,s=r.x*TILE_SIZE,l=(1-r.y)*TILE_SIZE,u=r.z*TILE_SIZE,c=es5$7.lngLatToWorld([i,a]),d=s-c[0],h=l-c[1],f=Math.sqrt(d*d+h*h),p=o*DEGREES_TO_RADIANS,m=1.5*n,g=p<.001?m*Math.cos(p)/u:m*Math.sin(p)/f;t.zoom=Math.log2(g);const _=m*Math.cos(p)/g;t.position=[0,0,(u-_)/es5$7.unitsPerMeter(a)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}function getViewport(e,t,r=!0){return new es5$g.WebMercatorViewport({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...getViewState(t),nearZMultiplier:r?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function afterRender(e,t){const{mapboxLayers:r,isExternal:n}=e.userData;if(n){const n=Array.from(r,(e=>e.id)),i=es5$g._flatten(e.props.layers,Boolean).some((e=>e&&!n.includes(e.id)));let a=e.getViewports();const o=a.findIndex((e=>"mapbox"===e.id));(i||a.length>1||o<0)&&(o>=0&&(a=a.slice(),a[o]=getViewport(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:a,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&("mapbox"!==t.viewport.id||!n.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function onMapMove(e,t){e.setProps({viewState:getViewState(t)}),e.needsRedraw({clearRedrawFlags:!0})}function updateLayers(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach((e=>{const r=new(0,e.props.type)(e.props);t.push(r)})),e.setProps({layers:t})}class MapboxLayer{constructor(e){if(_defineProperty(this,"id",void 0),_defineProperty(this,"type",void 0),_defineProperty(this,"renderingMode",void 0),_defineProperty(this,"map",void 0),_defineProperty(this,"deck",void 0),_defineProperty(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=getDeckInstance({map:e,gl:t,deck:this.props.deck}),addLayer(this.deck,this)}onRemove(){this.deck&&removeLayer(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&updateLayer(this.deck)}render(){drawLayer(this.deck,this.map,this)}}var es5$4={},arcLayer={},arcLayerVertex_glsl={},hasRequiredArcLayerVertex_glsl;function requireArcLayerVertex_glsl(){return hasRequiredArcLayerVertex_glsl||(hasRequiredArcLayerVertex_glsl=1,Object.defineProperty(arcLayerVertex_glsl,"__esModule",{value:!0}),arcLayerVertex_glsl.default=void 0,arcLayerVertex_glsl.default="#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int widthUnits;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  if (dh == 0.0) {\n    return sourceZ + deltaZ * ratio;\n  }\n  float unitZ = deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n  vec3 source;\n  vec3 target;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source_world = instanceSourcePositions;\n    vec3 target_world = instanceTargetPositions;\n    if (useShortestPath) {\n      source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n      target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n\n      float deltaLng = target_world.x - source_world.x;\n      if (deltaLng > 180.) target_world.x -= 360.;\n      if (deltaLng < -180.) source_world.x -= 360.;\n    }\n    source = project_position(source_world, instanceSourcePositions64Low);\n    target = project_position(target_world, instanceTargetPositions64Low);\n    float antiMeridianX = 0.0;\n\n    if (useShortestPath) {\n      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n      }\n      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\n\n      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\n        isValid = 0.0;\n        indexDir = sign(segmentRatio - thresholdRatio);\n        segmentRatio = thresholdRatio;\n      }\n    }\n\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n\n    if (useShortestPath) {\n      if (nextPos.x < antiMeridianX) {\n        currPos.x += TILE_SIZE;\n        nextPos.x += TILE_SIZE;\n      }\n    }\n\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  DECKGL_FILTER_GL_POSITION(curr, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),arcLayerVertex_glsl}var arcLayerFragment_glsl={},hasRequiredArcLayerFragment_glsl,hasRequiredArcLayer;function requireArcLayerFragment_glsl(){return hasRequiredArcLayerFragment_glsl||(hasRequiredArcLayerFragment_glsl=1,Object.defineProperty(arcLayerFragment_glsl,"__esModule",{value:!0}),arcLayerFragment_glsl.default=void 0,arcLayerFragment_glsl.default="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),arcLayerFragment_glsl}function requireArcLayer(){if(hasRequiredArcLayer)return arcLayer;hasRequiredArcLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(arcLayer,"__esModule",{value:!0}),arcLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=e(requireArcLayerVertex_glsl()),h=e(requireArcLayerFragment_glsl());function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=[0,0,0,255],g={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:m},getTargetColor:{type:"accessor",value:m},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},_=function(e){(0,a.default)(y,e);var f,g,_=(f=y,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(f);if(g){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function y(){var e;(0,t.default)(this,y);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=_.call.apply(_,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(y,[{key:"getBounds",value:function(){var e;return null===(e=this.getAttributeManager())||void 0===e?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,i.default)((0,s.default)(y.prototype),"getShaders",this).call(this,{vs:d.default,fs:h.default,modules:[u.project32,u.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:m},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:m},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(y.prototype),"updateState",this).call(this,e);var t=e.changeFlags;if(t.extensionsChanged||t.propsChanged&&e.props.numSegments!==e.oldProps.numSegments){var r,n=this.context.gl;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(n),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=this.props,r=t.widthUnits,n=t.widthScale,i=t.widthMinPixels,a=t.widthMaxPixels,o=t.greatCircle,s=t.wrapLongitude;this.state.model.setUniforms(e.uniforms).setUniforms({greatCircle:o,widthUnits:u.UNIT[r],widthScale:n,widthMinPixels:i,widthMaxPixels:a,useShortestPath:s}).draw()}},{key:"_getModel",value:function(e){for(var t=this.props,r=t.id,n=t.numSegments,i=[],a=0;a<n;a++)i=i.concat([a,1,0,a,-1,0]);var o=new c.Model(e,p(p({},this.getShaders()),{},{id:r,geometry:new c.Geometry({drawMode:5,attributes:{positions:new Float32Array(i)}}),isInstanced:!0}));return o.setUniforms({numSegments:n}),o}}]),y}(u.Layer);return arcLayer.default=_,(0,l.default)(_,"layerName","ArcLayer"),(0,l.default)(_,"defaultProps",g),arcLayer}var bitmapLayer={},createMesh$1={},hasRequiredCreateMesh;function requireCreateMesh(){if(hasRequiredCreateMesh)return createMesh$1;hasRequiredCreateMesh=1,Object.defineProperty(createMesh$1,"__esModule",{value:!0}),createMesh$1.default=function(e,i){if(!i)return function(e){for(var n=new Float64Array(12),i=0;i<e.length;i++)n[3*i+0]=e[i][0],n[3*i+1]=e[i][1],n[3*i+2]=e[i][2]||0;return{vertexCount:6,positions:n,indices:t,texCoords:r}}(e);for(var a=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),o=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),s=Math.ceil(a/i)+1,l=Math.ceil(o/i)+1,u=(s-1)*(l-1)*6,c=new Uint32Array(u),d=new Float32Array(s*l*2),h=new Float64Array(s*l*3),f=0,p=0,m=0;m<s;m++)for(var g=m/(s-1),_=0;_<l;_++){var y=_/(l-1),v=n(e,g,y);h[3*f+0]=v[0],h[3*f+1]=v[1],h[3*f+2]=v[2]||0,d[2*f+0]=g,d[2*f+1]=1-y,m>0&&_>0&&(c[p++]=f-l,c[p++]=f-l-1,c[p++]=f-1,c[p++]=f-l,c[p++]=f-1,c[p++]=f),f++}return{vertexCount:u,positions:h,indices:c,texCoords:d}};var e=es5$q,t=new Uint16Array([0,2,1,0,3,2]),r=new Float32Array([0,1,0,0,1,0,1,1]);function n(t,r,n){return(0,e.lerp)((0,e.lerp)(t[0],t[1],n),(0,e.lerp)(t[3],t[2],n),r)}return createMesh$1}var bitmapLayerVertex={},hasRequiredBitmapLayerVertex;function requireBitmapLayerVertex(){return hasRequiredBitmapLayerVertex||(hasRequiredBitmapLayerVertex=1,Object.defineProperty(bitmapLayerVertex,"__esModule",{value:!0}),bitmapLayerVertex.default=void 0,bitmapLayerVertex.default="\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n"),bitmapLayerVertex}var bitmapLayerFragment={},hasRequiredBitmapLayerFragment,hasRequiredBitmapLayer;function requireBitmapLayerFragment(){if(hasRequiredBitmapLayerFragment)return bitmapLayerFragment;hasRequiredBitmapLayerFragment=1,Object.defineProperty(bitmapLayerFragment,"__esModule",{value:!0}),bitmapLayerFragment.default=void 0;var e="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive && !picking_uAttribute) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n");return bitmapLayerFragment.default=e,bitmapLayerFragment}function requireBitmapLayer(){if(hasRequiredBitmapLayer)return bitmapLayer;hasRequiredBitmapLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(bitmapLayer,"__esModule",{value:!0}),bitmapLayer.default=void 0;var t=e(requireSlicedToArray()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireAssertThisInitialized()),a=e(requireGet()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=e(requireDefineProperty()),c=es5$g,d=es5$d,h=es5$7,f=e(requireCreateMesh()),p=e(requireBitmapLayerVertex()),m=e(requireBitmapLayerFragment());function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:c.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},v=function(e){(0,o.default)(x,e);var g,y,v=(g=x,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(g);if(y){var r=(0,l.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,s.default)(this,e)});function x(){var e;(0,r.default)(this,x);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=v.call.apply(v,[this].concat(n)),(0,u.default)((0,i.default)(e),"state",void 0),e}return(0,n.default)(x,[{key:"getShaders",value:function(){return(0,a.default)((0,l.default)(x.prototype),"getShaders",this).call(this,{vs:p.default,fs:m.default,modules:[c.project32,c.picking]})}},{key:"initializeState",value:function(){var e=this,t=this.getAttributeManager();t.remove(["instancePickingColors"]);var r=!0;t.add({indices:{size:1,isIndexed:!0,update:function(t){return t.value=e.state.mesh.indices},noAlloc:r},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(t){return t.value=e.state.mesh.positions},noAlloc:r},texCoords:{size:2,update:function(t){return t.value=e.state.mesh.texCoords},noAlloc:r}})}},{key:"updateState",value:function(e){var t=e.props,r=e.oldProps,n=e.changeFlags,i=this.getAttributeManager();if(n.extensionsChanged){var a,o=this.context.gl;null===(a=this.state.model)||void 0===a||a.delete(),this.state.model=this._getModel(o),i.invalidateAll()}if(t.bounds!==r.bounds){var s=this.state.mesh,l=this._createMesh();for(var u in this.state.model.setVertexCount(l.vertexCount),l)s&&s[u]!==l[u]&&i.invalidate(u);this.setState(_({mesh:l},this._getCoordinateUniforms()))}else t._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(e){var r=this.props.image,n=e.info;if(!n.color||!r)return n.bitmap=null,n;var i=r.width,a=r.height;n.index=0;var o=function(e){var r=(0,t.default)(e,3),n=r[2];return[(r[0]+(15&n)/16)/256,(r[1]+(240&n)/256)/256]}(n.color),s=[Math.floor(o[0]*i),Math.floor(o[1]*a)];return n.bitmap={size:{width:i,height:a},uv:o,pixel:s},n}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(e){(0,a.default)((0,l.default)(x.prototype),"_updateAutoHighlight",this).call(this,_(_({},e),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var e=this.props.bounds,t=e;return b(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),(0,f.default)(t,this.context.viewport.resolution)}},{key:"_getModel",value:function(e){return e?new d.Model(e,_(_({},this.getShaders()),{},{id:this.props.id,geometry:new d.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=this.state,r=t.model,n=t.coordinateConversion,i=t.bounds,a=this.props,o=a.image,s=a.desaturate,l=a.transparentColor,u=a.tintColor;e.moduleParameters.pickingActive&&t.disablePicking||o&&r&&r.setUniforms(e.uniforms).setUniforms({bitmapTexture:o,desaturate:s,transparentColor:l.map((function(e){return e/255})),tintColor:u.slice(0,3).map((function(e){return e/255})),coordinateConversion:n,bounds:i}).draw()}},{key:"_getCoordinateUniforms",value:function(){var e=c.COORDINATE_SYSTEM.LNGLAT,t=c.COORDINATE_SYSTEM.CARTESIAN,r=this.props._imageCoordinateSystem;if(r!==c.COORDINATE_SYSTEM.DEFAULT){var n=this.props.bounds;if(!b(n))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var i=this.context.viewport.resolution?e:t;if((r=r===e?e:t)===e&&i===t)return{coordinateConversion:-1,bounds:n};if(r===t&&i===e){var a=(0,h.lngLatToWorld)([n[0],n[1]]),o=(0,h.lngLatToWorld)([n[2],n[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],o[0],o[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),x}(c.Layer);function b(e){return Number.isFinite(e[0])}return bitmapLayer.default=v,(0,u.default)(v,"layerName","BitmapLayer"),(0,u.default)(v,"defaultProps",y),bitmapLayer}var iconLayer={},iconLayerVertex_glsl={},hasRequiredIconLayerVertex_glsl;function requireIconLayerVertex_glsl(){return hasRequiredIconLayerVertex_glsl||(hasRequiredIconLayerVertex_glsl=1,Object.defineProperty(iconLayerVertex_glsl,"__esModule",{value:!0}),iconLayerVertex_glsl.default=void 0,iconLayerVertex_glsl.default="#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n"),iconLayerVertex_glsl}var iconLayerFragment_glsl={},hasRequiredIconLayerFragment_glsl;function requireIconLayerFragment_glsl(){return hasRequiredIconLayerFragment_glsl||(hasRequiredIconLayerFragment_glsl=1,Object.defineProperty(iconLayerFragment_glsl,"__esModule",{value:!0}),iconLayerFragment_glsl.default=void 0,iconLayerFragment_glsl.default="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),iconLayerFragment_glsl}var iconManager={},hasRequiredIconManager,hasRequiredIconLayer;function requireIconManager(){if(hasRequiredIconManager)return iconManager;hasRequiredIconManager=1;var e=interopRequireDefaultExports;Object.defineProperty(iconManager,"__esModule",{value:!0}),iconManager.buildMapping=g,iconManager.getDiffIcons=_,iconManager.default=void 0;var t,r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireDefineProperty()),a=es5$d,o=es5$n,s=es5$g;function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(){},f=((0,i.default)(t={},10241,9987),(0,i.default)(t,10240,9729),(0,i.default)(t,10242,33071),(0,i.default)(t,10243,33071),t);function p(e){return e&&(e.id||e.url)}function m(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=i.icon,o=i.xOffset;e[p(a)]=d(d({},a),{},{x:o,y:r})}}function g(e){for(var t,r=e.icons,n=e.buffer,i=e.mapping,a=void 0===i?{}:i,o=e.xOffset,s=void 0===o?0:o,l=e.yOffset,u=void 0===l?0:l,c=e.rowHeight,d=void 0===c?0:c,h=e.canvasWidth,f=[],g=0;g<r.length;g++){var _=r[g];if(!a[p(_)]){var y=_.height,v=_.width;s+v+n>h&&(m(a,f,u),s=0,u=d+u+n,d=0,f=[]),f.push({icon:_,xOffset:s}),s=s+v+n,d=Math.max(d,y)}}return f.length>0&&m(a,f,u),{mapping:a,rowHeight:d,xOffset:s,yOffset:u,canvasWidth:h,canvasHeight:(t=d+u+n,Math.pow(2,Math.ceil(Math.log2(t))))}}function _(e,t,r){if(!e||!t)return null;r=r||{};var n,i={},a=(0,s.createIterable)(e),o=a.objectInfo,u=l(a.iterable);try{for(u.s();!(n=u.n()).done;){var c=n.value;o.index++;var h=t(c,o),f=p(h);if(!h)throw new Error("Icon is missing.");if(!h.url)throw new Error("Icon url is missing.");i[f]||r[f]&&h.url===r[f].url||(i[f]=d(d({},h),{},{source:c,sourceIndex:o.index}))}}catch(e){u.e(e)}finally{u.f()}return i}var y=function(){function e(t,n){var a=n.onUpdate,o=void 0===a?h:a,s=n.onError,l=void 0===s?h:s;(0,r.default)(this,e),(0,i.default)(this,"gl",void 0),(0,i.default)(this,"onUpdate",void 0),(0,i.default)(this,"onError",void 0),(0,i.default)(this,"_loadOptions",null),(0,i.default)(this,"_texture",null),(0,i.default)(this,"_externalTexture",null),(0,i.default)(this,"_mapping",{}),(0,i.default)(this,"_textureParameters",null),(0,i.default)(this,"_pendingCount",0),(0,i.default)(this,"_autoPacking",!1),(0,i.default)(this,"_xOffset",0),(0,i.default)(this,"_yOffset",0),(0,i.default)(this,"_rowHeight",0),(0,i.default)(this,"_buffer",4),(0,i.default)(this,"_canvasWidth",1024),(0,i.default)(this,"_canvasHeight",0),(0,i.default)(this,"_canvas",null),this.gl=t,this.onUpdate=o,this.onError=l}return(0,n.default)(e,[{key:"finalize",value:function(){var e;null===(e=this._texture)||void 0===e||e.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?p(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t,r=e.loadOptions,n=e.autoPacking,i=e.iconAtlas,a=e.iconMapping,o=e.textureParameters;r&&(this._loadOptions=r),void 0!==n&&(this._autoPacking=n),a&&(this._mapping=a),i&&(null===(t=this._texture)||void 0===t||t.delete(),this._texture=null,this._externalTexture=i),o&&(this._textureParameters=o)}},{key:"isLoaded",get:function(){return 0===this._pendingCount}},{key:"packIcons",value:function(e,t){if(this._autoPacking&&"undefined"!=typeof document){var r=Object.values(_(e,t,this._mapping)||{});if(r.length>0){var n=g({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),i=n.mapping,o=n.xOffset,s=n.yOffset,l=n.canvasHeight;this._rowHeight=n.rowHeight,this._mapping=i,this._xOffset=o,this._yOffset=s,this._canvasHeight=l,this._texture||(this._texture=new a.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||f})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,r,n){var i=e.width,o=e.height,s=new a.Texture2D(e.gl,{width:t,height:r,parameters:n});return(0,a.copyToTexture)(e,s,{targetY:0,width:i,height:o}),e.delete(),s}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||f)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}}},{key:"_loadIcons",value:function(e){var t,r=this,n=this._canvas.getContext("2d",{willReadFrequently:!0}),i=l(e);try{var a=function(){var e=t.value;r._pendingCount++,(0,o.load)(e.url,r._loadOptions).then((function(t){var i=p(e),a=r._mapping[i],o=a.x,s=a.y,l=a.width,u=a.height,c=function(e,t,r,n){var i=Math.min(r/t.width,n/t.height),a=Math.floor(t.width*i),o=Math.floor(t.height*i);return 1===i?{data:t,width:a,height:o}:(e.canvas.height=o,e.canvas.width=a,e.clearRect(0,0,a,o),e.drawImage(t,0,0,t.width,t.height,0,0,a,o),{data:e.canvas,width:a,height:o})}(n,t,l,u),d=c.width,h=c.height;r._texture.setSubImageData({data:c.data,x:o+(l-d)/2,y:s+(u-h)/2,width:d,height:h}),a.width=d,a.height=h,r._texture.generateMipmap(),r.onUpdate()})).catch((function(t){r.onError({url:e.url,source:e.source,sourceIndex:e.sourceIndex,loadOptions:r._loadOptions,error:t})})).finally((function(){r._pendingCount--}))};for(i.s();!(t=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}}]),e}();return iconManager.default=y,iconManager}function requireIconLayer(){if(hasRequiredIconLayer)return iconLayer;hasRequiredIconLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(iconLayer,"__esModule",{value:!0}),iconLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=e(requireIconLayerVertex_glsl()),h=e(requireIconLayerFragment_glsl()),f=e(requireIconManager());function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=[0,0,0,255],_={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(e){return e.position}},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:g},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},y=function(e){(0,a.default)(v,e);var p,_,y=(p=v,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(p);if(_){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function v(){var e;(0,t.default)(this,v);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(v,[{key:"getShaders",value:function(){return(0,i.default)((0,s.default)(v.prototype),"getShaders",this).call(this,{vs:d.default,fs:h.default,modules:[u.project32,u.picking]})}},{key:"initializeState",value:function(){this.state={iconManager:new f.default(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:g},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(v.prototype),"updateState",this).call(this,e);var t=e.props,r=e.oldProps,n=e.changeFlags,a=this.getAttributeManager(),o=t.iconAtlas,l=t.iconMapping,u=t.data,c=t.getIcon,d=t.textureParameters,h=this.state.iconManager,f=o||this.internalState.isAsyncPropLoading("iconAtlas");if(h.setProps({loadOptions:t.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?l:null,textureParameters:d}),f?r.iconMapping!==t.iconMapping&&a.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&h.packIcons(u,c),n.extensionsChanged){var p,m=this.context.gl;null===(p=this.state.model)||void 0===p||p.delete(),this.state.model=this._getModel(m),a.invalidateAll()}}},{key:"isLoaded",get:function(){return(0,i.default)((0,s.default)(v.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(e){(0,i.default)((0,s.default)(v.prototype),"finalizeState",this).call(this,e),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,r=this.props,n=r.sizeScale,i=r.sizeMinPixels,a=r.sizeMaxPixels,o=r.sizeUnits,s=r.billboard,l=r.alphaCutoff,c=this.state.iconManager.getTexture();c&&this.state.model.setUniforms(t).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:u.UNIT[o],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:a,billboard:s,alphaCutoff:l}).draw()}},{key:"_getModel",value:function(e){return new c.Model(e,m(m({},this.getShaders()),{},{id:this.props.id,geometry:new c.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(e){var t,r=null===(t=this.getCurrentLayer())||void 0===t?void 0:t.props.onIconError;r?r(e):u.log.error(e.error.message)()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e),r=t.width,n=t.height,i=t.anchorX,a=t.anchorY;return[r/2-(void 0===i?r/2:i),n/2-(void 0===a?n/2:a)]}},{key:"getInstanceColorMode",value:function(e){return this.state.iconManager.getIconMapping(e).mask?1:0}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x,t.y,t.width,t.height]}}]),v}(u.Layer);return iconLayer.default=y,(0,l.default)(y,"defaultProps",_),(0,l.default)(y,"layerName","IconLayer"),iconLayer}var lineLayer={},lineLayerVertex_glsl={},hasRequiredLineLayerVertex_glsl;function requireLineLayerVertex_glsl(){return hasRequiredLineLayerVertex_glsl||(hasRequiredLineLayerVertex_glsl=1,Object.defineProperty(lineLayerVertex_glsl,"__esModule",{value:!0}),lineLayerVertex_glsl.default=void 0,lineLayerVertex_glsl.default="#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float useShortestPath;\nuniform int widthUnits;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvec3 splitLine(vec3 a, vec3 b, float x) {\n  float t = (x - a.x) / (b.x - a.x);\n  return vec3(x, mix(a.yz, b.yz, t));\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  vec3 source_world = instanceSourcePositions;\n  vec3 target_world = instanceTargetPositions;\n  vec3 source_world_64low = instanceSourcePositions64Low;\n  vec3 target_world_64low = instanceTargetPositions64Low;\n\n  if (useShortestPath > 0.5 || useShortestPath < -0.5) {\n    source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n    target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n    float deltaLng = target_world.x - source_world.x;\n\n    if (deltaLng * useShortestPath > 180.) {\n      source_world.x += 360. * useShortestPath;\n      source_world = splitLine(source_world, target_world, 180. * useShortestPath);\n      source_world_64low = vec3(0.0);\n    } else if (deltaLng * useShortestPath < -180.) {\n      target_world.x += 360. * useShortestPath;\n      target_world = splitLine(source_world, target_world, 180. * useShortestPath);\n      target_world_64low = vec3(0.0);\n    } else if (useShortestPath < 0.) {\n      gl_Position = vec4(0.);\n      return;\n    }\n  }\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  DECKGL_FILTER_GL_POSITION(p, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),lineLayerVertex_glsl}var lineLayerFragment_glsl={},hasRequiredLineLayerFragment_glsl,hasRequiredLineLayer;function requireLineLayerFragment_glsl(){return hasRequiredLineLayerFragment_glsl||(hasRequiredLineLayerFragment_glsl=1,Object.defineProperty(lineLayerFragment_glsl,"__esModule",{value:!0}),lineLayerFragment_glsl.default=void 0,lineLayerFragment_glsl.default="#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),lineLayerFragment_glsl}function requireLineLayer(){if(hasRequiredLineLayer)return lineLayer;hasRequiredLineLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(lineLayer,"__esModule",{value:!0}),lineLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$g,u=es5$d,c=e(requireLineLayerVertex_glsl()),d=e(requireLineLayerFragment_glsl());function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},m=function(e){(0,i.default)(m,e);var s,h,p=(s=m,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(s);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function m(){return(0,t.default)(this,m),p.apply(this,arguments)}return(0,r.default)(m,[{key:"getBounds",value:function(){var e;return null===(e=this.getAttributeManager())||void 0===e?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,n.default)((0,o.default)(m.prototype),"getShaders",this).call(this,{vs:c.default,fs:d.default,modules:[l.project32,l.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(e){if((0,n.default)((0,o.default)(m.prototype),"updateState",this).call(this,e),e.changeFlags.extensionsChanged){var t,r=this.context.gl;null===(t=this.state.model)||void 0===t||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=this.props,r=t.widthUnits,n=t.widthScale,i=t.widthMinPixels,a=t.widthMaxPixels,o=t.wrapLongitude;this.state.model.setUniforms(e.uniforms).setUniforms({widthUnits:l.UNIT[r],widthScale:n,widthMinPixels:i,widthMaxPixels:a,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(e){return new u.Model(e,f(f({},this.getShaders()),{},{id:this.props.id,geometry:new u.Geometry({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))}}]),m}(l.Layer);return lineLayer.default=m,(0,s.default)(m,"layerName","LineLayer"),(0,s.default)(m,"defaultProps",p),lineLayer}var pointCloudLayer={},pointCloudLayerVertex_glsl={},hasRequiredPointCloudLayerVertex_glsl;function requirePointCloudLayerVertex_glsl(){return hasRequiredPointCloudLayerVertex_glsl||(hasRequiredPointCloudLayerVertex_glsl=1,Object.defineProperty(pointCloudLayerVertex_glsl,"__esModule",{value:!0}),pointCloudLayerVertex_glsl.default=void 0,pointCloudLayerVertex_glsl.default="#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),pointCloudLayerVertex_glsl}var pointCloudLayerFragment_glsl={},hasRequiredPointCloudLayerFragment_glsl,hasRequiredPointCloudLayer;function requirePointCloudLayerFragment_glsl(){return hasRequiredPointCloudLayerFragment_glsl||(hasRequiredPointCloudLayerFragment_glsl=1,Object.defineProperty(pointCloudLayerFragment_glsl,"__esModule",{value:!0}),pointCloudLayerFragment_glsl.default=void 0,pointCloudLayerFragment_glsl.default="#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),pointCloudLayerFragment_glsl}function requirePointCloudLayer(){if(hasRequiredPointCloudLayer)return pointCloudLayer;hasRequiredPointCloudLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(pointCloudLayer,"__esModule",{value:!0}),pointCloudLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$g,u=es5$d,c=e(requirePointCloudLayerVertex_glsl()),d=e(requirePointCloudLayerFragment_glsl());function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=[0,0,0,255],m=[0,0,1],g={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(e){return e.position}},getNormal:{type:"accessor",value:m},getColor:{type:"accessor",value:p},material:!0,radiusPixels:{deprecatedFor:"pointSize"}},_=function(e){(0,i.default)(_,e);var s,h,g=(s=_,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(s);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function _(){return(0,t.default)(this,_),g.apply(this,arguments)}return(0,r.default)(_,[{key:"getShaders",value:function(){return(0,n.default)((0,o.default)(_.prototype),"getShaders",this).call(this,{vs:c.default,fs:d.default,modules:[l.project32,l.gouraudLighting,l.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:m},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:p}})}},{key:"updateState",value:function(e){var t,r,i,a=e.changeFlags,s=e.props;if((0,n.default)((0,o.default)(_.prototype),"updateState",this).call(this,e),a.extensionsChanged){var l,u=this.context.gl;null===(l=this.state.model)||void 0===l||l.delete(),this.state.model=this._getModel(u),this.getAttributeManager().invalidateAll()}a.dataChanged&&(i=(t=s.data).attributes,(r=t.header)&&i&&(t.length=r.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0&&(i.instanceColors=i.COLOR_0)))}},{key:"draw",value:function(e){var t=this.props,r=t.pointSize,n=t.sizeUnits;this.state.model.setUniforms(e.uniforms).setUniforms({sizeUnits:l.UNIT[n],radiusPixels:r}).draw()}},{key:"_getModel",value:function(e){for(var t=[],r=0;r<3;r++){var n=r/3*Math.PI*2;t.push(2*Math.cos(n),2*Math.sin(n),0)}return new u.Model(e,f(f({},this.getShaders()),{},{id:this.props.id,geometry:new u.Geometry({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}]),_}(l.Layer);return pointCloudLayer.default=_,(0,s.default)(_,"layerName","PointCloudLayer"),(0,s.default)(_,"defaultProps",g),pointCloudLayer}var scatterplotLayer={},scatterplotLayerVertex_glsl={},hasRequiredScatterplotLayerVertex_glsl;function requireScatterplotLayerVertex_glsl(){return hasRequiredScatterplotLayerVertex_glsl||(hasRequiredScatterplotLayerVertex_glsl=1,Object.defineProperty(scatterplotLayerVertex_glsl,"__esModule",{value:!0}),scatterplotLayerVertex_glsl.default=void 0,scatterplotLayerVertex_glsl.default="#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\n  unitPosition = edgePadding * positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = edgePadding * positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n"),scatterplotLayerVertex_glsl}var scatterplotLayerFragment_glsl={},hasRequiredScatterplotLayerFragment_glsl,hasRequiredScatterplotLayer;function requireScatterplotLayerFragment_glsl(){return hasRequiredScatterplotLayerFragment_glsl||(hasRequiredScatterplotLayerFragment_glsl=1,Object.defineProperty(scatterplotLayerFragment_glsl,"__esModule",{value:!0}),scatterplotLayerFragment_glsl.default=void 0,scatterplotLayerFragment_glsl.default="#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (!filled) {\n    discard;\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),scatterplotLayerFragment_glsl}function requireScatterplotLayer(){if(hasRequiredScatterplotLayer)return scatterplotLayer;hasRequiredScatterplotLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(scatterplotLayer,"__esModule",{value:!0}),scatterplotLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$g,u=es5$d,c=e(requireScatterplotLayerVertex_glsl()),d=e(requireScatterplotLayerFragment_glsl());function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=[0,0,0,255],m={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:p},getLineColor:{type:"accessor",value:p},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},g=function(e){(0,i.default)(m,e);var s,h,p=(s=m,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(s);if(h){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function m(){return(0,t.default)(this,m),p.apply(this,arguments)}return(0,r.default)(m,[{key:"getShaders",value:function(){return(0,n.default)((0,o.default)(m.prototype),"getShaders",this).call(this,{vs:c.default,fs:d.default,modules:[l.project32,l.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){if((0,n.default)((0,o.default)(m.prototype),"updateState",this).call(this,e),e.changeFlags.extensionsChanged){var t,r=this.context.gl;null===(t=this.state.model)||void 0===t||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=this.props,r=t.radiusUnits,n=t.radiusScale,i=t.radiusMinPixels,a=t.radiusMaxPixels,o=t.stroked,s=t.filled,u=t.billboard,c=t.antialiasing,d=t.lineWidthUnits,h=t.lineWidthScale,f=t.lineWidthMinPixels,p=t.lineWidthMaxPixels;this.state.model.setUniforms(e.uniforms).setUniforms({stroked:o?1:0,filled:s,billboard:u,antialiasing:c,radiusUnits:l.UNIT[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:a,lineWidthUnits:l.UNIT[d],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:p}).draw()}},{key:"_getModel",value:function(e){return new u.Model(e,f(f({},this.getShaders()),{},{id:this.props.id,geometry:new u.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0}))}}]),m}(l.Layer);return scatterplotLayer.default=g,(0,s.default)(g,"defaultProps",m),(0,s.default)(g,"layerName","ScatterplotLayer"),scatterplotLayer}var columnLayer={},columnGeometry={},es5$3={},polygon$2={},polygonUtils={},hasRequiredPolygonUtils,hasRequiredPolygon$2;function requirePolygonUtils(){if(hasRequiredPolygonUtils)return polygonUtils;hasRequiredPolygonUtils=1,Object.defineProperty(polygonUtils,"__esModule",{value:!0}),polygonUtils.modifyPolygonWindingDirection=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t(e,n)!==r&&(function(e,t){for(var r=t.start,n=void 0===r?0:r,i=t.end,a=t.size,o=void 0===a?2:a,s=((void 0===i?e.length:i)-n)/o,l=Math.floor(s/2),u=0;u<l;++u)for(var c=n+u*o,d=n+(s-1-u)*o,h=0;h<o;++h){var f=e[c+h];e[c+h]=e[d+h],e[d+h]=f}}(e,n),!0)},polygonUtils.getPolygonWindingDirection=t,polygonUtils.getPolygonSignedArea=r,polygonUtils.forEachSegmentInPolygon=function(t,r){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.start,a=void 0===i?0:i,o=n.end,s=n.size,l=void 0===s?2:s,u=n.isClosed,c=((void 0===o?t.length:o)-a)/l,d=0;d<c-1;++d)r(t[a+d*l],t[a+d*l+1],t[a+(d+1)*l],t[a+(d+1)*l+1],d,d+1);var h=a+(c-1)*l;u||(0,e.equals)(t[a],t[h])&&(0,e.equals)(t[a+1],t[h+1])||r(t[h],t[h+1],t[a],t[a+1],c-1,0)},polygonUtils.modifyPolygonWindingDirectionPoints=function(e,t){return n(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})!==t&&(e.reverse(),!0)},polygonUtils.getPolygonWindingDirectionPoints=n,polygonUtils.getPolygonSignedAreaPoints=i,polygonUtils.forEachSegmentInPolygonPoints=function(t,r){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.start,a=n.end,o=void 0===a?t.length:a,s=n.isClosed,l=void 0===i?0:i;l<o-1;++l)r(t[l],t[l+1],l,l+1);s||(0,e.equals)(t[o-1],t[0])||r(t[o-1],t[0],o-1,0)},polygonUtils.WINDING=void 0;var e=es5$q;function t(e){return Math.sign(r(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}function r(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.start,n=t.end,i=void 0===n?e.length:n,a=t.size||2,o=0,s=void 0===r?0:r,l=i-a;s<i;s+=a)o+=(e[s]-e[l])*(e[s+1]+e[l+1]),l=s;return o/2}function n(e){return Math.sign(i(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}function i(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.start,n=t.end,i=void 0===n?e.length:n,a=0,o=void 0===r?0:r,s=i-1;o<i;++o)a+=(e[o][0]-e[s][0])*(e[o][1]+e[s][1]),s=o;return a/2}return polygonUtils.WINDING={CLOCKWISE:1,COUNTER_CLOCKWISE:-1},polygonUtils}function requirePolygon$2(){if(hasRequiredPolygon$2)return polygon$2;hasRequiredPolygon$2=1;var e=interopRequireDefaultExports;Object.defineProperty(polygon$2,"__esModule",{value:!0}),polygon$2.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$q,a=requirePolygonUtils(),o=function(){function e(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),(0,n.default)(this,"points",void 0),(0,n.default)(this,"isFlatArray",void 0),(0,n.default)(this,"options",void 0),this.points=r,this.isFlatArray=!(0,i.isArray)(r[0]),this.options={start:a.start||0,end:a.end||r.length,size:a.size||2,isClosed:a.isClosed},Object.freeze(this)}return(0,r.default)(e,[{key:"getSignedArea",value:function(){return this.isFlatArray?(0,a.getPolygonSignedArea)(this.points,this.options):(0,a.getPolygonSignedAreaPoints)(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(e){this.isFlatArray?(0,a.forEachSegmentInPolygon)(this.points,(function(t,r,n,i,a,o){e([t,r],[n,i],a,o)}),this.options):(0,a.forEachSegmentInPolygonPoints)(this.points,e,this.options)}},{key:"modifyWindingDirection",value:function(e){return this.isFlatArray?(0,a.modifyPolygonWindingDirection)(this.points,e,this.options):(0,a.modifyPolygonWindingDirectionPoints)(this.points,e,this.options)}}]),e}();return polygon$2.default=o,polygon$2}var earcut$1={},hasRequiredEarcut$1;function requireEarcut$1(){if(hasRequiredEarcut$1)return earcut$1;hasRequiredEarcut$1=1,Object.defineProperty(earcut$1,"__esModule",{value:!0}),earcut$1.earcut=function(e,i){var a,o,s,c,d,f,p,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,g=arguments.length>3?arguments[3]:void 0,_=i&&i.length,y=_?i[0]*m:e.length,v=t(e,0,y,m,!0,g&&g[0]),b=[];if(!v||v.next===v.prev)return b;if(_&&(v=function(e,n,i,a,o){var s,c,d,f=[];for(s=0,c=n.length;s<c;s++)(d=t(e,n[s]*a,s<c-1?n[s+1]*a:e.length,a,!1,o&&o[s+1]))===d.next&&(d.steiner=!0),f.push(h(d));for(f.sort(l),s=0;s<f.length;s++)u(f[s],i),i=r(i,i.next);return i}(e,i,v,m,g)),e.length>80*m){c=o=e[0],d=s=e[1];for(var x=m;x<y;x+=m)(f=e[x])<c&&(c=f),(p=e[x+1])<d&&(d=p),f>o&&(o=f),p>s&&(s=p);a=0!==(a=Math.max(o-c,s-d))?1/a:0}return n(v,b,m,c,d,a),b};var e=requirePolygonUtils();function t(t,r,n,i,a,o){var s,l;if(void 0===o&&(o=(0,e.getPolygonSignedArea)(t,{start:r,end:n,size:i})),a===o<0)for(s=r;s<n;s+=i)l=T(s,t[s],t[s+1],l);else for(s=n-i;s>=r;s-=i)l=T(s,t[s],t[s+1],l);return l&&g(l,l.next)&&(w(l),l=l.next),l}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==m(n.prev,n,n.next))n=n.next;else{if(w(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,c,h,f){if(e){!f&&h&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=d(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(i=e,e=null,l=null,n=0;i;){for(n++,o=i,a=0,r=0;r<u&&(a++,o=o.nextZ);r++);for(s=u;a>0||s>0&&o;)0!==a&&(0===s||!o||i.z<=o.z)?(t=i,i=i.nextZ,a--):(t=o,o=o.nextZ,s--),l?l.nextZ=t:e=t,t.prevZ=l,l=t;i=o}l.nextZ=null,u*=2}while(n>1)}(i)}(e,u,c,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?a(e,u,c,h):i(e))t.push(p.i/l),t.push(e.i/l),t.push(m.i/l),w(e),e=m.next,g=m.next;else if((e=m)===g){f?1===f?n(e=o(r(e),t,l),t,l,u,c,h,2):2===f&&s(e,t,l,u,c,h):n(r(e),t,l,u,c,h,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(m(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(f(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,o=e.next;if(m(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,u=d(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,r,n),c=d(s,l,t,r,n),h=e.prevZ,p=e.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&m(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==e.prev&&h!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&m(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==e.prev&&p!==e.next&&f(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&m(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function o(e,t,n){var i=e;do{var a=i.prev,o=i.next.next;!g(a,o)&&_(a,i,i.next,o)&&b(a,o)&&b(o,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(o.i/n),w(i),w(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function s(e,t,i,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&p(l,u)){var c=x(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,a,o,s),void n(c,t,i,a,o,s)}u=u.next}l=l.next}while(l!==e)}function l(e,t){return e.x-t.x}function u(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r;var l,u=r,d=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=d&&i!==n.x&&f(a<h?i:o,a,d,h,a<h?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),b(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&c(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(e,t),t){var n=x(t,e);r(t,t.next),r(n,n.next)}}function c(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function d(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function f(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&_(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||g(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,r,n){var i=v(m(e,t,r)),a=v(m(e,t,n)),o=v(m(r,n,e)),s=v(m(r,n,t));return i!==a&&o!==s||!(0!==i||!y(e,r,t))||!(0!==a||!y(e,n,t))||!(0!==o||!y(r,e,n))||!(0!==s||!y(r,t,n))}function y(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function v(e){return e>0?1:e<0?-1:0}function b(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function x(e,t){var r=new E(e.i,e.x,e.y),n=new E(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function T(e,t,r,n){var i=new E(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return earcut$1}var lineclip={},utils$2={},hasRequiredUtils$2,hasRequiredLineclip;function requireUtils$2(){return hasRequiredUtils$2||(hasRequiredUtils$2=1,Object.defineProperty(utils$2,"__esModule",{value:!0}),utils$2.push=function(e,t){var r=t.length,n=e.length;if(n>0){for(var i=!0,a=0;a<r;a++)if(e[n-r+a]!==t[a]){i=!1;break}if(i)return!1}for(var o=0;o<r;o++)e[n+o]=t[o];return!0},utils$2.copy=function(e,t){for(var r=t.length,n=0;n<r;n++)e[n]=t[n]},utils$2.getPointAtIndex=function(e,t,r,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=n+t*r,o=0;o<r;o++)i[o]=e[a+o];return i}),utils$2}function requireLineclip(){if(hasRequiredLineclip)return lineclip;hasRequiredLineclip=1,Object.defineProperty(lineclip,"__esModule",{value:!0}),lineclip.clipPolyline=function(n,i,a){for(var o,s,l,u,c=a||{},d=c.size,h=void 0===d?2:d,f=c.startIndex,p=void 0===f?0:f,m=c.endIndex,g=((void 0===m?n.length:m)-p)/h,_=[],y=[],v=-1,b=1;b<g;b++){for(o=(0,e.getPointAtIndex)(n,b-1,h,p,o),s=(0,e.getPointAtIndex)(n,b,h,p,s),v<0&&(v=r(o,i)),l=u=r(s,i);;){if(!(v|l)){(0,e.push)(y,o),l!==u?((0,e.push)(y,s),b<g-1&&(_.push(y),y=[])):b===g-1&&(0,e.push)(y,s);break}if(v&l)break;v?(t(o,s,v,i,o),v=r(o,i)):(t(o,s,l,i,s),l=r(s,i))}v=u}return y.length&&_.push(y),_},lineclip.clipPolygon=function(n,i,a){for(var o,s,l,u,c,d=a||{},h=d.size,f=void 0===h?2:h,p=d.endIndex,m=(a||{}).startIndex,g=void 0===m?0:m,_=((void 0===p?n.length:p)-g)/f,y=1;y<=8;y*=2){o=[],c=!(r(l=(0,e.getPointAtIndex)(n,_-1,f,g,l),i)&y);for(var v=0;v<_;v++)(u=!(r(s=(0,e.getPointAtIndex)(n,v,f,g,s),i)&y))!==c&&(0,e.push)(o,t(l,s,y,i)),u&&(0,e.push)(o,s),(0,e.copy)(l,s),c=u;if(n=o,g=0,!(_=o.length/f))break}return o},lineclip.intersect=t,lineclip.bitCode=r;var e=requireUtils$2();function t(e,t,r,n){var i,a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(8&r)i=(n[3]-e[1])/(t[1]-e[1]),a=3;else if(4&r)i=(n[1]-e[1])/(t[1]-e[1]),a=1;else if(2&r)i=(n[2]-e[0])/(t[0]-e[0]),a=2;else{if(!(1&r))return null;i=(n[0]-e[0])/(t[0]-e[0]),a=0}for(var s=0;s<e.length;s++)o[s]=(1&a)===s?n[a]:i*(t[s]-e[s])+e[s];return o}function r(e,t){var r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}return lineclip}var cutByGrid={},hasRequiredCutByGrid;function requireCutByGrid(){if(hasRequiredCutByGrid)return cutByGrid;hasRequiredCutByGrid=1,Object.defineProperty(cutByGrid,"__esModule",{value:!0}),cutByGrid.cutPolylineByGrid=function(r,n){var i,a,l=n||{},u=l.size,c=void 0===u?2:u,d=l.broken,h=void 0!==d&&d,f=l.gridResolution,p=void 0===f?10:f,m=l.gridOffset,g=void 0===m?[0,0]:m,_=l.startIndex,y=void 0===_?0:_,v=l.endIndex,b=((void 0===v?r.length:v)-y)/c,x=[],T=[x],w=(0,t.getPointAtIndex)(r,0,c,y),E=o(w,p,g,[]),A=[];(0,t.push)(x,w);for(var S=1;S<b;S++){for(i=(0,t.getPointAtIndex)(r,S,c,y,i),a=(0,e.bitCode)(i,E);a;){(0,e.intersect)(w,i,a,E,A);var P=(0,e.bitCode)(A,E);P&&((0,e.intersect)(w,A,P,E,A),a=P),(0,t.push)(x,A),(0,t.copy)(w,A),s(E,p,a),h&&x.length>c&&(T.push(x=[]),(0,t.push)(x,w)),a=(0,e.bitCode)(i,E)}(0,t.push)(x,i),(0,t.copy)(w,i)}return h?T:T[0]},cutByGrid.cutPolygonByGrid=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t.length)return[];for(var s=(arguments.length>2?arguments[2]:void 0)||{},u=s.size,c=void 0===u?2:u,d=s.gridResolution,h=void 0===d?10:d,f=s.gridOffset,p=void 0===f?[0,0]:f,m=s.edgeTypes,g=void 0!==m&&m,_=[],y=[{pos:t,types:g?new Array(t.length/c).fill(n):null,holes:r||[]}],v=[[],[]],b=[];y.length;){var x=y.shift(),T=x.pos,w=x.types,E=x.holes;l(T,c,E[0]||T.length,v),b=o(v[0],h,p,b);var A=(0,e.bitCode)(v[1],b);if(A){var S=a(T,w,c,0,E[0]||T.length,b,A),P={pos:S[0].pos,types:S[0].types,holes:[]},M={pos:S[1].pos,types:S[1].types,holes:[]};y.push(P,M);for(var R=0;R<E.length;R++)(S=a(T,w,c,E[R],E[R+1]||T.length,b,A))[0]&&(P.holes.push(P.pos.length),P.pos=i(P.pos,S[0].pos),g&&(P.types=i(P.types,S[0].types))),S[1]&&(M.holes.push(M.pos.length),M.pos=i(M.pos,S[1].pos),g&&(M.types=i(M.types,S[1].types)))}else{var C={positions:T};g&&(C.edgeTypes=w),E.length&&(C.holeIndices=E),_.push(C)}}return _};var e=requireLineclip(),t=requireUtils$2(),r=0,n=1;function i(e,t){for(var r=0;r<t.length;r++)e.push(t[r]);return e}function a(n,i,a,o,s,l,u){for(var c,d,h,f=(s-o)/a,p=[],m=[],g=[],_=[],y=[],v=(0,t.getPointAtIndex)(n,f-1,a,o),b=Math.sign(8&u?v[1]-l[3]:v[0]-l[2]),x=i&&i[f-1],T=0,w=0,E=0;E<f;E++)c=(0,t.getPointAtIndex)(n,E,a,o,c),d=Math.sign(8&u?c[1]-l[3]:c[0]-l[2]),h=i&&i[o/a+E],d&&b&&b!==d&&((0,e.intersect)(v,c,u,l,y),(0,t.push)(p,y)&&g.push(x),(0,t.push)(m,y)&&_.push(x)),d<=0?((0,t.push)(p,c)&&g.push(h),T-=d):g.length&&(g[g.length-1]=r),d>=0?((0,t.push)(m,c)&&_.push(h),w+=d):_.length&&(_[_.length-1]=r),(0,t.copy)(v,c),b=d,x=h;return[T?{pos:p,types:i&&g}:null,w?{pos:m,types:i&&_}:null]}function o(e,t,r,n){var i=Math.floor((e[0]-r[0])/t)*t+r[0],a=Math.floor((e[1]-r[1])/t)*t+r[1];return n[0]=i,n[1]=a,n[2]=i+t,n[3]=a+t,n}function s(e,t,r){8&r?(e[1]+=t,e[3]+=t):4&r?(e[1]-=t,e[3]-=t):2&r?(e[0]+=t,e[2]+=t):1&r&&(e[0]-=t,e[2]-=t)}function l(e,t,r,n){for(var i=1/0,a=-1/0,o=1/0,s=-1/0,l=0;l<r;l+=t){var u=e[l],c=e[l+1];i=u<i?u:i,a=u>a?u:a,o=c<o?c:o,s=c>s?c:s}return n[0][0]=i,n[0][1]=o,n[1][0]=a,n[1][1]=s,n}return cutByGrid}var cutByMercatorBounds={},hasRequiredCutByMercatorBounds,hasRequiredEs5,hasRequiredColumnGeometry;function requireCutByMercatorBounds(){if(hasRequiredCutByMercatorBounds)return cutByMercatorBounds;hasRequiredCutByMercatorBounds=1,Object.defineProperty(cutByMercatorBounds,"__esModule",{value:!0}),cutByMercatorBounds.cutPolylineByMercatorBounds=function(t,n){var i=n||{},a=i.size,o=void 0===a?2:a,u=i.startIndex,c=void 0===u?0:u,d=i.endIndex,h=void 0===d?t.length:d,f=i.normalize,p=void 0===f||f,m=t.slice(c,h);s(m,o,0,h-c);var g=(0,e.cutPolylineByGrid)(m,{size:o,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(p){var _,y=r(g);try{for(y.s();!(_=y.n()).done;)l(_.value,o)}catch(e){y.e(e)}finally{y.f()}}return g},cutByMercatorBounds.cutPolygonByMercatorBounds=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,u=i||{},c=u.size,d=void 0===c?2:c,h=u.normalize,f=void 0===h||h,p=u.edgeTypes,m=void 0!==p&&p;n=n||[];for(var g=[],_=[],y=0,v=0,b=0;b<=n.length;b++){for(var x=n[b]||t.length,T=v,w=a(t,d,y,x),E=w;E<x;E++)g[v++]=t[E];for(var A=y;A<w;A++)g[v++]=t[A];s(g,d,T,v),o(g,d,T,v,null==i?void 0:i.maxLatitude),y=x,_[b]=v}_.pop();var S=(0,e.cutPolygonByGrid)(g,_,{size:d,gridResolution:360,gridOffset:[-180,-180],edgeTypes:m});if(f){var P,M=r(S);try{for(M.s();!(P=M.n()).done;)l(P.value.positions,d)}catch(e){M.e(e)}finally{M.f()}}return S};var e=requireCutByGrid(),t=requireUtils$2();function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=85.051129;function a(e,t,r,n){for(var i=-1,a=-1,o=r+1;o<n;o+=t){var s=Math.abs(e[o]);s>i&&(i=s,a=o-1)}return a}function o(e,r,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i,s=e[n],l=e[a-r];if(Math.abs(s-l)>180){var u=(0,t.getPointAtIndex)(e,0,r,n);u[0]+=360*Math.round((l-s)/360),(0,t.push)(e,u),u[1]=Math.sign(u[1])*o,(0,t.push)(e,u),u[0]=s,(0,t.push)(e,u)}}function s(e,t,r,n){for(var i,a=e[0],o=r;o<n;o+=t){var s=(i=e[o])-a;(s>180||s<-180)&&(i-=360*Math.round(s/360)),e[o]=a=i}}function l(e,t){for(var r,n=e.length/t,i=0;i<n&&((r=e[i*t])+180)%360==0;i++);var a=360*-Math.round(r/360);if(0!==a)for(var o=0;o<n;o++)e[o*t]+=a}return cutByMercatorBounds}function requireEs5(){return hasRequiredEs5||(hasRequiredEs5=1,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"_Polygon",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"getPolygonSignedArea",{enumerable:!0,get:function(){return n.getPolygonSignedArea}}),Object.defineProperty(e,"getPolygonWindingDirection",{enumerable:!0,get:function(){return n.getPolygonWindingDirection}}),Object.defineProperty(e,"forEachSegmentInPolygon",{enumerable:!0,get:function(){return n.forEachSegmentInPolygon}}),Object.defineProperty(e,"modifyPolygonWindingDirection",{enumerable:!0,get:function(){return n.modifyPolygonWindingDirection}}),Object.defineProperty(e,"WINDING",{enumerable:!0,get:function(){return n.WINDING}}),Object.defineProperty(e,"earcut",{enumerable:!0,get:function(){return i.earcut}}),Object.defineProperty(e,"clipPolygon",{enumerable:!0,get:function(){return a.clipPolygon}}),Object.defineProperty(e,"clipPolyline",{enumerable:!0,get:function(){return a.clipPolyline}}),Object.defineProperty(e,"cutPolygonByGrid",{enumerable:!0,get:function(){return o.cutPolygonByGrid}}),Object.defineProperty(e,"cutPolylineByGrid",{enumerable:!0,get:function(){return o.cutPolylineByGrid}}),Object.defineProperty(e,"cutPolylineByMercatorBounds",{enumerable:!0,get:function(){return s.cutPolylineByMercatorBounds}}),Object.defineProperty(e,"cutPolygonByMercatorBounds",{enumerable:!0,get:function(){return s.cutPolygonByMercatorBounds}});var r=t(requirePolygon$2()),n=requirePolygonUtils(),i=requireEarcut$1(),a=requireLineclip(),o=requireCutByGrid(),s=requireCutByMercatorBounds()}(es5$3)),es5$3}function requireColumnGeometry(){if(hasRequiredColumnGeometry)return columnGeometry;hasRequiredColumnGeometry=1;var e=interopRequireDefaultExports;Object.defineProperty(columnGeometry,"__esModule",{value:!0}),columnGeometry.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=es5$g,s=es5$d,l=requireEs5();function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(e){(0,n.default)(h,e);var t,u,d=(t=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,a.default)(t);if(u){var n=(0,a.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,i.default)(this,e)});function h(e){(0,r.default)(this,h);var t=e.id,n=void 0===t?(0,s.uid)("column-geometry"):t,i=function(e){var t=e.radius,r=e.height,n=void 0===r?1:r,i=e.nradial,a=void 0===i?10:i,s=e.vertices;s&&(o.log.assert(s.length>=a),s=s.flatMap((function(e){return[e[0],e[1]]})),(0,l.modifyPolygonWindingDirection)(s,l.WINDING.COUNTER_CLOCKWISE));var u=n>0,c=a+1,d=u?3*c+1:a,h=2*Math.PI/a,f=new Uint16Array(u?3*a*2:0),p=new Float32Array(3*d),m=new Float32Array(3*d),g=0;if(u){for(var _=0;_<c;_++)for(var y=_*h,v=_%a,b=Math.sin(y),x=Math.cos(y),T=0;T<2;T++)p[g+0]=s?s[2*v]:x*t,p[g+1]=s?s[2*v+1]:b*t,p[g+2]=(.5-T)*n,m[g+0]=s?s[2*v]:x,m[g+1]=s?s[2*v+1]:b,g+=3;p[g+0]=p[g-3],p[g+1]=p[g-2],p[g+2]=p[g-1],g+=3}for(var w=u?0:1;w<c;w++){var E=Math.floor(w/2)*Math.sign(.5-w%2),A=E*h,S=(E+a)%a,P=Math.sin(A),M=Math.cos(A);p[g+0]=s?s[2*S]:M*t,p[g+1]=s?s[2*S+1]:P*t,p[g+2]=n/2,m[g+2]=1,g+=3}if(u)for(var R=0,C=0;C<a;C++)f[R++]=2*C+0,f[R++]=2*C+2,f[R++]=2*C+0,f[R++]=2*C+1,f[R++]=2*C+1,f[R++]=2*C+3;return{indices:f,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:m}}}}(e),a=i.indices,u=i.attributes;return d.call(this,c(c({},e),{},{id:n,indices:a,attributes:u}))}return h}(s.Geometry);return columnGeometry.default=d,columnGeometry}var columnLayerVertex_glsl={},hasRequiredColumnLayerVertex_glsl;function requireColumnLayerVertex_glsl(){return hasRequiredColumnLayerVertex_glsl||(hasRequiredColumnLayerVertex_glsl=1,Object.defineProperty(columnLayerVertex_glsl,"__esModule",{value:!0}),columnLayerVertex_glsl.default=void 0,columnLayerVertex_glsl.default="#version 300 es\n\n#define SHADER_NAME column-layer-vertex-shader\n\nin vec3 positions;\nin vec3 normals;\n\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\n\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool stroked;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int radiusUnits;\nuniform int widthUnits;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec4 position_commonspace;\n#endif\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (stroked) {\n    float widthPixels = clamp(\n      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n    if (isStroke) {\n      strokeOffsetRatio -= sign(positions.z) * halfOffset;\n    } else {\n      strokeOffsetRatio -= halfOffset;\n    }\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;\n  if (radiusUnits == UNIT_METERS) {\n    offset = project_size(offset);\n  }\n  vec3 pos = vec3(offset, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n#ifdef FLAT_SHADING\n    position_commonspace = geometry.position;\n    vColor = vec4(color.rgb, color.a * opacity);\n#else\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n#endif\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),columnLayerVertex_glsl}var columnLayerFragment_glsl={},hasRequiredColumnLayerFragment_glsl,hasRequiredColumnLayer;function requireColumnLayerFragment_glsl(){return hasRequiredColumnLayerFragment_glsl||(hasRequiredColumnLayerFragment_glsl=1,Object.defineProperty(columnLayerFragment_glsl,"__esModule",{value:!0}),columnLayerFragment_glsl.default=void 0,columnLayerFragment_glsl.default="#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nuniform vec3 project_uCameraPosition;\nuniform bool extruded;\nuniform bool isStroke;\n\nout vec4 fragColor;\n\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec4 position_commonspace;\n#endif\n\nvoid main(void) {\n  fragColor = vColor;\n#ifdef FLAT_SHADING\n  if (extruded && !isStroke && !picking_uActive) {\n    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n  }\n#endif\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"),columnLayerFragment_glsl}function requireColumnLayer(){if(hasRequiredColumnLayer)return columnLayer;hasRequiredColumnLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(columnLayer,"__esModule",{value:!0}),columnLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$g,u=es5$d,c=e(requireColumnGeometry()),d=e(requireColumnLayerVertex_glsl()),h=e(requireColumnLayerFragment_glsl());function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=[0,0,0,255],g={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:m},getLineColor:{type:"accessor",value:m},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},_=function(e){(0,i.default)(_,e);var s,f,g=(s=_,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(s);if(f){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function _(){return(0,t.default)(this,_),g.apply(this,arguments)}return(0,r.default)(_,[{key:"getShaders",value:function(){var e=this.context.gl,t=!(0,u.isWebGL2)(e),r={},i=this.props.flatShading&&(0,u.hasFeature)(e,u.FEATURES.GLSL_DERIVATIVES);return i&&(r.FLAT_SHADING=1),(0,n.default)((0,o.default)(_.prototype),"getShaders",this).call(this,{vs:d.default,fs:h.default,defines:r,transpileToGLSL100:t,modules:[l.project32,i?l.phongLighting:l.gouraudLighting,l.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:m},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:m},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){(0,n.default)((0,o.default)(_.prototype),"updateState",this).call(this,e);var t=e.props,r=e.oldProps,i=e.changeFlags.extensionsChanged||t.flatShading!==r.flatShading;if(i){var a,s=this.context.gl;null===(a=this.state.model)||void 0===a||a.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}(i||t.diskResolution!==r.diskResolution||t.vertices!==r.vertices||(t.extruded||t.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(t)}},{key:"getGeometry",value:function(e,t,r){var n=new c.default({radius:1,height:r?2:0,vertices:t,nradial:e}),i=0;if(t)for(var a=0;a<e;a++){var o=t[a];i+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new u.Model(e,p(p({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(e){var t=this.getGeometry(e.diskResolution,e.vertices,e.extruded||e.stroked);this.setState({fillVertexCount:t.attributes.POSITION.value.length/3,wireframeVertexCount:t.indices.value.length}),this.state.model.setProps({geometry:t})}},{key:"draw",value:function(e){var t=this.props,r=t.lineWidthUnits,n=t.lineWidthScale,i=t.lineWidthMinPixels,a=t.lineWidthMaxPixels,o=t.radiusUnits,s=t.elevationScale,u=t.extruded,c=t.filled,d=t.stroked,h=t.wireframe,f=t.offset,p=t.coverage,m=t.radius,g=t.angle,_=this.state,y=_.model,v=_.fillVertexCount,b=_.wireframeVertexCount,x=_.edgeDistance;y.setUniforms(e.uniforms).setUniforms({radius:m,angle:g/180*Math.PI,offset:f,extruded:u,stroked:d,coverage:p,elevationScale:s,edgeDistance:x,radiusUnits:l.UNIT[o],widthUnits:l.UNIT[r],widthScale:n,widthMinPixels:i,widthMaxPixels:a}),u&&h&&(y.setProps({isIndexed:!0}),y.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(y.setProps({isIndexed:!1}),y.setVertexCount(v).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&d&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*v/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),_}(l.Layer);return columnLayer.default=_,(0,s.default)(_,"layerName","ColumnLayer"),(0,s.default)(_,"defaultProps",g),columnLayer}var gridCellLayer={},hasRequiredGridCellLayer;function requireGridCellLayer(){if(hasRequiredGridCellLayer)return gridCellLayer;hasRequiredGridCellLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(gridCellLayer,"__esModule",{value:!0}),gridCellLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireInherits()),i=e(requirePossibleConstructorReturn()),a=e(requireGetPrototypeOf()),o=e(requireDefineProperty()),s=es5$d,l=es5$g,u=function(e){(0,n.default)(d,e);var o,u,c=(o=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,a.default)(o);if(u){var r=(0,a.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.default)(this,e)});function d(){return(0,t.default)(this,d),c.apply(this,arguments)}return(0,r.default)(d,[{key:"getGeometry",value:function(e){return new s.CubeGeometry}},{key:"draw",value:function(e){var t=this.props,r=t.elevationScale,n=t.extruded,i=t.offset,a=t.coverage,o=t.cellSize,s=t.angle,u=t.radiusUnits;this.state.model.setUniforms(e.uniforms).setUniforms({radius:o/2,radiusUnits:l.UNIT[u],angle:s,offset:i,extruded:n,coverage:a,elevationScale:r,edgeDistance:1,isWireframe:!1}).draw()}}]),d}(e(requireColumnLayer()).default);return gridCellLayer.default=u,(0,o.default)(u,"layerName","GridCellLayer"),(0,o.default)(u,"defaultProps",{cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}}),gridCellLayer}var pathLayer={},pathTesselator={},path={},hasRequiredPath,hasRequiredPathTesselator;function requirePath(){if(hasRequiredPath)return path;hasRequiredPath=1,Object.defineProperty(path,"__esModule",{value:!0}),path.normalizePath=function(t,r,n,i){var a;if(Array.isArray(t[0])){a=new Array(t.length*r);for(var o=0;o<t.length;o++)for(var s=0;s<r;s++)a[o*r+s]=t[o][s]||0}else a=t;return n?(0,e.cutPolylineByGrid)(a,{size:r,gridResolution:n}):i?(0,e.cutPolylineByMercatorBounds)(a,{size:r}):a};var e=requireEs5();return path}function requirePathTesselator(){if(hasRequiredPathTesselator)return pathTesselator;hasRequiredPathTesselator=1;var e=interopRequireDefaultExports;Object.defineProperty(pathTesselator,"__esModule",{value:!0}),pathTesselator.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=es5$g,u=requirePath();function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?h(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){(0,a.default)(h,e);var t,l,d=(t=h,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);if(l){var n=(0,s.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,o.default)(this,e)});function h(e){return(0,r.default)(this,h),d.call(this,f(f({},e),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return(0,n.default)(h,[{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometryFromBuffer",value:function(e){return this.normalize?(0,i.default)((0,s.default)(h.prototype),"getGeometryFromBuffer",this).call(this,e):null}},{key:"normalizeGeometry",value:function(e){return this.normalize?(0,u.normalizePath)(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}},{key:"getGeometrySize",value:function(e){if(m(e)){var t,r=0,n=c(e);try{for(n.s();!(t=n.n()).done;)r+=this.getGeometrySize(t.value)}catch(e){n.e(e)}finally{n.f()}return r}var i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}},{key:"updateGeometryAttributes",value:function(e,t){if(0!==t.geometrySize)if(e&&m(e)){var r,n=c(e);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=this.getGeometrySize(i);t.geometrySize=a,this.updateGeometryAttributes(i,t),t.vertexStart+=a}}catch(e){n.e(e)}finally{n.f()}}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}},{key:"_updateSegmentTypes",value:function(e,t){var r=this.attributes.segmentTypes,n=!!e&&this.isClosed(e),i=t.vertexStart,a=t.geometrySize;r.fill(0,i,i+a),n?(r[i]=4,r[i+a-2]=4):(r[i]+=1,r[i+a-2]+=2),r[i+a-1]=4}},{key:"_updatePositions",value:function(e,t){var r=this.attributes.positions;if(r&&e)for(var n=t.vertexStart,i=t.geometrySize,a=new Array(3),o=n,s=0;s<i;o++,s++)this.getPointOnPath(e,s,a),r[3*o]=a[0],r[3*o+1]=a[1],r[3*o+2]=a[2]}},{key:"getPathLength",value:function(e){return e.length/this.positionSize}},{key:"getPointOnPath",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this.positionSize;t*n>=e.length&&(t+=1-e.length/n);var i=t*n;return r[0]=e[i],r[1]=e[i+1],r[2]=3===n&&e[i+2]||0,r}},{key:"isClosed",value:function(e){if(!this.normalize)return Boolean(this.opts.loop);var t=this.positionSize,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(2===t||e[2]===e[r+2])}}]),h}(l.Tesselator);function m(e){return Array.isArray(e[0])}return pathTesselator.default=p,pathTesselator}var pathLayerVertex_glsl={},hasRequiredPathLayerVertex_glsl;function requirePathLayerVertex_glsl(){return hasRequiredPathLayerVertex_glsl||(hasRequiredPathLayerVertex_glsl=1,Object.defineProperty(pathLayerVertex_glsl,"__esModule",{value:!0}),pathLayerVertex_glsl.default=void 0,pathLayerVertex_glsl.default="#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 offset = getLineJoinOffset(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\n    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\n    geometry.position = vec4(currPosition + offset, 1.0);\n    gl_Position = project_common_position_to_clipspace(geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),pathLayerVertex_glsl}var pathLayerFragment_glsl={},hasRequiredPathLayerFragment_glsl,hasRequiredPathLayer;function requirePathLayerFragment_glsl(){return hasRequiredPathLayerFragment_glsl||(hasRequiredPathLayerFragment_glsl=1,Object.defineProperty(pathLayerFragment_glsl,"__esModule",{value:!0}),pathLayerFragment_glsl.default=void 0,pathLayerFragment_glsl.default="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),pathLayerFragment_glsl}function requirePathLayer(){if(hasRequiredPathLayer)return pathLayer;hasRequiredPathLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(pathLayer,"__esModule",{value:!0}),pathLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=e(requirePathTesselator()),h=e(requirePathLayerVertex_glsl()),f=e(requirePathLayerFragment_glsl());function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=[0,0,0,255],_={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:g},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},y={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},v=function(e){(0,a.default)(b,e);var p,_,v=(p=b,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(p);if(_){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function b(){var e;(0,t.default)(this,b);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(b,[{key:"getShaders",value:function(){return(0,i.default)((0,s.default)(b.prototype),"getShaders",this).call(this,{vs:h.default,fs:f.default,modules:[u.project32,u.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:y,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:y,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:y,defaultValue:g},instancePickingColors:{size:3,type:5121,accessor:function(t,r){return e.encodePickingColor(t&&t.__source?t.__source.index:r.index,r.target)}}}),this.setState({pathTesselator:new d.default({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(b.prototype),"updateState",this).call(this,e);var t=e.props,r=e.changeFlags,n=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){var a=this.state.pathTesselator,o=t.data.attributes||{};a.updateGeometry({data:t.data,geometryBuffer:o.getPath,buffers:o,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||n.invalidateAll()}if(r.extensionsChanged){var l,u=this.context.gl;null===(l=this.state.model)||void 0===l||l.delete(),this.state.model=this._getModel(u),n.invalidateAll()}}},{key:"getPickingInfo",value:function(e){var t=(0,i.default)((0,s.default)(b.prototype),"getPickingInfo",this).call(this,e),r=t.index,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find((function(e){return e.__source.index===r}))),t}},{key:"disablePickingIndex",value:function(e){var t=this.props.data;if(t[0]&&t[0].__source)for(var r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else(0,i.default)((0,s.default)(b.prototype),"disablePickingIndex",this).call(this,e)}},{key:"draw",value:function(e){var t=this.props,r=t.jointRounded,n=t.capRounded,i=t.billboard,a=t.miterLimit,o=t.widthUnits,s=t.widthScale,l=t.widthMinPixels,c=t.widthMaxPixels;this.state.model.setUniforms(e.uniforms).setUniforms({jointType:Number(r),capType:Number(n),billboard:i,widthUnits:u.UNIT[o],widthScale:s,miterLimit:a,widthMinPixels:l,widthMaxPixels:c}).draw()}},{key:"_getModel",value:function(e){return new c.Model(e,m(m({},this.getShaders()),{},{id:this.props.id,geometry:new c.Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateSegmentTypes",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}]),b}(u.Layer);return pathLayer.default=v,(0,l.default)(v,"defaultProps",_),(0,l.default)(v,"layerName","PathLayer"),pathLayer}var polygonLayer={},solidPolygonLayer={},polygonTesselator={},polygon$1={},earcut={exports:{}},hasRequiredEarcut,hasRequiredPolygon$1,hasRequiredPolygonTesselator;function requireEarcut(){if(hasRequiredEarcut)return earcut.exports;function e(e,r,i){i=i||2;var a,o,s,c,d,f,p,m=r&&r.length,g=m?r[0]*i:e.length,_=t(e,0,g,i,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(e,r,n,i){var a,o,s,c=[];for(a=0,o=r.length;a<o;a++)(s=t(e,r[a]*i,a<o-1?r[a+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),c.push(h(s));for(c.sort(l),a=0;a<c.length;a++)n=u(c[a],n);return n}(e,r,_,i)),e.length>80*i){a=s=e[0],o=c=e[1];for(var v=i;v<g;v+=i)(d=e[v])<a&&(a=d),(f=e[v+1])<o&&(o=f),d>s&&(s=d),f>c&&(c=f);p=0!==(p=Math.max(s-a,c-o))?32767/p:0}return n(_,y,i,a,o,p,0),y}function t(e,t,r,n,i){var a,o;if(i===A(e,t,r,n)>0)for(a=t;a<r;a+=n)o=T(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=T(a,e[a],e[a+1],o);return o&&g(o,o.next)&&(w(o),o=o.next),o}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==m(n.prev,n,n.next))n=n.next;else{if(w(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,c,h,f){if(e){!f&&h&&function(e,t,r,n){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}(e,u,c,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?a(e,u,c,h):i(e))t.push(p.i/l|0),t.push(e.i/l|0),t.push(m.i/l|0),w(e),e=m.next,g=m.next;else if((e=m)===g){f?1===f?n(e=o(r(e),t,l),t,l,u,c,h,2):2===f&&s(e,t,l,u,c,h):n(r(e),t,l,u,c,h,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(m(t,r,n)>=0)return!1;for(var i=t.x,a=r.x,o=n.x,s=t.y,l=r.y,u=n.y,c=i<a?i<o?i:o:a<o?a:o,d=s<l?s<u?s:u:l<u?l:u,h=i>a?i>o?i:o:a>o?a:o,p=s>l?s>u?s:u:l>u?l:u,g=n.next;g!==t;){if(g.x>=c&&g.x<=h&&g.y>=d&&g.y<=p&&f(i,s,a,l,o,u,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,o=e.next;if(m(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,h=a.y,p=o.y,g=s<l?s<u?s:u:l<u?l:u,_=c<h?c<p?c:p:h<p?h:p,y=s>l?s>u?s:u:l>u?l:u,v=c>h?c>p?c:p:h>p?h:p,b=d(g,_,t,r,n),x=d(y,v,t,r,n),T=e.prevZ,w=e.nextZ;T&&T.z>=b&&w&&w.z<=x;){if(T.x>=g&&T.x<=y&&T.y>=_&&T.y<=v&&T!==i&&T!==o&&f(s,c,l,h,u,p,T.x,T.y)&&m(T.prev,T,T.next)>=0)return!1;if(T=T.prevZ,w.x>=g&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==o&&f(s,c,l,h,u,p,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;T&&T.z>=b;){if(T.x>=g&&T.x<=y&&T.y>=_&&T.y<=v&&T!==i&&T!==o&&f(s,c,l,h,u,p,T.x,T.y)&&m(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;w&&w.z<=x;){if(w.x>=g&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==o&&f(s,c,l,h,u,p,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function o(e,t,n){var i=e;do{var a=i.prev,o=i.next.next;!g(a,o)&&_(a,i,i.next,o)&&b(a,o)&&b(o,a)&&(t.push(a.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),w(i),w(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function s(e,t,i,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&p(l,u)){var c=x(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,a,o,s,0),void n(c,t,i,a,o,s,0)}u=u.next}l=l.next}while(l!==e)}function l(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o&&(o=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==t);if(!r)return null;var l,u=r,d=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=d&&i!==n.x&&f(a<h?i:o,a,d,h,a<h?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),b(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&c(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=x(n,e);return r(i,i.next),r(n,n.next)}function c(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function d(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function f(e,t,r,n,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(n-s)>=(r-o)*(t-s)&&(r-o)*(a-s)>=(i-o)*(n-s)}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&_(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||g(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,r,n){var i=v(m(e,t,r)),a=v(m(e,t,n)),o=v(m(r,n,e)),s=v(m(r,n,t));return i!==a&&o!==s||!(0!==i||!y(e,r,t))||!(0!==a||!y(e,n,t))||!(0!==o||!y(r,e,n))||!(0!==s||!y(r,t,n))}function y(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function v(e){return e>0?1:e<0?-1:0}function b(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function x(e,t){var r=new E(e.i,e.x,e.y),n=new E(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function T(e,t,r,n){var i=new E(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}return hasRequiredEarcut=1,earcut.exports=e,earcut.exports.default=e,e.deviation=function(e,t,r,n){var i=t&&t.length,a=Math.abs(A(e,0,i?t[0]*r:e.length,r));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(A(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r));var l=0;for(o=0;o<n.length;o+=3){var u=n[o]*r,c=n[o+1]*r,d=n[o+2]*r;l+=Math.abs((e[u]-e[d])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[d+1]-e[u+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&r.holes.push(n+=e[i-1].length)}return r},earcut.exports}function requirePolygon$1(){if(hasRequiredPolygon$1)return polygon$1;hasRequiredPolygon$1=1;var e=interopRequireDefaultExports;Object.defineProperty(polygon$1,"__esModule",{value:!0}),polygon$1.getPositions=l,polygon$1.getHoleIndices=u,polygon$1.normalize=function(e,r){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);var n=[],s=[];if("positions"in e){var l=e.positions,u=e.holeIndices;if(u){for(var h=0,f=0;f<=u.length;f++)h=d(n,h,l,r,u[f-1],u[f],0===f?a:o),s.push(h);return s.pop(),{positions:n,holeIndices:s}}e=l}if(!function(e){return Array.isArray(e[0])}(e))return d(n,0,e,r,0,n.length,a),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){var p,m=0,g=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}(e.entries());try{for(g.s();!(p=g.n()).done;){var _=(0,t.default)(p.value,2);m=c(n,m,_[1],r,0===_[0]?a:o),s.push(m)}}catch(e){g.e(e)}finally{g.f()}return s.pop(),{positions:n,holeIndices:s}}return c(n,0,e,r,a),n},polygon$1.getSurfaceIndices=function(e,t,n,i){var a=u(e);a&&(a=a.map((function(e){return e/t})));var o=l(e),s=i&&3===t;if(n){var c=o.length;o=o.slice();for(var d=[],p=0;p<c;p+=t){d[0]=o[p],d[1]=o[p+1],s&&(d[2]=o[p+2]);var m=n(d);o[p]=m[0],o[p+1]=m[1],s&&(o[p+2]=m[2])}}if(s){var g=h(o,0,1),_=h(o,0,2),y=h(o,1,2);if(!g&&!_&&!y)return[];g>_&&g>y||(_>y?(n||(o=o.slice()),f(o,0,2,1)):(n||(o=o.slice()),f(o,2,0,1)))}return(0,r.default)(o,a,t)};var t=e(requireSlicedToArray()),r=e(requireEarcut()),n=requireEs5();function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var a=n.WINDING.CLOCKWISE,o=n.WINDING.COUNTER_CLOCKWISE,s={isClosed:!0};function l(e){return"positions"in e?e.positions:e}function u(e){return"holeIndices"in e?e.holeIndices:null}function c(e,t,r,i,a){for(var o=t,l=r.length,u=0;u<l;u++)for(var c=0;c<i;c++)e[o++]=r[u][c]||0;if(!function(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}(r))for(var d=0;d<i;d++)e[o++]=r[0][d]||0;return s.start=t,s.end=o,s.size=i,(0,n.modifyPolygonWindingDirection)(e,a,s),o}function d(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,u=(o=o||r.length)-a;if(u<=0)return t;for(var c=t,d=0;d<u;d++)e[c++]=r[a+d];if(!function(e,t,r,n){for(var i=0;i<t;i++)if(e[r+i]!==e[n-t+i])return!1;return!0}(r,i,a,o))for(var h=0;h<i;h++)e[c++]=r[a+h];return s.start=t,s.end=c,s.size=i,(0,n.modifyPolygonWindingDirection)(e,l,s),c}function h(e,t,r){for(var n=e.length/3,i=0,a=0;a<n;a++){var o=(a+1)%n;i+=e[3*a+t]*e[3*o+r],i-=e[3*o+t]*e[3*a+r]}return Math.abs(i/2)}function f(e,t,r,n){for(var i=e.length/3,a=0;a<i;a++){var o=3*a,s=e[o+1],l=e[o+2];e[o+t]=e[o+0],e[o+r]=s,e[o+n]=l}}return polygon$1}function requirePolygonTesselator(){if(hasRequiredPolygonTesselator)return polygonTesselator;hasRequiredPolygonTesselator=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(polygonTesselator,"__esModule",{value:!0}),polygonTesselator.default=void 0;var r=e(requireDefineProperty()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireGet()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=h(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requirePolygon$1()),c=es5$g,d=requireEs5();function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(e){(0,o.default)(h,e);var t,r,c=(t=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,l.default)(t);if(r){var i=(0,l.default)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,s.default)(this,e)});function h(e){(0,n.default)(this,h);var t=e.fp64,r=e.IndexType,i=void 0===r?Uint32Array:r;return c.call(this,g(g({},e),{},{attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}}))}return(0,i.default)(h,[{key:"get",value:function(e){var t=this.attributes;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}},{key:"updateGeometry",value:function(e){(0,a.default)((0,l.default)(h.prototype),"updateGeometry",this).call(this,e);var t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(e){if(this.normalize){var t=u.normalize(e,this.positionSize);return this.opts.resolution?(0,d.cutPolygonByGrid)(u.getPositions(t),u.getHoleIndices(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?(0,d.cutPolygonByMercatorBounds)(u.getPositions(t),u.getHoleIndices(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}},{key:"getGeometrySize",value:function(e){if(y(e)){var t,r=0,n=f(e);try{for(n.s();!(t=n.n()).done;)r+=this.getGeometrySize(t.value)}catch(e){n.e(e)}finally{n.f()}return r}return u.getPositions(e).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(e){return this.normalize||!this.buffers.indices?(0,a.default)((0,l.default)(h.prototype),"getGeometryFromBuffer",this).call(this,e):null}},{key:"updateGeometryAttributes",value:function(e,t){if(e&&y(e)){var r,n=f(e);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=this.getGeometrySize(i);t.geometrySize=a,this.updateGeometryAttributes(i,t),t.vertexStart+=a,t.indexStart=this.indexStarts[t.geometryIndex+1]}}catch(e){n.e(e)}finally{n.f()}}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}},{key:"_updateIndices",value:function(e,t){var r=t.geometryIndex,n=t.vertexStart,i=t.indexStart,a=this.attributes,o=this.indexStarts,s=this.typedArrayManager,l=a.indices;if(l&&e){var c=i,d=u.getSurfaceIndices(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=s.allocate(l,i+d.length,{copy:!0});for(var h=0;h<d.length;h++)l[c++]=d[h]+n;o[r+1]=i+d.length,a.indices=l}}},{key:"_updatePositions",value:function(e,t){var r=t.vertexStart,n=t.geometrySize,i=this.attributes.positions,a=this.positionSize;if(i&&e)for(var o=u.getPositions(e),s=r,l=0;l<n;s++,l++){var c=o[l*a+1],d=a>2?o[l*a+2]:0;i[3*s]=o[l*a],i[3*s+1]=c,i[3*s+2]=d}}},{key:"_updateVertexValid",value:function(e,t){var r=t.vertexStart,n=t.geometrySize,i=this.positionSize,a=this.attributes.vertexValid,o=e&&u.getHoleIndices(e);if(e&&e.edgeTypes?a.set(e.edgeTypes,r):a.fill(1,r,r+n),o)for(var s=0;s<o.length;s++)a[r+o[s]/i-1]=0;a[r+n-1]=0}}]),h}(c.Tesselator);function y(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}return polygonTesselator.default=_,polygonTesselator}var solidPolygonLayerVertexTop_glsl={},solidPolygonLayerVertexMain_glsl={},hasRequiredSolidPolygonLayerVertexMain_glsl,hasRequiredSolidPolygonLayerVertexTop_glsl;function requireSolidPolygonLayerVertexMain_glsl(){return hasRequiredSolidPolygonLayerVertexMain_glsl||(hasRequiredSolidPolygonLayerVertexMain_glsl=1,Object.defineProperty(solidPolygonLayerVertexMain_glsl,"__esModule",{value:!0}),solidPolygonLayerVertexMain_glsl.default=void 0,solidPolygonLayerVertexMain_glsl.default="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n  #ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n  #else\n    normal = project_normal(vec3(0.0, 0.0, 1.0));\n  #endif\n    geometry.normal = normal;\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),solidPolygonLayerVertexMain_glsl}function requireSolidPolygonLayerVertexTop_glsl(){if(hasRequiredSolidPolygonLayerVertexTop_glsl)return solidPolygonLayerVertexTop_glsl;hasRequiredSolidPolygonLayerVertexTop_glsl=1;var e=interopRequireDefaultExports;Object.defineProperty(solidPolygonLayerVertexTop_glsl,"__esModule",{value:!0}),solidPolygonLayerVertexTop_glsl.default=void 0;var t=e(requireSolidPolygonLayerVertexMain_glsl()),r="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(t.default,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n");return solidPolygonLayerVertexTop_glsl.default=r,solidPolygonLayerVertexTop_glsl}var solidPolygonLayerVertexSide_glsl={},hasRequiredSolidPolygonLayerVertexSide_glsl;function requireSolidPolygonLayerVertexSide_glsl(){if(hasRequiredSolidPolygonLayerVertexSide_glsl)return solidPolygonLayerVertexSide_glsl;hasRequiredSolidPolygonLayerVertexSide_glsl=1;var e=interopRequireDefaultExports;Object.defineProperty(solidPolygonLayerVertexSide_glsl,"__esModule",{value:!0}),solidPolygonLayerVertexSide_glsl.default=void 0;var t=e(requireSolidPolygonLayerVertexMain_glsl()),r="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(t.default,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n");return solidPolygonLayerVertexSide_glsl.default=r,solidPolygonLayerVertexSide_glsl}var solidPolygonLayerFragment_glsl={},hasRequiredSolidPolygonLayerFragment_glsl,hasRequiredSolidPolygonLayer;function requireSolidPolygonLayerFragment_glsl(){return hasRequiredSolidPolygonLayerFragment_glsl||(hasRequiredSolidPolygonLayerFragment_glsl=1,Object.defineProperty(solidPolygonLayerFragment_glsl,"__esModule",{value:!0}),solidPolygonLayerFragment_glsl.default=void 0,solidPolygonLayerFragment_glsl.default="#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),solidPolygonLayerFragment_glsl}function requireSolidPolygonLayer(){if(hasRequiredSolidPolygonLayer)return solidPolygonLayer;hasRequiredSolidPolygonLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(solidPolygonLayer,"__esModule",{value:!0}),solidPolygonLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=e(requirePolygonTesselator()),h=e(requireSolidPolygonLayerVertexTop_glsl()),f=e(requireSolidPolygonLayerVertexSide_glsl()),p=e(requireSolidPolygonLayerFragment_glsl());function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=[0,0,0,255],y={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:_},getLineColor:{type:"accessor",value:_},material:!0},v={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},b=function(e){(0,a.default)(x,e);var m,y,b=(m=x,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(m);if(y){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function x(){var e;(0,t.default)(this,x);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=b.call.apply(b,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(x,[{key:"getShaders",value:function(e){return(0,i.default)((0,s.default)(x.prototype),"getShaders",this).call(this,{vs:"top"===e?h.default:f.default,fs:p.default,defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[u.project32,u.gouraudLighting,u.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var e,t=this,r=this.context,n=r.gl,i=r.viewport,a=this.props.coordinateSystem;i.isGeospatial&&a===u.COORDINATE_SYSTEM.DEFAULT&&(a=u.COORDINATE_SYSTEM.LNGLAT),a===u.COORDINATE_SYSTEM.LNGLAT&&(e=this.props._full3d?i.projectPosition.bind(i):i.projectFlat.bind(i)),this.setState({numInstances:0,polygonTesselator:new d.default({preproject:e,fp64:this.use64bitPositions(),IndexType:!n||(0,c.hasFeatures)(n,c.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:v,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:v,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:v,accessor:"getFillColor",defaultValue:_,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:v,accessor:"getLineColor",defaultValue:_,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(e,r){return t.encodePickingColor(e&&e.__source?e.__source.index:r.index,r.target)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(e){var t=(0,i.default)((0,s.default)(x.prototype),"getPickingInfo",this).call(this,e),r=t.index,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find((function(e){return e.__source.index===r}))),t}},{key:"disablePickingIndex",value:function(e){var t=this.props.data;if(t[0]&&t[0].__source)for(var r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else(0,i.default)((0,s.default)(x.prototype),"disablePickingIndex",this).call(this,e)}},{key:"draw",value:function(e){var t=this.props,r=t.extruded,n=t.filled,i=t.wireframe,a=t.elevationScale,o=this.state,s=o.topModel,l=o.sideModel,u=o.polygonTesselator,c=g(g({},e.uniforms),{},{extruded:Boolean(r),elevationScale:a});l&&(l.setInstanceCount(u.instanceCount-1),l.setUniforms(c),i&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),n&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),s&&(s.setVertexCount(u.vertexCount),s.setUniforms(c).draw())}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(x.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var t,r=e.props,n=e.oldProps,a=e.changeFlags,o=this.getAttributeManager();(a.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(null===(t=this.state.models)||void 0===t||t.forEach((function(e){return e.delete()})),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,r=e.changeFlags;if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){var n=this.state.polygonTesselator,i=t.data.attributes||{};n.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:t._full3d}),this.setState({numInstances:n.instanceCount,startIndices:n.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,r,n=this.props,i=n.id,a=n.extruded;if(n.filled){var o=this.getShaders("top");o.defines.NON_INSTANCED_MODEL=1,t=new c.Model(e,g(g({},o),{},{id:"".concat(i,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return a&&((r=new c.Model(e,g(g({},this.getShaders("side")),{},{id:"".concat(i,"-side"),geometry:new c.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}))).userData.excludeAttributes={indices:!0}),{models:[r,t].filter(Boolean),topModel:t,sideModel:r}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.indexStarts,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}}]),x}(u.Layer);return solidPolygonLayer.default=b,(0,l.default)(b,"defaultProps",y),(0,l.default)(b,"layerName","SolidPolygonLayer"),solidPolygonLayer}var utils$1={},hasRequiredUtils$1,hasRequiredPolygonLayer;function requireUtils$1(){return hasRequiredUtils$1||(hasRequiredUtils$1=1,Object.defineProperty(utils$1,"__esModule",{value:!0}),utils$1.replaceInRange=function(e){for(var t=e.data,r=e.getIndex,n=e.dataRange,i=e.replace,a=n.startRow,o=void 0===a?0:a,s=n.endRow,l=void 0===s?1/0:s,u=t.length,c=u,d=u,h=0;h<u;h++){var f=r(t[h]);if(c>h&&f>=o&&(c=h),f>=l){d=h;break}}for(var p=c,m=d-c!==i.length?t.slice(d):void 0,g=0;g<i.length;g++)t[p++]=i[g];if(m){for(var _=0;_<m.length;_++)t[p++]=m[_];t.length=p}return{startRow:c,endRow:c+i.length}}),utils$1}function requirePolygonLayer(){if(hasRequiredPolygonLayer)return polygonLayer;hasRequiredPolygonLayer=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(polygonLayer,"__esModule",{value:!0}),polygonLayer.default=void 0;var r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=e(requireDefineProperty()),l=es5$g,u=e(requireSolidPolygonLayer()),c=e(requirePathLayer()),d=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=f(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requirePolygon$1()),h=requireUtils$1();function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=[0,0,0,255],g={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:m},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},_=function(e){(0,i.default)(g,e);var t,s,f=(t=g,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,o.default)(t);if(s){var n=(0,o.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,a.default)(this,e)});function g(){return(0,r.default)(this,g),f.apply(this,arguments)}return(0,n.default)(g,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&l.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var t=this,r=e.changeFlags,n=r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon);if(n&&Array.isArray(r.dataChanged)){var i=this.state.paths.slice(),a=r.dataChanged.map((function(e){return(0,h.replaceInRange)({data:i,getIndex:function(e){return e.__source.index},dataRange:e,replace:t._getPaths(e)})}));this.setState({paths:i,pathsDiff:a})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.props,n=r.getPolygon,i=r._normalize,a=[],o="XY"===r.positionFormat?2:3,s=(0,l.createIterable)(r.data,t.startRow,t.endRow),u=s.objectInfo,c=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(s.iterable);try{for(c.s();!(e=c.n()).done;){var h=e.value;u.index++;var f=n(h,u);i&&(f=d.normalize(f,o));var m=f.holeIndices,g=f.positions||f;if(m)for(var _=0;_<=m.length;_++){var y=g.slice(m[_-1]||0,m[_]||g.length);a.push(this.getSubLayerRow({path:y},h,u.index))}else a.push(this.getSubLayerRow({path:g},h,u.index))}}catch(e){c.e(e)}finally{c.f()}return a}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,r=e._dataDiff,n=e.stroked,i=e.filled,a=e.extruded,o=e.wireframe,s=e._normalize,l=e._windingOrder,d=e.elevationScale,h=e.transitions,f=e.positionFormat,p=this.props,g=p.lineWidthUnits,_=p.lineWidthScale,y=p.lineWidthMinPixels,v=p.lineWidthMaxPixels,b=p.lineJointRounded,x=p.lineMiterLimit,T=p.lineDashJustified,w=this.props,E=w.getFillColor,A=w.getLineColor,S=w.getLineWidth,P=w.getLineDashArray,M=w.getElevation,R=w.getPolygon,C=w.updateTriggers,O=w.material,L=this.state,I=L.paths,D=L.pathsDiff,k=this.getSubLayerClass("fill",u.default),B=this.getSubLayerClass("stroke",c.default),F=this.shouldRenderSubLayer("fill",I)&&new k({_dataDiff:r,extruded:a,elevationScale:d,filled:i,wireframe:o,_normalize:s,_windingOrder:l,getElevation:M,getFillColor:E,getLineColor:a&&o?A:m,material:O,transitions:h},this.getSubLayerProps({id:"fill",updateTriggers:C&&{getPolygon:C.getPolygon,getElevation:C.getElevation,getFillColor:C.getFillColor,lineColors:a&&o,getLineColor:C.getLineColor}}),{data:t,positionFormat:f,getPolygon:R});return[!a&&F,!a&&n&&this.shouldRenderSubLayer("stroke",I)&&new B({_dataDiff:D&&function(){return D},widthUnits:g,widthScale:_,widthMinPixels:y,widthMaxPixels:v,jointRounded:b,miterLimit:x,dashJustified:T,_pathType:"loop",transitions:h&&{getWidth:h.getLineWidth,getColor:h.getLineColor,getPath:h.getPolygon},getColor:this.getSubLayerAccessor(A),getWidth:this.getSubLayerAccessor(S),getDashArray:this.getSubLayerAccessor(P)},this.getSubLayerProps({id:"stroke",updateTriggers:C&&{getWidth:C.getLineWidth,getColor:C.getLineColor,getDashArray:C.getLineDashArray}}),{data:I,positionFormat:f,getPath:function(e){return e.path}}),a&&F]}}]),g}(l.CompositeLayer);return polygonLayer.default=_,(0,s.default)(_,"layerName","PolygonLayer"),(0,s.default)(_,"defaultProps",g),polygonLayer}var geojsonLayer={},objectWithoutProperties={exports:{}},objectWithoutPropertiesLoose={exports:{}},hasRequiredObjectWithoutPropertiesLoose,hasRequiredObjectWithoutProperties;function requireObjectWithoutPropertiesLoose(){return hasRequiredObjectWithoutPropertiesLoose||(hasRequiredObjectWithoutPropertiesLoose=1,function(e){e.exports=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(i[r]=e[r]);return i},e.exports.__esModule=!0,e.exports.default=e.exports}(objectWithoutPropertiesLoose)),objectWithoutPropertiesLoose.exports}function requireObjectWithoutProperties(){return hasRequiredObjectWithoutProperties||(hasRequiredObjectWithoutProperties=1,function(e){var t=requireObjectWithoutPropertiesLoose();e.exports=function(e,r){if(null==e)return{};var n,i,a=t(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r.indexOf(n=o[i])>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a},e.exports.__esModule=!0,e.exports.default=e.exports}(objectWithoutProperties)),objectWithoutProperties.exports}var geojsonBinary={},hasRequiredGeojsonBinary;function requireGeojsonBinary(){if(hasRequiredGeojsonBinary)return geojsonBinary;hasRequiredGeojsonBinary=1;var e=interopRequireDefaultExports;Object.defineProperty(geojsonBinary,"__esModule",{value:!0}),geojsonBinary.binaryToFeatureForAccesor=function(e,t){if(!e)return null;var r="startIndices"in e?e.startIndices[t]:t;return-1!==r?function(e,t,r){var i={properties:n({},e.properties[t])};for(var a in e.numericProps)i.properties[a]=e.numericProps[a].value[r];return i}(e,e.featureIds.value[r],r):null},geojsonBinary.calculatePickingColors=function(e,t){var r={points:null,lines:null,polygons:null};for(var n in r){var i=e[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(3*i.length);for(var a=[],o=0;o<i.length;o++)t(i[o],a),r[n][3*o+0]=a[0],r[n][3*o+1]=a[1],r[n][3*o+2]=a[2]}return r};var t=e(requireDefineProperty());function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}return geojsonBinary}var subLayerMap={},textLayer={},multiIconLayer={},multiIconLayerFragment_glsl={},hasRequiredMultiIconLayerFragment_glsl,hasRequiredMultiIconLayer;function requireMultiIconLayerFragment_glsl(){return hasRequiredMultiIconLayerFragment_glsl||(hasRequiredMultiIconLayerFragment_glsl=1,Object.defineProperty(multiIconLayerFragment_glsl,"__esModule",{value:!0}),multiIconLayerFragment_glsl.default=void 0,multiIconLayerFragment_glsl.default="#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float sdfBuffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),multiIconLayerFragment_glsl}function requireMultiIconLayer(){if(hasRequiredMultiIconLayer)return multiIconLayer;hasRequiredMultiIconLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(multiIconLayer,"__esModule",{value:!0}),multiIconLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=e(requireIconLayer()),d=e(requireMultiIconLayerFragment_glsl());function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=.75,m=[],g=function(e){(0,a.default)(_,e);var c,h,g=(c=_,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(c);if(h){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function _(){var e;(0,t.default)(this,_);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=g.call.apply(g,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(_,[{key:"getShaders",value:function(){return f(f({},(0,i.default)((0,s.default)(_.prototype),"getShaders",this).call(this)),{},{fs:d.default})}},{key:"initializeState",value:function(){var e=this;(0,i.default)((0,s.default)(_.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(t,r){return e.encodePickingColor(r.index,r.target)}}})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(_.prototype),"updateState",this).call(this,e);var t=e.props,r=t.outlineColor;r!==e.oldProps.outlineColor&&((r=r.map((function(e){return e/255})))[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!t.sdf&&t.outlineWidth&&u.log.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(e){var t=this.props,r=t.sdf,n=t.smoothing,a=t.outlineWidth,o=this.state.outlineColor,l=a?Math.max(n,p*(1-a)):-1;e.uniforms=f(f({},e.uniforms),{},{sdfBuffer:p,outlineBuffer:l,gamma:n,sdf:Boolean(r),outlineColor:o}),(0,i.default)((0,s.default)(_.prototype),"draw",this).call(this,e),r&&a&&this.state.iconManager.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:p}})}},{key:"getInstanceOffset",value:function(e){var t=this;return e?Array.from(e).flatMap((function(e){return(0,i.default)((0,s.default)(_.prototype),"getInstanceOffset",t).call(t,e)})):m}},{key:"getInstanceColorMode",value:function(e){return 1}},{key:"getInstanceIconFrame",value:function(e){var t=this;return e?Array.from(e).flatMap((function(e){return(0,i.default)((0,s.default)(_.prototype),"getInstanceIconFrame",t).call(t,e)})):m}}]),_}(c.default);return multiIconLayer.default=g,(0,l.default)(g,"defaultProps",{getIconOffsets:{type:"accessor",value:function(e){return e.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}}),(0,l.default)(g,"layerName","MultiIconLayer"),multiIconLayer}var fontAtlasManager={};const INF=1e20;class TinySDF{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:a="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=r;const s=this.size=e+4*t,l=this._createCanvas(s),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${o} ${a} ${e}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:a}=this.ctx.measureText(e),o=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-i))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),u=s+2*this.buffer,c=l+2*this.buffer,d=Math.max(u*c,0),h=new Uint8ClampedArray(d),f={data:h,width:u,height:c,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return f;const{ctx:p,buffer:m,gridInner:g,gridOuter:_}=this;p.clearRect(m,m,s,l),p.fillText(e,m,m+o);const y=p.getImageData(m,m,s,l);_.fill(INF,0,d),g.fill(0,0,d);for(let e=0;e<l;e++)for(let t=0;t<s;t++){const r=y.data[4*(e*s+t)+3]/255;if(0===r)continue;const n=(e+m)*u+t+m;if(1===r)_[n]=0,g[n]=INF;else{const e=.5-r;_[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}edt(_,0,0,u,c,u,this.f,this.v,this.z),edt(g,m,m,s,l,u,this.f,this.v,this.z);for(let e=0;e<d;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);h[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}}function edt(e,t,r,n,i,a,o,s,l){for(let u=t;u<t+n;u++)edt1d(e,r*a+u,a,i,o,s,l);for(let u=r;u<r+i;u++)edt1d(e,u*a+t,1,n,o,s,l)}function edt1d(e,t,r,n,i,a,o){a[0]=0,o[0]=-INF,o[1]=INF,i[0]=e[t];for(let s=1,l=0,u=0;s<n;s++){i[s]=e[t+s*r];const n=s*s;do{const e=a[l];u=(i[s]-i[e]+n-e*e)/(s-e)/2}while(u<=o[l]&&--l>-1);l++,a[l]=s,o[l]=u,o[l+1]=INF}for(let s=0,l=0;s<n;s++){for(;o[l+1]<s;)l++;const n=a[l],u=s-n;e[t+s*r]=i[n]+u*u}}var tinySdf=Object.freeze({__proto__:null,default:TinySDF}),require$$4=getAugmentedNamespace(tinySdf),utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1,Object.defineProperty(utils,"__esModule",{value:!0}),utils.nextPowOfTwo=a,utils.buildMapping=function(e){var r,n=e.getFontWidth,i=e.fontHeight,o=e.buffer,s=e.maxCanvasWidth,l=e.mapping,u=void 0===l?{}:l,c=e.xOffset,d=e.yOffset,h=void 0===d?0:d,f=0,p=void 0===c?0:c,m=i+2*o,g=t(e.characterSet);try{for(g.s();!(r=g.n()).done;){var _=r.value;if(!u[_]){var y=n(_);p+y+2*o>s&&(p=0,f++),u[_]={x:p+o,y:h+f*m+o,width:y,height:m,layoutWidth:y,layoutHeight:i},p+=y+2*o}}}catch(e){g.e(e)}finally{g.f()}return{mapping:u,xOffset:p,yOffset:h+f*m,canvasHeight:a(h+(f+1)*m)}},utils.autoWrapping=l,utils.transformParagraph=function(e,t,r,n,a){for(var o=Array.from(e),s=o.length,c=new Array(s),d=new Array(s),h=new Array(s),f=("break-word"===r||"break-all"===r)&&isFinite(n)&&n>0,p=[0,0],m=[0,0],g=0,_=0,y=0,v=0;v<=s;v++){var b=o[v];if("\n"!==b&&v!==s||(y=v),y>_){for(var x=f?l(o,r,n,a,_,y):i,T=0;T<=x.length;T++){var w=0===T?_:x[T-1],E=T<x.length?x[T]:y;u(o,w,E,a,c,m);for(var A=w;A<E;A++){var S,P=(null===(S=a[o[A]])||void 0===S?void 0:S.layoutOffsetY)||0;d[A]=g+m[1]/2+P,h[A]=m[0]}g+=m[1]*t,p[0]=Math.max(p[0],m[0])}_=y}"\n"===b&&(c[_]=0,d[_]=0,h[_]=0,_++)}return p[1]=g,{x:c,y:d,rowWidth:h,size:p}},utils.getTextFromBuffer=function(e){var r=e.value,n=e.length,i=e.stride,a=e.offset,o=e.startIndices,s=e.characterSet,l=r.BYTES_PER_ELEMENT,u=i?i/l:1,c=a?a/l:0,d=o[n]||Math.ceil((r.length-c)/u),h=s&&new Set,f=new Array(n),p=r;if(u>1||c>0){p=new(0,r.constructor)(d);for(var m=0;m<d;m++)p[m]=r[m*u+c]}for(var g=0;g<n;g++){var _=p.subarray(o[g],o[g+1]||d);f[g]=String.fromCodePoint.apply(null,_),h&&_.forEach(h.add,h)}if(h){var y,v=t(h);try{for(v.s();!(y=v.n()).done;)s.add(String.fromCodePoint(y.value))}catch(e){v.e(e)}finally{v.f()}}return{texts:f,characterCount:d}};var e=es5$g;function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var n=32,i=[];function a(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function o(e,t,r,n){for(var i=0,a=t;a<r;a++){var o;i+=(null===(o=n[e[a]])||void 0===o?void 0:o.layoutWidth)||0}return i}function s(e,t,r,n,i,a){for(var s=t,l=0,u=t;u<r;u++){var c=o(e,u,u+1,i);l+c>n&&(s<u&&a.push(u),s=u,l=0),l+=c}return l}function l(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;void 0===a&&(a=e.length);var l=[];return"break-all"===t?s(e,i,a,r,n,l):function(e,t,r,n,i,a){for(var l=t,u=t,c=t,d=0,h=t;h<r;h++)if(" "===e[h]?c=h+1:" "!==e[h+1]&&h+1!==r||(c=h+1),c>u){var f=o(e,u,c,i);d+f>n&&(l<u&&(a.push(u),l=u,d=0),f>n&&(f=s(e,u,c,n,i,a),l=a[a.length-1])),u=c,d+=f}}(e,i,a,r,n,l),l}function u(t,r,i,a,o,s){for(var l=0,u=0,c=r;c<i;c++){var d=t[c],h=a[d];h?(u||(u=h.layoutHeight),o[c]=l+h.layoutWidth/2,l+=h.layoutWidth):(e.log.warn("Missing character: ".concat(d," (").concat(d.codePointAt(0),")"))(),o[c]=l,l+=n)}s[0]=l,s[1]=u}return utils}var lruCache={},hasRequiredLruCache,hasRequiredFontAtlasManager;function requireLruCache(){if(hasRequiredLruCache)return lruCache;hasRequiredLruCache=1;var e=interopRequireDefaultExports;Object.defineProperty(lruCache,"__esModule",{value:!0}),lruCache.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;(0,t.default)(this,e),(0,n.default)(this,"limit",void 0),(0,n.default)(this,"_cache",{}),(0,n.default)(this,"_order",[]),this.limit=r}return(0,r.default)(e,[{key:"get",value:function(e){var t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}},{key:"set",value:function(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}},{key:"delete",value:function(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}},{key:"_deleteOrder",value:function(e){var t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),e}();return lruCache.default=i,lruCache}function requireFontAtlasManager(){if(hasRequiredFontAtlasManager)return fontAtlasManager;hasRequiredFontAtlasManager=1;var e=interopRequireDefaultExports;Object.defineProperty(fontAtlasManager,"__esModule",{value:!0}),fontAtlasManager.setFontAtlasCacheLimit=function(e){a.log.assert(Number.isFinite(e)&&e>=f,"Invalid cache limit"),p=new s.default(e)},fontAtlasManager.default=fontAtlasManager.DEFAULT_FONT_SETTINGS=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=e(require$$4),a=es5$g,o=requireUtils(),s=e(requireLruCache());function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};fontAtlasManager.DEFAULT_FONT_SETTINGS=h;var f=3,p=new s.default(f);function m(e,t){for(var r=0;r<e.length;r++)t.data[4*r+3]=e[r]}function g(e,t,r,n){e.font="".concat(n," ").concat(r,"px ").concat(t),e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}var _=function(){function e(){(0,t.default)(this,e),(0,n.default)(this,"props",d({},h)),(0,n.default)(this,"_key",void 0),(0,n.default)(this,"_atlas",void 0)}return(0,r.default)(e,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var e=this.props,t=e.fontSize;return(1.2*t+2*e.buffer)/t}},{key:"setProps",value:function(){Object.assign(this.props,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._key=this._getKey();var e=function(e,t){var r;r="string"==typeof t?new Set(Array.from(t)):new Set(t);var n=p.get(e);if(!n)return r;for(var i in n.mapping)r.has(i)&&r.delete(i);return r}(this._key,this.props.characterSet),t=p.get(this._key);if(t&&0===e.size)this._atlas!==t&&(this._atlas=t);else{var r=this._generateFontAtlas(e,t);this._atlas=r,p.set(this._key,r)}}},{key:"_generateFontAtlas",value:function(e,t){var r=this.props,n=r.fontFamily,a=r.fontWeight,s=r.fontSize,u=r.buffer,c=r.sdf,h=r.radius,f=r.cutoff,p=t&&t.data;p||((p=document.createElement("canvas")).width=1024);var _=p.getContext("2d",{willReadFrequently:!0});g(_,n,s,a);var y=(0,o.buildMapping)(d({getFontWidth:function(e){return _.measureText(e).width},fontHeight:1.2*s,buffer:u,characterSet:e,maxCanvasWidth:1024},t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset})),v=y.mapping,b=y.canvasHeight,x=y.xOffset,T=y.yOffset;if(p.height!==b){var w=_.getImageData(0,0,p.width,p.height);p.height=b,_.putImageData(w,0,0)}if(g(_,n,s,a),c){var E,A=new i.default({fontSize:s,buffer:u,radius:h,cutoff:f,fontFamily:n,fontWeight:"".concat(a)}),S=l(e);try{for(S.s();!(E=S.n()).done;){var P=E.value,M=A.draw(P),R=M.data,C=M.width,O=M.height,L=M.glyphTop;v[P].width=C,v[P].layoutOffsetY=.9*s-L;var I=_.createImageData(C,O);m(R,I),_.putImageData(I,v[P].x,v[P].y)}}catch(e){S.e(e)}finally{S.f()}}else{var D,k=l(e);try{for(k.s();!(D=k.n()).done;){var B=D.value;_.fillText(B,v[B].x,v[B].y+u+.9*s)}}catch(e){k.e(e)}finally{k.f()}}return{xOffset:x,yOffset:T,mapping:v,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var e=this.props,t=e.fontFamily,r=e.fontWeight,n=e.fontSize,i=e.buffer,a=e.radius,o=e.cutoff;return e.sdf?"".concat(t," ").concat(r," ").concat(n," ").concat(i," ").concat(a," ").concat(o):"".concat(t," ").concat(r," ").concat(n," ").concat(i)}}]),e}();return fontAtlasManager.default=_,fontAtlasManager}var textBackgroundLayer={},textBackgroundLayerVertex_glsl={},hasRequiredTextBackgroundLayerVertex_glsl;function requireTextBackgroundLayerVertex_glsl(){return hasRequiredTextBackgroundLayerVertex_glsl||(hasRequiredTextBackgroundLayerVertex_glsl=1,Object.defineProperty(textBackgroundLayerVertex_glsl,"__esModule",{value:!0}),textBackgroundLayerVertex_glsl.default=void 0,textBackgroundLayerVertex_glsl.default="#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  }\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n"),textBackgroundLayerVertex_glsl}var textBackgroundLayerFragment_glsl={},hasRequiredTextBackgroundLayerFragment_glsl,hasRequiredTextBackgroundLayer,hasRequiredTextLayer,hasRequiredSubLayerMap;function requireTextBackgroundLayerFragment_glsl(){return hasRequiredTextBackgroundLayerFragment_glsl||(hasRequiredTextBackgroundLayerFragment_glsl=1,Object.defineProperty(textBackgroundLayerFragment_glsl,"__esModule",{value:!0}),textBackgroundLayerFragment_glsl.default=void 0,textBackgroundLayerFragment_glsl.default="#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"),textBackgroundLayerFragment_glsl}function requireTextBackgroundLayer(){if(hasRequiredTextBackgroundLayer)return textBackgroundLayer;hasRequiredTextBackgroundLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(textBackgroundLayer,"__esModule",{value:!0}),textBackgroundLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=e(requireTextBackgroundLayerVertex_glsl()),h=e(requireTextBackgroundLayerFragment_glsl());function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(e){return e.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},g=function(e){(0,a.default)(_,e);var f,m,g=(f=_,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(f);if(m){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function _(){var e;(0,t.default)(this,_);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=g.call.apply(g,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(_,[{key:"getShaders",value:function(){return(0,i.default)((0,s.default)(_.prototype),"getShaders",this).call(this,{vs:d.default,fs:h.default,modules:[u.project32,u.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){if((0,i.default)((0,s.default)(_.prototype),"updateState",this).call(this,e),e.changeFlags.extensionsChanged){var t,r=this.context.gl;null===(t=this.state.model)||void 0===t||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=this.props,r=t.billboard,n=t.sizeScale,i=t.sizeUnits,a=t.sizeMinPixels,o=t.sizeMaxPixels,s=t.getLineWidth,l=this.props.padding;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e.uniforms).setUniforms({billboard:r,stroked:Boolean(s),padding:l,sizeUnits:u.UNIT[i],sizeScale:n,sizeMinPixels:a,sizeMaxPixels:o}).draw()}},{key:"_getModel",value:function(e){return new c.Model(e,p(p({},this.getShaders()),{},{id:this.props.id,geometry:new c.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0}))}}]),_}(u.Layer);return textBackgroundLayer.default=g,(0,l.default)(g,"defaultProps",m),(0,l.default)(g,"layerName","TextBackgroundLayer"),textBackgroundLayer}function requireTextLayer(){if(hasRequiredTextLayer)return textLayer;hasRequiredTextLayer=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(textLayer,"__esModule",{value:!0}),textLayer.default=void 0;var r=e(requireSlicedToArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=e(requireDefineProperty()),c=es5$g,d=e(requireMultiIconLayer()),h=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=m(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requireFontAtlasManager()),f=requireUtils(),p=e(requireTextBackgroundLayer());function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={start:1,middle:0,end:-1},b={top:1,center:0,bottom:-1},x=[0,0,0,255],T={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:x},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:h.DEFAULT_FONT_SETTINGS.characterSet},fontFamily:h.DEFAULT_FONT_SETTINGS.fontFamily,fontWeight:h.DEFAULT_FONT_SETTINGS.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:x},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(e){return e.text}},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:x},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},w=function(e){(0,o.default)(x,e);var t,m,_=(t=x,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.default)(t);if(m){var n=(0,l.default)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,s.default)(this,e)});function x(){var e;(0,n.default)(this,x);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=_.call.apply(_,[this].concat(i)),(0,u.default)((0,a.default)(e),"state",void 0),(0,u.default)((0,a.default)(e),"getBoundingRect",(function(t,n){var i=e.transformParagraph(t,n),a=(0,r.default)(i.size,2),o=a[0],s=a[1],l=e.state.fontAtlasManager.props.fontSize;o/=l,s/=l;var u=e.props,c=u.getTextAnchor,d=u.getAlignmentBaseline;return[(v["function"==typeof c?c(t,n):c]-1)*o/2,(b["function"==typeof d?d(t,n):d]-1)*s/2,o,s]})),(0,u.default)((0,a.default)(e),"getIconOffsets",(function(t,n){for(var i=e.props,a=i.getTextAnchor,o=i.getAlignmentBaseline,s=e.transformParagraph(t,n),l=s.x,u=s.y,c=s.rowWidth,d=(0,r.default)(s.size,2),h=d[0],f=d[1],p=v["function"==typeof a?a(t,n):a],m=b["function"==typeof o?o(t,n):o],g=l.length,_=new Array(2*g),y=0,x=0;x<g;x++)_[y++]=(p-1)*h/2+(1-p)*(h-c[x])/2+l[x],_[y++]=(m-1)*f/2+u[x];return _})),e}return(0,i.default)(x,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new h.default},this.props.maxWidth>0&&c.log.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(e){var t=e.props,r=e.oldProps,n=e.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(e){var t=e.info;return t.object=t.index>=0?this.props.data[t.index]:null,t}},{key:"_updateFontAtlas",value:function(){var e=this.props,t=e.fontFamily,r=e.fontWeight,n=this.state,i=n.fontAtlasManager,a=n.characterSet,o=y(y({},e.fontSettings),{},{characterSet:a,fontFamily:t,fontWeight:r});if(!i.mapping)return i.setProps(o),!0;for(var s in o)if(o[s]!==i.props[s])return i.setProps(o),!0;return!1}},{key:"_updateText",value:function(){var e,t,r=this.props,n=r.data,i=r.characterSet,a=null===(e=n.attributes)||void 0===e?void 0:e.getText,o=this.props.getText,s=n.startIndices,l="auto"===i&&new Set;if(a&&s){var u=(0,f.getTextFromBuffer)(y(y({},ArrayBuffer.isView(a)?{value:a}:a),{},{length:n.length,startIndices:s,characterSet:l})),d=u.texts;t=u.characterCount,o=function(e,t){return d[t.index]}}else{var h=(0,c.createIterable)(n),p=h.objectInfo;s=[0],t=0;var m,_=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(h.iterable);try{for(_.s();!(m=_.n()).done;){var v=m.value;p.index++;var b=Array.from(o(v,p)||"");l&&b.forEach(l.add,l),s.push(t+=b.length)}}catch(e){_.e(e)}finally{_.f()}}this.setState({getText:o,startIndices:s,numInstances:t,characterSet:l||i})}},{key:"transformParagraph",value:function(e,t){var r=this.state.fontAtlasManager,n=r.mapping,i=this.props,a=i.wordBreak,o=i.lineHeight,s=i.maxWidth,l=(0,this.state.getText)(e,t)||"";return(0,f.transformParagraph)(l,o,a,s*r.props.fontSize,n)}},{key:"renderLayers",value:function(){var e=this.state,t=e.startIndices,r=e.numInstances,n=e.getText,i=e.fontAtlasManager,a=i.scale,o=i.texture,s=i.mapping,l=e.styleVersion,u=this.props,c=u.data,f=u._dataDiff,m=u.getPosition,g=u.getColor,_=u.getSize,y=u.getAngle,v=u.getPixelOffset,b=u.getBackgroundColor,x=u.getBorderColor,T=u.getBorderWidth,w=u.backgroundPadding,E=u.background,A=u.billboard,S=u.fontSettings,P=u.outlineWidth,M=u.outlineColor,R=u.sizeScale,C=u.sizeUnits,O=u.sizeMinPixels,L=u.sizeMaxPixels,I=u.transitions,D=u.updateTriggers,k=this.getSubLayerClass("characters",d.default),B=this.getSubLayerClass("background",p.default);return[E&&new B({getFillColor:b,getLineColor:x,getLineWidth:T,padding:w,getPosition:m,getSize:_,getAngle:y,getPixelOffset:v,billboard:A,sizeScale:R,sizeUnits:C,sizeMinPixels:O,sizeMaxPixels:L,transitions:I&&{getPosition:I.getPosition,getAngle:I.getAngle,getSize:I.getSize,getFillColor:I.getBackgroundColor,getLineColor:I.getBorderColor,getLineWidth:I.getBorderWidth,getPixelOffset:I.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:D.getPosition,getAngle:D.getAngle,getSize:D.getSize,getFillColor:D.getBackgroundColor,getLineColor:D.getBorderColor,getLineWidth:D.getBorderWidth,getPixelOffset:D.getPixelOffset,getBoundingRect:{getText:D.getText,getTextAnchor:D.getTextAnchor,getAlignmentBaseline:D.getAlignmentBaseline,styleVersion:l}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:f,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new k({sdf:S.sdf,smoothing:Number.isFinite(S.smoothing)?S.smoothing:h.DEFAULT_FONT_SETTINGS.smoothing,outlineWidth:P/(S.radius||h.DEFAULT_FONT_SETTINGS.radius),outlineColor:M,iconAtlas:o,iconMapping:s,getPosition:m,getColor:g,getSize:_,getAngle:y,getPixelOffset:v,billboard:A,sizeScale:R*a,sizeUnits:C,sizeMinPixels:O*a,sizeMaxPixels:L*a,transitions:I&&{getPosition:I.getPosition,getAngle:I.getAngle,getColor:I.getColor,getSize:I.getSize,getPixelOffset:I.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:D.getText,getPosition:D.getPosition,getAngle:D.getAngle,getColor:D.getColor,getSize:D.getSize,getPixelOffset:D.getPixelOffset,getIconOffsets:{getTextAnchor:D.getTextAnchor,getAlignmentBaseline:D.getAlignmentBaseline,styleVersion:l}}}),{data:c,_dataDiff:f,startIndices:t,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}}],[{key:"fontAtlasCacheLimit",set:function(e){(0,h.setFontAtlasCacheLimit)(e)}}]),x}(c.CompositeLayer);return textLayer.default=w,(0,u.default)(w,"defaultProps",T),(0,u.default)(w,"layerName","TextLayer"),textLayer}function requireSubLayerMap(){if(hasRequiredSubLayerMap)return subLayerMap;hasRequiredSubLayerMap=1;var e=interopRequireDefaultExports;Object.defineProperty(subLayerMap,"__esModule",{value:!0}),subLayerMap.getDefaultProps=function(e){var t=e.type,r=e.props,n={};for(var i in r)n[i]=t.defaultProps[r[i]];return n},subLayerMap.forwardProps=function(e,t){var r=e.props,n=r.transitions,i=r.updateTriggers,a={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var o in t){var s=t[o],l=e.props[o];o.startsWith("get")&&(l=e.getSubLayerAccessor(l),a.updateTriggers[s]=i[o],n&&(a.transitions[s]=n[o])),a[s]=l}return a},subLayerMap.POLYGON_LAYER=subLayerMap.LINE_LAYER=subLayerMap.POINT_LAYER=void 0;var t=e(requireIconLayer()),r=e(requireScatterplotLayer()),n=e(requireTextLayer()),i=e(requirePathLayer()),a=e(requireSolidPolygonLayer());return subLayerMap.POINT_LAYER={circle:{type:r.default,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:t.default,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:n.default,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},subLayerMap.LINE_LAYER={type:i.default,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},subLayerMap.POLYGON_LAYER={type:a.default,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}},subLayerMap}var geojson={},hasRequiredGeojson;function requireGeojson(){if(hasRequiredGeojson)return geojson;hasRequiredGeojson=1,Object.defineProperty(geojson,"__esModule",{value:!0}),geojson.getGeojsonFeatures=function(t){if(Array.isArray(t))return t;switch(e.log.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return e.log.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}},geojson.separateGeojsonFeatures=function(r,n){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},o=i.startRow,s=i.endRow,l=void 0===s?r.length:s,u=void 0===o?0:o;u<l;u++){var c=r[u],d=c.geometry;if(d)if("GeometryCollection"===d.type){e.log.assert(Array.isArray(d.geometries),"GeoJSON does not have geometries array");for(var h=d.geometries,f=0;f<h.length;f++)t(h[f],a,n,c,u)}else t(d,a,n,c,u)}return a},geojson.validateGeometry=n;var e=es5$g;function t(t,r,i,a,o){var s=t.type,l=t.coordinates,u=r.pointFeatures,c=r.lineFeatures,d=r.polygonFeatures,h=r.polygonOutlineFeatures;if(n(s,l))switch(s){case"Point":u.push(i({geometry:t},a,o));break;case"MultiPoint":l.forEach((function(e){u.push(i({geometry:{type:"Point",coordinates:e}},a,o))}));break;case"LineString":c.push(i({geometry:t},a,o));break;case"MultiLineString":l.forEach((function(e){c.push(i({geometry:{type:"LineString",coordinates:e}},a,o))}));break;case"Polygon":d.push(i({geometry:t},a,o)),l.forEach((function(e){h.push(i({geometry:{type:"LineString",coordinates:e}},a,o))}));break;case"MultiPolygon":l.forEach((function(e){d.push(i({geometry:{type:"Polygon",coordinates:e}},a,o)),e.forEach((function(e){h.push(i({geometry:{type:"LineString",coordinates:e}},a,o))}))}))}else e.log.warn("".concat(s," coordinates are malformed"))()}var r={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function n(t,n){var i=r[t];for(e.log.assert(i,"Unknown GeoJSON type ".concat(t));n&&--i>0;)n=n[0];return n&&Number.isFinite(n[0])}return geojson}var geojsonLayerProps={},hasRequiredGeojsonLayerProps,hasRequiredGeojsonLayer;function requireGeojsonLayerProps(){if(hasRequiredGeojsonLayerProps)return geojsonLayerProps;hasRequiredGeojsonLayerProps=1;var e=interopRequireDefaultExports;Object.defineProperty(geojsonLayerProps,"__esModule",{value:!0}),geojsonLayerProps.createLayerPropsFromFeatures=function(e,t){var r={points:{},lines:{},polygons:{},polygonsOutline:{}},n=e.lineFeatures,i=e.polygonFeatures,o=e.polygonOutlineFeatures;return r.points.data=e.pointFeatures,r.points._dataDiff=t.pointFeatures&&function(){return t.pointFeatures},r.points.getPosition=a,r.lines.data=n,r.lines._dataDiff=t.lineFeatures&&function(){return t.lineFeatures},r.lines.getPath=a,r.polygons.data=i,r.polygons._dataDiff=t.polygonFeatures&&function(){return t.polygonFeatures},r.polygons.getPolygon=a,r.polygonsOutline.data=o,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&function(){return t.polygonOutlineFeatures},r.polygonsOutline.getPath=a,r},geojsonLayerProps.createLayerPropsFromBinary=function(e,t){var n={points:{},lines:{},polygons:{},polygonsOutline:{}},a=e.points,o=e.lines,s=e.polygons,l=(0,r.calculatePickingColors)(e,t);return n.points.data={length:a.positions.value.length/a.positions.size,attributes:i(i({},a.attributes),{},{getPosition:a.positions,instancePickingColors:{size:3,value:l.points}}),properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},n.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:i(i({},o.attributes),{},{getPath:o.positions,instancePickingColors:{size:3,value:l.lines}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:i(i({},s.attributes),{},{getPolygon:s.positions,pickingColors:{size:3,value:l.polygons}}),properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:i(i({},s.attributes),{},{getPath:s.positions,instancePickingColors:{size:3,value:l.polygons}}),properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n};var t=e(requireDefineProperty()),r=requireGeojsonBinary();function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach((function(r){(0,t.default)(e,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e){return e.geometry.coordinates}return geojsonLayerProps}function requireGeojsonLayer(){if(hasRequiredGeojsonLayer)return geojsonLayer;hasRequiredGeojsonLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(geojsonLayer,"__esModule",{value:!0}),geojsonLayer.default=void 0;var t=e(requireObjectWithoutProperties()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=requireUtils$1(),d=requireGeojsonBinary(),h=requireSubLayerMap(),f=requireGeojson(),p=requireGeojsonLayerProps(),m=["instancePickingColors"];function g(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b=["points","linestrings","polygons"],x=v(v(v(v(v(v({},(0,h.getDefaultProps)(h.POINT_LAYER.circle)),(0,h.getDefaultProps)(h.POINT_LAYER.icon)),(0,h.getDefaultProps)(h.POINT_LAYER.text)),(0,h.getDefaultProps)(h.LINE_LAYER)),(0,h.getDefaultProps)(h.POLYGON_LAYER)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(e){return e.properties.icon}},getText:{type:"accessor",value:function(e){return e.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),T=function(e){(0,a.default)(y,e);var l,u,_=(l=y,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(l);if(u){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function y(){return(0,r.default)(this,y),_.apply(this,arguments)}return(0,n.default)(y,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(e){var t=e.props,r=e.changeFlags;if(r.dataChanged){var n=this.props.data,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:t,changeFlags:r}):this._updateStateJSON({props:t,changeFlags:r})}}},{key:"_updateStateBinary",value:function(e){var t=(0,p.createLayerPropsFromBinary)(e.props.data,this.encodePickingColor);this.setState({layerProps:t})}},{key:"_updateStateJSON",value:function(e){var t=e.changeFlags,r=(0,f.getGeojsonFeatures)(e.props.data),n=this.getSubLayerRow.bind(this),i={},a={};if(Array.isArray(t.dataChanged)){var o=this.state.features;for(var s in o)i[s]=o[s].slice(),a[s]=[];var l,u=g(t.dataChanged);try{for(u.s();!(l=u.n()).done;){var d=l.value,h=(0,f.separateGeojsonFeatures)(r,n,d);for(var m in o)a[m].push((0,c.replaceInRange)({data:i[m],getIndex:function(e){return e.__source.index},dataRange:d,replace:h[m]}))}}catch(e){u.e(e)}finally{u.f()}}else i=(0,f.separateGeojsonFeatures)(r,n);var _=(0,p.createLayerPropsFromFeatures)(i,a);this.setState({features:i,featuresDiff:a,layerProps:_})}},{key:"getPickingInfo",value:function(e){var t=this,r=(0,i.default)((0,s.default)(y.prototype),"getPickingInfo",this).call(this,e),n=r.index,a=r.sourceLayer;return r.featureType=b.find((function(e){return a.id.startsWith("".concat(t.id,"-").concat(e,"-"))})),n>=0&&a.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}},{key:"_updateAutoHighlight",value:function(e){var t,r="".concat(this.id,"-points-"),n="points"===e.featureType,i=g(this.getSubLayers());try{for(i.s();!(t=i.n()).done;){var a=t.value;a.id.startsWith(r)===n&&a.updateAutoHighlight(e)}}catch(e){i.e(e)}finally{i.f()}}},{key:"_renderPolygonLayer",value:function(){var e=this.props,t=e.extruded,r=e.wireframe,n=this.state.layerProps,i="polygons-fill",a=this.shouldRenderSubLayer(i,n.polygons.data)&&this.getSubLayerClass(i,h.POLYGON_LAYER.type);if(a){var o=(0,h.forwardProps)(this,h.POLYGON_LAYER.props),s=t&&r;return s||delete o.getLineColor,o.updateTriggers.lineColors=s,new a(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),n.polygons)}return null}},{key:"_renderLineLayers",value:function(){var e=this.props,t=this.state.layerProps,r="polygons-stroke",n="linestrings",i=!e.extruded&&e.stroked&&this.shouldRenderSubLayer(r,t.polygonsOutline.data)&&this.getSubLayerClass(r,h.LINE_LAYER.type),a=this.shouldRenderSubLayer(n,t.lines.data)&&this.getSubLayerClass(n,h.LINE_LAYER.type);if(i||a){var o=(0,h.forwardProps)(this,h.LINE_LAYER.props);return[i&&new i(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),t.polygonsOutline),a&&new a(o,this.getSubLayerProps({id:n,updateTriggers:o.updateTriggers}),t.lines)]}return null}},{key:"_renderPointLayers",value:function(){var e=this.props.pointType,r=this.state,n=r.layerProps,i=r.binary,a=this.props.highlightedObjectIndex;!i&&Number.isFinite(a)&&(a=n.points.data.findIndex((function(e){return e.__source.index===a})));var o,s=[],l=g(new Set(e.split("+")));try{for(l.s();!(o=l.n()).done;){var u=o.value,c="points-".concat(u),d=h.POINT_LAYER[u],f=d&&this.shouldRenderSubLayer(c,n.points.data)&&this.getSubLayerClass(c,d.type);if(f){var p=(0,h.forwardProps)(this,d.props),_=n.points;if("text"===u&&i){var y=(0,t.default)(_.data.attributes,m);_=v(v({},_),{},{data:v(v({},_.data),{},{attributes:y})})}s.push(new f(p,this.getSubLayerProps({id:c,updateTriggers:p.updateTriggers,highlightedObjectIndex:a}),_))}}}catch(e){l.e(e)}finally{l.f()}return s}},{key:"renderLayers",value:function(){var e=this.props.extruded,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}},{key:"getSubLayerAccessor",value:function(e){return this.state.binary&&"function"==typeof e?function(t,r){var n=(0,d.binaryToFeatureForAccesor)(r.data,r.index);return e(n,r)}:(0,i.default)((0,s.default)(y.prototype),"getSubLayerAccessor",this).call(this,e)}}]),y}(u.CompositeLayer);return geojsonLayer.default=T,(0,l.default)(T,"layerName","GeoJsonLayer"),(0,l.default)(T,"defaultProps",x),geojsonLayer}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"ArcLayer",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"BitmapLayer",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"IconLayer",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"LineLayer",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"PointCloudLayer",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"ScatterplotLayer",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"ColumnLayer",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"GridCellLayer",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"PathLayer",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"PolygonLayer",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"GeoJsonLayer",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"TextLayer",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"SolidPolygonLayer",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"_MultiIconLayer",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(e,"_TextBackgroundLayer",{enumerable:!0,get:function(){return g.default}});var r=t(requireArcLayer()),n=t(requireBitmapLayer()),i=t(requireIconLayer()),a=t(requireLineLayer()),o=t(requirePointCloudLayer()),s=t(requireScatterplotLayer()),l=t(requireColumnLayer()),u=t(requireGridCellLayer()),c=t(requirePathLayer()),d=t(requirePolygonLayer()),h=t(requireGeojsonLayer()),f=t(requireTextLayer()),p=t(requireSolidPolygonLayer()),m=t(requireMultiIconLayer()),g=t(requireTextBackgroundLayer())}(es5$4);var es5$2={},simpleMeshLayer={},matrix={},hasRequiredMatrix;function requireMatrix(){if(hasRequiredMatrix)return matrix;hasRequiredMatrix=1,Object.defineProperty(matrix,"__esModule",{value:!0}),matrix.shouldComposeModelMatrix=function(t,r){return r===e.COORDINATE_SYSTEM.CARTESIAN||r===e.COORDINATE_SYSTEM.METER_OFFSETS||r===e.COORDINATE_SYSTEM.DEFAULT&&!t.isGeospatial},matrix.MATRIX_ATTRIBUTES=void 0;var e=es5$g;function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r=Math.PI/180,n=new Float32Array(16),i=new Float32Array(12);function a(e,t,n){var i=t[0]*r,a=t[1]*r,o=t[2]*r,s=Math.sin(o),l=Math.sin(i),u=Math.sin(a),c=Math.cos(o),d=Math.cos(i),h=Math.cos(a),f=n[0],p=n[1],m=n[2];e[0]=f*h*d,e[1]=f*u*d,e[2]=f*-l,e[3]=p*(-u*c+h*l*s),e[4]=p*(h*c+u*l*s),e[5]=p*d*s,e[6]=m*(u*s+h*l*c),e[7]=m*(-h*s+u*l*c),e[8]=m*d*c}function o(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}var s={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update:function(r,s){var l=s.startRow,u=s.endRow,c=this.props,d=c.data,h=c.getOrientation,f=c.getScale,p=c.getTranslation,m=c.getTransformMatrix,g=Array.isArray(m),_=g&&16===m.length,y=Array.isArray(f),v=Array.isArray(h),b=Array.isArray(p),x=_||!g&&Boolean(m(d[0]));r.constant=x?_:v&&y&&b;var T=r.value;if(r.constant){var w;x?(n.set(m),w=o(n)):(a(w=i,h,f),w.set(p,9)),r.value=new Float32Array(w)}else{var E,A=l*r.size,S=(0,e.createIterable)(d,l,u),P=S.objectInfo,M=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(S.iterable);try{for(M.s();!(E=M.n()).done;){var R=E.value;P.index++;var C=void 0;x?(n.set(_?m:m(R,P)),C=o(n)):(a(C=i,v?h:h(R,P),y?f:f(R,P)),C.set(b?p:p(R,P),9)),T[A++]=C[0],T[A++]=C[1],T[A++]=C[2],T[A++]=C[3],T[A++]=C[4],T[A++]=C[5],T[A++]=C[6],T[A++]=C[7],T[A++]=C[8],T[A++]=C[9],T[A++]=C[10],T[A++]=C[11]}}catch(e){M.e(e)}finally{M.f()}}}};return matrix.MATRIX_ATTRIBUTES=s,matrix}var simpleMeshLayerVertex_glsl={},hasRequiredSimpleMeshLayerVertex_glsl;function requireSimpleMeshLayerVertex_glsl(){return hasRequiredSimpleMeshLayerVertex_glsl||(hasRequiredSimpleMeshLayerVertex_glsl=1,Object.defineProperty(simpleMeshLayerVertex_glsl,"__esModule",{value:!0}),simpleMeshLayerVertex_glsl.default=void 0,simpleMeshLayerVertex_glsl.default="#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n    geometry.position = position_commonspace;\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n    geometry.position = position_commonspace;\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n  }\n\n  geometry.normal = normals_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),simpleMeshLayerVertex_glsl}var simpleMeshLayerFragment_glsl={},hasRequiredSimpleMeshLayerFragment_glsl,hasRequiredSimpleMeshLayer;function requireSimpleMeshLayerFragment_glsl(){return hasRequiredSimpleMeshLayerFragment_glsl||(hasRequiredSimpleMeshLayerFragment_glsl=1,Object.defineProperty(simpleMeshLayerFragment_glsl,"__esModule",{value:!0}),simpleMeshLayerFragment_glsl.default=void 0,simpleMeshLayerFragment_glsl.default="#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  DECKGL_FILTER_COLOR(color, geometry);\n\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n}\n"),simpleMeshLayerFragment_glsl}function requireSimpleMeshLayer(){if(hasRequiredSimpleMeshLayer)return simpleMeshLayer;hasRequiredSimpleMeshLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(simpleMeshLayer,"__esModule",{value:!0}),simpleMeshLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=es5$g,c=es5$d,d=es5$b,h=requireMatrix(),f=e(requireSimpleMeshLayerVertex_glsl()),p=e(requireSimpleMeshLayerFragment_glsl()),m=requireEs5$9();function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t){(e.COLOR_0||e.colors)&&t||(e.colors={constant:!0,value:new Float32Array([1,1,1])}),u.log.assert(e.positions||e.POSITION,'no "postions" or "POSITION" attribute in mesh')}function v(e,t){if(e.attributes)return y(e.attributes,t),e instanceof c.Geometry?e:new c.Geometry(e);if(e.positions||e.POSITION)return y(e,t),new c.Geometry({attributes:e});throw Error("Invalid mesh")}var b=function(e){(0,a.default)(x,e);var g,y,b=(g=x,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(g);if(y){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function x(){var e;(0,t.default)(this,x);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=b.call.apply(b,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(x,[{key:"getShaders",value:function(){var e=!(0,c.isWebGL2)(this.context.gl),t={};return(0,d.hasFeature)(this.context.gl,d.FEATURES.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),(0,i.default)((0,s.default)(x.prototype),"getShaders",this).call(this,{vs:f.default,fs:p.default,modules:[u.project32,u.phongLighting,u.picking],transpileToGLSL100:e,defines:t})}},{key:"getBounds",value:function(){var e;if(this.props._instanced)return(0,i.default)((0,s.default)(x.prototype),"getBounds",this).call(this);var t=this.state.positionBounds;if(t)return t;var r=this.props.mesh;if(!r)return null;if(!(t=null===(e=r.header)||void 0===e?void 0:e.boundingBox)){var n=v(r,this.props._useMeshColors).attributes;n.POSITION=n.POSITION||n.positions,t=(0,m.getMeshBoundingBox)(n)}return this.state.positionBounds=t,t}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:h.MATRIX_ATTRIBUTES}),this.setState({emptyTexture:new c.Texture2D(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(x.prototype),"updateState",this).call(this,e);var t=e.props,r=e.oldProps;if(t.mesh!==r.mesh||e.changeFlags.extensionsChanged){var n;if(this.state.positionBounds=null,null===(n=this.state.model)||void 0===n||n.delete(),t.mesh){this.state.model=this.getModel(t.mesh);var a=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(e){(0,i.default)((0,s.default)(x.prototype),"finalizeState",this).call(this,e),this.state.emptyTexture.delete()}},{key:"draw",value:function(e){if(this.state.model){var t=this.context.viewport,r=this.props,n=r.sizeScale,i=r.coordinateSystem,a=r._instanced;this.state.model.setUniforms(e.uniforms).setUniforms({sizeScale:n,composeModelMatrix:!a||(0,h.shouldComposeModelMatrix)(t,i),flatShading:!this.state.hasNormals}).draw()}}},{key:"getModel",value:function(e){var t=new c.Model(this.context.gl,_(_({},this.getShaders()),{},{id:this.props.id,geometry:v(e,this.props._useMeshColors),isInstanced:!0})),r=this.props.texture;return t.setUniforms({sampler:r||this.state.emptyTexture,hasTexture:Boolean(r)}),t}},{key:"setTexture",value:function(e){var t=this.state,r=t.model;r&&r.setUniforms({sampler:e||t.emptyTexture,hasTexture:Boolean(e)})}}]),x}(u.Layer);return simpleMeshLayer.default=b,(0,l.default)(b,"defaultProps",{mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}}),(0,l.default)(b,"layerName","SimpleMeshLayer"),simpleMeshLayer}var scenegraphLayer={},es5$1={},display={},hasRequiredDisplay;function requireDisplay(){if(hasRequiredDisplay)return display;hasRequiredDisplay=1;var e=interopRequireDefaultExports;Object.defineProperty(display,"__esModule",{value:!0}),display.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=es5$c;function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=function(){function e(){(0,r.default)(this,e),this.animationLoop=null}return(0,n.default)(e,[{key:"getViews",value:function(e){var t=e.width,r=e.height;return[{params:{viewport:[0,0,t,r],scissor:[0,0,t,r],scissorTest:!0}}]}},{key:"submitFrame",value:function(){return!0}},{key:"requestAnimationFrame",value:function(e){return!1}},{key:"delete",value:function(){}},{key:"_renderFrame",value:function(e){var t=this,r=this.getViews(e);if(!r)return!1;var n,a=this.animationLoop.gl,l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}(r);try{var u=function(){var r=n.value;(0,i.withParameters)(a,r.params,(function(){return t.animationLoop.onRender(o(o({},e),r))}))};for(l.s();!(n=l.n()).done;)u()}catch(e){l.e(e)}finally{l.f()}return this.submitFrame(),!0}}]),e}();return display.default=l,display}var vrDisplay={},vrButton={},hasRequiredVrButton,hasRequiredVrDisplay;function requireVrButton(){return hasRequiredVrButton||(hasRequiredVrButton=1,Object.defineProperty(vrButton,"__esModule",{value:!0}),vrButton.createEnterVRButton=function(e){var t=e.title,r=e.canvas.getBoundingClientRect(),n=r.top,i=r.left,a=r.width,o=r.height,s=document.createElement("div");s.style.position="absolute",s.style.top="".concat(n,"px"),s.style.left="".concat(i,"px"),s.style.width="".concat(a,"px"),s.style.height="".concat(o,"px"),s.style.pointerEvents="none",s.style.zIndex="999",document.body.appendChild(s);var l=document.createElement("button");return l.style.padding="16px",l.style.border="1px solid #fff",l.style.borderRadius="8px",l.style.background="rgba(0,0,0,0.5)",l.style.color="#fff",l.style.font="normal 20px sans-serif",l.style.cursor="pointer",l.style.margin="20px auto",l.style.display="block",l.style.pointerEvents="all",l.textContent=t,s.appendChild(l),l}),vrButton}function requireVrDisplay(){if(hasRequiredVrDisplay)return vrDisplay;hasRequiredVrDisplay=1;var e=interopRequireDefaultExports;Object.defineProperty(vrDisplay,"__esModule",{value:!0}),vrDisplay.default=void 0;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireAssertThisInitialized()),o=e(requireGet()),s=e(requireInherits()),l=e(requirePossibleConstructorReturn()),u=e(requireGetPrototypeOf()),c=es5$b,d=e(requireDisplay()),h=requireVrButton(),f=function(e){(0,s.default)(g,e);var d,f,p,m=(f=g,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,u.default)(f);if(p){var r=(0,u.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,l.default)(this,e)});function g(e){var t;return(0,n.default)(this,g),(t=m.call(this,e))._vrSupported=g.isSupported(),t._vrSupported&&(t.vrFrameData=new window.VRFrameData,t.vrPresenting=!1,t.vrFrame=!1,window.addEventListener("vrdisplaypresentchange",t._vrDisplayPresentChange.bind((0,a.default)(t)))),t}return(0,i.default)(g,[{key:"delete",value:function(){(0,o.default)((0,u.default)(g.prototype),"delete",this).call(this),this._removeVRButton()}},{key:"getViews",value:function(e){if(this._vrSupported&&this._addVRButton(),this.vrPresenting&&this.vrFrame){this.vrDisplay.getFrameData(this.vrFrameData);var t=this.vrFrameData,r=e.width,n=e.height;return[{displayEye:"left",projectionMatrix:t.leftProjectionMatrix,viewMatrix:t.leftViewMatrix,params:{viewport:[0,0,.5*r,n],scissor:[0,0,.5*r,n],scissorTest:!0}},{displayEye:"right",projectionMatrix:t.rightProjectionMatrix,viewMatrix:t.rightViewMatrix,params:{viewport:[.5*r,0,.5*r,n],scissor:[.5*r,0,.5*r,n],scissorTest:!0}}]}return(0,o.default)((0,u.default)(g.prototype),"getViews",this).call(this,e)}},{key:"submitFrame",value:function(){return!(!this.vrPresenting||!this.vrFrame||(this.vrDisplay.submitFrame(),0))}},{key:"requestAnimationFrame",value:function(e){var t=this;return!!this.vrPresenting&&(this.vrDisplay.requestAnimationFrame((function(){t.vrFrame=!0,e(),t.vrFrame=!1})),!0)}},{key:"_addVRButton",value:(d=(0,r.default)(t.default.mark((function e(){var r,n,i=this;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.vrButton){e.next=2;break}return e.abrupt("return");case 2:if(r=this._getCanvas()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,navigator.getVRDisplays();case 7:(n=e.sent)&&n.length&&(c.log.info(2,"Found VR Displays",n)(),this.vrDisplay=n[0],this.vrButton=(0,h.createEnterVRButton)({canvas:r,title:"Enter VR (".concat(this.vrDisplay.displayName,")")}),this.vrButton.onclick=function(){return i._startDisplay()});case 9:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"_getCanvas",value:function(){return this.animationLoop.canvas||this.animationLoop.gl&&this.animationLoop.gl.canvas}},{key:"_removeVRButton",value:function(){}},{key:"_startDisplay",value:function(){this.vrDisplay.requestPresent([{source:this._getCanvas()}])}},{key:"_vrDisplayPresentChange",value:function(){this.vrDisplay.isPresenting?(c.log.info(2,"Entering VR")(),this.vrPresenting=!0,this.vrButton.style.display="none"):(c.log.info(2,"Exiting VR")(),this.vrPresenting=!1,this.vrButton.style.display="block")}}],[{key:"isSupported",value:function(){return"undefined"!=typeof navigator&&"getVRDisplays"in navigator&&"VRFrameData"in window}}]),g}(d.default);return vrDisplay.default=f,vrDisplay}var gltfEnvironment={},hasRequiredGltfEnvironment;function requireGltfEnvironment(){if(hasRequiredGltfEnvironment)return gltfEnvironment;hasRequiredGltfEnvironment=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfEnvironment,"__esModule",{value:!0}),gltfEnvironment.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=es5$b,a=requireEs5$8(),o=function(){function e(t,n){var i=n.brdfLutUrl,a=n.getTexUrl,o=n.specularMipLevels,s=void 0===o?10:o;(0,r.default)(this,e),this.gl=t,this.brdfLutUrl=i,this.getTexUrl=a,this.specularMipLevels=s}return(0,n.default)(e,[{key:"makeCube",value:function(e){var t=e.id,r=e.getTextureForFace,n=e.parameters,a={};return i.TextureCube.FACES.forEach((function(e){a[e]=r(e)})),new i.TextureCube(this.gl,{id:t,mipmaps:!1,parameters:n,pixels:a})}},{key:"getDiffuseEnvSampler",value:function(){var e,r=this;return this._DiffuseEnvSampler||(this._DiffuseEnvSampler=this.makeCube({id:"DiffuseEnvSampler",getTextureForFace:function(e){return(0,a.loadImage)(r.getTexUrl("diffuse",e,0))},parameters:(e={},(0,t.default)(e,10242,33071),(0,t.default)(e,10243,33071),(0,t.default)(e,10241,9729),(0,t.default)(e,10240,9729),e)})),this._DiffuseEnvSampler}},{key:"getSpecularEnvSampler",value:function(){var e,r=this;return this._SpecularEnvSampler||(this._SpecularEnvSampler=this.makeCube({id:"SpecularEnvSampler",getTextureForFace:function(e){for(var t=[],n=0;n<=r.specularMipLevels-1;n++)t.push((0,a.loadImage)(r.getTexUrl("specular",e,n)));return t},parameters:(e={},(0,t.default)(e,10242,33071),(0,t.default)(e,10243,33071),(0,t.default)(e,10241,9987),(0,t.default)(e,10240,9729),e)})),this._SpecularEnvSampler}},{key:"getBrdfTexture",value:function(){var e;return this._BrdfTexture||(this._BrdfTexture=new i.Texture2D(this.gl,{id:"brdfLUT",parameters:(e={},(0,t.default)(e,10242,33071),(0,t.default)(e,10243,33071),(0,t.default)(e,10241,9729),(0,t.default)(e,10240,9729),e),data:(0,a.loadImage)(this.brdfLutUrl)})),this._BrdfTexture}},{key:"delete",value:function(){this._DiffuseEnvSampler&&(this._DiffuseEnvSampler.delete(),this._DiffuseEnvSampler=null),this._SpecularEnvSampler&&(this._SpecularEnvSampler.delete(),this._SpecularEnvSampler=null),this._BrdfTexture&&(this._BrdfTexture.delete(),this._BrdfTexture=null)}}]),e}();return gltfEnvironment.default=o,gltfEnvironment}var createGltfObjects={},gltfInstantiator={},groupNode={},scenegraphNode={},hasRequiredScenegraphNode,hasRequiredGroupNode;function requireScenegraphNode(){if(hasRequiredScenegraphNode)return scenegraphNode;hasRequiredScenegraphNode=1;var e=interopRequireDefaultExports;Object.defineProperty(scenegraphNode,"__esModule",{value:!0}),scenegraphNode.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$q,i=es5$b,a=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,t.default)(this,e),this.id=r.id||(0,i.uid)(this.constructor.name),this.display=!0,this.position=new n.Vector3,this.rotation=new n.Vector3,this.scale=new n.Vector3(1,1,1),this.matrix=new n.Matrix4,this.userData={},this.props={},this._setScenegraphNodeProps(r)}return(0,r.default)(e,[{key:"delete",value:function(){}},{key:"setProps",value:function(e){return this._setScenegraphNodeProps(e),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"getBounds",value:function(){return null}},{key:"setPosition",value:function(e){return(0,i.assert)(3===e.length,"setPosition requires vector argument"),this.position=e,this}},{key:"setRotation",value:function(e){return(0,i.assert)(3===e.length,"setRotation requires vector argument"),this.rotation=e,this}},{key:"setScale",value:function(e){return(0,i.assert)(3===e.length,"setScale requires vector argument"),this.scale=e,this}},{key:"setMatrix",value:function(e){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this.matrix=e:this.matrix.copy(e)}},{key:"setMatrixComponents",value:function(e){var t=e.position,r=e.rotation,n=e.scale,i=e.update,a=void 0===i||i;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),a&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.position,r=e.rotation,n=e.scale;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(e,t){(0,i.assert)(e),t=t||this.matrix;var r=new n.Matrix4(e).multiplyRight(t),a=r.invert(),o=a.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:a,worldInverseTransposeMatrix:o}}},{key:"_setScenegraphNodeProps",value:function(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}]),e}();return scenegraphNode.default=a,scenegraphNode}function requireGroupNode(){if(hasRequiredGroupNode)return groupNode;hasRequiredGroupNode=1;var e=interopRequireDefaultExports;Object.defineProperty(groupNode,"__esModule",{value:!0}),groupNode.default=void 0;var t=e(requireSlicedToArray()),r=e(requireToConsumableArray()),n=e(requireClassCallCheck()),i=e(requireCreateClass()),a=e(requireGet()),o=e(requireInherits()),s=e(requirePossibleConstructorReturn()),l=e(requireGetPrototypeOf()),u=es5$q,c=es5$b,d=e(requireScenegraphNode());function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f=function(e){(0,o.default)(g,e);var f,p,m=(f=g,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,l.default)(f);if(p){var r=(0,l.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,s.default)(this,e)});function g(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,g);var r=(t=Array.isArray(t)?{children:t}:t).children,i=void 0===r?[]:r;return c.log.assert(i.every((function(e){return e instanceof d.default})),"every child must an instance of ScenegraphNode"),(e=m.call(this,t)).children=i,e}return(0,i.default)(g,[{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,a=t;i<a.length;i++){var o=a[i];Array.isArray(o)?this.add.apply(this,(0,r.default)(o)):this.children.push(o)}return this}},{key:"remove",value:function(e){var t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach((function(e){return e.delete()})),this.removeAll(),(0,a.default)((0,l.default)(g.prototype),"delete",this).call(this)}},{key:"getBounds",value:function(){var e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((function(r,n){var i=n.worldMatrix,a=r.getBounds();if(a){var o=(0,t.default)(a,2),s=o[0],l=o[1],c=new u.Vector3(s).add(l).divide([2,2,2]);i.transformAsPoint(c,c);var d=new u.Vector3(l).subtract(s).divide([2,2,2]);i.transformAsVector(d,d);for(var h=0;h<8;h++)for(var f=new u.Vector3(1&h?-1:1,2&h?-1:1,4&h?-1:1).multiply(d).add(c),p=0;p<3;p++)e[0][p]=Math.min(e[0][p],f[p]),e[1][p]=Math.max(e[1][p],f[p])}})),Number.isFinite(e[0][0])?e:null}},{key:"traverse",value:function(e){var t,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).worldMatrix,n=void 0===r?new u.Matrix4:r,i=new u.Matrix4(n).multiplyRight(this.matrix),a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.children);try{for(a.s();!(t=a.n()).done;){var o=t.value;o instanceof g?o.traverse(e,{worldMatrix:i}):e(o,{worldMatrix:i})}}catch(e){a.e(e)}finally{a.f()}}}]),g}(d.default);return groupNode.default=f,groupNode}var gltfAnimator={},hasRequiredGltfAnimator;function requireGltfAnimator(){if(hasRequiredGltfAnimator)return gltfAnimator;hasRequiredGltfAnimator=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfAnimator,"__esModule",{value:!0}),gltfAnimator.default=gltfAnimator.ATTRIBUTE_TYPE_TO_COMPONENTS=gltfAnimator.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$b,i=es5$q,a={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};gltfAnimator.ATTRIBUTE_TYPE_TO_COMPONENTS=a;var o={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function s(e){if(!e._animation){var t=a[e.type],r=e.bufferView.data,n=new(0,o[e.componentType])(r.buffer,r.byteOffset+(e.byteOffset||0),t*e.count);if(1===t)e._animation=Array.from(n);else{for(var i=[],s=0;s<n.length;s+=t)i.push(Array.from(n.slice(s,s+t)));e._animation=i}}return e._animation}gltfAnimator.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=o;var l=new i.Matrix4,u=new i.Quaternion,c=function(){function e(r){(0,t.default)(this,e),this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,r)}return(0,r.default)(e,[{key:"animate",value:function(e){if(this.playing){var t=(e/1e3-this.startTime)*this.speed;this.channels.forEach((function(e){var r=e.target;(function(e,t,r,i){var a=t.input,o=t.interpolation,s=t.output,l=e%a[a.length-1],c=a.findIndex((function(e){return e>=l})),d=Math.max(0,c-1);if(!Array.isArray(r[i]))switch(i){case"translation":r[i]=[0,0,0];break;case"rotation":r[i]=[0,0,0,1];break;case"scale":r[i]=[1,1,1];break;default:n.log.warn("Bad animation path ".concat(i))()}(0,n.assert)(r[i].length===s[d].length);var h=a[d],f=a[c];switch(o){case"STEP":!function(e,t,r){for(var n=0;n<r.length;n++)e[t][n]=r[n]}(r,i,s[d]);break;case"LINEAR":f>h&&function(e,t,r,n,i){if("rotation"===t){u.slerp({start:r,target:n,ratio:i});for(var a=0;a<u.length;a++)e[t][a]=u[a]}else for(var o=0;o<r.length;o++)e[t][o]=i*n[o]+(1-i)*r[o]}(r,i,s[d],s[c],(l-h)/(f-h));break;case"CUBICSPLINE":f>h&&function(e,t,r){for(var n=r.p0,i=r.outTangent0,a=r.inTangent1,o=r.p1,s=r.tDiff,l=r.ratio,u=0;u<e[t].length;u++){var c=i[u]*s,d=a[u]*s;e[t][u]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*n[u]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*c+(-2*Math.pow(l,3)+3*Math.pow(l,2))*o[u]+(Math.pow(l,3)-Math.pow(l,2))*d}}(r,i,{p0:s[3*d+1],outTangent0:s[3*d+2],inTangent1:s[3*c+0],p1:s[3*c+1],tDiff:f-h,ratio:(l-h)/(f-h)});break;default:n.log.warn("Interpolation ".concat(o," not supported"))()}})(t,e.sampler,r,e.path),function(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){var r=l.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}(r,r._node)}))}}}]),e}(),d=function(){function e(r){(0,t.default)(this,e),this.animations=r.animations.map((function(e,t){var n=e.name||"Animation-".concat(t),i=e.samplers.map((function(e){var t=e.interpolation,n=void 0===t?"LINEAR":t,i=e.output;return{input:s(r.accessors[e.input]),interpolation:n,output:s(r.accessors[i])}})),a=e.channels.map((function(e){var t=e.target;return{sampler:i[e.sampler],target:r.nodes[t.node],path:t.path}}));return new c({name:n,channels:a})}))}return(0,r.default)(e,[{key:"animate",value:function(e){this.setTime(e)}},{key:"setTime",value:function(e){this.animations.forEach((function(t){return t.animate(e)}))}},{key:"getAnimations",value:function(){return this.animations}}]),e}();return gltfAnimator.default=d,gltfAnimator}var createGltfModel={},modelNode={},hasRequiredModelNode;function requireModelNode(){if(hasRequiredModelNode)return modelNode;hasRequiredModelNode=1;var e=interopRequireDefaultExports;Object.defineProperty(modelNode,"__esModule",{value:!0}),modelNode.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireGet()),i=e(requireInherits()),a=e(requirePossibleConstructorReturn()),o=e(requireGetPrototypeOf()),s=es5$9,l=function(e){(0,i.default)(d,e);var l,u,c=(l=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.default)(l);if(u){var r=(0,o.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,a.default)(this,e)});function d(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.default)(this,d),(r=c.call(this,n)).onBeforeRender=null,r.AfterRender=null,e instanceof s.Model?(r.model=e,r._setModelNodeProps(n)):r.model=new s.Model(e,n),r.bounds=null,r.managedResources=n.managedResources||[],r}return(0,r.default)(d,[{key:"setProps",value:function(e){return(0,n.default)((0,o.default)(d.prototype),"setProps",this).call(this,e),this._setModelNodeProps(e),this}},{key:"getBounds",value:function(){return this.bounds}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach((function(e){return e.delete()})),this.managedResources=[]}},{key:"draw",value:function(){var e;return(e=this.model).draw.apply(e,arguments)}},{key:"setUniforms",value:function(){var e;return(e=this.model).setUniforms.apply(e,arguments),this}},{key:"setAttributes",value:function(){var e;return(e=this.model).setAttributes.apply(e,arguments),this}},{key:"updateModuleSettings",value:function(){var e;return(e=this.model).updateModuleSettings.apply(e,arguments),this}},{key:"_setModelNodeProps",value:function(e){this.model.setProps(e)}}]),d}(e(requireScenegraphNode()).default);return modelNode.default=l,modelNode}var gltfMaterialParser={},hasRequiredGltfMaterialParser,hasRequiredCreateGltfModel,hasRequiredGltfInstantiator,hasRequiredCreateGltfObjects;function requireGltfMaterialParser(){if(hasRequiredGltfMaterialParser)return gltfMaterialParser;hasRequiredGltfMaterialParser=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfMaterialParser,"__esModule",{value:!0}),gltfMaterialParser.default=void 0;var t=e(requireDefineProperty()),r=e(requireClassCallCheck()),n=e(requireCreateClass()),i=es5$b;function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function(){function e(t,n){var a=n.attributes,o=n.material,s=n.pbrDebug,l=n.imageBasedLightingEnvironment,u=n.lights,c=n.useTangents;(0,r.default)(this,e),this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},(0,i.hasFeature)(t,i.FEATURES.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],l&&(this.uniforms.u_DiffuseEnvSampler=l.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=l.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=l.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),s&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(a.NORMAL,"HAS_NORMALS"),this.defineIfPresent(a.TANGENT&&c,"HAS_TANGENTS"),this.defineIfPresent(a.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(l,"USE_IBL"),this.defineIfPresent(u,"USE_LIGHTS"),this.defineIfPresent(s,"PBR_DEBUG"),o&&this.parseMaterial(o)}return(0,n.default)(e,[{key:"defineIfPresent",value:function(e,t){e&&(this.defines[t]=1)}},{key:"parseTexture",value:function(e,r){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},l=e.texture.source.image,u={};l.compressed?(n=l,u=(0,t.default)({},this.gl.TEXTURE_MIN_FILTER,l.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR)):n={data:l};var c=new i.Texture2D(this.gl,o({id:e.name||e.id,parameters:o(o({},s),u),pixelStore:(0,t.default)({},this.gl.UNPACK_FLIP_Y_WEBGL,!1)},n));this.uniforms[r]=c,this.defineIfPresent(a,a),this.generatedTextures.push(c)}},{key:"parsePbrMetallicRoughness",value:function(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");var t=e.metallicFactor,r=e.roughnessFactor;this.uniforms.u_MetallicRoughnessValues=[void 0===t?1:t,void 0===r?1:r]}},{key:"parseMaterial",value:function(e){if(this.uniforms.pbr_uUnlit=Boolean(e.unlit),e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");var t=e.normalTexture.scale;this.uniforms.u_NormalScale=void 0===t?1:t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");var r=e.occlusionTexture.strength;this.uniforms.u_OcclusionStrength=void 0===r?1:r}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),"MASK"===e.alphaMode){var n=e.alphaCutoff,a=void 0===n?.5:n;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=a}else"BLEND"===e.alphaMode&&(i.log.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}},{key:"delete",value:function(){this.generatedTextures.forEach((function(e){return e.delete()}))}}]),e}();return gltfMaterialParser.default=s,gltfMaterialParser}function requireCreateGltfModel(){if(hasRequiredCreateGltfModel)return createGltfModel;hasRequiredCreateGltfModel=1;var e=interopRequireDefaultExports;Object.defineProperty(createGltfModel,"__esModule",{value:!0}),createGltfModel.default=function(e,t){var n=t.id,l=t.drawMode,f=t.vertexCount,p=t.attributes,m=t.modelOptions,g=new s.default(e,t);i.log.info(4,"createGLTFModel defines: ",g.defines)();var _=[];_.push.apply(_,(0,r.default)(g.generatedTextures)),_.push.apply(_,(0,r.default)(Object.values(p).map((function(e){return e.buffer}))));var y=new o.default(e,u(u({id:n,drawMode:l,vertexCount:f,modules:[a.pbr],parameters:g.parameters,vs:h(e,c),fs:h(e,d),managedResources:_},m),{},{defines:u(u({},g.defines),m.defines)}));return y.setProps({attributes:p}),y.setUniforms(g.uniforms),y};var t=e(requireDefineProperty()),r=e(requireToConsumableArray()),n=es5$c,i=es5$b,a=es5$8,o=e(requireModelNode()),s=e(requireGltfMaterialParser());function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?l(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c="\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n",d="\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n";function h(e,t){return(0,n.isWebGL2)(e)?"#version 300 es\n".concat(t):t}return createGltfModel}function requireGltfInstantiator(){if(hasRequiredGltfInstantiator)return gltfInstantiator;hasRequiredGltfInstantiator=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfInstantiator,"__esModule",{value:!0}),gltfInstantiator.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=es5$q,i=es5$b,a=e(requireGroupNode()),o=e(requireGltfAnimator()),s=e(requireCreateGltfModel()),l={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},u={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},c=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),this.gl=r,this.options=Object.assign({},u,n)}return(0,r.default)(e,[{key:"instantiate",value:function(e){var t=this;return this.gltf=e,(e.scenes||[]).map((function(e){return t.createScene(e)}))}},{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new o.default(this.gltf):null}},{key:"createScene",value:function(e){var t=this,r=(e.nodes||[]).map((function(e){return t.createNode(e)}));return new a.default({id:e.name||e.id,children:r})}},{key:"createNode",value:function(e){var t=this;if(!e._node){var r=(e.children||[]).map((function(e){return t.createNode(e)}));e.mesh&&r.push(this.createMesh(e.mesh));var i=new a.default({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){var o=(new n.Matrix4).fromQuaternion(e.rotation);i.matrix.multiplyRight(o)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}},{key:"createMesh",value:function(e){var t=this;if(!e._mesh){var r=(e.primitives||[]).map((function(r,n){return t.createPrimitive(r,n,e)})),n=new a.default({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}},{key:"getVertexCount",value:function(e){i.log.warn("getVertexCount() not found")()}},{key:"createPrimitive",value:function(e,t,r){var n=(0,s.default)(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}},{key:"createAttributes",value:function(e,t){var r=this,n={};return Object.keys(e).forEach((function(t){n[t]=r.createAccessor(e[t],r.createBuffer(e[t],r.gl.ARRAY_BUFFER))})),t&&(n.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),i.log.info(4,"glTF Attributes",{attributes:e,indices:t,generated:n})(),n}},{key:"createBuffer",value:function(e,t){e.bufferView||(e.bufferView={});var r=e.bufferView;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=new i.Buffer(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:t})),r.lumaBuffers[t]}},{key:"createAccessor",value:function(e,t){return new i.Accessor({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:l[e.type]})}},{key:"createSampler",value:function(e){return e}},{key:"needsPOT",value:function(){return!1}}]),e}();return gltfInstantiator.default=c,gltfInstantiator}function requireCreateGltfObjects(){if(hasRequiredCreateGltfObjects)return createGltfObjects;hasRequiredCreateGltfObjects=1;var e=interopRequireDefaultExports;Object.defineProperty(createGltfObjects,"__esModule",{value:!0}),createGltfObjects.default=function(e,r,n){var i=new t.default(e,n);return{scenes:i.instantiate(r),animator:i.createAnimator()}};var t=e(requireGltfInstantiator());return createGltfObjects}var histopyramid={},histopyramidShaders={},hasRequiredHistopyramidShaders,hasRequiredHistopyramid;function requireHistopyramidShaders(){return hasRequiredHistopyramidShaders||(hasRequiredHistopyramidShaders=1,Object.defineProperty(histopyramidShaders,"__esModule",{value:!0}),histopyramidShaders.HISTOPYRAMID_TRAVERSAL_VS=histopyramidShaders.HISTOPYRAMID_TRAVERSAL_UTILS=histopyramidShaders.HISTOPYRAMID_BUILD_VS_UTILS=histopyramidShaders.HISTOPYRAMID_BUILD_VS=histopyramidShaders.HISTOPYRAMID_BASE_BUILD_VS=void 0,histopyramidShaders.HISTOPYRAMID_BUILD_VS_UTILS="// Get current pixel indices for a given size\nvec2 histoPyramid_getPixelIndices(vec2 size) {\n  vec2 pixelOffset = transform_getPixelSizeHalf(size);\n  vec2 pixelIndices = transform_getPixelIndices(size, pixelOffset);\n  return pixelIndices;\n}\n\n// returns the top left texture coordiante corresponding to 2X2 block in higher level texture.\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec2 histoPyramid_getTexCoord(vec2 size, vec2 scale, vec2 offset) {\n  // use actual (scaled) texture size to calcualte offset (multiplied by scale)\n  vec2 scaledSize = size * scale;\n\n  // use minified texture size to find corresponding pixel index in out texture\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n\n  // now scale the indices to point to correct 2X2 block\n  pixelIndices = pixelIndices * scale;\n\n  // generate tex coordinate using actual size\n  vec2 texCoord = pixelIndices / scaledSize;\n  vec2 inPixelOffset = transform_getPixelSizeHalf(scaledSize);\n\n  return texCoord + (offset / scaledSize) + inPixelOffset;\n}\n\n// returns pixel value from higher level texture based on scale and offset\n// texSampler: higher level texture sampler\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec4 histoPyramid_getInput(sampler2D texSampler, vec2 size, vec2 scale, vec2 offset) {\n  vec2 texCoord = histoPyramid_getTexCoord(size, scale, offset);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",histopyramidShaders.HISTOPYRAMID_BUILD_VS="attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  vec2 scale = vec2(2., 2.);\n  vec4 pixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0));\n  vec4 rightPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0));\n  vec4 bottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1));\n  vec4 rightBottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1));\n  // outTexture = pixel + rightPixel + bottomPixel + rightBottomPixel;\n  outTexture = vec4(\n    pixel.r + pixel.g + pixel.b + pixel.a,\n    rightPixel.r + rightPixel.g + rightPixel.b + rightPixel.a,\n    bottomPixel.r + bottomPixel.g + bottomPixel.b + bottomPixel.a,\n    rightBottomPixel.r + rightBottomPixel.g + rightBottomPixel.b + rightBottomPixel.a\n  );\n}\n",histopyramidShaders.HISTOPYRAMID_BASE_BUILD_VS="attribute vec4 inTexture;\nvarying vec4 outTexture;\nuniform int channel;\nuniform vec4 padingPixelValue;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  // vec2 scale = vec2(2., 2.);\n  vec2 scale = transform_uSize_inTexture / transform_uSize_outTexture;\n\n  // Verify if reference to a input texture pixel is out of bounds, if so treat the pixel as (0, 0)\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n  // now scale the indices padded size to point to correct 2X2 block\n  pixelIndices = pixelIndices * vec2(2, 2);\n\n  vec2 baseLevelSize = transform_uSize_inTexture;\n\n  // For all pixels outside of original texture size, return paddingPixelValue\n  bool xInside = pixelIndices.x < baseLevelSize.x;\n  bool yInside = pixelIndices.y < baseLevelSize.y;\n  bool xPlusOneInside = pixelIndices.x + 1. < baseLevelSize.x;\n  bool yPlusOneInside = pixelIndices.y + 1. < baseLevelSize.y;\n\n  vec4 pixel = (xInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0))\n    : padingPixelValue;\n\n  vec4 rightPixel = (xPlusOneInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0))\n    : padingPixelValue;\n\n  vec4 topPixel = (xInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1))\n    : padingPixelValue;\n\n  vec4 rightTopPixel = (xPlusOneInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1))\n    : padingPixelValue;\n\n  if (channel == 0) {\n    outTexture = vec4(pixel.r, rightPixel.r, topPixel.r, rightTopPixel.r);\n  }\n  if (channel == 1) {\n    outTexture = vec4(pixel.g, rightPixel.g, topPixel.g, rightTopPixel.g);\n  }\n  if (channel == 2) {\n    outTexture = vec4(pixel.b, rightPixel.b, topPixel.b, rightTopPixel.b);\n  }\n  if (channel == 3) {\n    outTexture = vec4(pixel.a, rightPixel.a, topPixel.a, rightTopPixel.a);\n  }\n}\n",histopyramidShaders.HISTOPYRAMID_TRAVERSAL_UTILS="// Check 2X2 texture block to find relative index the given key index falls into\n// 2X2 block is represented by a single RGBA weight\nint histopyramid_traversal_findRangeIndex(float currentKey, vec4 weights, out float lowerBound) {\n  lowerBound = 0.;\n  float higherBound = 0.;\n  int relativeIndex = 0;\n  for (int i = 0; i < 4; i++) {\n    higherBound = lowerBound + weights[i];\n    relativeIndex = i;\n    if (currentKey >= lowerBound && currentKey < higherBound) {\n      break;\n    }\n    lowerBound = higherBound;\n  }\n  return relativeIndex;\n}\n\n// Maps index in 2X2 block to texture coordiante\n// Assumes the traversal order of lower-left -> lower->right -> upper-left -> upper->right\nvec2 histopyramid_traversal_mapIndexToCoord(int index) {\n  // relativeIndex ->  relativeCoordiante\n  // 0 -> (0, 0)\n  // 1 -> (1, 0)\n  // 2 -> (0, 1)\n  // 3 -> (1, 1)\n  float relativeX = mod(float(index), 2.);\n  float relativeY = (index > 1) ? 1. : 0.;\n  return vec2(relativeX, relativeY);\n}\n\n// Reads weight value from flat histopyramid\nvec4 histopyramid_traversal_getWeight(sampler2D flatPyramid, vec2 size, int level, int numLevels, vec2 offset) {\n  // horizontal offset in flat pyramid for current level\n  float xOffset = pow(2., float(numLevels)) - pow(2., float(numLevels - level));\n  vec2 lowerLeft = vec2(xOffset, 0.);\n  vec2 pixelIndices = lowerLeft + offset;\n\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 coord = pixelIndices / size + pixelSizeHalf;\n\n  return texture2D(flatPyramid, coord);\n}\n",histopyramidShaders.HISTOPYRAMID_TRAVERSAL_VS="attribute float keyIndex;\nattribute vec4 flatPyramidTexture;\nvarying vec4 locationAndIndex;\nconst int MAX_LEVELS = 12; // assuming max texture size of 4K\n\nuniform int numLevels;\n\nvoid main()\n{\n  vec2 p = vec2(0., 0.);\n  float currentKey = keyIndex;\n  // for(int level = numLevels - 1; level <= 0; level--) {\n  for(int i = 1; i <= MAX_LEVELS; i++) {\n    int level = numLevels - i;\n    // #1. Get the current pixel values based on current level and current p\n    vec4 weights = histopyramid_traversal_getWeight(transform_uSampler_flatPyramidTexture, transform_uSize_flatPyramidTexture, level, numLevels, p);\n\n    // #2. Check the all weights in current 2X2 (4 values in RGBA channels) and determine the relative coordinate\n    float lowerBound = 0.;\n    int relativeIndex = histopyramid_traversal_findRangeIndex(currentKey, weights, lowerBound);\n    vec2 relativeCoord = histopyramid_traversal_mapIndexToCoord(relativeIndex);\n\n    //#3. Update P and key-index\n    p = 2.0 * p + relativeCoord;\n    currentKey -= lowerBound;\n    if (level == 0) { break; } // Work around for const expression restriction on for loops\n  }\n  locationAndIndex = vec4(p, currentKey, keyIndex);\n}\n"),histopyramidShaders}function requireHistopyramid(){if(hasRequiredHistopyramid)return histopyramid;hasRequiredHistopyramid=1;var e=interopRequireDefaultExports;Object.defineProperty(histopyramid,"__esModule",{value:!0}),histopyramid.buildHistopyramidBaseLevel=s,histopyramid.getHistoPyramid=l,histopyramid.histoPyramidGenerateIndices=function(e,t){var a=l(e,t),o=a.flatPyramidTexture,s=a.levelCount,u=a.topLevelData,c=u[0]+u[1]+u[2]+u[3],d=new r.Buffer(e,new Float32Array(c).map((function(e,t){return t}))),h=new r.Buffer(e,4*c*4);return new n.Transform(e,{sourceBuffers:{keyIndex:d},_sourceTextures:{flatPyramidTexture:o},feedbackBuffers:{locationAndIndex:h},varyings:["locationAndIndex"],vs:"".concat(i.HISTOPYRAMID_TRAVERSAL_UTILS).concat(i.HISTOPYRAMID_TRAVERSAL_VS),elementCount:c}).run({uniforms:{numLevels:s}}),{locationAndIndexBuffer:h}};var t=e(requireDefineProperty()),r=es5$b,n=es5$9,i=requireHistopyramidShaders();function a(e){var t=Math.ceil(Math.log2(e));return Math.pow(2,t)}var o={r:0,x:0,g:1,y:1,b:2,z:2,a:3,w:3};function s(e,s){var l,u,c=s.texture,d=s.channel,h=void 0===d?"r":d,f=s._readData,p=void 0!==f&&f,m=c.width,g=c.height,_=((m=a(m))>(g=a(g))?m:g)/2,y=(0,r.cloneTextureFrom)(c,{width:_,height:_}),v=new n.Transform(e,{_sourceTextures:{inTexture:c},_targetTexture:y,_targetTextureVarying:"outTexture",vs:"".concat(i.HISTOPYRAMID_BUILD_VS_UTILS).concat(i.HISTOPYRAMID_BASE_BUILD_VS),elementCount:y.width*y.height});v.run({uniforms:{channel:o[h]||0,padingPixelValue:[0,0,0,0]}}),(p||1===_)&&(u=v.getData({packed:!0}));var b=2*_,x=(0,r.cloneTextureFrom)(c,{width:b,height:b,parameters:(l={},(0,t.default)(l,10240,9728),(0,t.default)(l,10241,9728),l)}),T=v.getFramebuffer();return(0,r.copyToTexture)(T,x,{targetX:0,width:_,height:_}),{textureData:u,baseTexture:y,flatPyramidTexture:x}}function l(e,t){var a=s(e,t),o=a.textureData,l=a.baseTexture,u=a.flatPyramidTexture,c=l.width,d=Math.log2(c)+1,h=[l],f=o;if(d>1){for(var p=1;p<d;p++){var m=c/Math.pow(2,p);h.push((0,r.cloneTextureFrom)(l,{width:m,height:m}))}for(var g=new n.Transform(e,{_sourceTextures:{inTexture:h[0]},_targetTexture:h[1],_targetTextureVarying:"outTexture",vs:"".concat(i.HISTOPYRAMID_BUILD_VS_UTILS).concat(i.HISTOPYRAMID_BUILD_VS),elementCount:h[1].width*h[1].height}),_=c,y=1;y<d;y++){var v=[h[y].width,h[y].height];g.update({_sourceTextures:{inTexture:h[y-1]},_targetTexture:h[y],elementCount:h[y].width*h[y].height}),g.run();var b=g.getFramebuffer();(0,r.copyToTexture)(b,u,{targetX:_,width:v[0],height:v[1]}),_+=v[0]}f=g.getData()}return{pyramidTextures:h,flatPyramidTexture:u,levelCount:d,topLevelData:f}}return histopyramid}var gpuPointInPolygon={},textureFilter={},hasRequiredTextureFilter;function requireTextureFilter(){if(hasRequiredTextureFilter)return textureFilter;hasRequiredTextureFilter=1;var e=interopRequireDefaultExports;Object.defineProperty(textureFilter,"__esModule",{value:!0}),textureFilter.default=void 0;var t=e(requireSlicedToArray()),r={name:"texture-filter",vs:"\nuniform vec4 textureFilter_uBoundingBox; //[xMin, yMin, xSize, ySize]\nuniform sampler2D textureFilter_uTexture;\nvec2 textureFilter_filter(vec2 position) {\n  vec2 filterValueIndex;\n  // Transfrom 'pos' to texture coordinate\n  vec2 pos = position - textureFilter_uBoundingBox.xy;\n  pos = pos / textureFilter_uBoundingBox.zw;\n  filterValueIndex.y = float(gl_VertexID);\n  if (pos.x < 0. || pos.x > 1. || pos.y < 0. || pos.y > 1.) {\n    filterValueIndex.x = -1.;\n  } else {\n    // Red channel is ID, Green channel inside/outside polygon\n    vec4 color = texture(textureFilter_uTexture, pos.xy);\n    filterValueIndex.x = color.g > 0. ? color.r : -1.;\n  }\n  return filterValueIndex;\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={};if(e.boundingBox){var n=(0,t.default)(e.boundingBox,4),i=n[0],a=n[1];r.textureFilter_uBoundingBox=[i,a,n[2]-i,n[3]-a]}return e.texture&&(r.textureFilter_uTexture=e.texture),r}};return textureFilter.default=r,textureFilter}var shaders={},hasRequiredShaders;function requireShaders(){return hasRequiredShaders||(hasRequiredShaders=1,Object.defineProperty(shaders,"__esModule",{value:!0}),shaders.POLY_TEX_VS=shaders.FILTER_VS=void 0,shaders.POLY_TEX_VS="uniform vec4 boundingBoxOriginSize; //[xMin, yMin, xSize, ySize]\nattribute vec2 a_position;\nattribute float a_polygonID;\nvarying vec4 v_polygonColor;\nvoid main()\n{\n    // translate from bbox to NDC\n    vec2 pos = a_position - boundingBoxOriginSize.xy;\n    pos = pos / boundingBoxOriginSize.zw;\n    pos = pos * 2.0 - vec2(1.0);\n    gl_Position = vec4(pos, 0.0, 1.0);\n    v_polygonColor = vec4(a_polygonID, 1.0, 1.0, 1.0);\n}\n",shaders.FILTER_VS="#version 300 es\nin vec2 a_position;\nout vec2 filterValueIndex; //[x: 0 (outside polygon)/1 (inside), y: position index]\nvoid main()\n{\n  filterValueIndex = textureFilter_filter(a_position);\n}\n"),shaders}var polygon={},hasRequiredPolygon,hasRequiredGpuPointInPolygon;function requirePolygon(){if(hasRequiredPolygon)return polygon;hasRequiredPolygon=1;var e=interopRequireDefaultExports;Object.defineProperty(polygon,"__esModule",{value:!0}),polygon.getSurfaceIndices=function(e,r,n){var o=null;e.holeIndices&&(o=e.holeIndices.map((function(e){return e/r})));var s=e.positions||e;if(n){var l=s.length;s=s.slice();for(var u=0;u<l;u+=r)s[u+1]=Math.log(Math.tan(i+s[u+1]*a))}return(0,t.default)(s,o,r)},polygon.getVertexCount=p,polygon.normalize=function(e,t,n){o(e),n=n||p(e,t);var i=new Float64Array(n*t),a=[];if(e.positions){var l=e.positions,u=e.holeIndices;if(u){for(var h=0,f=0;f<=u.length;f++)h=d(i,h,l,t,u[f-1],u[f]),a.push(h);return a.pop(),{positions:i,holeIndices:a}}e=l}if(Number.isFinite(e[0]))return d(i,0,e,t),i;if(!s(e)){var m,g=0,_=r(e);try{for(_.s();!(m=_.n()).done;)g=c(i,g,m.value,t),a.push(g)}catch(e){_.e(e)}finally{_.f()}return a.pop(),{positions:i,holeIndices:a}}return c(i,0,e,t),i};var t=e(requireEarcut());function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=Math.PI/4,a=Math.PI/360;function o(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function s(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function l(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}function u(e,t,r,n){for(var i=0;i<t;i++)if(e[r+i]!==e[n-t+i])return!1;return!0}function c(e,t,r,n){for(var i=t,a=r.length,o=0;o<a;o++)for(var s=0;s<n;s++)e[i++]=r[o][s]||0;if(!l(r))for(var u=0;u<n;u++)e[i++]=r[0][u]||0;return i}function d(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=(a=a||r.length)-i;if(o<=0)return t;for(var s=t,l=0;l<o;l++)e[s++]=r[i+l];if(!u(r,n,i,a))for(var c=0;c<n;c++)e[s++]=r[i+c];return s}function h(e){return(l(e)?0:1)+e.length}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return r>=(n=n||e.length)?0:(u(e,t,r,n)?0:1)+(n-r)/t}function p(e,t){if(arguments.length>2&&void 0!==arguments[2]&&!arguments[2])return(e=e.positions||e).length/t;if(o(e),e.positions){var n=e.positions,i=e.holeIndices;if(i){for(var a=0,l=0;l<=i.length;l++)a+=f(e.positions,t,i[l-1],i[l]);return a}e=n}if(Number.isFinite(e[0]))return f(e,t);if(!s(e)){var u,c=0,d=r(e);try{for(d.s();!(u=d.n()).done;)c+=h(u.value)}catch(e){d.e(e)}finally{d.f()}return c}return h(e)}return polygon}function requireGpuPointInPolygon(){if(hasRequiredGpuPointInPolygon)return gpuPointInPolygon;hasRequiredGpuPointInPolygon=1;var e=interopRequireDefaultExports,t=_typeofExports;Object.defineProperty(gpuPointInPolygon,"__esModule",{value:!0}),gpuPointInPolygon.default=void 0;var r=e(requireToConsumableArray()),n=e(requireSlicedToArray()),i=e(requireDefineProperty()),a=e(requireClassCallCheck()),o=e(requireCreateClass()),s=es5$b,l=es5$c,u=es5$9,c=e(requireTextureFilter()),d=requireShaders(),h=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=f(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(requirePolygon());function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}var p=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.default)(this,e),this.gl=t,(0,s.assert)((0,l.isWebGL2)(t)),this.textureSize=512,this._setupResources(),this.update(r)}return(0,o.default)(e,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.polygons,n=e.textureSize;if(n&&(this.textureSize=n),t&&0!==t.length){var i=function(e){for(var t=[],n=[],i=[],a=0,o=0,l=0;l<e.length;l++){var u=h.normalize(e[l],2),c=u.positions||u,d=c.length/2,f=new Array(d).fill(o);t.push.apply(t,(0,r.default)(c)),i.push.apply(i,(0,r.default)(f));for(var p=h.getSurfaceIndices(u,2),m=p.length,g=0;g<m;g++)p[g]+=a;a+=d,n.push.apply(n,(0,r.default)(p)),o++}return(0,s.assert)(a<65536),{vertices:t,indices:n,ids:i,vertexCount:h.getVertexCount(t,2)}}(t);this._updateResources(i.vertices,i.indices,i.ids,i.vertexCount)}}},{key:"filter",value:function(e){this.filterTransform.update({sourceBuffers:{a_position:e.positionBuffer},feedbackBuffers:{filterValueIndex:e.filterValueIndexBuffer},elementCount:e.count}),this.filterTransform.run({moduleSettings:{boundingBox:this.boundingBox,texture:this.polygonTexture}})}},{key:"_setupResources",value:function(){var e,t=this.gl;this.polygonTexture=new s.Texture2D(t,{format:6407,type:5121,dataFormat:6407,border:0,mipmaps:!1,parameters:(e={},(0,i.default)(e,10240,9728),(0,i.default)(e,10241,9728),(0,i.default)(e,10242,33071),(0,i.default)(e,10243,33071),e)}),this.positionBuffer=new s.Buffer(t,{accessor:{type:5126,size:2}}),this.idBuffer=new s.Buffer(t,{accessor:{type:5126,size:1}}),this.indexBuffer=new s.Buffer(t,{target:34963,accessor:{type:5123}}),this.polyTextureTransform=new u.Transform(t,{id:"polygon-texture-creation-transform",elementCount:0,_targetTexture:this.polygonTexture,_targetTextureVarying:"v_polygonColor",vs:d.POLY_TEX_VS,drawMode:4,isIndexed:!0,sourceBuffers:{a_position:this.positionBuffer,a_polygonID:this.idBuffer,indices:this.indexBuffer}}),this.filterTransform=new u.Transform(t,{id:"filter transform",vs:d.FILTER_VS,modules:[c.default],varyings:["filterValueIndex"]})}},{key:"_updateResources",value:function(e,t,r,i){var a=function(e,t){for(var r,n,i=1/0,a=-1/0,o=1/0,s=-1/0,l=0;l<t;l++)i=(r=e[2*l+1])<i?r:i,a=r>a?r:a,o=(n=e[2*l])<o?n:o,s=n>s?n:s;return[o,i,s,a]}(e,i),o=(0,n.default)(a,4),s=o[0],l=o[1],u=o[2]-s,c=o[3]-l,d=u/c,h=this.textureSize,f=h,p=h;d>1?p=f/d:f=p*d,this.boundingBox=a,this.polygonTexture.resize({width:f,height:p,mipmaps:!1}),this.positionBuffer.setData(new Float32Array(e)),this.idBuffer.setData(new Float32Array(r)),this.indexBuffer.setData(new Uint16Array(t)),this.polyTextureTransform.update({elementCount:t.length,_targetTexture:this.polygonTexture}),this.polyTextureTransform.run({uniforms:{boundingBoxOriginSize:[s,l,u,c]}})}}]),e}();return gpuPointInPolygon.default=p,gpuPointInPolygon}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Display",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"GLTFAnimator",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"GLTFEnvironment",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"GLTFMaterialParser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"GPUPointInPolygon",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"GroupNode",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"ModelNode",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"ScenegraphNode",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"VRDisplay",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"buildHistopyramidBaseLevel",{enumerable:!0,get:function(){return d.buildHistopyramidBaseLevel}}),Object.defineProperty(e,"createGLTFObjects",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"getHistoPyramid",{enumerable:!0,get:function(){return d.getHistoPyramid}}),Object.defineProperty(e,"histoPyramidGenerateIndices",{enumerable:!0,get:function(){return d.histoPyramidGenerateIndices}});var r=t(requireDisplay()),n=t(requireVrDisplay()),i=t(requireGltfEnvironment()),a=t(requireCreateGltfObjects()),o=t(requireGltfMaterialParser()),s=t(requireGltfAnimator()),l=t(requireScenegraphNode()),u=t(requireGroupNode()),c=t(requireModelNode()),d=requireHistopyramid(),h=t(requireGpuPointInPolygon())}(es5$1);var gltfUtils={},hasRequiredGltfUtils;function requireGltfUtils(){if(hasRequiredGltfUtils)return gltfUtils;hasRequiredGltfUtils=1;var e=interopRequireDefaultExports;Object.defineProperty(gltfUtils,"__esModule",{value:!0}),gltfUtils.waitForGLTFAssets=function(e){return n.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator());function n(){return n=(0,r.default)(t.default.mark((function e(r){var n;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r.scenes.forEach((function(e){e.traverse((function(e){Object.values(e.model.getUniforms()).forEach((function(e){!1===e.loaded&&n.push(e)}))}))})),e.next=4,i((function(){return n.some((function(e){return!e.loaded}))}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),n.apply(this,arguments)}function i(e){return a.apply(this,arguments)}function a(){return(a=(0,r.default)(t.default.mark((function e(r){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r()){e.next=5;break}return e.next=3,new Promise((function(e){return requestAnimationFrame(e)}));case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return gltfUtils}var scenegraphLayerVertex_glsl={},hasRequiredScenegraphLayerVertex_glsl;function requireScenegraphLayerVertex_glsl(){return hasRequiredScenegraphLayerVertex_glsl||(hasRequiredScenegraphLayerVertex_glsl=1,Object.defineProperty(scenegraphLayerVertex_glsl,"__esModule",{value:!0}),scenegraphLayerVertex_glsl.default=void 0,scenegraphLayerVertex_glsl.default="#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;\n    #endif\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    geometry.normal = project_normal(normal);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n    geometry.normal = project_normal(normal);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"),scenegraphLayerVertex_glsl}var scenegraphLayerFragment_glsl={},hasRequiredScenegraphLayerFragment_glsl,hasRequiredScenegraphLayer;function requireScenegraphLayerFragment_glsl(){return hasRequiredScenegraphLayerFragment_glsl||(hasRequiredScenegraphLayerFragment_glsl=1,Object.defineProperty(scenegraphLayerFragment_glsl,"__esModule",{value:!0}),scenegraphLayerFragment_glsl.default=void 0,scenegraphLayerFragment_glsl.default="#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n"),scenegraphLayerFragment_glsl}function requireScenegraphLayer(){if(hasRequiredScenegraphLayer)return scenegraphLayer;hasRequiredScenegraphLayer=1;var e=interopRequireDefaultExports;Object.defineProperty(scenegraphLayer,"__esModule",{value:!0}),scenegraphLayer.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireAssertThisInitialized()),i=e(requireGet()),a=e(requireInherits()),o=e(requirePossibleConstructorReturn()),s=e(requireGetPrototypeOf()),l=e(requireDefineProperty()),u=e(_typeofExports),c=es5$g,d=es5$d,h=es5$8,f=es5$1,p=requireEs5$6(),m=requireGltfUtils(),g=requireMatrix(),_=e(requireScenegraphLayerVertex_glsl()),y=e(requireScenegraphLayerFragment_glsl());function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=[255,255,255,255],T={scenegraph:{type:"object",value:null,async:!0},getScene:function(e){return e&&e.scenes?"object"===(0,u.default)(e.scene)?e.scene:e.scenes[e.scene||0]:e},getAnimator:function(e){return e&&e.animator},_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:x},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[p.GLTFLoader]},w=function(e){(0,a.default)(T,e);var u,p,v=(u=T,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.default)(u);if(p){var r=(0,s.default)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.default)(this,e)});function T(){var e;(0,t.default)(this,T);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),(0,l.default)((0,n.default)(e),"state",void 0),e}return(0,r.default)(T,[{key:"getShaders",value:function(){var e=[c.project32,c.picking];return"pbr"===this.props._lighting&&e.push(h.pbr),(0,i.default)((0,s.default)(T.prototype),"getShaders",this).call(this,{vs:_.default,fs:y.default,modules:e})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:x,transition:!0},instanceModelMatrix:g.MATRIX_ATTRIBUTES})}},{key:"updateState",value:function(e){(0,i.default)((0,s.default)(T.prototype),"updateState",this).call(this,e);var t=e.props,r=e.oldProps;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}},{key:"finalizeState",value:function(e){(0,i.default)((0,s.default)(T.prototype),"finalizeState",this).call(this,e),this._deleteScenegraph()}},{key:"_updateScenegraph",value:function(){var e=this,t=this.props,r=this.context.gl,n=null;if(t.scenegraph instanceof f.ScenegraphNode)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){var i=t.scenegraph,a=(0,f.createGLTFObjects)(r,i,this._getModelOptions());n=b({gltf:i},a),(0,m.waitForGLTFAssets)(a).then((function(){return e.setNeedsRedraw()}))}else t.scenegraph&&(c.log.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);var o={layer:this,gl:r},s=t.getScene(n,o),l=t.getAnimator(n,o);s instanceof f.ScenegraphNode?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,l,t._animations),this.setState({scenegraph:s,animator:l})):null!==s&&c.log.warn("invalid scenegraph:",s)()}},{key:"_applyAllAttributes",value:function(e){var t=this;if(this.state.attributesAvailable){var r=this.getAttributeManager().getAttributes();e.traverse((function(e){t._setModelAttributes(e.model,r)}))}}},{key:"_applyAnimationsProp",value:function(e,t,r){if(e&&t&&r){var n=t.getAnimations();Object.keys(r).sort().forEach((function(e){var t=r[e];if("*"===e)n.forEach((function(e){Object.assign(e,t)}));else if(Number.isFinite(Number(e))){var i=Number(e);i>=0&&i<n.length?Object.assign(n[i],t):c.log.warn("animation ".concat(e," not found"))()}else{var a=n.find((function(t){return t.name===e}));a?Object.assign(a,t):c.log.warn("animation ".concat(e," not found"))()}}))}}},{key:"_deleteScenegraph",value:function(){var e=this.state.scenegraph;e instanceof f.ScenegraphNode&&e.delete()}},{key:"_getModelOptions",value:function(){var e=this.props._imageBasedLightingEnvironment,t=null;return e&&(t="function"==typeof e?e({gl:this.context.gl,layer:this}):e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:b({isInstanced:!0,transpileToGLSL100:!(0,d.isWebGL2)(this.context.gl)},this.getShaders()),useTangents:!1}}},{key:"updateAttributes",value:function(e){var t=this;this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse((function(r){t._setModelAttributes(r.model,e)}))}},{key:"draw",value:function(e){var t=e.moduleParameters,r=void 0===t?null:t,n=e.parameters,i=void 0===n?{}:n;if(this.state.scenegraph){this.props._animations&&this.state.animator&&(this.state.animator.animate(e.context.timeline.getTime()),this.setNeedsRedraw());var a=this.context.viewport,o=this.props,s=o.sizeScale,l=o.sizeMinPixels,u=o.sizeMaxPixels,c=o.opacity,d=o.coordinateSystem,h=this.getNumInstances();this.state.scenegraph.traverse((function(e,t){var n=t.worldMatrix;e.model.setInstanceCount(h),e.updateModuleSettings(r),e.draw({parameters:i,uniforms:{sizeScale:s,opacity:c,sizeMinPixels:l,sizeMaxPixels:u,composeModelMatrix:(0,g.shouldComposeModelMatrix)(a,d),sceneModelMatrix:n,u_Camera:e.model.getUniforms().project_uCameraPosition}})}))}}}]),T}(c.Layer);return scenegraphLayer.default=w,(0,l.default)(w,"defaultProps",T),(0,l.default)(w,"layerName","ScenegraphLayer"),scenegraphLayer}!function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"SimpleMeshLayer",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"ScenegraphLayer",{enumerable:!0,get:function(){return n.default}});var r=t(requireSimpleMeshLayer()),n=t(requireScenegraphLayer())}(es5$2);var vs$1="#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvec2 applyUVRegion(vec2 uv) {\n  #ifdef HAS_UV_REGIONS\n    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n  #else\n    return uv;\n  #endif\n}\n\nvoid main(void) {\n  vec2 uv = applyUVRegion(texCoords);\n  geometry.uv = uv;\n\n  if (pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  geometry.normal = normals_commonspace;\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs$1="#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n";function validateGeometryAttributes(e){e.COLOR_0||e.colors||(e.colors={constant:!0,value:new Float32Array([1,1,1])})}const defaultProps$2={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class MeshLayer extends es5$2.SimpleMeshLayer{getShaders(){const e=super.getShaders();return e.modules.push(es5$d.pbr),{...e,vs:vs$1,fs:fs$1}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:Boolean(t)}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:r}=this.props,n=this.parseMaterial(r,e);this.setState({materialParser:n});const i=this.getShaders();return validateGeometryAttributes(e.attributes),new es5$d.Model(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...i.defines,...null==n?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:null==n?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:r}=this.props,n=this.parseMaterial(e,r);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var r;const n=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return null===(r=this.state.materialParser)||void 0===r||r.delete(),new es5$1.GLTFMaterialParser(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[];for(let e=0;e<t.length;e++)this.encodePickingColor(t[e],n),r[3*e]=n[0],r[3*e+1]=n[1],r[3*e+2]=n[2];e.value=r}finalizeState(e){var t;super.finalizeState(e),null===(t=this.state.materialParser)||void 0===t||t.delete(),this.setState({materialParser:null})}}_defineProperty(MeshLayer,"layerName","MeshLayer"),_defineProperty(MeshLayer,"defaultProps",defaultProps$2);var es5={},tiles3dLoader={},version={},hasRequiredVersion;function requireVersion(){return hasRequiredVersion||(hasRequiredVersion=1,Object.defineProperty(version,"__esModule",{value:!0}),version.VERSION=void 0,version.VERSION="3.4.14"),version}var parse3dTile={},constants={},hasRequiredConstants;function requireConstants(){if(hasRequiredConstants)return constants;hasRequiredConstants=1,Object.defineProperty(constants,"__esModule",{value:!0}),constants.TILE3D_TYPES=constants.TILE3D_TYPE=constants.TILE3D_OPTIMIZATION_HINT=constants.MAGIC_ARRAY=void 0;var e={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};constants.TILE3D_TYPE=e;var t=Object.keys(e);return constants.TILE3D_TYPES=t,constants.MAGIC_ARRAY={BATCHED_MODEL:[98,51,100,109],INSTANCED_MODEL:[105,51,100,109],POINT_CLOUD:[112,110,116,115],COMPOSITE:[99,109,112,116]},constants.TILE3D_OPTIMIZATION_HINT={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},constants}var parseUtils={},hasRequiredParseUtils;function requireParseUtils(){if(hasRequiredParseUtils)return parseUtils;hasRequiredParseUtils=1,Object.defineProperty(parseUtils,"__esModule",{value:!0}),parseUtils.getMagicString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))},parseUtils.getStringFromArrayBuffer=function(t,r,n){(0,e.assert)(t instanceof ArrayBuffer);var i=new TextDecoder("utf8"),a=new Uint8Array(t,r,n);return i.decode(a)},parseUtils.getStringFromTypedArray=function(t){return(0,e.assert)(ArrayBuffer.isView(t)),new TextDecoder("utf8").decode(t)};var e=es5$t;return parseUtils}var parse3dTilePointCloud={},tile3dFeatureTable={},hasRequiredTile3dFeatureTable;function requireTile3dFeatureTable(){if(hasRequiredTile3dFeatureTable)return tile3dFeatureTable;hasRequiredTile3dFeatureTable=1;var e=interopRequireDefaultExports;Object.defineProperty(tile3dFeatureTable,"__esModule",{value:!0}),tile3dFeatureTable.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$k,a=function(){function e(r,i){(0,t.default)(this,e),(0,n.default)(this,"json",void 0),(0,n.default)(this,"buffer",void 0),(0,n.default)(this,"featuresLength",0),(0,n.default)(this,"_cachedTypedArrays",{}),this.json=r,this.buffer=i}return(0,r.default)(e,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.GL.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(e,t,r){var n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=i.GLType.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}},{key:"getProperty",value:function(e,t,r,n,i){var a=this.json[e];if(!a)return a;var o=this.getPropertyArray(e,t,r);if(1===r)return o[n];for(var s=0;s<r;++s)i[s]=o[r*n+s];return i}},{key:"_getTypedArrayFromBinary",value:function(e,t,r,n,a){var o=this._cachedTypedArrays,s=o[e];return s||(s=i.GLType.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+a,n*r),o[e]=s),s}},{key:"_getTypedArrayFromArray",value:function(e,t,r){var n=this._cachedTypedArrays,a=n[e];return a||(a=i.GLType.createTypedArray(t,r),n[e]=a),a}}]),e}();return tile3dFeatureTable.default=a,tile3dFeatureTable}var tile3dBatchTable={},tile3dAccessorUtils={},hasRequiredTile3dAccessorUtils;function requireTile3dAccessorUtils(){if(hasRequiredTile3dAccessorUtils)return tile3dAccessorUtils;hasRequiredTile3dAccessorUtils=1,Object.defineProperty(tile3dAccessorUtils,"__esModule",{value:!0}),tile3dAccessorUtils.createTypedArrayFromAccessor=function(a,o,s,l){var u=a.componentType;(0,t.assert)(a.componentType);var c="string"==typeof u?e.GLType.fromName(u):u,d=r[a.type],h=n[a.type],f=i[a.type];return{values:e.GLType.createTypedArray(c,o,s+=a.byteOffset,d*l),type:c,size:d,unpacker:h,packer:f}};var e=es5$k,t=es5$t,r={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},n={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},i={SCALAR:function(e,t,r){t[r]=e},VEC2:function(e,t,r){t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:function(e,t,r){t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:function(e,t,r){t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:function(e,t,r){t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};return tile3dAccessorUtils}var tile3dBatchTableHierarchy={},hasRequiredTile3dBatchTableHierarchy,hasRequiredTile3dBatchTable;function requireTile3dBatchTableHierarchy(){if(hasRequiredTile3dBatchTableHierarchy)return tile3dBatchTableHierarchy;hasRequiredTile3dBatchTableHierarchy=1,Object.defineProperty(tile3dBatchTableHierarchy,"__esModule",{value:!0}),tile3dBatchTableHierarchy.initializeHierarchy=function(r,n,i){if(!n)return null;var a=r.getExtension("3DTILES_batch_table_hierarchy"),o=n.HIERARCHY;return o&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),n.extensions=n.extensions||{},n.extensions["3DTILES_batch_table_hierarchy"]=o,a=o),a?function(r,n){var i,a,o,s=r.instancesLength,l=r.classes,u=r.classIds,c=r.parentCounts,d=r.parentIds,h=s;if(e(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,u=getBinaryAccessor(u).createArrayBufferView(n.buffer,n.byteOffset+u.byteOffset,s)),e(c))for(e(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,c=getBinaryAccessor(c).createArrayBufferView(n.buffer,n.byteOffset+c.byteOffset,s)),o=new Uint16Array(s),h=0,i=0;i<s;++i)o[i]=h,h+=c[i];e(d)&&e(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,d=getBinaryAccessor(d).createArrayBufferView(n.buffer,n.byteOffset+d.byteOffset,h));var f=l.length;for(i=0;i<f;++i){var p=l[i].instances,m=getBinaryProperties(l[i].length,p,n);l[i].instances=combine(m,p)}var g=new Array(f).fill(0),_=new Uint16Array(s);for(i=0;i<s;++i)_[i]=g[a=u[i]],++g[a];var y={classes:l,classIds:u,classIndexes:_,parentCounts:c,parentIndexes:o,parentIds:d};return function(e){for(var r=e.classIds.length,n=0;n<r;++n)t(e,n,stack)}(y),y}(a,i):null},tile3dBatchTableHierarchy.traverseHierarchy=function(t,r,n){if(t){var i=t.parentCounts;return t.parentIds?n(t,r):i>0?function(t,r,n){var i=t.parentCounts,a=t.parentIds,o=t.parentIndexes,s=scratchVisited;s.length=Math.max(s.length,t.classIds.length);var l=++marker,u=scratchStack;for(u.length=0,u.push(r);u.length>0;)if(s[r=u.pop()]!==l){s[r]=l;var c=n(t,r);if(e(c))return c;for(var d=i[r],h=o[r],f=0;f<d;++f){var p=a[h+f];p!==r&&u.push(p)}}return null}(t,r,n):function(t,r,n){for(var i=!0;i;){var a=n(t,r);if(e(a))return a;var o=t.parentIds[r];i=o!==r,r=o}throw new Error("traverseHierarchySingleParent")}(t,r,n)}};var e=function(e){return void 0!==e};function t(r,n,i){var a=r.parentCounts,o=r.parentIds,s=r.parentIndexes,l=r.classIds.length;if(e(o)){assert(n<l,"Parent index ".concat(n," exceeds the total number of instances: ").concat(l)),assert(-1===i.indexOf(n),"Circular dependency detected in the batch table hierarchy."),i.push(n);for(var u=e(a)?a[n]:1,c=e(a)?s[n]:n,d=0;d<u;++d){var h=o[c+d];h!==n&&t(r,h,i)}i.pop(n)}}return tile3dBatchTableHierarchy}function requireTile3dBatchTable(){if(hasRequiredTile3dBatchTable)return tile3dBatchTable;hasRequiredTile3dBatchTable=1;var e=interopRequireDefaultExports;Object.defineProperty(tile3dBatchTable,"__esModule",{value:!0}),tile3dBatchTable.default=void 0;var t=e(requireClassCallCheck()),r=e(requireCreateClass()),n=e(requireDefineProperty()),i=es5$t,a=requireTile3dAccessorUtils(),o=requireTile3dBatchTableHierarchy();function s(e){return null!=e}var l=function(e,t){return e},u={HIERARCHY:!0,extensions:!0,extras:!0},c=function(){function e(r,a,s){var l,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var d in(0,t.default)(this,e),(0,n.default)(this,"json",void 0),(0,n.default)(this,"binary",void 0),(0,n.default)(this,"featureCount",void 0),(0,n.default)(this,"_extensions",void 0),(0,n.default)(this,"_properties",void 0),(0,n.default)(this,"_binaryProperties",void 0),(0,n.default)(this,"_hierarchy",void 0),(0,i.assert)(s>=0),this.json=r||{},this.binary=a,this.featureCount=s,this._extensions=(null===(l=this.json)||void 0===l?void 0:l.extensions)||{},this._properties={},this.json)u[d]||(this._properties[d]=this.json[d]);this._binaryProperties=this._initializeBinaryProperties(),c["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=(0,o.initializeHierarchy)(this,this.json,this.binary))}return(0,r.default)(e,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,t){return this._checkBatchId(e),(0,i.assert)("string"==typeof t,t),!!this._hierarchy&&s((0,o.traverseHierarchy)(this._hierarchy,e,(function(e,r){return e.classes[e.classIds[r]].name===t})))}},{key:"isExactClass",value:function(e,t){return(0,i.assert)("string"==typeof t,t),this.getExactClassName(e)===t}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[e]].name}},{key:"hasProperty",value:function(e,t){return this._checkBatchId(e),(0,i.assert)("string"==typeof t,t),s(this._properties[t])||this._hasPropertyInHierarchy(e,t)}},{key:"getPropertyNames",value:function(e,t){var r;this._checkBatchId(e),(t=s(t)?t:[]).length=0;var n=Object.keys(this._properties);return(r=t).push.apply(r,n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}},{key:"getProperty",value:function(e,t){if(this._checkBatchId(e),(0,i.assert)("string"==typeof t,t),this._binaryProperties){var r=this._binaryProperties[t];if(s(r))return this._getBinaryProperty(r,e)}var n=this._properties[t];if(s(n))return l(n[e]);if(this._hierarchy){var a=this._getHierarchyProperty(e,t);if(s(a))return a}}},{key:"setProperty",value:function(e,t,r){var n=this.featureCount;if(this._checkBatchId(e),(0,i.assert)("string"==typeof t,t),this._binaryProperties){var a=this._binaryProperties[t];if(a)return void this._setBinaryProperty(a,e,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,r)){var o=this._properties[t];s(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=l(r)}}},{key:"_checkBatchId",value:function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,t){return e.unpack(e.typedArray,t)}},{key:"_setBinaryProperty",value:function(e,t,r){e.pack(r,e.typedArray,t)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var t in this._properties){var r=this._initializeBinaryProperty(t,this._properties[t]);r&&((e=e||{})[t]=r)}return e}},{key:"_initializeBinaryProperty",value:function(e,t){if("byteOffset"in t){var r=t;(0,i.assert)(this.binary,"Property ".concat(e," requires a batch table binary.")),(0,i.assert)(r.type,"Property ".concat(e," requires a type."));var n=(0,a.createTypedArrayFromAccessor)(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,t){if(!this._hierarchy)return!1;var r=(0,o.traverseHierarchy)(this._hierarchy,e,(function(e,r){return s(e.classes[e.classIds[r]].instances[t])}));return s(r)}},{key:"_getPropertyNamesInHierarchy",value:function(e,t){(0,o.traverseHierarchy)(this._hierarchy,e,(function(e,r){var n=e.classes[e.classIds[r]].instances;for(var i in n)n.hasOwnProperty(i)&&-1===t.indexOf(i)&&t.push(i)}))}},{key:"_getHierarchyProperty",value:function(e,t){var r=this;return(0,o.traverseHierarchy)(this._hierarchy,e,(function(e,n){var i=e.classIndexes[n],a=e.classes[e.classIds[n]].instances[t];return s(a)?s(a.typedArray)?r._getBinaryProperty(a,i):l(a[i]):null}))}},{key:"_setHierarchyProperty",value:function(e,t,r,n){var a=this,u=(0,o.traverseHierarchy)(this._hierarchy,t,(function(e,o){var u=e.classIndexes[o],c=e.classes[e.classIds[o]].instances[r];return!!s(c)&&((0,i.assert)(o===t,'Inherited property "'.concat(r,'" is read-only.')),s(c.typedArray)?a._setBinaryProperty(c,u,n):c[u]=l(n),!0)}));return s(u)}}]),e}();return tile3dBatchTable.default=c,tile3dBatchTable}var parse3dTileHeader$1={},hasRequiredParse3dTileHeader$1;function requireParse3dTileHeader$1(){if(hasRequiredParse3dTileHeader$1)return parse3dTileHeader$1;hasRequiredParse3dTileHeader$1=1,Object.defineProperty(parse3dTileHeader$1,"__esModule",{value:!0}),parse3dTileHeader$1.parse3DTileHeaderSync=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new DataView(r);if(t.magic=i.getUint32(n,!0),t.version=i.getUint32(n+=e,!0),t.byteLength=i.getUint32(n+=e,!0),n+=e,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n};var e=4;return parse3dTileHeader$1}var parse3dTileTables={},hasRequiredParse3dTileTables;function requireParse3dTileTables(){if(hasRequiredParse3dTileTables)return parse3dTileTables;hasRequiredParse3dTileTables=1,Object.defineProperty(parse3dTileTables,"__esModule",{value:!0}),parse3dTileTables.parse3DTileTablesHeaderSync=function(e,n,i){var a,o=new DataView(n);e.header=e.header||{};var s=o.getUint32(i,!0),l=o.getUint32(i+=t,!0),u=o.getUint32(i+=t,!0),c=o.getUint32(i+=t,!0);return i+=t,u>=570425344?(i-=2*t,a=s,u=l,c=0,s=0,l=0,console.warn(r)):c>=570425344&&(i-=t,a=u,u=s,c=l,s=0,l=0,console.warn(r)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=l,e.header.batchTableJsonByteLength=u,e.header.batchTableBinaryByteLength=c,e.header.batchLength=a,i},parse3dTileTables.parse3DTileTablesSync=function(t,r,n,i){return n=function(t,r,n,i){var a=t.header,o=a.featureTableJsonByteLength,s=a.featureTableBinaryByteLength;if(t.featureTableJson={BATCH_LENGTH:a.batchLength||0},o>0){var l=(0,e.getStringFromArrayBuffer)(r,n,o);t.featureTableJson=JSON.parse(l)}return n+=o,t.featureTableBinary=new Uint8Array(r,n,s),n+s}(t,r,n),function(t,r,n,i){var a=t.header,o=a.batchTableJsonByteLength,s=a.batchTableBinaryByteLength;if(o>0){var l=(0,e.getStringFromArrayBuffer)(r,n,o);t.batchTableJson=JSON.parse(l),n+=o,s>0&&(t.batchTableBinary=new Uint8Array(r,n,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=s)}return n}(t,r,n)};var e=requireParseUtils(),t=4,r="b3dm tile in legacy format.";return parse3dTileTables}var normalize3dTileColors={},hasRequiredNormalize3dTileColors;function requireNormalize3dTileColors(){if(hasRequiredNormalize3dTileColors)return normalize3dTileColors;hasRequiredNormalize3dTileColors=1,Object.defineProperty(normalize3dTileColors,"__esModule",{value:!0}),normalize3dTileColors.normalize3DTileColorAttribute=function(t,r,n){if(!(r||t&&t.batchIds&&n))return null;var i=t.batchIds,a=t.isRGB565,o=t.pointCount;if(i&&n){for(var s=new Uint8ClampedArray(3*o),l=0;l<o;l++){var u=n.getProperty(i[l],"dimensions").map((function(e){return 255*e}));s[3*l]=u[0],s[3*l+1]=u[1],s[3*l+2]=u[2]}return{type:e.GL.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(a){for(var c=new Uint8ClampedArray(3*o),d=0;d<o;d++){var h=(0,e.decodeRGB565)(r[d]);c[3*d]=h[0],c[3*d+1]=h[1],c[3*d+2]=h[2]}return{type:e.GL.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return r&&r.length===3*o?{type:e.GL.UNSIGNED_BYTE,value:r,size:3,normalized:!0}:{type:e.GL.UNSIGNED_BYTE,value:r,size:4,normalized:!0}};var e=es5$k;return normalize3dTileColors}var normalize3dTileNormals={},hasRequiredNormalize3dTileNormals;function requireNormalize3dTileNormals(){if(hasRequiredNormalize3dTileNormals)return normalize3dTileNormals;hasRequiredNormalize3dTileNormals=1,Object.defineProperty(normalize3dTileNormals,"__esModule",{value:!0}),normalize3dTileNormals.normalize3DTileNormalAttribute=function(r,n){if(!n)return null;if(r.isOctEncoded16P){for(var i=new Float32Array(3*r.pointsLength),a=0;a<r.pointsLength;a++)(0,e.octDecode)(n[2*a],n[2*a+1],t),t.toArray(i,3*a);return{type:e.GL.FLOAT,size:2,value:i}}return{type:e.GL.FLOAT,size:2,value:n}};var e=es5$k,t=new es5$q.Vector3;return normalize3dTileNormals}var normalize3dTilePositions={},hasRequiredNormalize3dTilePositions,hasRequiredParse3dTilePointCloud;function requireNormalize3dTilePositions(){if(hasRequiredNormalize3dTilePositions)return normalize3dTilePositions;hasRequiredNormalize3dTilePositions=1,Object.defineProperty(normalize3dTilePositions,"__esModule",{value:!0}),normalize3dTilePositions.normalize3DTilePositionAttribute=function(r,n,i){return r.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,function(t,r){for(var n=new e.Vector3,i=new Float32Array(3*t.pointCount),a=0;a<t.pointCount;a++)n.set(r[3*a],r[3*a+1],r[3*a+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,3*a);return i}(r,n)):{type:t.GL.UNSIGNED_SHORT,value:n,size:3,normalized:!0}:n};var e=es5$q,t=es5$k;return normalize3dTilePositions}function requireParse3dTilePointCloud(){if(hasRequiredParse3dTilePointCloud)return parse3dTilePointCloud;hasRequiredParse3dTilePointCloud=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTilePointCloud,"__esModule",{value:!0}),parse3dTilePointCloud.loadDraco=E,parse3dTilePointCloud.parsePointCloud3DTile=function(e,t,r,n,i){return g.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=es5$m,a=es5$k,o=es5$q,s=e(requireTile3dFeatureTable()),l=e(requireTile3dBatchTable()),u=requireParse3dTileHeader$1(),c=requireParse3dTileTables(),d=requireNormalize3dTileColors(),h=requireNormalize3dTileNormals(),f=requireNormalize3dTilePositions();function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(){return g=(0,n.default)(t.default.mark((function e(r,n,i,a,o){var s,l,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,u.parse3DTileHeaderSync)(r,n,i),i=(0,c.parse3DTileTablesHeaderSync)(r,n,i),i=(0,c.parse3DTileTablesSync)(r,n,i,a),_(r),s=y(r),l=s.featureTable,d=s.batchTable,e.next=7,T(r,l,d,a,o);case 7:return v(r,l,a),b(r,l,d),x(r,l),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function _(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function y(e){var t=new s.default(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",a.GL.FLOAT,3);var n=function(e,t){var r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",a.GL.UNSIGNED_SHORT,1),e.batchIds)){var n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");r=new l.default(e.batchTableJson,e.batchTableBinary,n)}return r}(e,t);return{featureTable:t,batchTable:n}}function v(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",a.GL.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var n=t.getPropertyArray("POSITION_QUANTIZED",a.GL.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",a.GL.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",a.GL.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=(0,f.normalize3DTilePositionAttribute)(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function b(e,t,r){if(!e.attributes.colors){var n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",a.GL.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",a.GL.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",a.GL.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=(0,d.normalize3DTileColorAttribute)(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",a.GL.UNSIGNED_BYTE,4))}function x(e,t){if(!e.attributes.normals){var r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",a.GL.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",a.GL.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=(0,h.normalize3DTileNormalAttribute)(e,r)}}function T(e,t,r,n,i){return w.apply(this,arguments)}function w(){return w=(0,n.default)(t.default.mark((function e(r,n,i,a,o){var s,l,u,c,d,h,f,p;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"])&&(u=c.properties),!(d=n.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(h=d.byteOffset,f=d.byteLength,(l=d.properties)&&Number.isFinite(h)&&f){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:s=r.featureTableBinary.slice(h,h+f),r.hasPositions=Number.isFinite(l.POSITION),r.hasColors=Number.isFinite(l.RGB)||Number.isFinite(l.RGBA),r.hasNormals=Number.isFinite(l.NORMAL),r.hasBatchIds=Number.isFinite(l.BATCH_ID),r.isTranslucent=Number.isFinite(l.RGBA);case 15:if(s){e.next=17;break}return e.abrupt("return",!0);case 17:return p={buffer:s,properties:m(m({},l),u),featureTableProperties:l,batchTableProperties:u,dequantizeInShader:!1},e.next=20,E(r,p,a,o);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function E(e,t,r,n){return A.apply(this,arguments)}function A(){return A=(0,n.default)(t.default.mark((function e(r,n,a,s){var l,u,c,h,f,p,g,_,y,v,b,x,T,w;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=s.parse,delete(u=m(m({},a),{},{draco:m(m({},a.draco),{},{extraAttributes:n.batchTableProperties||{}})}))["3d-tiles"],e.next=5,l(n.buffer,i.DracoLoader,u);case 5:if(f=(c=e.sent).attributes.COLOR_0&&c.attributes.COLOR_0.value,g=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,_=(p=c.attributes.NORMAL&&c.attributes.NORMAL.value)&&c.attributes.NORMAL.value.quantization,(h=c.attributes.POSITION&&c.attributes.POSITION.value)&&c.attributes.POSITION.value.quantization&&(r.quantizedVolumeScale=new o.Vector3(v=(y=c.POSITION.data.quantization).range,v,v),r.quantizedVolumeOffset=new o.Vector3(y.minValues),r.quantizedRange=(1<<y.quantizationBits)-1,r.isQuantizedDraco=!0),_&&(r.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0),b={},n.batchTableProperties)for(x=0,T=Object.keys(n.batchTableProperties);x<T.length;x++)c.attributes[w=T[x]]&&c.attributes[w].value&&(b[w.toLowerCase()]=c.attributes[w].value);r.attributes=m({positions:h,colors:(0,d.normalize3DTileColorAttribute)(r,f,void 0),normals:p,batchIds:g},b);case 17:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}return parse3dTilePointCloud}var parse3dTileBatchedModel={},parse3dTileGltfView={},hasRequiredParse3dTileGltfView,hasRequiredParse3dTileBatchedModel;function requireParse3dTileGltfView(){if(hasRequiredParse3dTileGltfView)return parse3dTileGltfView;hasRequiredParse3dTileGltfView=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileGltfView,"__esModule",{value:!0}),parse3dTileGltfView.GLTF_FORMAT=void 0,parse3dTileGltfView.extractGLTF=function(e,t,r,n){return o.apply(this,arguments)},parse3dTileGltfView.parse3DTileGLTFViewSync=function(e,t,r,n){e.rotateYtoZ=!0;var a=e.byteOffset+e.byteLength-r;if(0===a)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,i.sliceArrayBuffer)(t,r,a),e.gltfByteOffset=0,e.gltfByteLength=a,r%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireEs5$6(),i=es5$t,a={URI:0,EMBEDDED:1};function o(){return o=(0,r.default)(t.default.mark((function e(r,i,a,o){var l,u,c;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=a["3d-tiles"]||{},s(r,i),!l.loadGLTF){e.next=17;break}if(u=o.parse,c=o.fetch,!r.gltfUrl){e.next=9;break}return e.next=7,c(r.gltfUrl,a);case 7:r.gltfArrayBuffer=e.sent,r.gltfByteOffset=0;case 9:if(!r.gltfArrayBuffer){e.next=17;break}return e.next=12,u(r.gltfArrayBuffer,n.GLTFLoader,a,o);case 12:r.gltf=e.sent,r.gpuMemoryUsageInBytes=(0,n._getMemoryUsageGLTF)(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;case 17:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(e,t,r){switch(t){case a.URI:var n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(n);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case a.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}return parse3dTileGltfView.GLTF_FORMAT=a,parse3dTileGltfView}function requireParse3dTileBatchedModel(){if(hasRequiredParse3dTileBatchedModel)return parse3dTileBatchedModel;hasRequiredParse3dTileBatchedModel=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileBatchedModel,"__esModule",{value:!0}),parse3dTileBatchedModel.parseBatchedModel3DTile=function(e,t,r,n,i){return l.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$k,i=e(requireTile3dFeatureTable()),a=requireParse3dTileHeader$1(),o=requireParse3dTileTables(),s=requireParse3dTileGltfView();function l(){return l=(0,r.default)(t.default.mark((function e(r,n,i,a,o){var l,c;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u(r,n,i,a),e.next=3,(0,s.extractGLTF)(r,s.GLTF_FORMAT.EMBEDDED,a,o);case 3:return(c=null==r||null===(l=r.gltf)||void 0===l?void 0:l.extensions)&&c.CESIUM_RTC&&(r.rtcCenter=c.CESIUM_RTC.center),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function u(e,t,r,l,u){r=(0,a.parse3DTileHeaderSync)(e,t,r),r=(0,o.parse3DTileTablesHeaderSync)(e,t,r),r=(0,o.parse3DTileTablesSync)(e,t,r,l),r=(0,s.parse3DTileGLTFViewSync)(e,t,r,l);var c=new i.default(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=c.getGlobalProperty("RTC_CENTER",n.GL.FLOAT,3),r}return parse3dTileBatchedModel}var parse3dTileInstancedModel={},hasRequiredParse3dTileInstancedModel;function requireParse3dTileInstancedModel(){if(hasRequiredParse3dTileInstancedModel)return parse3dTileInstancedModel;hasRequiredParse3dTileInstancedModel=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileInstancedModel,"__esModule",{value:!0}),parse3dTileInstancedModel.parseInstancedModel3DTile=function(e,t,r,n,i){return d.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=es5$q,i=es5$p,a=es5$k,o=e(requireTile3dFeatureTable()),s=e(requireTile3dBatchTable()),l=requireParse3dTileHeader$1(),u=requireParse3dTileTables(),c=requireParse3dTileGltfView();function d(){return d=(0,r.default)(t.default.mark((function e(r,n,i,a,o){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h(r,n,i,a),e.next=3,(0,c.extractGLTF)(r,r.gltfFormat,a,o);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function h(e,t,r,d,h){if(r=(0,l.parse3DTileHeaderSync)(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=(0,u.parse3DTileTablesHeaderSync)(e,t,r);var f=new DataView(t);if(e.gltfFormat=f.getUint32(r,!0),r=(0,u.parse3DTileTablesSync)(e,t,r+=4,d),r=(0,c.parse3DTileGLTFViewSync)(e,t,r,d),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var p=new o.default(e.featureTableJson,e.featureTableBinary),m=p.getGlobalProperty("INSTANCES_LENGTH");if(p.featuresLength=m,!Number.isFinite(m))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return e.eastNorthUp=p.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=p.getGlobalProperty("RTC_CENTER",a.GL.FLOAT,3),new s.default(e.batchTableJson,e.batchTableBinary,m),function(e,t,r,o){for(var s=new Array(o),l=new n.Vector3,u=(new n.Vector3,new n.Vector3,new n.Vector3,new n.Matrix3),c=new n.Quaternion,d=new n.Vector3,h={},f=new n.Matrix4,p=[],m=[],g=new n.Vector3,_=new n.Vector3,y=0;y<o;y++){var v=void 0;if(t.hasProperty("POSITION"))v=t.getProperty("POSITION",a.GL.FLOAT,3,y,l);else if(t.hasProperty("POSITION_QUANTIZED")){v=t.getProperty("POSITION_QUANTIZED",a.GL.UNSIGNED_SHORT,3,y,l);var b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",a.GL.FLOAT,3,g);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var x=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",a.GL.FLOAT,3,_);if(!x)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var T=0;T<3;T++)v[T]=v[T]/65535*x[T]+b[T]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(v),h.translation=l,e.normalUp=t.getProperty("NORMAL_UP",a.GL.FLOAT,3,y,p),e.normalRight=t.getProperty("NORMAL_RIGHT",a.GL.FLOAT,3,y,m),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",a.GL.UNSIGNED_SHORT,2,p),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",a.GL.UNSIGNED_SHORT,2,m),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(i.Ellipsoid.WGS84.eastNorthUpToFixedFrame(l,f),f.getRotationMatrix3(u)):u.identity()}c.fromMatrix3(u),h.rotation=c,d.set(1,1,1);var w=t.getProperty("SCALE",a.GL.FLOAT,1,y);Number.isFinite(w)&&d.multiplyByScalar(w);var E=t.getProperty("SCALE_NON_UNIFORM",a.GL.FLOAT,3,y,p);E&&d.scale(E),h.scale=d;var A=t.getProperty("BATCH_ID",a.GL.UNSIGNED_SHORT,1,y);void 0===A&&(A=y);var S=(new n.Matrix4).fromQuaternion(h.rotation);f.identity(),f.translate(h.translation),f.multiplyRight(S),f.scale(h.scale);var P=f.clone();s[y]={modelMatrix:P,batchId:A}}e.instances=s}(e,p,0,m),r}return parse3dTileInstancedModel}var parse3dTileComposite={},hasRequiredParse3dTileComposite;function requireParse3dTileComposite(){if(hasRequiredParse3dTileComposite)return parse3dTileComposite;hasRequiredParse3dTileComposite=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileComposite,"__esModule",{value:!0}),parse3dTileComposite.parseComposite3DTile=function(e,t,r,n,a,o){return i.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireParse3dTileHeader$1();function i(){return i=(0,r.default)(t.default.mark((function e(r,i,a,o,s,l){var u,c;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(0,n.parse3DTileHeaderSync)(r,i,a),u=new DataView(i),r.tilesLength=u.getUint32(a,!0),a+=4,r.tiles=[];case 5:if(!(r.tiles.length<r.tilesLength&&r.byteLength-a>12)){e.next=13;break}return r.tiles.push(c={}),e.next=10,l(i,a,o,s,c);case 10:a=e.sent,e.next=5;break;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}return parse3dTileComposite}var parse3dTileGltf={},hasRequiredParse3dTileGltf,hasRequiredParse3dTile;function requireParse3dTileGltf(){if(hasRequiredParse3dTileGltf)return parse3dTileGltf;hasRequiredParse3dTileGltf=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileGltf,"__esModule",{value:!0}),parse3dTileGltf.parseGltf3DTile=function(e,t,r,n){return i.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireEs5$6();function i(){return i=(0,r.default)(t.default.mark((function e(r,i,a,o){var s;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.rotateYtoZ=!0,r.gltfUpAxis=a["3d-tiles"]&&a["3d-tiles"].assetGltfUpAxis?a["3d-tiles"].assetGltfUpAxis:"Y",s=o.parse,e.next=5,s(i,n.GLTFLoader,a,o);case 5:r.gltf=e.sent,r.gpuMemoryUsageInBytes=(0,n._getMemoryUsageGLTF)(r.gltf);case 7:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}return parse3dTileGltf}function requireParse3dTile(){if(hasRequiredParse3dTile)return parse3dTile;hasRequiredParse3dTile=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTile,"__esModule",{value:!0}),parse3dTile.parse3DTile=c;var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=requireConstants(),i=requireParseUtils(),a=requireParse3dTilePointCloud(),o=requireParse3dTileBatchedModel(),s=requireParse3dTileInstancedModel(),l=requireParse3dTileComposite(),u=requireParse3dTileGltf();function c(e){return d.apply(this,arguments)}function d(){return d=(0,r.default)(t.default.mark((function e(r){var d,h,f,p,m=arguments;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h=m.length>2?m[2]:void 0,f=m.length>3?m[3]:void 0,(p=m.length>4&&void 0!==m[4]?m[4]:{}).byteOffset=d=m.length>1&&void 0!==m[1]?m[1]:0,p.type=(0,i.getMagicString)(r,d),e.t0=p.type,e.next=e.t0===n.TILE3D_TYPE.COMPOSITE?9:e.t0===n.TILE3D_TYPE.BATCHED_3D_MODEL?12:e.t0===n.TILE3D_TYPE.GLTF?15:e.t0===n.TILE3D_TYPE.INSTANCED_3D_MODEL?18:e.t0===n.TILE3D_TYPE.POINT_CLOUD?21:24;break;case 9:return e.next=11,(0,l.parseComposite3DTile)(p,r,d,h,f,c);case 11:case 14:case 17:case 20:case 23:return e.abrupt("return",e.sent);case 12:return e.next=14,(0,o.parseBatchedModel3DTile)(p,r,d,h,f);case 15:return e.next=17,(0,u.parseGltf3DTile)(p,r,h,f);case 18:return e.next=20,(0,s.parseInstancedModel3DTile)(p,r,d,h,f);case 21:return e.next=23,(0,a.parsePointCloud3DTile)(p,r,d,h,f);case 24:throw new Error("3DTileLoader: unknown type ".concat(p.type));case 25:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}return parse3dTile}var parse3dTileHeader={},tile3dSubtreeLoader={},parse3dTileSubtree={},hasRequiredParse3dTileSubtree;function requireParse3dTileSubtree(){if(hasRequiredParse3dTileSubtree)return parse3dTileSubtree;hasRequiredParse3dTileSubtree=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileSubtree,"__esModule",{value:!0}),parse3dTileSubtree.default=function(e,t,r){return a.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=1952609651,i=1;function a(){return a=(0,r.default)(t.default.mark((function e(r,a,o){var l,c,d,h,f,p,m;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(new Uint32Array(r.slice(0,4))[0]===n){e.next=3;break}throw new Error("Wrong subtree file magic number");case 3:if(new Uint32Array(r.slice(4,8))[0]===i){e.next=6;break}throw new Error("Wrong subtree file verson, must be 1");case 6:if(l=u(r.slice(8,16)),c=new Uint8Array(r,24,l),d=new TextDecoder("utf8"),h=d.decode(c),f=JSON.parse(h),p=u(r.slice(16,24)),m=new ArrayBuffer(0),p&&(m=r.slice(24+l)),!("bufferView"in f.tileAvailability)){e.next=18;break}return e.next=17,s(f,"tileAvailability",m,o);case 17:f.tileAvailability.explicitBitstream=e.sent;case 18:if(!("bufferView"in f.contentAvailability)){e.next=22;break}return e.next=21,s(f,"contentAvailability",m,o);case 21:f.contentAvailability.explicitBitstream=e.sent;case 22:if(!("bufferView"in f.childSubtreeAvailability)){e.next=26;break}return e.next=25,s(f,"childSubtreeAvailability",m,o);case 25:f.childSubtreeAvailability.explicitBitstream=e.sent;case 26:return e.abrupt("return",f);case 27:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function o(e,t){if(t.startsWith("http")){var r=new URL(e,t);return decodeURI(r.toString())}var n="http://".concat(t),i=new URL(e,n);return"/".concat(i.host).concat(i.pathname)}function s(e,t,r,n){return l.apply(this,arguments)}function l(){return l=(0,r.default)(t.default.mark((function e(r,n,i,a){var s,l,u,c;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=r.buffers[(s=r.bufferViews[r[n].bufferView]).buffer],null!=a&&a.url&&a.fetch){e.next=5;break}throw new Error("Url is not provided");case 5:if(a.fetch){e.next=7;break}throw new Error("fetch is not provided");case 7:if(!l.uri){e.next=16;break}return u=o(l.uri,null==a?void 0:a.url),e.next=11,a.fetch(u);case 11:return c=e.sent,e.next=14,c.arrayBuffer();case 14:return e.abrupt("return",new Uint8Array(e.sent,s.byteOffset,s.byteLength));case 16:return e.abrupt("return",new Uint8Array(i,s.byteOffset,s.byteLength));case 17:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function u(e){var t=new DataView(e),r=t.getUint32(0,!0),n=t.getUint32(4,!0);return r+Math.pow(2,32)*n}return parse3dTileSubtree}var _interopRequireDefault$3=interopRequireDefaultExports;Object.defineProperty(tile3dSubtreeLoader,"__esModule",{value:!0}),tile3dSubtreeLoader.Tile3DSubtreeLoader=void 0;var _parse3dTileSubtree=_interopRequireDefault$3(requireParse3dTileSubtree()),_version$2=requireVersion(),Tile3DSubtreeLoader={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:_version$2.VERSION,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:_parse3dTileSubtree.default,options:{}};tile3dSubtreeLoader.Tile3DSubtreeLoader=Tile3DSubtreeLoader;var parse3dImplicitTiles={},s2={},s2TokenFunctions={},umd={exports:{}},hasRequiredUmd,hasRequiredS2TokenFunctions;function requireUmd(){return hasRequiredUmd||(hasRequiredUmd=1,function(e,t){var r=function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;
/**
		   * @license
		   * Copyright 2009 The Closure Library Authors
		   * Copyright 2020 Daniel Wirtz / The long.js Authors.
		   *
		   * Licensed under the Apache License, Version 2.0 (the "License");
		   * you may not use this file except in compliance with the License.
		   * You may obtain a copy of the License at
		   *
		   *     http://www.apache.org/licenses/LICENSE-2.0
		   *
		   * Unless required by applicable law or agreed to in writing, software
		   * distributed under the License is distributed on an "AS IS" BASIS,
		   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
		   * See the License for the specific language governing permissions and
		   * limitations under the License.
		   *
		   * SPDX-License-Identifier: Apache-2.0
		   */
var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var a={},o={};function s(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=o[e])?n:(r=u(e,0,!0),i&&(o[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=a[e])?n:(r=u(e,e<0?-1:0,!1),i&&(a[e]=r),r)}function l(e,t){if(isNaN(e))return t?y:_;if(t){if(e<0)return y;if(e>=p)return w}else{if(e<=-m)return E;if(e+1>=m)return T}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?y:_;if((r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var i=l(c(r,8)),a=_,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+s),r);if(s<8){var h=l(c(r,s));a=a.mul(h).add(l(u))}else a=(a=a.mul(i)).add(l(u))}return a.unsigned=t,a}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?d(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=h;var f=4294967296,p=f*f,m=p/2,g=s(1<<24),_=s(0);r.ZERO=_;var y=s(0,!0);r.UZERO=y;var v=s(1);r.ONE=v;var b=s(1,!0);r.UONE=b;var x=s(-1);r.NEG_ONE=x;var T=u(-1,2147483647,!1);r.MAX_VALUE=T;var w=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var E=u(0,-2147483648,!1);r.MIN_VALUE=E;var A=r.prototype;return A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},A.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(E)){var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=l(c(e,6),this.unsigned),a=this,o="";;){var s=a.div(i),u=(a.sub(s.mul(i)).toInt()>>>0).toString(e);if((a=s).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},A.isZero=function(){return 0===this.high&&0===this.low},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return 1==(1&this.low)},A.isEven=function(){return 0==(1&this.low)},A.equals=function(e){return n(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},A.eq=A.equals,A.notEquals=function(e){return!this.eq(e)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(e){return this.comp(e)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(e){return this.comp(e)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(e){return this.comp(e)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(e){return this.comp(e)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(e){if(n(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(v)},A.neg=A.negate,A.add=function(e){n(e)||(e=h(e));var t=0,r=0,i=0,a=0;return i+=(a+=(65535&this.low)+(65535&e.low))>>>16,r+=(i+=(this.low>>>16)+(e.low>>>16))>>>16,t+=(r+=(65535&this.high)+(65535&e.high))>>>16,t+=(this.high>>>16)+(e.high>>>16),u((i&=65535)<<16|(a&=65535),(t&=65535)<<16|(r&=65535),this.unsigned)},A.subtract=function(e){return n(e)||(e=h(e)),this.add(e.neg())},A.sub=A.subtract,A.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?y:_;if(this.eq(E))return e.isOdd()?E:_;if(e.eq(E))return this.isOdd()?E:_;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r=65535&this.high,i=this.low>>>16,a=65535&this.low,o=65535&e.high,s=e.low>>>16,c=65535&e.low,d=0,f=0,p=0,m=0;return p+=(m+=a*c)>>>16,f+=(p+=i*c)>>>16,p&=65535,f+=(p+=a*s)>>>16,d+=(f+=r*c)>>>16,f&=65535,d+=(f+=i*s)>>>16,f&=65535,d+=(f+=a*o)>>>16,d+=(this.high>>>16)*c+r*s+i*o+a*(e.high>>>16),u((p&=65535)<<16|(m&=65535),(d&=65535)<<16|(f&=65535),this.unsigned)},A.mul=A.multiply,A.divide=function(e){if(n(e)||(e=h(e)),e.isZero())throw Error("division by zero");var r,i,a;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return b;a=y}else{if(this.eq(E))return e.eq(v)||e.eq(x)?E:e.eq(E)?v:(r=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?v:x:(i=this.sub(e.mul(r)),a=r.add(i.div(e)));if(e.eq(E))return this.unsigned?y:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=_}for(i=this;i.gte(e);){r=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),s=o<=48?1:c(2,o-48),d=l(r),f=d.mul(e);f.isNegative()||f.gt(i);)f=(d=l(r-=s,this.unsigned)).mul(e);d.isZero()&&(d=v),a=a.add(d),i=i.sub(f)}return a},A.div=A.divide,A.modulo=function(e){return n(e)||(e=h(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return u(~this.low,~this.high,this.unsigned)},A.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},A.clz=A.countLeadingZeros,A.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},A.ctz=A.countTrailingZeros,A.and=function(e){return n(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},A.or=function(e){return n(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},A.xor=function(e){return n(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},A.shiftLeft=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(e){return n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):u(32===e?this.high:this.high>>>e-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.rotateLeft=function(e){var t;return n(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?u(this.high,this.low,this.unsigned):e<32?u(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):u(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},A.rotl=A.rotateLeft,A.rotateRight=function(e){var t;return n(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?u(this.high,this.low,this.unsigned):e<32?u(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):u(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},A.rotr=A.rotateRight,A.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},A.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},A.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=r,"default"in e?e.default:e}({});e.exports=r}(umd)),umd.exports}function requireS2TokenFunctions(){if(hasRequiredS2TokenFunctions)return s2TokenFunctions;hasRequiredS2TokenFunctions=1;var e=interopRequireDefaultExports;Object.defineProperty(s2TokenFunctions,"__esModule",{value:!0}),s2TokenFunctions.getS2CellIdFromToken=function(e){"X"===e&&(e="");var n=e.padEnd(r,"0");return t.default.fromString(n,!0,16)},s2TokenFunctions.getS2ChildCellId=function(e,r){var n=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(t.default.fromNumber(2*r+1-4).multiply(n))},s2TokenFunctions.getS2TokenFromCellId=function(e){if(e.isZero())return"X";var t=e.countTrailingZeros(),r=t=(t-t%4)/4,n=e.shiftRightUnsigned(t*=4).toString(16).replace(/0+$/,"");return Array(17-r-n.length).join("0")+n};var t=e(requireUmd()),r=16;return s2TokenFunctions}var s2GeometryFunctions={},s2ToBoundary={},s2Geometry={},hasRequiredS2Geometry,hasRequiredS2ToBoundary;function requireS2Geometry(){if(hasRequiredS2Geometry)return s2Geometry;hasRequiredS2Geometry=1;var e=interopRequireDefaultExports;Object.defineProperty(s2Geometry,"__esModule",{value:!0}),s2Geometry.FaceUVToXYZ=u,s2Geometry.IJToST=o,s2Geometry.STToUV=l,s2Geometry.XYZToLngLat=c,s2Geometry.getCornerLngLats=function(e){for(var t=[],r=[[0,0],[0,1],[1,1],[1,0]],n=0;n<4;n++){var i=l(o(e.ij,e.level,r[n])),a=u(e.face,i);t.push(c(a))}return t},s2Geometry.getS2CellFromQuadKey=function(e){if(0===e.length)throw new Error("Invalid Hilbert quad key ".concat(e));for(var t=e.split("/"),r=parseInt(t[0],10),n=t[1],i=n.length,a=0,o=[0,0],s=i-1;s>=0;s--){a=i-s;var l=n[s],u=0,c=0;"1"===l?c=1:"2"===l?(u=1,c=1):"3"===l&&(u=1);var h=Math.pow(2,a-1);d(h,o,u,c),o[0]+=h*u,o[1]+=h*c}if(r%2==1){var f=o[0];o[0]=o[1],o[1]=f}return{face:r,ij:o,level:a}},s2Geometry.getS2CellIdFromQuadkey=function(e){if(0===e.length||1!==e.indexOf("/"))throw new Error("Invalid Hilbert quad key ".concat(e));var t="";switch(e[0]){case"0":t+="000";break;case"1":t+="001";break;case"2":t+="010";break;case"3":t+="011";break;case"4":t+="100";break;case"5":t+="101";break;default:throw new Error("Invalid Hilbert quad key ".concat(e))}for(var n=e.length,i=2;i<n;i++)switch(e[i]){case"0":t+="00";break;case"1":t+="01";break;case"2":t+="10";break;case"3":t+="11";break;default:throw new Error("Invalid Hilbert quad key ".concat(e))}var a=(t+="1").padEnd(64,"0");return r.default.fromString(a,!0,2)},s2Geometry.getS2LngLatFromS2Cell=function(e){var t=l(o(e.ij,e.level,[.5,.5]));return c(u(e.face,t))},s2Geometry.getS2QuadkeyFromCellId=function(e){if(e.isZero())return"";for(var t=e.toString(2);t.length<n+i;)t="0"+t;var a=t.lastIndexOf("1"),o=t.substring(0,3),s=t.substring(3,a),l=s.length/2,u=r.default.fromString(o,!0,2).toString(10),c="";if(0!==l)for(c=r.default.fromString(s,!0,2).toString(4);c.length<l;)c="0"+c;return"".concat(u,"/").concat(c)};var t=e(requireSlicedToArray()),r=e(requireUmd()),n=3,i=61,a=180/Math.PI;function o(e,t,r){var n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function s(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function l(e){return[s(e[0]),s(e[1])]}function u(e,r){var n=(0,t.default)(r,2),i=n[0],a=n[1];switch(e){case 0:return[1,i,a];case 1:return[-i,1,a];case 2:return[-i,-a,1];case 3:return[-1,-a,-i];case 4:return[a,-1,-i];case 5:return[a,i,-1];default:throw new Error("Invalid face")}}function c(e){var r=(0,t.default)(e,3),n=r[0],i=r[1],o=Math.atan2(r[2],Math.sqrt(n*n+i*i));return[Math.atan2(i,n)*a,o*a]}function d(e,t,r,n){if(0===n){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);var i=t[0];t[0]=t[1],t[1]=i}}return s2Geometry}function requireS2ToBoundary(){if(hasRequiredS2ToBoundary)return s2ToBoundary;hasRequiredS2ToBoundary=1,Object.defineProperty(s2ToBoundary,"__esModule",{value:!0}),s2ToBoundary.getS2BoundaryFlatFromS2Cell=function(r){for(var n=r.face,i=r.ij,a=r.level,o=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(t*Math.pow(2,-a))),l=new Float64Array(4*s*2+2),u=0,c=0,d=0;d<4;d++)for(var h=o[d].slice(0),f=o[d+1],p=(f[0]-h[0])/s,m=(f[1]-h[1])/s,g=0;g<s;g++){h[0]+=p,h[1]+=m;var _=(0,e.IJToST)(i,a,h),y=(0,e.STToUV)(_),v=(0,e.FaceUVToXYZ)(n,y),b=(0,e.XYZToLngLat)(v);Math.abs(b[1])>89.999&&(b[0]=c);var x=b[0]-c;b[0]+=x>180?-360:x<-180?360:0,l[u++]=b[0],l[u++]=b[1],c=b[0]}return l[u++]=l[0],l[u++]=l[1],l};var e=requireS2Geometry(),t=100;return s2ToBoundary}var s2CellUtils={},hasRequiredS2CellUtils,hasRequiredS2GeometryFunctions;function requireS2CellUtils(){if(hasRequiredS2CellUtils)return s2CellUtils;hasRequiredS2CellUtils=1,Object.defineProperty(s2CellUtils,"__esModule",{value:!0}),s2CellUtils.getS2Cell=function(t){var n=r(t);return(0,e.getS2CellFromQuadKey)(n)},s2CellUtils.getS2QuadKey=r;var e=requireS2Geometry(),t=requireS2TokenFunctions();function r(r){if(r.indexOf("/")>0)return r;var n=(0,t.getS2CellIdFromToken)(r);return(0,e.getS2QuadkeyFromCellId)(n)}return s2CellUtils}function requireS2GeometryFunctions(){if(hasRequiredS2GeometryFunctions)return s2GeometryFunctions;hasRequiredS2GeometryFunctions=1,Object.defineProperty(s2GeometryFunctions,"__esModule",{value:!0}),s2GeometryFunctions.getS2BoundaryFlat=function(t){var n=(0,r.getS2Cell)(t);return(0,e.getS2BoundaryFlatFromS2Cell)(n)},s2GeometryFunctions.getS2LngLat=function(e){var n=(0,r.getS2Cell)(e);return(0,t.getS2LngLatFromS2Cell)(n)};var e=requireS2ToBoundary(),t=requireS2Geometry(),r=requireS2CellUtils();return s2GeometryFunctions}var s2ToRegion={},hasRequiredS2ToRegion;function requireS2ToRegion(){if(hasRequiredS2ToRegion)return s2ToRegion;hasRequiredS2ToRegion=1,Object.defineProperty(s2ToRegion,"__esModule",{value:!0}),s2ToRegion.getS2Region=function(n){var i;if(2===n.face||5===n.face){for(var a=null,o=0,s=0;s<4;s++){var l="".concat(n.face,"/").concat(s),u=(0,t.getS2Cell)(l),c=(0,e.getS2BoundaryFlatFromS2Cell)(u);null==a&&(a=new Float64Array(4*c.length)),a.set(c,o),o+=c.length}i=r(a)}else i=r((0,e.getS2BoundaryFlatFromS2Cell)(n));return i};var e=requireS2ToBoundary(),t=requireS2CellUtils();function r(e){if(e.length%2!=0)throw new Error("Invalid corners");for(var t=[],r=[],n=0;n<e.length;n+=2)t.push(e[n]),r.push(e[n+1]);return t.sort((function(e,t){return e-t})),r.sort((function(e,t){return e-t})),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}return s2ToRegion}var s2ToObbPoints={},hasRequiredS2ToObbPoints,hasRequiredS2;function requireS2ToObbPoints(){if(hasRequiredS2ToObbPoints)return s2ToObbPoints;hasRequiredS2ToObbPoints=1,Object.defineProperty(s2ToObbPoints,"__esModule",{value:!0}),s2ToObbPoints.getS2OrientedBoundingBoxCornerPoints=function(n,i){var a=(null==i?void 0:i.minimumHeight)||0,o=(null==i?void 0:i.maximumHeight)||0,s=(0,e.getS2Cell)(n),l=(0,t.getS2Region)(s),u=l.west,c=l.south,d=l.east,h=l.north,f=[];return f.push(new r.Vector3(u,h,a)),f.push(new r.Vector3(d,h,a)),f.push(new r.Vector3(d,c,a)),f.push(new r.Vector3(u,c,a)),f.push(new r.Vector3(u,h,o)),f.push(new r.Vector3(d,h,o)),f.push(new r.Vector3(d,c,o)),f.push(new r.Vector3(u,c,o)),f};var e=requireS2CellUtils(),t=requireS2ToRegion(),r=es5$q;return s2ToObbPoints}function requireS2(){return hasRequiredS2||(hasRequiredS2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getS2BoundaryFlat",{enumerable:!0,get:function(){return r.getS2BoundaryFlat}}),Object.defineProperty(e,"getS2Cell",{enumerable:!0,get:function(){return n.getS2Cell}}),Object.defineProperty(e,"getS2CellFromQuadKey",{enumerable:!0,get:function(){return i.getS2CellFromQuadKey}}),Object.defineProperty(e,"getS2CellIdFromQuadkey",{enumerable:!0,get:function(){return i.getS2CellIdFromQuadkey}}),Object.defineProperty(e,"getS2CellIdFromToken",{enumerable:!0,get:function(){return t.getS2CellIdFromToken}}),Object.defineProperty(e,"getS2ChildCellId",{enumerable:!0,get:function(){return t.getS2ChildCellId}}),Object.defineProperty(e,"getS2LngLat",{enumerable:!0,get:function(){return r.getS2LngLat}}),Object.defineProperty(e,"getS2LngLatFromS2Cell",{enumerable:!0,get:function(){return i.getS2LngLatFromS2Cell}}),Object.defineProperty(e,"getS2OrientedBoundingBoxCornerPoints",{enumerable:!0,get:function(){return o.getS2OrientedBoundingBoxCornerPoints}}),Object.defineProperty(e,"getS2QuadKey",{enumerable:!0,get:function(){return n.getS2QuadKey}}),Object.defineProperty(e,"getS2QuadkeyFromCellId",{enumerable:!0,get:function(){return i.getS2QuadkeyFromCellId}}),Object.defineProperty(e,"getS2Region",{enumerable:!0,get:function(){return a.getS2Region}}),Object.defineProperty(e,"getS2TokenFromCellId",{enumerable:!0,get:function(){return t.getS2TokenFromCellId}});var t=requireS2TokenFunctions(),r=requireS2GeometryFunctions(),n=requireS2CellUtils(),i=requireS2Geometry(),a=requireS2ToRegion(),o=requireS2ToObbPoints()}(s2)),s2}var s2CornersToObb={},hasRequiredS2CornersToObb,hasRequiredParse3dImplicitTiles,hasRequiredParse3dTileHeader;function requireS2CornersToObb(){if(hasRequiredS2CornersToObb)return s2CornersToObb;hasRequiredS2CornersToObb=1;var e=interopRequireDefaultExports;Object.defineProperty(s2CornersToObb,"__esModule",{value:!0}),s2CornersToObb.convertS2BoundingVolumetoOBB=function(e){var o=e.token,s={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},l=(0,i.getS2OrientedBoundingBoxCornerPoints)(o,s),u=(0,i.getS2LngLat)(o),c=a.Ellipsoid.WGS84.cartographicToCartesian([u[0],u[1],s.maximumHeight]),d=new r.Vector3(c[0],c[1],c[2]);l.push(d);var h=(0,n.makeOrientedBoundingBoxFromPoints)(l);return[].concat((0,t.default)(h.center),(0,t.default)(h.halfAxes))};var t=e(requireToConsumableArray()),r=es5$q,n=requireEs5$a(),i=requireS2(),a=es5$p;return s2CornersToObb}function requireParse3dImplicitTiles(){if(hasRequiredParse3dImplicitTiles)return parse3dImplicitTiles;hasRequiredParse3dImplicitTiles=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dImplicitTiles,"__esModule",{value:!0}),parse3dImplicitTiles.parseImplicitTiles=h,parse3dImplicitTiles.replaceContentUrlTemplate=_;var t=e(requireRegenerator()),r=e(requireSlicedToArray()),n=e(requireAsyncToGenerator()),i=e(requireDefineProperty()),a=tile3dSubtreeLoader,o=es5$n,s=requireS2(),l=requireS2CornersToObb();function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var c={QUADTREE:4,OCTREE:8};function d(e,t,r){if(null!=e&&e.box){var n=(0,s.getS2CellIdFromToken)(e.s2VolumeInfo.token),a=(0,s.getS2ChildCellId)(n,t),o=(0,s.getS2TokenFromCellId)(a),c=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.s2VolumeInfo);if(c.token=o,"OCTREE"===r){var d=e.s2VolumeInfo,h=d.maximumHeight-d.minimumHeight,f=h/2,p=d.minimumHeight+h/2;d.minimumHeight=p-f,d.maximumHeight=p+f}return{box:(0,l.convertS2BoundingVolumetoOBB)(c),s2VolumeInfo:c}}}function h(e){return f.apply(this,arguments)}function f(){return(f=(0,n.default)(t.default.mark((function e(r){var n,i,s,l,u,f,y,v,b,x,T,w,E,A,S,P,M,R,C,O,L,I,D,k,B,F,N,q,U,j,G,z,V,$,H,W,X,Y,Z,K,J;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=void 0===(i=r.parentData)?{mortonIndex:0,x:0,y:0,z:0}:i,y=void 0===(f=r.globalData)?{level:0,mortonIndex:0,x:0,y:0,z:0}:f,v=r.s2VolumeBox,b=r.subtree,T=void 0===(x=r.level)?0:x,E=(n=r.options).subtreeLevels,A=n.maximumLevel,S=n.contentUrlTemplate,P=n.subtreesUriTemplate,M=n.basePath,R={children:[],lodMetricValue:0,contentUrl:""},C=c[w=n.subdivisionScheme],O=1&(u=void 0===(l=r.childIndex)?0:l),L=u>>1&1,I=u>>2&1,D=(Math.pow(C,T)-1)/(C-1),k=g(s.mortonIndex,u),B=D+k,F=g(s.x,O),N=g(s.y,L),q=g(s.z,I),U=!1,T+1>E&&(U=p(b.childSubtreeAvailability,k)),j=g(y.x,F),G=g(y.y,N),z=g(y.z,q),V=T+y.level,!U){e.next=38;break}return $="".concat(M,"/").concat(P),H=_($,V,j,G,z),e.next=25,(0,o.load)(H,a.Tile3DSubtreeLoader);case 25:b=e.sent,y.mortonIndex=k,y.x=F,y.y=N,y.z=q,y.level=T,k=0,B=0,F=0,N=0,q=0,T=0;case 38:if(p(b.tileAvailability,B)&&!(T>A)){e.next=41;break}return e.abrupt("return",R);case 41:p(b.contentAvailability,B)&&(R.contentUrl=_(S,V,j,G,z)),W=T+1,X={mortonIndex:k,x:F,y:N,z:q},Y=0;case 46:if(!(Y<C)){e.next=55;break}return Z=d(v,Y,w),e.next=50,h({subtree:b,options:n,parentData:X,childIndex:Y,level:W,globalData:y,s2VolumeBox:Z});case 50:((K=e.sent).contentUrl||K.children.length)&&(J=m(K,V+1,{childTileX:F,childTileY:N,childTileZ:q},n,v),R.children.push(J));case 52:Y++,e.next=46;break;case 55:return e.abrupt("return",R);case 56:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return"constant"in e?Boolean(e.constant):!!e.explicitBitstream&&(r=t,1==(e.explicitBitstream[Math.floor(r/8)]>>r%8&1));var r}function m(e,t,n,i,a){var o=i.refine,s=i.getRefine,l=i.lodMetricType,u=i.getTileType,c=i.rootLodMetricValue,d=i.rootBoundingVolume,h=e.contentUrl&&e.contentUrl.replace("".concat(i.basePath,"/"),""),f=c/Math.pow(2,t),p=function(e,t,n){if(t.region){var i=n.childTileX,a=n.childTileY,o=n.childTileZ,s=(0,r.default)(t.region,6),l=s[0],u=s[1],c=s[2],d=s[3],h=s[4],f=s[5],p=Math.pow(2,e),m=(c-l)/p,g=(d-u)/p,_=(f-h)/p;return{region:[l+m*i,u+g*a,l+m*(i+1),u+g*(a+1),h+_*o,h+_*(o+1)]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}(t,null!=a&&a.box?{box:a.box}:d,n);return{children:e.children,contentUrl:e.contentUrl,content:{uri:h},id:e.contentUrl,refine:s(o),type:u(e),lodMetricType:l,lodMetricValue:f,geometricError:f,transform:e.transform,boundingVolume:p}}function g(e,t){return parseInt(e.toString(2)+t.toString(2),2)}function _(e,t,r,n,i){var a=function(e){var t={};for(var r in e)t["{".concat(r,"}")]=e[r];return t}({level:t,x:r,y:n,z:i});return e.replace(/{level}|{x}|{y}|{z}/gi,(function(e){return a[e]}))}return parse3dImplicitTiles}function requireParse3dTileHeader(){if(hasRequiredParse3dTileHeader)return parse3dTileHeader;hasRequiredParse3dTileHeader=1;var e=interopRequireDefaultExports;Object.defineProperty(parse3dTileHeader,"__esModule",{value:!0}),parse3dTileHeader.normalizeImplicitTileData=_,parse3dTileHeader.normalizeImplicitTileHeaders=m,parse3dTileHeader.normalizeTileData=f,parse3dTileHeader.normalizeTileHeaders=function(e,t){return p.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireAsyncToGenerator()),n=tile3dSubtreeLoader,i=es5$n,a=es5$r,o=requireParse3dImplicitTiles(),s=requireS2CornersToObb();function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e){if(!e.contentUrl)return a.TILE_TYPE.EMPTY;var t=e.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return a.TILE_TYPE.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return a.TILE_TYPE.SCENEGRAPH;default:return t}}function d(e){switch(e){case"REPLACE":case"replace":return a.TILE_REFINEMENT.REPLACE;case"ADD":case"add":return a.TILE_REFINEMENT.ADD;default:return e}}function h(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){var r=new URL(e,"".concat(t,"/"));return decodeURI(r.toString())}return e.startsWith("/")?e:"".concat(t,"/").concat(e)}function f(e,t){return e?(e.content&&(e.contentUrl=h(e.content.uri||e.content.url,t.basePath)),e.id=e.contentUrl,e.lodMetricType=a.LOD_METRIC_TYPE.GEOMETRIC_ERROR,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=c(e),e.refine=d(e.refine),e):null}function p(){return(p=(0,r.default)(t.default.mark((function e(r,n){var i,a,o,s,u,c,d,h,p;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.basePath,!(o=v(null==r?void 0:r.root))||!r.root){e.next=8;break}return e.next=5,m(r.root,r,o,n);case 5:a=e.sent,e.next=9;break;case 8:a=f(r.root,r);case 9:(s=[]).push(a);case 11:if(!(s.length>0)){e.next=40;break}u=s.pop()||{},c=l(u.children||[]),e.prev=15,c.s();case 17:if((d=c.n()).done){e.next=30;break}if(!(p=v(h=d.value))){e.next=26;break}return e.next=23,m(h,r,p,n);case 23:h=e.sent,e.next=27;break;case 26:f(h,{basePath:i});case 27:s.push(h);case 28:e.next=17;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(15),c.e(e.t0);case 35:return e.prev=35,c.f(),e.finish(35);case 38:e.next=11;break;case 40:return e.abrupt("return",a);case 41:case"end":return e.stop()}}),e,null,[[15,32,35,38]])})))).apply(this,arguments)}function m(e,t,r,n){return g.apply(this,arguments)}function g(){return(g=(0,r.default)(t.default.mark((function e(r,l,u,f){var p,m,g,y,v,b,x,T,w,E,A,S,P,M,R,C;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g=l.basePath,y=u.subdivisionScheme,v=u.maximumLevel,b=u.subtreeLevels,T=(0,o.replaceContentUrlTemplate)(x=u.subtrees.uri,0,0,0,0),w=h(T,g),e.next=6,(0,i.load)(w,n.Tile3DSubtreeLoader,f);case 6:return E=e.sent,A=h(r.content.uri,g),S=null==l||null===(p=l.root)||void 0===p?void 0:p.refine,P=r.geometricError,(M=null===(m=r.boundingVolume.extensions)||void 0===m?void 0:m["3DTILES_bounding_volume_S2"])&&(R=(0,s.convertS2BoundingVolumetoOBB)(M),r.boundingVolume={box:R,s2VolumeInfo:M}),C={contentUrlTemplate:A,subtreesUriTemplate:x,subdivisionScheme:y,subtreeLevels:b,maximumLevel:v,refine:S,basePath:g,lodMetricType:a.LOD_METRIC_TYPE.GEOMETRIC_ERROR,rootLodMetricValue:P,rootBoundingVolume:r.boundingVolume,getTileType:c,getRefine:d},e.next=16,_(r,E,C);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r){return y.apply(this,arguments)}function y(){return(y=(0,r.default)(t.default.mark((function e(r,n,i){var s,l,u;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:return r.lodMetricType=a.LOD_METRIC_TYPE.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,e.next=7,(0,o.parseImplicitTiles)({subtree:n,options:i,s2VolumeBox:r});case 7:return l=(s=e.sent).children,(u=s.contentUrl)&&(r.contentUrl=u,r.content={uri:u.replace("".concat(i.basePath,"/"),"")}),r.refine=d(r.refine),r.type=c(r),r.children=l,r.id=r.contentUrl,e.abrupt("return",r);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){var t;return(null==e||null===(t=e.extensions)||void 0===t?void 0:t["3DTILES_implicit_tiling"])||(null==e?void 0:e.implicitTiling)}return parse3dTileHeader}var _interopRequireDefault$2=interopRequireDefaultExports;Object.defineProperty(tiles3dLoader,"__esModule",{value:!0}),tiles3dLoader.Tiles3DLoader=void 0;var _regenerator$1=_interopRequireDefault$2(requireRegenerator()),_asyncToGenerator2$1=_interopRequireDefault$2(requireAsyncToGenerator()),_loaderUtils=es5$t,_tiles=es5$r,_version$1=requireVersion(),_parse3dTile=requireParse3dTile(),_parse3dTileHeader=requireParse3dTileHeader(),Tiles3DLoader={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:_version$1.VERSION,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:parse,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function getBaseUri(e){return _loaderUtils.path.dirname(e.url)}function parseTile(e,t,r){return _parseTile.apply(this,arguments)}function _parseTile(){return _parseTile=(0,_asyncToGenerator2$1.default)(_regenerator$1.default.mark((function e(t,r,n){var i;return _regenerator$1.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={content:{featureIds:null}},e.next=4,(0,_parse3dTile.parse3DTile)(t,0,r,n,i.content);case 4:return e.abrupt("return",i.content);case 5:case"end":return e.stop()}}),e)}))),_parseTile.apply(this,arguments)}function parseTileset(e,t,r){return _parseTileset.apply(this,arguments)}function _parseTileset(){return _parseTileset=(0,_asyncToGenerator2$1.default)(_regenerator$1.default.mark((function e(t,r,n){var i,a;return _regenerator$1.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=JSON.parse((new TextDecoder).decode(t))).loader=r.loader||Tiles3DLoader,a.url=n.url,a.queryString=n.queryString,a.basePath=getBaseUri(a),e.next=7,(0,_parse3dTileHeader.normalizeTileHeaders)(a,r);case 7:return a.root=e.sent,a.type=_tiles.TILESET_TYPE.TILES3D,a.lodMetricType=_tiles.LOD_METRIC_TYPE.GEOMETRIC_ERROR,a.lodMetricValue=(null===(i=a.root)||void 0===i?void 0:i.lodMetricValue)||0,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)}))),_parseTileset.apply(this,arguments)}function parse(e,t,r){return _parse.apply(this,arguments)}function _parse(){return _parse=(0,_asyncToGenerator2$1.default)(_regenerator$1.default.mark((function e(t,r,n){var i;return _regenerator$1.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("auto"===(i=r["3d-tiles"]||{}).isTileset?n.url&&-1!==n.url.indexOf(".json"):i.isTileset)){e.next=8;break}return e.next=5,parseTileset(t,r,n);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,parseTile(t,r,n);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)}))),_parse.apply(this,arguments)}tiles3dLoader.Tiles3DLoader=Tiles3DLoader;var cesiumIonLoader={},ion={},hasRequiredIon;function requireIon(){if(hasRequiredIon)return ion;hasRequiredIon=1;var e=interopRequireDefaultExports;Object.defineProperty(ion,"__esModule",{value:!0}),ion.getIonAssetMetadata=p,ion.getIonAssets=h,ion.getIonTilesetMetadata=function(e,t){return d.apply(this,arguments)};var t=e(requireRegenerator()),r=e(requireDefineProperty()),n=e(requireAsyncToGenerator()),i=es5$n,a=es5$t;function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c="https://api.cesium.com/v1/assets";function d(){return(d=(0,n.default)(t.default.mark((function e(r,n){var i,o,s,u,c;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=6;break}return e.next=3,h(r);case 3:i=l(e.sent.items);try{for(i.s();!(o=i.n()).done;)"3DTILES"===(s=o.value).type&&(n=s.id)}catch(e){i.e(e)}finally{i.f()}case 6:return e.next=8,p(r,n);case 8:return c=(u=e.sent).url,(0,a.assert)("3DTILES"===u.type&&c),u.headers={Authorization:"Bearer ".concat(u.accessToken)},e.abrupt("return",u);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return f.apply(this,arguments)}function f(){return(f=(0,n.default)(t.default.mark((function e(r){var n,o,s;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,a.assert)(r),n=c,o={Authorization:"Bearer ".concat(r)},e.next=5,(0,i.fetchFile)(n,{fetch:{headers:o}});case 5:if((s=e.sent).ok){e.next=8;break}throw new Error(s.statusText);case 8:return e.next=10,s.json();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return m.apply(this,arguments)}function m(){return(m=(0,n.default)(t.default.mark((function e(r,n){var o,l,u,d,h;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,a.assert)(r,n),o={Authorization:"Bearer ".concat(r)},l="".concat(c,"/").concat(n),e.next=5,(0,i.fetchFile)("".concat(l),{fetch:{headers:o}});case 5:if((u=e.sent).ok){e.next=8;break}throw new Error(u.statusText);case 8:return e.next=10,u.json();case 10:return d=e.sent,e.next=13,(0,i.fetchFile)("".concat(l,"/endpoint"),{fetch:{headers:o}});case 13:if((u=e.sent).ok){e.next=16;break}throw new Error(u.statusText);case 16:return e.next=18,u.json();case 18:return h=e.sent,d=s(s({},d),h),e.abrupt("return",d);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return ion}var _interopRequireDefault$1=interopRequireDefaultExports;Object.defineProperty(cesiumIonLoader,"__esModule",{value:!0}),cesiumIonLoader.CesiumIonLoader=void 0;var _regenerator=_interopRequireDefault$1(requireRegenerator()),_defineProperty2$1=_interopRequireDefault$1(requireDefineProperty()),_asyncToGenerator2=_interopRequireDefault$1(requireAsyncToGenerator()),_tiles3dLoader=tiles3dLoader,_ion=requireIon();function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,_defineProperty2$1.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function preload(e){return _preload.apply(this,arguments)}function _preload(){return _preload=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(t){var r,n,i,a,o=arguments;return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=(r=o.length>1&&void 0!==o[1]?o[1]:{})["cesium-ion"]||{}).accessToken,i=r.assetId,Number.isFinite(i)||(a=t.match(/\/([0-9]+)\/tileset.json/),i=a&&a[1]),e.abrupt("return",(0,_ion.getIonTilesetMetadata)(n,i));case 6:case"end":return e.stop()}}),e)}))),_preload.apply(this,arguments)}var CesiumIonLoader=_objectSpread(_objectSpread({},_tiles3dLoader.Tiles3DLoader),{},{id:"cesium-ion",name:"Cesium Ion",preload:preload,parse:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(t,r,n){return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=_objectSpread({},r))["3d-tiles"]=r["cesium-ion"],r.loader=CesiumIonLoader,e.abrupt("return",_tiles3dLoader.Tiles3DLoader.parse(t,r,n));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),options:{"cesium-ion":_objectSpread(_objectSpread({},_tiles3dLoader.Tiles3DLoader.options["3d-tiles"]),{},{accessToken:null})}});cesiumIonLoader.CesiumIonLoader=CesiumIonLoader;var tile3dWriter={},encode3dTile={},encode3dTileComposite={},encode3dTileHeader={},hasRequiredEncode3dTileHeader,hasRequiredEncode3dTileComposite;function requireEncode3dTileHeader(){if(hasRequiredEncode3dTileHeader)return encode3dTileHeader;hasRequiredEncode3dTileHeader=1,Object.defineProperty(encode3dTileHeader,"__esModule",{value:!0}),encode3dTileHeader.encode3DTileByteLength=function(e,t,r){e&&e.setUint32(t+8,r,!0)},encode3dTileHeader.encode3DTileHeader=function(t,r,n){if(!r)return n+12;var i=t.magic,a=t.version,o=void 0===a?1:a,s=t.byteLength,l=void 0===s?12:s;return(0,e.assert)(Array.isArray(i)&&Number.isFinite(o)&&Number.isFinite(l)),r.setUint8(n+0,i[0]),r.setUint8(n+1,i[1]),r.setUint8(n+2,i[2]),r.setUint8(n+3,i[3]),r.setUint32(n+4,o,!0),r.setUint32(n+8,l,!0),n+12};var e=es5$t;return encode3dTileHeader}function requireEncode3dTileComposite(){if(hasRequiredEncode3dTileComposite)return encode3dTileComposite;hasRequiredEncode3dTileComposite=1;var e=interopRequireDefaultExports;Object.defineProperty(encode3dTileComposite,"__esModule",{value:!0}),encode3dTileComposite.encodeComposite3DTile=function(e,a,o,s,l){e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?i(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({magic:r.MAGIC_ARRAY.COMPOSITE,tiles:[]},e);var u=o;o+=(0,n.encode3DTileHeader)(e,a,o),a&&a.setUint32(o,e.tiles.length,!0),o+=4;for(var c=0;c<e.tiles.length;++c)o+=l(e.tiles[c],a,o,s);return(0,n.encode3DTileByteLength)(a,u,o-u),o};var t=e(requireDefineProperty()),r=requireConstants(),n=requireEncode3dTileHeader();function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}return encode3dTileComposite}var encode3dTileBatchedModel={},hasRequiredEncode3dTileBatchedModel;function requireEncode3dTileBatchedModel(){if(hasRequiredEncode3dTileBatchedModel)return encode3dTileBatchedModel;hasRequiredEncode3dTileBatchedModel=1;var e=interopRequireDefaultExports;Object.defineProperty(encode3dTileBatchedModel,"__esModule",{value:!0}),encode3dTileBatchedModel.encodeBatchedModel3DTile=function(e,o,s,l){var u=e.featuresLength,c=e.batchTable,d=JSON.stringify({BATCH_LENGTH:void 0===u?0:u}),h=c?JSON.stringify(c):"",f=(0,r.padToNBytes)(d.length,8),p=h?(0,r.padToNBytes)(h.length,8):0;e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({magic:n.MAGIC_ARRAY.BATCHED_MODEL},e);var m=s;s=(0,i.encode3DTileHeader)(e,o,s),o&&(o.setUint32(12,f,!0),o.setUint32(16,0,!0),o.setUint32(20,p,!0),o.setUint32(24,0,!0)),s=(0,r.copyPaddedStringToDataView)(o,s+=16,d,8),c&&(s=(0,r.copyPaddedStringToDataView)(o,s,h,8));var g=e.gltfEncoded;return g&&(s=(0,r.copyBinaryToDataView)(o,s,g,g.byteLength)),(0,i.encode3DTileByteLength)(o,m,s-m),s};var t=e(requireDefineProperty()),r=es5$t,n=requireConstants(),i=requireEncode3dTileHeader();function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}return encode3dTileBatchedModel}var encode3dTileInstancedModel={},hasRequiredEncode3dTileInstancedModel;function requireEncode3dTileInstancedModel(){if(hasRequiredEncode3dTileInstancedModel)return encode3dTileInstancedModel;hasRequiredEncode3dTileInstancedModel=1;var e=interopRequireDefaultExports;Object.defineProperty(encode3dTileInstancedModel,"__esModule",{value:!0}),encode3dTileInstancedModel.encodeInstancedModel3DTile=function(e,o,s,l){var u=e.featuresLength,c=void 0===u?1:u,d=e.gltfFormat,h=void 0===d?1:d,f=e.gltfUri,p=void 0===f?"":f,m=p.length,g={INSTANCES_LENGTH:c,POSITION:new Array(3*c).fill(0)},_=JSON.stringify(g),y=_.length;e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({magic:n.MAGIC_ARRAY.INSTANCED_MODEL},e);var v=s;return s=(0,i.encode3DTileHeader)(e,o,0),o&&(o.setUint32(12,y,!0),o.setUint32(16,0,!0),o.setUint32(20,0,!0),o.setUint32(24,0,!0),o.setUint32(28,h,!0)),s+=20,s+=(0,r.copyStringToDataView)(o,s,_,y),s+=(0,r.copyStringToDataView)(o,s,p,m),(0,i.encode3DTileByteLength)(o,v,s-v),s};var t=e(requireDefineProperty()),r=es5$t,n=requireConstants(),i=requireEncode3dTileHeader();function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}return encode3dTileInstancedModel}var encode3dTilePointCloud={},hasRequiredEncode3dTilePointCloud,hasRequiredEncode3dTile;function requireEncode3dTilePointCloud(){if(hasRequiredEncode3dTilePointCloud)return encode3dTilePointCloud;hasRequiredEncode3dTilePointCloud=1;var e=interopRequireDefaultExports;Object.defineProperty(encode3dTilePointCloud,"__esModule",{value:!0}),encode3dTilePointCloud.encodePointCloud3DTile=function(e,s,l,u){var c=e.featureTableJson,d=JSON.stringify(void 0===c?o:c);d=(0,i.padStringToByteAlignment)(d,4);var h=e.featureTableJsonByteLength,f=void 0===h?d.length:h,p=new ArrayBuffer(12),m=p.byteLength;e=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,t.default)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({magic:r.MAGIC_ARRAY.POINT_CLOUD},e);var g=l;return l+=(0,n.encode3DTileHeader)(e,s,0),s&&(s.setUint32(l+0,f,!0),s.setUint32(l+4,m,!0),s.setUint32(l+8,0,!0),s.setUint32(l+12,0,!0)),l+=16,l+=(0,i.copyStringToDataView)(s,l,d,f),l+=(0,i.copyBinaryToDataView)(s,l,p,m),(0,n.encode3DTileByteLength)(s,g,l-g),l};var t=e(requireDefineProperty()),r=requireConstants(),n=requireEncode3dTileHeader(),i=es5$t;function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var o={POINTS_LENGTH:1,POSITIONS:{byteOffset:0}};return encode3dTilePointCloud}function requireEncode3dTile(){if(hasRequiredEncode3dTile)return encode3dTile;hasRequiredEncode3dTile=1,Object.defineProperty(encode3dTile,"__esModule",{value:!0}),encode3dTile.default=function(e,t){var r=o(e,null,0,t),n=new ArrayBuffer(r);return o(e,new DataView(n),0,t),n};var e=requireConstants(),t=es5$t,r=requireEncode3dTileComposite(),n=requireEncode3dTileBatchedModel(),i=requireEncode3dTileInstancedModel(),a=requireEncode3dTilePointCloud();function o(s,l,u,c){switch((0,t.assert)("string"==typeof s.type),s.type){case e.TILE3D_TYPE.COMPOSITE:return(0,r.encodeComposite3DTile)(s,l,u,c,o);case e.TILE3D_TYPE.POINT_CLOUD:return(0,a.encodePointCloud3DTile)(s,l,u,c);case e.TILE3D_TYPE.BATCHED_3D_MODEL:return(0,n.encodeBatchedModel3DTile)(s,l,u,c);case e.TILE3D_TYPE.INSTANCED_3D_MODEL:return(0,i.encodeInstancedModel3DTile)(s,l,u,c);default:throw new Error("3D Tiles: unknown tile type")}}return encode3dTile}var _interopRequireDefault=interopRequireDefaultExports;Object.defineProperty(tile3dWriter,"__esModule",{value:!0}),tile3dWriter.Tile3DWriter=void 0;var _defineProperty2=_interopRequireDefault(requireDefineProperty()),_version=requireVersion(),_encode3dTile=_interopRequireDefault(requireEncode3dTile()),Tile3DWriter={name:"3D Tile",id:"3d-tiles",module:"3d-tiles",version:_version.VERSION,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],encodeSync:encodeSync,binary:!0,options:(0,_defineProperty2.default)({},"3d-tiles",{})};function encodeSync(e,t){return(0,_encode3dTile.default)(e,t)}tile3dWriter.Tile3DWriter=Tile3DWriter,function(e){var t=interopRequireDefaultExports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"CesiumIonLoader",{enumerable:!0,get:function(){return n.CesiumIonLoader}}),Object.defineProperty(e,"TILE3D_TYPE",{enumerable:!0,get:function(){return l.TILE3D_TYPE}}),Object.defineProperty(e,"Tile3DBatchTable",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"Tile3DFeatureTable",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"Tile3DSubtreeLoader",{enumerable:!0,get:function(){return i.Tile3DSubtreeLoader}}),Object.defineProperty(e,"Tile3DWriter",{enumerable:!0,get:function(){return a.Tile3DWriter}}),Object.defineProperty(e,"Tiles3DLoader",{enumerable:!0,get:function(){return r.Tiles3DLoader}}),Object.defineProperty(e,"_getIonTilesetMetadata",{enumerable:!0,get:function(){return u.getIonTilesetMetadata}});var r=tiles3dLoader,n=cesiumIonLoader,i=tile3dSubtreeLoader,a=tile3dWriter,o=t(requireTile3dFeatureTable()),s=t(requireTile3dBatchTable()),l=requireConstants(),u=requireIon()}(es5);const SINGLE_DATA=[0],defaultProps$1={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:es5.Tiles3DLoader,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class Tile3DLayer extends es5$g.CompositeLayer{constructor(...e){super(...e),_defineProperty(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&es5$g.log.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return Boolean((null===(e=this.state)||void 0===e||null===(t=e.tileset3d)||void 0===t?void 0:t.isLoaded())&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:r}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:e}=this.state;Object.keys(e).length&&(this._updateTileset(e),this.state.lastUpdatedViewports=e,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:e}=this.state;for(const t in e)e[t].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=null==r?void 0:r[e.id];n&&e.equals(n)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const r=t&&t.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:t}){const{tile:r}=e.props,{id:n}=t;return r.selected&&r.viewportIds.includes(n)}_updateAutoHighlight(e){const t=e.sourceTile,r=this.state.layerMap[null==t?void 0:t.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};let i=e;if(r.preload){const a=await r.preload(e,t);a.url&&(i=a.url),a.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:a.headers}),Object.assign(n,a)}const a=await es5$n.load(i,r,n.loadOptions),o=new es5$r.Tileset3D(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:r}=this.context,n=Object.keys(e).length;r&&n&&t&&t.selectTiles(Object.values(e)).then((e=>{this.state.frameNumber!==e&&this.setState({frameNumber:e})}))}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case es5$r.TILE_TYPE.POINTCLOUD:return this._makePointCloudLayer(e,t);case es5$r.TILE_TYPE.SCENEGRAPH:return this._make3DModelLayer(e);case es5$r.TILE_TYPE.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:r,pointCount:n,constantRGBA:i,cartographicOrigin:a,modelMatrix:o}=e.content,{positions:s,normals:l,colors:u}=r;if(!s)return null;const c=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:s,NORMAL:l,COLOR_0:u}},{pointSize:d,getPointColor:h}=this.props;return new(this.getSubLayerClass("pointcloud",es5$4.PointCloudLayer))({pointSize:d},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:c,coordinateSystem:es5$g.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:i||h,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:r,cartographicOrigin:n,modelMatrix:i}=e.content;return new(this.getSubLayerClass("scenegraph",es5$2.ScenegraphLayer))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||SINGLE_DATA,scenegraph:t,coordinateSystem:es5$g.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:n,modelMatrix:i,getTransformMatrix:e=>e.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const r=e.content,{attributes:n,indices:i,modelMatrix:a,cartographicOrigin:o,coordinateSystem:s=es5$g.COORDINATE_SYSTEM.METER_OFFSETS,material:l,featureIds:u}=r,{_getMeshColor:c}=this.props,d=t&&t.props.mesh||new es5$d.Geometry({drawMode:4,attributes:getMeshGeometry(n),indices:i});return new(this.getSubLayerClass("mesh",MeshLayer))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:d,data:SINGLE_DATA,getColor:c(e),pbrMaterial:l,modelMatrix:a,coordinateOrigin:o,coordinateSystem:s,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map((e=>{const r=t[e.id]=t[e.id]||{tile:e};let{layer:n}=r;return e.selected&&(n?r.needsUpdate&&(n=this._getSubLayer(e,n),r.needsUpdate=!1):n=this._getSubLayer(e)),r.layer=n,n})).filter(Boolean):null}}function getMeshGeometry(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}_defineProperty(Tile3DLayer,"defaultProps",defaultProps$1),_defineProperty(Tile3DLayer,"layerName","Tile3DLayer");const DEFAULT_INDICES=new Uint16Array([0,2,1,0,3,2]),DEFAULT_TEX_COORDS=new Float32Array([0,1,0,0,1,0,1,1]);function createMesh(e,t){if(!t)return createQuad(e);const r=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(r/t)+1,a=Math.ceil(n/t)+1,o=(i-1)*(a-1)*6,s=new Uint32Array(o),l=new Float32Array(i*a*2),u=new Float64Array(i*a*3);let c=0,d=0;for(let t=0;t<i;t++){const r=t/(i-1);for(let n=0;n<a;n++){const i=n/(a-1),o=interpolateQuad(e,r,i);u[3*c+0]=o[0],u[3*c+1]=o[1],u[3*c+2]=o[2]||0,l[2*c+0]=r,l[2*c+1]=1-i,t>0&&n>0&&(s[d++]=c-a,s[d++]=c-a-1,s[d++]=c-1,s[d++]=c-a,s[d++]=c-1,s[d++]=c),c++}}return{vertexCount:o,positions:u,indices:s,texCoords:l}}function createQuad(e){const t=new Float64Array(12);for(let r=0;r<e.length;r++)t[3*r+0]=e[r][0],t[3*r+1]=e[r][1],t[3*r+2]=e[r][2]||0;return{vertexCount:6,positions:t,indices:DEFAULT_INDICES,texCoords:DEFAULT_TEX_COORDS}}function interpolateQuad(e,t,r){return es5$q.lerp(es5$q.lerp(e[0],e[1],r),es5$q.lerp(e[3],e[2],r),t)}var vs="\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n";const packUVsIntoRGB="\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n";var fs="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat(packUVsIntoRGB,"\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive && !picking_uAttribute) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n");const defaultProps={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:es5$g.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}};class BitmapLayer extends es5$g.Layer{constructor(...e){super(...e),_defineProperty(this,"state",void 0)}getShaders(){return super.getShaders({vs:vs,fs:fs,modules:[es5$g.project32,es5$g.picking]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:r}){const n=this.getAttributeManager();if(r.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),n.invalidateAll()}if(e.bounds!==t.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const r in t)e&&e[r]!==t[r]&&n.invalidate(r);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,r=e.info;if(!r.color||!t)return r.bitmap=null,r;const{width:n,height:i}=t;r.index=0;const a=unpackUVsFromRGB(r.color),o=[Math.floor(a[0]*n),Math.floor(a[1]*i)];return r.bitmap={size:{width:n,height:i},uv:a,pixel:o},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return isRectangularBounds(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),createMesh(t,this.context.viewport.resolution)}_getModel(e){return e?new es5$d.Model(e,{...this.getShaders(),id:this.props.id,geometry:new es5$d.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:t,moduleParameters:r}=e,{model:n,coordinateConversion:i,bounds:a,disablePicking:o}=this.state,{image:s,desaturate:l,transparentColor:u,tintColor:c}=this.props;r.pickingActive&&o||s&&n&&n.setUniforms(t).setUniforms({bitmapTexture:s,desaturate:l,transparentColor:u.map((e=>e/255)),tintColor:c.slice(0,3).map((e=>e/255)),coordinateConversion:i,bounds:a}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:r}=es5$g.COORDINATE_SYSTEM;let{_imageCoordinateSystem:n}=this.props;if(n!==r){const{bounds:r}=this.props;if(!isRectangularBounds(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const i=this.context.viewport.resolution?e:t;if(n=n===e?e:t,n===e&&i===t)return{coordinateConversion:-1,bounds:r};if(n===t&&i===e){const e=es5$7.lngLatToWorld([r[0],r[1]]),t=es5$7.lngLatToWorld([r[2],r[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function unpackUVsFromRGB(e){const[t,r,n]=e;return[(t+(15&n)/16)/256,(r+(240&n)/256)/256]}function isRectangularBounds(e){return Number.isFinite(e[0])}_defineProperty(BitmapLayer,"layerName","BitmapLayer"),_defineProperty(BitmapLayer,"defaultProps",defaultProps);const Tile3DLayerType=Tile3DLayer,Tiles3DLayer=MapboxLayer;return tianjingmapgl.Model3DLayer=Model3DLayer,tianjingmapgl.Draw=MapboxDraw,tianjingmapgl.Tiles3DLoader=Tiles3DLoader$1,tianjingmapgl.Tile3DLayerType=Tile3DLayerType,tianjingmapgl.Tiles3DLayer=Tiles3DLayer,tianjingmapgl.BitmapLayer=BitmapLayer,tianjingmapgl.DeckglLayer=MapboxLayer,tianjingmapgl}));